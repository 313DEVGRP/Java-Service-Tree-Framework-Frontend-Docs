{"version":3,"file":"js/app.83b00079.js","mappings":"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ACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOmC,EACPr4C,QAASs4C,EACTnC,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOqC,EACPv4C,QAASw4C,EACTrC,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOuC,EACPz4C,QAAS04C,EACTvC,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOyC,GACP34C,QAAS44C,GACTzC,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAO2C,GACP74C,QAAS84C,GACT3C,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAO6C,GACP/4C,QAASg5C,GACT7C,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAO+C,GACPj5C,QAASk5C,GACT/C,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOiD,GACPn5C,QAASo5C,GACTjD,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOmD,GACPr5C,QAASs5C,GACTnD,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOqD,GACPv5C,QAASw5C,GACTrD,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOuD,GACPz5C,QAAS05C,GACTvD,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOyD,GACP35C,QAAS45C,GACTzD,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAO2D,GACP75C,QAAS85C,GACT3D,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAO6D,GACP/5C,QAASg6C,GACT7D,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAO+D,GACPj6C,QAASk6C,GACT/D,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOiE,GACPn6C,QAASo6C,GACTjE,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOmE,GACPr6C,QAASs6C,GACTnE,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOqE,GACPv6C,QAASw6C,GACTrE,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOuE,GACPz6C,QAAS06C,GACTvE,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOyE,GACP36C,QAAS46C,GACTzE,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAO2E,GACP76C,QAAS86C,GACT3E,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAO6E,GACP/6C,QAASg7C,GACT7E,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAO+E,GACPj7C,QAASk7C,GACT/E,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOiF,GACPn7C,QAASo7C,GACTjF,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOmF,GACPr7C,QAASs7C,GACTnF,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOqF,GACPv7C,QAASw7C,GACTrF,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOuF,GACPz7C,QAAS07C,GACTvF,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOyF,GACP37C,QAAS47C,GACTzF,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAO2F,GACP77C,QAAS87C,GACT3F,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAO6F,GACP/7C,QAASg8C,GACT7F,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAO+F,GACPj8C,QAASk8C,GACT/F,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOiG,GACPn8C,QAASo8C,GACTjG,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOmG,GACPr8C,QAASs8C,GACTnG,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOqG,GACPv8C,QAASw8C,GACTrG,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOuG,GACPz8C,QAAS08C,GACTvG,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOyG,GACP38C,QAAS48C,GACTzG,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAO2G,GACP78C,QAAS88C,GACT3G,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAO6G,GACP/8C,QAASg9C,GACT7G,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAO+G,GACPj9C,QAASk9C,GACT/G,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOiH,GACPn9C,QAASo9C,GACTjH,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOmH,GACPr9C,QAASs9C,GACTnH,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOqH,GACPv9C,QAASw9C,GACTrH,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOuH,GACPz9C,QAAS09C,GACTvH,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOyH,GACP39C,QAAS49C,GACTzH,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAO2H,GACP79C,QAAS89C,GACT3H,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAO6H,GACP/9C,QAASg+C,GACT7H,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAO+H,GACPj+C,QAASk+C,GACT/H,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOiI,GACPn+C,QAASo+C,GACTjI,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOmI,GACPr+C,QAASs+C,GACTnI,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOqI,GACPv+C,QAASw+C,GACTrI,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOuI,GACPz+C,QAAS0+C,GACTvI,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOyI,GACP3+C,QAAS4+C,GACTzI,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAO2I,GACP7+C,QAAS8+C,GACT3I,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAO6I,GACP/+C,QAASg/C,GACT7I,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAO+I,GACPj/C,QAASk/C,GACT/I,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOiJ,GACPn/C,QAASo/C,GACTjJ,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOmJ,GACPr/C,QAASs/C,GACTnJ,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOqJ,GACPv/C,QAASw/C,GACTrJ,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOuJ,GACPz/C,QAAS0/C,GACTvJ,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOyJ,GACP3/C,QAAS4/C,GACTzJ,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAO2J,GACP7/C,QAAS8/C,GACT3J,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAO6J,GACP//C,QAASggD,GACT7J,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAO+J,GACPjgD,QAASkgD,GACT/J,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOiK,GACPngD,QAASogD,GACTjK,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOmK,GACPrgD,QAASsgD,GACTnK,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOqK,GACPvgD,QAASwgD,GACTrK,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOuK,GACPzgD,QAAS0gD,GACTvK,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOyK,GACP3gD,QAAS4gD,GACTzK,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAO2K,GACP7gD,QAAS8gD,GACT3K,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAO6K,GACP/gD,QAASghD,GACT7K,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAO+K,GACPjhD,QAASkhD,GACT/K,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOiL,GACPnhD,QAASohD,GACTjL,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOmL,GACPrhD,QAASshD,GACTnL,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOqL,GACPvhD,QAASwhD,GACTrL,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOuL,GACPzhD,QAAS0hD,GACTvL,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOyL,GACP3hD,QAAS4hD,GACTzL,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAO2L,GACP7hD,QAAS8hD,GACT3L,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAO6L,GACP/hD,QAASgiD,GACT7L,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAO+L,GACPjiD,QAASkiD,GACT/L,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOiM,GACPniD,QAASoiD,GACTjM,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOmM,GACPriD,QAASsiD,GACTnM,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOqM,GACPviD,QAASwiD,GACTrM,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOuM,GACPziD,QAAS0iD,GACTvM,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAOyM,GACP3iD,QAAS4iD,GACTzM,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,YACNy4F,MAAO2M,GACP7iD,QAAS8iD,GACT3M,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,YACNy4F,MAAO6M,GACP/iD,QAASgjD,GACT7M,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,YACNy4F,MAAO+M,GACPjjD,QAASkjD,GACT/M,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,YACNy4F,MAAOiN,GACPnjD,QAASojD,GACTjN,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,YACNy4F,MAAOmN,GACPrjD,QAASsjD,GACTnN,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,YACNy4F,MAAOqN,GACPvjD,QAASwjD,GACTrN,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,YACNy4F,MAAOuN,GACPzjD,QAAS0jD,GACTvN,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,YACNy4F,MAAOyN,GACP3jD,QAAS4jD,GACTzN,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,YACNy4F,MAAO2N,GACP7jD,QAAS8jD,GACT3N,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,YACNy4F,MAAO6N,GACP/jD,QAASgkD,GACT7N,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,YACNy4F,MAAO+N,GACPjkD,QAASkkD,GACT/N,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,YACNy4F,MAAOiO,GACPnkD,QAASokD,GACTjO,KAAM,8C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ACR,GACDH,GAAqB,CAClBv4F,KAAM,YACNy4F,MAAOmW,GACPrsD,QAASssD,GACTnW,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,YACNy4F,MAAOqW,GACPvsD,QAASwsD,GACTrW,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,YACNy4F,MAAOuW,GACPzsD,QAAS0sD,GACTvW,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,YACNy4F,MAAOyW,GACP3sD,QAAS4sD,GACTzW,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,YACNy4F,MAAO2W,GACP7sD,QAAS8sD,GACT3W,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,YACNy4F,MAAO6W,GACP/sD,QAASgtD,GACT7W,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,YACNy4F,MAAO+W,GACPjtD,QAASktD,GACT/W,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,YACNy4F,MAAOiX,GACPntD,QAASotD,GACTjX,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,YACNy4F,MAAOmX,GACPrtD,QAASstD,GACTnX,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,YACNy4F,MAAOqX,GACPvtD,QAASwtD,GACTrX,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,SACNy4F,MAAOuX,GACPztD,QAAS0tD,GACTvX,KAAM,8CACR,GAAI,CACV,iBAAkB,CAAMH,GAAqB,CACrCv4F,KAAM,UACNy4F,MAAOyX,GACP3tD,QAAS4tD,GACTzX,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,QACNy4F,MAAO2X,GACP7tD,QAAS8tD,GACT3X,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,SACNy4F,MAAO6X,GACP/tD,QAASguD,GACT7X,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,MACNy4F,MAAO+X,GACPjuD,QAASkuD,GACT/X,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,gBACNy4F,MAAOiY,GACPnuD,QAASouD,GACTjY,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,aACNy4F,MAAOmY,GACPruD,QAASsuD,GACTnY,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,cACNy4F,MAAOqY,GACPvuD,QAASwuD,GACTrY,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,KACNy4F,MAAOuY,GACPzuD,QAAS0uD,GACTvY,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,cACNy4F,MAAOyY,GACP3uD,QAAS4uD,GACTzY,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,YACNy4F,MAAO2Y,GACP7uD,QAAS8uD,GACT3Y,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,eACNy4F,MAAO6Y,GACP/uD,QAASgvD,GACT7Y,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,OACNy4F,MAAO+Y,GACPjvD,QAASkvD,GACT/Y,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,YACNy4F,MAAOiZ,GACPnvD,QAASovD,GACTjZ,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,YACNy4F,MAAOmZ,GACPrvD,QAASsvD,GACTnZ,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,QACNy4F,MAAOqZ,GACPvvD,QAASwvD,GACTrZ,KAAM,8CACR,GAAI,CACV,qBAAsB,CAAMH,GAAqB,CACzCv4F,KAAM,SACNy4F,MAAOuZ,GACPzvD,QAAS0vD,GACTvZ,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,KACNy4F,MAAOyZ,GACP3vD,QAAS4vD,GACTzZ,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,MACNy4F,MAAO2Z,GACP7vD,QAAS8vD,GACT3Z,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,SACNy4F,MAAO6Z,GACP/vD,QAASgwD,GACT7Z,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,OACNy4F,MAAO+Z,GACPjwD,QAASkwD,GACT/Z,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,OACNy4F,MAAOia,GACPnwD,QAASowD,GACTja,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,OACNy4F,MAAOma,GACPrwD,QAASswD,GACTna,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,OACNy4F,MAAOqa,GACPvwD,QAASwwD,GACTra,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,YACNy4F,MAAOua,GACPzwD,QAAS0wD,GACTva,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,OACNy4F,MAAOya,GACP3wD,QAAS4wD,GACTza,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,SACNy4F,MAAO2a,GACP7wD,QAAS8wD,GACT3a,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,MACNy4F,MAAO6a,GACP/wD,QAASgxD,GACT7a,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAO+a,GACPjxD,QAASkxD,GACT/a,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,aACNy4F,MAAOib,GACPnxD,QAASoxD,GACTjb,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,OACNy4F,MAAOmb,GACPrxD,QAASsxD,GACTnb,KAAM,8CACR,GAAI,CACV,MAAS,CAAMH,GAAqB,CAC5Bv4F,KAAM,KACNy4F,MAAOqb,GACPvxD,QAASwxD,GACTrb,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,oBACNy4F,MAAOub,GACPzxD,QAAS0xD,GACTvb,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,YACNy4F,MAAOyb,GACP3xD,QAAS4xD,GACTzb,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,QACNy4F,MAAO2b,GACP7xD,QAAS8xD,GACT3b,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,WACNy4F,MAAO6b,GACP/xD,QAASgyD,GACT7b,KAAM,8CACR,GACDH,GAAqB,CAClBv4F,KAAM,cACNy4F,MAAO+b,GACPjyD,QAASkyD,GACT/b,KAAM,8CACR,GACDH,GAAqB,CAClBv4F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OAAAA,EAAQ,KACpB,IAAMwgH,EAAU,IAAIC,EAAAA,EAAyBA,CAACzzG,GAC9C,OAAOwzG,EAAQE,uBAAuB,CAACpjD,EAASvkE,EAAE,GAAGkE,MAAQ,CAC/D,EAAG,CAAC+P,EAASswD,EAASvkE,EAAE,CAAC,EAEzB,MACE,UAACsmC,EAAAA,EAAYA,CAAAA,CACXhpB,KAAMiqG,EACN50D,mBAAoB,CAClB/4B,QAAS65B,CACX,EACAvrD,MAAOzF,CAAC,CAAC,2DAA2D,GACpEpG,YACE,WAAC6gH,EAAAA,EAAKA,CAAAA,CACJz8G,OAAQ,CACNc,KAAMgjE,EAAShjE,IAAI,CACnBuC,MAAAA,CACF,EACAsgH,QAAQ,kE,UACT,OACK,UAACjmF,SAAAA,C,SAAQ,CAAE58B,KAAMgjE,EAAShjE,IAAI,C,GAAmB,6E,GAIzDilC,YAAa/jC,EAAE,OAAU,GACzB+wD,UAAWA,EACXF,oBAAqB,CACnB15B,QAAS65B,CACX,EACAhtB,qBAAsB,CACpB7mC,QAAS,OACX,C,EAGN,C,qGC3CO,IAAMgoH,EAAY,CACvB,KACA,QACA,OACA,WACA,WACA,MACA,UACA,WACA,QACA,MACA,aACA,SACA,SACA,eACA,WACA,eACA,YACA,WACA,eACA,mBACA,OACA,UACA,SACA,cACA,iBACA,QACA,sBACA,cACA,aACA,OACA,iBACA,cACA,YACA,QACA,OACA,WACA,iBACA,QACA,YACA,OACA,OACA,MACA,gBACA,SACA,cACA,OACA,cACA,QACA,MACA,QACA,gBACA,OACA,MACA,UACA,WACA,WACA,SACA,YACA,qBACA,QACA,eACA,OACA,mBACA,QACA,QACA,aACA,oBACA,OACA,OACA,aACA,SACA,QACA,QACA,aACA,WACA,UACA,UACD,CAIYC,EAAqB,IAGhC,OAAQx1G,GACN,IAAK,OAYL,QAXE,MAAO,MACT,KAAK,OACH,MAAO,KACT,KAAK,OACH,MAAO,UACT,KAAK,WACH,MAAO,UACT,KAAK,WACH,MAAO,qBACT,KAAK,SACH,MAAO,QAGX,CACF,EAEay1G,EAAkB,CAC7BC,EACA11G,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KACd/0I,IAAKm1I,CACP,EACA,CACEvrN,GAAI,WACJuB,KAAM,SACN05G,IAAK,KACLD,aAAc,WACdiwG,UAAW,OACXC,KAAM,GACNC,aAAc,KACd/0I,IAAKo1I,CACP,EACA,CACExrN,GAAI,WACJuB,KAAM,UACN05G,IAAK,KACLD,aAAc,UACdiwG,UAAW,OACXC,KAAM,GACNC,aAAc,KACd/0I,IAAKq1I,CACP,EACA,CACEzrN,GAAI,WACJuB,KAAM,SACN05G,IAAK,KACLD,aAAc,UACdiwG,UAAW,OACXC,KAAM,GACNC,aAAc,KACd/0I,IAAKs1I,CACP,EACA,CACE1rN,GAAI,WACJuB,KAAM,UACN05G,IAAK,KACLD,aAAc,UACdiwG,UAAW,OACXC,KAAM,GACNC,aAAc,KACd/0I,IAAKu1I,CACP,EACA,CACE3rN,GAAI,WACJuB,KAAM,WACN05G,IAAK,KACLD,aAAc,MACdiwG,UAAW,OACXC,KAAM,GACNC,aAAc,KACd/0I,IAAKw1I,CACP,EACA,CACE5rN,GAAI,WACJuB,KAAM,UACN05G,IAAK,KACLD,aAAc,WACdiwG,UAAW,OACXC,KAAM,GACNC,aAAc,KACd/0I,IAAKy1I,CACP,EACA,CACE7rN,GAAI,WACJuB,KAAM,UACN05G,IAAK,KACLD,aAAc,SACdiwG,UAAW,OACXC,KAAM,GACNC,aAAc,KACd/0I,IAAK01I,CACP,EACA,CACE9rN,GAAI,WACJuB,KAAM,SACN05G,IAAK,KACLD,aAAc,QACdiwG,UAAW,OACXC,KAAM,GACNC,aAAc,KACd/0I,IAAK21I,CACP,EACA,CACE/rN,GAAI,WACJuB,KAAM,0BACN05G,IAAK,QACLD,aAAc,0BACdiwG,UAAW,OACXC,KAAM,GACNC,aAAc,KACd/0I,IAAK41I,CACP,EACA,CACEhsN,GAAI,WACJuB,KAAM,kBACN05G,IAAK,QACLD,aAAc,kBACdiwG,UAAW,OACXC,KAAM,GACNC,aAAc,KACd/0I,IAAK61I,CACP,EACA,CACEjsN,GAAI,WACJuB,KAAM,QACN05G,IAAK,KACLD,aAAc,SACdiwG,UAAW,OACXC,KA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","sources":["webpack://@affine/web/../core/src/components/affine/auth/style.css.ts","webpack://@affine/web/../core/src/components/affine/page-properties/styles.css.ts","webpack://@affine/web/../core/src/components/page-list/filter/index.css.ts","webpack://@affine/web/../core/src/components/page-list/list.css.ts","webpack://@affine/web/../core/src/components/page-list/view/edit-collection/edit-collection.css.ts","webpack://@affine/web/../../common/debug/src/index.ts","webpack://@affine/web/../../common/env/src/constant.ts","webpack://@affine/web/../../common/env/src/ua-helper.ts","webpack://@affine/web/../../common/env/src/global.ts","webpack://@affine/web/../../common/env/src/workspace.ts","webpack://@affine/web/../../common/infra/src/atom/root-store.ts","webpack://@affine/web/../../common/infra/src/atom/settings.ts","webpack://@affine/web/../../common/infra/src/framework/core/components/component.ts","webpack://@affine/web/../../common/infra/src/framework/core/components/entity.ts","webpack://@affine/web/../../common/infra/src/framework/core/components/scope.ts","webpack://@affine/web/../../common/infra/src/framework/core/components/service.ts","webpack://@affine/web/../../common/infra/src/framework/core/components/store.ts","webpack://@affine/web/../../common/infra/src/framework/core/constructor-context.ts","webpack://@affine/web/../../common/infra/src/framework/core/consts.ts","webpack://@affine/web/../../common/infra/src/framework/core/error.ts","webpack://@affine/web/../../common/infra/src/framework/core/event.ts","webpack://@affine/web/../../common/infra/src/framework/core/provider.ts","webpack://@affine/web/../../common/infra/src/framework/core/scope.ts","webpack://@affine/web/../../common/infra/src/framework/core/framework.ts","webpack://@affine/web/../../common/infra/src/framework/core/identifier.ts","webpack://@affine/web/../../common/infra/src/framework/react/index.tsx","webpack://@affine/web/../../common/infra/src/framework/react/scope-root-components.tsx","webpack://@affine/web/../../common/infra/src/initialization/index.ts","webpack://@affine/web/../../common/infra/src/livedata/effect/index.ts","webpack://@affine/web/../../common/infra/src/livedata/livedata.ts","webpack://@affine/web/../../common/infra/src/livedata/ops.ts","webpack://@affine/web/../../common/infra/src/livedata/react.ts","webpack://@affine/web/../../common/infra/src/modules/db/entities/db.ts","webpack://@affine/web/../../common/infra/src/modules/db/entities/table.ts","webpack://@affine/web/../../common/infra/src/orm/core/validators/data.ts","webpack://@affine/web/../../common/infra/src/orm/core/validators/yjs.ts","webpack://@affine/web/../../common/infra/src/orm/core/validators/index.ts","webpack://@affine/web/../../common/infra/src/orm/core/validators/schema.ts","webpack://@affine/web/../../common/infra/src/orm/core/table.ts","webpack://@affine/web/../../common/infra/src/orm/core/client.ts","webpack://@affine/web/../../common/infra/src/orm/core/adapters/mixins/hook.ts","webpack://@affine/web/../../common/infra/src/orm/core/adapters/yjs/table.ts","webpack://@affine/web/../../common/infra/src/orm/core/adapters/yjs/db.ts","webpack://@affine/web/../../common/infra/src/orm/core/schema.ts","webpack://@affine/web/../../common/infra/src/modules/db/schema/schema.ts","webpack://@affine/web/../../common/infra/src/modules/db/services/db.ts","webpack://@affine/web/../../common/infra/src/modules/doc/entities/doc.ts","webpack://@affine/web/../../common/infra/src/modules/doc/entities/record-list.ts","webpack://@affine/web/../../common/infra/src/modules/doc/entities/record.ts","webpack://@affine/web/../../common/infra/src/modules/doc/scopes/doc.ts","webpack://@affine/web/../../common/infra/src/modules/doc/services/doc.ts","webpack://@affine/web/../../common/infra/src/modules/doc/services/docs.ts","webpack://@affine/web/../../common/infra/src/modules/global-context/entities/global-context.ts","webpack://@affine/web/../../common/infra/src/modules/global-context/services/global-context.ts","webpack://@affine/web/../../common/infra/src/modules/lifecycle/service/lifecycle.ts","webpack://@affine/web/../../common/infra/src/modules/storage/providers/global.ts","webpack://@affine/web/../../common/infra/src/modules/storage/services/global.ts","webpack://@affine/web/../../common/infra/src/sync/doc/priority-queue.ts","webpack://@affine/web/../../common/infra/src/sync/doc/async-priority-queue.ts","webpack://@affine/web/../../common/infra/src/sync/doc/local.ts","webpack://@affine/web/../../common/infra/src/sync/doc/clock.ts","webpack://@affine/web/../../common/infra/src/sync/doc/remote.ts","webpack://@affine/web/../../common/infra/src/sync/doc/index.ts","webpack://@affine/web/../../common/infra/src/sync/awareness.ts","webpack://@affine/web/../../common/infra/src/modules/workspace/entities/engine.ts","webpack://@affine/web/../../common/infra/src/blocksuite/migration/workspace.ts","webpack://@affine/web/../../common/infra/src/blocksuite/migration/subdoc.ts","webpack://@affine/web/../../common/infra/src/blocksuite/migration/blocksuite.ts","webpack://@affine/web/../../common/infra/src/modules/workspace/entities/upgrade.ts","webpack://@affine/web/../../common/infra/src/modules/workspace/entities/workspace.ts","webpack://@affine/web/../../common/infra/src/modules/workspace/events/index.ts","webpack://@affine/web/../../common/infra/src/modules/workspace/global-schema.ts","webpack://@affine/web/../../common/infra/src/modules/workspace/providers/flavour.ts","webpack://@affine/web/../../common/infra/src/modules/workspace/providers/storage.ts","webpack://@affine/web/../../common/infra/src/modules/workspace/scopes/workspace.ts","webpack://@affine/web/../../common/infra/src/modules/workspace/services/engine.ts","webpack://@affine/web/../../common/infra/src/modules/workspace/services/upgrade.ts","webpack://@affine/web/../../common/infra/src/modules/workspace/services/workspace.ts","webpack://@affine/web/../../common/infra/src/modules/workspace/services/workspaces.ts","webpack://@affine/web/../../common/infra/src/storage/memento.ts","webpack://@affine/web/../../common/infra/src/sync/blob/blob.ts","webpack://@affine/web/../../common/infra/src/sync/blob/error.ts","webpack://@affine/web/../../common/infra/src/utils/async-lock.ts","webpack://@affine/web/../../common/infra/src/storage/kv.ts","webpack://@affine/web/../../common/infra/src/sync/doc/event.ts","webpack://@affine/web/../../common/infra/src/sync/doc/storage.ts","webpack://@affine/web/../../common/infra/src/sync/doc/utils.ts","webpack://@affine/web/../../common/infra/src/utils/object-pool.ts","webpack://@affine/web/../../common/infra/src/utils/stable-hash.ts","webpack://@affine/web/../../common/infra/src/utils/throw-if-aborted.ts","webpack://@affine/web/../component/src/components/affine-other-page-layout/use-nav-config.ts","webpack://@affine/web/../component/src/components/affine-other-page-layout/desktop-navbar.tsx","webpack://@affine/web/../component/src/components/affine-other-page-layout/index.css.ts","webpack://@affine/web/../component/src/components/affine-other-page-layout/mobile-navbar.tsx","webpack://@affine/web/../component/src/components/affine-other-page-layout/layout.tsx","webpack://@affine/web/../component/src/components/auth-components/share.css.ts","webpack://@affine/web/../component/src/components/auth-components/auth-content.tsx","webpack://@affine/web/../component/src/components/auth-components/auth-input.tsx","webpack://@affine/web/../component/src/components/auth-components/auth-page-container.tsx","webpack://@affine/web/../component/src/components/auth-components/back-button.tsx","webpack://@affine/web/../component/src/components/auth-components/change-email-page.tsx","webpack://@affine/web/../component/src/components/auth-components/password-input/error.tsx","webpack://@affine/web/../component/src/components/auth-components/password-input/style.css.ts","webpack://@affine/web/../component/src/components/auth-components/password-input/success.tsx","webpack://@affine/web/../component/src/components/auth-components/password-input/tag.tsx","webpack://@affine/web/../component/src/components/auth-components/password-input/index.tsx","webpack://@affine/web/../component/src/components/auth-components/set-password.tsx","webpack://@affine/web/../component/src/components/auth-components/change-password-page.tsx","webpack://@affine/web/../component/src/components/auth-components/confirm-change-email.tsx","webpack://@affine/web/../component/src/components/auth-components/count-down-render.tsx","webpack://@affine/web/../component/src/components/auth-components/modal.tsx","webpack://@affine/web/../component/src/components/auth-components/modal-header.tsx","webpack://@affine/web/../component/src/components/auth-components/onboarding-page.css.ts","webpack://@affine/web/../component/src/components/auth-components/onboarding-page.tsx","webpack://@affine/web/../component/src/components/auth-components/set-password-page.tsx","webpack://@affine/web/../component/src/components/auth-components/sign-in-page-container.tsx","webpack://@affine/web/../component/src/components/auth-components/sign-in-success-page.tsx","webpack://@affine/web/../component/src/components/auth-components/sign-up-page.tsx","webpack://@affine/web/../component/src/components/auth-components/utils.ts","webpack://@affine/web/../component/src/components/disable-public-link/index.tsx","webpack://@affine/web/../component/src/components/global-loading/index.jotai.ts","webpack://@affine/web/../component/src/components/global-loading/index.tsx","webpack://@affine/web/../component/src/components/global-loading/index.css.ts","webpack://@affine/web/../component/src/components/page-detail-skeleton/index.tsx","webpack://@affine/web/../component/src/components/page-detail-skeleton/index.css.ts","webpack://@affine/web/../component/src/components/resize-panel/resize-panel.tsx","webpack://@affine/web/../component/src/components/resize-panel/resize-panel.css.ts","webpack://@affine/web/../component/src/components/workspace-avatar/index.tsx","webpack://@affine/web/../component/src/hooks/focus-and-select.ts","webpack://@affine/web/../component/src/lit-react/create-component.ts","webpack://@affine/web/../component/src/lit-react/lit-portal/lite-portal.tsx","webpack://@affine/web/../component/src/lit-react/to-react-node.ts","webpack://@affine/web/../component/src/ui/date-picker/calendar/calendar.css.ts","webpack://@affine/web/../component/src/ui/date-picker/calendar/constants.ts","webpack://@affine/web/../component/src/ui/date-picker/calendar/items.tsx","webpack://@affine/web/../component/src/ui/date-picker/calendar/day-picker.tsx","webpack://@affine/web/../component/src/ui/date-picker/calendar/month-picker.tsx","webpack://@affine/web/../component/src/ui/date-picker/calendar/types.tsx","webpack://@affine/web/../component/src/ui/date-picker/calendar/year-picker.tsx","webpack://@affine/web/../component/src/ui/date-picker/calendar/calendar.tsx","webpack://@affine/web/../component/src/utils/observe-resize.ts","webpack://@affine/web/../component/src/ui/date-picker/week-date-picker.tsx","webpack://@affine/web/../component/src/ui/date-picker/week-date-picker.css.tsx","webpack://@affine/web/../component/src/ui/dnd/draggable.ts","webpack://@affine/web/../component/src/ui/dnd/drop-indicator.css.ts","webpack://@affine/web/../component/src/ui/dnd/drop-indicator.tsx","webpack://@affine/web/../component/src/ui/dnd/drop-target.ts","webpack://@affine/web/../component/src/ui/editable/inline-edit.tsx","webpack://@affine/web/../component/src/ui/editable/inline-edit.css.ts","webpack://@affine/web/../component/src/ui/error-message/style.css.ts","webpack://@affine/web/../component/src/ui/error-message/error-message.tsx","webpack://@affine/web/../component/src/ui/lottie/styles.css.ts","webpack://@affine/web/../component/src/ui/lottie/collections-icon.tsx","webpack://@affine/web/../component/src/ui/lottie/delete-icon.tsx","webpack://@affine/web/../component/src/ui/lottie/folder-icon.tsx","webpack://@affine/web/../component/src/ui/popover/popover.tsx","webpack://@affine/web/../component/src/ui/popover/styles.css.ts","webpack://@affine/web/../component/src/ui/switch/switch.tsx","webpack://@affine/web/../component/src/ui/switch/index.css.ts","webpack://@affine/web/../component/src/ui/table/styles.ts","webpack://@affine/web/../component/src/ui/toast/toast.ts","webpack://@affine/web/../component/src/styles/helper.ts","webpack://@affine/web/../component/src/ui/avatar/style.css.ts","webpack://@affine/web/../component/src/ui/avatar/colorful-fallback.tsx","webpack://@affine/web/../component/src/ui/avatar/avatar.tsx","webpack://@affine/web/../component/src/ui/button/button.tsx","webpack://@affine/web/../component/src/ui/button/button.css.ts","webpack://@affine/web/../component/src/ui/button/dropdown-button.tsx","webpack://@affine/web/../component/src/ui/button/styles.css.ts","webpack://@affine/web/../component/src/ui/button/icon-button.tsx","webpack://@affine/web/../component/src/ui/button/radio.tsx","webpack://@affine/web/../component/src/ui/checkbox/icons.tsx","webpack://@affine/web/../component/src/ui/checkbox/checkbox.tsx","webpack://@affine/web/../component/src/ui/checkbox/index.css.ts","webpack://@affine/web/../component/src/ui/divider/divider.tsx","webpack://@affine/web/../component/src/ui/divider/style.css.ts","webpack://@affine/web/../component/src/ui/empty/empty-svg.tsx","webpack://@affine/web/../component/src/ui/empty/empty.tsx","webpack://@affine/web/../component/src/ui/empty/index.css.ts","webpack://@affine/web/../component/src/ui/input/input.tsx","webpack://@affine/web/../component/src/ui/input/style.css.ts","webpack://@affine/web/../component/src/ui/input/index.ts","webpack://@affine/web/../component/src/ui/layout/content.tsx","webpack://@affine/web/../component/src/ui/layout/wrapper.tsx","webpack://@affine/web/../component/src/ui/loading/loading.tsx","webpack://@affine/web/../component/src/ui/loading/styles.css.ts","webpack://@affine/web/../component/src/ui/menu/styles.css.ts","webpack://@affine/web/../component/src/ui/menu/menu.tsx","webpack://@affine/web/../component/src/ui/menu/menu-icon.tsx","webpack://@affine/web/../component/src/ui/menu/use-menu-item.tsx","webpack://@affine/web/../component/src/ui/menu/menu-item.tsx","webpack://@affine/web/../component/src/ui/menu/menu-separator.tsx","webpack://@affine/web/../component/src/ui/menu/menu-sub.tsx","webpack://@affine/web/../component/src/ui/menu/menu-trigger.tsx","webpack://@affine/web/../component/src/ui/modal/modal.tsx","webpack://@affine/web/../component/src/ui/modal/styles.css.ts","webpack://@affine/web/../component/src/ui/modal/confirm-modal.tsx","webpack://@affine/web/../component/src/ui/modal/overlay-modal.tsx","webpack://@affine/web/../component/src/ui/modal/overlay-modal.css.ts","webpack://@affine/web/../component/src/ui/notification/styles.css.ts","webpack://@affine/web/../component/src/ui/notification/utils.ts","webpack://@affine/web/../component/src/ui/notification/notification-card.tsx","webpack://@affine/web/../component/src/ui/notification/notification-center.tsx","webpack://@affine/web/../component/src/ui/radio/radio.tsx","webpack://@affine/web/../component/src/ui/radio/styles.css.ts","webpack://@affine/web/../component/src/ui/scrollbar/index.css.ts","webpack://@affine/web/../component/src/ui/scrollbar/scrollable.tsx","webpack://@affine/web/../component/src/ui/scrollbar/use-has-scroll-top.tsx","webpack://@affine/web/../component/src/ui/scrollbar/scrollbar.tsx","webpack://@affine/web/../component/src/ui/skeleton/index.css.ts","webpack://@affine/web/../component/src/ui/skeleton/skeleton.tsx","webpack://@affine/web/../component/src/utils/keyboard-mapping.ts","webpack://@affine/web/../component/src/utils/platform.ts","webpack://@affine/web/../component/src/ui/tooltip/tooltip.tsx","webpack://@affine/web/../component/src/ui/tooltip/styles.css.ts","webpack://@affine/web/../component/src/utils/with-unit.ts","webpack://@affine/web/../core/src/atoms/index.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/messages/text.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/_common/components/ask-ai-panel.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/_common/components/ask-ai-button.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/messages/slides-renderer.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/messages/wrapper.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/chat-panel/chat-panel-input.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/chat-panel/ai-loading.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/chat-panel/actions/action-wrapper.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/chat-panel/actions/text.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/chat-panel/actions/make-real.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/chat-panel/actions/slides.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/chat-panel/actions/mindmap.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/chat-panel/actions/chat-text.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/chat-panel/actions/image-to-text.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/chat-panel/actions/image.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/chat-panel/chat-cards.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/_common/components/chat-action-list.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/_common/components/copy-more.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/messages/error.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/chat-panel/chat-panel-messages.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/chat-panel/index.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/peek-view/chat-block-input.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/peek-view/date-time.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/peek-view/chat-block-peek-view.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/_common/icons.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/actions/consts.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/utils/custom-specs.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/utils/markdown-utils.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/provider.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/utils/action-reporter.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/utils/edgeless.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/utils/editor-actions.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/utils/selection-utils.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/ai-panel.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/actions/doc-handler.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/messages/mindmap.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/_common/markdown-utils.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/_common/selection-utils.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/slides/template.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/slides/index.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/utils/html.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/utils/image.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/actions/edgeless-response.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/actions/edgeless-handler.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/actions/types.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/_common/config.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/entries/code-toolbar/setup-code-toolbar.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/entries/edgeless/actions-config.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/entries/format-bar/setup-format-bar.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/entries/edgeless/index.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/entries/image-toolbar/setup-image-toolbar.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/entries/slash-menu/setup-slash-menu.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/entries/space/setup-space.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/ai-spec.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/chat-panel/components/images.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/chat-panel/const.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/_common/chat-actions-handle.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/chat-panel/preload-config.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/peek-view/styles.ts","webpack://@affine/web/../core/src/blocksuite/presets/ai/peek-view/utils.ts","webpack://@affine/web/../templates/edgeless-templates.gen.ts","webpack://@affine/web/../templates/stickers-templates.gen.ts","webpack://@affine/web/../core/src/bootstrap/edgeless-template.ts","webpack://@affine/web/../core/src/bootstrap/preload.ts","webpack://@affine/web/../core/src/commands/registry/command.ts","webpack://@affine/web/../core/src/commands/registry/registry.ts","webpack://@affine/web/../core/src/commands/affine-creation.tsx","webpack://@affine/web/../core/src/commands/affine-help.tsx","webpack://@affine/web/../core/src/commands/affine-layout.tsx","webpack://@affine/web/../core/src/commands/affine-navigation.tsx","webpack://@affine/web/../core/src/commands/affine-settings.tsx","webpack://@affine/web/../core/src/commands/affine-updates.tsx","webpack://@affine/web/../core/src/components/affine/affine-error-boundary/error-basic/fallback-creator.tsx","webpack://@affine/web/../core/src/components/affine/affine-error-boundary/error-basic/info-logger.tsx","webpack://@affine/web/../core/src/components/affine/affine-error-boundary/error-basic/error-detail.tsx","webpack://@affine/web/../core/src/components/affine/affine-error-boundary/error-basic/error-detail.css.ts","webpack://@affine/web/../core/src/components/affine/affine-error-boundary/error-fallbacks/any-error-fallback.tsx","webpack://@affine/web/../core/src/components/affine/affine-error-boundary/error-fallbacks/no-page-root-fallback.tsx","webpack://@affine/web/../core/src/components/affine/affine-error-boundary/error-fallbacks/page-not-found-fallback.tsx","webpack://@affine/web/../core/src/components/affine/affine-error-boundary/affine-error-fallback.tsx","webpack://@affine/web/../core/src/components/affine/affine-error-boundary/error-fallbacks/recoverable-error-fallback.tsx","webpack://@affine/web/../core/src/unexpected-application-state/errors.ts","webpack://@affine/web/../core/src/components/affine/affine-error-boundary/affine-error-fallback.css.ts","webpack://@affine/web/../core/src/components/affine/affine-error-boundary/index.tsx","webpack://@affine/web/../core/src/components/affine/app-container.tsx","webpack://@affine/web/../core/src/components/affine/auth/ai-login-required.tsx","webpack://@affine/web/../core/src/components/affine/auth/use-captcha.tsx","webpack://@affine/web/../core/src/components/affine/auth/send-email.tsx","webpack://@affine/web/../core/src/utils/email-regex.ts","webpack://@affine/web/../core/src/components/affine/auth/oauth.tsx","webpack://@affine/web/../core/src/components/affine/auth/index.tsx","webpack://@affine/web/../core/src/components/affine/auth/sign-in.tsx","webpack://@affine/web/../core/src/components/affine/auth/after-sign-up-send-email.tsx","webpack://@affine/web/../core/src/components/affine/auth/after-sign-in-send-email.tsx","webpack://@affine/web/../core/src/components/affine/auth/sign-in-with-password.tsx","webpack://@affine/web/../core/src/components/affine/auth/user-plan-button.tsx","webpack://@affine/web/../core/src/components/affine/page-properties/confirm-delete-property-modal.tsx","webpack://@affine/web/../core/src/components/affine/page-properties/icons-mapping.tsx","webpack://@affine/web/../core/src/components/affine/page-properties/common.ts","webpack://@affine/web/../core/src/components/affine/page-properties/tags-inline-editor.css.ts","webpack://@affine/web/../core/src/components/affine/page-properties/tags-inline-editor.tsx","webpack://@affine/web/../core/src/components/affine/page-properties/property-row-value-renderer.tsx","webpack://@affine/web/../core/src/components/affine/page-properties/table.tsx","webpack://@affine/web/../core/src/components/affine/page-properties/info-modal/back-links-row.tsx","webpack://@affine/web/../core/src/components/affine/page-properties/info-modal/back-links-row.css.ts","webpack://@affine/web/../core/src/components/affine/page-properties/info-modal/tags-row.tsx","webpack://@affine/web/../core/src/components/affine/page-properties/info-modal/tags-row.css.ts","webpack://@affine/web/../core/src/components/affine/page-properties/info-modal/time-row.tsx","webpack://@affine/web/../core/src/components/affine/page-properties/info-modal/time-row.css.ts","webpack://@affine/web/../core/src/components/affine/page-properties/info-modal/info-modal.tsx","webpack://@affine/web/../core/src/components/affine/page-properties/info-modal/info-modal.css.ts","webpack://@affine/web/../core/src/components/affine/page-properties/icons-selector.tsx","webpack://@affine/web/../core/src/components/affine/page-properties/icons-selector.css.ts","webpack://@affine/web/../core/src/components/affine/page-properties/menu-items.tsx","webpack://@affine/web/../core/src/components/affine/page-properties/page-properties-manager.ts","webpack://@affine/web/../core/src/components/affine/reference-link/styles.css.ts","webpack://@affine/web/../core/src/components/affine/reference-link/index.tsx","webpack://@affine/web/../core/src/components/affine/sign-out-modal/index.tsx","webpack://@affine/web/../core/src/components/app-sidebar/index.jotai.ts","webpack://@affine/web/../core/src/components/app-sidebar/index.css.ts","webpack://@affine/web/../core/src/components/app-sidebar/sidebar-header/index.tsx","webpack://@affine/web/../core/src/components/app-sidebar/add-page-button/index.tsx","webpack://@affine/web/../core/src/components/app-sidebar/add-page-button/index.css.ts","webpack://@affine/web/../core/src/components/app-sidebar/app-updater-button/index.tsx","webpack://@affine/web/../core/src/components/app-sidebar/category-divider/index.tsx","webpack://@affine/web/../core/src/components/app-sidebar/category-divider/index.css.ts","webpack://@affine/web/../core/src/components/app-sidebar/menu-item/index.tsx","webpack://@affine/web/../core/src/components/app-sidebar/menu-item/index.css.ts","webpack://@affine/web/../core/src/components/app-sidebar/spolight/index.tsx","webpack://@affine/web/../core/src/components/app-sidebar/spolight/index.css.ts","webpack://@affine/web/../core/src/components/app-sidebar/quick-search-input/index.tsx","webpack://@affine/web/../core/src/components/app-sidebar/quick-search-input/index.css.ts","webpack://@affine/web/../core/src/components/app-sidebar/sidebar-containers/index.tsx","webpack://@affine/web/../core/src/components/app-sidebar/sidebar-containers/index.css.ts","webpack://@affine/web/../core/src/components/app-sidebar/index.tsx","webpack://@affine/web/../core/src/components/app-sidebar/fallback.css.ts","webpack://@affine/web/../core/src/components/app-sidebar/sidebar-header/sidebar-switch.tsx","webpack://@affine/web/../core/src/components/app-sidebar/sidebar-header/sidebar-switch.css.ts","webpack://@affine/web/../core/src/components/blocksuite/block-suite-editor/specs/preview.ts","webpack://@affine/web/../core/src/components/blocksuite/block-suite-editor/specs/custom/spec-patchers.tsx","webpack://@affine/web/../core/src/components/blocksuite/block-suite-editor/bi-directional-link-panel.css.ts","webpack://@affine/web/../core/src/components/blocksuite/block-suite-editor/bi-directional-link-panel.tsx","webpack://@affine/web/../core/src/components/blocksuite/block-suite-editor/journal-doc-title.tsx","webpack://@affine/web/../core/src/components/blocksuite/block-suite-editor/styles.css.ts","webpack://@affine/web/../core/src/components/blocksuite/block-suite-editor/specs/custom/attachment-block.ts","webpack://@affine/web/../core/src/components/blocksuite/block-suite-editor/specs/common.ts","webpack://@affine/web/../core/src/components/blocksuite/block-suite-editor/specs/custom/linked-widget.ts","webpack://@affine/web/../core/src/components/blocksuite/block-suite-editor/specs/custom/root-block.ts","webpack://@affine/web/../core/src/components/blocksuite/block-suite-editor/lit-adaper.tsx","webpack://@affine/web/../core/src/components/blocksuite/block-suite-editor/specs/edgeless.ts","webpack://@affine/web/../core/src/components/blocksuite/block-suite-editor/specs/page.ts","webpack://@affine/web/../core/src/components/blocksuite/block-suite-editor/blocksuite-editor-container.tsx","webpack://@affine/web/../core/src/components/blocksuite/block-suite-editor/blocksuite-editor.tsx","webpack://@affine/web/../core/src/components/affine/ai-onboarding/type.ts","webpack://@affine/web/../core/src/components/affine/ai-onboarding/apis.ts","webpack://@affine/web/../core/src/components/blocksuite/block-suite-editor/ai/copilot-client.ts","webpack://@affine/web/../core/src/components/blocksuite/block-suite-editor/ai/event-source.ts","webpack://@affine/web/../core/src/components/blocksuite/block-suite-editor/ai/request.ts","webpack://@affine/web/../core/src/components/blocksuite/block-suite-editor/ai/tracker.ts","webpack://@affine/web/../core/src/components/blocksuite/block-suite-editor/ai/setup-provider.tsx","webpack://@affine/web/../core/src/components/blocksuite/block-suite-editor/no-page-error.ts","webpack://@affine/web/../core/src/components/blocksuite/block-suite-header/title/index.tsx","webpack://@affine/web/../core/src/components/blocksuite/block-suite-header/title/style.css.ts","webpack://@affine/web/../core/src/components/blocksuite/block-suite-page-list/utils.tsx","webpack://@affine/web/../core/src/components/blocksuite/outline-viewer/index.tsx","webpack://@affine/web/../core/src/components/blocksuite/outline-viewer/outline-viewer.css.ts","webpack://@affine/web/../core/src/components/page-list/collections/collection-list-item.css.ts","webpack://@affine/web/../core/src/components/page-list/collections/collection-list-item.tsx","webpack://@affine/web/../core/src/components/page-list/collections/collection-list-header.tsx","webpack://@affine/web/../core/src/components/page-list/collections/collection-list-header.css.ts","webpack://@affine/web/../core/src/components/page-list/collections/select-collection.tsx","webpack://@affine/web/../core/src/components/page-list/collections/virtualized-collection-list.tsx","webpack://@affine/web/../core/src/components/page-list/components/favorite-tag.tsx","webpack://@affine/web/../core/src/components/page-list/components/floating-toolbar.tsx","webpack://@affine/web/../core/src/components/page-list/components/floating-toolbar.css.ts","webpack://@affine/web/../core/src/components/page-list/components/list-floating-toolbar.tsx","webpack://@affine/web/../core/src/components/page-list/components/list-floating-toolbar.css.ts","webpack://@affine/web/../core/src/components/page-list/docs/page-list-item.css.ts","webpack://@affine/web/../core/src/components/page-list/docs/page-list-item.tsx","webpack://@affine/web/../core/src/components/page-list/docs/page-tags.css.ts","webpack://@affine/web/../core/src/components/page-list/docs/page-tags.tsx","webpack://@affine/web/../core/src/components/page-list/filter/filter-tag-translation.tsx","webpack://@affine/web/../core/src/components/page-list/filter/eval.ts","webpack://@affine/web/../core/src/components/page-list/filter/date-select.tsx","webpack://@affine/web/../core/src/components/page-list/filter/date-select.css.ts","webpack://@affine/web/../core/src/components/page-list/filter/multi-select.css.ts","webpack://@affine/web/../core/src/components/page-list/filter/multi-select.tsx","webpack://@affine/web/../core/src/components/page-list/filter/literal-matcher.tsx","webpack://@affine/web/../core/src/components/page-list/filter/condition.tsx","webpack://@affine/web/../core/src/components/page-list/filter/filter-list.tsx","webpack://@affine/web/../core/src/components/page-list/filter/logical/custom-type.ts","webpack://@affine/web/../core/src/components/page-list/filter/logical/matcher.ts","webpack://@affine/web/../core/src/components/page-list/filter/logical/typesystem.ts","webpack://@affine/web/../core/src/components/page-list/filter/shared-types.tsx","webpack://@affine/web/../core/src/components/page-list/filter/vars.tsx","webpack://@affine/web/../core/src/components/page-list/header-col-def.tsx","webpack://@affine/web/../component/src/components/card/block-card/styles.css.ts","webpack://@affine/web/../component/src/components/card/block-card/index.tsx","webpack://@affine/web/../core/src/components/page-list/components/new-page-button.tsx","webpack://@affine/web/../core/src/components/page-list/components/new-page-button.css.ts","webpack://@affine/web/../core/src/components/page-list/components/page-display-menu.tsx","webpack://@affine/web/../core/src/components/page-list/components/page-display-menu.css.ts","webpack://@affine/web/../core/src/components/page-list/filter/utils.ts","webpack://@affine/web/../core/src/components/page-list/docs/page-list-header.css.ts","webpack://@affine/web/../core/src/components/page-list/docs/page-list-new-page-button.tsx","webpack://@affine/web/../core/src/components/page-list/docs/page-list-new-page-button.css.ts","webpack://@affine/web/../core/src/components/page-list/docs/page-list-header.tsx","webpack://@affine/web/../core/src/components/page-list/group-definitions.tsx","webpack://@affine/web/../core/src/components/page-list/group-definitions.css.ts","webpack://@affine/web/../core/src/components/page-list/use-filtered-page-metas.tsx","webpack://@affine/web/../core/src/components/page-list/docs/virtualized-page-list.tsx","webpack://@affine/web/../core/src/components/page-list/virtualized-trash-list.tsx","webpack://@affine/web/../core/src/components/page-list/list.tsx","webpack://@affine/web/../core/src/components/page-list/operation-cell.tsx","webpack://@affine/web/../core/src/components/page-list/operation-menu-items/disable-public-sharing.tsx","webpack://@affine/web/../core/src/components/page-list/operation-menu-items/index.css.ts","webpack://@affine/web/../core/src/components/page-list/operation-menu-items/export.tsx","webpack://@affine/web/../core/src/components/page-list/operation-menu-items/move-to-trash.tsx","webpack://@affine/web/../core/src/components/page-list/use-block-suite-page-preview.ts","webpack://@affine/web/../core/src/components/page-list/use-block-suite-workspace-page.ts","webpack://@affine/web/../core/src/components/page-list/page-content-preview.tsx","webpack://@affine/web/../core/src/components/page-list/page-group.css.ts","webpack://@affine/web/../core/src/components/page-list/page-group.tsx","webpack://@affine/web/../core/src/components/page-list/components/list-header-cell.tsx","webpack://@affine/web/../core/src/components/page-list/components/list-header-cell.css.ts","webpack://@affine/web/../core/src/components/page-list/page-header.tsx","webpack://@affine/web/../core/src/components/page-list/page-header.css.ts","webpack://@affine/web/../core/src/components/page-list/scoped-atoms.tsx","webpack://@affine/web/../core/src/components/page-list/items-to-item-group.tsx","webpack://@affine/web/../core/src/components/page-list/selector/selector-layout.css.ts","webpack://@affine/web/../core/src/components/page-list/selector/selector-layout.tsx","webpack://@affine/web/../core/src/components/page-list/tags/create-tag.tsx","webpack://@affine/web/../core/src/components/page-list/tags/create-tag.css.ts","webpack://@affine/web/../core/src/components/page-list/tags/select-tag.tsx","webpack://@affine/web/../core/src/components/page-list/tags/tag-list-header.tsx","webpack://@affine/web/../core/src/components/page-list/tags/tag-list-header.css.ts","webpack://@affine/web/../core/src/components/page-list/tags/virtualized-tag-list.tsx","webpack://@affine/web/../core/src/components/page-list/tags/tag-list-item.css.ts","webpack://@affine/web/../core/src/components/page-list/tags/tag-list-item.tsx","webpack://@affine/web/../core/src/components/page-list/use-all-doc-display-properties.ts","webpack://@affine/web/../core/src/components/page-list/use-collection-manager.ts","webpack://@affine/web/../core/src/components/page-list/utils.tsx","webpack://@affine/web/../core/src/components/page-list/view/affine-shape.tsx","webpack://@affine/web/../core/src/components/page-list/view/create-collection.tsx","webpack://@affine/web/../core/src/components/page-list/view/create-collection.css.ts","webpack://@affine/web/../core/src/hooks/affine/use-all-page-list-config.tsx","webpack://@affine/web/../core/src/components/page-list/view/edit-collection/rules-mode.tsx","webpack://@affine/web/../core/src/components/page-list/view/edit-collection/edit-collection.tsx","webpack://@affine/web/../core/src/components/page-list/view/edit-collection/use-filter.tsx","webpack://@affine/web/../core/src/components/page-list/view/edit-collection/use-search.tsx","webpack://@affine/web/../core/src/components/page-list/view/edit-collection/select-page.tsx","webpack://@affine/web/../core/src/components/page-list/view/collection-list.tsx","webpack://@affine/web/../core/src/components/page-list/view/collection-list.css.ts","webpack://@affine/web/../core/src/components/page-list/view/save-as-collection-button.tsx","webpack://@affine/web/../core/src/components/page-list/view/save-as-collection-button.css.ts","webpack://@affine/web/../core/src/components/page-list/view/use-edit-collection.tsx","webpack://@affine/web/../core/src/components/page-list/virtualized-list.tsx","webpack://@affine/web/../core/src/components/pure/workspace-slider-bar/user-with-workspace-list/add-workspace/index.css.ts","webpack://@affine/web/../core/src/components/pure/workspace-slider-bar/user-with-workspace-list/add-workspace/index.tsx","webpack://@affine/web/../core/src/components/pure/workspace-slider-bar/user-with-workspace-list/user-account/index.tsx","webpack://@affine/web/../core/src/components/pure/workspace-slider-bar/user-with-workspace-list/user-account/index.css.ts","webpack://@affine/web/../component/src/components/card/workspace-card/styles.css.ts","webpack://@affine/web/../component/src/components/card/workspace-card/index.tsx","webpack://@affine/web/../component/src/components/workspace-list/index.tsx","webpack://@affine/web/../component/src/components/workspace-list/index.css.ts","webpack://@affine/web/../core/src/components/pure/workspace-slider-bar/user-with-workspace-list/workspace-list/index.css.ts","webpack://@affine/web/../core/src/components/pure/workspace-slider-bar/user-with-workspace-list/workspace-list/index.tsx","webpack://@affine/web/../core/src/components/pure/workspace-slider-bar/user-with-workspace-list/index.tsx","webpack://@affine/web/../core/src/components/pure/workspace-slider-bar/user-with-workspace-list/index.css.ts","webpack://@affine/web/../core/src/hooks/affine/use-doc-engine-status.tsx","webpack://@affine/web/../core/src/components/pure/workspace-slider-bar/workspace-card/styles.css.ts","webpack://@affine/web/../core/src/components/pure/workspace-slider-bar/workspace-card/index.tsx","webpack://@affine/web/../core/src/components/workspace-selector/index.tsx","webpack://@affine/web/../core/src/components/workspace/index.css.ts","webpack://@affine/web/../core/src/components/workspace/index.tsx","webpack://@affine/web/../core/src/hooks/affine-async-hooks.ts","webpack://@affine/web/../core/src/hooks/affine/use-app-setting-helper.ts","webpack://@affine/web/../core/src/hooks/affine/use-block-suite-meta-helper.ts","webpack://@affine/web/../core/src/hooks/affine/use-delete-collection-info.ts","webpack://@affine/web/../core/src/hooks/affine/use-enable-cloud.tsx","webpack://@affine/web/../core/src/atoms/trash-modal.ts","webpack://@affine/web/../core/src/hooks/affine/use-trash-modal-helper.ts","webpack://@affine/web/../core/src/hooks/use-affine-adapter.ts","webpack://@affine/web/../core/src/hooks/use-app-updater.ts","webpack://@affine/web/../core/src/hooks/use-all-block-suite-page-meta.ts","webpack://@affine/web/../core/src/hooks/use-block-suite-page-meta.ts","webpack://@affine/web/../core/src/hooks/use-block-suite-workspace-helper.ts","webpack://@affine/web/../core/src/hooks/use-catch-event-hook.ts","webpack://@affine/web/../core/src/hooks/use-journal.ts","webpack://@affine/web/../core/src/hooks/use-mutation.ts","webpack://@affine/web/../core/src/hooks/use-navigate-helper.ts","webpack://@affine/web/../core/src/hooks/use-system-online.ts","webpack://@affine/web/../core/src/hooks/use-workspace-info.ts","webpack://@affine/web/../core/src/mixpanel/auto.ts","webpack://@affine/web/../core/src/mixpanel/mixpanel.ts","webpack://@affine/web/../core/src/mixpanel/index.ts","webpack://@affine/web/../core/src/modules/cloud/entities/session.ts","webpack://@affine/web/../core/src/modules/cloud/entities/user-feature.ts","webpack://@affine/web/../core/src/modules/cloud/entities/user-quota.ts","webpack://@affine/web/../core/src/modules/cloud/error.ts","webpack://@affine/web/../core/src/modules/cloud/services/server-config.ts","webpack://@affine/web/../core/src/modules/cloud/services/subscription.ts","webpack://@affine/web/../core/src/modules/cloud/services/user-copilot-quota.ts","webpack://@affine/web/../core/src/modules/cloud/services/websocket.ts","webpack://@affine/web/../core/src/modules/cloud/services/graphql.ts","webpack://@affine/web/../core/src/modules/cloud/entities/server-config.ts","webpack://@affine/web/../core/src/modules/cloud/entities/subscription.ts","webpack://@affine/web/../core/src/modules/cloud/entities/subscription-prices.ts","webpack://@affine/web/../core/src/modules/cloud/entities/user-copilot-quota.ts","webpack://@affine/web/../core/src/modules/cloud/stores/auth.ts","webpack://@affine/web/../core/src/modules/cloud/stores/server-config.ts","webpack://@affine/web/../core/src/modules/cloud/stores/subscription.ts","webpack://@affine/web/../core/src/modules/cloud/stores/user-copilot-quota.ts","webpack://@affine/web/../core/src/modules/cloud/stores/user-feature.ts","webpack://@affine/web/../core/src/modules/cloud/stores/user-quota.ts","webpack://@affine/web/../core/src/modules/cloud/index.ts","webpack://@affine/web/../core/src/modules/cloud/services/auth.ts","webpack://@affine/web/../core/src/modules/cloud/services/fetch.ts","webpack://@affine/web/../core/src/modules/cloud/services/user-feature.ts","webpack://@affine/web/../core/src/modules/cloud/services/user-quota.ts","webpack://@affine/web/../core/src/modules/collection/services/collection.ts","webpack://@affine/web/../core/src/modules/collection/index.ts","webpack://@affine/web/../core/src/modules/doc-link/entities/doc-backlinks.ts","webpack://@affine/web/../core/src/modules/doc-link/entities/doc-links.ts","webpack://@affine/web/../core/src/modules/doc-link/services/doc-links.ts","webpack://@affine/web/../core/src/modules/doc-link/index.ts","webpack://@affine/web/../core/src/modules/docs-search/services/docs-search.ts","webpack://@affine/web/../../common/infra/src/utils/exhaustmap-with-trailing.ts","webpack://@affine/web/../../common/infra/src/sync/job/impl/indexeddb/index.ts","webpack://@affine/web/../../common/infra/src/sync/job/runner.ts","webpack://@affine/web/../../common/infra/src/sync/indexer/impl/indexeddb/bm25.ts","webpack://@affine/web/../../common/infra/src/sync/indexer/impl/indexeddb/match.ts","webpack://@affine/web/../../common/infra/src/sync/indexer/impl/indexeddb/tokenizer.ts","webpack://@affine/web/../../common/infra/src/sync/indexer/impl/indexeddb/inverted-index.ts","webpack://@affine/web/../../common/infra/src/sync/indexer/impl/indexeddb/data-struct.ts","webpack://@affine/web/../../common/infra/src/sync/indexer/impl/indexeddb/highlighter.ts","webpack://@affine/web/../../common/infra/src/sync/indexer/impl/indexeddb/index.ts","webpack://@affine/web/../core/src/modules/docs-search/schema.ts","webpack://@affine/web/../core/src/modules/docs-search/worker/out-worker.ts","webpack://@affine/web/../core/src/modules/docs-search/entities/docs-indexer.ts","webpack://@affine/web/../core/src/modules/docs-search/index.ts","webpack://@affine/web/../core/src/modules/explorer/entities/explore-section.ts","webpack://@affine/web/../core/src/modules/explorer/views/nodes/collection/empty.tsx","webpack://@affine/web/../core/src/modules/explorer/views/nodes/collection/operations.tsx","webpack://@affine/web/../core/src/modules/explorer/views/nodes/collection/index.tsx","webpack://@affine/web/../core/src/modules/explorer/views/sections/collections/empty.tsx","webpack://@affine/web/../core/src/modules/explorer/views/sections/collections/index.tsx","webpack://@affine/web/../core/src/components/page-list/selector/use-select-dialog.tsx","webpack://@affine/web/../core/src/components/page-list/selector/index.ts","webpack://@affine/web/../core/src/modules/explorer/views/nodes/folder/empty.tsx","webpack://@affine/web/../core/src/modules/explorer/views/nodes/folder/empty.css.ts","webpack://@affine/web/../core/src/modules/explorer/views/nodes/folder/operations.tsx","webpack://@affine/web/../core/src/modules/explorer/views/nodes/folder/index.tsx","webpack://@affine/web/../core/src/modules/explorer/views/sections/favorites/dnd.ts","webpack://@affine/web/../core/src/modules/explorer/views/sections/favorites/empty.tsx","webpack://@affine/web/../core/src/modules/explorer/views/sections/favorites/index.tsx","webpack://@affine/web/../core/src/modules/explorer/views/sections/migration-favorites/styles.css.ts","webpack://@affine/web/../core/src/modules/explorer/views/sections/migration-favorites/index.tsx","webpack://@affine/web/../core/src/modules/organize/constants.ts","webpack://@affine/web/../core/src/modules/explorer/views/sections/organize/dnd.ts","webpack://@affine/web/../core/src/modules/explorer/views/sections/organize/empty.tsx","webpack://@affine/web/../core/src/modules/explorer/views/sections/organize/index.tsx","webpack://@affine/web/../core/src/modules/explorer/index.ts","webpack://@affine/web/../core/src/modules/explorer/services/explorer.ts","webpack://@affine/web/../core/src/modules/explorer/views/layouts/collapsible-section.tsx","webpack://@affine/web/../core/src/modules/explorer/views/layouts/collapsible-section.css.ts","webpack://@affine/web/../core/src/modules/explorer/views/layouts/empty-node-children.tsx","webpack://@affine/web/../core/src/modules/explorer/views/layouts/empty-node-children.css.ts","webpack://@affine/web/../core/src/modules/explorer/views/layouts/empty-section.css.ts","webpack://@affine/web/../core/src/modules/explorer/views/layouts/empty-section.tsx","webpack://@affine/web/../core/src/modules/explorer/views/nodes/doc/empty.tsx","webpack://@affine/web/../core/src/modules/explorer/views/nodes/doc/operations.tsx","webpack://@affine/web/../core/src/modules/explorer/views/nodes/doc/index.tsx","webpack://@affine/web/../core/src/modules/explorer/views/nodes/doc/styles.css.ts","webpack://@affine/web/../core/src/modules/explorer/views/nodes/tag/empty.tsx","webpack://@affine/web/../core/src/modules/explorer/views/nodes/tag/operations.tsx","webpack://@affine/web/../core/src/modules/explorer/views/nodes/tag/index.tsx","webpack://@affine/web/../core/src/modules/explorer/views/nodes/tag/styles.css.ts","webpack://@affine/web/../core/src/modules/explorer/views/tree/drop-effect.css.ts","webpack://@affine/web/../core/src/modules/explorer/views/tree/drop-effect.tsx","webpack://@affine/web/../component/src/components/rename-modal/index.tsx","webpack://@affine/web/../core/src/modules/explorer/views/tree/context.tsx","webpack://@affine/web/../core/src/modules/explorer/views/tree/node.tsx","webpack://@affine/web/../core/src/modules/explorer/views/tree/node.css.ts","webpack://@affine/web/../core/src/modules/explorer/views/tree/root.tsx","webpack://@affine/web/../core/src/modules/explorer/views/tree/root.css.ts","webpack://@affine/web/../core/src/modules/favorite/entities/favorite-list.ts","webpack://@affine/web/../core/src/modules/favorite/services/favorite.ts","webpack://@affine/web/../core/src/modules/favorite/constant.ts","webpack://@affine/web/../core/src/modules/favorite/stores/favorite.ts","webpack://@affine/web/../core/src/modules/favorite/index.ts","webpack://@affine/web/../core/src/modules/find-in-page/entities/find-in-page.ts","webpack://@affine/web/../core/src/modules/find-in-page/services/find-in-page.ts","webpack://@affine/web/../core/src/modules/navigation/entities/navigator.ts","webpack://@affine/web/../core/src/modules/navigation/utils.ts","webpack://@affine/web/../core/src/modules/navigation/view/navigation-buttons.css.ts","webpack://@affine/web/../core/src/modules/navigation/view/navigation-buttons.tsx","webpack://@affine/web/../core/src/modules/navigation/index.ts","webpack://@affine/web/../core/src/modules/navigation/services/navigator.ts","webpack://@affine/web/../core/src/modules/organize/entities/folder-node.ts","webpack://@affine/web/../core/src/modules/organize/entities/folder-tree.ts","webpack://@affine/web/../core/src/modules/organize/services/organize.ts","webpack://@affine/web/../core/src/modules/organize/stores/folder.ts","webpack://@affine/web/../core/src/modules/organize/index.ts","webpack://@affine/web/../core/src/modules/peek-view/services/peek-view.ts","webpack://@affine/web/../core/src/modules/peek-view/entities/peek-view.ts","webpack://@affine/web/../core/src/modules/peek-view/view/modal-container.tsx","webpack://@affine/web/../core/src/modules/peek-view/view/modal-container.css.ts","webpack://@affine/web/../core/src/modules/peek-view/view/utils.ts","webpack://@affine/web/../core/src/modules/peek-view/view/doc-preview/doc-peek-view.tsx","webpack://@affine/web/../core/src/modules/peek-view/view/doc-preview/doc-peek-view.css.ts","webpack://@affine/web/../core/src/modules/peek-view/view/image-preview/hooks/use-zoom.tsx","webpack://@affine/web/../core/src/modules/peek-view/view/image-preview/index.css.ts","webpack://@affine/web/../core/src/modules/peek-view/view/image-preview/index.tsx","webpack://@affine/web/../core/src/modules/peek-view/view/peek-view-controls.css.ts","webpack://@affine/web/../core/src/modules/peek-view/view/peek-view-controls.tsx","webpack://@affine/web/../core/src/modules/peek-view/view/peek-view-manager.tsx","webpack://@affine/web/../core/src/modules/peek-view/index.ts","webpack://@affine/web/../core/src/modules/permissions/entities/permission.ts","webpack://@affine/web/../core/src/modules/permissions/services/permission.ts","webpack://@affine/web/../core/src/modules/permissions/stores/permission.ts","webpack://@affine/web/../core/src/modules/permissions/index.ts","webpack://@affine/web/../core/src/modules/properties/services/adapter.ts","webpack://@affine/web/../core/src/modules/properties/services/legacy-properties.ts","webpack://@affine/web/../core/src/modules/properties/index.ts","webpack://@affine/web/../core/src/modules/properties/services/schema.ts","webpack://@affine/web/../core/src/modules/quicksearch/impls/collections.ts","webpack://@affine/web/../core/src/modules/quicksearch/impls/commands.ts","webpack://@affine/web/../core/src/modules/quicksearch/impls/creation.ts","webpack://@affine/web/../core/src/modules/quicksearch/impls/docs.ts","webpack://@affine/web/../core/src/modules/quicksearch/impls/recent-docs.ts","webpack://@affine/web/../core/src/modules/quicksearch/entities/quick-search.ts","webpack://@affine/web/../core/src/modules/quicksearch/services/doc-display-meta.ts","webpack://@affine/web/../core/src/modules/quicksearch/services/quick-search.ts","webpack://@affine/web/../core/src/modules/quicksearch/services/recent-pages.ts","webpack://@affine/web/../core/src/modules/quicksearch/views/highlight-text.tsx","webpack://@affine/web/../core/src/modules/quicksearch/views/highlight-text.css.ts","webpack://@affine/web/../core/src/modules/quicksearch/views/cmdk.tsx","webpack://@affine/web/../core/src/modules/quicksearch/views/cmdk.css.ts","webpack://@affine/web/../core/src/modules/quicksearch/views/modal.tsx","webpack://@affine/web/../core/src/modules/quicksearch/views/modal.css.ts","webpack://@affine/web/../core/src/modules/quicksearch/views/container.tsx","webpack://@affine/web/../core/src/modules/quicksearch/index.ts","webpack://@affine/web/../core/src/modules/quicksearch/services/cmdk.ts","webpack://@affine/web/../core/src/modules/quicksearch/utils/highlighter.ts","webpack://@affine/web/../core/src/modules/quota/entities/quota.ts","webpack://@affine/web/../core/src/modules/quota/services/quota.ts","webpack://@affine/web/../core/src/modules/quota/stores/quota.ts","webpack://@affine/web/../core/src/modules/quota/index.ts","webpack://@affine/web/../core/src/modules/share-doc/entities/share-info.ts","webpack://@affine/web/../core/src/modules/share-doc/services/share.ts","webpack://@affine/web/../core/src/modules/share-doc/entities/share-docs-list.ts","webpack://@affine/web/../core/src/modules/share-doc/services/share-docs.ts","webpack://@affine/web/../core/src/modules/share-doc/stores/share.ts","webpack://@affine/web/../core/src/modules/share-doc/stores/share-docs.ts","webpack://@affine/web/../core/src/modules/share-doc/index.ts","webpack://@affine/web/../core/src/modules/tag/entities/utils.ts","webpack://@affine/web/../core/src/modules/tag/entities/tag.ts","webpack://@affine/web/../core/src/modules/tag/entities/tag-list.ts","webpack://@affine/web/../core/src/modules/tag/service/tag.ts","webpack://@affine/web/../core/src/modules/tag/view/delete-tag-modal.tsx","webpack://@affine/web/../core/src/modules/tag/stores/tag.ts","webpack://@affine/web/../core/src/modules/tag/index.ts","webpack://@affine/web/../core/src/modules/theme-editor/services/theme-editor.ts","webpack://@affine/web/../core/src/modules/theme-editor/views/custom-theme.tsx","webpack://@affine/web/../core/src/modules/theme-editor/views/components/empty.tsx","webpack://@affine/web/../core/src/modules/theme-editor/views/theme-editor.css.ts","webpack://@affine/web/../core/src/modules/theme-editor/views/components/tree-node.tsx","webpack://@affine/web/../core/src/modules/theme-editor/views/utils.ts","webpack://@affine/web/../core/src/modules/theme-editor/views/components/simple-color-picker.tsx","webpack://@affine/web/../core/src/modules/theme-editor/views/components/simple-color-picker.css.ts","webpack://@affine/web/../core/src/modules/theme-editor/views/components/color-cell.tsx","webpack://@affine/web/../core/src/modules/theme-editor/views/components/string-cell.tsx","webpack://@affine/web/../core/src/modules/theme-editor/views/components/string-cell.css.ts","webpack://@affine/web/../core/src/modules/theme-editor/views/components/variable-list.tsx","webpack://@affine/web/../core/src/modules/theme-editor/views/resource.ts","webpack://@affine/web/../core/src/modules/theme-editor/views/theme-editor.tsx","webpack://@affine/web/../core/src/modules/theme-editor/index.ts","webpack://@affine/web/../core/src/modules/workbench/entities/sidebar-tab.ts","webpack://@affine/web/../core/src/utils/navigable-history.ts","webpack://@affine/web/../core/src/modules/workbench/entities/view.ts","webpack://@affine/web/../core/src/modules/workbench/entities/workbench.ts","webpack://@affine/web/../core/src/modules/workbench/view/use-is-active-view.tsx","webpack://@affine/web/../core/src/utils/island.tsx","webpack://@affine/web/../core/src/modules/workbench/view/view-islands.tsx","webpack://@affine/web/../core/src/modules/workbench/view/sidebar/sidebar-header.tsx","webpack://@affine/web/../core/src/modules/workbench/view/sidebar/sidebar-header.css.ts","webpack://@affine/web/../core/src/modules/workbench/view/sidebar/sidebar-header-switcher.tsx","webpack://@affine/web/../core/src/modules/workbench/view/sidebar/sidebar-header-switcher.css.ts","webpack://@affine/web/../core/src/modules/workbench/view/sidebar/sidebar-container.tsx","webpack://@affine/web/../core/src/modules/workbench/view/sidebar/sidebar-container.css.ts","webpack://@affine/web/../core/src/modules/workbench/view/split-view/indicator.tsx","webpack://@affine/web/../core/src/modules/workbench/view/split-view/indicator.css.ts","webpack://@affine/web/../core/src/modules/workbench/view/split-view/panel.tsx","webpack://@affine/web/../core/src/modules/workbench/view/split-view/split-view.css.ts","webpack://@affine/web/../core/src/modules/workbench/view/split-view/resize-handle.tsx","webpack://@affine/web/../core/src/modules/workbench/view/split-view/split-view.tsx","webpack://@affine/web/../core/src/modules/workbench/view/route-container.tsx","webpack://@affine/web/../core/src/modules/workbench/view/route-container.css.ts","webpack://@affine/web/../core/src/modules/workbench/view/view-root.tsx","webpack://@affine/web/../core/src/modules/workbench/view/workbench-root.tsx","webpack://@affine/web/../core/src/modules/workbench/view/desktop-adapter.ts","webpack://@affine/web/../core/src/modules/workbench/view/browser-adapter.ts","webpack://@affine/web/../core/src/modules/workbench/view/workbench-root.css.ts","webpack://@affine/web/../core/src/modules/workbench/services/workbench-new-tab-handler.ts","webpack://@affine/web/../core/src/modules/workbench/services/workbench-view-state.ts","webpack://@affine/web/../core/src/modules/workbench/index.ts","webpack://@affine/web/../core/src/modules/workbench/scopes/view.ts","webpack://@affine/web/../core/src/modules/workbench/services/desktop-state-synchronizer.ts","webpack://@affine/web/../core/src/modules/workbench/services/view.ts","webpack://@affine/web/../core/src/modules/workbench/services/workbench.ts","webpack://@affine/web/../core/src/modules/workbench/view/use-view-position.tsx","webpack://@affine/web/../core/src/modules/workbench/view/view-meta.tsx","webpack://@affine/web/../core/src/modules/workbench/view/workbench-link.tsx","webpack://@affine/web/../core/src/modules/workspace-engine/impls/engine/blob-cloud.ts","webpack://@affine/web/../core/src/modules/workspace-engine/impls/cloud.ts","webpack://@affine/web/../core/src/modules/workspace-engine/impls/engine/awareness-broadcast-channel.ts","webpack://@affine/web/../core/src/modules/workspace-engine/utils/base64.ts","webpack://@affine/web/../core/src/modules/workspace-engine/impls/engine/awareness-cloud.ts","webpack://@affine/web/../core/src/modules/workspace-engine/impls/engine/blob-static.ts","webpack://@affine/web/../core/src/modules/workspace-engine/impls/engine/doc-cloud.ts","webpack://@affine/web/../core/src/modules/workspace-engine/impls/engine/doc-cloud-static.ts","webpack://@affine/web/../core/src/modules/workspace-engine/impls/engine/blob-indexeddb.ts","webpack://@affine/web/../core/src/modules/workspace-engine/impls/engine/doc-broadcast-channel.ts","webpack://@affine/web/../core/src/modules/workspace-engine/impls/engine/doc-indexeddb.ts","webpack://@affine/web/../core/src/modules/workspace-engine/impls/local.ts","webpack://@affine/web/../core/src/modules/workspace-engine/providers/engine.ts","webpack://@affine/web/../core/src/modules/workspace-engine/index.ts","webpack://@affine/web/../core/src/modules/workspace-engine/utils/buffer-to-blob.ts","webpack://@affine/web/../component/src/components/not-found-page/not-found-pattern.tsx","webpack://@affine/web/../component/src/components/not-found-page/styles.css.ts","webpack://@affine/web/../component/src/components/not-found-page/not-found-page.tsx","webpack://@affine/web/../core/src/pages/404.tsx","webpack://@affine/web/../core/src/pages/sign-in.tsx","webpack://@affine/web/../core/src/router.tsx","webpack://@affine/web/../core/src/shared/index.ts","webpack://@affine/web/../core/src/utils/create-emotion-cache.ts","webpack://@affine/web/../core/src/utils/fractional-indexing.ts","webpack://@affine/web/../core/src/utils/event.ts","webpack://@affine/web/../core/src/utils/popup.ts","webpack://@affine/web/../core/src/utils/toast.ts","webpack://@affine/web/../core/src/utils/reduce-image.ts","webpack://@affine/web/../electron-api/src/index.ts","webpack://@affine/web/../graphql/src/error.ts","webpack://@affine/web/../graphql/src/fetcher.ts","webpack://@affine/web/../graphql/src/graphql/index.ts","webpack://@affine/web/../graphql/src/index.ts","webpack://@affine/web/../graphql/src/schema.ts","webpack://@affine/web/../i18n/src/resources/index.ts","webpack://@affine/web/../i18n/src/i18n.ts","webpack://@affine/web/../i18n/src/utils/time.ts","webpack://@affine/web/../i18n/src/index.ts","webpack://@affine/web/../core/src/modules/telemetry/services/telemetry.ts","webpack://@affine/web/../component/src/components/provider-composer/index.tsx","webpack://@affine/web/../component/src/components/theme-provider/index.tsx","webpack://@affine/web/../component/src/components/context/index.tsx","webpack://@affine/web/../../common/infra/src/modules/doc/stores/docs.ts","webpack://@affine/web/../../common/infra/src/modules/storage/index.ts","webpack://@affine/web/../../common/infra/src/modules/workspace/entities/list.ts","webpack://@affine/web/../../common/infra/src/modules/workspace/entities/profile.ts","webpack://@affine/web/../../common/infra/src/modules/workspace/impls/storage.ts","webpack://@affine/web/../../common/infra/src/modules/workspace/services/destroy.ts","webpack://@affine/web/../../common/infra/src/modules/workspace/services/factory.ts","webpack://@affine/web/../../common/infra/src/modules/workspace/services/list.ts","webpack://@affine/web/../../common/infra/src/modules/workspace/services/profile.ts","webpack://@affine/web/../../common/infra/src/modules/workspace/services/repo.ts","webpack://@affine/web/../../common/infra/src/blocksuite/migration/fixing.ts","webpack://@affine/web/../../common/infra/src/modules/workspace/services/transform.ts","webpack://@affine/web/../../common/infra/src/modules/workspace/stores/profile-cache.ts","webpack://@affine/web/../core/src/modules/storage/impls/local-storage.ts","webpack://@affine/web/../core/src/telemetry.tsx","webpack://@affine/web/./src/app.tsx","webpack://@affine/web/../core/src/modules/index.ts","webpack://@affine/web/../../common/infra/src/index.ts","webpack://@affine/web/../../common/infra/src/modules/workspace/index.ts","webpack://@affine/web/../../common/infra/src/modules/doc/index.ts","webpack://@affine/web/../../common/infra/src/modules/db/index.ts","webpack://@affine/web/../../common/infra/src/modules/global-context/index.ts","webpack://@affine/web/../../common/infra/src/modules/lifecycle/index.ts","webpack://@affine/web/../core/src/modules/telemetry/index.ts","webpack://@affine/web/../core/src/modules/find-in-page/index.ts","webpack://@affine/web/../core/src/modules/storage/index.ts","webpack://@affine/web/./src/index.tsx","webpack://@affine/web/./src/polyfill/intl-segmenter.ts","webpack://@affine/web/./src/polyfill/request-idle-callback.ts"],"sourcesContent":["import \"../core/src/components/affine/auth/style.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/affine/auth/style.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACpVV226jMBB9z1eMui/bB0ckIaTraL9ktVoZPBC3xka+NOmu+u8rm9ACISl5QvLczpwzMyz/rNKDzHKZwL8FQM1MJRRxuqGwSZrTfvG+WHYuq54LBead3n+G5No5XVNIQxCAw5MjTIpKUShQOTSDVOsr1QAKLbWh8MrMd0JYWQqFJCazWGjFmXkj0eUxOJdaOWLFXxwFxPeTjT4yPBxQVAdHYbXcjnCwiGSqqhTq5aPWIGYZTG2cNzYENlq0Pd6XahOTNNoKJ3TgNLdaeochj2kRJ/sRUWSdjXRJ+2R2Olyot53XKEDOipfKaK84BWeYsg0zqFw0acPRkHOSkfFuMdbrVnJv0RCLEgtHQWmFA9xZxH0zua0f7x6dr0nvmEwGcHYRTtfCbte2wIVtJHujUEqMD+FLuDBYtEUKLX2tguXZWyfKAEU5VO5zPQDivhDhsLb955tL+RTxXNS/UaViDYWnFvekHl9z3av/4+pYReobI+qJnT2eS2bJkN12G4+CuwOFdDvrluSDmOR6zLwpOrMtsQz3Irt+lXLp8bKjdNRREdFNw7lHtSuzMWfpBvi2ycVFyc48jy/5eNT49KjNgfAxYklvxEaQZt7Sxhskx4NwOLpWZFIkwzpLu/aMc6EqCkn3pzrfNMO48Pbj/3WvEn2afnHmGBGW5CgFvqL5+eCMx4ffkb9LwN82u3S1Xe0X7/8BkCqy644HAAA=\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var accessMessage = '_14hl6blc';\nexport var authMessage = '_14hl6bl2';\nexport var authModalContent = '_14hl6bl0';\nexport var captchaWrapper = '_14hl6bl1';\nexport var forgetPasswordButton = '_14hl6bl6';\nexport var forgetPasswordButtonRow = '_14hl6bl3';\nexport var linkButton = '_14hl6bl5';\nexport var resendCountdown = '_14hl6bla';\nexport var resendCountdownInButton = '_14hl6blb';\nexport var resendWrapper = '_14hl6bl7';\nexport var sendMagicLinkButtonRow = '_14hl6bl4';\nexport var sentMessage = '_14hl6bl9';\nexport var sentRow = '_14hl6bl8';\nexport var userPlanButton = '_14hl6bld';","import \"../core/src/components/affine/page-properties/styles.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/affine/page-properties/styles.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#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\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var addPropertyButton = 'rmastff';\nexport var backlinksList = 'rmastfa';\nexport var checkboxProperty = 'rmastf13';\nexport var collapsedIcon = 'rmastfg';\nexport var draggableItem = 'rmastfj';\nexport var draggableRowSetting = 'rmastfk rmastfj';\nexport var editablePropertyRowCell = 'rmastfm rmastfl';\nexport var menuHeader = 'rmastfx';\nexport var menuItemIconContainer = 'rmastf11';\nexport var menuItemList = 'rmastf10';\nexport var menuItemListScrollable = 'rmastfy';\nexport var menuItemListScrollbar = 'rmastfz';\nexport var menuItemName = 'rmastf12';\nexport var pageInfoDimmed = 'rmastf7';\nexport var propertyRow = 'rmastfh';\nexport var propertyRowCell = 'rmastfl';\nexport var propertyRowIconContainer = 'rmastfp';\nexport var propertyRowName = 'rmastfr';\nexport var propertyRowNameCell = 'rmastfn rmastfl';\nexport var propertyRowNameContainer = 'rmastfq';\nexport var propertyRowNamePopupRow = 'rmastf14';\nexport var propertyRowTypeItem = 'rmastf18';\nexport var propertyRowValueCell = 'rmastfs rmastfl rmastfm';\nexport var propertyRowValueNumberCell = 'rmastfw rmastft rmastfs rmastfl rmastfm';\nexport var propertyRowValueTextCell = 'rmastft rmastfs rmastfl rmastfm';\nexport var propertyRowValueTextarea = 'rmastfu rmastfs rmastfl rmastfm';\nexport var propertyRowValueTextareaInvisible = 'rmastfv rmastfs rmastfl rmastfm';\nexport var propertySettingRow = 'rmastf15 rmastfk rmastfj';\nexport var propertySettingRowName = 'rmastf16';\nexport var propertyTypeName = 'rmastf19';\nexport var root = 'rmastf1';\nexport var rootCentered = 'rmastf2';\nexport var selectorButton = 'rmastf17';\nexport var sortablePropertyRowNameCell = 'rmastfn rmastfl rmastfj rmastfm';\nexport var spacer = 'rmastf8';\nexport var tableBodyRoot = 'rmastfd';\nexport var tableBodySortable = 'rmastfe';\nexport var tableHeader = 'rmastf3';\nexport var tableHeaderBacklinksHint = 'rmastf9';\nexport var tableHeaderCollapseButtonWrapper = 'rmastf6';\nexport var tableHeaderDivider = 'rmastfc';\nexport var tableHeaderInfoRow = 'rmastf4';\nexport var tableHeaderSecondaryRow = 'rmastf5';\nexport var tableHeaderTimestamp = 'rmastfb';\nexport var tagsPropertyRow = 'rmastfi rmastfh';","import \"../core/src/components/page-list/filter/index.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/page-list/filter/index.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACr1Vy3bjIAzd5yu0nC7IsfMe8jXYlmN1CHAAx+709N97wHnYidMmXXTJRY+rKyGmh1e3nosE3icABTkjxRuHUmK7nQDUDi1zKDH3HJRWGEAhaacYedw7DjkqjzbA+oC2lLrhUFFRoNpOPibTLnoao5daeeboP3I4CPuHMVGWpJBFvHUvPYdZdNgLuyPFYW1aSFcmMorGDdKu8hyWSRIwGaJUR2yW9Ay/zAaQa6nt1b3H1jOHuVaFsG8smvSpzXvUmNeGw6xLeIQy7b3eX6MSS88hHYK2Y7zpwFMBaXfMRP5vZ3WtiiuCmbYF2ltii2dFXo73vIsfeYDTkoov05/smRUF1e5czV36TUUeo6MRRUFqx2Fh2pPb7RABvNbOUxlaoTwqz8EZkSPL0Dc4GLPVeEF35vUm7OUqr60Lg2E0naBBHxeB7Dnt+kHhexXPTNsFAfBWKEeetOIgpIRkmi4doHDISDFd+34mXgWBYr4Rjnc1j173WzYsZ/NwOU88nx/X/ng/wzWHOaQgaq9jz0ixhgpfcZhthjX+hpB/vxfS7V+eKfHHGg4XzmmVRsFSSI6CXYj/hjrie3Uy4bpNMUr/LEZYVMkzMo7NLeVa3e7UrL/se2//6h9adf/QXUHzGGZst8VtyOJCCx9sY4WJTQ2v6GKPUpJx5LaTj0/naTRjsAcAAA==\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var argStyle = 'vjs73ab';\nexport var ellipsisTextStyle = 'vjs73ac';\nexport var filterContainerStyle = 'vjs73a0';\nexport var filterItemCloseStyle = 'vjs73a6';\nexport var filterItemStyle = 'vjs73a5';\nexport var filterTypeIconStyle = 'vjs73aa';\nexport var filterTypeStyle = 'vjs73a9';\nexport var inputStyle = 'vjs73a7';\nexport var menuItemStyle = 'vjs73a1';\nexport var menuItemTextStyle = 'vjs73a4';\nexport var switchStyle = 'vjs73a8';\nexport var variableSelectDividerStyle = 'vjs73a3';\nexport var variableSelectTitleStyle = 'vjs73a2';","import \"../core/src/components/page-list/collections/collection-list-item.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/page-list/collections/collection-list-item.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACsVWbWvbMBD+nl8hCoUGquK8rlPY/scYYyjS2dYqS0aSm3Sj/31IshPZcZplK+xbfLmX5557fOeH7zMuqtkeMvRrghAXtpb0haBcwn4zQYhpqQ1Bz9TcYUzzXCjADvYO10ZU1Lzg4DD1riWIonQErZZ1CPUpsC2NUE8EZd6yE9yVBM2y7NY/UikKhYWDyhJknQHHSm93hiornNCKoC1lT4XRjeKxEsoe5vYe6Zoy4V7Ckw/Rz2ByqXcElYJzUAF6Y6zHziGnjXQRgJSYlVQVQLocm8nr5OHAAil9qsDFsPSAheB4aD/N8ZVTRzGTgj3RrYRPzjTwLaTsINVaKAemFzYLHh2Jy1UkcasNB4MN5aKxnrpoPplTj0sGMXvaw3n0OBdSAp/Gcn5klHsme/4VqKb9JzhWdI/bcS7WLahKqM42j7akvXlor9bdYA1I6sQzxGSmEApLyB1B+DFm65jo1KIbJ4UCgpRWIaqmnAtVtGGPsV7knhtaFAn3RxRkC7k2EKehlQPlCLq52fSw0a3VsnGhitM1QasIIQgz16Yi8aekDr7c4VV2GziJQFKlL/uttI+pvuNfZ1R9QYG1pAxKLXmiwxPFzGPNNvUBXvIeRAj36ftwkcUgn5TLw7SG9WZn8yVGoYqTGiHtEfbD6m8TjcFctDA7uY6BPr7Q6DMiuTDWYVYKyaOSe+qbrQdyDzGSjoaYiOFxELJInQjK0Oq6d72gdbcgkqzL8b1+Jsfpzs61ctiKnzAQX7CXeNHffavxaiEtFwZYVD3TsqnUCY5Y3VHjNn0mIr29rcOoZHd+NyCM1st6P+3qhOkhtCuFA2xrysLK2Blae3NjwWALEpjrNkkCfx1FN3JM3qTBVtODz65V2DrL3oCRAA3X9FgSpBS1FfZIjgWZJ/cxgfvhLNyzZ9sC04r3D/ebve3tHzL7D308XqfRy4ocJ0AwrdK2B1pPAH18P0Atf1cNJFH+4Bh2p7b3JZUAp/8X+Mj68BYvkVQqw/6SBrZXNfCjsU7kHkF7yUM5UPzCfNn7VYmrDIflux7/8H39DY+5qINlCwAA\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nimport \"../core/src/components/page-list/docs/page-list-item.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/page-list/docs/page-list-item.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACr1W247bIBB9z1eglVbaSEvkXJsStf9RVVVFYGzTxWABTrKt9t8rg51gx0madtU3ezzMnDlzmPHk+3Sh+DTdJejXCCEubCnpK0GphMNmhBDTUhuCdtQ8YUzTVCjADg4Ol0YU1Lxi7zCuXXMQWe4IWi5Kf7QOgW1uhHohKKkte8FdTtA0SR7rVypFprBwUFiCrDPgWF7bnaHKCie0ImhL2UtmdKV4yISSycw+I11SJtyrf6uP6B2YVOo9QbngHJSHXhlbY+eQ0kq6AEBKzHKqMiBtjM3obTQ5skDyOpTnop+6x4J3PJYfx/jKqaOYScFe6FbCJ2cq+OZDtpBKLZQD0zk29R4tiYtlIHGrDQeDDeWisgStg/WsTR0qGYTgcQmXweNUSAl8HLLVHaO8JrLjX4Cqmi/esaAH3HRzvkoCqEKo1jYLtqi6ma+u1G1fDUjqxA5CMJMJhSWkjiDclNgS0YpFV04KBQQprfypknIuVNYcW4d8gXpuaJZF1J9QkC2k2kBohlYOlCPo4WHTwUa3VsvK+SxOlwQtAwSvy1SbgoRHSR18ecLL5NFzEoDEQl90S2leY3mHTxdEfUOApaQMci15JMMzwcxCzib0EV50DQKE5/g63GTRyyfm8titfr7pxXiRUajsLIcPe4I9Wf5toCGY8wZmK9ch0Kf7jD4jkgpjHWa5kDwouaO+6aond39G0sEjJmBY947MYyeCErS8765ntKxvSy/qYnisX4hxPrJTrRy24if0xOftOZ53R99yOJsPy4UBFlTPtKwKdYYjZHfUuE2XiUBvZ+owKtlTPRsQRqtFeRi3eXz3ENrnwgG2JWV+ZOwNLWtzZcFgCxKYaydJBH8VRDewS67SYIvx0WffKGyVJFdgRED9Mj2lBClFaYU9kWNBptF6jOB+uAj34ta2wLTi3b19tbaD/UNm/6GO9X0ava3IYQIE0youu6f1CNDH9wPU8HdXQyLl95Zhu2o7P1IRcPr/gJ///w0Mj9pSCyQWynl11y/l9q6aflTWibSG1Sx3jwEUv9Fy9n5ZwnTDfh6vhn+F334DRtyk13cLAAA=\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nimport \"../core/src/components/page-list/tags/tag-list-item.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/page-list/tags/tag-list-item.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACsVWbW/bIBD+nl+BKlVqpBI5r0uJtv8xTdNE4GyzYLAAN+mm/ffJYCfYsZu1qrRv8eW4e+65hztmP+Zb6Q5PIkG/JwhxYUtJXwhKJZx2E4SYltoQ9EzNA8Y0TYUC7ODkcGlEQc0L9g7T2jUHkeWOoPWq9EfrENjmRqgDQUltOQrucoLmSXJff1IpMoWFg8ISZJ0Bx/La7gxVVjihFUF7yg6Z0ZXiIRNKZgv7iHRJmXAv/qs+op/BpFIfCcoF56A89MrYGjuHlFbSBQBSYpZTlQFpY+wmfyazMwskr0N5Lvqpeyx4x3P5cYxvnDqKmRTsQPcSPjtTwXcfsoVUaqEcmM6xufdoSVytA4l7bTgYbCgXla2pC+arPnW4ZBCixzWMo8epkBL4NKSrW0Z5zWTHvwBVNf94x4KecNPO5aYBVQjV2hbBFpW38OWVum2sAUmdeIYQzGRCYQmpIwhvQ7SWiVYtunJSKCBIaeVPlZRzobLm2DbkC9xzQ7Ms4v6Cguwh1QZCN7RyoBxBd3e7Dja6t1pWzmdxuiRoHSB4YabaFCT8lNTB1we8Tu49JwFIrPRVt5TmM9Z3+GtE1TcUWErKINeSRzq8Uswi5GxCn+FF9yBAeIzvw00WvXxiLs/d6uebj8aLjEJlVzl82Avs2fq9gYZgLhuYrVyHQF8uNPqCSCqMdZjlQvKg5I765pue3P0ZSQePmIBh2zuyjJ0IWr/tpme0bMdDFHM1PNVHYlxP7FQrh634BT3peXuOl93Jt/6HbCGHo8bt4mqThsLOZGFUsof6/iOMNqvyNG1B+g4hdMyFA2xLyvxYOBpa1ubKgsEWJDDXTosI5CYIa2BhvFqsLaZnn2Ojok2SvALDr8lLHpBSlFbYCyMWZBrT39PHqtfLT6PAR5e0BaYV767pV6vcUwvTYSl8TJVRPdu3afO2EoeJEEyruPxeYRGgp48DdLKjeEYbE92F3gpsF2zn/RQBp/8X+MDYqC21QmKl9OuLCti/qYCflXUirRE0+9unA8Vv9Jd9XBamZVUo7IfuZvi5GyUO47/dNb1HQfv9blwDVwvihD0xbQcfls0L56qIvz+nlA4gDAAA\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nimport \"../core/src/components/page-list/list.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/page-list/list.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACqVU2W7bMBB811cQAQIkQGlIPRybQYD+RxEEa3JlbS2RKrWS5Rb+90JUfNBHeuRRnOHs7M6Kk5cMHqofsz4TvxIh1mS4UCJL09vHRIi8xF6J7DHZJpMd8eMlYgW9PDnSzjKQRS8tVKjE7n4ag7ypUQmyJVmUDf3EAV6AXi29a61RogN/JyXk+UA4ALL2VIHfSO1K5+8ji5+CRUNNXcJGhS523UhDHjWTs0poV7aVHRDv1nIJtRLZtO4jqS+XpaCkpZXEWDVKaLSMfl+hKTzZlRKhUdehz0u3VqIgY9BG4g+xuHUWI3z2T8W/tw1TPgzEMloe+RKtueKsBk28CV/HNb8ZYJA5dM4T4/MHMXnJPluT5V2qiqEdceAG0FCV9XgFnJW8mtM5GDrbW4g3bB7AkOuwGQV64sExY8/SoHYexgDPBjZXHTXEaC4qRETQTB3+iQeBULuGxoqwaFzZclhST8uCX4d5svsFjtg0rUNi1yOGcdxN4dZP7Ft8DgX/Z//fsSgHSLe+GWYBLbvI5+J4UpEl0s5e+gkXr5n/bT/ovfNvCe0P9FUvpxpf9+/M4fkRd0eP1SxN6/4+6O3lp2MkBRkMs3u6GYK5GZM5y1KIbbL9DX8jfKlGBQAA\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var clearLinkStyle = '_1a7mq8x9';\nexport var colWrapper = '_1a7mq8x5';\nexport var deleteButton = '_1a7mq8xb';\nexport var deleteIcon = '_1a7mq8xc';\nexport var editTagWrapper = '_1a7mq8xa';\nexport var favoriteCell = '_1a7mq8x8';\nexport var groupsContainer = '_1a7mq8x3';\nexport var heading = '_1a7mq8x4';\nexport var hidden = '_1a7mq8x7';\nexport var hideInSmallContainer = '_1a7mq8x6';\nexport var listRootContainer = '_1a7mq8x0';\nexport var pageListScrollContainer = '_1a7mq8x1';\nexport var root = '_1a7mq8x2';","import \"../core/src/components/page-list/view/edit-collection/edit-collection.css.ts.vanilla.css!=!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/page-list/view/edit-collection/edit-collection.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACs1W0ZabIBB9z1fw0nPaB/aoddOU/ZgeIqOyQXCBbEx7+u89IrpgTDbmqS8xAsPM3Llzx6dfaSaeM/uWoD8bhNQ76FKoE0E1ZwzkywYhC53FHxsgBG8NN/3WqeYWsGlpAQRJddK0fdn83TyNl6buUsZNK+iZoFJA15u9Ho3l5RkXSlqQliB3A96DPcHgs6ItQbvWnaaCVxJzC40hqABpQffLLWWMy4qgdNt2w8/O/4liyJZj6J+YcQ2F5UoSVChxbJzvE2e2JihNki/9aw28qu3H+yVEgbPv150RlH5qni+bf4pGcMXzo5BPeGZJ26EsH9ztlWagsVUtQWnbIaMEZ+id6q8Y07LkErA/Uiih9LcJ2p4LBA2M8Bmk2aw0WxdrqaTFhv8GglLv1S2dPPB5kvRrovc1FiPLhoPOKYnjcXw1UCjJqD4HcU0Z5hNPHkkwSODHkICrbnabVf4SAaW9H8mRLLgLG3JaPRNEj1ZFIe2u9nEE6rYHNTD76cwmhJKRbisADm6jyyS80smOHGHlPRl8jePCJ8PizTbar3Lv+72h3dgdrl60OFRaHSXDSxgE263mTUy0JfSHDvCkW9TNkSP308MvaMr40UwKEdG8l8R81nbF+uqkyWV58qXyzFucXaXjCkUO9c+dMrXm8kBQzGGIOdzz52M4rHR5r2KX/8GEqwIVSlfmeTO5ejm5RXEZvQfmfO3kjUdtcNOru6mhuuLSS+ggBMGZgzsTDe9gV9zcbdzuUp/PmzswkhfT65ZgPSak6u7AxkjsWQBB3FLBiwvV381Uv407xs3FLJqLkbYElm9DRbjEHtPdvB7anfhERuueS8MOLrkQwOL8TRxg9GlyNKCxAQGF7UVUwkygRuTjcuQPfDh4LPbKWtXc/ZnwD2iTbIVbCwAA\\\"}!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var actionButton = '_12l52tqq';\nexport var bottomButton = '_12l52tqp';\nexport var bottomLeft = '_12l52tq4';\nexport var collectionEditContainer = '_12l52tqi';\nexport var confirmButton = '_12l52tqj';\nexport var ellipsis = '_12l52tq0';\nexport var includeItem = '_12l52tqb';\nexport var includeItemContent = '_12l52tqa';\nexport var includeItemContentIs = '_12l52tq9';\nexport var includeItemTitle = '_12l52tq8';\nexport var includeListTitle = '_12l52tq6';\nexport var includeTitle = '_12l52tqc';\nexport var pageList = '_12l52tql';\nexport var pagesList = '_12l52tq3';\nexport var pagesTab = '_12l52tq2';\nexport var pagesTabContent = '_12l52tq1';\nexport var previewActive = '_12l52tqr';\nexport var previewCountTips = '_12l52tqn';\nexport var previewCountTipsHighlight = '_12l52tqm';\nexport var resultPages = '_12l52tqk';\nexport var rulesBottom = '_12l52tq5';\nexport var rulesContainer = '_12l52tqh';\nexport var rulesContainerLeft = '_12l52tqg';\nexport var rulesContainerLeftContent = '_12l52tqe';\nexport var rulesContainerLeftContentInclude = '_12l52tqd';\nexport var rulesContainerLeftTab = '_12l52tqf';\nexport var rulesContainerRight = '_12l52tq7';\nexport var rulesTitle = '_12l52tqs';\nexport var rulesTitleHighlight = '_12l52tqo';","import debug from 'debug';\ntype LogLevel = 'debug' | 'info' | 'warn' | 'error';\n\nconst SESSION_KEY = 'affine:debug';\n\nif (typeof window !== 'undefined') {\n  // enable debug logs if the URL search string contains `debug`\n  // e.g. http://localhost:3000/?debug\n  if (window.location.search.includes('debug')) {\n    // enable debug logs for the current session\n    // since the query string may be removed by the browser after navigations,\n    // we need to store the debug flag in sessionStorage\n    sessionStorage.setItem(SESSION_KEY, 'true');\n  }\n  if (sessionStorage.getItem(SESSION_KEY) === 'true') {\n    // enable all debug logs by default\n    debug.enable('*');\n    console.warn('Debug logs enabled');\n  }\n  if (process.env.NODE_ENV === 'development') {\n    debug.enable('*,-micromark');\n    console.warn('Debug logs enabled');\n  }\n}\n\nexport class DebugLogger {\n  private readonly _debug: debug.Debugger;\n\n  constructor(namespace: string) {\n    this._debug = debug(namespace);\n  }\n\n  set enabled(enabled: boolean) {\n    this._debug.enabled = enabled;\n  }\n\n  get enabled() {\n    return this._debug.enabled;\n  }\n\n  debug(message: string, ...args: any[]) {\n    this.log('debug', message, ...args);\n  }\n\n  info(message: string, ...args: any[]) {\n    this.log('info', message, ...args);\n  }\n\n  warn(message: string, ...args: any[]) {\n    this.log('warn', message, ...args);\n  }\n\n  error(message: string, ...args: any[]) {\n    this.log('error', message, ...args);\n  }\n\n  log(level: LogLevel, message: string, ...args: any[]) {\n    this._debug.log = console[level].bind(console);\n    this._debug(`[${level.toUpperCase()}] ${message}`, ...args);\n  }\n\n  namespace(extra: string) {\n    const currentNamespace = this._debug.namespace;\n    return new DebugLogger(`${currentNamespace}:${extra}`);\n  }\n}\n","// This file should has not side effect\nimport type { DocCollection } from '@blocksuite/store';\n\ndeclare global {\n  interface Window {\n    appInfo: {\n      electron: boolean;\n      schema: string;\n      windowName: string;\n    };\n  }\n}\n\n//#region runtime variables\nexport const isBrowser = typeof window !== 'undefined';\nexport const isServer = !isBrowser && typeof navigator === 'undefined';\nexport const isDesktop = isBrowser && !!window.appInfo?.electron;\n//#endregion\nexport const DEFAULT_WORKSPACE_NAME = 'Demo Workspace';\nexport const UNTITLED_WORKSPACE_NAME = 'Untitled';\n\nexport const DEFAULT_SORT_KEY = 'updatedDate';\nexport const MessageCode = {\n  loginError: 0,\n  noPermission: 1,\n  loadListFailed: 2,\n  getDetailFailed: 3,\n  createWorkspaceFailed: 4,\n  getMembersFailed: 5,\n  updateWorkspaceFailed: 6,\n  deleteWorkspaceFailed: 7,\n  inviteMemberFailed: 8,\n  removeMemberFailed: 9,\n  acceptInvitingFailed: 10,\n  getBlobFailed: 11,\n  leaveWorkspaceFailed: 12,\n  downloadWorkspaceFailed: 13,\n  refreshTokenError: 14,\n  blobTooLarge: 15,\n} as const;\n\nexport const Messages = {\n  [MessageCode.loginError]: {\n    message: 'Login failed',\n  },\n  [MessageCode.noPermission]: {\n    message: 'No permission',\n  },\n  [MessageCode.loadListFailed]: {\n    message: 'Load list failed',\n  },\n  [MessageCode.getDetailFailed]: {\n    message: 'Get detail failed',\n  },\n  [MessageCode.createWorkspaceFailed]: {\n    message: 'Create workspace failed',\n  },\n  [MessageCode.getMembersFailed]: {\n    message: 'Get members failed',\n  },\n  [MessageCode.updateWorkspaceFailed]: {\n    message: 'Update workspace failed',\n  },\n  [MessageCode.deleteWorkspaceFailed]: {\n    message: 'Delete workspace failed',\n  },\n  [MessageCode.inviteMemberFailed]: {\n    message: 'Invite member failed',\n  },\n  [MessageCode.removeMemberFailed]: {\n    message: 'Remove member failed',\n  },\n  [MessageCode.acceptInvitingFailed]: {\n    message: 'Accept inviting failed',\n  },\n  [MessageCode.getBlobFailed]: {\n    message: 'Get blob failed',\n  },\n  [MessageCode.leaveWorkspaceFailed]: {\n    message: 'Leave workspace failed',\n  },\n  [MessageCode.downloadWorkspaceFailed]: {\n    message: 'Download workspace failed',\n  },\n  [MessageCode.refreshTokenError]: {\n    message: 'Refresh token failed',\n  },\n  [MessageCode.blobTooLarge]: {\n    message: 'Blob too large',\n  },\n} as const satisfies {\n  [key in (typeof MessageCode)[keyof typeof MessageCode]]: {\n    message: string;\n  };\n};\n\nexport class PageNotFoundError extends TypeError {\n  readonly docCollection: DocCollection;\n  readonly pageId: string;\n\n  constructor(docCollection: DocCollection, pageId: string) {\n    super();\n    this.docCollection = docCollection;\n    this.pageId = pageId;\n  }\n}\n\nexport class WorkspaceNotFoundError extends TypeError {\n  readonly workspaceId: string;\n\n  constructor(workspaceId: string) {\n    super();\n    this.workspaceId = workspaceId;\n  }\n}\n\nexport class QueryParamError extends TypeError {\n  readonly targetKey: string;\n  readonly query: unknown;\n\n  constructor(targetKey: string, query: unknown) {\n    super();\n    this.targetKey = targetKey;\n    this.query = query;\n  }\n}\n\nexport class Unreachable extends Error {\n  constructor(message?: string) {\n    super(message);\n  }\n}\n","export class UaHelper {\n  private readonly uaMap;\n  public isLinux = false;\n  public isMacOs = false;\n  public isSafari = false;\n  public isWindows = false;\n  public isFireFox = false;\n  public isMobile = false;\n  public isChrome = false;\n  public isIOS = false;\n\n  getChromeVersion = (): number => {\n    let raw = this.navigator.userAgent.match(/Chrom(e|ium)\\/([0-9]+)\\./);\n    if (!raw) {\n      raw = this.navigator.userAgent.match(/(CriOS)\\/([0-9]+)/);\n    }\n    if (!raw) {\n      console.error('Cannot get chrome version');\n      return 0;\n    }\n    return parseInt(raw[2], 10);\n  };\n\n  constructor(private readonly navigator: Navigator) {\n    this.uaMap = getUa(navigator);\n    this.initUaFlags();\n  }\n\n  public checkUseragent(isUseragent: keyof ReturnType<typeof getUa>) {\n    return Boolean(this.uaMap[isUseragent]);\n  }\n\n  private initUaFlags() {\n    this.isLinux = this.checkUseragent('linux');\n    this.isMacOs = this.checkUseragent('mac');\n    this.isSafari = this.checkUseragent('safari');\n    this.isWindows = this.checkUseragent('win');\n    this.isFireFox = this.checkUseragent('firefox');\n    this.isMobile = this.checkUseragent('mobile');\n    this.isChrome = this.checkUseragent('chrome');\n    this.isIOS = this.checkUseragent('ios');\n  }\n}\n\nconst getUa = (navigator: Navigator) => {\n  const ua = navigator.userAgent;\n  const uas = ua.toLowerCase();\n  const mobile = /iPhone|iPad|iPod|Android/i.test(ua);\n  const android =\n    (mobile && (uas.indexOf('android') > -1 || uas.indexOf('linux') > -1)) ||\n    uas.indexOf('adr') > -1;\n  const ios = mobile && !android && /Mac OS/i.test(ua);\n  const mac = !mobile && /Mac OS/i.test(ua);\n  const iphone = ios && uas.indexOf('iphone') > -1;\n  const ipad = ios && !iphone;\n  const wx = /MicroMessenger/i.test(ua);\n  const chrome = /CriOS/i.test(ua) || /Chrome/i.test(ua);\n  const tiktok = mobile && /aweme/i.test(ua);\n  const weibo = mobile && /Weibo/i.test(ua);\n  const safari =\n    ios && !chrome && !wx && !weibo && !tiktok && /Safari|Macintosh/i.test(ua);\n  const firefox = /Firefox/.test(ua);\n  const win = /windows|win32|win64|wow32|wow64/.test(uas);\n  const linux = /linux/.test(uas);\n  return {\n    ua,\n    mobile,\n    android,\n    ios,\n    mac,\n    wx,\n    chrome,\n    iphone,\n    ipad,\n    safari,\n    tiktok,\n    weibo,\n    win,\n    linux,\n    firefox,\n  };\n};\n","/// <reference types=\"@blocksuite/global\" />\nimport { assertEquals } from '@blocksuite/global/utils';\nimport { z } from 'zod';\n\nimport { isDesktop, isServer } from './constant.js';\nimport { UaHelper } from './ua-helper.js';\n\nexport const runtimeFlagsSchema = z.object({\n  // this is for the electron app\n  serverUrlPrefix: z.string(),\n  appVersion: z.string(),\n  editorVersion: z.string(),\n  appBuildType: z.union([\n    z.literal('stable'),\n    z.literal('beta'),\n    z.literal('internal'),\n    z.literal('canary'),\n  ]),\n  isSelfHosted: z.boolean().optional(),\n  githubUrl: z.string(),\n  changelogUrl: z.string(),\n  downloadUrl: z.string(),\n  // see: tools/workers\n  imageProxyUrl: z.string(),\n  linkPreviewUrl: z.string(),\n  allowLocalWorkspace: z.boolean(),\n  enablePreloading: z.boolean(),\n  enableNewSettingUnstableApi: z.boolean(),\n  enableCaptcha: z.boolean(),\n  enableEnhanceShareMode: z.boolean(),\n  enableExperimentalFeature: z.boolean(),\n  enableInfoModal: z.boolean(),\n  enableOrganize: z.boolean(),\n  enableThemeEditor: z.boolean(),\n});\n\nexport type RuntimeConfig = z.infer<typeof runtimeFlagsSchema>;\n\ntype BrowserBase = {\n  /**\n   * @example https://app.affine.pro\n   * @example http://localhost:3000\n   */\n  origin: string;\n  isDesktop: boolean;\n  isBrowser: true;\n  isServer: false;\n  isDebug: boolean;\n\n  // browser special properties\n  isLinux: boolean;\n  isMacOs: boolean;\n  isIOS: boolean;\n  isSafari: boolean;\n  isWindows: boolean;\n  isFireFox: boolean;\n  isMobile: boolean;\n  isChrome: boolean;\n};\n\ntype NonChromeBrowser = BrowserBase & {\n  isChrome: false;\n};\n\ntype ChromeBrowser = BrowserBase & {\n  isSafari: false;\n  isFireFox: false;\n  isChrome: true;\n  chromeVersion: number;\n};\n\ntype Browser = NonChromeBrowser | ChromeBrowser;\n\ntype Server = {\n  isDesktop: false;\n  isBrowser: false;\n  isServer: true;\n  isDebug: boolean;\n};\n\ninterface Desktop extends ChromeBrowser {\n  isDesktop: true;\n  isBrowser: true;\n  isServer: false;\n  isDebug: boolean;\n}\n\nexport type Environment = Browser | Server | Desktop;\n\nexport function setupGlobal() {\n  if (globalThis.$AFFINE_SETUP) {\n    return;\n  }\n  runtimeFlagsSchema.parse(runtimeConfig);\n\n  let environment: Environment;\n  const isDebug = process.env.NODE_ENV === 'development';\n  if (isServer) {\n    environment = {\n      isDesktop: false,\n      isBrowser: false,\n      isServer: true,\n      isDebug,\n    } satisfies Server;\n  } else {\n    const uaHelper = new UaHelper(navigator);\n\n    environment = {\n      origin: window.location.origin,\n      isDesktop,\n      isBrowser: true,\n      isServer: false,\n      isDebug,\n      isLinux: uaHelper.isLinux,\n      isMacOs: uaHelper.isMacOs,\n      isSafari: uaHelper.isSafari,\n      isWindows: uaHelper.isWindows,\n      isFireFox: uaHelper.isFireFox,\n      isMobile: uaHelper.isMobile,\n      isChrome: uaHelper.isChrome,\n      isIOS: uaHelper.isIOS,\n    } as Browser;\n    // Chrome on iOS is still Safari\n    if (environment.isChrome && !environment.isIOS) {\n      assertEquals(environment.isSafari, false);\n      assertEquals(environment.isFireFox, false);\n      environment = {\n        ...environment,\n        isSafari: false,\n        isFireFox: false,\n        isChrome: true,\n        chromeVersion: uaHelper.getChromeVersion(),\n      } satisfies ChromeBrowser;\n    }\n  }\n  globalThis.environment = environment;\n\n  globalThis.$AFFINE_SETUP = true;\n}\n","export enum WorkspaceFlavour {\n  /**\n   * New AFFiNE Cloud Workspace using Nest.js Server.\n   */\n  AFFINE_CLOUD = 'affine-cloud',\n  LOCAL = 'local',\n}\n","import { createStore } from 'jotai';\n\n// global store\nlet rootStore = createStore();\n\nexport function getCurrentStore() {\n  return rootStore;\n}\n\n/**\n * @internal do not use this function unless you know what you are doing\n */\nexport function _setCurrentStore(store: ReturnType<typeof createStore>) {\n  rootStore = store;\n}\n","import { DebugLogger } from '@affine/debug';\nimport { setupGlobal } from '@affine/env/global';\nimport type { DocCollection } from '@blocksuite/store';\nimport { atom } from 'jotai';\nimport { atomWithStorage } from 'jotai/utils';\nimport { atomEffect } from 'jotai-effect';\n\nimport { getCurrentStore } from './root-store';\n\nsetupGlobal();\n\nconst logger = new DebugLogger('affine:settings');\n\nexport type DateFormats =\n  | 'MM/dd/YYYY'\n  | 'dd/MM/YYYY'\n  | 'YYYY-MM-dd'\n  | 'YYYY.MM.dd'\n  | 'YYYY/MM/dd'\n  | 'dd-MMM-YYYY'\n  | 'dd MMMM YYYY';\n\nexport type AppSetting = {\n  clientBorder: boolean;\n  fullWidthLayout: boolean;\n  windowFrameStyle: 'frameless' | 'NativeTitleBar';\n  fontStyle: FontFamily;\n  dateFormat: DateFormats;\n  startWeekOnMonday: boolean;\n  enableBlurBackground: boolean;\n  enableNoisyBackground: boolean;\n  autoCheckUpdate: boolean;\n  autoDownloadUpdate: boolean;\n  enableMultiView: boolean;\n  enableTelemetry: boolean;\n  editorFlags: Partial<Omit<BlockSuiteFlags, 'readonly'>>;\n};\nexport const windowFrameStyleOptions: AppSetting['windowFrameStyle'][] = [\n  'frameless',\n  'NativeTitleBar',\n];\n\nexport const dateFormatOptions: DateFormats[] = [\n  'MM/dd/YYYY',\n  'dd/MM/YYYY',\n  'YYYY-MM-dd',\n  'YYYY.MM.dd',\n  'YYYY/MM/dd',\n  'dd-MMM-YYYY',\n  'dd MMMM YYYY',\n];\n\nexport type FontFamily = 'Sans' | 'Serif' | 'Mono';\n\nexport const fontStyleOptions = [\n  { key: 'Sans', value: 'var(--affine-font-sans-family)' },\n  { key: 'Serif', value: 'var(--affine-font-serif-family)' },\n  { key: 'Mono', value: 'var(--affine-font-mono-family)' },\n] satisfies {\n  key: FontFamily;\n  value: string;\n}[];\n\nconst appSettingBaseAtom = atomWithStorage<AppSetting>('affine-settings', {\n  clientBorder: environment.isDesktop && !environment.isWindows,\n  fullWidthLayout: false,\n  windowFrameStyle: 'frameless',\n  fontStyle: 'Sans',\n  dateFormat: dateFormatOptions[0],\n  startWeekOnMonday: false,\n  enableBlurBackground: true,\n  enableNoisyBackground: true,\n  autoCheckUpdate: true,\n  autoDownloadUpdate: true,\n  enableTelemetry: true,\n  enableMultiView: false,\n  editorFlags: {},\n});\n\nexport function setupEditorFlags(docCollection: DocCollection) {\n  const store = getCurrentStore();\n  const syncEditorFlags = () => {\n    try {\n      const editorFlags = getCurrentStore().get(appSettingBaseAtom).editorFlags;\n      Object.entries(editorFlags ?? {}).forEach(([key, value]) => {\n        docCollection.awarenessStore.setFlag(\n          key as keyof BlockSuiteFlags,\n          value\n        );\n      });\n\n      // override this flag in app settings\n      // TODO(@eyhn): need a better way to manage block suite flags\n      Object.entries(blocksuiteFeatureFlags).forEach(([key, value]) => {\n        if (value.defaultState !== undefined) {\n          docCollection.awarenessStore.setFlag(\n            key as keyof BlockSuiteFlags,\n            value.defaultState\n          );\n        }\n      });\n    } catch (err) {\n      logger.error('syncEditorFlags', err);\n    }\n  };\n  store.sub(appSettingBaseAtom, syncEditorFlags);\n  syncEditorFlags();\n}\n\ntype SetStateAction<Value> = Value | ((prev: Value) => Value);\n\n// todo(@pengx17): use global state instead\nconst appSettingEffect = atomEffect(get => {\n  const settings = get(appSettingBaseAtom);\n  // some values in settings should be synced into electron side\n  if (environment.isDesktop) {\n    logger.debug('sync settings to electron', settings);\n    // this api type in @affine/electron-api, but it is circular dependency this package, use any here\n    (window as any).apis?.updater\n      .setConfig({\n        autoCheckUpdate: settings.autoCheckUpdate,\n        autoDownloadUpdate: settings.autoDownloadUpdate,\n      })\n      .catch((err: any) => {\n        console.error(err);\n      });\n  }\n});\n\nexport const appSettingAtom = atom<\n  AppSetting,\n  [SetStateAction<Partial<AppSetting>>],\n  void\n>(\n  get => {\n    get(appSettingEffect);\n    return get(appSettingBaseAtom);\n  },\n  (_get, set, apply) => {\n    set(appSettingBaseAtom, prev => {\n      const next = typeof apply === 'function' ? apply(prev) : apply;\n      return { ...prev, ...next };\n    });\n  }\n);\n\nexport type BuildChannel = 'stable' | 'beta' | 'canary' | 'internal';\n\nexport type FeedbackType = 'discord' | 'email' | 'github';\n\nexport type PreconditionType = () => boolean | undefined;\n\nexport type Flag<K extends string> = Partial<{\n  [key in K]: {\n    displayName: string;\n    description?: string;\n    precondition?: PreconditionType;\n    defaultState?: boolean; // default to open and not controlled by user\n    feedbackType?: FeedbackType;\n  };\n}>;\n\nconst isNotStableBuild: PreconditionType = () => {\n  return runtimeConfig.appBuildType !== 'stable';\n};\nconst isDesktopEnvironment: PreconditionType = () => environment.isDesktop;\nconst neverShow: PreconditionType = () => false;\n\nexport const blocksuiteFeatureFlags: Flag<keyof BlockSuiteFlags> = {\n  enable_database_attachment_note: {\n    displayName: 'Database Attachment Note',\n    description: 'Allows adding notes to database attachments.',\n    precondition: isNotStableBuild,\n  },\n  enable_database_statistics: {\n    displayName: 'Database Block Statistics',\n    description: 'Shows statistics for database blocks.',\n    precondition: isNotStableBuild,\n  },\n  enable_block_query: {\n    displayName: 'Todo Block Query',\n    description: 'Enables querying of todo blocks.',\n    precondition: isNotStableBuild,\n  },\n  enable_synced_doc_block: {\n    displayName: 'Synced Doc Block',\n    description: 'Enables syncing of doc blocks.',\n    precondition: neverShow,\n    defaultState: true,\n  },\n  enable_edgeless_text: {\n    displayName: 'Edgeless Text',\n    description: 'Enables edgeless text blocks.',\n    precondition: neverShow,\n    defaultState: true,\n  },\n  enable_color_picker: {\n    displayName: 'Color Picker',\n    description: 'Enables color picker blocks.',\n    precondition: neverShow,\n    defaultState: true,\n  },\n  enable_ai_chat_block: {\n    displayName: 'AI Chat Block',\n    description: 'Enables AI chat blocks.',\n    precondition: neverShow,\n    defaultState: true,\n  },\n  enable_ai_onboarding: {\n    displayName: 'AI Onboarding',\n    description: 'Enables AI onboarding.',\n    precondition: neverShow,\n    defaultState: true,\n  },\n  enable_expand_database_block: {\n    displayName: 'Expand Database Block',\n    description: 'Enables expanding of database blocks.',\n    precondition: neverShow,\n    defaultState: true,\n  },\n};\n\nexport const affineFeatureFlags: Flag<keyof AppSetting> = {\n  enableMultiView: {\n    displayName: 'Split View',\n    description:\n      'The Split View feature in AFFiNE allows users to divide their workspace into multiple sections, enabling simultaneous viewing and editing of different documents.The Split View feature in AFFiNE allows users to divide their workspace into multiple sections, enabling simultaneous viewing and editing of different documents.',\n    feedbackType: 'discord',\n    precondition: isDesktopEnvironment,\n  },\n};\n","import { CONSTRUCTOR_CONTEXT } from '../constructor-context';\nimport type { FrameworkProvider } from '../provider';\n\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport class Component<Props = {}> {\n  readonly framework: FrameworkProvider;\n  readonly props: Props;\n\n  get eventBus() {\n    return this.framework.eventBus;\n  }\n\n  constructor() {\n    if (!CONSTRUCTOR_CONTEXT.current.provider) {\n      throw new Error('Component must be created in the context of a provider');\n    }\n    this.framework = CONSTRUCTOR_CONTEXT.current.provider;\n    this.props = CONSTRUCTOR_CONTEXT.current.props;\n    CONSTRUCTOR_CONTEXT.current = {};\n  }\n\n  dispose() {}\n\n  [Symbol.dispose]() {\n    this.dispose();\n  }\n}\n","import { Component } from './component';\n\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport class Entity<Props = {}> extends Component<Props> {\n  readonly __isEntity = true;\n}\n","import { Component } from './component';\n\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport class Scope<Props = {}> extends Component<Props> {\n  readonly __injectable = true;\n\n  get collection() {\n    return this.framework.collection;\n  }\n\n  get scope() {\n    return this.framework.scope;\n  }\n\n  get get() {\n    return this.framework.get;\n  }\n\n  get getAll() {\n    return this.framework.getAll;\n  }\n\n  get getOptional() {\n    return this.framework.getOptional;\n  }\n\n  get createEntity() {\n    return this.framework.createEntity;\n  }\n\n  get createScope() {\n    return this.framework.createScope;\n  }\n\n  get emitEvent() {\n    return this.framework.emitEvent;\n  }\n\n  override dispose(): void {\n    super.dispose();\n    this.framework.dispose();\n  }\n}\n","import { Component } from './component';\n\nexport class Service extends Component {\n  readonly __isService = true;\n  readonly __injectable = true;\n}\n","import { Component } from './component';\n\nexport class Store extends Component {\n  readonly __isStore = true;\n  readonly __injectable = true;\n}\n","import type { FrameworkProvider } from './provider';\n\ninterface Context {\n  provider?: FrameworkProvider;\n  props?: any;\n}\n\nexport const CONSTRUCTOR_CONTEXT: {\n  current: Context;\n} = { current: {} };\n\n/**\n * @internal\n */\nexport function withContext<T>(cb: () => T, context: Context): T {\n  const pre = CONSTRUCTOR_CONTEXT.current;\n  try {\n    CONSTRUCTOR_CONTEXT.current = context;\n    return cb();\n  } finally {\n    CONSTRUCTOR_CONTEXT.current = pre;\n  }\n}\n","import type { ComponentVariant } from './types';\n\nexport const DEFAULT_VARIANT: ComponentVariant = 'default';\nexport const ROOT_SCOPE = [];\n\nexport const SUB_COMPONENTS = Symbol('subComponents');\n","import { DEFAULT_VARIANT } from './consts';\nimport type { IdentifierValue } from './types';\n\nexport class RecursionLimitError extends Error {\n  constructor() {\n    super('Dynamic resolve recursion limit reached');\n  }\n}\n\nexport class CircularDependencyError extends Error {\n  constructor(public readonly dependencyStack: IdentifierValue[]) {\n    super(\n      `A circular dependency was detected.\\n` +\n        stringifyDependencyStack(dependencyStack)\n    );\n  }\n}\n\nexport class ComponentNotFoundError extends Error {\n  constructor(public readonly identifier: IdentifierValue) {\n    super(\n      `Component ${stringifyIdentifier(identifier)} not found in container`\n    );\n  }\n}\n\nexport class MissingDependencyError extends Error {\n  constructor(\n    public readonly from: IdentifierValue,\n    public readonly target: IdentifierValue,\n    public readonly dependencyStack: IdentifierValue[]\n  ) {\n    super(\n      `Missing dependency ${stringifyIdentifier(\n        target\n      )} in creating ${stringifyIdentifier(\n        from\n      )}.\\n${stringifyDependencyStack(dependencyStack)}`\n    );\n  }\n}\n\nexport class DuplicateDefinitionError extends Error {\n  constructor(public readonly identifier: IdentifierValue) {\n    super(`${stringifyIdentifier(identifier)} already exists`);\n  }\n}\n\nfunction stringifyIdentifier(identifier: IdentifierValue) {\n  return `[${identifier.identifierName}]${\n    identifier.variant !== DEFAULT_VARIANT ? `(${identifier.variant})` : ''\n  }`;\n}\n\nfunction stringifyDependencyStack(dependencyStack: IdentifierValue[]) {\n  return dependencyStack\n    .map(identifier => `${stringifyIdentifier(identifier)}`)\n    .join(' -> ');\n}\n","import { DebugLogger } from '@affine/debug';\n\nimport { stableHash } from '../../utils';\nimport type { FrameworkProvider } from '.';\nimport type { Service } from './components/service';\nimport { SUB_COMPONENTS } from './consts';\nimport { createIdentifier } from './identifier';\nimport type { SubComponent } from './types';\n\nexport interface FrameworkEvent<T> {\n  id: string;\n  _type: T;\n}\n\nexport function createEvent<T>(id: string): FrameworkEvent<T> {\n  return { id, _type: {} as T };\n}\n\nexport type FrameworkEventType<T> =\n  T extends FrameworkEvent<infer E> ? E : never;\n\nconst logger = new DebugLogger('affine:event-bus');\n\nexport class EventBus {\n  private listeners: Record<string, Array<(payload: any) => void>> = {};\n\n  constructor(\n    provider: FrameworkProvider,\n    private readonly parent?: EventBus\n  ) {\n    const handlers = provider.getAll(EventHandler, {\n      sameScope: true,\n    });\n\n    for (const handler of handlers.values()) {\n      this.on(handler.event.id, handler.handler);\n    }\n  }\n\n  get root(): EventBus {\n    return this.parent?.root ?? this;\n  }\n\n  on<T>(id: string, listener: (event: FrameworkEvent<T>) => void) {\n    if (!this.listeners[id]) {\n      this.listeners[id] = [];\n    }\n    this.listeners[id].push(listener);\n    const off = this.parent?.on(id, listener);\n    return () => {\n      this.off(id, listener);\n      off?.();\n    };\n  }\n\n  off<T>(id: string, listener: (event: FrameworkEvent<T>) => void) {\n    if (!this.listeners[id]) {\n      return;\n    }\n    this.listeners[id] = this.listeners[id].filter(l => l !== listener);\n  }\n\n  emit<T>(event: FrameworkEvent<T>, payload: T) {\n    logger.debug('Emitting event', event.id, payload);\n    const listeners = this.listeners[event.id];\n    if (!listeners) {\n      return;\n    }\n    listeners.forEach(listener => {\n      try {\n        listener(payload);\n      } catch (e) {\n        console.error(e);\n      }\n    });\n  }\n}\n\ninterface EventHandler {\n  event: FrameworkEvent<any>;\n  handler: (payload: any) => void;\n}\n\nexport const EventHandler = createIdentifier<EventHandler>('EventHandler');\n\nexport const OnEvent = <\n  E extends FrameworkEvent<any>,\n  C extends abstract new (...args: any) => any,\n  I = InstanceType<C>,\n>(\n  e: E,\n  pick: I extends Service ? (i: I) => (e: FrameworkEventType<E>) => void : never\n) => {\n  return (target: C): C => {\n    const handlers = (target as any)[SUB_COMPONENTS] ?? [];\n    (target as any)[SUB_COMPONENTS] = [\n      ...handlers,\n      {\n        identifier: EventHandler(\n          target.name + stableHash(e) + stableHash(pick)\n        ),\n        factory: provider => {\n          return {\n            event: e,\n            handler: (payload: any) => {\n              const i = provider.get(target);\n              pick(i).apply(i, [payload]);\n            },\n          } satisfies EventHandler;\n        },\n      } satisfies SubComponent,\n    ];\n    return target;\n  };\n};\n","import type { Component } from './components/component';\nimport type { Entity } from './components/entity';\nimport type { Scope } from './components/scope';\nimport { withContext } from './constructor-context';\nimport {\n  CircularDependencyError,\n  ComponentNotFoundError,\n  MissingDependencyError,\n  RecursionLimitError,\n} from './error';\nimport { EventBus, type FrameworkEvent } from './event';\nimport type { Framework } from './framework';\nimport { parseIdentifier } from './identifier';\nimport type {\n  ComponentVariant,\n  FrameworkScopeStack,\n  GeneralIdentifier,\n  IdentifierValue,\n} from './types';\n\nexport interface ResolveOptions {\n  sameScope?: boolean;\n  optional?: boolean;\n  noCache?: boolean;\n  props?: any;\n}\n\nexport abstract class FrameworkProvider {\n  abstract collection: Framework;\n  abstract scope: FrameworkScopeStack;\n  abstract getRaw(identifier: IdentifierValue, options?: ResolveOptions): any;\n  abstract getAllRaw(\n    identifier: IdentifierValue,\n    options?: ResolveOptions\n  ): Map<ComponentVariant, any>;\n  abstract dispose(): void;\n  abstract eventBus: EventBus;\n\n  get = <T>(identifier: GeneralIdentifier<T>, options?: ResolveOptions): T => {\n    return this.getRaw(parseIdentifier(identifier), {\n      ...options,\n      optional: false,\n    });\n  };\n\n  getAll = <T>(\n    identifier: GeneralIdentifier<T>,\n    options?: ResolveOptions\n  ): Map<ComponentVariant, T> => {\n    return this.getAllRaw(parseIdentifier(identifier), {\n      ...options,\n    });\n  };\n\n  getOptional = <T>(\n    identifier: GeneralIdentifier<T>,\n    options?: ResolveOptions\n  ): T | null => {\n    return this.getRaw(parseIdentifier(identifier), {\n      ...options,\n      optional: true,\n    });\n  };\n\n  createEntity = <\n    T extends Entity<any>,\n    Props extends T extends Component<infer P> ? P : never,\n  >(\n    identifier: GeneralIdentifier<T>,\n    ...[props]: Props extends Record<string, never> ? [] : [Props]\n  ): T => {\n    return this.getRaw(parseIdentifier(identifier), {\n      noCache: true,\n      sameScope: true,\n      props,\n    });\n  };\n\n  createScope = <\n    T extends Scope<any>,\n    Props extends T extends Component<infer P> ? P : never,\n  >(\n    root: GeneralIdentifier<T>,\n    ...[props]: Props extends Record<string, never> ? [] : [Props]\n  ): T => {\n    const newProvider = this.collection.provider(\n      [...this.scope, parseIdentifier(root).identifierName],\n      this\n    );\n    return newProvider.getRaw(parseIdentifier(root), {\n      sameScope: true,\n      props,\n    });\n  };\n\n  emitEvent = <T>(event: FrameworkEvent<T>, payload: T) => {\n    this.eventBus.emit(event, payload);\n  };\n\n  [Symbol.dispose]() {\n    this.dispose();\n  }\n}\n\nexport class ComponentCachePool {\n  cache: Map<string, Map<ComponentVariant, any>> = new Map();\n\n  getOrInsert(identifier: IdentifierValue, insert: () => any) {\n    const cache = this.cache.get(identifier.identifierName) ?? new Map();\n    if (!cache.has(identifier.variant)) {\n      cache.set(identifier.variant, insert());\n    }\n    const cached = cache.get(identifier.variant);\n    this.cache.set(identifier.identifierName, cache);\n    return cached;\n  }\n\n  dispose() {\n    for (const t of this.cache.values()) {\n      for (const i of t.values()) {\n        if (typeof i === 'object' && typeof i[Symbol.dispose] === 'function') {\n          try {\n            i[Symbol.dispose]();\n          } catch (err) {\n            setImmediate(() => {\n              throw err;\n            });\n          }\n        }\n      }\n    }\n  }\n\n  [Symbol.dispose]() {\n    this.dispose();\n  }\n}\n\nclass Resolver extends FrameworkProvider {\n  constructor(\n    public readonly provider: BasicFrameworkProvider,\n    public readonly depth = 0,\n    public readonly stack: IdentifierValue[] = []\n  ) {\n    super();\n  }\n\n  scope = this.provider.scope;\n  collection = this.provider.collection;\n  eventBus = this.provider.eventBus;\n\n  getRaw(\n    identifier: IdentifierValue,\n    {\n      sameScope = false,\n      optional = false,\n      noCache = false,\n      props,\n    }: ResolveOptions = {}\n  ) {\n    const factory = this.provider.collection.getFactory(\n      identifier,\n      this.provider.scope\n    );\n    if (!factory) {\n      if (this.provider.parent && !sameScope) {\n        return this.provider.parent.getRaw(identifier, {\n          sameScope: sameScope,\n          optional,\n          noCache,\n          props,\n        });\n      }\n\n      if (optional) {\n        return undefined;\n      }\n      throw new ComponentNotFoundError(identifier);\n    }\n\n    const runFactory = () => {\n      const nextResolver = this.track(identifier);\n      try {\n        return withContext(() => factory(nextResolver), {\n          provider: this.provider,\n          props,\n        });\n      } catch (err) {\n        if (err instanceof ComponentNotFoundError) {\n          throw new MissingDependencyError(\n            identifier,\n            err.identifier,\n            this.stack\n          );\n        }\n        throw err;\n      }\n    };\n\n    if (noCache) {\n      return runFactory();\n    }\n\n    return this.provider.cache.getOrInsert(identifier, runFactory);\n  }\n\n  getAllRaw(\n    identifier: IdentifierValue,\n    { sameScope = false, noCache, props }: ResolveOptions = {}\n  ): Map<ComponentVariant, any> {\n    const vars = this.provider.collection.getFactoryAll(\n      identifier,\n      this.provider.scope\n    );\n\n    if (vars === undefined) {\n      if (this.provider.parent && !sameScope) {\n        return this.provider.parent.getAllRaw(identifier);\n      }\n\n      return new Map();\n    }\n\n    const result = new Map<ComponentVariant, any>();\n\n    for (const [variant, factory] of vars) {\n      // eslint-disable-next-line sonarjs/no-identical-functions\n      const runFactory = () => {\n        const nextResolver = this.track(identifier);\n        try {\n          return withContext(() => factory(nextResolver), {\n            provider: this.provider,\n            props,\n          });\n        } catch (err) {\n          if (err instanceof ComponentNotFoundError) {\n            throw new MissingDependencyError(\n              identifier,\n              err.identifier,\n              this.stack\n            );\n          }\n          throw err;\n        }\n      };\n      let service;\n      if (noCache) {\n        service = runFactory();\n      } else {\n        service = this.provider.cache.getOrInsert(\n          {\n            identifierName: identifier.identifierName,\n            variant,\n          },\n          runFactory\n        );\n      }\n      result.set(variant, service);\n    }\n\n    return result;\n  }\n\n  track(identifier: IdentifierValue): Resolver {\n    const depth = this.depth + 1;\n    if (depth >= 100) {\n      throw new RecursionLimitError();\n    }\n    const circular = this.stack.find(\n      i =>\n        i.identifierName === identifier.identifierName &&\n        i.variant === identifier.variant\n    );\n    if (circular) {\n      throw new CircularDependencyError([...this.stack, identifier]);\n    }\n\n    return new Resolver(this.provider, depth, [...this.stack, identifier]);\n  }\n\n  override dispose(): void {}\n}\n\nexport class BasicFrameworkProvider extends FrameworkProvider {\n  public readonly cache = new ComponentCachePool();\n  public readonly collection: Framework;\n  public readonly eventBus: EventBus;\n\n  disposed = false;\n\n  constructor(\n    collection: Framework,\n    public readonly scope: string[],\n    public readonly parent: FrameworkProvider | null\n  ) {\n    super();\n    this.collection = collection;\n    this.eventBus = new EventBus(this, this.parent?.eventBus);\n  }\n\n  getRaw(identifier: IdentifierValue, options?: ResolveOptions) {\n    const resolver = new Resolver(this);\n    return resolver.getRaw(identifier, options);\n  }\n\n  getAllRaw(\n    identifier: IdentifierValue,\n    options?: ResolveOptions\n  ): Map<ComponentVariant, any> {\n    const resolver = new Resolver(this);\n    return resolver.getAllRaw(identifier, options);\n  }\n\n  dispose(): void {\n    if (this.disposed) {\n      return;\n    }\n    this.disposed = true;\n    this.cache.dispose();\n  }\n}\n","import type { FrameworkScopeStack } from './types';\n\nexport function stringifyScope(scope: FrameworkScopeStack): string {\n  return scope.join('/');\n}\n","import type { Component } from './components/component';\nimport type { Entity } from './components/entity';\nimport type { Scope } from './components/scope';\nimport type { Service } from './components/service';\nimport type { Store } from './components/store';\nimport { DEFAULT_VARIANT, ROOT_SCOPE, SUB_COMPONENTS } from './consts';\nimport { DuplicateDefinitionError } from './error';\nimport { parseIdentifier } from './identifier';\nimport type { FrameworkProvider } from './provider';\nimport { BasicFrameworkProvider } from './provider';\nimport { stringifyScope } from './scope';\nimport type {\n  ComponentFactory,\n  ComponentVariant,\n  FrameworkScopeStack,\n  GeneralIdentifier,\n  Identifier,\n  IdentifierType,\n  IdentifierValue,\n  SubComponent,\n  Type,\n  TypesToDeps,\n} from './types';\n\nexport class Framework {\n  private readonly components: Map<\n    string,\n    Map<string, Map<ComponentVariant, ComponentFactory>>\n  > = new Map();\n\n  /**\n   * Create an empty framework.\n   *\n   * same as `new Framework()`\n   */\n  static get EMPTY() {\n    return new Framework();\n  }\n\n  /**\n   * The number of components in the framework.\n   */\n  get componentCount() {\n    let count = 0;\n    for (const [, identifiers] of this.components) {\n      for (const [, variants] of identifiers) {\n        count += variants.size;\n      }\n    }\n    return count;\n  }\n\n  /**\n   * @see {@link FrameworkEditor.service}\n   */\n  get service() {\n    return new FrameworkEditor(this).service;\n  }\n\n  /**\n   * @see {@link FrameworkEditor.impl}\n   */\n  get impl() {\n    return new FrameworkEditor(this).impl;\n  }\n\n  /**\n   * @see {@link FrameworkEditor.entity}\n   */\n  get entity() {\n    return new FrameworkEditor(this).entity;\n  }\n\n  /**\n   * @see {@link FrameworkEditor.scope}\n   */\n  get scope() {\n    return new FrameworkEditor(this).scope;\n  }\n\n  /**\n   * @see {@link FrameworkEditor.override}\n   */\n  get override() {\n    return new FrameworkEditor(this).override;\n  }\n\n  /**\n   * @see {@link FrameworkEditor.store}\n   */\n  get store() {\n    return new FrameworkEditor(this).store;\n  }\n\n  /**\n   * @internal Use {@link impl} instead.\n   */\n  addValue<T>(\n    identifier: GeneralIdentifier<T>,\n    value: T,\n    {\n      scope,\n      override,\n    }: { scope?: FrameworkScopeStack; override?: boolean } = {}\n  ) {\n    this.addFactory(parseIdentifier(identifier) as Identifier<T>, () => value, {\n      scope,\n      override,\n    });\n  }\n\n  /**\n   * @internal Use {@link impl} instead.\n   */\n  addFactory<T>(\n    identifier: GeneralIdentifier<T>,\n    factory: ComponentFactory<T>,\n    {\n      scope,\n      override,\n    }: { scope?: FrameworkScopeStack; override?: boolean } = {}\n  ) {\n    // convert scope to string\n    const normalizedScope = stringifyScope(scope ?? ROOT_SCOPE);\n    const normalizedIdentifier = parseIdentifier(identifier);\n    const normalizedVariant = normalizedIdentifier.variant ?? DEFAULT_VARIANT;\n\n    const services =\n      this.components.get(normalizedScope) ??\n      new Map<string, Map<ComponentVariant, ComponentFactory>>();\n\n    const variants =\n      services.get(normalizedIdentifier.identifierName) ??\n      new Map<ComponentVariant, ComponentFactory>();\n\n    // throw if service already exists, unless it is an override\n    if (variants.has(normalizedVariant) && !override) {\n      throw new DuplicateDefinitionError(normalizedIdentifier);\n    }\n    variants.set(normalizedVariant, factory);\n    services.set(normalizedIdentifier.identifierName, variants);\n    this.components.set(normalizedScope, services);\n  }\n\n  remove(identifier: IdentifierValue, scope: FrameworkScopeStack = ROOT_SCOPE) {\n    const normalizedScope = stringifyScope(scope);\n    const normalizedIdentifier = parseIdentifier(identifier);\n    const normalizedVariant = normalizedIdentifier.variant ?? DEFAULT_VARIANT;\n\n    const services = this.components.get(normalizedScope);\n    if (!services) {\n      return;\n    }\n\n    const variants = services.get(normalizedIdentifier.identifierName);\n    if (!variants) {\n      return;\n    }\n\n    variants.delete(normalizedVariant);\n  }\n\n  /**\n   * Create a service provider from the collection.\n   *\n   * @example\n   * ```ts\n   * provider() // create a service provider for root scope\n   * provider(ScopeA, parentProvider) // create a service provider for scope A\n   * ```\n   *\n   * @param scope The scope of the service provider, default to the root scope.\n   * @param parent The parent service provider, it is required if the scope is not the root scope.\n   */\n  provider(\n    scope: FrameworkScopeStack = ROOT_SCOPE,\n    parent: FrameworkProvider | null = null\n  ): FrameworkProvider {\n    return new BasicFrameworkProvider(this, scope, parent);\n  }\n\n  /**\n   * @internal\n   */\n  getFactory(\n    identifier: IdentifierValue,\n    scope: FrameworkScopeStack = ROOT_SCOPE\n  ): ComponentFactory | undefined {\n    return this.components\n      .get(stringifyScope(scope))\n      ?.get(identifier.identifierName)\n      ?.get(identifier.variant ?? DEFAULT_VARIANT);\n  }\n\n  /**\n   * @internal\n   */\n  getFactoryAll(\n    identifier: IdentifierValue,\n    scope: FrameworkScopeStack = ROOT_SCOPE\n  ): Map<ComponentVariant, ComponentFactory> {\n    return new Map(\n      this.components.get(stringifyScope(scope))?.get(identifier.identifierName)\n    );\n  }\n\n  /**\n   * Clone the entire service collection.\n   *\n   * This method is quite cheap as it only clones the references.\n   *\n   * @returns A new service collection with the same services.\n   */\n  clone(): Framework {\n    const di = new Framework();\n    for (const [scope, identifiers] of this.components) {\n      const s = new Map();\n      for (const [identifier, variants] of identifiers) {\n        s.set(identifier, new Map(variants));\n      }\n      di.components.set(scope, s);\n    }\n    return di;\n  }\n}\n\n/**\n * A helper class to edit a framework.\n */\nclass FrameworkEditor {\n  private currentScopeStack: FrameworkScopeStack = ROOT_SCOPE;\n\n  constructor(private readonly collection: Framework) {}\n\n  /**\n   * Add a service to the framework.\n   *\n   * @see {@link Framework}\n   *\n   * @example\n   * ```ts\n   * service(ServiceClass, [dependencies, ...])\n   * ```\n   */\n  service = <\n    Arg1 extends Type<Service>,\n    Arg2 extends Deps | ComponentFactory<ServiceType> | ServiceType,\n    ServiceType = IdentifierType<Arg1>,\n    Deps = Arg1 extends Type<ServiceType>\n      ? TypesToDeps<ConstructorParameters<Arg1>>\n      : [],\n  >(\n    service: Arg1,\n    ...[arg2]: Arg2 extends [] ? [] : [Arg2]\n  ): this => {\n    if (arg2 instanceof Function) {\n      this.collection.addFactory<any>(service as any, arg2 as any, {\n        scope: this.currentScopeStack,\n      });\n    } else if (arg2 instanceof Array || arg2 === undefined) {\n      this.collection.addFactory<any>(\n        service as any,\n        dependenciesToFactory(service, arg2 as any),\n        { scope: this.currentScopeStack }\n      );\n    } else {\n      this.collection.addValue<any>(service as any, arg2, {\n        scope: this.currentScopeStack,\n      });\n    }\n\n    if (SUB_COMPONENTS in service) {\n      const subComponents = (service as any)[SUB_COMPONENTS] as SubComponent[];\n      for (const { identifier, factory } of subComponents) {\n        this.collection.addFactory(identifier, factory, {\n          scope: this.currentScopeStack,\n        });\n      }\n    }\n\n    return this;\n  };\n\n  /**\n   * Add a store to the framework.\n   *\n   * @see {@link Framework}\n   *\n   * @example\n   * ```ts\n   * store(StoreClass, [dependencies, ...])\n   * ```\n   */\n  store = <\n    Arg1 extends Type<Store>,\n    Arg2 extends Deps | ComponentFactory<StoreType> | StoreType,\n    StoreType = IdentifierType<Arg1>,\n    Deps = Arg1 extends Type<StoreType>\n      ? TypesToDeps<ConstructorParameters<Arg1>>\n      : [],\n  >(\n    store: Arg1,\n    ...[arg2]: Arg2 extends [] ? [] : [Arg2]\n  ): this => {\n    if (arg2 instanceof Function) {\n      this.collection.addFactory<any>(store as any, arg2 as any, {\n        scope: this.currentScopeStack,\n      });\n    } else if (arg2 instanceof Array || arg2 === undefined) {\n      this.collection.addFactory<any>(\n        store as any,\n        dependenciesToFactory(store, arg2 as any),\n        { scope: this.currentScopeStack }\n      );\n    } else {\n      this.collection.addValue<any>(store as any, arg2, {\n        scope: this.currentScopeStack,\n      });\n    }\n\n    if (SUB_COMPONENTS in store) {\n      const subComponents = (store as any)[SUB_COMPONENTS] as SubComponent[];\n      for (const { identifier, factory } of subComponents) {\n        this.collection.addFactory(identifier, factory, {\n          scope: this.currentScopeStack,\n        });\n      }\n    }\n\n    return this;\n  };\n\n  /**\n   * Add an entity to the framework.\n   */\n  entity = <\n    Arg1 extends Type<Entity<any>>,\n    Arg2 extends Deps | ComponentFactory<EntityType>,\n    EntityType = IdentifierType<Arg1>,\n    Deps = Arg1 extends Type<EntityType>\n      ? TypesToDeps<ConstructorParameters<Arg1>>\n      : [],\n  >(\n    entity: Arg1,\n    ...[arg2]: Arg2 extends [] ? [] : [Arg2]\n  ): this => {\n    if (arg2 instanceof Function) {\n      this.collection.addFactory<any>(entity as any, arg2 as any, {\n        scope: this.currentScopeStack,\n      });\n    } else {\n      this.collection.addFactory<any>(\n        entity as any,\n        dependenciesToFactory(entity, arg2 as any),\n        { scope: this.currentScopeStack }\n      );\n    }\n\n    return this;\n  };\n\n  /**\n   * Add an implementation for identifier to the collection.\n   *\n   * @see {@link Framework}\n   *\n   * @example\n   * ```ts\n   * addImpl(Identifier, Class, [dependencies, ...])\n   * or\n   * addImpl(Identifier, Instance)\n   * or\n   * addImpl(Identifier, Factory)\n   * ```\n   */\n  impl = <\n    Arg1 extends Identifier<any>,\n    Arg2 extends Type<Trait> | ComponentFactory<Trait> | Trait,\n    Arg3 extends Deps,\n    Trait = IdentifierType<Arg1>,\n    Deps = Arg2 extends Type<Trait>\n      ? TypesToDeps<ConstructorParameters<Arg2>>\n      : [],\n  >(\n    identifier: Arg1,\n    arg2: Arg2,\n    ...[arg3]: Arg3 extends [] ? [] : [Arg3]\n  ): this => {\n    if (arg2 instanceof Function) {\n      this.collection.addFactory<any>(\n        identifier,\n        dependenciesToFactory(arg2, arg3 as any[]),\n        { scope: this.currentScopeStack }\n      );\n    } else {\n      this.collection.addValue(identifier, arg2 as any, {\n        scope: this.currentScopeStack,\n      });\n    }\n\n    return this;\n  };\n\n  /**\n   * same as {@link impl} but this method will override the component if it exists.\n   *\n   * @see {@link Framework}\n   *\n   * @example\n   * ```ts\n   * override(OriginClass, NewClass, [dependencies, ...])\n   * or\n   * override(Identifier, Class, [dependencies, ...])\n   * or\n   * override(Identifier, Instance)\n   * or\n   * override(Identifier, Factory)\n   * ```\n   */\n  override = <\n    Arg1 extends GeneralIdentifier<any>,\n    Arg2 extends Type<Trait> | ComponentFactory<Trait> | Trait | null,\n    Arg3 extends Deps,\n    Trait extends Component = IdentifierType<Arg1>,\n    Deps = Arg2 extends Type<Trait>\n      ? TypesToDeps<ConstructorParameters<Arg2>>\n      : [],\n  >(\n    identifier: Arg1,\n    arg2: Arg2,\n    ...[arg3]: Arg3 extends [] ? [] : [Arg3]\n  ): this => {\n    if (arg2 === null) {\n      this.collection.remove(\n        parseIdentifier(identifier),\n        this.currentScopeStack\n      );\n      return this;\n    } else if (arg2 instanceof Function) {\n      this.collection.addFactory<any>(\n        identifier,\n        dependenciesToFactory(arg2, arg3 as any[]),\n        { scope: this.currentScopeStack, override: true }\n      );\n    } else {\n      this.collection.addValue(identifier, arg2 as any, {\n        scope: this.currentScopeStack,\n        override: true,\n      });\n    }\n\n    return this;\n  };\n\n  /**\n   * Set the scope for the service registered subsequently\n   *\n   * @example\n   *\n   * ```ts\n   * const ScopeA = createScope('a');\n   *\n   * services.scope(ScopeA).add(XXXService, ...);\n   * ```\n   */\n  scope = (scope: Type<Scope<any>>): this => {\n    this.currentScopeStack = [\n      ...this.currentScopeStack,\n      parseIdentifier(scope).identifierName,\n    ];\n\n    this.collection.addFactory<any>(\n      scope as any,\n      dependenciesToFactory(scope, [] as any),\n      { scope: this.currentScopeStack, override: true }\n    );\n\n    return this;\n  };\n}\n\n/**\n * Convert dependencies definition to a factory function.\n */\nfunction dependenciesToFactory(\n  cls: any,\n  deps: any[] = []\n): ComponentFactory<any> {\n  return (provider: FrameworkProvider) => {\n    const args = [];\n    for (const dep of deps) {\n      let isAll;\n      let identifier;\n      if (Array.isArray(dep)) {\n        if (dep.length !== 1) {\n          throw new Error('Invalid dependency');\n        }\n        isAll = true;\n        identifier = dep[0];\n      } else {\n        isAll = false;\n        identifier = dep;\n      }\n      if (isAll) {\n        args.push(Array.from(provider.getAll(identifier).values()));\n      } else {\n        args.push(provider.get(identifier));\n      }\n    }\n    if (isConstructor(cls)) {\n      return new cls(...args, provider);\n    } else {\n      return cls(...args, provider);\n    }\n  };\n}\n\n// a hack to check if a function is a constructor\n// https://github.com/zloirock/core-js/blob/232c8462c26c75864b4397b7f643a4f57c6981d5/packages/core-js/internals/is-constructor.js#L15\nfunction isConstructor(cls: any) {\n  try {\n    Reflect.construct(function () {}, [], cls);\n    return true;\n  } catch (error) {\n    return false;\n  }\n}\n","import { stableHash } from '../../utils/stable-hash';\nimport type { Component } from './components/component';\nimport { DEFAULT_VARIANT } from './consts';\nimport type {\n  ComponentVariant,\n  Identifier,\n  IdentifierValue,\n  Type,\n} from './types';\n\n/**\n * create a Identifier.\n *\n * Identifier is used to identify a certain type of service. With the identifier, you can reference one or more services\n * without knowing the specific implementation, thereby achieving\n * [inversion of control](https://en.wikipedia.org/wiki/Inversion_of_control).\n *\n * @example\n * ```ts\n * // define a interface\n * interface Storage {\n *   get(key: string): string | null;\n *   set(key: string, value: string): void;\n * }\n *\n * // create a identifier\n * // NOTICE: Highly recommend to use the interface name as the identifier name,\n * // so that it is easy to understand. and it is legal to do so in TypeScript.\n * const Storage = createIdentifier<Storage>('Storage');\n *\n * // create a implementation\n * class LocalStorage implements Storage {\n *   get(key: string): string | null {\n *     return localStorage.getItem(key);\n *   }\n *   set(key: string, value: string): void {\n *     localStorage.setItem(key, value);\n *   }\n * }\n *\n * // register the implementation to the identifier\n * framework.impl(Storage, LocalStorage);\n *\n * // get the implementation from the identifier\n * const storage = framework.provider().get(Storage);\n * storage.set('foo', 'bar');\n * ```\n *\n * With identifier:\n *\n * * You can easily replace the implementation of a `Storage` without changing the code that uses it.\n * * You can easily mock a `Storage` for testing.\n *\n * # Variant\n *\n * Sometimes, you may want to register multiple implementations for the same interface.\n * For example, you may want have both `LocalStorage` and `SessionStorage` for `Storage`,\n * and use them in same time.\n *\n * In this case, you can use `variant` to distinguish them.\n *\n * ```ts\n * const Storage = createIdentifier<Storage>('Storage');\n * const LocalStorage = Storage('local');\n * const SessionStorage = Storage('session');\n *\n * framework.impl(LocalStorage, LocalStorageImpl);\n * framework.impl(SessionStorage, SessionStorageImpl);\n *\n * // get the implementation from the identifier\n * const localStorage = framework.provider().get(LocalStorage);\n * const sessionStorage = framework.provider().get(SessionStorage);\n * const storage = framework.provider().getAll(Storage); // { local: LocalStorageImpl, session: SessionStorageImpl }\n * ```\n *\n * @param name unique name of the identifier.\n * @param variant The default variant name of the identifier, can be overridden by `identifier(\"variant\")`.\n */\nexport function createIdentifier<T>(\n  name: string,\n  variant: ComponentVariant = DEFAULT_VARIANT\n): Identifier<T> & ((variant: ComponentVariant) => Identifier<T>) {\n  return Object.assign(\n    (variant: ComponentVariant) => {\n      return createIdentifier<T>(name, variant);\n    },\n    {\n      identifierName: name,\n      variant,\n    }\n  ) as any;\n}\n\n/**\n * Convert the constructor into a ServiceIdentifier.\n * As we always deal with ServiceIdentifier in the DI container.\n *\n * @internal\n */\nexport function createIdentifierFromConstructor<T extends Component>(\n  target: Type<T>\n): Identifier<T> {\n  return createIdentifier<T>(`${target.name}${stableHash(target)}`);\n}\n\nexport function parseIdentifier(input: any): IdentifierValue {\n  if (input.identifierName) {\n    return input as IdentifierValue;\n  } else if (typeof input === 'function' && input.name) {\n    return createIdentifierFromConstructor(input);\n  } else {\n    throw new Error('Input is not a service identifier.');\n  }\n}\n","import React, { useContext, useMemo } from 'react';\n\nimport type { FrameworkProvider, Scope, Service } from '../core';\nimport { ComponentNotFoundError, Framework } from '../core';\nimport { parseIdentifier } from '../core/identifier';\nimport type { GeneralIdentifier, IdentifierType, Type } from '../core/types';\nimport { MountPoint } from './scope-root-components';\n\nexport { useMount } from './scope-root-components';\n\nexport const FrameworkStackContext = React.createContext<FrameworkProvider[]>([\n  Framework.EMPTY.provider(),\n]);\n\nexport function useFramework(): FrameworkProvider {\n  const stack = useContext(FrameworkStackContext);\n\n  return stack[stack.length - 1]; // never null, because the default value\n}\n\nexport function useService<T extends Service>(\n  identifier: GeneralIdentifier<T>\n): T {\n  const stack = useContext(FrameworkStackContext);\n\n  let service: T | null = null;\n\n  for (let i = stack.length - 1; i >= 0; i--) {\n    service = stack[i].getOptional(identifier, {\n      sameScope: true,\n    });\n\n    if (service) {\n      break;\n    }\n  }\n\n  if (!service) {\n    throw new ComponentNotFoundError(parseIdentifier(identifier));\n  }\n\n  return service;\n}\n\n/**\n * Hook to get services from the current framework stack.\n *\n * Automatically converts the service name to camelCase.\n *\n * @example\n * ```ts\n * const { authService, userService } = useServices({ AuthService, UserService });\n * ```\n */\nexport function useServices<\n  const T extends { [key in string]: GeneralIdentifier<Service> },\n>(\n  identifiers: T\n): keyof T extends string\n  ? { [key in Uncapitalize<keyof T>]: IdentifierType<T[Capitalize<key>]> }\n  : never {\n  const stack = useContext(FrameworkStackContext);\n\n  const services: any = {};\n\n  for (const [key, value] of Object.entries(identifiers)) {\n    let service;\n    for (let i = stack.length - 1; i >= 0; i--) {\n      service = stack[i].getOptional(value, {\n        sameScope: true,\n      });\n\n      if (service) {\n        break;\n      }\n    }\n\n    if (!service) {\n      throw new ComponentNotFoundError(parseIdentifier(value));\n    }\n\n    services[key.charAt(0).toLowerCase() + key.slice(1)] = service;\n  }\n\n  return services;\n}\n\nexport function useServiceOptional<T extends Service>(\n  identifier: Type<T>\n): T | null {\n  const stack = useContext(FrameworkStackContext);\n\n  let service: T | null = null;\n\n  for (let i = stack.length - 1; i >= 0; i--) {\n    service = stack[i].getOptional(identifier, {\n      sameScope: true,\n    });\n\n    if (service) {\n      break;\n    }\n  }\n\n  return service;\n}\n\nexport const FrameworkRoot = ({\n  framework,\n  children,\n}: React.PropsWithChildren<{ framework: FrameworkProvider }>) => {\n  return (\n    <FrameworkStackContext.Provider value={[framework]}>\n      {children}\n    </FrameworkStackContext.Provider>\n  );\n};\n\nexport const FrameworkScope = ({\n  scope,\n  children,\n}: React.PropsWithChildren<{ scope?: Scope }>) => {\n  const stack = useContext(FrameworkStackContext);\n\n  const nextStack = useMemo(() => {\n    if (!scope) return stack;\n    return [...stack, scope.framework];\n  }, [stack, scope]);\n\n  return (\n    <FrameworkStackContext.Provider value={nextStack}>\n      <MountPoint>{children}</MountPoint>\n    </FrameworkStackContext.Provider>\n  );\n};\n","import React from 'react';\n\ntype NodesMap = Map<\n  number,\n  {\n    node: React.ReactNode;\n    debugKey?: string;\n  }\n>;\n\nconst ScopeRootComponentsContext = React.createContext<{\n  nodes: NodesMap;\n  setNodes: React.Dispatch<React.SetStateAction<NodesMap>>;\n}>({ nodes: new Map(), setNodes: () => {} });\n\nlet _id = 0;\n/**\n * A hook to add nodes to the nearest scope's root\n */\nexport const useMount = (debugKey?: string) => {\n  const [id] = React.useState(_id++);\n  const { setNodes } = React.useContext(ScopeRootComponentsContext);\n\n  const unmount = React.useCallback(() => {\n    setNodes(prev => {\n      if (!prev.has(id)) {\n        return prev;\n      }\n      const next = new Map(prev);\n      next.delete(id);\n      return next;\n    });\n  }, [id, setNodes]);\n\n  const mount = React.useCallback(\n    (node: React.ReactNode) => {\n      setNodes(prev => new Map(prev).set(id, { node, debugKey }));\n      return unmount;\n    },\n    [setNodes, id, debugKey, unmount]\n  );\n\n  return React.useMemo(() => {\n    return {\n      /**\n       * Add a node to the nearest scope root\n       * ```tsx\n       * const { mount } = useMount();\n       * useEffect(() => {\n       *  const unmount = mount(<div>Node</div>);\n       *  return unmount;\n       * }, [])\n       * ```\n       * @return A function to unmount the added node.\n       */\n      mount,\n    };\n  }, [mount]);\n};\n\nexport const MountPoint = ({ children }: React.PropsWithChildren) => {\n  const [nodes, setNodes] = React.useState<NodesMap>(new Map());\n\n  return (\n    <ScopeRootComponentsContext.Provider value={{ nodes, setNodes }}>\n      {children}\n      {Array.from(nodes.entries()).map(([id, { node, debugKey }]) => (\n        <div data-testid={debugKey} key={id} style={{ display: 'contents' }}>\n          {node}\n        </div>\n      ))}\n    </ScopeRootComponentsContext.Provider>\n  );\n};\n","import type { Doc } from '@blocksuite/store';\n\nexport function initEmptyPage(page: Doc, title?: string) {\n  page.load(() => {\n    const pageBlockId = page.addBlock(\n      'affine:page' as keyof BlockSuite.BlockModels,\n      {\n        title: new page.Text(title ?? ''),\n      }\n    );\n    page.addBlock(\n      'affine:surface' as keyof BlockSuite.BlockModels,\n      {},\n      pageBlockId\n    );\n    const noteBlockId = page.addBlock(\n      'affine:note' as keyof BlockSuite.BlockModels,\n      {},\n      pageBlockId\n    );\n    page.addBlock(\n      'affine:paragraph' as keyof BlockSuite.BlockModels,\n      {},\n      noteBlockId\n    );\n    page.history.clear();\n  });\n}\n","import { DebugLogger } from '@affine/debug';\nimport { Unreachable } from '@affine/env/constant';\nimport { type OperatorFunction, Subject } from 'rxjs';\n\nconst logger = new DebugLogger('effect');\n\nexport type Effect<T> = (T | undefined extends T // hack to detect if T is unknown\n  ? () => void\n  : (value: T) => void) & {\n  // unsubscribe effect, all ongoing effects will be cancelled.\n  unsubscribe: () => void;\n};\n\n/**\n * Create an effect.\n *\n * `effect( op1, op2, op3, ... )`\n *\n * You can think of an effect as a pipeline. When the effect is called, argument will be sent to the pipeline,\n * and the operators in the pipeline can be triggered.\n *\n *\n *\n * @example\n * ```ts\n * const loadUser = effect(\n *   switchMap((id: number) =>\n *     from(fetchUser(id)).pipe(\n *       mapInto(user$),\n *       catchErrorInto(error$),\n *       onStart(() => isLoading$.next(true)),\n *       onComplete(() => isLoading$.next(false))\n *     )\n *   )\n * );\n *\n * // emit value to effect\n * loadUser(1);\n *\n * // unsubscribe effect, will stop all ongoing processes\n * loadUser.unsubscribe();\n * ```\n */\nexport function effect<T, A>(op1: OperatorFunction<T, A>): Effect<T>;\nexport function effect<T, A, B>(\n  op1: OperatorFunction<T, A>,\n  op2: OperatorFunction<A, B>\n): Effect<T>;\nexport function effect<T, A, B, C>(\n  op1: OperatorFunction<T, A>,\n  op2: OperatorFunction<A, B>,\n  op3: OperatorFunction<B, C>\n): Effect<T>;\nexport function effect<T, A, B, C, D>(\n  op1: OperatorFunction<T, A>,\n  op2: OperatorFunction<A, B>,\n  op3: OperatorFunction<B, C>,\n  op4: OperatorFunction<C, D>\n): Effect<T>;\nexport function effect<T, A, B, C, D, E>(\n  op1: OperatorFunction<T, A>,\n  op2: OperatorFunction<A, B>,\n  op3: OperatorFunction<B, C>,\n  op4: OperatorFunction<C, D>,\n  op5: OperatorFunction<D, E>\n): Effect<T>;\nexport function effect<T, A, B, C, D, E, F>(\n  op1: OperatorFunction<T, A>,\n  op2: OperatorFunction<A, B>,\n  op3: OperatorFunction<B, C>,\n  op4: OperatorFunction<C, D>,\n  op5: OperatorFunction<D, E>,\n  op6: OperatorFunction<E, F>\n): Effect<T>;\nexport function effect(...args: any[]) {\n  const subject$ = new Subject<any>();\n\n  const effectLocation = environment.isDebug\n    ? `(${new Error().stack?.split('\\n')[2].trim()})`\n    : '';\n\n  class EffectError extends Unreachable {\n    constructor(message: string, value?: any) {\n      logger.error(`effect ${effectLocation} ${message}`, value);\n      super(\n        `effect ${effectLocation} ${message}` +\n          ` ${value ? (value instanceof Error ? (value.stack ?? value.message) : value + '') : ''}`\n      );\n    }\n  }\n\n  // eslint-disable-next-line prefer-spread\n  const subscription = subject$.pipe.apply(subject$, args as any).subscribe({\n    next(value) {\n      const error = new EffectError('should not emit value', value);\n      setImmediate(() => {\n        throw error;\n      });\n    },\n    complete() {\n      const error = new EffectError('effect unexpected complete');\n      setImmediate(() => {\n        throw error;\n      });\n    },\n    error(error) {\n      const effectError = new EffectError('effect uncaught error', error);\n      setImmediate(() => {\n        throw effectError;\n      });\n    },\n  });\n\n  const fn = (value: unknown) => {\n    subject$.next(value);\n  };\n\n  fn.unsubscribe = () => subscription.unsubscribe();\n\n  return fn as never;\n}\n","import { DebugLogger } from '@affine/debug';\nimport type {\n  InteropObservable,\n  Observer,\n  OperatorFunction,\n  Subscription,\n  TeardownLogic,\n  ThrottleConfig,\n} from 'rxjs';\nimport {\n  BehaviorSubject,\n  combineLatest,\n  distinctUntilChanged,\n  EMPTY,\n  map,\n  mergeMap,\n  Observable,\n  of,\n  scan,\n  skip,\n  Subject,\n  switchMap,\n  throttleTime,\n} from 'rxjs';\n\nconst logger = new DebugLogger('livedata');\n\n/**\n * LiveData is a reactive data type.\n *\n * ## basic usage\n *\n * @example\n * ```ts\n * const livedata = new LiveData(0); // create livedata with initial value\n *\n * livedata.next(1); // update value\n *\n * console.log(livedata.value); // get current value\n *\n * livedata.subscribe(v => { // subscribe to value changes\n *  console.log(v); // 1\n * });\n * ```\n *\n * ## observable\n *\n * LiveData is a rxjs observable, you can use rxjs operators.\n *\n * @example\n * ```ts\n * new LiveData(0).pipe(\n *   map(v => v + 1),\n *   filter(v => v > 1),\n *   ...\n * )\n * ```\n *\n * NOTICE: different from normal observable, LiveData will always emit the latest value when you subscribe to it.\n *\n * ## from observable\n *\n * LiveData can be created from observable or from other livedata.\n *\n * @example\n * ```ts\n * const A = LiveData.from(\n *   of(1, 2, 3, 4), // from observable\n *   0 // initial value\n * );\n *\n * const B = LiveData.from(\n *   A.pipe(map(v => 'from a ' + v)), // from other livedata\n *   '' // initial value\n * );\n * ```\n *\n * ## Why is it called LiveData\n *\n * This API is very similar to LiveData in Android, as both are based on Observable, so I named it LiveData.\n *\n * @see {@link https://rxjs.dev/api/index/class/BehaviorSubject}\n * @see {@link https://developer.android.com/topic/libraries/architecture/livedata}\n */\nexport class LiveData<T = unknown>\n  extends Observable<T>\n  implements InteropObservable<T>\n{\n  static from<T>(\n    upstream$:\n      | Observable<T>\n      | InteropObservable<T>\n      | ((stream: Observable<LiveDataOperation>) => Observable<T>),\n    initialValue: T\n  ): LiveData<T> {\n    const data$ = new LiveData(\n      initialValue,\n      typeof upstream$ === 'function'\n        ? upstream$\n        : stream$ =>\n            stream$.pipe(\n              mergeMap(v => {\n                if (v === 'set') {\n                  return EMPTY;\n                } else if (v === 'get') {\n                  return of('watch' as const, 'unwatch' as const);\n                } else {\n                  return of(v);\n                }\n              }),\n              scan((acc, op) => {\n                if (op === 'watch') {\n                  return acc + 1;\n                } else if (op === 'unwatch') {\n                  return acc - 1;\n                } else {\n                  return acc;\n                }\n              }, 0),\n              map(count => {\n                if (count > 0) {\n                  return 'watch';\n                } else {\n                  return 'unwatch';\n                }\n              }),\n              distinctUntilChanged(),\n              switchMap(op => {\n                if (op === 'watch') {\n                  return upstream$;\n                } else {\n                  return EMPTY;\n                }\n              })\n            )\n    );\n\n    return data$;\n  }\n\n  private static GLOBAL_COMPUTED_RECURSIVE_COUNT = 0;\n\n  /**\n   * @example\n   * ```ts\n   * const a = new LiveData('v1');\n   * const v1 = new LiveData(100);\n   * const v2 = new LiveData(200);\n   *\n   * const v = LiveData.computed(get => {\n   *   return get(a) === 'v1' ? get(v1) : get(v2);\n   * });\n   *\n   * expect(v.value).toBe(100);\n   * ```\n   */\n  static computed<T>(\n    compute: (get: <L>(data: LiveData<L>) => L) => T\n  ): LiveData<T> {\n    return LiveData.from(\n      new Observable(subscribe => {\n        const execute = (next: () => void) => {\n          const subscriptions: Subscription[] = [];\n          const getfn = <L>(data$: LiveData<L>) => {\n            let value = null as L;\n            let first = true;\n            subscriptions.push(\n              data$.subscribe({\n                error(err) {\n                  subscribe.error(err);\n                },\n                next(v) {\n                  value = v;\n                  if (!first) {\n                    next();\n                  }\n                  first = false;\n                },\n              })\n            );\n            return value;\n          };\n\n          LiveData.GLOBAL_COMPUTED_RECURSIVE_COUNT++;\n\n          try {\n            if (LiveData.GLOBAL_COMPUTED_RECURSIVE_COUNT > 10) {\n              subscribe.error(new Error('computed recursive limit exceeded'));\n            } else {\n              subscribe.next(compute(getfn));\n            }\n          } catch (err) {\n            subscribe.error(err);\n          } finally {\n            LiveData.GLOBAL_COMPUTED_RECURSIVE_COUNT--;\n          }\n\n          return () => {\n            subscriptions.forEach(s => s.unsubscribe());\n          };\n        };\n\n        let prev = () => {};\n\n        const looper = () => {\n          const dispose = execute(looper);\n          prev();\n          prev = dispose;\n        };\n\n        looper();\n\n        return () => {\n          prev();\n        };\n      }),\n      null as any\n    );\n  }\n\n  private readonly raw$: BehaviorSubject<T>;\n  private readonly ops$ = new Subject<LiveDataOperation>();\n  private readonly upstreamSubscription: Subscription | undefined;\n\n  /**\n   * When the upstream Observable of livedata throws an error, livedata will enter poisoned state. This is an\n   * unrecoverable abnormal state. Any operation on livedata will throw a PoisonedError.\n   *\n   * Since the development specification for livedata is not to throw any error, entering the poisoned state usually\n   * means a programming error.\n   */\n  private isPoisoned = false;\n  private poisonedError: PoisonedError | null = null;\n\n  constructor(\n    initialValue: T,\n    upstream:\n      | ((upstream: Observable<LiveDataOperation>) => Observable<T>)\n      | undefined = undefined\n  ) {\n    super();\n    this.raw$ = new BehaviorSubject(initialValue);\n    if (upstream) {\n      this.upstreamSubscription = upstream(this.ops$).subscribe({\n        next: v => {\n          this.raw$.next(v);\n        },\n        complete: () => {\n          if (!this.raw$.closed) {\n            logger.error('livedata upstream unexpected complete');\n          }\n        },\n        error: err => {\n          logger.error('uncatched error in livedata', err);\n          this.isPoisoned = true;\n          this.poisonedError = new PoisonedError(err);\n          this.raw$.error(this.poisonedError);\n        },\n      });\n    }\n  }\n\n  getValue = (): T => {\n    if (this.isPoisoned) {\n      throw this.poisonedError;\n    }\n    this.ops$.next('get');\n    return this.raw$.value;\n  };\n\n  setValue = (v: T) => {\n    if (this.isPoisoned) {\n      throw this.poisonedError;\n    }\n    this.raw$.next(v);\n    this.ops$.next('set');\n  };\n\n  get value(): T {\n    return this.getValue();\n  }\n\n  set value(v: T) {\n    this.next(v);\n  }\n\n  next = (v: T) => {\n    if (this.isPoisoned) {\n      throw this.poisonedError;\n    }\n    return this.setValue(v);\n  };\n\n  override subscribe(\n    observerOrNext?: Partial<Observer<T>> | ((value: T) => void)\n  ): Subscription;\n  override subscribe(\n    next?: ((value: T) => void) | null,\n    error?: ((error: any) => void) | null,\n    complete?: (() => void) | null\n  ): Subscription;\n  override subscribe(\n    observerOrNext?: Partial<Observer<T>> | ((value: T) => void) | null,\n    error?: ((error: any) => void) | null,\n    complete?: (() => void) | null\n  ): Subscription {\n    this.ops$.next('watch');\n    const subscription = this.raw$.subscribe(\n      observerOrNext as any,\n      error,\n      complete\n    );\n    subscription.add(() => {\n      this.ops$.next('unwatch');\n    });\n    return subscription;\n  }\n\n  map<R>(mapper: (v: T) => R): LiveData<R> {\n    const sub$ = LiveData.from(\n      new Observable<R>(subscriber =>\n        this.subscribe({\n          next: v => {\n            subscriber.next(mapper(v));\n          },\n          complete: () => {\n            sub$.complete();\n          },\n        })\n      ),\n      undefined as R // is safe\n    );\n\n    return sub$;\n  }\n\n  distinctUntilChanged(comparator?: (previous: T, current: T) => boolean) {\n    return LiveData.from(\n      this.pipe(distinctUntilChanged(comparator)),\n      null as T\n    );\n  }\n\n  throttleTime(\n    duration: number,\n    { trailing = true, leading = true }: ThrottleConfig = {}\n  ) {\n    return LiveData.from<T>(\n      this.pipe(throttleTime(duration, undefined, { trailing, leading })),\n      null as any\n    );\n  }\n\n  // eslint-disable-next-line rxjs/finnish\n  asObservable(): Observable<T> {\n    return new Observable<T>(subscriber => {\n      return this.subscribe(subscriber);\n    });\n  }\n\n  override pipe(): Observable<T>;\n  override pipe<A>(op1: OperatorFunction<T, A>): Observable<A>;\n  override pipe<A, B>(\n    op1: OperatorFunction<T, A>,\n    op2: OperatorFunction<A, B>\n  ): Observable<B>;\n  override pipe<A, B, C>(\n    op1: OperatorFunction<T, A>,\n    op2: OperatorFunction<A, B>,\n    op3: OperatorFunction<B, C>\n  ): Observable<C>;\n  override pipe<A, B, C, D>(\n    op1: OperatorFunction<T, A>,\n    op2: OperatorFunction<A, B>,\n    op3: OperatorFunction<B, C>,\n    op4: OperatorFunction<C, D>\n  ): Observable<D>;\n  override pipe<A, B, C, D, E>(\n    op1: OperatorFunction<T, A>,\n    op2: OperatorFunction<A, B>,\n    op3: OperatorFunction<B, C>,\n    op4: OperatorFunction<C, D>,\n    op5: OperatorFunction<D, E>\n  ): Observable<E>;\n  override pipe<A, B, C, D, E, F>(\n    op1: OperatorFunction<T, A>,\n    op2: OperatorFunction<A, B>,\n    op3: OperatorFunction<B, C>,\n    op4: OperatorFunction<C, D>,\n    op5: OperatorFunction<D, E>,\n    op6: OperatorFunction<E, F>\n  ): Observable<F>;\n  override pipe(...args: any[]) {\n    return new Observable(subscriber => {\n      this.ops$.next('watch');\n      // eslint-disable-next-line prefer-spread\n      const subscription = this.raw$.pipe\n        .apply(this.raw$, args as any)\n        .subscribe(subscriber);\n      subscription.add(() => {\n        this.ops$.next('unwatch');\n      });\n      return subscription;\n    });\n  }\n\n  complete() {\n    this.ops$.complete();\n    this.raw$.complete();\n    this.upstreamSubscription?.unsubscribe();\n  }\n\n  /**\n   * flatten the livedata\n   *\n   * ```\n   * new LiveData(new LiveData(0)).flat() // LiveData<number>\n   * ```\n   *\n   * ```\n   * new LiveData([new LiveData(0)]).flat() // LiveData<number[]>\n   * ```\n   */\n  flat(): Flat<this> {\n    return LiveData.from(\n      this.pipe(\n        switchMap(v => {\n          if (v instanceof LiveData) {\n            return (v as LiveData<any>).flat();\n          } else if (Array.isArray(v)) {\n            if (v.length === 0) {\n              return of([]);\n            }\n            return combineLatest(\n              v.map(v => {\n                if (v instanceof LiveData) {\n                  return v.flat();\n                } else {\n                  return of(v);\n                }\n              })\n            );\n          } else {\n            return of(v);\n          }\n        })\n      ),\n      null as any\n    ) as any;\n  }\n\n  static flat<T>(v: T): Flat<LiveData<T>> {\n    return new LiveData(v).flat();\n  }\n\n  waitFor(predicate: (v: T) => unknown, signal?: AbortSignal): Promise<T> {\n    return new Promise((resolve, reject) => {\n      const subscription = this.subscribe(v => {\n        if (predicate(v)) {\n          resolve(v as any);\n          setImmediate(() => {\n            subscription.unsubscribe();\n          });\n        }\n      });\n      signal?.addEventListener('abort', reason => {\n        subscription.unsubscribe();\n        reject(reason);\n      });\n    });\n  }\n\n  waitForNonNull(signal?: AbortSignal) {\n    return this.waitFor(v => v !== null && v !== undefined, signal) as Promise<\n      NonNullable<T>\n    >;\n  }\n\n  reactSubscribe = (cb: () => void) => {\n    if (this.isPoisoned) {\n      throw this.poisonedError;\n    }\n    this.ops$.next('watch');\n    const subscription = this.raw$\n      .pipe(distinctUntilChanged(), skip(1))\n      .subscribe(cb);\n    subscription.add(() => {\n      this.ops$.next('unwatch');\n    });\n    return () => subscription.unsubscribe();\n  };\n\n  reactGetSnapshot = () => {\n    if (this.isPoisoned) {\n      throw this.poisonedError;\n    }\n    this.ops$.next('watch');\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises -- never throw\n    Promise.resolve().then(() => {\n      this.ops$.next('unwatch');\n    });\n    return this.raw$.value;\n  };\n\n  protected _subscribe(): TeardownLogic {\n    throw new Error('Method not implemented.');\n  }\n\n  [Symbol.observable || '@@observable']() {\n    return this;\n  }\n\n  [Symbol.observable]() {\n    return this;\n  }\n}\n\nexport type LiveDataOperation = 'set' | 'get' | 'watch' | 'unwatch';\n\nexport type Unwrap<T> =\n  T extends LiveData<infer Z>\n    ? Unwrap<Z>\n    : T extends LiveData<infer A>[]\n      ? Unwrap<A>[]\n      : T;\n\nexport type Flat<T> = T extends LiveData<infer P> ? LiveData<Unwrap<P>> : T;\n\nexport class PoisonedError extends Error {\n  constructor(originalError: any) {\n    super(\n      'The livedata is poisoned, original error: ' +\n        (originalError instanceof Error ? originalError.stack : originalError)\n    );\n  }\n}\n","import {\n  catchError,\n  connect,\n  distinctUntilChanged,\n  EMPTY,\n  exhaustMap,\n  merge,\n  mergeMap,\n  Observable,\n  type ObservableInput,\n  type ObservedValueOf,\n  of,\n  type OperatorFunction,\n  pipe,\n  retry,\n  switchMap,\n  throwError,\n  timer,\n} from 'rxjs';\n\nimport { MANUALLY_STOP } from '../utils';\nimport type { LiveData } from './livedata';\n\n/**\n * An operator that maps the value to the `LiveData`.\n */\nexport function mapInto<T>(l$: LiveData<T>) {\n  return pipe(\n    mergeMap((value: T) => {\n      l$.next(value);\n      return EMPTY;\n    })\n  );\n}\n\n/**\n * An operator that catches the error and sends it to the `LiveData`.\n *\n * The `LiveData` will be set to `null` when the observable completes. This is useful for error state recovery.\n *\n * @param cb A callback that will be called when an error occurs.\n */\nexport function catchErrorInto<Error = any>(\n  l$: LiveData<Error | null>,\n  cb?: (error: Error) => void\n) {\n  return pipe(\n    onComplete(() => l$.next(null)),\n    catchError((error: any) => {\n      l$.next(error);\n      cb?.(error);\n      return EMPTY;\n    })\n  );\n}\n\n/**\n * An operator that calls the callback when the observable starts.\n */\nexport function onStart<T>(cb: () => void): OperatorFunction<T, T> {\n  return observable$ =>\n    new Observable(subscribe => {\n      cb();\n      return observable$.subscribe(subscribe);\n    });\n}\n\n/**\n * An operator that calls the callback when the observable completes.\n */\nexport function onComplete<T>(cb: () => void): OperatorFunction<T, T> {\n  return observable$ =>\n    new Observable(subscribe => {\n      return observable$.subscribe({\n        complete() {\n          cb();\n          subscribe.complete();\n        },\n        error(err) {\n          subscribe.error(err);\n        },\n        next(value) {\n          subscribe.next(value);\n        },\n      });\n    });\n}\n\n/**\n * Convert a promise to an observable.\n *\n * like `from` but support `AbortSignal`.\n */\nexport function fromPromise<T>(\n  promise: Promise<T> | ((signal: AbortSignal) => Promise<T>)\n): Observable<T> {\n  return new Observable(subscriber => {\n    const abortController = new AbortController();\n\n    const rawPromise =\n      promise instanceof Function ? promise(abortController.signal) : promise;\n\n    rawPromise\n      .then(value => {\n        subscriber.next(value);\n        subscriber.complete();\n      })\n      .catch(error => {\n        subscriber.error(error);\n      });\n\n    return () => abortController.abort(MANUALLY_STOP);\n  });\n}\n\n/**\n * An operator that retries the source observable when an error occurs.\n *\n * https://en.wikipedia.org/wiki/Exponential_backoff\n */\nexport function backoffRetry<T>({\n  when,\n  count = 3,\n  delay = 200,\n  maxDelay = 15000,\n}: {\n  when?: (err: any) => boolean;\n  count?: number;\n  delay?: number;\n  maxDelay?: number;\n} = {}) {\n  return (obs$: Observable<T>) =>\n    obs$.pipe(\n      retry({\n        count,\n        delay: (err, retryIndex) => {\n          if (when && !when(err)) {\n            return throwError(() => err);\n          }\n          const d = Math.pow(2, retryIndex - 1) * delay;\n          return timer(Math.min(d, maxDelay));\n        },\n      })\n    );\n}\n\n/**\n * An operator that combines `exhaustMap` and `switchMap`.\n *\n * This operator executes the `comparator` on each input, acting as an `exhaustMap` when the `comparator` returns `true`\n * and acting as a `switchMap` when the comparator returns `false`.\n *\n * It is more useful for async processes that are relatively stable in results but sensitive to input.\n * For example, when requesting the user's subscription status, `exhaustMap` is used because the user's subscription\n * does not change often, but when switching users, the request should be made immediately like `switchMap`.\n *\n * @param onSwitch callback will be executed when `switchMap` occurs (including the first execution).\n */\nexport function exhaustMapSwitchUntilChanged<T, O extends ObservableInput<any>>(\n  comparator: (previous: T, current: T) => boolean,\n  project: (value: T, index: number) => O,\n  onSwitch?: (value: T) => void\n): OperatorFunction<T, ObservedValueOf<O>> {\n  return pipe(\n    connect(shared$ =>\n      shared$.pipe(\n        distinctUntilChanged(comparator),\n        switchMap(value => {\n          onSwitch?.(value);\n          return merge(of(value), shared$).pipe(\n            exhaustMap((value, index) => {\n              return project(value, index);\n            })\n          );\n        })\n      )\n    )\n  );\n}\n","import { use } from 'foxact/use';\nimport { useSyncExternalStore } from 'react';\n\nimport type { LiveData } from './livedata';\n\nfunction noopSubscribe() {\n  return () => {};\n}\n\nfunction nullGetSnapshot() {\n  return null;\n}\n\nfunction undefinedGetSnapshot() {\n  return undefined;\n}\n\n/**\n * subscribe LiveData and return the value.\n */\nexport function useLiveData<Input extends LiveData<any> | null | undefined>(\n  liveData: Input\n): NonNullable<Input> extends LiveData<infer T>\n  ? Input extends undefined\n    ? T | undefined\n    : Input extends null\n      ? T | null\n      : T\n  : never {\n  return useSyncExternalStore(\n    liveData ? liveData.reactSubscribe : noopSubscribe,\n    liveData\n      ? liveData.reactGetSnapshot\n      : liveData === undefined\n        ? undefinedGetSnapshot\n        : nullGetSnapshot\n  );\n}\n\n/**\n * subscribe LiveData and return the value. If the value is nullish, will suspends until the value is not nullish.\n */\nexport function useEnsureLiveData<T>(liveData$: LiveData<T>): NonNullable<T> {\n  const data = useLiveData(liveData$);\n\n  if (data === null || data === undefined) {\n    return use(\n      new Promise((resolve, reject) => {\n        const subscription = liveData$.subscribe({\n          next(value) {\n            if (value === null || value === undefined) {\n              resolve(value);\n              subscription.unsubscribe();\n            }\n          },\n          error(err) {\n            reject(err);\n          },\n          complete() {\n            reject(new Error('Unexpected completion'));\n          },\n        });\n      })\n    );\n  }\n\n  return data;\n}\n","import { Entity } from '../../../framework';\nimport type { DBSchemaBuilder, TableMap } from '../../../orm';\nimport { Table } from './table';\n\nexport class DB<Schema extends DBSchemaBuilder> extends Entity<{\n  db: TableMap<Schema>;\n  schema: Schema;\n  storageDocId: (tableName: string) => string;\n}> {\n  readonly db = this.props.db;\n\n  constructor() {\n    super();\n    Object.entries(this.props.schema).forEach(([tableName]) => {\n      const table = this.framework.createEntity(Table, {\n        table: this.db[tableName],\n        storageDocId: this.props.storageDocId(tableName),\n      });\n      Object.defineProperty(this, tableName, {\n        get: () => table,\n      });\n    });\n  }\n}\n\nexport type DBWithTables<Schema extends DBSchemaBuilder> = DB<Schema> & {\n  [K in keyof Schema]: Table<Schema[K]>;\n};\n","import { Entity } from '../../../framework';\nimport type { Table as OrmTable, TableSchemaBuilder } from '../../../orm/core';\nimport type { WorkspaceService } from '../../workspace';\n\nexport class Table<Schema extends TableSchemaBuilder> extends Entity<{\n  table: OrmTable<Schema>;\n  storageDocId: string;\n}> {\n  readonly table = this.props.table;\n\n  constructor(private readonly workspaceService: WorkspaceService) {\n    super();\n  }\n\n  isSyncing$ = this.workspaceService.workspace.engine.doc\n    .docState$(this.props.storageDocId)\n    .map(docState => docState.syncing);\n\n  isLoading$ = this.workspaceService.workspace.engine.doc\n    .docState$(this.props.storageDocId)\n    .map(docState => docState.loading);\n\n  create = this.table.create.bind(this.table);\n  update = this.table.update.bind(this.table);\n  get = this.table.get.bind(this.table);\n  // eslint-disable-next-line rxjs/finnish\n  get$ = this.table.get$.bind(this.table);\n  find = this.table.find.bind(this.table);\n  // eslint-disable-next-line rxjs/finnish\n  find$ = this.table.find$.bind(this.table);\n  keys = this.table.keys.bind(this.table);\n  delete = this.table.delete.bind(this.table);\n}\n","import { pick as lodashPick } from 'lodash-es';\n\nimport type { FieldType } from '../schema';\nimport type { DataValidator } from './types';\n\nfunction inputType(val: any) {\n  return val === null ||\n    Array.isArray(val) ||\n    val.constructor === 'Object' ||\n    !val.constructor /* Object.create(null) */\n    ? 'json'\n    : typeof val;\n}\n\nfunction typeMatches(typeWant: FieldType, typeGet: string) {\n  if (typeWant === 'json') {\n    switch (typeGet) {\n      case 'bigint':\n      case 'function':\n      case 'object': // we've already converted available types into 'json'\n      case 'symbol':\n      case 'undefined':\n        return false;\n    }\n  }\n\n  return typeWant === typeGet;\n}\n\nexport const dataValidators = {\n  PrimaryKeyShouldExist: {\n    validate(table, data) {\n      const val = data[table.keyField];\n\n      if (val === undefined || val === null) {\n        throw new Error(\n          `[Table(${table.name})]: Primary key field '${table.keyField}' is required but not set.`\n        );\n      }\n    },\n  },\n  PrimaryKeyShouldNotBeUpdated: {\n    validate(table, data) {\n      if (data[table.keyField] !== undefined) {\n        throw new Error(\n          `[Table(${table.name})]: Primary key field '${table.keyField}' can't be updated.`\n        );\n      }\n    },\n  },\n  DataTypeShouldMatch: {\n    validate(table, data) {\n      for (const key in data) {\n        const field = table.schema[key];\n        if (!field) {\n          throw new Error(\n            `[Table(${table.name})]: Field '${key}' is not defined but set in entity.`\n          );\n        }\n\n        const val = data[key];\n\n        if (val === undefined) {\n          delete data[key];\n          continue;\n        }\n\n        if (val === null) {\n          if (!field.optional) {\n            throw new Error(\n              `[Table(${table.name})]: Field '${key}' is required but not set.`\n            );\n          }\n          continue;\n        }\n\n        const typeGet = inputType(val);\n        if (!typeMatches(field.type, typeGet)) {\n          throw new Error(\n            `[Table(${table.name})]: Field '${key}' type mismatch. Expected ${field.type} got ${typeGet}.`\n          );\n        }\n      }\n    },\n  },\n  DataTypeShouldExactlyMatch: {\n    validate(table, data) {\n      const keys: Set<string> = new Set();\n      for (const key in data) {\n        const field = table.schema[key];\n        if (!field) {\n          throw new Error(\n            `[Table(${table.name})]: Field '${key}' is not defined but set in entity.`\n          );\n        }\n\n        const val = data[key];\n\n        if (val === undefined || val === null) {\n          if (!field.optional) {\n            throw new Error(\n              `[Table(${table.name})]: Field '${key}' is required but not set.`\n            );\n          }\n          continue;\n        }\n\n        const typeGet = inputType(val);\n        if (!typeMatches(field.type, typeGet)) {\n          throw new Error(\n            `[Table(${table.name})]: Field '${key}' type mismatch. Expected type '${field.type}' but got '${typeGet}'.`\n          );\n        }\n\n        keys.add(key);\n      }\n\n      for (const key in table.schema) {\n        if (!keys.has(key) && table.schema[key].optional === false) {\n          throw new Error(\n            `[Table(${table.name})]: Field '${key}' is required but not set.`\n          );\n        }\n      }\n    },\n  },\n} satisfies Record<string, DataValidator>;\n\n// lodash pick's signature is not typesafe\nconst pick = lodashPick as <T extends Record<string, any>>(\n  obj: T,\n  ...keys: Array<keyof T>\n) => Pick<T, keyof T>;\n\nexport const createEntityDataValidators = pick(\n  dataValidators,\n  'PrimaryKeyShouldExist',\n  'DataTypeShouldExactlyMatch'\n);\nexport const updateEntityDataValidators = pick(\n  dataValidators,\n  'PrimaryKeyShouldNotBeUpdated',\n  'DataTypeShouldMatch'\n);\n","import type { TableSchemaValidator } from './types';\n\nconst PRESERVED_FIELDS = ['$$DELETED'];\n\ninterface DataValidator {\n  validate(tableName: string, data: any): void;\n}\n\nexport const yjsTableSchemaValidators: Record<string, TableSchemaValidator> = {\n  UsePreservedFields: {\n    validate(tableName, table) {\n      for (const name in table) {\n        if (PRESERVED_FIELDS.includes(name)) {\n          throw new Error(\n            `[Table(${tableName})]: Field '${name}' is reserved keyword and can't be used.`\n          );\n        }\n      }\n    },\n  },\n};\n\nexport const yjsDataValidators: Record<string, DataValidator> = {\n  SetPreservedFields: {\n    validate(tableName, data) {\n      for (const name of PRESERVED_FIELDS) {\n        if (data[name] !== undefined) {\n          throw new Error(\n            `[Table(${tableName})]: Field '${name}' is reserved keyword and can't be set.`\n          );\n        }\n      }\n    },\n  },\n};\n","import { createEntityDataValidators, updateEntityDataValidators } from './data';\nimport { tableSchemaValidators } from './schema';\nimport { yjsDataValidators, yjsTableSchemaValidators } from './yjs';\n\ninterface ValidationError {\n  code: string;\n  error: Error;\n}\n\nfunction throwIfError(errors: ValidationError[]) {\n  if (errors.length) {\n    const message = errors\n      .map(({ code, error }) => `${code}: ${error.stack ?? error.message}`)\n      .join('\\n');\n\n    throw new Error('Validation Failed Error\\n' + message);\n  }\n}\n\nfunction validate<Validator extends { validate: (...args: any[]) => void }>(\n  rules: Record<string, Validator>,\n  ...payload: Parameters<Validator['validate']>\n) {\n  const errors: ValidationError[] = [];\n\n  for (const [code, validator] of Object.entries(rules)) {\n    try {\n      validator.validate(...payload);\n    } catch (e) {\n      errors.push({ code, error: e as Error });\n    }\n  }\n\n  throwIfError(errors);\n}\n\nfunction use<Validator extends { validate: (...args: any[]) => void }>(\n  rules: Record<string, Validator>\n) {\n  return (...payload: Parameters<Validator['validate']>) =>\n    validate(rules, ...payload);\n}\n\nexport const validators = {\n  validateTableSchema: use(tableSchemaValidators),\n  validateCreateEntityData: use(createEntityDataValidators),\n  validateUpdateEntityData: use(updateEntityDataValidators),\n  validateYjsTableSchema: use(yjsTableSchemaValidators),\n  validateYjsEntityData: use(yjsDataValidators),\n};\n","import type { TableSchemaValidator } from './types';\n\nexport const tableSchemaValidators: Record<string, TableSchemaValidator> = {\n  PrimaryKeyShouldExist: {\n    validate(tableName, table) {\n      if (!Object.values(table).some(field => field.schema.isPrimaryKey)) {\n        throw new Error(\n          `[Table(${tableName})]: There should be at least one field marked as primary key.`\n        );\n      }\n    },\n  },\n  OnlyOnePrimaryKey: {\n    validate(tableName, table) {\n      const primaryFields = [];\n\n      for (const name in table) {\n        if (table[name].schema.isPrimaryKey) {\n          primaryFields.push(name);\n        }\n      }\n\n      if (primaryFields.length > 1) {\n        throw new Error(\n          `[Table(${tableName})]: There should be only one field marked as primary key. Found [${primaryFields.join(', ')}].`\n        );\n      }\n    },\n  },\n  PrimaryKeyShouldNotBeOptional: {\n    validate(tableName, table) {\n      for (const name in table) {\n        const opts = table[name].schema;\n        if (opts.isPrimaryKey && opts.optional && !opts.default) {\n          throw new Error(\n            `[Table(${tableName})]: Field '${name}' can't be marked primary key and optional with no default value provider at the same time.`\n          );\n        }\n      }\n    },\n  },\n};\n","import { isUndefined, omitBy } from 'lodash-es';\nimport { Observable, shareReplay } from 'rxjs';\n\nimport type { DBAdapter, TableAdapter } from './adapters';\nimport type {\n  DBSchemaBuilder,\n  FieldSchemaBuilder,\n  TableSchema,\n  TableSchemaBuilder,\n} from './schema';\nimport type { Key, TableOptions } from './types';\nimport { validators } from './validators';\n\ntype Pretty<T> = T extends any\n  ? {\n      -readonly [P in keyof T]: T[P];\n    }\n  : never;\n\ntype RequiredFields<T extends TableSchemaBuilder> = {\n  [K in keyof T as T[K] extends FieldSchemaBuilder<any, infer Optional>\n    ? Optional extends false\n      ? K\n      : never\n    : never]: T[K] extends FieldSchemaBuilder<infer Type> ? Type : never;\n};\n\ntype OptionalFields<T extends TableSchemaBuilder> = {\n  [K in keyof T as T[K] extends FieldSchemaBuilder<any, infer Optional>\n    ? Optional extends true\n      ? K\n      : never\n    : never]?: T[K] extends FieldSchemaBuilder<infer Type>\n    ? Type | null\n    : never;\n};\n\ntype PrimaryKeyField<T extends TableSchemaBuilder> = {\n  [K in keyof T]: T[K] extends FieldSchemaBuilder<any, any, infer PrimaryKey>\n    ? PrimaryKey extends true\n      ? K\n      : never\n    : never;\n}[keyof T];\n\nexport type NonPrimaryKeyFields<T extends TableSchemaBuilder> = {\n  [K in keyof T]: T[K] extends FieldSchemaBuilder<any, any, infer PrimaryKey>\n    ? PrimaryKey extends false\n      ? K\n      : never\n    : never;\n}[keyof T];\n\nexport type PrimaryKeyFieldType<T extends TableSchemaBuilder> =\n  T[PrimaryKeyField<T>] extends FieldSchemaBuilder<infer Type>\n    ? Type extends Key\n      ? Type\n      : never\n    : never;\n\nexport type CreateEntityInput<T extends TableSchemaBuilder> = Pretty<\n  RequiredFields<T> & OptionalFields<T>\n>;\n\n// @TODO(@forehalo): return value need to be specified with `Default` inference\nexport type Entity<T extends TableSchemaBuilder> = Pretty<\n  CreateEntityInput<T> & {\n    [key in PrimaryKeyField<T>]: PrimaryKeyFieldType<T>;\n  }\n>;\n\nexport type UpdateEntityInput<T extends TableSchemaBuilder> = Pretty<{\n  [key in NonPrimaryKeyFields<T>]?: key extends keyof Entity<T>\n    ? Entity<T>[key]\n    : never;\n}>;\n\nexport type FindEntityInput<T extends TableSchemaBuilder> = Pretty<{\n  [key in keyof T]?: key extends keyof Entity<T> ? Entity<T>[key] : never;\n}>;\n\nexport class Table<T extends TableSchemaBuilder> {\n  readonly schema: TableSchema;\n  readonly keyField: string = '';\n  private readonly adapter: TableAdapter;\n\n  private readonly subscribedKeys: Map<Key, Observable<any>> = new Map();\n\n  constructor(\n    db: DBAdapter,\n    public readonly name: string,\n    private readonly opts: TableOptions\n  ) {\n    this.adapter = db.table(name) as any;\n    this.schema = Object.entries(this.opts.schema).reduce(\n      (acc, [fieldName, fieldBuilder]) => {\n        acc[fieldName] = fieldBuilder.schema;\n        if (fieldBuilder.schema.isPrimaryKey) {\n          // @ts-expect-error still in constructor\n          this.keyField = fieldName;\n        }\n        return acc;\n      },\n      {} as TableSchema\n    );\n    this.adapter.setup({ ...opts, keyField: this.keyField });\n  }\n\n  create(input: CreateEntityInput<T>): Entity<T> {\n    const data = Object.entries(this.schema).reduce(\n      (acc, [key, schema]) => {\n        const inputVal = acc[key];\n\n        if (inputVal === undefined) {\n          if (schema.optional) {\n            acc[key] = null;\n          }\n\n          if (schema.default) {\n            acc[key] = schema.default() ?? null;\n          }\n        }\n\n        return acc;\n      },\n      omitBy(input, isUndefined) as any\n    );\n\n    validators.validateCreateEntityData(this, data);\n\n    return this.adapter.insert({\n      data: data,\n    });\n  }\n\n  update(\n    key: PrimaryKeyFieldType<T>,\n    input: UpdateEntityInput<T>\n  ): Entity<T> | null {\n    validators.validateUpdateEntityData(this, input);\n\n    const [record] = this.adapter.update({\n      where: {\n        byKey: key,\n      },\n      data: input,\n    });\n\n    return record || null;\n  }\n\n  get(key: PrimaryKeyFieldType<T>): Entity<T> | null {\n    const [record] = this.adapter.find({\n      where: {\n        byKey: key,\n      },\n    });\n\n    return record || null;\n  }\n\n  get$(key: PrimaryKeyFieldType<T>): Observable<Entity<T> | null> {\n    let ob$ = this.subscribedKeys.get(key);\n\n    if (!ob$) {\n      ob$ = new Observable<Entity<T>>(subscriber => {\n        const unsubscribe = this.adapter.observe({\n          where: {\n            byKey: key,\n          },\n          callback: ([data]) => {\n            subscriber.next(data || null);\n          },\n        });\n\n        return () => {\n          unsubscribe();\n          this.subscribedKeys.delete(key);\n        };\n      }).pipe(\n        shareReplay({\n          refCount: true,\n          bufferSize: 1,\n        })\n      );\n\n      this.subscribedKeys.set(key, ob$);\n    }\n\n    return ob$;\n  }\n\n  find(where?: FindEntityInput<T>): Entity<T>[] {\n    return this.adapter.find({\n      where: !where\n        ? undefined\n        : Object.entries(where)\n            .map(([field, value]) => ({\n              field,\n              value,\n            }))\n            .filter(({ value }) => value !== undefined),\n    });\n  }\n\n  find$(where?: FindEntityInput<T>): Observable<Entity<T>[]> {\n    return new Observable<Entity<T>[]>(subscriber => {\n      const unsubscribe = this.adapter.observe({\n        where: !where\n          ? undefined\n          : Object.entries(where)\n              .map(([field, value]) => ({\n                field,\n                value,\n              }))\n              .filter(({ value }) => value !== undefined),\n        callback: data => {\n          subscriber.next(data);\n        },\n      });\n\n      return unsubscribe;\n    });\n  }\n\n  keys(): PrimaryKeyFieldType<T>[] {\n    return this.adapter.find({\n      select: 'key',\n    });\n  }\n\n  keys$(): Observable<PrimaryKeyFieldType<T>[]> {\n    let ob$ = this.subscribedKeys.get('$$KEYS');\n\n    if (!ob$) {\n      ob$ = new Observable<PrimaryKeyFieldType<T>[]>(subscriber => {\n        const unsubscribe = this.adapter.observe({\n          select: 'key',\n          callback: (keys: PrimaryKeyFieldType<T>[]) => {\n            subscriber.next(keys);\n          },\n        });\n\n        return () => {\n          unsubscribe();\n          this.subscribedKeys.delete('$$KEYS');\n        };\n      }).pipe(\n        shareReplay({\n          refCount: true,\n          bufferSize: 1,\n        })\n      );\n\n      this.subscribedKeys.set('$$KEYS', ob$);\n    }\n\n    return ob$;\n  }\n\n  delete(key: PrimaryKeyFieldType<T>) {\n    this.adapter.delete({\n      where: {\n        byKey: key,\n      },\n    });\n  }\n}\n\nexport type TableMap<Tables extends DBSchemaBuilder> = {\n  readonly [K in keyof Tables]: Table<Tables[K]>;\n};\n","import { type DBAdapter, type Hook } from './adapters';\nimport type { DBSchemaBuilder } from './schema';\nimport { type CreateEntityInput, Table, type TableMap } from './table';\nimport { validators } from './validators';\n\nexport class ORMClient {\n  static hooksMap: Map<string, Hook<any>[]> = new Map();\n  readonly tables = new Map<string, Table<any>>();\n  constructor(\n    protected readonly db: DBSchemaBuilder,\n    protected readonly adapter: DBAdapter\n  ) {\n    Object.entries(db).forEach(([tableName, tableSchema]) => {\n      Object.defineProperty(this, tableName, {\n        get: () => {\n          let table = this.tables.get(tableName);\n          if (!table) {\n            table = new Table(this.adapter, tableName, {\n              schema: tableSchema,\n              hooks: ORMClient.hooksMap.get(tableName),\n            });\n            this.tables.set(tableName, table);\n          }\n          return table;\n        },\n      });\n    });\n  }\n\n  static defineHook(tableName: string, _desc: string, hook: Hook<any>) {\n    let hooks = this.hooksMap.get(tableName);\n    if (!hooks) {\n      hooks = [];\n      this.hooksMap.set(tableName, hooks);\n    }\n\n    hooks.push(hook);\n  }\n}\n\nexport function createORMClient<Schema extends DBSchemaBuilder>(\n  db: Schema\n): ORMClientWithTablesClass<Schema> {\n  Object.entries(db).forEach(([tableName, schema]) => {\n    validators.validateTableSchema(tableName, schema);\n  });\n\n  class ORMClientWithTables extends ORMClient {\n    constructor(adapter: DBAdapter) {\n      super(db, adapter);\n    }\n  }\n\n  return ORMClientWithTables as any;\n}\n\nexport type ORMClientWithTablesClass<Schema extends DBSchemaBuilder> = {\n  new (adapter: DBAdapter): TableMap<Schema> & ORMClient;\n\n  defineHook<TableName extends keyof Schema>(\n    tableName: TableName,\n    desc: string,\n    hook: Hook<CreateEntityInput<Schema[TableName]>>\n  ): void;\n};\n","import type { TableAdapter, TableAdapterOptions } from '../types';\ndeclare module '../../types' {\n  interface TableOptions {\n    hooks?: Hook<unknown>[];\n  }\n}\n\nexport interface Hook<T> {\n  deserialize(dbVal: T): T;\n}\n\nexport interface TableAdapterWithHook<T = unknown> extends Hook<T> {}\n\nexport function HookAdapter(): ClassDecorator {\n  // @ts-expect-error allow\n  return (Class: { new (...args: any[]): TableAdapter }) => {\n    return class TableAdapterExtensions\n      extends Class\n      implements TableAdapterWithHook\n    {\n      hooks: Hook<unknown>[] = [];\n\n      override setup(opts: TableAdapterOptions): void {\n        super.setup(opts);\n        this.hooks = opts.hooks ?? [];\n      }\n\n      deserialize(data: unknown) {\n        if (!this.hooks.length) {\n          return data;\n        }\n\n        return this.hooks.reduce(\n          (acc, hook) => hook.deserialize(acc),\n          Object.assign({} as any, data)\n        );\n      }\n\n      override toObject(data: any): Record<string, any> {\n        return this.deserialize(super.toObject(data));\n      }\n    };\n  };\n}\n","import { pick } from 'lodash-es';\nimport {\n  type AbstractType,\n  type Doc,\n  Map as YMap,\n  type Transaction,\n} from 'yjs';\n\nimport { validators } from '../../validators';\nimport { HookAdapter } from '../mixins';\nimport type {\n  DeleteQuery,\n  FindQuery,\n  InsertQuery,\n  ObserveQuery,\n  Select,\n  TableAdapter,\n  TableAdapterOptions,\n  UpdateQuery,\n  WhereCondition,\n} from '../types';\n\n/**\n * Yjs Adapter for AFFiNE ORM\n *\n * Structure:\n *\n * Each table is a YDoc instance\n *\n * Table(YDoc)\n *   Key(string): Row(YMap)({\n *     FieldA(string): Value(Primitive)\n *     FieldB(string): Value(Primitive)\n *     FieldC(string): Value(Primitive)\n *   })\n */\n@HookAdapter()\nexport class YjsTableAdapter implements TableAdapter {\n  private readonly deleteFlagKey = '$$DELETED';\n  private keyField: string = 'key';\n  private fields: string[] = [];\n\n  private readonly origin = 'YjsTableAdapter';\n\n  constructor(\n    private readonly tableName: string,\n    private readonly doc: Doc\n  ) {}\n\n  setup(opts: TableAdapterOptions): void {\n    this.keyField = opts.keyField;\n    this.fields = Object.keys(opts.schema);\n  }\n\n  dispose() {\n    this.doc.destroy();\n  }\n\n  insert(query: InsertQuery) {\n    const { data, select } = query;\n    validators.validateYjsEntityData(this.tableName, data);\n    const key = data[this.keyField];\n    const record = this.doc.getMap(key.toString());\n\n    this.doc.transact(() => {\n      for (const key in data) {\n        record.set(key, data[key]);\n      }\n\n      record.delete(this.deleteFlagKey);\n    }, this.origin);\n\n    return this.value(record, select);\n  }\n\n  update(query: UpdateQuery) {\n    const { data, select, where } = query;\n    validators.validateYjsEntityData(this.tableName, data);\n\n    const results: any[] = [];\n    this.doc.transact(() => {\n      for (const record of this.iterate(where)) {\n        results.push(this.value(record, select));\n        for (const key in data) {\n          this.setField(record, key, data[key]);\n        }\n      }\n    }, this.origin);\n\n    return results;\n  }\n\n  find(query: FindQuery) {\n    const { where, select } = query;\n    const records: any[] = [];\n    for (const record of this.iterate(where)) {\n      records.push(this.value(record, select));\n    }\n\n    return records;\n  }\n\n  observe(query: ObserveQuery) {\n    const { where, select, callback } = query;\n\n    let listeningOnAll = false;\n    const results = new Map<string, any>();\n\n    if (!where) {\n      listeningOnAll = true;\n    }\n\n    for (const record of this.iterate(where)) {\n      results.set(this.keyof(record), this.value(record, select));\n    }\n\n    callback(Array.from(results.values()));\n\n    const ob = (tx: Transaction) => {\n      let hasChanged = false;\n      for (const [ty] of tx.changed) {\n        const record = ty;\n        const key = this.keyof(record);\n        const isMatch =\n          (listeningOnAll || (where && this.match(record, where))) &&\n          !this.isDeleted(record);\n        const prevMatch = results.get(key);\n        const isPrevMatched = results.has(key);\n\n        if (isMatch && isPrevMatched) {\n          const newValue = this.value(record, select);\n          if (prevMatch !== newValue) {\n            results.set(key, newValue);\n            hasChanged = true;\n          }\n        } else if (isMatch && !isPrevMatched) {\n          results.set(this.keyof(record), this.value(record, select));\n          hasChanged = true;\n        } else if (!isMatch && isPrevMatched) {\n          results.delete(key);\n          hasChanged = true;\n        }\n      }\n\n      if (hasChanged) {\n        callback(Array.from(results.values()));\n      }\n    };\n\n    this.doc.on('afterTransaction', ob);\n    return () => {\n      this.doc.off('afterTransaction', ob);\n    };\n  }\n\n  delete(query: DeleteQuery) {\n    const { where } = query;\n\n    this.doc.transact(() => {\n      for (const record of this.iterate(where)) {\n        this.deleteTy(record);\n      }\n    }, this.origin);\n  }\n\n  toObject(ty: AbstractType<any>): Record<string, any> {\n    return YMap.prototype.toJSON.call(ty);\n  }\n\n  private recordByKey(key: string): AbstractType<any> | null {\n    // detect if the record is there otherwise yjs will create an empty Map.\n    if (this.doc.share.has(key)) {\n      return this.doc.getMap(key);\n    }\n\n    return null;\n  }\n\n  private *iterate(where?: WhereCondition) {\n    if (!where) {\n      for (const map of this.doc.share.values()) {\n        if (!this.isDeleted(map)) {\n          yield map;\n        }\n      }\n    }\n    // fast pass for key lookup without iterating the whole table\n    else if ('byKey' in where) {\n      const record = this.recordByKey(where.byKey.toString());\n      if (record) {\n        yield record;\n      }\n    } else if (Array.isArray(where)) {\n      for (const map of this.doc.share.values()) {\n        if (this.match(map, where)) {\n          yield map;\n        }\n      }\n    }\n  }\n\n  private value(record: AbstractType<any>, select: Select = '*') {\n    if (this.isDeleted(record) || this.isEmpty(record)) {\n      return null;\n    }\n\n    let selectedFields: string[];\n    if (select === 'key') {\n      return this.keyof(record);\n    } else if (select === '*') {\n      selectedFields = this.fields;\n    } else {\n      selectedFields = select;\n    }\n\n    return pick(this.toObject(record), selectedFields);\n  }\n\n  private match(record: AbstractType<any>, where: WhereCondition) {\n    return (\n      !this.isDeleted(record) &&\n      (Array.isArray(where)\n        ? where.length === 0\n          ? false\n          : where.every(c => this.field(record, c.field) === c.value)\n        : where.byKey === this.keyof(record))\n    );\n  }\n\n  private isDeleted(record: AbstractType<any>) {\n    return (\n      this.field(record, this.deleteFlagKey) === true || this.isEmpty(record)\n    );\n  }\n\n  private keyof(record: AbstractType<any>) {\n    return this.field(record, this.keyField);\n  }\n\n  private field(ty: AbstractType<any>, field: string) {\n    return YMap.prototype.get.call(ty, field);\n  }\n\n  private setField(ty: AbstractType<any>, field: string, value: any) {\n    YMap.prototype.set.call(ty, field, value);\n  }\n\n  private isEmpty(ty: AbstractType<any>) {\n    return ty._map.size === 0;\n  }\n\n  private deleteTy(ty: AbstractType<any>) {\n    this.fields.forEach(field => {\n      if (field !== this.keyField) {\n        YMap.prototype.delete.call(ty, field);\n      }\n    });\n    YMap.prototype.set.call(ty, this.deleteFlagKey, true);\n  }\n}\n","import type { Doc } from 'yjs';\n\nimport type { DBSchemaBuilder } from '../../schema';\nimport { validators } from '../../validators';\nimport type { DBAdapter, TableAdapter } from '../types';\nimport { YjsTableAdapter } from './table';\n\nexport interface DocProvider {\n  getDoc(guid: string): Doc;\n}\n\nexport class YjsDBAdapter implements DBAdapter {\n  tables: Map<string, TableAdapter> = new Map();\n  constructor(\n    db: DBSchemaBuilder,\n    private readonly provider: DocProvider\n  ) {\n    for (const [tableName, table] of Object.entries(db)) {\n      validators.validateYjsTableSchema(tableName, table);\n      const doc = this.provider.getDoc(tableName);\n\n      this.tables.set(tableName, new YjsTableAdapter(tableName, doc));\n    }\n  }\n\n  table(tableName: string) {\n    const table = this.tables.get(tableName);\n\n    if (!table) {\n      throw new Error('Table not found');\n    }\n\n    return table;\n  }\n}\n","export type FieldType = 'string' | 'number' | 'boolean' | 'json';\n\nexport interface FieldSchema<Type = unknown> {\n  type: FieldType;\n  optional: boolean;\n  isPrimaryKey: boolean;\n  default?: () => Type;\n}\n\nexport type TableSchema = Record<string, FieldSchema>;\nexport type TableSchemaBuilder = Record<\n  string,\n  FieldSchemaBuilder<any, boolean>\n>;\nexport type DBSchemaBuilder = Record<string, TableSchemaBuilder>;\n\nexport class FieldSchemaBuilder<\n  Type = unknown,\n  Optional extends boolean = false,\n  PrimaryKey extends boolean = false,\n> {\n  schema: FieldSchema = {\n    type: 'string',\n    optional: false,\n    isPrimaryKey: false,\n    default: undefined,\n  };\n\n  constructor(type: FieldType) {\n    this.schema.type = type;\n  }\n\n  optional() {\n    this.schema.optional = true;\n    return this as FieldSchemaBuilder<Type, true, PrimaryKey>;\n  }\n\n  default(value: () => Type) {\n    this.schema.default = value;\n    this.schema.optional = true;\n    return this as FieldSchemaBuilder<Type, true, PrimaryKey>;\n  }\n\n  primaryKey() {\n    this.schema.isPrimaryKey = true;\n    return this as FieldSchemaBuilder<Type, Optional, true>;\n  }\n}\n\nexport const f = {\n  string: () => new FieldSchemaBuilder<string>('string'),\n  number: () => new FieldSchemaBuilder<number>('number'),\n  boolean: () => new FieldSchemaBuilder<boolean>('boolean'),\n  json: <T = any>() => new FieldSchemaBuilder<T>('json'),\n} satisfies Record<FieldType, () => FieldSchemaBuilder<any>>;\n","import { nanoid } from 'nanoid';\n\nimport { type DBSchemaBuilder, f } from '../../../orm';\n\nexport const AFFiNE_WORKSPACE_DB_SCHEMA = {\n  folders: {\n    id: f.string().primaryKey().optional().default(nanoid),\n    parentId: f.string().optional(),\n    data: f.string(),\n    type: f.string(),\n    index: f.string(),\n  },\n} as const satisfies DBSchemaBuilder;\nexport type AFFiNE_WORKSPACE_DB_SCHEMA = typeof AFFiNE_WORKSPACE_DB_SCHEMA;\n\nexport const AFFiNE_WORKSPACE_USERDATA_DB_SCHEMA = {\n  favorite: {\n    key: f.string().primaryKey(),\n    index: f.string(),\n  },\n} as const satisfies DBSchemaBuilder;\nexport type AFFiNE_WORKSPACE_USERDATA_DB_SCHEMA =\n  typeof AFFiNE_WORKSPACE_USERDATA_DB_SCHEMA;\n","import { Doc as YDoc } from 'yjs';\n\nimport { Service } from '../../../framework';\nimport { createORMClient, YjsDBAdapter } from '../../../orm';\nimport type { DocStorage } from '../../../sync';\nimport { ObjectPool } from '../../../utils';\nimport type { WorkspaceService } from '../../workspace';\nimport { DB, type DBWithTables } from '../entities/db';\nimport { AFFiNE_WORKSPACE_DB_SCHEMA } from '../schema';\nimport { AFFiNE_WORKSPACE_USERDATA_DB_SCHEMA } from '../schema/schema';\n\nconst WorkspaceDBClient = createORMClient(AFFiNE_WORKSPACE_DB_SCHEMA);\nconst WorkspaceUserdataDBClient = createORMClient(\n  AFFiNE_WORKSPACE_USERDATA_DB_SCHEMA\n);\n\nexport class WorkspaceDBService extends Service {\n  db: DBWithTables<AFFiNE_WORKSPACE_DB_SCHEMA>;\n  userdataDBPool = new ObjectPool<\n    string,\n    DB<AFFiNE_WORKSPACE_USERDATA_DB_SCHEMA>\n  >({\n    onDangling() {\n      return false; // never release\n    },\n  });\n\n  constructor(private readonly workspaceService: WorkspaceService) {\n    super();\n    this.db = this.framework.createEntity(DB<AFFiNE_WORKSPACE_DB_SCHEMA>, {\n      db: new WorkspaceDBClient(\n        new YjsDBAdapter(AFFiNE_WORKSPACE_DB_SCHEMA, {\n          getDoc: guid => {\n            const ydoc = new YDoc({\n              // guid format: db${workspaceId}${guid}\n              guid: `db$${this.workspaceService.workspace.id}$${guid}`,\n            });\n            this.workspaceService.workspace.engine.doc.addDoc(ydoc, false);\n            this.workspaceService.workspace.engine.doc.setPriority(\n              ydoc.guid,\n              50\n            );\n            return ydoc;\n          },\n        })\n      ),\n      schema: AFFiNE_WORKSPACE_DB_SCHEMA,\n      storageDocId: tableName =>\n        `db$${this.workspaceService.workspace.id}$${tableName}`,\n    }) as DBWithTables<AFFiNE_WORKSPACE_DB_SCHEMA>;\n  }\n\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  userdataDB(userId: (string & {}) | '__local__') {\n    // __local__ for local workspace\n    const userdataDb = this.userdataDBPool.get(userId);\n    if (userdataDb) {\n      return userdataDb.obj as DBWithTables<AFFiNE_WORKSPACE_USERDATA_DB_SCHEMA>;\n    }\n\n    const newDB = this.framework.createEntity(\n      DB<AFFiNE_WORKSPACE_USERDATA_DB_SCHEMA>,\n      {\n        db: new WorkspaceUserdataDBClient(\n          new YjsDBAdapter(AFFiNE_WORKSPACE_USERDATA_DB_SCHEMA, {\n            getDoc: guid => {\n              const ydoc = new YDoc({\n                // guid format: userdata${userId}${workspaceId}${guid}\n                guid: `userdata$${userId}$${this.workspaceService.workspace.id}$${guid}`,\n              });\n              this.workspaceService.workspace.engine.doc.addDoc(ydoc, false);\n              this.workspaceService.workspace.engine.doc.setPriority(\n                ydoc.guid,\n                50\n              );\n              return ydoc;\n            },\n          })\n        ),\n        schema: AFFiNE_WORKSPACE_USERDATA_DB_SCHEMA,\n        storageDocId: tableName =>\n          `userdata$${userId}$${this.workspaceService.workspace.id}$${tableName}`,\n      }\n    );\n\n    this.userdataDBPool.put(userId, newDB);\n    return newDB as DBWithTables<AFFiNE_WORKSPACE_USERDATA_DB_SCHEMA>;\n  }\n\n  static isDBDocId(docId: string) {\n    return docId.startsWith('db$') || docId.startsWith('userdata$');\n  }\n}\n\nexport async function transformWorkspaceDBLocalToCloud(\n  localWorkspaceId: string,\n  cloudWorkspaceId: string,\n  localDocStorage: DocStorage,\n  cloudDocStorage: DocStorage,\n  accountId: string\n) {\n  for (const tableName of Object.keys(AFFiNE_WORKSPACE_DB_SCHEMA)) {\n    const localDocName = `db$${localWorkspaceId}$${tableName}`;\n    const localDoc = await localDocStorage.doc.get(localDocName);\n    if (localDoc) {\n      const cloudDocName = `db$${cloudWorkspaceId}$${tableName}`;\n      await cloudDocStorage.doc.set(cloudDocName, localDoc);\n    }\n  }\n\n  for (const tableName of Object.keys(AFFiNE_WORKSPACE_USERDATA_DB_SCHEMA)) {\n    const localDocName = `userdata$__local__$${localWorkspaceId}$${tableName}`;\n    const localDoc = await localDocStorage.doc.get(localDocName);\n    if (localDoc) {\n      const cloudDocName = `userdata$${accountId}$${cloudWorkspaceId}$${tableName}`;\n      await cloudDocStorage.doc.set(cloudDocName, localDoc);\n    }\n  }\n}\n","import { Entity } from '../../../framework';\nimport type { DocScope } from '../scopes/doc';\nimport type { DocsStore } from '../stores/docs';\nimport type { DocMode } from './record';\n\nexport class Doc extends Entity {\n  constructor(\n    public readonly scope: DocScope,\n    private readonly store: DocsStore\n  ) {\n    super();\n  }\n\n  get id() {\n    return this.scope.props.docId;\n  }\n\n  public readonly blockSuiteDoc = this.scope.props.blockSuiteDoc;\n  public readonly record = this.scope.props.record;\n\n  readonly meta$ = this.record.meta$;\n  readonly mode$ = this.record.mode$;\n  readonly title$ = this.record.title$;\n  readonly trash$ = this.record.trash$;\n\n  setMode(mode: DocMode) {\n    return this.record.setMode(mode);\n  }\n\n  getMode() {\n    return this.record.getMode();\n  }\n\n  toggleMode() {\n    return this.record.toggleMode();\n  }\n\n  observeMode() {\n    return this.record.observeMode();\n  }\n\n  moveToTrash() {\n    return this.record.moveToTrash();\n  }\n\n  restoreFromTrash() {\n    return this.record.restoreFromTrash();\n  }\n\n  waitForSyncReady() {\n    return this.store.waitForDocLoadReady(this.id);\n  }\n\n  setPriorityLoad(priority: number) {\n    return this.store.setPriorityLoad(this.id, priority);\n  }\n}\n","import { map } from 'rxjs';\n\nimport { Entity } from '../../../framework';\nimport { LiveData } from '../../../livedata';\nimport type { DocsStore } from '../stores/docs';\nimport { type DocMode, DocRecord } from './record';\n\nexport class DocRecordList extends Entity {\n  constructor(private readonly store: DocsStore) {\n    super();\n  }\n\n  private readonly pool = new Map<string, DocRecord>();\n\n  public readonly docs$ = LiveData.from<DocRecord[]>(\n    this.store.watchDocIds().pipe(\n      map(ids =>\n        ids.map(id => {\n          const exists = this.pool.get(id);\n          if (exists) {\n            return exists;\n          }\n          const record = this.framework.createEntity(DocRecord, { id });\n          this.pool.set(id, record);\n          return record;\n        })\n      )\n    ),\n    []\n  );\n\n  public readonly trashDocs$ = LiveData.from<DocRecord[]>(\n    this.store.watchTrashDocIds().pipe(\n      map(ids =>\n        ids.map(id => {\n          const exists = this.pool.get(id);\n          if (exists) {\n            return exists;\n          }\n          const record = this.framework.createEntity(DocRecord, { id });\n          this.pool.set(id, record);\n          return record;\n        })\n      )\n    ),\n    []\n  );\n\n  public readonly isReady$ = LiveData.from(\n    this.store.watchDocListReady(),\n    false\n  );\n\n  public doc$(id: string) {\n    return this.docs$.map(record => record.find(record => record.id === id));\n  }\n\n  public setMode(id: string, mode: DocMode) {\n    return this.store.setDocModeSetting(id, mode);\n  }\n\n  public getMode(id: string) {\n    return this.store.getDocModeSetting(id);\n  }\n\n  public toggleMode(id: string) {\n    const mode = this.getMode(id) === 'edgeless' ? 'page' : 'edgeless';\n    this.setMode(id, mode);\n    return this.getMode(id);\n  }\n\n  public observeMode(id: string) {\n    return this.store.watchDocModeSetting(id);\n  }\n}\n","import type { DocMeta } from '@blocksuite/store';\n\nimport { Entity } from '../../../framework';\nimport { LiveData } from '../../../livedata';\nimport type { DocsStore } from '../stores/docs';\n\nexport type DocMode = 'edgeless' | 'page';\n\n/**\n * # DocRecord\n *\n * Some data you can use without open a doc.\n */\nexport class DocRecord extends Entity<{ id: string }> {\n  id: string = this.props.id;\n  constructor(private readonly docsStore: DocsStore) {\n    super();\n  }\n\n  meta$ = LiveData.from<Partial<DocMeta>>(\n    this.docsStore.watchDocMeta(this.id),\n    {}\n  );\n\n  setMeta(meta: Partial<DocMeta>): void {\n    this.docsStore.setDocMeta(this.id, meta);\n  }\n\n  mode$: LiveData<DocMode> = LiveData.from(\n    this.docsStore.watchDocModeSetting(this.id),\n    'page'\n  ).map(mode => (mode === 'edgeless' ? 'edgeless' : 'page'));\n\n  setMode(mode: DocMode) {\n    return this.docsStore.setDocModeSetting(this.id, mode);\n  }\n\n  getMode() {\n    return this.docsStore.getDocModeSetting(this.id);\n  }\n\n  toggleMode() {\n    const mode = this.getMode() === 'edgeless' ? 'page' : 'edgeless';\n    this.setMode(mode);\n    return this.getMode();\n  }\n\n  observeMode() {\n    return this.docsStore.watchDocModeSetting(this.id);\n  }\n\n  moveToTrash() {\n    return this.setMeta({ trash: true });\n  }\n\n  restoreFromTrash() {\n    return this.setMeta({ trash: false });\n  }\n\n  title$ = this.meta$.map(meta => meta.title ?? '');\n\n  trash$ = this.meta$.map(meta => meta.trash ?? false);\n}\n","import type { Doc as BlockSuiteDoc } from '@blocksuite/store';\n\nimport { Scope } from '../../../framework';\nimport type { DocRecord } from '../entities/record';\n\nexport class DocScope extends Scope<{\n  docId: string;\n  record: DocRecord;\n  blockSuiteDoc: BlockSuiteDoc;\n}> {}\n","import { Service } from '../../../framework';\nimport { Doc } from '../entities/doc';\n\nexport class DocService extends Service {\n  public readonly doc = this.framework.createEntity(Doc);\n}\n","import { Unreachable } from '@affine/env/constant';\nimport type { RootBlockModel } from '@blocksuite/blocks';\n\nimport { Service } from '../../../framework';\nimport { initEmptyPage } from '../../../initialization';\nimport { ObjectPool } from '../../../utils';\nimport type { Doc } from '../entities/doc';\nimport type { DocMode } from '../entities/record';\nimport { DocRecordList } from '../entities/record-list';\nimport { DocScope } from '../scopes/doc';\nimport type { DocsStore } from '../stores/docs';\nimport { DocService } from './doc';\n\nexport class DocsService extends Service {\n  list = this.framework.createEntity(DocRecordList);\n\n  pool = new ObjectPool<string, Doc>({\n    onDelete(obj) {\n      obj.scope.dispose();\n    },\n  });\n\n  constructor(private readonly store: DocsStore) {\n    super();\n  }\n\n  open(docId: string) {\n    const docRecord = this.list.doc$(docId).value;\n    if (!docRecord) {\n      throw new Error('Doc record not found');\n    }\n    const blockSuiteDoc = this.store.getBlockSuiteDoc(docId);\n    if (!blockSuiteDoc) {\n      throw new Error('Doc not found');\n    }\n\n    const exists = this.pool.get(docId);\n    if (exists) {\n      return { doc: exists.obj, release: exists.release };\n    }\n\n    const docScope = this.framework.createScope(DocScope, {\n      docId,\n      blockSuiteDoc,\n      record: docRecord,\n    });\n\n    const doc = docScope.get(DocService).doc;\n\n    const { obj, release } = this.pool.put(docId, doc);\n\n    return { doc: obj, release };\n  }\n\n  createDoc(\n    options: {\n      mode?: DocMode;\n      title?: string;\n    } = {}\n  ) {\n    const doc = this.store.createBlockSuiteDoc();\n    initEmptyPage(doc, options.title);\n    this.store.markDocSyncStateAsReady(doc.id);\n    const docRecord = this.list.doc$(doc.id).value;\n    if (!docRecord) {\n      throw new Unreachable();\n    }\n    if (options.mode) {\n      docRecord.setMode(options.mode);\n    }\n    return docRecord;\n  }\n\n  async addLinkedDoc(targetDocId: string, linkedDocId: string) {\n    const { doc, release } = this.open(targetDocId);\n    doc.setPriorityLoad(10);\n    await doc.waitForSyncReady();\n    const text = doc.blockSuiteDoc.Text.fromDelta([\n      {\n        insert: ' ',\n        attributes: {\n          reference: {\n            type: 'LinkedPage',\n            pageId: linkedDocId,\n          },\n        },\n      },\n    ]);\n    const [frame] = doc.blockSuiteDoc.getBlocksByFlavour('affine:note');\n    frame &&\n      doc.blockSuiteDoc.addBlock(\n        'affine:paragraph' as never, // TODO(eyhn): fix type\n        { text },\n        frame.id\n      );\n    release();\n  }\n\n  async changeDocTitle(docId: string, newTitle: string) {\n    const { doc, release } = this.open(docId);\n    doc.setPriorityLoad(10);\n    await doc.waitForSyncReady();\n    const pageBlock = doc.blockSuiteDoc.getBlocksByFlavour('affine:page').at(0)\n      ?.model as RootBlockModel | undefined;\n    if (pageBlock) {\n      doc.blockSuiteDoc.transact(() => {\n        pageBlock.title.delete(0, pageBlock.title.length);\n        pageBlock.title.insert(newTitle, 0);\n      });\n      doc.record.setMeta({ title: newTitle });\n    }\n    release();\n  }\n}\n","import { Entity } from '../../../framework';\nimport { LiveData } from '../../../livedata';\nimport { MemoryMemento } from '../../../storage';\nimport type { DocMode } from '../../doc';\n\nexport class GlobalContext extends Entity {\n  memento = new MemoryMemento();\n\n  workspaceId = this.define<string>('workspaceId');\n\n  /**\n   * is in doc page\n   */\n  isDoc = this.define<boolean>('isDoc');\n  isTrashDoc = this.define<boolean>('isTrashDoc');\n  docId = this.define<string>('docId');\n  docMode = this.define<DocMode>('docMode');\n\n  /**\n   * is in collection page\n   */\n  isCollection = this.define<boolean>('isCollection');\n  collectionId = this.define<string>('collectionId');\n\n  /**\n   * is in trash page\n   */\n  isTrash = this.define<boolean>('isTrash');\n\n  /**\n   * is in tag page\n   */\n  isTag = this.define<boolean>('isTag');\n  tagId = this.define<string>('tagId');\n\n  /**\n   * is in all docs page\n   */\n  isAllDocs = this.define<boolean>('isAllDocs');\n\n  define<T>(key: string) {\n    this.memento.set(key, null);\n    const livedata$ = LiveData.from(this.memento.watch<T>(key), null);\n    return {\n      get: () => this.memento.get(key) as T | null,\n      set: (value: T | null) => this.memento.set(key, value),\n      $: livedata$,\n    };\n  }\n}\n","import { Service } from '../../../framework';\nimport { GlobalContext } from '../entities/global-context';\n\nexport class GlobalContextService extends Service {\n  globalContext = this.framework.createEntity(GlobalContext);\n}\n","import { createEvent, Service } from '../../../framework';\n\n/**\n * Event that is emitted when application is started.\n */\nexport const ApplicationStarted = createEvent<boolean>('ApplicationStartup');\n\n/**\n * Event that is emitted when browser tab or windows is focused again, after being blurred.\n * Can be used to actively refresh some data.\n */\nexport const ApplicationFocused = createEvent<boolean>('ApplicationFocused');\n\nexport class LifecycleService extends Service {\n  constructor() {\n    super();\n  }\n\n  applicationStart() {\n    this.eventBus.emit(ApplicationStarted, true);\n  }\n\n  applicationFocus() {\n    this.eventBus.emit(ApplicationFocused, true);\n  }\n}\n","import { createIdentifier } from '../../../framework';\nimport type { Memento } from '../../../storage';\n\n/**\n * A memento object that stores the entire application state.\n *\n * State is persisted, even the application is closed.\n */\nexport interface GlobalState extends Memento {}\n\nexport const GlobalState = createIdentifier<GlobalState>('GlobalState');\n\n/**\n * A memento object that stores the entire application cache.\n *\n * Cache may be deleted from time to time, business logic should not rely on cache.\n */\nexport interface GlobalCache extends Memento {}\n\nexport const GlobalCache = createIdentifier<GlobalCache>('GlobalCache');\n","import { Service } from '../../../framework';\nimport type { GlobalCache, GlobalState } from '../providers/global';\n\nexport class GlobalStateService extends Service {\n  constructor(public readonly globalState: GlobalState) {\n    super();\n  }\n}\n\nexport class GlobalCacheService extends Service {\n  constructor(public readonly globalCache: GlobalCache) {\n    super();\n  }\n}\n","import { BinarySearchTree } from '@datastructures-js/binary-search-tree';\n\nexport class PriorityQueue {\n  tree = new BinarySearchTree<{ id: string; priority: number }>((a, b) => {\n    return a.priority === b.priority\n      ? a.id === b.id\n        ? 0\n        : a.id > b.id\n          ? 1\n          : -1\n      : a.priority - b.priority;\n  });\n  priorityMap = new Map<string, number>();\n\n  push(id: string, priority: number = 0) {\n    const oldPriority = this.priorityMap.get(id);\n    if (oldPriority === priority) {\n      return;\n    }\n    if (oldPriority !== undefined) {\n      this.remove(id);\n    }\n    this.tree.insert({ id, priority });\n    this.priorityMap.set(id, priority);\n  }\n\n  pop() {\n    const node = this.tree.max();\n\n    if (!node) {\n      return null;\n    }\n\n    this.tree.removeNode(node);\n\n    const { id } = node.getValue();\n    this.priorityMap.delete(id);\n\n    return id;\n  }\n\n  remove(id: string, priority?: number) {\n    priority ??= this.priorityMap.get(id);\n    if (priority === undefined) {\n      return false;\n    }\n    const removed = this.tree.remove({ id, priority });\n    if (removed) {\n      this.priorityMap.delete(id);\n    }\n\n    return removed;\n  }\n\n  clear() {\n    this.tree.clear();\n    this.priorityMap.clear();\n  }\n\n  updatePriority(id: string, priority: number) {\n    if (this.remove(id)) {\n      this.push(id, priority);\n    }\n  }\n\n  get length() {\n    return this.tree.count;\n  }\n}\n","import { PriorityQueue } from './priority-queue';\n\nexport class AsyncPriorityQueue extends PriorityQueue {\n  private _resolveUpdate: (() => void) | null = null;\n  private _waitForUpdate: Promise<void> | null = null;\n\n  async asyncPop(abort?: AbortSignal): Promise<string> {\n    const update = this.pop();\n    if (update) {\n      return update;\n    } else {\n      if (!this._waitForUpdate) {\n        this._waitForUpdate = new Promise(resolve => {\n          this._resolveUpdate = resolve;\n        });\n      }\n\n      await Promise.race([\n        this._waitForUpdate,\n        new Promise((_, reject) => {\n          if (abort?.aborted) {\n            reject(abort?.reason);\n          }\n          abort?.addEventListener('abort', () => {\n            reject(abort.reason);\n          });\n        }),\n      ]);\n\n      return this.asyncPop(abort);\n    }\n  }\n\n  override push(id: string, priority: number = 0) {\n    super.push(id, priority);\n    if (this._resolveUpdate) {\n      const resolve = this._resolveUpdate;\n      this._resolveUpdate = null;\n      this._waitForUpdate = null;\n      resolve();\n    }\n  }\n}\n","import { DebugLogger } from '@affine/debug';\nimport { Unreachable } from '@affine/env/constant';\nimport { groupBy } from 'lodash-es';\nimport { Observable, Subject } from 'rxjs';\nimport type { Doc as YDoc } from 'yjs';\nimport { applyUpdate, encodeStateAsUpdate, mergeUpdates } from 'yjs';\n\nimport { LiveData } from '../../livedata';\nimport { throwIfAborted } from '../../utils';\nimport { AsyncPriorityQueue } from './async-priority-queue';\nimport type { DocEvent } from './event';\nimport type { DocStorageInner } from './storage';\nimport { isEmptyUpdate } from './utils';\n\ntype Job =\n  | {\n      type: 'load';\n      docId: string;\n    }\n  | {\n      type: 'save';\n      docId: string;\n      update: Uint8Array;\n    }\n  | {\n      type: 'apply';\n      docId: string;\n      update: Uint8Array;\n      isInitialize: boolean;\n    };\n\nconst DOC_ENGINE_ORIGIN = 'doc-engine';\n\nconst logger = new DebugLogger('doc-engine:local');\n\nexport interface LocalEngineState {\n  total: number;\n  syncing: number;\n}\n\nexport interface LocalDocState {\n  ready: boolean;\n  loading: boolean;\n  syncing: boolean;\n}\n\n/**\n * never fail\n */\nexport class DocEngineLocalPart {\n  private readonly prioritySettings = new Map<string, number>();\n  private readonly statusUpdatedSubject$ = new Subject<string>();\n\n  private readonly status = {\n    docs: new Map<string, YDoc>(),\n    connectedDocs: new Set<string>(),\n    readyDocs: new Set<string>(),\n    jobDocQueue: new AsyncPriorityQueue(),\n    jobMap: new Map<string, Job[]>(),\n    currentJob: null as { docId: string; jobs: Job[] } | null,\n  };\n\n  engineState$ = LiveData.from<LocalEngineState>(\n    new Observable(subscribe => {\n      const next = () => {\n        subscribe.next({\n          total: this.status.docs.size,\n          syncing: this.status.jobMap.size + (this.status.currentJob ? 1 : 0),\n        });\n      };\n      next();\n      return this.statusUpdatedSubject$.subscribe(() => {\n        next();\n      });\n    }),\n    { syncing: 0, total: 0 }\n  );\n\n  docState$(docId: string) {\n    return LiveData.from<LocalDocState>(\n      new Observable(subscribe => {\n        const next = () => {\n          subscribe.next({\n            ready: this.status.readyDocs.has(docId) ?? false,\n            loading: this.status.connectedDocs.has(docId),\n            syncing:\n              (this.status.jobMap.get(docId)?.length ?? 0) > 0 ||\n              this.status.currentJob?.docId === docId,\n          });\n        };\n        next();\n        return this.statusUpdatedSubject$.subscribe(updatedId => {\n          if (updatedId === docId) next();\n        });\n      }),\n      { ready: false, loading: false, syncing: false }\n    );\n  }\n\n  constructor(\n    private readonly clientId: string,\n    private readonly storage: DocStorageInner\n  ) {}\n\n  async mainLoop(signal?: AbortSignal) {\n    const dispose = this.storage.eventBus.on(event => {\n      const handler = this.events[event.type];\n      if (handler) {\n        handler(event as any);\n      }\n    });\n    try {\n      // eslint-disable-next-line no-constant-condition\n      while (true) {\n        throwIfAborted(signal);\n        const docId = await this.status.jobDocQueue.asyncPop(signal);\n        const jobs = this.status.jobMap.get(docId);\n        this.status.jobMap.delete(docId);\n\n        if (!jobs) {\n          continue;\n        }\n\n        this.status.currentJob = { docId, jobs };\n        this.statusUpdatedSubject$.next(docId);\n\n        const { apply, load, save } = groupBy(jobs, job => job.type) as {\n          [key in Job['type']]?: Job[];\n        };\n\n        if (load?.length) {\n          await this.jobs.load(load[0] as any, signal);\n        }\n\n        for (const applyJob of apply ?? []) {\n          await this.jobs.apply(applyJob as any, signal);\n        }\n\n        if (save?.length) {\n          await this.jobs.save(docId, save as any, signal);\n        }\n\n        this.status.currentJob = null;\n        this.statusUpdatedSubject$.next(docId);\n      }\n    } finally {\n      dispose();\n\n      for (const docs of this.status.connectedDocs) {\n        const doc = this.status.docs.get(docs);\n        if (doc) {\n          doc.off('update', this.handleDocUpdate);\n        }\n      }\n    }\n  }\n\n  readonly actions = {\n    addDoc: (doc: YDoc) => {\n      this.schedule({\n        type: 'load',\n        docId: doc.guid,\n      });\n\n      this.status.docs.set(doc.guid, doc);\n      this.statusUpdatedSubject$.next(doc.guid);\n    },\n    markAsReady: (docId: string) => {\n      this.status.readyDocs.add(docId);\n      this.statusUpdatedSubject$.next(docId);\n    },\n  };\n\n  readonly jobs = {\n    load: async (job: Job & { type: 'load' }, signal?: AbortSignal) => {\n      const doc = this.status.docs.get(job.docId);\n      if (!doc) {\n        throw new Unreachable('doc not found');\n      }\n      const existingData = encodeStateAsUpdate(doc);\n\n      if (!isEmptyUpdate(existingData)) {\n        this.schedule({\n          type: 'save',\n          docId: doc.guid,\n          update: existingData,\n        });\n      }\n\n      // mark doc as loaded\n      doc.emit('sync', [true, doc]);\n      doc.on('update', this.handleDocUpdate);\n\n      this.status.connectedDocs.add(job.docId);\n      this.statusUpdatedSubject$.next(job.docId);\n\n      const docData = await this.storage.loadDocFromLocal(job.docId, signal);\n\n      if (!docData || isEmptyUpdate(docData)) {\n        return;\n      }\n\n      this.applyUpdate(job.docId, docData);\n      this.status.readyDocs.add(job.docId);\n      this.statusUpdatedSubject$.next(job.docId);\n    },\n    save: async (\n      docId: string,\n      jobs: (Job & { type: 'save' })[],\n      signal?: AbortSignal\n    ) => {\n      if (this.status.connectedDocs.has(docId)) {\n        const merged = mergeUpdates(\n          jobs.map(j => j.update).filter(update => !isEmptyUpdate(update))\n        );\n        const newSeqNum = await this.storage.commitDocAsClientUpdate(\n          docId,\n          merged,\n          signal\n        );\n        this.storage.eventBus.emit({\n          type: 'ClientUpdateCommitted',\n          seqNum: newSeqNum,\n          docId: docId,\n          clientId: this.clientId,\n          update: merged,\n        });\n      }\n    },\n    apply: async (job: Job & { type: 'apply' }, signal?: AbortSignal) => {\n      throwIfAborted(signal);\n      if (this.status.connectedDocs.has(job.docId)) {\n        this.applyUpdate(job.docId, job.update);\n      }\n      if (job.isInitialize && !isEmptyUpdate(job.update)) {\n        this.status.readyDocs.add(job.docId);\n        this.statusUpdatedSubject$.next(job.docId);\n      }\n    },\n  };\n\n  readonly events: {\n    [key in DocEvent['type']]?: (event: DocEvent & { type: key }) => void;\n  } = {\n    ServerUpdateCommitted: ({ docId, update, clientId }) => {\n      this.schedule({\n        type: 'apply',\n        docId,\n        update,\n        isInitialize: clientId === this.clientId,\n      });\n    },\n    ClientUpdateCommitted: ({ docId, update, clientId }) => {\n      if (clientId !== this.clientId) {\n        this.schedule({\n          type: 'apply',\n          docId,\n          update,\n          isInitialize: false,\n        });\n      }\n    },\n  };\n\n  handleDocUpdate = (update: Uint8Array, origin: any, doc: YDoc) => {\n    if (origin === DOC_ENGINE_ORIGIN) {\n      return;\n    }\n\n    this.schedule({\n      type: 'save',\n      docId: doc.guid,\n      update,\n    });\n  };\n\n  applyUpdate(docId: string, update: Uint8Array) {\n    const doc = this.status.docs.get(docId);\n    if (doc && !isEmptyUpdate(update)) {\n      try {\n        applyUpdate(doc, update, DOC_ENGINE_ORIGIN);\n      } catch (err) {\n        logger.error('failed to apply update yjs doc', err);\n      }\n    }\n  }\n\n  schedule(job: Job) {\n    const priority = this.prioritySettings.get(job.docId) ?? 0;\n    this.status.jobDocQueue.push(job.docId, priority);\n\n    const existingJobs = this.status.jobMap.get(job.docId) ?? [];\n    existingJobs.push(job);\n    this.status.jobMap.set(job.docId, existingJobs);\n    this.statusUpdatedSubject$.next(job.docId);\n  }\n\n  setPriority(docId: string, priority: number) {\n    this.prioritySettings.set(docId, priority);\n    this.status.jobDocQueue.updatePriority(docId, priority);\n  }\n}\n","export class ClockMap {\n  max: number = 0;\n  constructor(private readonly map: Map<string, number>) {\n    for (const value of map.values()) {\n      if (value > this.max) {\n        this.max = value;\n      }\n    }\n  }\n\n  get(id: string): number {\n    return this.map.get(id) ?? 0;\n  }\n\n  set(id: string, value: number) {\n    this.map.set(id, value);\n    if (value > this.max) {\n      this.max = value;\n    }\n  }\n\n  setIfBigger(id: string, value: number) {\n    if (value > this.get(id)) {\n      this.set(id, value);\n    }\n  }\n\n  clear() {\n    this.map.clear();\n    this.max = 0;\n  }\n}\n","import { DebugLogger } from '@affine/debug';\nimport { remove } from 'lodash-es';\nimport { Observable, Subject } from 'rxjs';\nimport { diffUpdate, encodeStateVectorFromUpdate, mergeUpdates } from 'yjs';\n\nimport { LiveData } from '../../livedata';\nimport { throwIfAborted } from '../../utils';\nimport { AsyncPriorityQueue } from './async-priority-queue';\nimport { ClockMap } from './clock';\nimport type { DocEvent } from './event';\nimport type { DocServer } from './server';\nimport type { DocStorageInner } from './storage';\nimport { isEmptyUpdate } from './utils';\n\nconst logger = new DebugLogger('doc-engine:remote');\n\ntype Job =\n  | {\n      type: 'connect';\n      docId: string;\n    }\n  | {\n      type: 'push';\n      docId: string;\n      update: Uint8Array;\n      seqNum: number;\n    }\n  | {\n      type: 'pull';\n      docId: string;\n    }\n  | {\n      type: 'pullAndPush';\n      docId: string;\n    }\n  | {\n      type: 'save';\n      docId: string;\n      update?: Uint8Array;\n      serverClock: number;\n    };\n\nexport interface Status {\n  docs: Set<string>;\n  connectedDocs: Set<string>;\n  jobDocQueue: AsyncPriorityQueue;\n  jobMap: Map<string, Job[]>;\n  serverClocks: ClockMap;\n  syncing: boolean;\n  retrying: boolean;\n  errorMessage: string | null;\n}\n\nexport interface RemoteEngineState {\n  total: number;\n  syncing: number;\n  retrying: boolean;\n  errorMessage: string | null;\n}\n\nexport interface RemoteDocState {\n  syncing: boolean;\n  retrying: boolean;\n  serverClock: number | null;\n  errorMessage: string | null;\n}\n\nexport class DocEngineRemotePart {\n  private readonly prioritySettings = new Map<string, number>();\n\n  constructor(\n    private readonly clientId: string,\n    private readonly storage: DocStorageInner,\n    private readonly server: DocServer\n  ) {}\n\n  private status: Status = {\n    docs: new Set<string>(),\n    connectedDocs: new Set<string>(),\n    jobDocQueue: new AsyncPriorityQueue(),\n    jobMap: new Map(),\n    serverClocks: new ClockMap(new Map()),\n    syncing: false,\n    retrying: false,\n    errorMessage: null,\n  };\n  private readonly statusUpdatedSubject$ = new Subject<string | true>();\n\n  engineState$ = LiveData.from<RemoteEngineState>(\n    new Observable(subscribe => {\n      const next = () => {\n        if (!this.status.syncing) {\n          // if syncing = false, jobMap is empty\n          subscribe.next({\n            total: this.status.docs.size,\n            syncing: this.status.docs.size,\n            retrying: this.status.retrying,\n            errorMessage: this.status.errorMessage,\n          });\n        } else {\n          const syncing = this.status.jobMap.size;\n          subscribe.next({\n            total: this.status.docs.size,\n            syncing: syncing,\n            retrying: this.status.retrying,\n            errorMessage: this.status.errorMessage,\n          });\n        }\n      };\n      next();\n      return this.statusUpdatedSubject$.subscribe(() => {\n        next();\n      });\n    }),\n    {\n      syncing: 0,\n      total: 0,\n      retrying: false,\n      errorMessage: null,\n    }\n  );\n\n  docState$(docId: string) {\n    return LiveData.from<RemoteDocState>(\n      new Observable(subscribe => {\n        const next = () => {\n          subscribe.next({\n            syncing:\n              !this.status.connectedDocs.has(docId) ||\n              this.status.jobMap.has(docId),\n            serverClock: this.status.serverClocks.get(docId),\n            retrying: this.status.retrying,\n            errorMessage: this.status.errorMessage,\n          });\n        };\n        next();\n        return this.statusUpdatedSubject$.subscribe(updatedId => {\n          if (updatedId === true || updatedId === docId) next();\n        });\n      }),\n      { syncing: false, retrying: false, errorMessage: null, serverClock: null }\n    );\n  }\n\n  readonly jobs = {\n    connect: async (docId: string, signal?: AbortSignal) => {\n      const pushedSeqNum = await this.storage.loadDocSeqNumPushed(\n        docId,\n        signal\n      );\n      const seqNum = await this.storage.loadDocSeqNum(docId, signal);\n\n      if (pushedSeqNum === null || pushedSeqNum !== seqNum) {\n        await this.jobs.pullAndPush(docId, signal);\n      } else {\n        const pulled = await this.storage.loadDocServerClockPulled(docId);\n        if (\n          pulled === null ||\n          pulled !== this.status.serverClocks.get(normalizeServerDocId(docId))\n        ) {\n          await this.jobs.pull(docId, signal);\n        }\n      }\n\n      this.status.connectedDocs.add(docId);\n      this.statusUpdatedSubject$.next(docId);\n    },\n    push: async (\n      docId: string,\n      jobs: (Job & { type: 'push' })[],\n      signal?: AbortSignal\n    ) => {\n      if (this.status.connectedDocs.has(docId)) {\n        const maxSeqNum = Math.max(...jobs.map(j => j.seqNum));\n        const pushedSeqNum =\n          (await this.storage.loadDocSeqNumPushed(docId, signal)) ?? 0;\n\n        if (maxSeqNum - pushedSeqNum === jobs.length) {\n          const merged = mergeUpdates(\n            jobs.map(j => j.update).filter(update => !isEmptyUpdate(update))\n          );\n          if (!isEmptyUpdate(merged)) {\n            const { serverClock } = await this.server.pushDoc(docId, merged);\n            this.schedule({\n              type: 'save',\n              docId,\n              serverClock,\n            });\n          }\n          await this.storage.saveDocPushedSeqNum(\n            docId,\n            { add: jobs.length },\n            signal\n          );\n        } else {\n          // maybe other tab is modifying the doc, do full pull and push for safety\n          await this.jobs.pullAndPush(docId, signal);\n        }\n      }\n    },\n    pullAndPush: async (docId: string, signal?: AbortSignal) => {\n      const seqNum = await this.storage.loadDocSeqNum(docId, signal);\n      const data = await this.storage.loadDocFromLocal(docId, signal);\n\n      const stateVector =\n        data && !isEmptyUpdate(data)\n          ? encodeStateVectorFromUpdate(data)\n          : new Uint8Array();\n      const serverData = await this.server.pullDoc(docId, stateVector);\n\n      if (serverData) {\n        const {\n          data: newData,\n          stateVector: serverStateVector,\n          serverClock,\n        } = serverData;\n        await this.storage.saveServerClock(\n          new Map([[normalizeServerDocId(docId), serverClock]]),\n          signal\n        );\n        this.actions.updateServerClock(\n          normalizeServerDocId(docId),\n          serverClock\n        );\n        await this.storage.commitDocAsServerUpdate(\n          docId,\n          newData,\n          serverClock,\n          signal\n        );\n        this.storage.eventBus.emit({\n          type: 'ServerUpdateCommitted',\n          docId,\n          clientId: this.clientId,\n          update: newData,\n        });\n        const diff =\n          data && serverStateVector && serverStateVector.length > 0\n            ? diffUpdate(data, serverStateVector)\n            : data;\n        if (diff && !isEmptyUpdate(diff)) {\n          const { serverClock } = await this.server.pushDoc(docId, diff);\n          this.schedule({\n            type: 'save',\n            docId,\n            serverClock,\n          });\n        }\n        await this.storage.saveDocPushedSeqNum(docId, seqNum, signal);\n      } else {\n        if (data && !isEmptyUpdate(data)) {\n          const { serverClock } = await this.server.pushDoc(docId, data);\n          await this.storage.saveDocServerClockPulled(\n            docId,\n            serverClock,\n            signal\n          );\n          await this.storage.saveServerClock(\n            new Map([[normalizeServerDocId(docId), serverClock]]),\n            signal\n          );\n          this.actions.updateServerClock(\n            normalizeServerDocId(docId),\n            serverClock\n          );\n        }\n        await this.storage.saveDocPushedSeqNum(docId, seqNum, signal);\n      }\n    },\n    pull: async (docId: string, signal?: AbortSignal) => {\n      const data = await this.storage.loadDocFromLocal(docId, signal);\n\n      const stateVector =\n        data && !isEmptyUpdate(data)\n          ? encodeStateVectorFromUpdate(data)\n          : new Uint8Array();\n      const serverDoc = await this.server.pullDoc(docId, stateVector);\n      if (!serverDoc) {\n        return;\n      }\n      const { data: newData, serverClock } = serverDoc;\n      await this.storage.commitDocAsServerUpdate(\n        docId,\n        newData,\n        serverClock,\n        signal\n      );\n      this.storage.eventBus.emit({\n        type: 'ServerUpdateCommitted',\n        docId,\n        clientId: this.clientId,\n        update: newData,\n      });\n      await this.storage.saveServerClock(\n        new Map([[normalizeServerDocId(docId), serverClock]]),\n        signal\n      );\n      this.actions.updateServerClock(normalizeServerDocId(docId), serverClock);\n    },\n    save: async (\n      docId: string,\n      jobs: (Job & { type: 'save' })[],\n      signal?: AbortSignal\n    ) => {\n      const serverClock = jobs.reduce((a, b) => Math.max(a, b.serverClock), 0);\n      await this.storage.saveServerClock(\n        new Map([[normalizeServerDocId(docId), serverClock]]),\n        signal\n      );\n      this.actions.updateServerClock(normalizeServerDocId(docId), serverClock);\n      if (this.status.connectedDocs.has(docId)) {\n        const data = jobs\n          .map(j => j.update)\n          .filter((update): update is Uint8Array =>\n            update ? !isEmptyUpdate(update) : false\n          );\n        const update = data.length > 0 ? mergeUpdates(data) : new Uint8Array();\n        await this.storage.commitDocAsServerUpdate(\n          docId,\n          update,\n          serverClock,\n          signal\n        );\n        this.storage.eventBus.emit({\n          type: 'ServerUpdateCommitted',\n          docId,\n          clientId: this.clientId,\n          update,\n        });\n      }\n    },\n  };\n\n  readonly actions = {\n    updateServerClock: (docId: string, serverClock: number) => {\n      this.status.serverClocks.setIfBigger(docId, serverClock);\n      this.statusUpdatedSubject$.next(docId);\n    },\n    addDoc: (docId: string) => {\n      if (!this.status.docs.has(docId)) {\n        this.status.docs.add(docId);\n        this.statusUpdatedSubject$.next(docId);\n        this.schedule({\n          type: 'connect',\n          docId,\n        });\n      }\n    },\n  };\n\n  readonly events: {\n    [key in DocEvent['type']]?: (event: DocEvent & { type: key }) => void;\n  } = {\n    ClientUpdateCommitted: ({ clientId, docId, seqNum, update }) => {\n      if (clientId !== this.clientId) {\n        return;\n      }\n      this.schedule({\n        type: 'push',\n        docId,\n        update,\n        seqNum,\n      });\n    },\n  };\n\n  async mainLoop(signal?: AbortSignal) {\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      try {\n        await this.retryLoop(signal);\n      } catch (err) {\n        if (signal?.aborted) {\n          return;\n        }\n        logger.error('Remote sync error, retry in 5s', err);\n        this.status.errorMessage =\n          err instanceof Error ? err.message : `${err}`;\n        this.statusUpdatedSubject$.next(true);\n      } finally {\n        this.status = {\n          docs: this.status.docs,\n          connectedDocs: new Set<string>(),\n          jobDocQueue: new AsyncPriorityQueue(),\n          jobMap: new Map(),\n          serverClocks: new ClockMap(new Map()),\n          syncing: false,\n          retrying: true,\n          errorMessage: this.status.errorMessage,\n        };\n        this.statusUpdatedSubject$.next(true);\n      }\n      await Promise.race([\n        new Promise<void>(resolve => {\n          setTimeout(resolve, 5 * 1000);\n        }),\n        new Promise((_, reject) => {\n          // exit if manually stopped\n          if (signal?.aborted) {\n            reject(signal.reason);\n          }\n          signal?.addEventListener('abort', () => {\n            reject(signal.reason);\n          });\n        }),\n      ]);\n    }\n  }\n\n  async retryLoop(signal?: AbortSignal) {\n    throwIfAborted(signal);\n    const abort = new AbortController();\n\n    signal?.addEventListener('abort', reason => {\n      abort.abort(reason);\n    });\n\n    signal = abort.signal;\n\n    const disposes: (() => void)[] = [];\n\n    try {\n      disposes.push(\n        this.storage.eventBus.on(event => {\n          const handler = this.events[event.type];\n          handler?.(event as any);\n        })\n      );\n      throwIfAborted(signal);\n\n      for (const doc of this.status.docs) {\n        this.schedule({\n          type: 'connect',\n          docId: doc,\n        });\n      }\n\n      logger.info('Remote sync started');\n      this.status.syncing = true;\n      this.statusUpdatedSubject$.next(true);\n\n      this.server.onInterrupted(reason => {\n        abort.abort(reason);\n      });\n      await Promise.race([\n        this.server.waitForConnectingServer(signal),\n        new Promise<void>((_, reject) => {\n          setTimeout(() => {\n            reject(new Error('Connect to server timeout'));\n          }, 1000 * 30);\n        }),\n        new Promise((_, reject) => {\n          signal?.addEventListener('abort', reason => {\n            reject(reason);\n          });\n        }),\n      ]);\n\n      // reset retrying flag after connected with server\n      this.status.retrying = false;\n      this.statusUpdatedSubject$.next(true);\n\n      throwIfAborted(signal);\n      disposes.push(\n        await this.server.subscribeAllDocs(({ docId, data, serverClock }) => {\n          this.schedule({\n            type: 'save',\n            docId: docId,\n            serverClock,\n            update: data,\n          });\n        })\n      );\n      const cachedClocks = await this.storage.loadServerClock(signal);\n      for (const [id, v] of cachedClocks) {\n        this.actions.updateServerClock(id, v);\n      }\n      const maxClockValue = this.status.serverClocks.max;\n      const newClocks = await this.server.loadServerClock(maxClockValue);\n      for (const [id, v] of newClocks) {\n        this.actions.updateServerClock(id, v);\n      }\n      await this.storage.saveServerClock(newClocks, signal);\n\n      // eslint-disable-next-line no-constant-condition\n      while (true) {\n        throwIfAborted(signal);\n\n        const docId = await this.status.jobDocQueue.asyncPop(signal);\n        // eslint-disable-next-line no-constant-condition\n        while (true) {\n          const jobs = this.status.jobMap.get(docId);\n          if (!jobs || jobs.length === 0) {\n            this.status.jobMap.delete(docId);\n            this.statusUpdatedSubject$.next(docId);\n            break;\n          }\n\n          const connect = remove(jobs, j => j.type === 'connect');\n          if (connect && connect.length > 0) {\n            await this.jobs.connect(docId, signal);\n            continue;\n          }\n\n          const pullAndPush = remove(jobs, j => j.type === 'pullAndPush');\n          if (pullAndPush && pullAndPush.length > 0) {\n            await this.jobs.pullAndPush(docId, signal);\n            continue;\n          }\n\n          const pull = remove(jobs, j => j.type === 'pull');\n          if (pull && pull.length > 0) {\n            await this.jobs.pull(docId, signal);\n            continue;\n          }\n\n          const push = remove(jobs, j => j.type === 'push');\n          if (push && push.length > 0) {\n            await this.jobs.push(\n              docId,\n              push as (Job & { type: 'push' })[],\n              signal\n            );\n            continue;\n          }\n\n          const save = remove(jobs, j => j.type === 'save');\n          if (save && save.length > 0) {\n            await this.jobs.save(\n              docId,\n              save as (Job & { type: 'save' })[],\n              signal\n            );\n            continue;\n          }\n        }\n      }\n    } finally {\n      for (const dispose of disposes) {\n        dispose();\n      }\n      try {\n        this.server.disconnectServer();\n      } catch (err) {\n        logger.error('Error on disconnect server', err);\n      }\n      this.status.syncing = false;\n      logger.info('Remote sync ended');\n    }\n  }\n\n  schedule(job: Job) {\n    const priority = this.prioritySettings.get(job.docId) ?? 0;\n    this.status.jobDocQueue.push(job.docId, priority);\n\n    const existingJobs = this.status.jobMap.get(job.docId) ?? [];\n    existingJobs.push(job);\n    this.status.jobMap.set(job.docId, existingJobs);\n    this.statusUpdatedSubject$.next(job.docId);\n  }\n\n  setPriority(docId: string, priority: number) {\n    this.prioritySettings.set(docId, priority);\n    this.status.jobDocQueue.updatePriority(docId, priority);\n  }\n}\n\n// use normalized id in server clock\nfunction normalizeServerDocId(raw: string) {\n  enum DocVariant {\n    Workspace = 'workspace',\n    Page = 'page',\n    Space = 'space',\n    Settings = 'settings',\n    Unknown = 'unknown',\n  }\n\n  try {\n    if (!raw.length) {\n      throw new Error('Invalid Empty Doc ID');\n    }\n\n    let parts = raw.split(':');\n\n    if (parts.length > 3) {\n      // special adapt case `wsId:space:page:pageId`\n      if (parts[1] === DocVariant.Space && parts[2] === DocVariant.Page) {\n        parts = [parts[0], DocVariant.Space, parts[3]];\n      } else {\n        throw new Error(`Invalid format of Doc ID: ${raw}`);\n      }\n    } else if (parts.length === 2) {\n      // `${variant}:${guid}`\n      throw new Error('not supported');\n    } else if (parts.length === 1) {\n      // ${ws} or ${pageId}\n      parts = ['', DocVariant.Unknown, parts[0]];\n    }\n\n    const docId = parts.at(2);\n\n    if (!docId) {\n      throw new Error('ID is required');\n    }\n\n    return docId;\n  } catch (err) {\n    logger.error('Error on normalize docId ' + raw, err);\n    return raw;\n  }\n}\n","import { DebugLogger } from '@affine/debug';\nimport { nanoid } from 'nanoid';\nimport { map } from 'rxjs';\nimport type { Doc as YDoc } from 'yjs';\n\nimport { LiveData } from '../../livedata';\nimport { MANUALLY_STOP } from '../../utils';\nimport { DocEngineLocalPart } from './local';\nimport { DocEngineRemotePart } from './remote';\nimport type { DocServer } from './server';\nimport type { DocStorage } from './storage';\nimport { DocStorageInner } from './storage';\n\nconst logger = new DebugLogger('doc-engine');\n\nexport type { DocEvent, DocEventBus } from './event';\nexport { MemoryDocEventBus } from './event';\nexport type { DocServer } from './server';\nexport type { DocStorage } from './storage';\nexport {\n  MemoryStorage as MemoryDocStorage,\n  ReadonlyStorage as ReadonlyDocStorage,\n} from './storage';\n\nexport interface DocEngineDocState {\n  /**\n   * is syncing with the server\n   */\n  syncing: boolean;\n  /**\n   * is saving to local storage\n   */\n  saving: boolean;\n  /**\n   * is loading from local storage\n   */\n  loading: boolean;\n  retrying: boolean;\n  ready: boolean;\n  errorMessage: string | null;\n  serverClock: number | null;\n}\n\nexport class DocEngine {\n  readonly clientId: string;\n  localPart: DocEngineLocalPart;\n  remotePart: DocEngineRemotePart | null;\n\n  storage: DocStorageInner;\n\n  engineState$ = LiveData.computed(get => {\n    const localState = get(this.localPart.engineState$);\n    if (this.remotePart) {\n      const remoteState = get(this.remotePart?.engineState$);\n      return {\n        total: remoteState.total,\n        syncing: remoteState.syncing,\n        saving: localState.syncing,\n        retrying: remoteState.retrying,\n        errorMessage: remoteState.errorMessage,\n      };\n    }\n    return {\n      total: localState.total,\n      syncing: localState.syncing,\n      saving: localState.syncing,\n      retrying: false,\n      errorMessage: null,\n    };\n  });\n\n  docState$(docId: string) {\n    const localState$ = this.localPart.docState$(docId);\n    const remoteState$ = this.remotePart?.docState$(docId);\n    return LiveData.computed<DocEngineDocState>(get => {\n      const localState = get(localState$);\n      const remoteState = remoteState$ ? get(remoteState$) : null;\n      if (remoteState) {\n        return {\n          syncing: remoteState.syncing,\n          saving: localState.syncing,\n          loading: localState.syncing,\n          retrying: remoteState.retrying,\n          ready: localState.ready,\n          errorMessage: remoteState.errorMessage,\n          serverClock: remoteState.serverClock,\n        };\n      }\n      return {\n        syncing: localState.syncing,\n        saving: localState.syncing,\n        loading: localState.syncing,\n        ready: localState.ready,\n        retrying: false,\n        errorMessage: null,\n        serverClock: null,\n      };\n    });\n  }\n\n  markAsReady(docId: string) {\n    this.localPart.actions.markAsReady(docId);\n  }\n\n  constructor(\n    storage: DocStorage,\n    private readonly server?: DocServer | null\n  ) {\n    this.clientId = nanoid();\n    this.storage = new DocStorageInner(storage);\n    this.localPart = new DocEngineLocalPart(this.clientId, this.storage);\n    this.remotePart = this.server\n      ? new DocEngineRemotePart(this.clientId, this.storage, this.server)\n      : null;\n  }\n\n  abort = new AbortController();\n\n  start() {\n    this.abort.abort(MANUALLY_STOP);\n    this.abort = new AbortController();\n    Promise.all([\n      this.localPart.mainLoop(this.abort.signal),\n      this.remotePart?.mainLoop(this.abort.signal),\n    ]).catch(err => {\n      if (err === MANUALLY_STOP) {\n        return;\n      }\n      logger.error('Doc engine error', err);\n    });\n    return this;\n  }\n\n  stop() {\n    this.abort.abort(MANUALLY_STOP);\n  }\n\n  async resetSyncStatus() {\n    this.stop();\n    await this.storage.clearSyncMetadata();\n    await this.storage.clearServerClock();\n  }\n\n  addDoc(doc: YDoc, withSubDocs = true) {\n    this.localPart.actions.addDoc(doc);\n    this.remotePart?.actions.addDoc(doc.guid);\n\n    if (withSubDocs) {\n      const subdocs = doc.getSubdocs();\n      for (const subdoc of subdocs) {\n        this.addDoc(subdoc, false);\n      }\n      doc.on('subdocs', ({ added }: { added: Set<YDoc> }) => {\n        for (const subdoc of added) {\n          this.addDoc(subdoc, false);\n        }\n      });\n    }\n  }\n\n  setPriority(docId: string, priority: number) {\n    this.localPart.setPriority(docId, priority);\n    this.remotePart?.setPriority(docId, priority);\n  }\n\n  /**\n   * ## Saved:\n   * YDoc changes have been saved to storage, and the browser can be safely closed without losing data.\n   */\n  waitForSaved() {\n    return new Promise<void>(resolve => {\n      this.engineState$\n        .pipe(map(state => state.saving === 0))\n        .subscribe(saved => {\n          if (saved) {\n            resolve();\n          }\n        });\n    });\n  }\n\n  /**\n   * ## Synced:\n   * is fully synchronized with the server\n   */\n  waitForSynced() {\n    return new Promise<void>(resolve => {\n      this.engineState$\n        .pipe(map(state => state.syncing === 0 && state.saving === 0))\n        .subscribe(synced => {\n          if (synced) {\n            resolve();\n          }\n        });\n    });\n  }\n\n  /**\n   * ## Ready:\n   *\n   * means that the doc has been loaded and the data can be modified.\n   * (is not force, you can still modify it if you know you are creating some new data)\n   *\n   * this is a temporary solution to deal with the yjs overwrite issue.\n   *\n   * if content is loaded from storage\n   * or if content is pulled from the server, it will be true, otherwise be false.\n   *\n   * For example, when opening a doc that is not in storage, ready = false until the content is pulled from the server.\n   */\n  waitForReady(docId: string) {\n    return new Promise<void>(resolve => {\n      this.docState$(docId)\n        .pipe(map(state => state.ready))\n        .subscribe(ready => {\n          if (ready) {\n            resolve();\n          }\n        });\n    });\n  }\n}\n","import type { Awareness } from 'y-protocols/awareness.js';\n\nexport interface AwarenessConnection {\n  connect(awareness: Awareness): void;\n  disconnect(): void;\n}\n\nexport class AwarenessEngine {\n  constructor(public readonly connections: AwarenessConnection[]) {}\n\n  connect(awareness: Awareness) {\n    this.connections.forEach(connection => connection.connect(awareness));\n  }\n\n  disconnect() {\n    this.connections.forEach(connection => connection.disconnect());\n  }\n}\n","import type { Doc as YDoc } from 'yjs';\n\nimport { Entity } from '../../../framework';\nimport { AwarenessEngine, BlobEngine, DocEngine } from '../../../sync';\nimport { throwIfAborted } from '../../../utils';\nimport { WorkspaceEngineBeforeStart } from '../events';\nimport type { WorkspaceEngineProvider } from '../providers/flavour';\nimport type { WorkspaceService } from '../services/workspace';\n\nexport class WorkspaceEngine extends Entity<{\n  engineProvider: WorkspaceEngineProvider;\n}> {\n  doc = new DocEngine(\n    this.props.engineProvider.getDocStorage(),\n    this.props.engineProvider.getDocServer()\n  );\n\n  blob = new BlobEngine(\n    this.props.engineProvider.getLocalBlobStorage(),\n    this.props.engineProvider.getRemoteBlobStorages()\n  );\n\n  awareness = new AwarenessEngine(\n    this.props.engineProvider.getAwarenessConnections()\n  );\n\n  constructor(private readonly workspaceService: WorkspaceService) {\n    super();\n  }\n\n  setRootDoc(yDoc: YDoc) {\n    this.doc.setPriority(yDoc.guid, 100);\n    this.doc.addDoc(yDoc);\n  }\n\n  start() {\n    this.eventBus.emit(WorkspaceEngineBeforeStart, this);\n    this.doc.start();\n    this.awareness.connect(this.workspaceService.workspace.awareness);\n    this.blob.start();\n  }\n\n  canGracefulStop() {\n    return this.doc.engineState$.value.saving === 0;\n  }\n\n  async waitForGracefulStop(abort?: AbortSignal) {\n    await this.doc.waitForSaved();\n    throwIfAborted(abort);\n    this.forceStop();\n  }\n\n  forceStop() {\n    this.doc.stop();\n    this.awareness.disconnect();\n    this.blob.stop();\n  }\n\n  docEngineState$ = this.doc.engineState$;\n\n  rootDocState$ = this.doc.docState$(this.workspaceService.workspace.id);\n\n  waitForDocSynced() {\n    return this.doc.waitForSynced();\n  }\n\n  waitForRootDocReady() {\n    return this.doc.waitForReady(this.workspaceService.workspace.id);\n  }\n\n  override dispose(): void {\n    this.forceStop();\n  }\n}\n","import type { DocCollection } from '@blocksuite/store';\nimport type { Array as YArray, Doc as YDoc, Map as YMap } from 'yjs';\n\n/**\n * For split migrate function from MigrationQueue.\n */\nexport enum MigrationPoint {\n  SubDoc = 1,\n  GuidFix = 2,\n  BlockVersion = 3,\n}\n\nexport function checkWorkspaceCompatibility(\n  docCollection: DocCollection,\n  isCloud: boolean\n): MigrationPoint | null {\n  // check if there is any key starts with 'space:' on root doc\n  const spaceMetaObj = docCollection.doc.share.get('space:meta') as\n    | YMap<any>\n    | undefined;\n  const docKeys = Array.from(docCollection.doc.share.keys());\n  const haveSpaceMeta = !!spaceMetaObj && spaceMetaObj.size > 0;\n  const haveLegacySpace = docKeys.some(key => key.startsWith('space:'));\n\n  // DON'T UPGRADE SUBDOC ON CLOUD\n  if (!isCloud && (haveSpaceMeta || haveLegacySpace)) {\n    return MigrationPoint.SubDoc;\n  }\n\n  // exit if no pages\n  if (!docCollection.meta.docs?.length) {\n    return null;\n  }\n\n  // check guid compatibility\n  const meta = docCollection.doc.getMap('meta') as YMap<unknown>;\n  const pages = meta.get('pages') as YArray<YMap<unknown>>;\n  for (const page of pages) {\n    const pageId = page.get('id') as string | undefined;\n    if (pageId?.includes(':')) {\n      return MigrationPoint.GuidFix;\n    }\n  }\n  const spaces = docCollection.doc.getMap('spaces') as YMap<YDoc>;\n  for (const [pageId, _] of spaces) {\n    if (pageId.includes(':')) {\n      return MigrationPoint.GuidFix;\n    }\n  }\n\n  const hasVersion = docCollection.meta.hasVersion;\n  if (!hasVersion) {\n    return MigrationPoint.BlockVersion;\n  }\n\n  // Temporarily follow the check logic of blocksuite.\n  if ((docCollection.meta.docs?.length ?? 0) <= 1) {\n    try {\n      docCollection.meta.validateVersion(docCollection);\n    } catch (e) {\n      console.info('validateVersion error', e);\n      return MigrationPoint.BlockVersion;\n    }\n  }\n\n  // From v2, we depend on blocksuite to check and migrate data.\n  const blockVersions = docCollection.meta.blockVersions;\n  for (const [flavour, version] of Object.entries(blockVersions ?? {})) {\n    const schema = docCollection.schema.flavourSchemaMap.get(flavour);\n    if (schema?.version !== version) {\n      return MigrationPoint.BlockVersion;\n    }\n  }\n\n  return null;\n}\n","import { nanoid } from 'nanoid';\nimport {\n  applyUpdate,\n  Array as YArray,\n  Doc as YDoc,\n  encodeStateAsUpdate,\n  Map as YMap,\n} from 'yjs';\n\nconst migrationOrigin = 'affine-migration';\n\ntype XYWH = [number, number, number, number];\n\nfunction deserializeXYWH(xywh: string): XYWH {\n  return JSON.parse(xywh) as XYWH;\n}\n\nfunction migrateDatabase(data: YMap<unknown>) {\n  data.delete('prop:mode');\n  data.set('prop:views', new YArray());\n  const columns = (data.get('prop:columns') as YArray<unknown>).toJSON() as {\n    id: string;\n    name: string;\n    hide: boolean;\n    type: string;\n    width: number;\n    selection?: unknown[];\n  }[];\n  const views = [\n    {\n      id: 'default',\n      name: 'Table',\n      columns: columns.map(col => ({\n        id: col.id,\n        width: col.width,\n        hide: col.hide,\n      })),\n      filter: { type: 'group', op: 'and', conditions: [] },\n      mode: 'table',\n    },\n  ];\n  const cells = (data.get('prop:cells') as YMap<unknown>).toJSON() as Record<\n    string,\n    Record<\n      string,\n      {\n        id: string;\n        value: unknown;\n      }\n    >\n  >;\n  const convertColumn = (\n    id: string,\n    update: (cell: { id: string; value: unknown }) => void\n  ) => {\n    Object.values(cells).forEach(row => {\n      if (row[id] !== null && row[id] !== undefined) {\n        update(row[id]);\n      }\n    });\n  };\n  const newColumns = columns.map(v => {\n    let data: Record<string, unknown> = {};\n    if (v.type === 'select' || v.type === 'multi-select') {\n      data = { options: v.selection };\n      if (v.type === 'select') {\n        convertColumn(v.id, cell => {\n          if (Array.isArray(cell.value)) {\n            cell.value = cell.value[0]?.id;\n          }\n        });\n      } else {\n        convertColumn(v.id, cell => {\n          if (Array.isArray(cell.value)) {\n            cell.value = cell.value.map(v => v.id);\n          }\n        });\n      }\n    }\n    if (v.type === 'number') {\n      convertColumn(v.id, cell => {\n        if (typeof cell.value === 'string') {\n          cell.value = Number.parseFloat(cell.value.toString());\n        }\n      });\n    }\n    return {\n      id: v.id,\n      type: v.type,\n      name: v.name,\n      data,\n    };\n  });\n  data.set('prop:columns', newColumns);\n  data.set('prop:views', views);\n  data.set('prop:cells', cells);\n}\n\nfunction runBlockMigration(\n  flavour: string,\n  data: YMap<unknown>,\n  version: number\n) {\n  if (flavour === 'affine:frame') {\n    data.set('sys:flavour', 'affine:note');\n    return;\n  }\n  if (flavour === 'affine:surface' && version <= 3) {\n    if (data.has('elements')) {\n      const elements = data.get('elements') as YMap<unknown>;\n      migrateSurface(elements);\n      data.set('prop:elements', elements.clone());\n      data.delete('elements');\n    } else {\n      data.set('prop:elements', new YMap());\n    }\n  }\n  if (flavour === 'affine:embed') {\n    data.set('sys:flavour', 'affine:image');\n    data.delete('prop:type');\n  }\n  if (flavour === 'affine:database' && version < 2) {\n    migrateDatabase(data);\n  }\n}\n\nfunction migrateSurface(data: YMap<unknown>) {\n  for (const [, value] of <IterableIterator<[string, YMap<unknown>]>>(\n    data.entries()\n  )) {\n    if (value.get('type') === 'connector') {\n      migrateSurfaceConnector(value);\n    }\n  }\n}\n\nfunction migrateSurfaceConnector(data: YMap<any>) {\n  let id = data.get('startElement')?.id;\n  const controllers = data.get('controllers');\n  const length = controllers.length;\n  const xywh = deserializeXYWH(data.get('xywh'));\n  if (id) {\n    data.set('source', { id });\n  } else {\n    data.set('source', {\n      position: [controllers[0].x + xywh[0], controllers[0].y + xywh[1]],\n    });\n  }\n\n  id = data.get('endElement')?.id;\n  if (id) {\n    data.set('target', { id });\n  } else {\n    data.set('target', {\n      position: [\n        controllers[length - 1].x + xywh[0],\n        controllers[length - 1].y + xywh[1],\n      ],\n    });\n  }\n\n  const width = data.get('lineWidth') ?? 4;\n  data.set('strokeWidth', width);\n  const color = data.get('color');\n  data.set('stroke', color);\n\n  data.delete('startElement');\n  data.delete('endElement');\n  data.delete('controllers');\n  data.delete('lineWidth');\n  data.delete('color');\n  data.delete('xywh');\n}\n\nfunction updateBlockVersions(versions: YMap<number>) {\n  const frameVersion = versions.get('affine:frame');\n  if (frameVersion !== undefined) {\n    versions.set('affine:note', frameVersion);\n    versions.delete('affine:frame');\n  }\n  const embedVersion = versions.get('affine:embed');\n  if (embedVersion !== undefined) {\n    versions.set('affine:image', embedVersion);\n    versions.delete('affine:embed');\n  }\n  const databaseVersion = versions.get('affine:database');\n  if (databaseVersion !== undefined && databaseVersion < 2) {\n    versions.set('affine:database', 2);\n  }\n}\n\nfunction migrateMeta(\n  oldDoc: YDoc,\n  newDoc: YDoc,\n  idMap: Record<string, string>\n) {\n  const originalMeta = oldDoc.getMap('space:meta');\n  const originalVersions = originalMeta.get('versions') as YMap<number>;\n  const originalPages = originalMeta.get('pages') as YArray<YMap<string>>;\n  const meta = newDoc.getMap('meta');\n  const pages = new YArray();\n  const blockVersions = originalVersions.clone();\n\n  meta.set('workspaceVersion', 1);\n  meta.set('blockVersions', blockVersions);\n  meta.set('pages', pages);\n  meta.set('name', originalMeta.get('name') as string);\n\n  updateBlockVersions(blockVersions);\n  const mapList = originalPages.map(page => {\n    const map = new YMap();\n    Array.from(page.entries())\n      .filter(([key]) => key !== 'subpageIds')\n      .forEach(([key, value]) => {\n        if (key === 'id') {\n          idMap[value] = nanoid();\n          map.set(key, idMap[value]);\n        } else {\n          map.set(key, value);\n        }\n      });\n    return map;\n  });\n  pages.push(mapList);\n}\n\nfunction migrateBlocks(\n  oldDoc: YDoc,\n  newDoc: YDoc,\n  idMap: Record<string, string>\n) {\n  const spaces = newDoc.getMap('spaces');\n  const originalMeta = oldDoc.getMap('space:meta');\n  const originalVersions = originalMeta.get('versions') as YMap<number>;\n  const originalPages = originalMeta.get('pages') as YArray<YMap<unknown>>;\n  originalPages.forEach(page => {\n    const id = page.get('id') as string;\n    const newId = idMap[id];\n    const spaceId = id.startsWith('space:') ? id : `space:${id}`;\n    const originalBlocks = oldDoc.getMap(spaceId) as YMap<unknown>;\n    const subdoc = new YDoc();\n    spaces.set(newId, subdoc);\n    subdoc.guid = id;\n    const blocks = subdoc.getMap('blocks');\n    Array.from(originalBlocks.entries()).forEach(([key, value]) => {\n      // @ts-expect-error clone method exists\n      const blockData = value.clone();\n      blocks.set(key, blockData);\n      const flavour = blockData.get('sys:flavour') as string;\n      const version = originalVersions.get(flavour);\n      if (version !== undefined) {\n        runBlockMigration(flavour, blockData, version);\n      }\n    });\n  });\n}\n\nexport function migrateToSubdoc(oldDoc: YDoc): YDoc {\n  const needMigration =\n    Array.from(oldDoc.getMap('space:meta').keys()).length > 0;\n  if (!needMigration) {\n    return oldDoc;\n  }\n  const newDoc = new YDoc();\n  const idMap = {} as Record<string, string>;\n  migrateMeta(oldDoc, newDoc, idMap);\n  migrateBlocks(oldDoc, newDoc, idMap);\n  return newDoc;\n}\n\n/**\n * upgrade oldDoc to v2, write to targetDoc\n */\nexport const upgradeV1ToV2 = async (oldDoc: YDoc, targetDoc: YDoc) => {\n  const newDoc = migrateToSubdoc(oldDoc);\n  applyUpdate(targetDoc, encodeStateAsUpdate(newDoc), migrationOrigin);\n  newDoc.getSubdocs().forEach(subdoc => {\n    targetDoc.getSubdocs().forEach(newDoc => {\n      if (subdoc.guid === newDoc.guid) {\n        applyUpdate(newDoc, encodeStateAsUpdate(subdoc), migrationOrigin);\n      }\n    });\n  });\n};\n","import type { Schema } from '@blocksuite/store';\nimport type { Array as YArray } from 'yjs';\nimport {\n  applyUpdate,\n  Doc as YDoc,\n  encodeStateAsUpdate,\n  Map as YMap,\n  transact,\n} from 'yjs';\n\nexport const getLatestVersions = (schema: Schema): Record<string, number> => {\n  return [...schema.flavourSchemaMap.entries()].reduce(\n    (record, [flavour, schema]) => {\n      record[flavour] = schema.version;\n      return record;\n    },\n    {} as Record<string, number>\n  );\n};\n\nexport async function migratePages(\n  rootDoc: YDoc,\n  schema: Schema\n): Promise<boolean> {\n  const spaces = rootDoc.getMap('spaces') as YMap<any>;\n  const meta = rootDoc.getMap('meta') as YMap<unknown>;\n  const versions = meta.get('blockVersions') as YMap<number>;\n  const oldVersions = versions?.toJSON() ?? {};\n\n  spaces.forEach((space: YDoc) => {\n    try {\n      // Catch page upgrade error to avoid blocking the whole workspace migration.\n      schema.upgradeDoc(0, oldVersions, space);\n    } catch (e) {\n      console.error(e);\n    }\n  });\n  schema.upgradeCollection(rootDoc);\n\n  // Hard code to upgrade page version to 2.\n  // Let e2e to ensure the data version is correct.\n  return transact(\n    rootDoc,\n    () => {\n      const pageVersion = meta.get('pageVersion');\n      if (typeof pageVersion !== 'number' || pageVersion < 2) {\n        meta.set('pageVersion', 2);\n      }\n\n      const newVersions = getLatestVersions(schema);\n      meta.set('blockVersions', new YMap(Object.entries(newVersions)));\n      return Object.entries(oldVersions).some(\n        ([flavour, version]) => newVersions[flavour] !== version\n      );\n    },\n    'migratePages',\n    /**\n     * transact as remote update, because blocksuite will skip local changes.\n     * https://github.com/toeverything/blocksuite/blob/9c2df3f7aa5617c050e0dccdd73e99bb67e0c0f7/packages/store/src/reactive/utils.ts#L143\n     */\n    false\n  );\n}\n\n// patch root doc's space guid compatibility issue\n//\n// in version 0.10, page id in spaces no longer has prefix \"space:\"\n// The data flow for fetching a doc's updates is:\n// - page id in `meta.pages` -> find `${page-id}` in `doc.spaces` -> `doc` -> `doc.guid`\n// if `doc` is not found in `doc.spaces`, a new doc will be created and its `doc.guid` is the same with its pageId\n// - because of guid logic change, the doc that previously prefixed with \"space:\" will not be found in `doc.spaces`\n// - when fetching the rows of this doc using the doc id === page id,\n//   it will return empty since there is no updates associated with the page id\nexport function migrateGuidCompatibility(rootDoc: YDoc) {\n  const meta = rootDoc.getMap('meta') as YMap<unknown>;\n  const pages = meta.get('pages') as YArray<YMap<unknown>>;\n  pages?.forEach(page => {\n    const pageId = page.get('id') as string | undefined;\n    if (pageId?.includes(':')) {\n      // remove the prefix \"space:\" from page id\n      page.set('id', pageId.split(':').at(-1));\n    }\n  });\n  const spaces = rootDoc.getMap('spaces') as YMap<YDoc>;\n  spaces?.forEach((doc: YDoc, pageId: string) => {\n    if (pageId.includes(':')) {\n      const newPageId = pageId.split(':').at(-1) ?? pageId;\n      const newDoc = new YDoc();\n      // clone the original doc. yjs is not happy to use the same doc instance\n      applyUpdate(newDoc, encodeStateAsUpdate(doc));\n      newDoc.guid = doc.guid;\n      spaces.set(newPageId, newDoc);\n      // should remove the old doc, otherwise we will do it again in the next run\n      spaces.delete(pageId);\n      console.debug(\n        `fixed space id ${pageId} -> ${newPageId}, doc id: ${doc.guid}`\n      );\n    }\n  });\n}\n","import { Unreachable } from '@affine/env/constant';\nimport { WorkspaceFlavour } from '@affine/env/workspace';\nimport { applyUpdate, Doc as YDoc, encodeStateAsUpdate } from 'yjs';\n\nimport {\n  checkWorkspaceCompatibility,\n  forceUpgradePages,\n  migrateGuidCompatibility,\n  MigrationPoint,\n  upgradeV1ToV2,\n} from '../../../blocksuite';\nimport { Entity } from '../../../framework';\nimport { LiveData } from '../../../livedata';\nimport type { WorkspaceMetadata } from '../metadata';\nimport type { WorkspaceDestroyService } from '../services/destroy';\nimport type { WorkspaceFactoryService } from '../services/factory';\nimport type { WorkspaceService } from '../services/workspace';\n\nexport class WorkspaceUpgrade extends Entity {\n  needUpgrade$ = new LiveData(false);\n  upgrading$ = new LiveData(false);\n\n  constructor(\n    private readonly workspaceService: WorkspaceService,\n    private readonly workspaceFactory: WorkspaceFactoryService,\n    private readonly workspaceDestroy: WorkspaceDestroyService\n  ) {\n    super();\n    this.checkIfNeedUpgrade();\n    workspaceService.workspace.docCollection.doc.on('update', () => {\n      this.checkIfNeedUpgrade();\n    });\n  }\n\n  checkIfNeedUpgrade() {\n    const needUpgrade = !!checkWorkspaceCompatibility(\n      this.workspaceService.workspace.docCollection,\n      this.workspaceService.workspace.flavour === WorkspaceFlavour.AFFINE_CLOUD\n    );\n    this.needUpgrade$.next(needUpgrade);\n    return needUpgrade;\n  }\n\n  async upgrade(): Promise<WorkspaceMetadata | null> {\n    if (this.upgrading$.value) {\n      return null;\n    }\n\n    this.upgrading$.next(true);\n\n    try {\n      await this.workspaceService.workspace.engine.waitForDocSynced();\n\n      const step = checkWorkspaceCompatibility(\n        this.workspaceService.workspace.docCollection,\n        this.workspaceService.workspace.flavour ===\n          WorkspaceFlavour.AFFINE_CLOUD\n      );\n\n      if (!step) {\n        return null;\n      }\n\n      // Clone a new doc to prevent change events.\n      const clonedDoc = new YDoc({\n        guid: this.workspaceService.workspace.docCollection.doc.guid,\n      });\n      applyDoc(clonedDoc, this.workspaceService.workspace.docCollection.doc);\n\n      if (step === MigrationPoint.SubDoc) {\n        const newWorkspace = await this.workspaceFactory.create(\n          WorkspaceFlavour.LOCAL,\n          async (workspace, blobStorage) => {\n            await upgradeV1ToV2(clonedDoc, workspace.doc);\n            migrateGuidCompatibility(clonedDoc);\n            await forceUpgradePages(\n              workspace.doc,\n              this.workspaceService.workspace.docCollection.schema\n            );\n            const blobList =\n              await this.workspaceService.workspace.docCollection.blobSync.list();\n\n            for (const blobKey of blobList) {\n              const blob =\n                await this.workspaceService.workspace.docCollection.blobSync.get(\n                  blobKey\n                );\n              if (blob) {\n                await blobStorage.set(blobKey, blob);\n              }\n            }\n          }\n        );\n        await this.workspaceDestroy.deleteWorkspace(\n          this.workspaceService.workspace.meta\n        );\n        return newWorkspace;\n      } else if (step === MigrationPoint.GuidFix) {\n        migrateGuidCompatibility(clonedDoc);\n        await forceUpgradePages(\n          clonedDoc,\n          this.workspaceService.workspace.docCollection.schema\n        );\n        applyDoc(this.workspaceService.workspace.docCollection.doc, clonedDoc);\n        await this.workspaceService.workspace.engine.waitForDocSynced();\n        return null;\n      } else if (step === MigrationPoint.BlockVersion) {\n        await forceUpgradePages(\n          clonedDoc,\n          this.workspaceService.workspace.docCollection.schema\n        );\n        applyDoc(this.workspaceService.workspace.docCollection.doc, clonedDoc);\n        await this.workspaceService.workspace.engine.waitForDocSynced();\n        return null;\n      } else {\n        throw new Unreachable();\n      }\n    } finally {\n      this.upgrading$.next(false);\n    }\n  }\n}\n\nfunction applyDoc(target: YDoc, result: YDoc) {\n  applyUpdate(target, encodeStateAsUpdate(result));\n  for (const targetSubDoc of target.subdocs.values()) {\n    const resultSubDocs = Array.from(result.subdocs.values());\n    const resultSubDoc = resultSubDocs.find(\n      item => item.guid === targetSubDoc.guid\n    );\n    if (resultSubDoc) {\n      applyDoc(targetSubDoc, resultSubDoc);\n    }\n  }\n}\n","import { DocCollection } from '@blocksuite/store';\nimport { nanoid } from 'nanoid';\nimport { Observable } from 'rxjs';\nimport type { Awareness } from 'y-protocols/awareness.js';\n\nimport { Entity } from '../../../framework';\nimport { LiveData } from '../../../livedata';\nimport { globalBlockSuiteSchema } from '../global-schema';\nimport type { WorkspaceScope } from '../scopes/workspace';\nimport { WorkspaceEngineService } from '../services/engine';\nimport { WorkspaceUpgradeService } from '../services/upgrade';\n\nexport class Workspace extends Entity {\n  constructor(public readonly scope: WorkspaceScope) {\n    super();\n  }\n\n  readonly id = this.scope.props.openOptions.metadata.id;\n\n  readonly openOptions = this.scope.props.openOptions;\n\n  readonly meta = this.scope.props.openOptions.metadata;\n\n  readonly flavour = this.meta.flavour;\n\n  _docCollection: DocCollection | null = null;\n\n  get docCollection() {\n    if (!this._docCollection) {\n      this._docCollection = new DocCollection({\n        id: this.openOptions.metadata.id,\n        blobSources: {\n          main: this.engine.blob,\n        },\n        idGenerator: () => nanoid(),\n        schema: globalBlockSuiteSchema,\n        disableBacklinkIndex: true,\n        disableSearchIndex: true,\n      });\n    }\n    return this._docCollection;\n  }\n\n  get awareness() {\n    return this.docCollection.awarenessStore.awareness as Awareness;\n  }\n\n  get rootYDoc() {\n    return this.docCollection.doc;\n  }\n\n  get canGracefulStop() {\n    // TODO\n    return true;\n  }\n\n  get engine() {\n    return this.framework.get(WorkspaceEngineService).engine;\n  }\n\n  get upgrade() {\n    return this.framework.get(WorkspaceUpgradeService).upgrade;\n  }\n\n  get flavourProvider() {\n    return this.scope.props.flavourProvider;\n  }\n\n  name$ = LiveData.from<string | undefined>(\n    new Observable(subscriber => {\n      subscriber.next(this.docCollection.meta.name);\n      return this.docCollection.meta.commonFieldsUpdated.on(() => {\n        subscriber.next(this.docCollection.meta.name);\n      }).dispose;\n    }),\n    undefined\n  );\n\n  avatar$ = LiveData.from<string | undefined>(\n    new Observable(subscriber => {\n      subscriber.next(this.docCollection.meta.avatar);\n      return this.docCollection.meta.commonFieldsUpdated.on(() => {\n        subscriber.next(this.docCollection.meta.avatar);\n      }).dispose;\n    }),\n    undefined\n  );\n}\n","import { createEvent } from '../../../framework';\nimport type { WorkspaceEngine } from '../entities/engine';\n\nexport const WorkspaceEngineBeforeStart = createEvent<WorkspaceEngine>(\n  'WorkspaceEngineBeforeStart'\n);\n","import { AffineSchemas } from '@blocksuite/blocks/schemas';\nimport { AIChatBlockSchema } from '@blocksuite/presets';\nimport { Schema } from '@blocksuite/store';\n\nexport const globalBlockSuiteSchema = new Schema();\n\nconst schemas = [...AffineSchemas, AIChatBlockSchema];\nglobalBlockSuiteSchema.register(schemas);\n","import type { WorkspaceFlavour } from '@affine/env/workspace';\nimport type { DocCollection } from '@blocksuite/store';\n\nimport { createIdentifier } from '../../../framework';\nimport type { LiveData } from '../../../livedata';\nimport type {\n  AwarenessConnection,\n  BlobStorage,\n  DocServer,\n  DocStorage,\n} from '../../../sync';\nimport type { WorkspaceProfileInfo } from '../entities/profile';\nimport type { WorkspaceMetadata } from '../metadata';\n\nexport interface WorkspaceEngineProvider {\n  getDocServer(): DocServer | null;\n  getDocStorage(): DocStorage;\n  getLocalBlobStorage(): BlobStorage;\n  getRemoteBlobStorages(): BlobStorage[];\n  getAwarenessConnections(): AwarenessConnection[];\n}\n\nexport interface WorkspaceFlavourProvider {\n  flavour: WorkspaceFlavour;\n\n  deleteWorkspace(id: string): Promise<void>;\n\n  createWorkspace(\n    initial: (\n      docCollection: DocCollection,\n      blobStorage: BlobStorage,\n      docStorage: DocStorage\n    ) => Promise<void>\n  ): Promise<WorkspaceMetadata>;\n\n  workspaces$: LiveData<WorkspaceMetadata[]>;\n\n  /**\n   * means the workspace list is loading. if it's true, the workspace page will show loading spinner.\n   */\n  isLoading$?: LiveData<boolean>;\n\n  /**\n   * revalidate the workspace list.\n   *\n   * will be called when user open workspace list, or workspace not found.\n   */\n  revalidate?: () => void;\n\n  getWorkspaceProfile(\n    id: string,\n    signal?: AbortSignal\n  ): Promise<WorkspaceProfileInfo | undefined>;\n\n  getWorkspaceBlob(id: string, blob: string): Promise<Blob | null>;\n\n  getEngineProvider(workspaceId: string): WorkspaceEngineProvider;\n}\n\nexport const WorkspaceFlavourProvider =\n  createIdentifier<WorkspaceFlavourProvider>('WorkspaceFlavourProvider');\n","import { createIdentifier } from '../../../framework';\nimport type { Memento } from '../../../storage';\n\nexport interface WorkspaceLocalState extends Memento {}\nexport interface WorkspaceLocalCache extends Memento {}\n\nexport const WorkspaceLocalState = createIdentifier<WorkspaceLocalState>(\n  'WorkspaceLocalState'\n);\n\nexport const WorkspaceLocalCache = createIdentifier<WorkspaceLocalCache>(\n  'WorkspaceLocalCache'\n);\n","import { Scope } from '../../../framework';\nimport type { WorkspaceOpenOptions } from '../open-options';\nimport type { WorkspaceFlavourProvider } from '../providers/flavour';\n\nexport type { DocCollection } from '@blocksuite/store';\n\nexport class WorkspaceScope extends Scope<{\n  openOptions: WorkspaceOpenOptions;\n  flavourProvider: WorkspaceFlavourProvider;\n}> {}\n","import { Service } from '../../../framework';\nimport { WorkspaceEngine } from '../entities/engine';\nimport type { WorkspaceScope } from '../scopes/workspace';\n\nexport class WorkspaceEngineService extends Service {\n  private _engine: WorkspaceEngine | null = null;\n  get engine() {\n    if (!this._engine) {\n      this._engine = this.framework.createEntity(WorkspaceEngine, {\n        engineProvider:\n          this.workspaceScope.props.flavourProvider.getEngineProvider(\n            this.workspaceScope.props.openOptions.metadata.id\n          ),\n      });\n    }\n    return this._engine;\n  }\n\n  constructor(private readonly workspaceScope: WorkspaceScope) {\n    super();\n  }\n}\n","import { Service } from '../../../framework';\nimport { WorkspaceUpgrade } from '../entities/upgrade';\n\nexport class WorkspaceUpgradeService extends Service {\n  upgrade = this.framework.createEntity(WorkspaceUpgrade);\n}\n","import { Service } from '../../../framework';\nimport { Workspace } from '../entities/workspace';\n\nexport class WorkspaceService extends Service {\n  _workspace: Workspace | null = null;\n\n  get workspace() {\n    if (!this._workspace) {\n      this._workspace = this.framework.createEntity(Workspace);\n    }\n    return this._workspace;\n  }\n}\n","import { Service } from '../../../framework';\nimport type { WorkspaceMetadata } from '..';\nimport type { WorkspaceFlavourProvider } from '../providers/flavour';\nimport type { WorkspaceDestroyService } from './destroy';\nimport type { WorkspaceFactoryService } from './factory';\nimport type { WorkspaceListService } from './list';\nimport type { WorkspaceProfileService } from './profile';\nimport type { WorkspaceRepositoryService } from './repo';\nimport type { WorkspaceTransformService } from './transform';\n\nexport class WorkspacesService extends Service {\n  get list() {\n    return this.listService.list;\n  }\n\n  constructor(\n    private readonly providers: WorkspaceFlavourProvider[],\n    private readonly listService: WorkspaceListService,\n    private readonly profileRepo: WorkspaceProfileService,\n    private readonly transform: WorkspaceTransformService,\n    private readonly workspaceRepo: WorkspaceRepositoryService,\n    private readonly workspaceFactory: WorkspaceFactoryService,\n    private readonly destroy: WorkspaceDestroyService\n  ) {\n    super();\n  }\n\n  get deleteWorkspace() {\n    return this.destroy.deleteWorkspace;\n  }\n\n  get getProfile() {\n    return this.profileRepo.getProfile;\n  }\n\n  get transformLocalToCloud() {\n    return this.transform.transformLocalToCloud;\n  }\n\n  get open() {\n    return this.workspaceRepo.open;\n  }\n\n  get create() {\n    return this.workspaceFactory.create;\n  }\n\n  async getWorkspaceBlob(meta: WorkspaceMetadata, blob: string) {\n    return await this.providers\n      .find(x => x.flavour === meta.flavour)\n      ?.getWorkspaceBlob(meta.id, blob);\n  }\n}\n","import type { Observable } from 'rxjs';\n\nimport { LiveData } from '../livedata';\n\n/**\n * A memento represents a storage utility. It can store and retrieve values, and observe changes.\n */\nexport interface Memento {\n  get<T>(key: string): T | undefined;\n  watch<T>(key: string): Observable<T | undefined>;\n  set<T>(key: string, value: T | undefined): void;\n  del(key: string): void;\n  clear(): void;\n  keys(): string[];\n}\n\n/**\n * A simple implementation of Memento. Used for testing.\n */\nexport class MemoryMemento implements Memento {\n  private readonly data = new Map<string, LiveData<any>>();\n\n  setAll(init: Record<string, any>) {\n    for (const [key, value] of Object.entries(init)) {\n      this.set(key, value);\n    }\n  }\n\n  private getLiveData(key: string): LiveData<any> {\n    let data$ = this.data.get(key);\n    if (!data$) {\n      data$ = new LiveData<any>(undefined);\n      this.data.set(key, data$);\n    }\n    return data$;\n  }\n\n  get<T>(key: string): T | undefined {\n    return this.getLiveData(key).value;\n  }\n  watch<T>(key: string): Observable<T | undefined> {\n    return this.getLiveData(key).asObservable();\n  }\n  set<T>(key: string, value: T): void {\n    this.getLiveData(key).next(value);\n  }\n  keys(): string[] {\n    return Array.from(this.data)\n      .filter(([_, v$]) => v$.value !== undefined)\n      .map(([k]) => k);\n  }\n  clear(): void {\n    this.data.clear();\n  }\n  del(key: string): void {\n    this.data.delete(key);\n  }\n}\n\nexport function wrapMemento(memento: Memento, prefix: string): Memento {\n  return {\n    get<T>(key: string): T | undefined {\n      return memento.get(prefix + key);\n    },\n    watch(key: string) {\n      return memento.watch(prefix + key);\n    },\n    set<T>(key: string, value: T): void {\n      memento.set(prefix + key, value);\n    },\n    keys(): string[] {\n      return memento\n        .keys()\n        .filter(k => k.startsWith(prefix))\n        .map(k => k.slice(prefix.length));\n    },\n    clear() {\n      memento.keys().forEach(k => {\n        if (k.startsWith(prefix)) {\n          memento.del(k);\n        }\n      });\n    },\n    del(key: string): void {\n      memento.del(prefix + key);\n    },\n  };\n}\n","import { DebugLogger } from '@affine/debug';\nimport { Slot } from '@blocksuite/global/utils';\nimport { difference } from 'lodash-es';\n\nimport { LiveData } from '../../livedata';\nimport type { Memento } from '../../storage';\nimport { MANUALLY_STOP } from '../../utils';\nimport { BlobStorageOverCapacity } from './error';\n\nconst logger = new DebugLogger('affine:blob-engine');\n\nexport interface BlobStorage {\n  name: string;\n  readonly: boolean;\n  get: (key: string) => Promise<Blob | null>;\n  set: (key: string, value: Blob) => Promise<string>;\n  delete: (key: string) => Promise<void>;\n  list: () => Promise<string[]>;\n}\n\nexport interface BlobStatus {\n  isStorageOverCapacity: boolean;\n}\n\n/**\n * # BlobEngine\n *\n * sync blobs between storages in background.\n *\n * all operations priority use local, then use remote.\n */\nexport class BlobEngine {\n  readonly name = 'blob-engine';\n  readonly readonly = this.local.readonly;\n\n  private abort: AbortController | null = null;\n\n  readonly isStorageOverCapacity$ = new LiveData(false);\n\n  singleBlobSizeLimit: number = 100 * 1024 * 1024;\n  onAbortLargeBlob = new Slot<Blob>();\n\n  constructor(\n    private readonly local: BlobStorage,\n    private readonly remotes: BlobStorage[]\n  ) {}\n\n  start() {\n    if (this.abort || this.isStorageOverCapacity$.value) {\n      return;\n    }\n    this.abort = new AbortController();\n    const abortSignal = this.abort.signal;\n\n    const sync = () => {\n      if (abortSignal.aborted) {\n        return;\n      }\n\n      this.sync()\n        .catch(error => {\n          logger.error('sync blob error', error);\n        })\n        .finally(() => {\n          // sync every 1 minute\n          setTimeout(sync, 60000);\n        });\n    };\n\n    sync();\n  }\n\n  stop() {\n    this.abort?.abort(MANUALLY_STOP);\n    this.abort = null;\n  }\n\n  get storages() {\n    return [this.local, ...this.remotes];\n  }\n\n  async sync() {\n    if (this.local.readonly) {\n      return;\n    }\n    logger.debug('start syncing blob...');\n    for (const remote of this.remotes) {\n      let localList: string[] = [];\n      let remoteList: string[] = [];\n\n      if (!remote.readonly) {\n        try {\n          localList = await this.local.list();\n          remoteList = await remote.list();\n        } catch (err) {\n          logger.error(`error when sync`, err);\n          continue;\n        }\n\n        const needUpload = difference(localList, remoteList);\n        for (const key of needUpload) {\n          try {\n            const data = await this.local.get(key);\n            if (data) {\n              await remote.set(key, data);\n            }\n          } catch (err) {\n            logger.error(\n              `error when sync ${key} from [${this.local.name}] to [${remote.name}]`,\n              err\n            );\n          }\n        }\n      }\n\n      const needDownload = difference(remoteList, localList);\n\n      for (const key of needDownload) {\n        try {\n          const data = await remote.get(key);\n          if (data) {\n            await this.local.set(key, data);\n          }\n        } catch (err) {\n          if (err instanceof BlobStorageOverCapacity) {\n            this.isStorageOverCapacity$.value = true;\n          }\n          logger.error(\n            `error when sync ${key} from [${remote.name}] to [${this.local.name}]`,\n            err\n          );\n        }\n      }\n    }\n\n    logger.debug('finish syncing blob');\n  }\n\n  async get(key: string) {\n    logger.debug('get blob', key);\n    for (const storage of this.storages) {\n      const data = await storage.get(key);\n      if (data) {\n        return data;\n      }\n    }\n    return null;\n  }\n\n  async set(key: string, value: Blob) {\n    if (this.local.readonly) {\n      throw new Error('local peer is readonly');\n    }\n\n    if (value.size > this.singleBlobSizeLimit) {\n      this.onAbortLargeBlob.emit(value);\n      logger.error('blob over limit, abort set');\n      return key;\n    }\n\n    // await upload to the local peer\n    await this.local.set(key, value);\n\n    // uploads to other peers in the background\n    Promise.allSettled(\n      this.remotes\n        .filter(r => !r.readonly)\n        .map(peer =>\n          peer.set(key, value).catch(err => {\n            logger.error('Error when uploading to peer', err);\n          })\n        )\n    )\n      .then(result => {\n        if (result.some(({ status }) => status === 'rejected')) {\n          logger.error(\n            `blob ${key} update finish, but some peers failed to update`\n          );\n        } else {\n          logger.debug(`blob ${key} update finish`);\n        }\n      })\n      .catch(() => {\n        // Promise.allSettled never reject\n      });\n\n    return key;\n  }\n\n  async delete(_key: string) {\n    // not supported\n  }\n\n  async list() {\n    const blobList = new Set<string>();\n\n    for (const peer of this.storages) {\n      const list = await peer.list();\n      if (list) {\n        for (const blob of list) {\n          blobList.add(blob);\n        }\n      }\n    }\n\n    return Array.from(blobList);\n  }\n}\n\nexport const EmptyBlobStorage: BlobStorage = {\n  name: 'empty',\n  readonly: true,\n  async get(_key: string) {\n    return null;\n  },\n  async set(_key: string, _value: Blob) {\n    throw new Error('not supported');\n  },\n  async delete(_key: string) {\n    throw new Error('not supported');\n  },\n  async list() {\n    return [];\n  },\n};\n\nexport class MemoryBlobStorage implements BlobStorage {\n  name = 'testing';\n  readonly = false;\n\n  constructor(private readonly state: Memento) {}\n\n  get(key: string) {\n    return Promise.resolve(this.state.get<Blob>(key) ?? null);\n  }\n  set(key: string, value: Blob) {\n    this.state.set(key, value);\n\n    const list = this.state.get<Set<string>>('list') ?? new Set<string>();\n    list.add(key);\n    this.state.set('list', list);\n\n    return Promise.resolve(key);\n  }\n  delete(key: string) {\n    this.state.set(key, null);\n\n    const list = this.state.get<Set<string>>('list') ?? new Set<string>();\n    list.delete(key);\n    this.state.set('list', list);\n\n    return Promise.resolve();\n  }\n  list() {\n    const list = this.state.get<Set<string>>('list');\n    return Promise.resolve(list ? Array.from(list) : []);\n  }\n}\n","export class BlobStorageOverCapacity extends Error {\n  constructor(public originError?: any) {\n    super('Blob storage over capacity.');\n  }\n}\n","export class AsyncLock {\n  private _lock = Promise.resolve();\n\n  async acquire() {\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    let release: () => void = null!;\n    const nextLock = new Promise<void>(resolve => {\n      release = resolve;\n    });\n\n    await this._lock;\n    this._lock = nextLock;\n    return {\n      release,\n      [Symbol.dispose]: () => {\n        release();\n      },\n    };\n  }\n}\n","import { AsyncLock } from '../utils';\n\nexport interface ByteKV extends ByteKVBehavior {\n  transaction<T>(cb: (transaction: ByteKVBehavior) => Promise<T>): Promise<T>;\n}\n\nexport interface ByteKVBehavior {\n  get(key: string): Promise<Uint8Array | null> | Uint8Array | null;\n  set(key: string, value: Uint8Array): Promise<void> | void;\n  del(key: string): Promise<void> | void;\n  keys(): Promise<string[]> | string[];\n  clear(): Promise<void> | void;\n}\n\nexport class MemoryByteKV implements ByteKV {\n  readonly lock = new AsyncLock();\n\n  constructor(readonly db = new Map<string, Uint8Array>()) {}\n\n  async transaction<T>(cb: (transaction: ByteKVBehavior) => Promise<T>) {\n    using _lock = await this.lock.acquire();\n    return await cb({\n      get: async key => {\n        return this.db.get(key) ?? null;\n      },\n      set: async (key, value) => {\n        this.db.set(key, value);\n      },\n      keys: async () => {\n        return Array.from(this.db.keys());\n      },\n      del: async key => {\n        this.db.delete(key);\n      },\n      clear: async () => {\n        this.db.clear();\n      },\n    });\n  }\n  get(key: string) {\n    return this.transaction(async tx => tx.get(key));\n  }\n  set(key: string, value: Uint8Array) {\n    return this.transaction(async tx => tx.set(key, value));\n  }\n  keys() {\n    return this.transaction(async tx => tx.keys());\n  }\n  clear() {\n    return this.transaction(async tx => tx.clear());\n  }\n  del(key: string) {\n    return this.transaction(async tx => tx.del(key));\n  }\n}\n\nexport class ReadonlyByteKV extends MemoryByteKV implements ByteKV {\n  override transaction<T>(\n    cb: (transaction: ByteKVBehavior) => Promise<T>\n  ): Promise<T> {\n    return super.transaction(tx => {\n      return cb({\n        ...tx,\n        set() {\n          return Promise.resolve();\n        },\n        del() {\n          return Promise.resolve();\n        },\n        clear() {\n          return Promise.resolve();\n        },\n      });\n    });\n  }\n  override set(_key: string, _value: Uint8Array): Promise<void> {\n    return Promise.resolve();\n  }\n  override del(_key: string): Promise<void> {\n    return Promise.resolve();\n  }\n  override clear(): Promise<void> {\n    return Promise.resolve();\n  }\n}\n","export type DocEvent =\n  | {\n      type: 'ClientUpdateCommitted';\n      clientId: string;\n      docId: string;\n      update: Uint8Array;\n      seqNum: number;\n    }\n  | {\n      type: 'ServerUpdateCommitted';\n      docId: string;\n      update: Uint8Array;\n      clientId: string;\n    };\n\nexport interface DocEventBus {\n  emit(event: DocEvent): void;\n  on(cb: (event: DocEvent) => void): () => void;\n}\n\nexport class MemoryDocEventBus implements DocEventBus {\n  listeners = new Set<(event: DocEvent) => void>();\n  emit(event: DocEvent): void {\n    for (const listener of this.listeners) {\n      try {\n        listener(event);\n      } catch (e) {\n        console.error(e);\n      }\n    }\n  }\n  on(cb: (event: DocEvent) => void): () => void {\n    this.listeners.add(cb);\n    return () => {\n      this.listeners.delete(cb);\n    };\n  }\n}\n\nexport class DocEventBusInner implements DocEventBus {\n  constructor(private readonly eventBusBehavior: DocEventBus) {}\n\n  emit(event: DocEvent) {\n    this.eventBusBehavior.emit(event);\n  }\n\n  on(cb: (event: DocEvent) => void) {\n    return this.eventBusBehavior.on(cb);\n  }\n}\n","import { mergeUpdates } from 'yjs';\n\nimport type { ByteKV, Memento } from '../../storage';\nimport { MemoryMemento, ReadonlyByteKV, wrapMemento } from '../../storage';\nimport { AsyncLock, throwIfAborted } from '../../utils';\nimport type { DocEventBus } from '.';\nimport { DocEventBusInner, MemoryDocEventBus } from './event';\nimport { isEmptyUpdate } from './utils';\n\nexport interface DocStorage {\n  eventBus: DocEventBus;\n  doc: ByteKV;\n  syncMetadata: ByteKV;\n  serverClock: ByteKV;\n}\n\nconst Keys = {\n  SeqNum: (docId: string) => `${docId}:seqNum`,\n  SeqNumPushed: (docId: string) => `${docId}:seqNumPushed`,\n  ServerClockPulled: (docId: string) => `${docId}:serverClockPulled`,\n  UpdatedTime: (docId: string) => `${docId}:updateTime`,\n};\n\nconst Values = {\n  UInt64: {\n    parse: (buffer: Uint8Array) => {\n      const view = new DataView(buffer.buffer);\n      return Number(view.getBigUint64(0, false));\n    },\n    serialize: (value: number) => {\n      const buffer = new ArrayBuffer(8);\n      const view = new DataView(buffer);\n      view.setBigUint64(0, BigInt(value), false);\n      return new Uint8Array(buffer);\n    },\n  },\n};\n\nexport class DocStorageInner {\n  public readonly eventBus = new DocEventBusInner(this.behavior.eventBus);\n  constructor(public readonly behavior: DocStorage) {}\n\n  async loadServerClock(signal?: AbortSignal): Promise<Map<string, number>> {\n    throwIfAborted(signal);\n    const list = await this.behavior.serverClock.keys();\n\n    const map = new Map<string, number>();\n    for (const key of list) {\n      const docId = key;\n      const value = await this.behavior.serverClock.get(key);\n      if (value) {\n        map.set(docId, Values.UInt64.parse(value));\n      }\n    }\n\n    return map;\n  }\n\n  async saveServerClock(map: Map<string, number>, signal?: AbortSignal) {\n    throwIfAborted(signal);\n    await this.behavior.serverClock.transaction(async transaction => {\n      for (const [docId, value] of map) {\n        const key = docId;\n        const oldBuffer = await transaction.get(key);\n        const old = oldBuffer ? Values.UInt64.parse(oldBuffer) : 0;\n        if (old < value) {\n          await transaction.set(key, Values.UInt64.serialize(value));\n        }\n      }\n    });\n  }\n\n  async loadDocSeqNum(docId: string, signal?: AbortSignal) {\n    throwIfAborted(signal);\n    const bytes = await this.behavior.syncMetadata.get(Keys.SeqNum(docId));\n    if (bytes === null) {\n      return 0;\n    }\n    return Values.UInt64.parse(bytes);\n  }\n\n  async saveDocSeqNum(\n    docId: string,\n    seqNum: number | true,\n    signal?: AbortSignal\n  ) {\n    throwIfAborted(signal);\n    return await this.behavior.syncMetadata.transaction(async transaction => {\n      const key = Keys.SeqNum(docId);\n      const oldBytes = await transaction.get(key);\n      const old = oldBytes ? Values.UInt64.parse(oldBytes) : 0;\n      if (seqNum === true) {\n        await transaction.set(key, Values.UInt64.serialize(old + 1));\n        return old + 1;\n      }\n      if (old < seqNum) {\n        await transaction.set(key, Values.UInt64.serialize(seqNum));\n        return seqNum;\n      }\n      return old;\n    });\n  }\n\n  async loadDocSeqNumPushed(docId: string, signal?: AbortSignal) {\n    throwIfAborted(signal);\n    const bytes = await this.behavior.syncMetadata.get(\n      Keys.SeqNumPushed(docId)\n    );\n    if (bytes === null) {\n      return null;\n    }\n    return Values.UInt64.parse(bytes);\n  }\n\n  async saveDocPushedSeqNum(\n    docId: string,\n    seqNum: number | { add: number },\n    signal?: AbortSignal\n  ) {\n    throwIfAborted(signal);\n    await this.behavior.syncMetadata.transaction(async transaction => {\n      const key = Keys.SeqNumPushed(docId);\n      const oldBytes = await transaction.get(key);\n      const old = oldBytes ? Values.UInt64.parse(oldBytes) : null;\n      if (typeof seqNum === 'object') {\n        return transaction.set(\n          key,\n          Values.UInt64.serialize((old ?? 0) + seqNum.add)\n        );\n      }\n      if (old === null || old < seqNum) {\n        return transaction.set(key, Values.UInt64.serialize(seqNum));\n      }\n    });\n  }\n\n  async loadDocServerClockPulled(docId: string, signal?: AbortSignal) {\n    throwIfAborted(signal);\n    const bytes = await this.behavior.syncMetadata.get(\n      Keys.ServerClockPulled(docId)\n    );\n    if (bytes === null) {\n      return null;\n    }\n    return bytes ? Values.UInt64.parse(bytes) : 0;\n  }\n\n  async saveDocServerClockPulled(\n    docId: string,\n    serverClock: number,\n    signal?: AbortSignal\n  ) {\n    throwIfAborted(signal);\n    await this.behavior.syncMetadata.transaction(async transaction => {\n      const oldBytes = await transaction.get(Keys.ServerClockPulled(docId));\n      const old = oldBytes ? Values.UInt64.parse(oldBytes) : null;\n      if (old === null || old < serverClock) {\n        await transaction.set(\n          Keys.ServerClockPulled(docId),\n          Values.UInt64.serialize(serverClock)\n        );\n      }\n    });\n  }\n\n  async loadDocFromLocal(docId: string, signal?: AbortSignal) {\n    throwIfAborted(signal);\n    return await this.behavior.doc.get(docId);\n  }\n\n  /**\n   * Confirm that server updates are applied in the order they occur!!!\n   */\n  async commitDocAsServerUpdate(\n    docId: string,\n    update: Uint8Array,\n    serverClock: number,\n    signal?: AbortSignal\n  ) {\n    throwIfAborted(signal);\n    await this.behavior.doc.transaction(async tx => {\n      const data = await tx.get(docId);\n      await tx.set(\n        docId,\n        data && !isEmptyUpdate(data)\n          ? !isEmptyUpdate(update)\n            ? mergeUpdates([data, update])\n            : data\n          : update\n      );\n    });\n    await this.saveDocServerClockPulled(docId, serverClock);\n  }\n\n  async commitDocAsClientUpdate(\n    docId: string,\n    update: Uint8Array,\n    signal?: AbortSignal\n  ) {\n    throwIfAborted(signal);\n\n    await this.behavior.doc.transaction(async tx => {\n      const data = await tx.get(docId);\n      await tx.set(\n        docId,\n        data && !isEmptyUpdate(data)\n          ? !isEmptyUpdate(update)\n            ? mergeUpdates([data, update])\n            : data\n          : update\n      );\n    });\n\n    return await this.saveDocSeqNum(docId, true);\n  }\n\n  clearSyncMetadata() {\n    return this.behavior.syncMetadata.clear();\n  }\n\n  async clearServerClock() {\n    return this.behavior.serverClock.clear();\n  }\n}\n\nexport class ReadonlyStorage implements DocStorage {\n  constructor(\n    private readonly map: {\n      [key: string]: Uint8Array;\n    }\n  ) {}\n\n  eventBus = new MemoryDocEventBus();\n  doc = new ReadonlyByteKV(new Map(Object.entries(this.map)));\n  serverClock = new ReadonlyByteKV();\n  syncMetadata = new ReadonlyByteKV();\n}\n\nexport class MemoryStorage implements DocStorage {\n  constructor(private readonly memo: Memento = new MemoryMemento()) {}\n\n  eventBus = new MemoryDocEventBus();\n  lock = new AsyncLock();\n  readonly docDb = wrapMemento(this.memo, 'doc:');\n  readonly syncMetadataDb = wrapMemento(this.memo, 'syncMetadata:');\n  readonly serverClockDb = wrapMemento(this.memo, 'serverClock:');\n\n  readonly doc = {\n    transaction: async cb => {\n      using _lock = await this.lock.acquire();\n      return await cb({\n        get: async key => {\n          return this.docDb.get(key) ?? null;\n        },\n        set: async (key, value) => {\n          this.docDb.set(key, value);\n        },\n        keys: async () => {\n          return Array.from(this.docDb.keys());\n        },\n        clear: () => {\n          this.docDb.clear();\n        },\n        del: key => {\n          this.docDb.del(key);\n        },\n      });\n    },\n    get(key) {\n      return this.transaction(async tx => tx.get(key));\n    },\n    set(key, value) {\n      return this.transaction(async tx => tx.set(key, value));\n    },\n    keys() {\n      return this.transaction(async tx => tx.keys());\n    },\n    clear() {\n      return this.transaction(async tx => tx.clear());\n    },\n    del(key) {\n      return this.transaction(async tx => tx.del(key));\n    },\n  } satisfies ByteKV;\n\n  readonly syncMetadata = {\n    transaction: async cb => {\n      using _lock = await this.lock.acquire();\n      return await cb({\n        get: async key => {\n          return this.syncMetadataDb.get(key) ?? null;\n        },\n        set: async (key, value) => {\n          this.syncMetadataDb.set(key, value);\n        },\n        keys: async () => {\n          return Array.from(this.syncMetadataDb.keys());\n        },\n        clear: () => {\n          this.syncMetadataDb.clear();\n        },\n        del: key => {\n          this.syncMetadataDb.del(key);\n        },\n      });\n    },\n    get(key) {\n      return this.transaction(async tx => tx.get(key));\n    },\n    set(key, value) {\n      return this.transaction(async tx => tx.set(key, value));\n    },\n    keys() {\n      return this.transaction(async tx => tx.keys());\n    },\n    clear() {\n      return this.transaction(async tx => tx.clear());\n    },\n    del(key) {\n      return this.transaction(async tx => tx.del(key));\n    },\n  } satisfies ByteKV;\n\n  readonly serverClock = {\n    transaction: async cb => {\n      using _lock = await this.lock.acquire();\n      return await cb({\n        get: async key => {\n          return this.serverClockDb.get(key) ?? null;\n        },\n        set: async (key, value) => {\n          this.serverClockDb.set(key, value);\n        },\n        keys: async () => {\n          return Array.from(this.serverClockDb.keys());\n        },\n        clear: () => {\n          this.serverClockDb.clear();\n        },\n        del: key => {\n          this.serverClockDb.del(key);\n        },\n      });\n    },\n    get(key) {\n      return this.transaction(async tx => tx.get(key));\n    },\n    set(key, value) {\n      return this.transaction(async tx => tx.set(key, value));\n    },\n    keys() {\n      return this.transaction(async tx => tx.keys());\n    },\n    clear() {\n      return this.transaction(async tx => tx.clear());\n    },\n    del(key) {\n      return this.transaction(async tx => tx.del(key));\n    },\n  } satisfies ByteKV;\n}\n","export function isEmptyUpdate(binary: Uint8Array) {\n  return (\n    binary.byteLength === 0 ||\n    (binary.byteLength === 2 && binary[0] === 0 && binary[1] === 0)\n  );\n}\n","import { Unreachable } from '@affine/env/constant';\n\nexport interface RcRef<T> {\n  obj: T;\n  release: () => void;\n}\n\nexport class ObjectPool<Key, T> {\n  objects = new Map<Key, { obj: T; rc: number }>();\n  timeoutToGc: NodeJS.Timeout | null = null;\n\n  constructor(\n    private readonly options: {\n      onDelete?: (obj: T) => void;\n      onDangling?: (obj: T) => boolean;\n    } = {}\n  ) {}\n\n  get(key: Key): RcRef<T> | null {\n    const exist = this.objects.get(key);\n    if (exist) {\n      exist.rc++;\n      let released = false;\n      return {\n        obj: exist.obj,\n        release: () => {\n          // avoid double release\n          if (released) {\n            return;\n          }\n          released = true;\n          exist.rc--;\n          this.requestGc();\n        },\n      };\n    }\n    return null;\n  }\n\n  put(key: Key, obj: T) {\n    const ref = { obj, rc: 0 };\n    this.objects.set(key, ref);\n\n    const r = this.get(key);\n    if (!r) {\n      throw new Unreachable();\n    }\n\n    return r;\n  }\n\n  private requestGc() {\n    if (this.timeoutToGc) {\n      clearInterval(this.timeoutToGc);\n    }\n\n    // do gc every 1s\n    this.timeoutToGc = setInterval(() => {\n      this.gc();\n    }, 1000);\n  }\n\n  private gc() {\n    for (const [key, { obj, rc }] of new Map(\n      this.objects /* clone the map, because the origin will be modified during iteration */\n    )) {\n      if (\n        rc === 0 &&\n        (!this.options.onDangling || this.options.onDangling(obj))\n      ) {\n        this.options.onDelete?.(obj);\n\n        this.objects.delete(key);\n      }\n    }\n\n    for (const [_, { rc }] of this.objects) {\n      if (rc === 0) {\n        return;\n      }\n    }\n\n    // if all object has referrer, stop gc\n    if (this.timeoutToGc) {\n      clearInterval(this.timeoutToGc);\n    }\n  }\n\n  clear() {\n    for (const { obj } of this.objects.values()) {\n      this.options.onDelete?.(obj);\n    }\n\n    this.objects.clear();\n  }\n}\n","// copied from https://github.com/shuding/stable-hash\n\n// Use WeakMap to store the object-key mapping so the objects can still be\n// garbage collected. WeakMap uses a hashtable under the hood, so the lookup\n// complexity is almost O(1).\nconst table = new WeakMap<object, string>();\n\n// A counter of the key.\nlet counter = 0;\n\n// A stable hash implementation that supports:\n//  - Fast and ensures unique hash properties\n//  - Handles unserializable values\n//  - Handles object key ordering\n//  - Generates short results\n//\n// This is not a serialization function, and the result is not guaranteed to be\n// parsable.\nexport function stableHash(arg: any): string {\n  const type = typeof arg;\n  const constructor = arg && arg.constructor;\n  const isDate = constructor === Date;\n\n  if (Object(arg) === arg && !isDate && constructor !== RegExp) {\n    // Object/function, not null/date/regexp. Use WeakMap to store the id first.\n    // If it's already hashed, directly return the result.\n    let result = table.get(arg);\n    if (result) return result;\n    // Store the hash first for circular reference detection before entering the\n    // recursive `stableHash` calls.\n    // For other objects like set and map, we use this id directly as the hash.\n    result = ++counter + '~';\n    table.set(arg, result);\n    let index: any;\n\n    if (constructor === Array) {\n      // Array.\n      result = '@';\n      for (index = 0; index < arg.length; index++) {\n        result += stableHash(arg[index]) + ',';\n      }\n      table.set(arg, result);\n    } else if (constructor === Object) {\n      // Object, sort keys.\n      result = '#';\n      const keys = Object.keys(arg).sort();\n      while ((index = keys.pop() as string) !== undefined) {\n        if (arg[index] !== undefined) {\n          result += index + ':' + stableHash(arg[index]) + ',';\n        }\n      }\n      table.set(arg, result);\n    }\n    return result;\n  }\n  if (isDate) return arg.toJSON();\n  if (type === 'symbol') return arg.toString();\n  return type === 'string' ? JSON.stringify(arg) : '' + arg;\n}\n","// because AbortSignal.throwIfAborted is not available in abortcontroller-polyfill\nexport function throwIfAborted(abort?: AbortSignal) {\n  if (abort?.aborted) {\n    throw new Error(abort.reason);\n  }\n  return true;\n}\n\nexport const MANUALLY_STOP = 'manually-stop';\n","import { useI18n } from '@affine/i18n';\nimport { useMemo } from 'react';\n\nexport const useNavConfig = () => {\n  const t = useI18n();\n  return useMemo(\n    () => [\n      {\n        title: t['com.affine.other-page.nav.official-website'](),\n        path: 'https://affine.pro',\n      },\n      {\n        title: t['com.affine.other-page.nav.affine-community'](),\n        path: 'https://community.affine.pro/home',\n      },\n      {\n        title: t['com.affine.other-page.nav.blog'](),\n        path: 'https://affine.pro/blog',\n      },\n      {\n        title: t['com.affine.other-page.nav.contact-us'](),\n        path: 'https://affine.pro/about-us',\n      },\n    ],\n    [t]\n  );\n};\n","import * as styles from './index.css';\nimport { useNavConfig } from './use-nav-config';\n\nexport const DesktopNavbar = () => {\n  const config = useNavConfig();\n\n  return (\n    <div className={styles.topNavLinks}>\n      {config.map(item => {\n        return (\n          <a\n            key={item.title}\n            href={item.path}\n            target=\"_blank\"\n            rel=\"noreferrer\"\n            className={styles.topNavLink}\n          >\n            {item.title}\n          </a>\n        );\n      })}\n    </div>\n  );\n};\n","import \"../component/src/components/affine-other-page-layout/index.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/components/affine-other-page-layout/index.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACs1UTW/bMAy951cQBQYkBwV2mnadetk/GWiLTtTKkiAxibsh/32QnMwfbTZsp53iUI/ie48U19/KetO9bGIBPxYAe9K7PUsoi+LT8wLgpBXvh79KR2/wTUJjqEuB9CuUDlSzdlZC7cyhtfnEWRZRfycJRwxLIbBptCWR4xVGWiWUd1H3mYEMsj5SilZYv+6CO1g1Sx4OhA+6xfAmamdcWD0vzov1VUqZpeQDCdruKWieADYZwM5LKFI9Qw1fPkOvv/hQ7cC20R2pFEKjd1ZopjZKqMkyhRR+OUTWTWJnmSxLiB5rEhXxiSj741EpbXcSykffQbkpfDfheJ85vqPQGyx26CVsZynbse6Jb0wdv3PsDz2K7YA5XcbiocjG5OsU1S5gb4d1liaitknT04zfQ+Y3KrrJCpKvOhkn6EiWowQ8sJtmrr1Bbf9O3yj/KWcOw3w8PU+H/bif0C/+dQoBKhcUBRFQ6UO83pRjg02V60Tco3Kna2zE9cv/08Vy4zvoJxOgxU7M1sGN1/uBAxzQXrGDfVCs7yMQxpkDEhumcPHh8oDu7qYVsYrOHPhSkdm181dbGVe/jpZYjaZeJuogYFv4bjWegWL90Mu83XWD9asoi9WMq3W8lAYjC9cIfvO0ysRbDDttxYjaefG1JaURYh2ILKBVsJy4mt5Dnz1bVfN1ce3JeQy9v0B/GXDt5wT1+TbqY4La/pbg4637bjXrvDj/BBe34L51BgAA\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var affineLogo = '_1c2xj2s1';\nexport var hideInSmallScreen = '_1c2xj2s7';\nexport var hideInWideScreen = '_1c2xj2s6';\nexport var iconButton = '_1c2xj2s5';\nexport var menu = '_1c2xj2s8';\nexport var menuItem = '_1c2xj2s9';\nexport var root = '_1c2xj2s0';\nexport var topNav = '_1c2xj2s2';\nexport var topNavLink = '_1c2xj2s4';\nexport var topNavLinks = '_1c2xj2s3';","import { IconButton } from '@affine/component/ui/button';\nimport { Menu, MenuItem } from '@affine/component/ui/menu';\nimport { CloseIcon, PropertyIcon } from '@blocksuite/icons/rc';\nimport { useState } from 'react';\n\nimport * as styles from './index.css';\nimport { useNavConfig } from './use-nav-config';\n\nexport const MobileNavbar = () => {\n  const [openMenu, setOpenMenu] = useState(false);\n  const navConfig = useNavConfig();\n\n  const menuItems = (\n    <>\n      {navConfig.map(item => {\n        return (\n          <MenuItem\n            key={item.title}\n            onClick={() => {\n              open(item.path, '_blank');\n            }}\n            className={styles.menuItem}\n          >\n            {item.title}\n          </MenuItem>\n        );\n      })}\n    </>\n  );\n\n  return (\n    <div className={styles.hideInWideScreen}>\n      <Menu\n        items={menuItems}\n        contentOptions={{\n          className: styles.menu,\n          sideOffset: 20,\n        }}\n        rootOptions={{\n          open: openMenu,\n          onOpenChange: setOpenMenu,\n        }}\n      >\n        <IconButton variant=\"plain\" size=\"24\" className={styles.iconButton}>\n          {openMenu ? <CloseIcon /> : <PropertyIcon />}\n        </IconButton>\n      </Menu>\n    </div>\n  );\n};\n","import { Button } from '@affine/component/ui/button';\nimport { useI18n } from '@affine/i18n';\nimport { Logo1Icon } from '@blocksuite/icons/rc';\nimport { useCallback } from 'react';\n\nimport { DesktopNavbar } from './desktop-navbar';\nimport * as styles from './index.css';\nimport { MobileNavbar } from './mobile-navbar';\n\nexport const AffineOtherPageLayout = ({\n  children,\n}: {\n  children: React.ReactNode;\n}) => {\n  const t = useI18n();\n\n  const openDownloadLink = useCallback(() => {\n    open(runtimeConfig.downloadUrl, '_blank');\n  }, []);\n\n  return (\n    <div className={styles.root}>\n      {environment.isDesktop ? null : (\n        <div className={styles.topNav}>\n          <a href=\"/\" rel=\"noreferrer\" className={styles.affineLogo}>\n            <Logo1Icon width={24} height={24} />\n          </a>\n\n          <DesktopNavbar />\n          <Button\n            onClick={openDownloadLink}\n            className={styles.hideInSmallScreen}\n          >\n            {t['com.affine.auth.open.affine.download-app']()}\n          </Button>\n          <MobileNavbar />\n        </div>\n      )}\n\n      {children}\n    </div>\n  );\n};\n","import \"../component/src/components/auth-components/share.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/components/auth-components/share.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACq1XXW+jOhB9z6+w9mql9sEISNJ2Xelq/8nVgIfEjbGRbZJ0V/3vK4xJgEJCV/cpwczY55z5Mj8P+F4YKNGS/5Ln8+HtZNbk94qQ+Lv/IcQZULbQpmTEaAcOH2KOu8fXFSEfK0K2NwyTl4FpEt+wXT/1bD9WUYcmJpHUO+39Cq0cteIXMnIE80ApFIVQSP36nq69t384odjtHSNPcdys5VpqM3LKJOQH71GC2QlFTXCpzs3iEY0TOUgKUuwUI6XgXOLrENq/pGKFMNZRXVD3XuESmNtZmAFIpp3TJSObFolsfPfBMn1pF7mwlYR3RgqJfsHDpMJhaRnJUTk0E2AlfA3rZhbrBKreaYnfvALOhdpdCK3jFnylrXBCK0YMSnDiONQ1iU7C7XXt6F4oN7lTGn86UEKG0htftMmkzg9z8Xd4dtRirhUH8069yeN8FG4KZcuFOqUj2On9IIS9r5pBZrWsHTar41TBwjGy5NwIjdHGnz4ljn970WTgeAKjhNrNuob3U84b73QS3O0ZSbYt5g5j9zyVHA1Rw9FQA1zUljVdp1nVRzSF1CdG9oJzVN4S8sPO6FpxOln27UZT6BiDwmEninKoHCPfvr32MKcjzOkYcz84vWiE3uL/O12Ff130esXPCNROT/P4pyiK5s0vKhTHMyPpnDJDVhkW2uANWmk8pNU935NS1ngjN1v6IVId1fB4oZB4RbppQLURXoTGN/j45qZECe0J1ymVRFtLhCqEEg59vsOw5W3vF1cGtqUwKJf54RJ6gw/hetyDtgRmq0IKdZhKuqfJ9rZZ1iifh+2uGwVvtXWiaFpaCLatIEeaoTthWyP3hsXLwsawrHX5ThvGaHfYSPEk2n65ji4p1Wo1rJ8emR+eTHfSOp0ZoJ9Uu0KdlOtOMvwgkUGLvnQ4XifZ1IxYIuLwkjKetzDgmMTxcd9vW3F8PP1PpJeU0wBYdDJQVaGtfvnaAiQK2Lx/CWcaSD3HY8mBRE44ueBi482WXsM+XW6ARLbOrkfdt/96X8juBfT7ZDybX8qFwbwto1zLulR/E+kelrw/ttddpv8skQsgNjeIioDi5KEXnSRON9X50XuOsvQWyksr9Byr82UUTRDwu1gHxnUfGHNZd+vEgR8P5hddlVbYfZLcJrxtkI745mG7UdQ+Vh9/AFk1Cll3DQAA\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var authCodeContainer = '_17xkjwr6';\nexport var authCodeErrorMessage = '_17xkjwr8';\nexport var authCodeWrapper = '_17xkjwr7';\nexport var authContent = '_17xkjwr5';\nexport var authInputWrapper = '_17xkjwr1';\nexport var authPageContainer = '_17xkjwra';\nexport var formHint = '_17xkjwr2';\nexport var hideInSmallScreen = '_17xkjwrd';\nexport var input = '_17xkjwrc';\nexport var loading = '_17xkjwr4';\nexport var modalHeaderWrapper = '_17xkjwr0';\nexport var resendButtonWrapper = '_17xkjwr9';\nexport var signInPageContainer = '_17xkjwrb';","import clsx from 'clsx';\nimport type { FC, HTMLAttributes, PropsWithChildren } from 'react';\n\nimport { authContent } from './share.css';\n\nexport const AuthContent: FC<\n  PropsWithChildren & HTMLAttributes<HTMLDivElement>\n> = ({ children, className, ...otherProps }) => {\n  return (\n    <div className={clsx(authContent, className)} {...otherProps}>\n      {children}\n    </div>\n  );\n};\n","import clsx from 'clsx';\n\nimport type { InputProps } from '../../ui/input';\nimport { Input } from '../../ui/input';\nimport * as styles from './share.css';\nexport type AuthInputProps = InputProps & {\n  label?: string;\n  error?: boolean;\n  errorHint?: string;\n  withoutHint?: boolean;\n  onEnter?: () => void;\n};\nexport const AuthInput = ({\n  label,\n  error,\n  errorHint,\n  withoutHint = false,\n  onEnter,\n  className,\n  ...inputProps\n}: AuthInputProps) => {\n  return (\n    <div\n      className={clsx(styles.authInputWrapper, {\n        'without-hint': withoutHint,\n      })}\n    >\n      {label ? <label>{label}</label> : null}\n      <Input\n        className={clsx(className)}\n        size=\"extraLarge\"\n        status={error ? 'error' : 'default'}\n        onKeyDown={e => {\n          if (e.key === 'Enter') {\n            onEnter?.();\n          }\n        }}\n        {...inputProps}\n      />\n      {error && errorHint && !withoutHint ? (\n        <div\n          className={clsx(styles.formHint, {\n            error: error,\n          })}\n        >\n          {errorHint}\n        </div>\n      ) : null}\n    </div>\n  );\n};\n","import type { FC, PropsWithChildren, ReactNode } from 'react';\n\nimport { Empty } from '../../ui/empty';\nimport { AffineOtherPageLayout } from '../affine-other-page-layout';\nimport { authPageContainer, hideInSmallScreen } from './share.css';\n\nexport const AuthPageContainer: FC<\n  PropsWithChildren<{ title?: ReactNode; subtitle?: ReactNode }>\n> = ({ children, title, subtitle }) => {\n  return (\n    <AffineOtherPageLayout>\n      <div className={authPageContainer}>\n        <div className=\"wrapper\">\n          <div className=\"content\">\n            <p className=\"title\">{title}</p>\n            <p className=\"subtitle\">{subtitle}</p>\n            {children}\n          </div>\n          <div className={hideInSmallScreen}>\n            <Empty />\n          </div>\n        </div>\n      </div>\n    </AffineOtherPageLayout>\n  );\n};\n","import { useI18n } from '@affine/i18n';\nimport { ArrowLeftSmallIcon } from '@blocksuite/icons/rc';\nimport { cssVar } from '@toeverything/theme';\nimport type { FC } from 'react';\n\nimport type { ButtonProps } from '../../ui/button';\nimport { Button } from '../../ui/button';\n\nexport const BackButton: FC<ButtonProps> = props => {\n  const t = useI18n();\n  return (\n    <Button\n      variant=\"plain\"\n      style={{\n        marginTop: 12,\n        marginLeft: -5,\n        paddingLeft: 0,\n        paddingRight: 5,\n        color: cssVar('textSecondaryColor'),\n      }}\n      prefix={<ArrowLeftSmallIcon />}\n      {...props}\n    >\n      {t['com.affine.backButton']()}\n    </Button>\n  );\n};\n","import { useI18n } from '@affine/i18n';\nimport { useCallback, useState } from 'react';\n\nimport { Button } from '../../ui/button';\nimport { AuthInput } from './auth-input';\nimport { AuthPageContainer } from './auth-page-container';\nimport * as styles from './share.css';\nimport { emailRegex } from './utils';\n\nexport const ChangeEmailPage = ({\n  onChangeEmail: propsOnChangeEmail,\n}: {\n  onChangeEmail: (email: string) => Promise<boolean>;\n  onOpenAffine: () => void;\n}) => {\n  const t = useI18n();\n  const [hasSetUp, setHasSetUp] = useState(false);\n  const [email, setEmail] = useState('');\n  const [isValidEmail, setIsValidEmail] = useState(true);\n  const [loading, setLoading] = useState(false);\n  const onContinue = useCallback(\n    () =>\n      void (async () => {\n        if (!emailRegex.test(email)) {\n          setIsValidEmail(false);\n          return;\n        }\n        setIsValidEmail(true);\n        setLoading(true);\n\n        const setup = await propsOnChangeEmail(email);\n\n        setLoading(false);\n        setHasSetUp(setup);\n      })(),\n    [email, propsOnChangeEmail]\n  );\n  const onEmailChange = useCallback((value: string) => {\n    setEmail(value);\n  }, []);\n  return (\n    <AuthPageContainer\n      title={t['com.affine.auth.change.email.page.title']()}\n      subtitle={t['com.affine.auth.change.email.page.subtitle']()}\n    >\n      <>\n        <AuthInput\n          className={styles.input}\n          label={t['com.affine.settings.email']()}\n          placeholder={t['com.affine.auth.sign.email.placeholder']()}\n          value={email}\n          onChange={onEmailChange}\n          error={!isValidEmail}\n          errorHint={\n            isValidEmail ? '' : t['com.affine.auth.sign.email.error']()\n          }\n          onEnter={onContinue}\n          disabled={hasSetUp}\n        />\n        <Button\n          variant=\"primary\"\n          size=\"large\"\n          onClick={onContinue}\n          loading={loading}\n          disabled={hasSetUp}\n        >\n          {t['com.affine.auth.set.email.save']()}\n        </Button>\n      </>\n    </AuthPageContainer>\n  );\n};\n","export const ErrorIcon = () => {\n  return (\n    <svg\n      width=\"16\"\n      height=\"16\"\n      viewBox=\"0 0 16 16\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <g id=\"InformationFill_Duotone\">\n        <g id=\"Icon (Stroke)\">\n          <path\n            fillRule=\"evenodd\"\n            clipRule=\"evenodd\"\n            d=\"M1.33398 8.00065C1.33398 4.31875 4.31875 1.33398 8.00065 1.33398C11.6826 1.33398 14.6673 4.31875 14.6673 8.00065C14.6673 11.6826 11.6826 14.6673 8.00065 14.6673C4.31875 14.6673 1.33398 11.6826 1.33398 8.00065ZM7.33398 5.33398C7.33398 4.96579 7.63246 4.66732 8.00065 4.66732H8.00732C8.37551 4.66732 8.67398 4.96579 8.67398 5.33398C8.67398 5.70217 8.37551 6.00065 8.00732 6.00065H8.00065C7.63246 6.00065 7.33398 5.70217 7.33398 5.33398ZM8.00065 6.66732C8.36884 6.66732 8.66732 6.96579 8.66732 7.33398V10.6673C8.66732 11.0355 8.36884 11.334 8.00065 11.334C7.63246 11.334 7.33398 11.0355 7.33398 10.6673V7.33398C7.33398 6.96579 7.63246 6.66732 8.00065 6.66732Z\"\n            fill=\"#EB4335\"\n          />\n          <path\n            d=\"M8.66732 7.33398C8.66732 6.96579 8.36884 6.66732 8.00065 6.66732C7.63246 6.66732 7.33398 6.96579 7.33398 7.33398V10.6673C7.33398 11.0355 7.63246 11.334 8.00065 11.334C8.36884 11.334 8.66732 11.0355 8.66732 10.6673V7.33398Z\"\n            fill=\"white\"\n          />\n          <path\n            d=\"M8.00065 4.66732C7.63246 4.66732 7.33398 4.96579 7.33398 5.33398C7.33398 5.70217 7.63246 6.00065 8.00065 6.00065H8.00732C8.37551 6.00065 8.67398 5.70217 8.67398 5.33398C8.67398 4.96579 8.37551 4.66732 8.00732 4.66732H8.00065Z\"\n            fill=\"white\"\n          />\n        </g>\n      </g>\n    </svg>\n  );\n};\n","import \"../component/src/components/auth-components/password-input/style.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/components/auth-components/password-input/style.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xZG1lc25xMCB7CiAgbWFyZ2luLWxlZnQ6IDhweDsKICBtYXJnaW4tcmlnaHQ6IDEwcHg7Cn0KLl8xZG1lc25xMSB7CiAgcGFkZGluZzogMnB4IDE1cHg7CiAgaGVpZ2h0OiAyMHB4OwogIGxpbmUtaGVpZ2h0OiAyMHB4OwogIGJvcmRlci1yYWRpdXM6IDEwcHg7CiAgZm9udC1zaXplOiB2YXIoLS1hZmZpbmUtZm9udC14cyk7Cn0KLl8xZG1lc25xMS53ZWFrIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1hZmZpbmUtdGFnLXJlZCk7CiAgY29sb3I6IHZhcigtLWFmZmluZS1lcnJvci1jb2xvcik7Cn0KLl8xZG1lc25xMS5tZWRpdW0gewogIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWFmZmluZS10YWctb3JhbmdlKTsKICBjb2xvcjogdmFyKC0tYWZmaW5lLXdhcm5pbmctY29sb3IpOwp9Ci5fMWRtZXNucTEuc3Ryb25nIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1hZmZpbmUtdGFnLWdyZWVuKTsKICBjb2xvcjogdmFyKC0tYWZmaW5lLXN1Y2Nlc3MtY29sb3IpOwp9Ci5fMWRtZXNucTEubWluaW11bSwgLl8xZG1lc25xMS5tYXhpbXVtIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1hZmZpbmUtdGFnLXJlZCk7CiAgY29sb3I6IHZhcigtLWFmZmluZS1lcnJvci1jb2xvcik7Cn0=\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var statusWrapper = '_1dmesnq0';\nexport var tag = '_1dmesnq1';","export const SuccessIcon = () => {\n  return (\n    <svg\n      width=\"16\"\n      height=\"16\"\n      viewBox=\"0 0 16 16\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <g id=\"SingleSelect\">\n        <path\n          id=\"Ellipse 2102 (Stroke)\"\n          fillRule=\"evenodd\"\n          clipRule=\"evenodd\"\n          d=\"M1.5 8C1.5 4.41015 4.41015 1.5 8 1.5C11.5899 1.5 14.5 4.41015 14.5 8C14.5 11.5899 11.5899 14.5 8 14.5C4.41015 14.5 1.5 11.5899 1.5 8Z\"\n          fill=\"#10CB86\"\n        />\n        <path\n          id=\"Icon (Stroke)\"\n          fillRule=\"evenodd\"\n          clipRule=\"evenodd\"\n          d=\"M11.0052 5.63143C11.2087 5.81802 11.2225 6.13431 11.0359 6.33787L7.36923 10.3379C7.27708 10.4384 7.14786 10.4969 7.01151 10.4999C6.87517 10.5028 6.74353 10.45 6.6471 10.3536L4.98043 8.68689C4.78517 8.49163 4.78517 8.17505 4.98043 7.97978C5.17569 7.78452 5.49228 7.78452 5.68754 7.97978L6.98495 9.27719L10.2987 5.66214C10.4853 5.45858 10.8016 5.44483 11.0052 5.63143Z\"\n          fill=\"white\"\n        />\n      </g>\n    </svg>\n  );\n};\n","import clsx from 'clsx';\nimport type { FC } from 'react';\nimport { useMemo } from 'react';\n\nimport type { Status } from './index';\nimport { tag } from './style.css';\n\ntype TagProps = {\n  status: Status;\n  minimum: string;\n  maximum: string;\n};\n\nexport const Tag: FC<TagProps> = ({ status, minimum, maximum }) => {\n  const textMap = useMemo<{ [K in Status]: string }>(() => {\n    return {\n      weak: 'Weak',\n      medium: 'Medium',\n      strong: 'Strong',\n      minimum,\n      maximum,\n    };\n  }, [minimum, maximum]);\n\n  return (\n    <div\n      className={clsx(tag, {\n        weak: status === 'weak',\n        medium: status === 'medium',\n        strong: status === 'strong',\n        minimum: status === 'minimum',\n        maximum: status === 'maximum',\n      })}\n    >\n      {textMap[status]}\n    </div>\n  );\n};\n","import { type PasswordLimitsFragment } from '@affine/graphql';\nimport { useI18n } from '@affine/i18n';\nimport { type Options, passwordStrength } from 'check-password-strength';\nimport { type FC, useEffect, useMemo } from 'react';\nimport { useCallback, useState } from 'react';\nimport { z, type ZodCustomIssue, ZodIssueCode } from 'zod';\n\nimport type { InputProps } from '../../../ui/input';\nimport { Input } from '../../../ui/input';\nimport * as styles from '../share.css';\nimport { ErrorIcon } from './error';\nimport { statusWrapper } from './style.css';\nimport { SuccessIcon } from './success';\nimport { Tag } from './tag';\n\nexport type Status = 'weak' | 'medium' | 'strong' | 'minimum' | 'maximum';\n\nconst PASSWORD_STRENGTH_OPTIONS: Options<string> = [\n  {\n    id: 0,\n    value: 'weak',\n    minDiversity: 0,\n    minLength: 0,\n  },\n  {\n    id: 1,\n    value: 'medium',\n    minDiversity: 4,\n    minLength: 8,\n  },\n  {\n    id: 2,\n    value: 'strong',\n    minDiversity: 4,\n    minLength: 10,\n  },\n];\n\nexport const PasswordInput: FC<\n  InputProps & {\n    passwordLimits: PasswordLimitsFragment;\n    onPass: (password: string) => void;\n    onPrevent: () => void;\n  }\n> = ({ passwordLimits, onPass, onPrevent, ...inputProps }) => {\n  const t = useI18n();\n\n  const [status, setStatus] = useState<Status | null>(null);\n  const [confirmStatus, setConfirmStatus] = useState<\n    'success' | 'error' | null\n  >(null);\n  const [canSubmit, setCanSubmit] = useState(false);\n\n  const [password, setPassWord] = useState('');\n  const [confirmPassword, setConfirmPassword] = useState('');\n  const validationSchema = useMemo(() => {\n    const { minLength, maxLength } = passwordLimits;\n    return z.string().superRefine((val, ctx) => {\n      if (val.length < minLength) {\n        ctx.addIssue({\n          code: ZodIssueCode.custom,\n          params: {\n            status: 'minimum',\n          },\n        });\n      } else if (val.length > maxLength) {\n        ctx.addIssue({\n          code: ZodIssueCode.custom,\n          params: {\n            status: 'maximum',\n          },\n        });\n      }\n      // https://github.com/deanilvincent/check-password-strength?tab=readme-ov-file#default-options\n      const { value: status } = passwordStrength(\n        val,\n        PASSWORD_STRENGTH_OPTIONS\n      );\n\n      ctx.addIssue({\n        code: ZodIssueCode.custom,\n        message: 'password strength',\n        path: ['strength'],\n        params: {\n          status,\n        },\n      });\n    });\n  }, [passwordLimits]);\n\n  const validatePasswords = useCallback(\n    (password: string, confirmPassword: string) => {\n      const result = validationSchema.safeParse(password);\n      let canSubmit = false;\n      if (!result.success) {\n        const issues = result.error.issues as ZodCustomIssue[];\n        const firstIssue = issues[0];\n        setStatus(firstIssue.params?.status || null);\n        // ignore strength error\n        if (firstIssue.path.includes('strength')) {\n          canSubmit = true;\n        }\n      }\n      if (confirmPassword) {\n        const isEqual = password === confirmPassword;\n        if (isEqual) {\n          setConfirmStatus('success');\n        } else {\n          setConfirmStatus('error');\n        }\n        canSubmit &&= isEqual;\n      } else {\n        canSubmit &&= false;\n        setConfirmStatus(null);\n      }\n      setCanSubmit(canSubmit);\n    },\n    [validationSchema]\n  );\n\n  const onPasswordChange = useCallback(\n    (value: string) => {\n      const password = value.trim();\n      setPassWord(password);\n      validatePasswords(password, confirmPassword);\n    },\n    [validatePasswords, confirmPassword]\n  );\n\n  const onConfirmPasswordChange = useCallback(\n    (value: string) => {\n      const confirmPassword = value.trim();\n      setConfirmPassword(confirmPassword);\n      validatePasswords(password, confirmPassword);\n    },\n    [validatePasswords, password]\n  );\n\n  useEffect(() => {\n    if (canSubmit) {\n      onPass(password);\n    } else {\n      onPrevent();\n    }\n  }, [canSubmit, password, onPass, onPrevent]);\n\n  return (\n    <>\n      <Input\n        name=\"password\"\n        className={styles.input}\n        type=\"password\"\n        size=\"extraLarge\"\n        style={{ marginBottom: 20 }}\n        placeholder={t['com.affine.auth.set.password.placeholder']({\n          min: String(passwordLimits.minLength),\n        })}\n        onChange={onPasswordChange}\n        endFix={\n          <div className={statusWrapper}>\n            {status ? (\n              <Tag\n                status={status}\n                minimum={t['com.affine.auth.set.password.message.minlength']({\n                  min: String(passwordLimits.minLength),\n                })}\n                maximum={t['com.affine.auth.set.password.message.maxlength']({\n                  max: String(passwordLimits.maxLength),\n                })}\n              />\n            ) : null}\n          </div>\n        }\n        {...inputProps}\n      />\n      <Input\n        name=\"confirmPassword\"\n        className={styles.input}\n        type=\"password\"\n        size=\"extraLarge\"\n        placeholder={t['com.affine.auth.set.password.placeholder.confirm']()}\n        onChange={onConfirmPasswordChange}\n        endFix={\n          <div className={statusWrapper}>\n            {confirmStatus ? (\n              confirmStatus === 'success' ? (\n                <SuccessIcon />\n              ) : (\n                <ErrorIcon />\n              )\n            ) : null}\n          </div>\n        }\n        {...inputProps}\n      />\n    </>\n  );\n};\n","import type { PasswordLimitsFragment } from '@affine/graphql';\nimport { useI18n } from '@affine/i18n';\nimport type { FC } from 'react';\nimport { useCallback, useRef, useState } from 'react';\n\nimport { Button } from '../../ui/button';\nimport { Wrapper } from '../../ui/layout';\nimport { PasswordInput } from './password-input';\n\nexport const SetPassword: FC<{\n  passwordLimits: PasswordLimitsFragment;\n  showLater?: boolean;\n  onLater?: () => void;\n  onSetPassword: (password: string) => void;\n}> = ({ passwordLimits, onLater, onSetPassword, showLater = false }) => {\n  const t = useI18n();\n\n  const [passwordPass, setPasswordPass] = useState(false);\n  const passwordRef = useRef('');\n\n  return (\n    <>\n      <Wrapper marginTop={30} marginBottom={42}>\n        <PasswordInput\n          passwordLimits={passwordLimits}\n          onPass={useCallback(password => {\n            setPasswordPass(true);\n            passwordRef.current = password;\n          }, [])}\n          onPrevent={useCallback(() => {\n            setPasswordPass(false);\n          }, [])}\n        />\n      </Wrapper>\n      <Button\n        variant=\"primary\"\n        size=\"large\"\n        disabled={!passwordPass}\n        style={{ marginRight: 20 }}\n        onClick={useCallback(() => {\n          onSetPassword(passwordRef.current);\n        }, [onSetPassword])}\n      >\n        {t['com.affine.auth.set.password.save']()}\n      </Button>\n      {showLater ? (\n        <Button variant=\"plain\" size=\"large\" onClick={onLater}>\n          {t['com.affine.auth.later']()}\n        </Button>\n      ) : null}\n    </>\n  );\n};\n","import type { PasswordLimitsFragment } from '@affine/graphql';\nimport { useI18n } from '@affine/i18n';\nimport type { FC } from 'react';\nimport { useCallback, useState } from 'react';\n\nimport { Button } from '../../ui/button';\nimport { notify } from '../../ui/notification';\nimport { AuthPageContainer } from './auth-page-container';\nimport { SetPassword } from './set-password';\n\nexport const ChangePasswordPage: FC<{\n  passwordLimits: PasswordLimitsFragment;\n  onSetPassword: (password: string) => Promise<void>;\n  onOpenAffine: () => void;\n}> = ({ passwordLimits, onSetPassword: propsOnSetPassword, onOpenAffine }) => {\n  const t = useI18n();\n  const [hasSetUp, setHasSetUp] = useState(false);\n\n  const onSetPassword = useCallback(\n    (passWord: string) => {\n      propsOnSetPassword(passWord)\n        .then(() => setHasSetUp(true))\n        .catch(e =>\n          notify.error({\n            title: t['com.affine.auth.password.set-failed'](),\n            message: String(e),\n          })\n        );\n    },\n    [propsOnSetPassword, t]\n  );\n\n  return (\n    <AuthPageContainer\n      title={\n        hasSetUp\n          ? t['com.affine.auth.reset.password.page.success']()\n          : t['com.affine.auth.reset.password.page.title']()\n      }\n      subtitle={\n        hasSetUp\n          ? t['com.affine.auth.sent.reset.password.success.message']()\n          : t['com.affine.auth.page.sent.email.subtitle']({\n              min: String(passwordLimits.minLength),\n              max: String(passwordLimits.maxLength),\n            })\n      }\n    >\n      {hasSetUp ? (\n        <Button variant=\"primary\" size=\"large\" onClick={onOpenAffine}>\n          {t['com.affine.auth.open.affine']()}\n        </Button>\n      ) : (\n        <SetPassword\n          passwordLimits={passwordLimits}\n          onSetPassword={onSetPassword}\n        />\n      )}\n    </AuthPageContainer>\n  );\n};\n","import { useI18n } from '@affine/i18n';\nimport type { FC } from 'react';\n\nimport { Button } from '../../ui/button';\nimport { AuthPageContainer } from './auth-page-container';\n\nexport const ConfirmChangeEmail: FC<{\n  onOpenAffine: () => void;\n}> = ({ onOpenAffine }) => {\n  const t = useI18n();\n\n  return (\n    <AuthPageContainer\n      title={t['com.affine.auth.change.email.page.success.title']()}\n      subtitle={t['com.affine.auth.change.email.page.success.subtitle']()}\n    >\n      <Button variant=\"primary\" size=\"large\" onClick={onOpenAffine}>\n        {t['com.affine.auth.open.affine']()}\n      </Button>\n    </AuthPageContainer>\n  );\n};\n","import type { HTMLAttributes } from 'react';\nimport { forwardRef } from 'react';\n\nconst formatTime = (time: number): string => {\n  const minutes = Math.floor(time / 60);\n  const seconds = time % 60;\n\n  const formattedMinutes = minutes.toString().padStart(2, '0');\n  const formattedSeconds = seconds.toString().padStart(2, '0');\n\n  return `${formattedMinutes}:${formattedSeconds}`;\n};\n\nexport const CountDownRender = forwardRef<\n  HTMLDivElement,\n  { timeLeft: number } & HTMLAttributes<HTMLDivElement>\n>(({ timeLeft, ...props }, ref) => {\n  return (\n    <div {...props} ref={ref}>\n      {formatTime(timeLeft)}\n    </div>\n  );\n});\n\nCountDownRender.displayName = 'CountDownRender';\n","import type { FC, PropsWithChildren } from 'react';\n\nimport { Modal } from '../../ui/modal';\n\nexport type AuthModalProps = {\n  open: boolean;\n  setOpen: (value: boolean) => void;\n};\n\nexport const AuthModal: FC<PropsWithChildren<AuthModalProps>> = ({\n  children,\n  open,\n  setOpen,\n}) => {\n  return (\n    <Modal\n      open={open}\n      onOpenChange={setOpen}\n      width={400}\n      minHeight={500}\n      contentOptions={{\n        ['data-testid' as string]: 'auth-modal',\n        style: { padding: '44px 40px 0' },\n      }}\n    >\n      {children}\n    </Modal>\n  );\n};\n","import { Logo1Icon } from '@blocksuite/icons/rc';\nimport type { FC } from 'react';\n\nimport { modalHeaderWrapper } from './share.css';\nexport const ModalHeader: FC<{\n  title: string;\n  subTitle: string;\n}> = ({ title, subTitle }) => {\n  return (\n    <div className={modalHeaderWrapper}>\n      <p>\n        <Logo1Icon className=\"logo\" />\n        {title}\n      </p>\n      <p>{subTitle}</p>\n    </div>\n  );\n};\n","import \"../component/src/components/auth-components/onboarding-page.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/components/auth-components/onboarding-page.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACq1W247aMBB95yuslSotD145XLI0q0p97TdUVeXEk8SLY0e2IdBq/72yc8EJsCxtXwCNx+eMz9x4+hntix1Z5QT9niGU0mxbaLWTDGdKKJ2gPdWPGNM85xJwcFxrXlF9bN3mLzOESuBFaRMUEbIvnYFxUwt6TFAu4OAM7hszriGzXMkEZUrsKulO1B50LlSToJIzBvJl9jZ7GkL7zqilmBtc0UwZDAIyq5X88mD1Dh5++MgrqgsuE7SpPVWqNAONNWV8ZwZrH2JGRfbo40QYRXF9mI8II49YU8a4LLBVdYIWqxahN+oWaDArw9s3Gcuz7dHZ/D1ypxBU8EJibqEyrTsGydwBbiDdcotpXWMNhb/GNC3GgQ9KNVwy1VzRavQycuFZ3lbQOvHijCgWIUKCFuS6AKmyVlUd2t9XVkC+9OR3yPm6M5bnDktakC7zIC3oM6VP5uFlG1If0IK4zygmExVWXc0dcMOZLRMUk6nL+p9jNTXNAKdgGwA5ZGQZt4pXXOK+nlfrKXvs2XMlLc5pxcUxQd/6J3qr4b9gkgNvL3E0PznZo4AESaUrKgZr07HGxGdWuLt9JMtpvTzfK8N5BxhLtZ1UZIdQaDczohHj5mOMWjUfoes7vD0qNZdbX9EB4WdPeKWeArFbqNFFsy/85YstoWnfLPNLEfQzr2/azQSdnkrgWrJTamB+ltc1Gb8v9UBdoa8X01LLTjyTyvgIdwDEAh0NiHycj8AR2hk0jByaGiV2FkazVioJ7WTiLhcY9iCt6e0BWh7sj/FcD5yKe8s4KJ4AprydE8utuJCU5wvNtprC89vwJY5H23pJugl+s7UX09Z+vaLJe/QHM/6v0DWzV6v73RVaRMini2Mx3Ir/Zatsr7aghYPFBjIl2bW7yZ4bboHdj/G1AsYpMpkGkIhKhh6DhRIRVzxzDzvZf8GSctvJjVy/rZwgb6H7auq+cv4+s6Pl1Uv9djOq53hzFlTasZyD/QFIn82rXQoAAA==\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var button = '_1vgu04fc';\nexport var buttonWrapper = '_1vgu04f8';\nexport var checkBox = '_1vgu04f9';\nexport var content = '_1vgu04f5';\nexport var disableButton = '_1vgu04fe';\nexport var footer = '_1vgu04f2';\nexport var header = '_1vgu04f1';\nexport var input = '_1vgu04fb';\nexport var label = '_1vgu04fa';\nexport var layout = '_1vgu04f0';\nexport var link = '_1vgu04fk';\nexport var linkGroup = '_1vgu04fj';\nexport var onboardingContainer = '_1vgu04f4';\nexport var openAFFiNEButton = '_1vgu04fd';\nexport var optionsWrapper = '_1vgu04f7';\nexport var question = '_1vgu04f6';\nexport var scrollableContainer = '_1vgu04f3';\nexport var thankContainer = '_1vgu04fg';\nexport var thankText = '_1vgu04fi';\nexport var thankTitle = '_1vgu04fh';\nexport var windowsAppButton = '_1vgu04ff';","import { ArrowRightSmallIcon } from '@blocksuite/icons/rc';\nimport clsx from 'clsx';\nimport { useMemo, useState } from 'react';\nimport type { Location } from 'react-router-dom';\n// eslint-disable-next-line @typescript-eslint/no-restricted-imports\nimport { useLocation, useNavigate } from 'react-router-dom';\nimport useSWR from 'swr';\n\nimport { Button } from '../../ui/button';\nimport { Checkbox } from '../../ui/checkbox';\nimport { Divider } from '../../ui/divider';\nimport Input from '../../ui/input';\nimport { ScrollableContainer } from '../../ui/scrollbar';\nimport * as styles from './onboarding-page.css';\nimport type { User } from './type';\n\ntype QuestionOption = {\n  type: 'checkbox' | 'input';\n  label: string;\n  value: string;\n};\n\ntype Question = {\n  id?: string;\n  question: string;\n  options?: QuestionOption[];\n};\n\ntype QuestionnaireAnswer = {\n  form: string;\n  ask: string;\n  answer: string[];\n};\n\nfunction getCallbackUrl(location: Location) {\n  try {\n    const url =\n      location.state?.callbackURL ||\n      new URLSearchParams(location.search).get('redirect_uri');\n    if (typeof url === 'string' && url) {\n      if (!url.startsWith('http:') && !url.startsWith('https:')) {\n        return url;\n      }\n      // we will ignore host to avoid redirect hack\n      const parsedUrl = new URL(url);\n      return parsedUrl.pathname + parsedUrl.search;\n    }\n  } catch (_) {}\n  return null;\n}\n\nexport const ScrollableLayout = ({\n  headerItems,\n  children,\n  isMacosDesktop,\n  isWindowsDesktop,\n}: {\n  isMacosDesktop?: boolean;\n  isWindowsDesktop?: boolean;\n  headerItems?: React.ReactNode;\n  children: React.ReactNode;\n}) => {\n  return (\n    <div className={styles.layout} data-is-macos-electron={isMacosDesktop}>\n      <header\n        className={styles.header}\n        data-is-windows-electron={isWindowsDesktop}\n      >\n        {headerItems}\n      </header>\n      <ScrollableContainer className={styles.scrollableContainer}>\n        <div className={styles.onboardingContainer}>{children}</div>\n      </ScrollableContainer>\n      <footer className={styles.footer}>\n        <div className={styles.linkGroup}>\n          <a\n            className={styles.link}\n            href=\"https://affine.pro/terms\"\n            target=\"_blank\"\n            rel=\"noreferrer\"\n          >\n            Terms of Conditions\n          </a>\n          <Divider orientation=\"vertical\" />\n          <a\n            className={styles.link}\n            href=\"https://affine.pro/privacy\"\n            target=\"_blank\"\n            rel=\"noreferrer\"\n          >\n            Privacy Policy\n          </a>\n        </div>\n      </footer>\n    </div>\n  );\n};\n\nexport const OnboardingPage = ({\n  user,\n  onOpenAffine,\n}: {\n  user: User;\n  onOpenAffine: () => void;\n}) => {\n  const location = useLocation();\n  const navigate = useNavigate();\n  const [questionIdx, setQuestionIdx] = useState(0);\n  const { data: questions } = useSWR<Question[]>(\n    '/api/worker/questionnaire',\n    url => fetch(url).then(r => r.json()),\n    { suspense: true, revalidateOnFocus: false }\n  );\n  const [options, setOptions] = useState(new Set<string>());\n  const [inputs, setInputs] = useState<Record<string, string>>({});\n\n  const callbackUrl = useMemo(() => getCallbackUrl(location), [location]);\n  const question = useMemo(\n    () => questions?.[questionIdx],\n    [questionIdx, questions]\n  );\n  const isMacosDesktop = environment.isDesktop && environment.isMacOs;\n  const isWindowsDesktop = environment.isDesktop && environment.isWindows;\n\n  if (!questions) {\n    return null;\n  }\n\n  if (callbackUrl?.startsWith('/open-app/signin-redirect')) {\n    const url = new URL(callbackUrl, window.location.origin);\n    url.searchParams.set('next', 'onboarding');\n    console.log('redirect to', url.toString());\n    window.location.assign(url.toString());\n    return null;\n  }\n\n  if (question) {\n    return (\n      <ScrollableLayout\n        headerItems={\n          <Button\n            className={clsx(styles.button, {\n              [styles.disableButton]: questionIdx === 0,\n              [styles.windowsAppButton]: isWindowsDesktop,\n            })}\n            size=\"extraLarge\"\n            onClick={() => setQuestionIdx(questions.length)}\n          >\n            Skip\n          </Button>\n        }\n        isMacosDesktop={isMacosDesktop}\n        isWindowsDesktop={isWindowsDesktop}\n      >\n        <div className={styles.content}>\n          <h1 className={styles.question}>{question.question}</h1>\n          <div className={styles.optionsWrapper}>\n            {question.options &&\n              question.options.length > 0 &&\n              question.options.map((option, optionIndex) => {\n                if (option.type === 'checkbox') {\n                  return (\n                    <Checkbox\n                      key={optionIndex}\n                      name={option.value}\n                      className={styles.checkBox}\n                      labelClassName={styles.label}\n                      checked={options.has(option.value)}\n                      onChange={e => {\n                        setOptions(set => {\n                          if (e.target.checked) {\n                            set.add(option.value);\n                          } else {\n                            set.delete(option.value);\n                          }\n                          return new Set(set);\n                        });\n                      }}\n                      label={option.label}\n                    />\n                  );\n                } else if (option.type === 'input') {\n                  return (\n                    <Input\n                      key={optionIndex}\n                      className={styles.input}\n                      type=\"text\"\n                      size=\"large\"\n                      placeholder={option.label}\n                      value={inputs[option.value] || ''}\n                      onChange={value =>\n                        setInputs(prev => ({ ...prev, [option.value]: value }))\n                      }\n                    />\n                  );\n                }\n                return null;\n              })}\n          </div>\n          <div className={styles.buttonWrapper}>\n            <Button\n              className={clsx(styles.button, {\n                [styles.disableButton]: questionIdx !== 0,\n              })}\n              size=\"extraLarge\"\n              onClick={() => setQuestionIdx(questions.length)}\n            >\n              Skip\n            </Button>\n            <Button\n              className={styles.button}\n              variant=\"primary\"\n              size=\"extraLarge\"\n              itemType=\"submit\"\n              onClick={() => {\n                if (question.id && user?.id) {\n                  const answer: QuestionnaireAnswer = {\n                    form: user.id,\n                    ask: question.id,\n                    answer: [\n                      ...Array.from(options),\n                      ...Object.entries(inputs).map(\n                        ([key, value]) => `${key}:${value}`\n                      ),\n                    ],\n                  };\n\n                  // eslint-disable-next-line @typescript-eslint/no-floating-promises\n                  fetch('/api/worker/questionnaire', {\n                    method: 'POST',\n                    body: JSON.stringify(answer),\n                  }).finally(() => {\n                    setOptions(new Set());\n                    setInputs({});\n                    setQuestionIdx(questionIdx + 1);\n                  });\n                } else {\n                  setQuestionIdx(questionIdx + 1);\n                }\n              }}\n              suffix={<ArrowRightSmallIcon />}\n            >\n              {questionIdx === 0 ? 'start' : 'Next'}\n            </Button>\n          </div>\n        </div>\n      </ScrollableLayout>\n    );\n  }\n  return (\n    <ScrollableLayout\n      isMacosDesktop={isMacosDesktop}\n      isWindowsDesktop={isWindowsDesktop}\n    >\n      <div className={styles.thankContainer}>\n        <h1 className={styles.thankTitle}>Thank you!</h1>\n        <p className={styles.thankText}>\n          We will continue to enhance our products based on your feedback. Thank\n          you once again for your supports.\n        </p>\n        <Button\n          className={clsx(styles.button, styles.openAFFiNEButton)}\n          variant=\"primary\"\n          size=\"extraLarge\"\n          onClick={() => {\n            if (callbackUrl) {\n              navigate(callbackUrl);\n            } else {\n              onOpenAffine();\n            }\n          }}\n          suffix={<ArrowRightSmallIcon />}\n        >\n          Get Started\n        </Button>\n      </div>\n    </ScrollableLayout>\n  );\n};\n","import type { PasswordLimitsFragment } from '@affine/graphql';\nimport { useI18n } from '@affine/i18n';\nimport type { FC } from 'react';\nimport { useCallback, useState } from 'react';\n\nimport { Button } from '../../ui/button';\nimport { notify } from '../../ui/notification';\nimport { AuthPageContainer } from './auth-page-container';\nimport { SetPassword } from './set-password';\n\nexport const SetPasswordPage: FC<{\n  passwordLimits: PasswordLimitsFragment;\n  onSetPassword: (password: string) => Promise<void>;\n  onOpenAffine: () => void;\n}> = ({ passwordLimits, onSetPassword: propsOnSetPassword, onOpenAffine }) => {\n  const t = useI18n();\n  const [hasSetUp, setHasSetUp] = useState(false);\n\n  const onSetPassword = useCallback(\n    (passWord: string) => {\n      propsOnSetPassword(passWord)\n        .then(() => setHasSetUp(true))\n        .catch(e =>\n          notify.error({\n            title: t['com.affine.auth.password.set-failed'](),\n            message: String(e),\n          })\n        );\n    },\n    [propsOnSetPassword, t]\n  );\n\n  return (\n    <AuthPageContainer\n      title={\n        hasSetUp\n          ? t['com.affine.auth.set.password.page.success']()\n          : t['com.affine.auth.set.password.page.title']()\n      }\n      subtitle={\n        hasSetUp\n          ? t['com.affine.auth.sent.set.password.success.message']()\n          : t['com.affine.auth.page.sent.email.subtitle']({\n              min: String(passwordLimits.minLength),\n              max: String(passwordLimits.maxLength),\n            })\n      }\n    >\n      {hasSetUp ? (\n        <Button variant=\"primary\" size=\"large\" onClick={onOpenAffine}>\n          {t['com.affine.auth.open.affine']()}\n        </Button>\n      ) : (\n        <SetPassword\n          passwordLimits={passwordLimits}\n          onSetPassword={onSetPassword}\n        />\n      )}\n    </AuthPageContainer>\n  );\n};\n","import type { PropsWithChildren } from 'react';\n\nimport { signInPageContainer } from './share.css';\nexport const SignInPageContainer = ({ children }: PropsWithChildren) => {\n  return <div className={signInPageContainer}>{children}</div>;\n};\n","import { useI18n } from '@affine/i18n';\nimport type { FC } from 'react';\n\nimport { Button } from '../../ui/button';\nimport { AuthPageContainer } from './auth-page-container';\n\nexport const SignInSuccessPage: FC<{\n  onOpenAffine: () => void;\n}> = ({ onOpenAffine }) => {\n  const t = useI18n();\n  return (\n    <AuthPageContainer\n      title={t['com.affine.auth.signed.success.title']()}\n      subtitle={t['com.affine.auth.signed.success.subtitle']()}\n    >\n      <Button variant=\"primary\" size=\"large\" onClick={onOpenAffine}>\n        {t['com.affine.auth.open.affine']()}\n      </Button>\n    </AuthPageContainer>\n  );\n};\n","import type { PasswordLimitsFragment } from '@affine/graphql';\nimport { useI18n } from '@affine/i18n';\nimport type { FC } from 'react';\nimport { useCallback, useState } from 'react';\n\nimport { Button } from '../../ui/button';\nimport { notify } from '../../ui/notification';\nimport { AuthPageContainer } from './auth-page-container';\nimport { SetPassword } from './set-password';\n\nexport const SignUpPage: FC<{\n  passwordLimits: PasswordLimitsFragment;\n  user: { email?: string };\n  onSetPassword: (password: string) => Promise<void>;\n  openButtonText?: string;\n  onOpenAffine: () => void;\n}> = ({\n  passwordLimits,\n  user: { email },\n  onSetPassword: propsOnSetPassword,\n  onOpenAffine,\n  openButtonText,\n}) => {\n  const t = useI18n();\n  const [hasSetUp, setHasSetUp] = useState(false);\n\n  const onSetPassword = useCallback(\n    (passWord: string) => {\n      propsOnSetPassword(passWord)\n        .then(() => setHasSetUp(true))\n        .catch(e =>\n          notify.error({\n            title: t['com.affine.auth.password.set-failed'](),\n            message: String(e),\n          })\n        );\n    },\n    [propsOnSetPassword, t]\n  );\n  const onLater = useCallback(() => {\n    setHasSetUp(true);\n  }, []);\n\n  return (\n    <AuthPageContainer\n      title={\n        hasSetUp\n          ? t['com.affine.auth.sign.up.success.title']()\n          : t['com.affine.auth.page.sent.email.title']()\n      }\n      subtitle={\n        hasSetUp ? (\n          t['com.affine.auth.sign.up.success.subtitle']()\n        ) : (\n          <>\n            {t['com.affine.auth.page.sent.email.subtitle']({\n              min: String(passwordLimits.minLength),\n              max: String(passwordLimits.maxLength),\n            })}\n            <a href={`mailto:${email}`}>{email}</a>\n          </>\n        )\n      }\n    >\n      {hasSetUp ? (\n        <Button variant=\"primary\" size=\"large\" onClick={onOpenAffine}>\n          {openButtonText ?? t['com.affine.auth.open.affine']()}\n        </Button>\n      ) : (\n        <SetPassword\n          passwordLimits={passwordLimits}\n          onSetPassword={onSetPassword}\n          onLater={onLater}\n          showLater={true}\n        />\n      )}\n    </AuthPageContainer>\n  );\n};\n","export const emailRegex =\n  /^(?:(?:[^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@(?:(?:\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|((?:[a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n","import { useI18n } from '@affine/i18n';\n\nimport type { ConfirmModalProps } from '../../ui/modal';\nimport { ConfirmModal } from '../../ui/modal';\n\nexport const PublicLinkDisableModal = (props: ConfirmModalProps) => {\n  const t = useI18n();\n\n  return (\n    <ConfirmModal\n      title={t['com.affine.publicLinkDisableModal.title']()}\n      description={t['com.affine.publicLinkDisableModal.description']()}\n      cancelText={t['com.affine.publicLinkDisableModal.button.cancel']()}\n      confirmText={t['com.affine.publicLinkDisableModal.button.disable']()}\n      confirmButtonOptions={{\n        variant: 'error',\n        ['data-testid' as string]: 'confirm-enable-affine-cloud-button',\n      }}\n      {...props}\n    />\n  );\n};\n","import { atom } from 'jotai';\nimport { nanoid } from 'nanoid';\n\nexport type GlobalLoadingEvent = {\n  key?: string;\n};\n\nconst globalLoadingEventsBaseAtom = atom<GlobalLoadingEvent[]>([]);\n\nexport const globalLoadingEventsAtom = atom<GlobalLoadingEvent[]>(get =>\n  get(globalLoadingEventsBaseAtom)\n);\n\nexport const resolveGlobalLoadingEventAtom = atom(\n  null,\n  (_, set, key: string) => {\n    set(globalLoadingEventsBaseAtom, globalLoadingEvent =>\n      globalLoadingEvent.filter(notification => notification.key !== key)\n    );\n  }\n);\n\nexport const pushGlobalLoadingEventAtom = atom<\n  null,\n  [GlobalLoadingEvent],\n  void\n>(null, (_, set, newGlobalLoadingEvent) => {\n  newGlobalLoadingEvent.key = newGlobalLoadingEvent.key || nanoid();\n\n  set(globalLoadingEventsBaseAtom, globalLoadingEvents => [\n    // push to the top\n    { ...newGlobalLoadingEvent },\n    ...globalLoadingEvents,\n  ]);\n});\n","import { useAtomValue } from 'jotai';\nimport type { ReactNode } from 'react';\nimport { useEffect, useState } from 'react';\n\nimport { Loading } from '../../ui/loading';\nimport * as styles from './index.css';\nimport { globalLoadingEventsAtom } from './index.jotai';\n\nexport {\n  type GlobalLoadingEvent,\n  pushGlobalLoadingEventAtom,\n  resolveGlobalLoadingEventAtom,\n} from './index.jotai';\n\nexport function GlobalLoading(): ReactNode {\n  const globalLoadingEvents = useAtomValue(globalLoadingEventsAtom);\n  const [loading, setLoading] = useState(false);\n\n  useEffect(() => {\n    if (globalLoadingEvents.length) {\n      setLoading(true);\n    } else {\n      setLoading(false);\n    }\n  }, [globalLoadingEvents]);\n\n  if (!globalLoadingEvents.length) {\n    return null;\n  }\n  return (\n    <div className={styles.globalLoadingWrapperStyle} data-loading={loading}>\n      <Loading size={20} />\n    </div>\n  );\n}\n","import \"../component/src/components/global-loading/index.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/components/global-loading/index.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xeGhpM2NsMCB7CiAgcG9zaXRpb246IGZpeGVkOwogIHRvcDogMDsKICBsZWZ0OiAwOwogIGJvdHRvbTogMDsKICByaWdodDogMTAwJTsKICB6LWluZGV4OiA1OwogIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWFmZmluZS1iYWNrZ3JvdW5kLW1vZGFsLWNvbG9yKTsKICBvcGFjaXR5OiAwOwogIHRyYW5zaXRpb246IG9wYWNpdHkgLjNzOwogIGRpc3BsYXk6IGZsZXg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICBjb2xvcjogdmFyKC0tYWZmaW5lLXByb2Nlc3NpbmctY29sb3IpOwp9Ci5fMXhoaTNjbDBbZGF0YS1sb2FkaW5nPSJ0cnVlIl0gewogIHJpZ2h0OiAwOwogIG9wYWNpdHk6IDE7Cn0KQG1lZGlhIHByaW50IHsKICAuXzF4aGkzY2wwIHsKICAgIGRpc3BsYXk6IG5vbmU7CiAgICB6LWluZGV4OiAtMTsKICB9Cn0=\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var globalLoadingWrapperStyle = '_1xhi3cl0';","import { Skeleton } from '../../ui/skeleton';\nimport {\n  blockSuiteEditorHeaderStyle,\n  blockSuiteEditorStyle,\n  pageDetailSkeletonStyle,\n  pageDetailSkeletonTitleStyle,\n} from './index.css';\n\nexport const EditorLoading = () => {\n  return (\n    <div className={blockSuiteEditorStyle}>\n      <Skeleton\n        className={blockSuiteEditorHeaderStyle}\n        animation=\"wave\"\n        height={50}\n      />\n      <Skeleton animation=\"wave\" height={30} width=\"40%\" />\n    </div>\n  );\n};\n\nexport const PageDetailSkeleton = () => {\n  return (\n    <div className={pageDetailSkeletonStyle}>\n      <div className={pageDetailSkeletonTitleStyle} />\n      <EditorLoading />\n    </div>\n  );\n};\n","import \"../component/src/components/page-detail-skeleton/index.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/components/page-detail-skeleton/index.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xdDltZ3NzMCB7CiAgcGFkZGluZzogMCAyMHB4Owp9Ci5fMXQ5bWdzczEgewogIGhlaWdodDogNTJweDsKICB3aWR0aDogMTAwJTsKfQouXzF0OW1nc3MyIHsKICBtYXgtd2lkdGg6IHZhcigtLWFmZmluZS1lZGl0b3Itd2lkdGgpOwogIG1hcmdpbjogMCAycmVtOwogIHBhZGRpbmc6IDAgMjRweDsKfQouXzF0OW1nc3MzIHsKICBtYXJnaW4tdG9wOiA0MHB4OwogIG1hcmdpbi1ib3R0b206IDQwcHg7Cn0=\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var blockSuiteEditorHeaderStyle = '_1t9mgss3';\nexport var blockSuiteEditorStyle = '_1t9mgss2';\nexport var pageDetailSkeletonStyle = '_1t9mgss0';\nexport var pageDetailSkeletonTitleStyle = '_1t9mgss1';","import { assertExists } from '@blocksuite/global/utils';\nimport { assignInlineVars } from '@vanilla-extract/dynamic';\nimport clsx from 'clsx';\nimport {\n  forwardRef,\n  useCallback,\n  useEffect,\n  useLayoutEffect,\n  useRef,\n  useState,\n} from 'react';\nimport { useTransition } from 'react-transition-state';\n\nimport * as styles from './resize-panel.css';\n\nexport interface ResizeHandleProps\n  extends React.HtmlHTMLAttributes<HTMLDivElement> {\n  resizing: boolean;\n  open: boolean;\n  minWidth: number;\n  maxWidth: number;\n  resizeHandlePos: 'left' | 'right';\n  resizeHandleOffset?: number;\n  resizeHandleVerticalPadding?: number;\n  onOpen: (open: boolean) => void;\n  onResizing: (resizing: boolean) => void;\n  onWidthChange: (width: number) => void;\n}\n\nexport interface ResizePanelProps\n  extends React.HtmlHTMLAttributes<HTMLDivElement> {\n  resizing: boolean;\n  open: boolean;\n  floating?: boolean;\n  minWidth: number;\n  maxWidth: number;\n  resizeHandlePos: 'left' | 'right';\n  resizeHandleOffset?: number;\n  resizeHandleVerticalPadding?: number;\n  enableAnimation?: boolean;\n  width: number;\n  unmountOnExit?: boolean;\n  onOpen: (open: boolean) => void;\n  onResizing: (resizing: boolean) => void;\n  onWidthChange: (width: number) => void;\n}\n\nconst ResizeHandle = ({\n  className,\n  resizing,\n  minWidth,\n  maxWidth,\n  resizeHandlePos,\n  resizeHandleOffset,\n  resizeHandleVerticalPadding,\n  open,\n  onOpen,\n  onResizing,\n  onWidthChange,\n  ...rest\n}: ResizeHandleProps) => {\n  const ref = useRef<HTMLDivElement>(null);\n  const onResizeStart = useCallback(() => {\n    let resized = false;\n    const panelContainer = ref.current?.parentElement;\n    assertExists(\n      panelContainer,\n      'parent element not found for resize indicator'\n    );\n\n    const { left: anchorLeft, right: anchorRight } =\n      panelContainer.getBoundingClientRect();\n\n    function onMouseMove(e: MouseEvent) {\n      e.preventDefault();\n      if (!panelContainer) return;\n      const newWidth = Math.min(\n        maxWidth,\n        Math.max(\n          resizeHandlePos === 'right'\n            ? e.clientX - anchorLeft\n            : anchorRight - e.clientX,\n          minWidth\n        )\n      );\n      onWidthChange(newWidth);\n      onResizing(true);\n      resized = true;\n    }\n\n    document.addEventListener('mousemove', onMouseMove);\n    document.addEventListener(\n      'mouseup',\n      () => {\n        // if not resized, toggle sidebar\n        if (!resized) {\n          onOpen(false);\n        }\n        onResizing(false);\n        document.removeEventListener('mousemove', onMouseMove);\n      },\n      { once: true }\n    );\n  }, [maxWidth, resizeHandlePos, minWidth, onWidthChange, onResizing, onOpen]);\n\n  return (\n    <div\n      {...rest}\n      data-testid=\"resize-handle\"\n      ref={ref}\n      style={assignInlineVars({\n        [styles.resizeHandleOffsetVar]: `${resizeHandleOffset ?? 0}px`,\n        [styles.resizeHandleVerticalPadding]: `${\n          resizeHandleVerticalPadding ?? 0\n        }px`,\n      })}\n      className={clsx(styles.resizeHandleContainer, className)}\n      data-handle-position={resizeHandlePos}\n      data-resizing={resizing}\n      data-open={open}\n      onMouseDown={onResizeStart}\n    >\n      <div className={styles.resizerInner} />\n    </div>\n  );\n};\n\n// delay initial animation to avoid flickering\nfunction useEnableAnimation() {\n  const [enable, setEnable] = useState(false);\n  useEffect(() => {\n    window.setTimeout(() => {\n      setEnable(true);\n    }, 500);\n  }, []);\n  return enable;\n}\n\nconst animationTimeout = 300;\n\nexport const ResizePanel = forwardRef<HTMLDivElement, ResizePanelProps>(\n  function ResizePanel(\n    {\n      children,\n      className,\n      resizing,\n      minWidth,\n      maxWidth,\n      width,\n      floating,\n      enableAnimation: _enableAnimation = true,\n      open,\n      unmountOnExit,\n      onOpen,\n      onResizing,\n      onWidthChange,\n      resizeHandlePos,\n      resizeHandleOffset,\n      resizeHandleVerticalPadding,\n      ...rest\n    },\n    ref\n  ) {\n    const enableAnimation = useEnableAnimation() && _enableAnimation;\n    const safeWidth = Math.min(maxWidth, Math.max(minWidth, width));\n    const [{ status }, toggle] = useTransition({\n      timeout: animationTimeout,\n    });\n    useLayoutEffect(() => {\n      toggle(open);\n    }, [open]);\n    return (\n      <div\n        {...rest}\n        ref={ref}\n        style={assignInlineVars({\n          [styles.panelWidthVar]: `${safeWidth}px`,\n          [styles.animationTimeout]: `${animationTimeout}ms`,\n        })}\n        className={clsx(className, styles.root)}\n        data-open={open}\n        data-transition-state={status}\n        data-is-floating={floating}\n        data-handle-position={resizeHandlePos}\n        data-enable-animation={enableAnimation && !resizing}\n      >\n        {!(status === 'exited' && unmountOnExit !== false) && children}\n        <ResizeHandle\n          resizeHandlePos={resizeHandlePos}\n          resizeHandleOffset={resizeHandleOffset}\n          resizeHandleVerticalPadding={resizeHandleVerticalPadding}\n          maxWidth={maxWidth}\n          minWidth={minWidth}\n          onOpen={onOpen}\n          onResizing={onResizing}\n          onWidthChange={onWidthChange}\n          open={open}\n          resizing={resizing}\n        />\n      </div>\n    );\n  }\n);\n","import \"../component/src/components/resize-panel/resize-panel.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/components/resize-panel/resize-panel.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACp1U0Y7aMBB85ytWSCdBdUYJvVBdEFI/o1J1D0uyge05dmQ7HFDx71XswCUEqNqXKNm1Z2Z3ZzM7Zq+6en2B3yMAIcJXlMI8WVT7ZScWpxA135W27FirFAxJdLyjJvrBudumsEMzuYBMm0TJStxNbok3W5dCHEVPy9FpNGvF/MzRoWArCqnRsdqsxs7UNH7zKj8V4NpqWbuuggxlNukzeaqjYJXTPoWXIZGuSPUYStyfRSe3lIULBUpL47cQ2qLKJYmzttXYNKVd8MyGlZBUuJsK4QuIePp/PA1on8aEpv4DDylcSxKouMSA2mmGM6jODe8U0hvn1ynMosQ+9yTcPuH7eis1lPXJLKxDR6sx7dlR3grbseU1S3aHFLac56Q6EMmVVbpm7dsOQO/IFFJ/pIC10x2QxQO/tV3uFhJ7pzld9cNzH15r53R5K9M6LW4X7uLUeHnufqFNmYZXiY5+TJLoKYBi9r4xula5yLTUpj1UoSHlfGkVZr5BfndztpXEQwqFJM/1q7aOi4PItHKkGtOQcmSaVFYb2wBmWgpDlo+0vDJDiw3RLE4sEFpqXrtzXIQ5+uudLX6Gcz7dNr33Xb4ojYcAvT3wpy+VKK3o3oXmeX1+LXX2PrzwaK3C2g4H3TogeObepEQY1YXv2wNLXfuyNcY8+GKtTU5GGMy5tp/RgQOCUCwKViQqwyWaQ8hNryeIUkI0m4fhCVZC1+5+KdEsqfbTv48XeqW2RbzcLMJHT6PvJeWMMOn8dxdRVO2nHqG3jIPRA5xGpz9poejJxgYAAA==\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var animationTimeout = 'var(--zc9op93)';\nexport var panelContent = 'zc9op95';\nexport var panelWidthVar = 'var(--zc9op90)';\nexport var resizeHandleContainer = 'zc9op96';\nexport var resizeHandleOffsetVar = 'var(--zc9op91)';\nexport var resizeHandleVerticalPadding = 'var(--zc9op92)';\nexport var resizerInner = 'zc9op97';\nexport var root = 'zc9op94';","import {\n  useLiveData,\n  useService,\n  type WorkspaceMetadata,\n  WorkspacesService,\n} from '@toeverything/infra';\nimport { useEffect, useLayoutEffect, useState } from 'react';\n\nimport { Avatar, type AvatarProps } from '../../ui/avatar';\n\nconst cache = new Map<string, { imageBitmap: ImageBitmap; key: string }>();\n\n/**\n * workspace avatar component with automatic cache, and avoid flashing\n */\nexport const WorkspaceAvatar = ({\n  meta,\n  ...otherProps\n}: { meta: WorkspaceMetadata } & AvatarProps) => {\n  const workspacesService = useService(WorkspacesService);\n\n  const profile = workspacesService.getProfile(meta);\n\n  useEffect(() => {\n    profile.revalidate();\n  }, [meta, profile]);\n\n  const avatarKey = useLiveData(profile.profile$.map(v => v?.avatar));\n\n  const [downloadedAvatar, setDownloadedAvatar] = useState<\n    { imageBitmap: ImageBitmap; key: string } | undefined\n  >(cache.get(meta.id));\n\n  useLayoutEffect(() => {\n    if (!avatarKey || !meta) {\n      setDownloadedAvatar(undefined);\n      return;\n    }\n\n    let canceled = false;\n    workspacesService\n      .getWorkspaceBlob(meta, avatarKey)\n      .then(async blob => {\n        if (blob && !canceled) {\n          const image = document.createElement('img');\n          const objectUrl = URL.createObjectURL(blob);\n          image.src = objectUrl;\n          await image.decode();\n          // limit the size of the image data to reduce memory usage\n          const hRatio = 128 / image.naturalWidth;\n          const vRatio = 128 / image.naturalHeight;\n          const ratio = Math.min(hRatio, vRatio);\n          const imageBitmap = await createImageBitmap(image, {\n            resizeWidth: image.naturalWidth * ratio,\n            resizeHeight: image.naturalHeight * ratio,\n          });\n          URL.revokeObjectURL(objectUrl);\n          setDownloadedAvatar(prev => {\n            if (prev?.key === avatarKey) {\n              return prev;\n            }\n            return { imageBitmap, key: avatarKey };\n          });\n          cache.set(meta.id, {\n            imageBitmap,\n            key: avatarKey,\n          });\n        }\n      })\n      .catch(err => {\n        console.error('get workspace blob error: ' + err);\n      });\n\n    return () => {\n      canceled = true;\n    };\n  }, [meta, workspacesService, avatarKey]);\n\n  return <Avatar image={downloadedAvatar?.imageBitmap} {...otherProps} />;\n};\n","import { useLayoutEffect, useRef } from 'react';\n\nexport const useAutoFocus = <T extends HTMLElement = HTMLElement>(\n  autoFocus?: boolean\n) => {\n  const ref = useRef<T | null>(null);\n\n  useLayoutEffect(() => {\n    if (ref.current && autoFocus) {\n      // to avoid clicking on something focusable(e.g MenuItem),\n      // then the input will not be focused\n      setTimeout(() => {\n        ref.current?.focus();\n      }, 0);\n    }\n  }, [autoFocus]);\n\n  return ref;\n};\n\nexport const useAutoSelect = <T extends HTMLInputElement = HTMLInputElement>(\n  autoSelect?: boolean\n) => {\n  const ref = useAutoFocus<T>(autoSelect);\n\n  useLayoutEffect(() => {\n    if (ref.current && autoSelect) {\n      ref.current?.select();\n    }\n  }, [autoSelect, ref]);\n\n  return ref;\n};\n","/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\nimport type React from 'react';\n\nconst DEV_MODE = process.env.NODE_ENV !== 'production';\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntype DistributiveOmit<T, K extends string | number | symbol> = T extends any\n  ? K extends keyof T\n    ? Omit<T, K>\n    : T\n  : T;\ntype PropsWithoutRef<T> = DistributiveOmit<T, 'ref'>;\n\n/**\n * Creates a type to be used for the props of a web component used directly in\n * React JSX.\n *\n * Example:\n *\n * ```ts\n * declare module \"react\" {\n *   namespace JSX {\n *     interface IntrinsicElements {\n *       'x-foo': WebComponentProps<XFoo>;\n *     }\n *   }\n * }\n * ```\n */\nexport type WebComponentProps<I extends HTMLElement> = React.DetailedHTMLProps<\n  React.HTMLAttributes<I>,\n  I\n> &\n  ElementProps<I>;\n\n// eslint-disable-next-line @typescript-eslint/ban-types\ntype EmptyObject = {};\n\n/**\n * Type of the React component wrapping the web component. This is the return\n * type of `createComponent`.\n */\nexport type ReactWebComponent<\n  I extends HTMLElement,\n  E extends EventNames = EmptyObject,\n> = React.ForwardRefExoticComponent<\n  // TODO(augustjk): Remove and use `React.PropsWithoutRef` when\n  // https://github.com/preactjs/preact/issues/4124 is fixed.\n  PropsWithoutRef<ComponentProps<I, E>> & React.RefAttributes<I>\n>;\n\n// Props derived from custom element class. Currently has limitations of making\n// all properties optional and also surfaces life cycle methods in autocomplete.\n// TODO(augustjk) Consider omitting keyof LitElement to remove \"internal\"\n// lifecycle methods or allow user to explicitly provide props.\ntype ElementProps<I> = Partial<Omit<I, keyof HTMLElement>>;\n\n// Acceptable props to the React component.\ntype ComponentProps<I, E extends EventNames = EmptyObject> = Omit<\n  React.HTMLAttributes<I>,\n  // Prefer type of provided event handler props or those on element over\n  // built-in HTMLAttributes\n  keyof E | keyof ElementProps<I>\n> &\n  EventListeners<E> &\n  ElementProps<I>;\n\n/**\n * Type used to cast an event name with an event type when providing the\n * `events` option to `createComponent` for better typing of the event handler\n * prop.\n *\n * Example:\n *\n * ```ts\n * const FooComponent = createComponent({\n *   ...\n *   events: {\n *     onfoo: 'foo' as EventName<FooEvent>,\n *   }\n * });\n * ```\n *\n * `onfoo` prop will have the type `(e: FooEvent) => void`.\n */\nexport type EventName<T extends Event = Event> = string & {\n  __eventType: T;\n};\n\n// A key value map matching React prop names to event names.\ntype EventNames = Record<string, EventName | string>;\n\n// A map of expected event listener types based on EventNames.\ntype EventListeners<R extends EventNames> = {\n  [K in keyof R]?: R[K] extends EventName\n    ? (e: R[K]['__eventType']) => void\n    : (e: Event) => void;\n};\n\nexport interface Options<\n  I extends HTMLElement,\n  E extends EventNames = EmptyObject,\n> {\n  react: typeof React;\n  tagName?: string; // default to `div`\n  elementClass: Constructor<I>;\n  events?: E;\n  displayName?: string;\n}\n\ntype Constructor<T> = { new (): T };\n\nconst reservedReactProperties = new Set([\n  'children',\n  'localName',\n  'ref',\n  'style',\n  'className',\n]);\n\nconst listenedEvents = new WeakMap<Element, Map<string, EventListenerObject>>();\n\n/**\n * Adds an event listener for the specified event to the given node. In the\n * React setup, there should only ever be one event listener. Thus, for\n * efficiency only one listener is added and the handler for that listener is\n * updated to point to the given listener function.\n */\nconst addOrUpdateEventListener = (\n  node: Element,\n  event: string,\n  listener: (event?: Event) => void\n) => {\n  let events = listenedEvents.get(node);\n  if (events === undefined) {\n    listenedEvents.set(node, (events = new Map()));\n  }\n  let handler = events.get(event);\n  if (listener !== undefined) {\n    // If necessary, add listener and track handler\n    if (handler === undefined) {\n      events.set(event, (handler = { handleEvent: listener }));\n      node.addEventListener(event, handler);\n      // Otherwise just update the listener with new value\n    } else {\n      handler.handleEvent = listener;\n    }\n    // Remove listener if one exists and value is undefined\n  } else if (handler !== undefined) {\n    events.delete(event);\n    node.removeEventListener(event, handler);\n  }\n};\n\n/**\n * Sets properties and events on custom elements. These properties and events\n * have been pre-filtered so we know they should apply to the custom element.\n */\nconst setProperty = <E extends Element>(\n  node: E,\n  name: string,\n  value: unknown,\n  old: unknown,\n  events?: EventNames\n) => {\n  const event = events?.[name];\n  // Dirty check event value.\n  if (event !== undefined && value !== old) {\n    addOrUpdateEventListener(node, event, value as (e?: Event) => void);\n    return;\n  }\n  // But don't dirty check properties; elements are assumed to do this.\n  node[name as keyof E] = value as E[keyof E];\n\n  // This block is to replicate React's behavior for attributes of native\n  // elements where `undefined` or `null` values result in attributes being\n  // removed.\n  // https://github.com/facebook/react/blob/899cb95f52cc83ab5ca1eb1e268c909d3f0961e7/packages/react-dom-bindings/src/client/DOMPropertyOperations.js#L107-L141\n  //\n  // It's only needed here for native HTMLElement properties that reflect\n  // attributes of the same name but don't have that behavior like \"id\" or\n  // \"draggable\".\n  if (\n    (value === undefined || value === null) &&\n    name in HTMLElement.prototype\n  ) {\n    node.removeAttribute(name);\n  }\n};\n\n/**\n * Creates a React component for a custom element. Properties are distinguished\n * from attributes automatically, and events can be configured so they are added\n * to the custom element as event listeners.\n *\n * note from pengx17:\n * This is a workaround for https://github.com/lit/lit/issues/4435\n *\n * Instead of directly using tag names of the custom elements, we create instance and then\n * append to the container instead. An issue in this workaround is that the custom element\n * will always be wrapped in an additional tag (the container, e.g. a div).\n *\n * @param options An options bag containing the parameters needed to generate a\n * wrapped web component.\n *\n * @param options.react The React module, typically imported from the `react`\n * npm package.\n * @param options.tagName The custom element tag name registered via\n * `customElements.define`.\n * @param options.elementClass The custom element class registered via\n * `customElements.define`.\n * @param options.events An object listing events to which the component can\n * listen. The object keys are the event property names passed in via React\n * props and the object values are the names of the corresponding events\n * generated by the custom element. For example, given `{onactivate:\n * 'activate'}` an event function may be passed via the component's `onactivate`\n * prop and will be called when the custom element fires its `activate` event.\n * @param options.displayName A React component display name, used in debugging\n * messages. Default value is inferred from the name of custom element class\n * registered via `customElements.define`.\n */\nexport const createComponent = <\n  I extends HTMLElement,\n  E extends EventNames = EmptyObject,\n>({\n  react: React,\n  tagName = 'div',\n  elementClass,\n  events,\n  displayName,\n}: Options<I, E>): ReactWebComponent<I, E> => {\n  const eventProps = new Set(Object.keys(events ?? {}));\n\n  if (DEV_MODE) {\n    for (const p of reservedReactProperties) {\n      if (p in elementClass.prototype && !(p in HTMLElement.prototype)) {\n        // Note, this effectively warns only for `ref` since the other\n        // reserved props are on HTMLElement.prototype. To address this\n        // would require crawling down the prototype, which doesn't feel worth\n        // it since implementing these properties on an element is extremely\n        // rare.\n        console.warn(\n          `${tagName} contains property ${p} which is a React reserved ` +\n            `property. It will be used by React and not set on the element.`\n        );\n      }\n    }\n  }\n\n  type Props = ComponentProps<I, E>;\n\n  const ReactComponent = React.forwardRef<I, Props>((props, ref) => {\n    const containerRef = React.useRef<HTMLElement | null>(null);\n    const prevPropsRef = React.useRef<Props | null>(null);\n    const elementRef = React.useRef<I | null>(null);\n\n    // Props to be passed to React.createElement\n    const reactProps: Record<string, unknown> = {\n      'data-lit-react-wrapper': elementClass.name,\n    };\n    const elementProps: Record<string, unknown> = {};\n\n    if (elementRef.current === null) {\n      const element = new elementClass();\n      elementRef.current = element;\n      if (typeof ref === 'function') {\n        ref(elementRef.current);\n      } else if (ref) {\n        ref.current = element;\n      }\n    }\n\n    const element = elementRef.current;\n\n    for (const [k, v] of Object.entries(props)) {\n      if (reservedReactProperties.has(k)) {\n        reactProps[k] = v;\n        continue;\n      }\n\n      if (eventProps.has(k) || k in elementClass.prototype) {\n        elementProps[k] = v;\n        continue;\n      }\n\n      reactProps[k] = v;\n    }\n\n    // This one has no dependency array so it'll run on every re-render.\n    React.useLayoutEffect(() => {\n      if (elementRef.current === null) {\n        return;\n      }\n      for (const prop in elementProps) {\n        setProperty(\n          elementRef.current,\n          prop,\n          props[prop],\n          prevPropsRef.current ? prevPropsRef.current[prop] : undefined,\n          events\n        );\n      }\n      // Note, the spirit of React might be to \"unset\" any old values that\n      // are no longer included; however, there's no reasonable value to set\n      // them to so we just leave the previous state as is.\n\n      prevPropsRef.current = props;\n    });\n\n    React.useLayoutEffect(() => {\n      const container = containerRef.current;\n      if (!container) {\n        return;\n      }\n      container.append(element);\n      return () => {\n        element.remove();\n      };\n    }, [element]);\n\n    return React.createElement(tagName, {\n      ...reactProps,\n      ref: React.useCallback(\n        (node: HTMLElement) => {\n          containerRef.current = node;\n        },\n        [containerRef]\n      ),\n    });\n  });\n\n  ReactComponent.displayName = displayName ?? elementClass.name;\n\n  return ReactComponent;\n};\n","import { html, LitElement } from 'lit';\nimport { customElement } from 'lit/decorators.js';\nimport { nanoid } from 'nanoid';\nimport { useCallback, useMemo, useState } from 'react';\nimport ReactDOM from 'react-dom';\n\ntype PortalEvent = {\n  name: 'connectedCallback' | 'disconnectedCallback' | 'willUpdate';\n  target: LitReactPortal;\n  previousPortalId?: string;\n};\n\ntype PortalListener = (event: PortalEvent) => void;\nconst listeners: Set<PortalListener> = new Set();\n\nexport function createLitPortalAnchor(callback: (event: PortalEvent) => void) {\n  const id = nanoid();\n  // todo(@Peng): clean up listeners?\n  listeners.add(event => {\n    if (event.target.portalId !== id) {\n      return;\n    }\n    callback(event);\n  });\n  return html`<lit-react-portal portalId=${id}></lit-react-portal>`;\n}\n\nexport const LIT_REACT_PORTAL = 'lit-react-portal';\n\n@customElement(LIT_REACT_PORTAL)\nclass LitReactPortal extends LitElement {\n  portalId: string = '';\n\n  static override get properties() {\n    return {\n      portalId: { type: String },\n    };\n  }\n\n  // do not enable shadow root\n  override createRenderRoot() {\n    return this;\n  }\n\n  override connectedCallback() {\n    listeners.forEach(l =>\n      l({\n        name: 'connectedCallback',\n        target: this,\n      })\n    );\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    listeners.forEach(l =>\n      l({\n        name: 'disconnectedCallback',\n        target: this,\n      })\n    );\n  }\n\n  override willUpdate(changedProperties: any) {\n    super.willUpdate(changedProperties);\n    listeners.forEach(l =>\n      l({\n        name: 'willUpdate',\n        target: this,\n        previousPortalId: changedProperties.get('portalId'),\n      })\n    );\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    [LIT_REACT_PORTAL]: LitReactPortal;\n  }\n}\n\nexport type ElementOrFactory = React.ReactElement | (() => React.ReactElement);\n\ntype LitPortal = {\n  id: string;\n  portal: React.ReactPortal;\n};\n\n// returns a factory function that renders a given element to a lit template\nexport const useLitPortalFactory = () => {\n  const [portals, setPortals] = useState<LitPortal[]>([]);\n\n  return [\n    useCallback(\n      (elementOrFactory: React.ReactElement | (() => React.ReactElement)) => {\n        const element =\n          typeof elementOrFactory === 'function'\n            ? elementOrFactory()\n            : elementOrFactory;\n        return createLitPortalAnchor(event => {\n          const portalId = event.target.portalId;\n          setPortals(portals => {\n            const newPortals = portals.filter(\n              p => p.id !== event.previousPortalId && p.id !== portalId\n            );\n            if (event.name !== 'disconnectedCallback') {\n              newPortals.push({\n                id: portalId,\n                portal: ReactDOM.createPortal(element, event.target),\n              });\n            }\n            return newPortals;\n          });\n        });\n      },\n      [setPortals]\n    ),\n    portals,\n  ] as const;\n};\n\n// render a react element to a lit template\nexport const useLitPortal = (\n  elementOrFactory: React.ReactElement | (() => React.ReactElement)\n) => {\n  const [anchor, setAnchor] = useState<HTMLElement>();\n  const template = useMemo(\n    () =>\n      createLitPortalAnchor(event => {\n        if (event.name !== 'disconnectedCallback') {\n          setAnchor(event.target as HTMLElement);\n        } else {\n          setAnchor(undefined);\n        }\n      }),\n    []\n  );\n\n  const element = useMemo(\n    () =>\n      typeof elementOrFactory === 'function'\n        ? elementOrFactory()\n        : elementOrFactory,\n    [elementOrFactory]\n  );\n  return {\n    template,\n    portal: anchor ? ReactDOM.createPortal(element, anchor) : undefined,\n  };\n};\n","import { LitElement, type TemplateResult } from 'lit';\nimport { customElement } from 'lit/decorators.js';\nimport React, { createElement, type ReactNode } from 'react';\n\nimport { createComponent } from './create-component';\n\n@customElement('affine-lit-template-wrapper')\nexport class LitTemplateWrapper extends LitElement {\n  static override get properties() {\n    return {\n      template: { type: Object },\n    };\n  }\n  template: TemplateResult | null = null;\n  // do not enable shadow root\n  override createRenderRoot() {\n    return this;\n  }\n\n  override render() {\n    return this.template;\n  }\n}\n\nconst TemplateWrapper = createComponent({\n  elementClass: LitTemplateWrapper,\n  react: React,\n});\n\nexport const toReactNode = (template?: TemplateResult | string): ReactNode => {\n  if (!template) return null;\n  return typeof template === 'string'\n    ? template\n    : createElement(TemplateWrapper, { template });\n};\n","import \"../component/src/ui/date-picker/calendar/calendar.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/ui/date-picker/calendar/calendar.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACq1W227jOAx9z1cIARZoZ1aF4yZpVsV8SVEMaIuONZUlryTnMov594HlSyzHaZLdRR4Ci9LhIXVI6un7BlWMGJN/ZoRkEg+MLF5nv2ZPreHZG/aCu5yRaGhZektaGasNI6UWyqF5nRFSaiuc0IoRgxKc2GG9us+FQ2pLSJERpfcGygCNsQQzbfBPMliCzKFp/GjlUDlG5vPQByRWy8p5H0JZdJ4mIT+pULwNh3T0KO5QOVsTUP5Eog1HQw1wUVlGhMrRCDckthqycAZU5ziB9GNrdKU4TbXUhkRPsSUIFsPjud6hGYKMDzKyA/NAKWSZUEj9/sbyOERadxnyILqEVLhjG2yiD9TmwPWekcj/4vIQwiYGOodj2AE1nw5GFuWBWC0FbyIuwaBy4alMp5WlO2FFIvECtafVp2fGfifTcYn3yxsXFhKJ/P0kmZc3MAJoZ/k2d6bC+XugVKUdBSn1HvmrF9a5T4cH14FMuP7L43FhSwlH5qumRgIptooKh4VlJMWuHH5U1onsSHsFn0yFULQtrXhTepACDt3Sat0s9VVJSGXRUIsSU9dp+EQLPK0BZgoyfaiByRfyQr62Mba7o0fyhayDuJLpuOp/yoXBtBF+qmVVqNqyhZKFqIsAML0jUadT3J/KUWxzxwhUTg+tOGpIp52ZcF2SX8/d/pq9cXBAhaUSM9dLI8Q9uywfvHVgXHM7ZiuUB2CExssyBDY1kbuQUfEBrmkCoc/RELjQHL/NC61cPn8nt0QR0nxe34D2GfURu+XyHO+IYP4VueXmOtgd3FZxA9dtykIFCiXr+u6E6D86+cRxW25aOWrFTxw1hWa9eOz37NuD68jLsATOhdoy33rb0h2Nl2WzemUUbu9qL74Gl2HU+bBGNqFNNJP+3iCXTZCTGesjj7oIp+OearUi1Wqixf74v1vRx3/r2f6yaIJuj3jBXxT4k9fTfLDnaV41ab44lCymWnEwxz5np/4Xj266CPro2KqGGllE0R9DqO57dI+b2yvkYgSlEUXI/1xnA5Z9E3CawzEY6FNFeM8LosWu3wNpZeoXDvVtMXw1TAFKSD/oIppCa4bz6Olx5cUXErxdEWVlkPpmEjDR3qcX6GITVCh1ul887f870MnzqJeY60JOwOKNHWMMflPSWPgK/URcWJQ5WGE/TebJfdWOkP7JtYiayfsb976gwhcNAAA=\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var basicCell = '_8en2ee9';\nexport var basicInteractive = '_8en2ee4';\nexport var calendarHeader = '_8en2eec';\nexport var calendarHeaderTriggerButton = '_8en2eef _8en2ee6 _8en2ee4 _8en2ee5 _8en2ee7';\nexport var calendarRoot = '_8en2eea';\nexport var calendarWrapper = '_8en2eeb';\nexport var decadeViewBody = '_8en2eeo _8en2eej';\nexport var decadeViewBodyCell = '_8en2eeu _8en2eeq _8en2eem _8en2ee9';\nexport var decadeViewBodyCellInner = '_8en2eer _8en2een _8en2ee6 _8en2ee4 _8en2ee5 _8en2ee7';\nexport var decadeViewRow = '_8en2eek';\nexport var disabledInteractive = '_8en2ee7 _8en2ee4';\nexport var focusInteractive = '_8en2ee6 _8en2ee4';\nexport var headerLayoutCell = '_8en2eed _8en2ee9';\nexport var headerLayoutCellOrigin = '_8en2eee';\nexport var headerNavButtons = '_8en2eeg';\nexport var headerNavGapFallback = '_8en2eeh';\nexport var headerNavToday = '_8en2eei _8en2ee6 _8en2ee4 _8en2ee5 _8en2ee7';\nexport var hoverInteractive = '_8en2ee5 _8en2ee4';\nexport var interactive = '_8en2ee6 _8en2ee4 _8en2ee5 _8en2ee7';\nexport var monthViewBody = '_8en2eej';\nexport var monthViewBodyCell = '_8en2eem _8en2ee9';\nexport var monthViewBodyCellInner = '_8en2een _8en2ee6 _8en2ee4 _8en2ee5 _8en2ee7';\nexport var monthViewHeaderCell = '_8en2eel _8en2ee9';\nexport var monthViewRow = '_8en2eek';\nexport var spacer = '_8en2ee2';\nexport var spacerX = '_8en2ee3 _8en2ee2';\nexport var vars = {gapX:'var(--_8en2ee0)',gapY:'var(--_8en2ee1)'};\nexport var yearViewBody = '_8en2eeo _8en2eej';\nexport var yearViewBodyCell = '_8en2eeq _8en2eem _8en2ee9';\nexport var yearViewBodyCellInner = '_8en2eer _8en2een _8en2ee6 _8en2ee4 _8en2ee5 _8en2ee7';\nexport var yearViewRow = '_8en2eek';","import dayjs from 'dayjs';\n\nexport const DATE_MIN = '1970-01-01';\nexport const DATE_MAX = '2099-12-31';\n\nexport const YEAR_MIN = dayjs(DATE_MIN).year();\nexport const YEAR_MAX = dayjs(DATE_MAX).year();\n","import { ArrowLeftSmallIcon, ArrowRightSmallIcon } from '@blocksuite/icons/rc';\nimport { assignInlineVars } from '@vanilla-extract/dynamic';\nimport clsx from 'clsx';\nimport type { HTMLAttributes, PropsWithChildren, ReactNode } from 'react';\nimport { forwardRef, memo } from 'react';\n\nimport { IconButton } from '../../button';\nimport * as styles from './calendar.css';\nimport type { DateCell } from './types';\n\ninterface HeaderLayoutProps extends HTMLAttributes<HTMLDivElement> {\n  mode: 'day' | 'month' | 'year';\n  length: number;\n  left: React.ReactNode;\n  right: React.ReactNode;\n}\n\nconst autoHeight = { height: 'auto' };\n/**\n * The `DatePicker` should work with different width\n * This is a hack to make header's item align with calendar cell's label, **instead of the cell**\n * @param length: number of items that calendar body row has\n */\nconst HeaderLayout = memo(function HeaderLayout({\n  length,\n  left,\n  right,\n  className,\n  style,\n  mode,\n  ...attrs\n}: HeaderLayoutProps) {\n  const vars = assignInlineVars({ '--len': `${length}` });\n  const finalStyle = { ...vars, ...style };\n  return (\n    <div\n      className={clsx(styles.monthViewRow, className)}\n      style={finalStyle}\n      {...attrs}\n    >\n      {Array.from({ length })\n        .fill(0)\n        .map((_, index) => {\n          const isLeft = index === 0;\n          const isRight = index === length - 1;\n          return (\n            <div\n              key={index}\n              data-length={length}\n              data-is-left={isLeft}\n              data-is-right={isRight}\n              className={clsx({\n                [styles.monthViewBodyCell]: mode === 'day',\n                [styles.yearViewBodyCell]: mode === 'month',\n                [styles.decadeViewBodyCell]: mode === 'year',\n              })}\n              style={autoHeight}\n            >\n              <div className={styles.headerLayoutCellOrigin}>\n                {isLeft ? left : isRight ? right : null}\n              </div>\n            </div>\n          );\n        })}\n    </div>\n  );\n});\n\ninterface CalendarLayoutProps {\n  headerLeft: ReactNode;\n  headerRight: ReactNode;\n  body: ReactNode;\n  length: number;\n  mode: 'day' | 'month' | 'year';\n}\nexport const CalendarLayout = forwardRef<HTMLDivElement, CalendarLayoutProps>(\n  (\n    { headerLeft, headerRight, body, length, mode }: CalendarLayoutProps,\n    ref\n  ) => {\n    return (\n      <div className={styles.calendarWrapper} ref={ref} data-mode={mode}>\n        <HeaderLayout\n          mode={mode}\n          length={length}\n          left={headerLeft}\n          right={headerRight}\n          className={styles.calendarHeader}\n        />\n        {body}\n      </div>\n    );\n  }\n);\nCalendarLayout.displayName = 'CalendarLayout';\n\nexport const DefaultDateCell = ({\n  label,\n  date,\n  isToday,\n  notCurrentMonth,\n  selected,\n  focused,\n}: DateCell) => {\n  return (\n    <button\n      data-is-date-cell\n      data-value={date.format('YYYY-MM-DD')}\n      data-is-today={isToday}\n      data-not-current-month={notCurrentMonth}\n      data-selected={selected}\n      tabIndex={focused ? 0 : -1}\n      className={styles.monthViewBodyCellInner}\n    >\n      {label}\n    </button>\n  );\n};\n\ninterface NavButtonsProps extends PropsWithChildren {\n  prevDisabled?: boolean;\n  nextDisabled?: boolean;\n  onPrev?: () => void;\n  onNext?: () => void;\n}\nexport const NavButtons = memo(function NavButtons({\n  children,\n  prevDisabled,\n  nextDisabled,\n  onPrev,\n  onNext,\n}: NavButtonsProps) {\n  return (\n    <div className={styles.headerNavButtons} key=\"nav-btn-group\">\n      <IconButton\n        key=\"nav-btn-prev\"\n        size=\"16\"\n        disabled={prevDisabled}\n        data-testid=\"date-picker-nav-prev\"\n        onClick={onPrev}\n      >\n        <ArrowLeftSmallIcon />\n      </IconButton>\n\n      {children ?? <div className={styles.headerNavGapFallback} />}\n\n      <IconButton\n        key=\"nav-btn-next\"\n        size=\"16\"\n        disabled={nextDisabled}\n        data-testid=\"date-picker-nav-next\"\n        onClick={onNext}\n      >\n        <ArrowRightSmallIcon />\n      </IconButton>\n    </div>\n  );\n});\n","import dayjs from 'dayjs';\nimport { memo, useCallback, useEffect, useMemo, useRef } from 'react';\n\nimport * as styles from './calendar.css';\nimport { DATE_MAX, DATE_MIN } from './constants';\nimport { CalendarLayout, DefaultDateCell, NavButtons } from './items';\nimport type { DateCell, DatePickerModePanelProps } from './types';\n\nexport const DayPicker = memo(function DayPicker(\n  props: DatePickerModePanelProps\n) {\n  const dayPickerRootRef = useRef<HTMLDivElement>(null);\n  const headerMonthRef = useRef<HTMLButtonElement>(null);\n\n  const {\n    value,\n    cursor,\n    weekDays,\n    monthNames,\n    format,\n    todayLabel,\n    customDayRenderer,\n    onChange,\n    onCursorChange,\n    onModeChange,\n  } = props;\n\n  const matrix = useMemo(() => {\n    const firstDayOfMonth = cursor.startOf('month');\n    const firstDayOfFirstWeek = firstDayOfMonth.startOf('week');\n\n    const lastDayOfMonth = cursor.endOf('month');\n    const lastDayOfLastWeek = lastDayOfMonth.endOf('week');\n\n    const matrix = [];\n    let currentDay = firstDayOfFirstWeek;\n    while (currentDay.isBefore(lastDayOfLastWeek)) {\n      const week: DateCell[] = [];\n      for (let i = 0; i < 7; i++) {\n        week.push({\n          date: currentDay,\n          label: currentDay.date().toString(),\n          isToday: currentDay.isSame(dayjs(), 'day'),\n          notCurrentMonth: !currentDay.isSame(cursor, 'month'),\n          selected: value ? currentDay.isSame(value, 'day') : false,\n          focused: currentDay.isSame(cursor, 'day'),\n        });\n        currentDay = currentDay.add(1, 'day');\n      }\n      matrix.push(week);\n    }\n    return matrix;\n  }, [cursor, value]);\n\n  const prevDisabled = useMemo(() => {\n    const firstDayOfMonth = cursor.startOf('month');\n    return firstDayOfMonth.isSame(DATE_MIN, 'day');\n  }, [cursor]);\n  const nextDisabled = useMemo(() => {\n    const lastDayOfMonth = cursor.endOf('month');\n    return lastDayOfMonth.isSame(DATE_MAX, 'day');\n  }, [cursor]);\n\n  const onNextMonth = useCallback(() => {\n    onCursorChange?.(cursor.add(1, 'month').set('date', 1));\n  }, [cursor, onCursorChange]);\n  const onPrevMonth = useCallback(() => {\n    onCursorChange?.(cursor.add(-1, 'month').set('date', 1));\n  }, [cursor, onCursorChange]);\n\n  const focusCursor = useCallback(() => {\n    const div = dayPickerRootRef.current;\n    if (!div) return;\n    const focused = div.querySelector('[data-is-date-cell][tabindex=\"0\"]');\n    focused && (focused as HTMLElement).focus();\n  }, []);\n  const openMonthPicker = useCallback(\n    () => onModeChange?.('month'),\n    [onModeChange]\n  );\n  const openYearPicker = useCallback(\n    () => onModeChange?.('year'),\n    [onModeChange]\n  );\n\n  // keyboard navigation\n  useEffect(() => {\n    const div = dayPickerRootRef.current;\n    if (!div) return;\n    const onKeyDown = (e: KeyboardEvent) => {\n      if (!['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key))\n        return;\n\n      const focused = document.activeElement;\n\n      // check if focused is a date cell\n      if (!focused?.hasAttribute('data-is-date-cell')) return;\n      if (e.shiftKey) return;\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      if (e.key === 'ArrowUp') onCursorChange?.(cursor.add(-7, 'day'));\n      if (e.key === 'ArrowDown') onCursorChange?.(cursor.add(7, 'day'));\n      if (e.key === 'ArrowLeft') onCursorChange?.(cursor.add(-1, 'day'));\n      if (e.key === 'ArrowRight') onCursorChange?.(cursor.add(1, 'day'));\n      setTimeout(focusCursor);\n    };\n    div.addEventListener('keydown', onKeyDown);\n    return () => {\n      div?.removeEventListener('keydown', onKeyDown);\n    };\n  }, [cursor, focusCursor, onCursorChange]);\n\n  const HeaderLeft = useMemo(\n    () => (\n      <div style={{ whiteSpace: 'nowrap' }}>\n        <button\n          onClick={openMonthPicker}\n          ref={headerMonthRef}\n          className={styles.calendarHeaderTriggerButton}\n          data-testid=\"month-picker-button\"\n          data-month={cursor.month()}\n          data-year={cursor.year()}\n        >\n          {monthNames.split(',')[cursor.month()]}\n        </button>\n        <button\n          className={styles.calendarHeaderTriggerButton}\n          onClick={openYearPicker}\n          data-testid=\"year-picker-button\"\n          data-year={cursor.year()}\n        >\n          {cursor.year()}\n        </button>\n      </div>\n    ),\n    [cursor, monthNames, openMonthPicker, openYearPicker]\n  );\n  const HeaderRight = useMemo(\n    () => (\n      <NavButtons\n        key=\"nav-buttons\"\n        onNext={onNextMonth}\n        onPrev={onPrevMonth}\n        prevDisabled={prevDisabled}\n        nextDisabled={nextDisabled}\n      >\n        <button\n          className={styles.headerNavToday}\n          onClick={() => onChange?.(dayjs().format(format))}\n        >\n          {todayLabel}\n        </button>\n      </NavButtons>\n    ),\n    [\n      format,\n      nextDisabled,\n      onChange,\n      onNextMonth,\n      onPrevMonth,\n      prevDisabled,\n      todayLabel,\n    ]\n  );\n  const Body = useMemo(\n    () => (\n      <main className={styles.monthViewBody}>\n        {/* weekDays */}\n        <div className={styles.monthViewRow}>\n          {weekDays.split(',').map(day => (\n            <div key={day} className={styles.monthViewHeaderCell}>\n              {day}\n            </div>\n          ))}\n        </div>\n        {/* Weeks in month */}\n        {matrix.map((week, i) => {\n          return (\n            <div key={i} className={styles.monthViewRow}>\n              {week.map((cell, j) => (\n                <div\n                  className={styles.monthViewBodyCell}\n                  key={j}\n                  onClick={() => onChange?.(cell.date.format(format))}\n                >\n                  {customDayRenderer ? (\n                    customDayRenderer(cell)\n                  ) : (\n                    <DefaultDateCell key={j} {...cell} />\n                  )}\n                </div>\n              ))}\n            </div>\n          );\n        })}\n      </main>\n    ),\n    [customDayRenderer, format, matrix, onChange, weekDays]\n  );\n\n  return (\n    <CalendarLayout\n      mode=\"day\"\n      ref={dayPickerRootRef}\n      length={7}\n      headerLeft={HeaderLeft}\n      headerRight={HeaderRight}\n      body={Body}\n    />\n  );\n});\n","import dayjs from 'dayjs';\nimport { memo, useCallback, useEffect, useMemo, useRef, useState } from 'react';\n\nimport * as styles from './calendar.css';\nimport { DATE_MAX, DATE_MIN } from './constants';\nimport { CalendarLayout, NavButtons } from './items';\nimport type { DatePickerModePanelProps } from './types';\n\nconst ROW_SIZE = 3;\n\nexport const MonthPicker = memo(function MonthPicker(\n  props: DatePickerModePanelProps\n) {\n  const { cursor, value, monthNames, onModeChange, onCursorChange } = props;\n  const dayPickerRootRef = useRef<HTMLDivElement>(null);\n\n  const [monthCursor, setMonthCursor] = useState(cursor.startOf('month'));\n\n  const closeMonthPicker = useCallback(\n    () => onModeChange?.('day'),\n    [onModeChange]\n  );\n\n  const onMonthChange = useCallback(\n    (m: dayjs.Dayjs) => {\n      onModeChange?.('day');\n      onCursorChange?.(m);\n    },\n    [onCursorChange, onModeChange]\n  );\n\n  const nextYear = useCallback(\n    () => setMonthCursor(prev => prev.add(1, 'year').startOf('year')),\n    []\n  );\n  const prevYear = useCallback(\n    () => setMonthCursor(prev => prev.subtract(1, 'year').startOf('year')),\n    []\n  );\n  const nextYearDisabled = useMemo(\n    () => monthCursor.isSame(DATE_MAX, 'year'),\n    [monthCursor]\n  );\n  const prevYearDisabled = useMemo(\n    () => monthCursor.isSame(DATE_MIN, 'year'),\n    [monthCursor]\n  );\n  const matrix = useMemo(() => {\n    const matrix = [];\n    let currentMonth = monthCursor.startOf('year');\n    while (currentMonth.isBefore(monthCursor.endOf('year'))) {\n      const month: DatePickerModePanelProps['cursor'][] = [];\n      for (let i = 0; i < ROW_SIZE; i++) {\n        month.push(currentMonth.clone());\n        currentMonth = currentMonth.add(1, 'month');\n      }\n      matrix.push(month);\n    }\n    return matrix;\n  }, [monthCursor]);\n\n  const focusCursor = useCallback(() => {\n    const div = dayPickerRootRef.current;\n    if (!div) return;\n    const focused = div.querySelector('[data-is-month-cell][tabindex=\"0\"]');\n    focused && (focused as HTMLElement).focus();\n  }, []);\n\n  // keyboard navigation\n  useEffect(() => {\n    const div = dayPickerRootRef.current;\n    if (!div) return;\n\n    const onKeyDown = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        e.preventDefault();\n        e.stopPropagation();\n        closeMonthPicker();\n        return;\n      }\n\n      if (!['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key))\n        return;\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      if (e.key === 'ArrowUp')\n        setMonthCursor(c => c.subtract(ROW_SIZE, 'month'));\n      if (e.key === 'ArrowDown') setMonthCursor(c => c.add(ROW_SIZE, 'month'));\n      if (e.key === 'ArrowLeft') setMonthCursor(c => c.subtract(1, 'month'));\n      if (e.key === 'ArrowRight') setMonthCursor(c => c.add(1, 'month'));\n      setTimeout(focusCursor);\n    };\n\n    div.addEventListener('keydown', onKeyDown);\n\n    return () => {\n      div.removeEventListener('keydown', onKeyDown);\n    };\n  }, [closeMonthPicker, focusCursor]);\n\n  const HeaderLeft = useMemo(() => {\n    return (\n      <button\n        data-testid=\"month-picker-current-year\"\n        onClick={closeMonthPicker}\n        className={styles.calendarHeaderTriggerButton}\n      >\n        {monthCursor.format('YYYY')}\n      </button>\n    );\n  }, [closeMonthPicker, monthCursor]);\n\n  const HeaderRight = useMemo(() => {\n    return (\n      <NavButtons\n        onNext={nextYear}\n        onPrev={prevYear}\n        prevDisabled={prevYearDisabled}\n        nextDisabled={nextYearDisabled}\n      />\n    );\n  }, [nextYear, nextYearDisabled, prevYear, prevYearDisabled]);\n\n  const Body = useMemo(() => {\n    return (\n      <div className={styles.yearViewBody}>\n        {matrix.map((row, i) => {\n          return (\n            <div key={i} className={styles.yearViewRow}>\n              {row.map((month, j) => {\n                return (\n                  <div key={j} className={styles.yearViewBodyCell}>\n                    <button\n                      data-value={month.format('YYYY-MM')}\n                      data-is-month-cell\n                      className={styles.yearViewBodyCellInner}\n                      data-selected={value && month.isSame(value, 'month')}\n                      data-current-month={month.isSame(dayjs(), 'month')}\n                      onClick={() => onMonthChange(month)}\n                      tabIndex={month.isSame(monthCursor, 'month') ? 0 : -1}\n                      aria-label={month.format('YYYY-MM')}\n                    >\n                      {monthNames.split(',')[month.month()]}\n                    </button>\n                  </div>\n                );\n              })}\n            </div>\n          );\n        })}\n      </div>\n    );\n  }, [matrix, monthCursor, monthNames, onMonthChange, value]);\n\n  return (\n    <CalendarLayout\n      mode=\"month\"\n      ref={dayPickerRootRef}\n      length={3}\n      headerLeft={HeaderLeft}\n      headerRight={HeaderRight}\n      body={Body}\n    />\n  );\n});\n","import type dayjs from 'dayjs';\nimport type { ReactNode } from 'react';\n\nexport interface DatePickerProps {\n  /**\n   * selected date value, format is defined by `format` prop\n   */\n  value?: string;\n\n  /**\n   * @default 'YYYY-MM-DD'\n   */\n  format?: string;\n\n  /**\n   * Customize the vertical gap between each row, in `px`\n   * @default 8\n   */\n  gapY?: number;\n\n  /**\n   * Customize the horizontal gap between each column, in `px`\n   * Attention: for responsive layout, this will only affect the minimum gap, the actual gap will be calculated based on the available space\n   * @default 8\n   */\n  gapX?: number;\n\n  /**\n   * Customize weekdays, use `,` to separate each day\n   * @default {} `'Su,Mo,Tu,We,Th,Fr,Sa'`\n   **/\n  weekDays?: string;\n\n  /**\n   * Customize month names\n   */\n  monthNames?: string;\n\n  /**\n   * Customize today label\n   */\n  todayLabel?: string;\n\n  /**\n   * Customize rendering of day cell\n   */\n  customDayRenderer?: (cell: DateCell) => ReactNode;\n\n  /**\n   * when date is clicked\n   */\n  onChange?: (value: string) => void;\n}\n\n/**\n * Date for a cell in the calendar\n */\nexport interface DateCell {\n  date: dayjs.Dayjs;\n  label: string;\n  isToday: boolean;\n  notCurrentMonth: boolean;\n  selected?: boolean;\n  focused?: boolean;\n}\n\nexport type SelectMode = 'day' | 'month' | 'year';\n\nexport const defaultDatePickerProps = {\n  format: 'YYYY-MM-DD',\n  gapX: 8,\n  gapY: 8,\n  weekDays: ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'].join(','),\n  monthNames: [\n    'Jan',\n    'Feb',\n    'Mar',\n    'Apr',\n    'May',\n    'Jun',\n    'Jul',\n    'Aug',\n    'Sep',\n    'Oct',\n    'Nov',\n    'Dec',\n  ].join(','),\n  todayLabel: 'Today',\n} satisfies Partial<DatePickerProps>;\nexport type DefaultDatePickerProps = typeof defaultDatePickerProps;\n\nexport interface DatePickerModePanelProps\n  extends DefaultDatePickerProps,\n    Omit<DatePickerProps, keyof DefaultDatePickerProps> {\n  cursor: dayjs.Dayjs;\n  onCursorChange?: (cursor: dayjs.Dayjs) => void;\n  onModeChange?: (mode: SelectMode) => void;\n}\n","import dayjs from 'dayjs';\nimport { memo, useCallback, useEffect, useMemo, useRef, useState } from 'react';\n\nimport * as styles from './calendar.css';\nimport { DATE_MAX, DATE_MIN, YEAR_MAX, YEAR_MIN } from './constants';\nimport { CalendarLayout, NavButtons } from './items';\nimport type { DatePickerModePanelProps } from './types';\n\nconst ROW_SIZE = 3;\nconst DECADE = 12;\n\nexport const YearPicker = memo(function YearPicker(\n  props: DatePickerModePanelProps\n) {\n  const { value, cursor, onModeChange, onCursorChange } = props;\n  const dayPickerRootRef = useRef<HTMLDivElement>(null);\n  const [yearCursor, setYearCursor] = useState(dayjs(cursor).startOf('year'));\n\n  const closeYearPicker = useCallback(\n    () => onModeChange?.('day'),\n    [onModeChange]\n  );\n\n  const onYearChange = useCallback(\n    (y: dayjs.Dayjs) => {\n      closeYearPicker();\n      onCursorChange?.(y);\n    },\n    [closeYearPicker, onCursorChange]\n  );\n\n  const nextDecade = useCallback(() => {\n    setYearCursor(prev => prev.add(DECADE, 'year').startOf('year'));\n  }, []);\n\n  const prevDecade = useCallback(() => {\n    setYearCursor(prev => prev.subtract(DECADE, 'year').startOf('year'));\n  }, []);\n\n  const decadeIndex = useMemo(\n    () => Math.floor((yearCursor.year() - YEAR_MIN) / DECADE),\n    [yearCursor]\n  );\n  const decadeStart = useMemo(\n    () => dayjs(DATE_MIN).add(decadeIndex * DECADE, 'year'),\n    [decadeIndex]\n  );\n  const decadeEnd = useMemo(\n    () => decadeStart.add(DECADE - 1, 'year'),\n    [decadeStart]\n  );\n  const nextDecadeDisabled = useMemo(\n    () => yearCursor.add(DECADE, 'year').isAfter(`${YEAR_MAX}-01-01`),\n    [yearCursor]\n  );\n  const prevDecadeDisabled = useMemo(() => decadeIndex <= 0, [decadeIndex]);\n\n  const matrix = useMemo(() => {\n    const matrix = [];\n\n    let currentYear = decadeStart.clone();\n    while (currentYear.isBefore(decadeEnd.add(1, 'year'))) {\n      const row = [];\n      for (let i = 0; i < ROW_SIZE; i++) {\n        row.push(currentYear.clone().startOf('year'));\n        currentYear = currentYear.add(1, 'year');\n      }\n      matrix.push(row);\n    }\n    return matrix;\n  }, [decadeEnd, decadeStart]);\n\n  const focusCursor = useCallback(() => {\n    const div = dayPickerRootRef.current;\n    if (!div) return;\n    const focused = div.querySelector('[data-is-year-cell][tabindex=\"0\"]');\n    focused && (focused as HTMLElement).focus();\n  }, []);\n\n  // keyboard navigation\n  useEffect(() => {\n    const div = dayPickerRootRef.current;\n    if (!div) return;\n\n    const onKeyDown = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        e.preventDefault();\n        e.stopPropagation();\n        closeYearPicker();\n        return;\n      }\n\n      if (!['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key))\n        return;\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      if (e.key === 'ArrowUp') setYearCursor(c => c.subtract(ROW_SIZE, 'year'));\n      if (e.key === 'ArrowDown') setYearCursor(c => c.add(ROW_SIZE, 'year'));\n      if (e.key === 'ArrowLeft') setYearCursor(c => c.subtract(1, 'year'));\n      if (e.key === 'ArrowRight') setYearCursor(c => c.add(1, 'year'));\n      setTimeout(focusCursor);\n    };\n\n    div.addEventListener('keydown', onKeyDown);\n\n    return () => {\n      div.removeEventListener('keydown', onKeyDown);\n    };\n  }, [closeYearPicker, focusCursor]);\n\n  const HeaderLeft = useMemo(() => {\n    return (\n      <button\n        onClick={closeYearPicker}\n        className={styles.calendarHeaderTriggerButton}\n      >\n        {decadeStart.year()}-{decadeEnd.year()}\n      </button>\n    );\n  }, [closeYearPicker, decadeEnd, decadeStart]);\n  const HeaderRight = useMemo(\n    () => (\n      <NavButtons\n        onNext={nextDecade}\n        onPrev={prevDecade}\n        nextDisabled={nextDecadeDisabled}\n        prevDisabled={prevDecadeDisabled}\n      />\n    ),\n    [nextDecade, nextDecadeDisabled, prevDecade, prevDecadeDisabled]\n  );\n  const Body = useMemo(() => {\n    return (\n      <div className={styles.decadeViewBody}>\n        {matrix.map((row, i) => {\n          return (\n            <div key={i} className={styles.decadeViewRow}>\n              {row.map((year, j) => {\n                const isDisabled =\n                  year.isAfter(DATE_MAX) || year.isBefore(DATE_MIN);\n                return (\n                  <div key={j} className={styles.decadeViewBodyCell}>\n                    <button\n                      aria-disabled={isDisabled}\n                      data-value={year.format('YYYY')}\n                      data-is-year-cell\n                      className={styles.decadeViewBodyCellInner}\n                      data-selected={value && year.isSame(value, 'year')}\n                      data-current-year={year.isSame(dayjs(), 'year')}\n                      tabIndex={year.isSame(yearCursor, 'year') ? 0 : -1}\n                      onClick={\n                        isDisabled ? undefined : () => onYearChange(year)\n                      }\n                    >\n                      {year.year()}\n                    </button>\n                  </div>\n                );\n              })}\n            </div>\n          );\n        })}\n      </div>\n    );\n  }, [matrix, onYearChange, value, yearCursor]);\n\n  return (\n    <CalendarLayout\n      mode=\"year\"\n      ref={dayPickerRootRef}\n      length={ROW_SIZE}\n      headerLeft={HeaderLeft}\n      headerRight={HeaderRight}\n      body={Body}\n    />\n  );\n});\n","import { assignInlineVars } from '@vanilla-extract/dynamic';\nimport dayjs from 'dayjs';\nimport { useCallback, useState } from 'react';\n\nimport * as styles from './calendar.css';\nimport { DATE_MAX, DATE_MIN } from './constants';\nimport { DayPicker } from './day-picker';\nimport { MonthPicker } from './month-picker';\nimport type { DatePickerProps, SelectMode } from './types';\nimport { defaultDatePickerProps } from './types';\nimport { YearPicker } from './year-picker';\n\nexport type { DatePickerProps } from './types';\n\n/**\n * Inline DatePicker\n * @returns\n */\nexport const DatePicker = (props: DatePickerProps) => {\n  const finalProps = { ...defaultDatePickerProps, ...props };\n  const { value, gapX, gapY, onChange } = finalProps;\n\n  const [mode, setMode] = useState<SelectMode>('day');\n  const [cursor, setCursor] = useState(dayjs(value));\n\n  const variables = assignInlineVars({\n    [styles.vars.gapX]: `${gapX}px`,\n    [styles.vars.gapY]: `${gapY}px`,\n  });\n  const Component =\n    mode === 'day' ? DayPicker : mode === 'month' ? MonthPicker : YearPicker;\n\n  const onPreChange = useCallback(\n    (v: string) => {\n      setMode('day');\n      setCursor(dayjs(v));\n      onChange?.(v);\n    },\n    [onChange]\n  );\n\n  const onCursorChange = useCallback((newCursor: dayjs.Dayjs) => {\n    // validate range\n    if (newCursor.isBefore(DATE_MIN)) newCursor = dayjs(DATE_MIN);\n    else if (newCursor.isAfter(DATE_MAX)) newCursor = dayjs(DATE_MAX);\n    setCursor(newCursor);\n  }, []);\n\n  return (\n    <div className={styles.calendarRoot} style={variables}>\n      <Component\n        cursor={cursor}\n        {...finalProps}\n        onChange={onPreChange}\n        onCursorChange={onCursorChange}\n        onModeChange={setMode}\n      />\n    </div>\n  );\n};\n","import type { ResizeObserverEntry } from '@juggle/resize-observer';\n\ntype ObserveResize = {\n  callback: (entity: ResizeObserverEntry) => void;\n  dispose: () => void;\n};\n\nlet _resizeObserver: ResizeObserver | null = null;\nconst elementsMap = new WeakMap<Element, Array<ObserveResize>>();\n\n// for debugging\n(window as any)._resizeObserverElementsMap = elementsMap;\n\n/**\n * @internal get or initialize the ResizeObserver instance\n */\nconst getResizeObserver = () =>\n  (_resizeObserver ??= new ResizeObserver(entries => {\n    entries.forEach(entry => {\n      const listeners = elementsMap.get(entry.target) ?? [];\n      listeners.forEach(({ callback }) => callback(entry));\n    });\n  }));\n\n/**\n * @internal remove element's specific listener\n */\nconst removeListener = (element: Element, listener: ObserveResize) => {\n  if (!element) return;\n  const listeners = elementsMap.get(element) ?? [];\n  const observer = getResizeObserver();\n  // remove the listener from the element\n  if (listeners.includes(listener)) {\n    elementsMap.set(\n      element,\n      listeners.filter(l => l !== listener)\n    );\n  }\n  // if no more listeners, unobserve the element\n  if (elementsMap.get(element)?.length === 0) {\n    observer.unobserve(element);\n    elementsMap.delete(element);\n  }\n};\n\n/**\n * A function to observe the resize of an element use global ResizeObserver.\n *\n * ```ts\n * useEffect(() => {\n *  const dispose1 = observeResize(elRef1.current, (entry) => {});\n *  const dispose2 = observeResize(elRef2.current, (entry) => {});\n *\n *  return () => {\n *   dispose1();\n *   dispose2();\n *  };\n * }, [])\n * ```\n * @return A function to dispose the observer.\n */\nexport const observeResize = (\n  element: Element,\n  callback: ObserveResize['callback']\n) => {\n  const observer = getResizeObserver();\n  if (!elementsMap.has(element)) {\n    observer.observe(element);\n  }\n  const prevListeners = elementsMap.get(element) ?? [];\n  const listener = { callback, dispose: () => {} };\n  listener.dispose = () => removeListener(element, listener);\n\n  elementsMap.set(element, [...prevListeners, listener]);\n\n  return listener.dispose;\n};\n","import { ArrowLeftSmallIcon, ArrowRightSmallIcon } from '@blocksuite/icons/rc';\nimport clsx from 'clsx';\nimport dayjs from 'dayjs';\nimport type { ForwardedRef, HTMLAttributes } from 'react';\nimport {\n  memo,\n  useCallback,\n  useEffect,\n  useImperativeHandle,\n  useLayoutEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\n\nimport { observeResize } from '../../utils';\nimport { IconButton } from '../button';\nimport * as styles from './week-date-picker.css';\n\nexport interface WeekDatePickerHandle {\n  /** control cursor manually */\n  setCursor?: (cursor: dayjs.Dayjs) => void;\n}\n\nexport interface WeekDatePickerProps\n  extends Omit<HTMLAttributes<HTMLDivElement>, 'onChange'> {\n  value?: string;\n  onChange?: (value: string) => void;\n  handleRef?: ForwardedRef<WeekDatePickerHandle>;\n}\n\n// TODO(catsjuice): i18n\nconst weekDays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\n// const weekDays = ['', '', '', '', '', '', ''];\nconst format = 'YYYY-MM-DD';\n\nexport const WeekDatePicker = memo(function WeekDatePicker({\n  value,\n  onChange,\n  className,\n  handleRef,\n  ...attrs\n}: WeekDatePickerProps) {\n  const weekRef = useRef<HTMLDivElement | null>(null);\n\n  const [cursor, setCursor] = useState(dayjs(value));\n  const [dense, setDense] = useState(false);\n  const [viewPortSize, setViewPortSize] = useState(7);\n\n  useImperativeHandle(handleRef, () => ({\n    setCursor,\n  }));\n\n  const range = useMemo(() => {\n    if (viewPortSize === 7) return [0, 7];\n    const cursorIndex = cursor.day();\n    let start = Math.max(0, cursorIndex - Math.floor(viewPortSize / 2));\n    const end = Math.min(7, start + viewPortSize);\n    if (end === 7) start = 7 - viewPortSize;\n    return [start, end];\n  }, [cursor, viewPortSize]);\n  const allDays = useMemo(\n    () =>\n      Array.from({ length: 7 }).map((_, index) =>\n        cursor.startOf('week').add(index, 'day').startOf('day')\n      ),\n    [cursor]\n  );\n  const displayDays = useMemo(() => allDays.slice(...range), [allDays, range]);\n\n  const onNext = useCallback(() => {\n    const viewPortSize = displayDays.length;\n    if (viewPortSize === 7) setCursor(c => c.add(1, 'week'));\n    else {\n      setCursor(c => {\n        // last day of week is visible, move to next weeks\n        if (\n          displayDays[displayDays.length - 1].isSame(c.endOf('week'), 'day')\n        ) {\n          return c\n            .add(1, 'week')\n            .startOf('week')\n            .add(Math.floor(viewPortSize / 2), 'day');\n        }\n        let nextDay = c.add(viewPortSize, 'day');\n        if (!nextDay.isSame(c, 'week')) nextDay = c.endOf('week');\n        return nextDay;\n      });\n    }\n  }, [displayDays]);\n  const onPrev = useCallback(() => {\n    const viewPortSize = displayDays.length;\n    if (viewPortSize === 7) setCursor(c => c.add(-1, 'week'));\n    else\n      setCursor(c => {\n        // first day of week is visible, move to prev weeks\n        if (displayDays[0].isSame(c.startOf('week'), 'day')) {\n          return c\n            .subtract(1, 'week')\n            .endOf('week')\n            .subtract(Math.floor(viewPortSize / 2) - 1, 'day');\n        }\n        let prevDay = c.add(-viewPortSize, 'day');\n        if (!prevDay.isSame(c, 'week')) prevDay = c.startOf('week');\n        return prevDay;\n      });\n  }, [displayDays]);\n  const onDayClick = useCallback(\n    (day: dayjs.Dayjs) => {\n      onChange?.(day.format(format));\n    },\n    [onChange]\n  );\n\n  // Observe weekRef to update viewPortSize\n  useEffect(() => {\n    const el = weekRef.current;\n    if (!el) return;\n\n    return observeResize(el, ({ contentRect: rect }) => {\n      const width = rect.width;\n      if (!width) return;\n\n      const minWidth = 30;\n      const gap = 4;\n      const viewPortCount = Math.floor(width / (minWidth + gap));\n      setViewPortSize(Math.max(1, Math.min(viewPortCount, 7)));\n      setDense(width < 300);\n    });\n  }, []);\n\n  // when value changes, reset cursor\n  useEffect(() => {\n    value && setCursor(dayjs(value));\n  }, [value]);\n\n  const focusCursorCell = useCallback(() => {\n    if (!weekRef.current) return;\n    const cursorCell = weekRef.current.querySelector(\n      'button[tabIndex=\"0\"]'\n    ) as HTMLButtonElement;\n    cursorCell?.focus();\n  }, []);\n\n  useLayoutEffect(() => {\n    if (!weekRef.current) return;\n    const el = weekRef.current;\n    const onKeyDown = (e: KeyboardEvent) => {\n      if (e.key !== 'ArrowLeft' && e.key !== 'ArrowRight') return;\n      e.preventDefault();\n      e.stopPropagation();\n      setCursor(cursor => cursor.add(e.key === 'ArrowLeft' ? -1 : 1, 'day'));\n      setTimeout(focusCursorCell);\n    };\n\n    el.addEventListener('keydown', onKeyDown);\n\n    return () => {\n      el.removeEventListener('keydown', onKeyDown);\n    };\n  }, [focusCursorCell, onNext, onPrev]);\n\n  return (\n    <div className={clsx(styles.weekDatePicker, className)} {...attrs}>\n      <IconButton onClick={onPrev}>\n        <ArrowLeftSmallIcon />\n      </IconButton>\n\n      <div ref={weekRef} className={styles.weekDatePickerContent}>\n        {displayDays.map(day => (\n          <Cell\n            key={day.toISOString()}\n            dense={dense}\n            value={value}\n            day={day}\n            cursor={cursor}\n            onClick={onDayClick}\n          />\n        ))}\n      </div>\n\n      <IconButton onClick={onNext}>\n        <ArrowRightSmallIcon />\n      </IconButton>\n    </div>\n  );\n});\n\ninterface CellProps {\n  dense: boolean;\n  day: dayjs.Dayjs;\n  cursor: dayjs.Dayjs;\n  value?: string;\n  onClick: (day: dayjs.Dayjs) => void;\n}\nconst Cell = ({ day, dense, value, cursor, onClick }: CellProps) => {\n  const isActive = day.format(format) === value;\n  const isCurrentMonth = day.month() === cursor.month();\n  const isToday = day.isSame(dayjs(), 'day');\n\n  const dayIndex = day.day();\n  const label = weekDays[dayIndex];\n\n  return (\n    <button\n      tabIndex={cursor.isSame(day, 'day') ? 0 : -1}\n      aria-label={day.format(format)}\n      data-active={isActive}\n      data-curr-month={isCurrentMonth}\n      data-today={isToday}\n      data-value={day.format(format)}\n      key={day.toISOString()}\n      className={styles.dayCell}\n      onClick={() => onClick(day)}\n    >\n      <div className={styles.dayCellWeek}>\n        {dense ? label.slice(0, 1) : label}\n      </div>\n      <div className={styles.dayCellDate}>{day.format('D')}</div>\n    </button>\n  );\n};\n","import \"../component/src/ui/date-picker/week-date-picker.css.tsx.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/ui/date-picker/week-date-picker.css.tsx.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACpVU227bMAx9z1cIAQY0QFXYaTugCvYlwx5kibbZKZIh0XHSYf8+SL43QdshD0EOGZ5D8ogPp6qjly5jfzaMaQyNkRfBSgPnw4YxabCyHAmOQTAFlsBHuJKNYE9NSqkBq5oEy7PsW/x9lGc+Yo8vMefv5qEnyRNJh5pqwbKYHHkEyw+fcgfyQKqO+GsbCMsLV84SWBIsNFIBL4A6APteXhvA8wAGFAlmnYWFnn3S07iAhM4K5sFIwhMcbqjklXfdIPWIlg/xx6yniV0PUD5iqvXBecEah+PgrppMpTV6UL0E5Ux7tB+M/qr7OdRIrdFWgu2bc2yf5f13jBXOa/DcS41tmIZTOku8lEc0F8FO0t9xLssSLfBFZDdldsNan7NswgK+gWD5frXovajdCXwabyHV78q71mqunInzWBGlxD6yW1b4qSVJTk7Ly48t+Ra2v4R1dNfjUsU9jYFdIuJcgTE3SQovR/obJOtin9VqWg+8q5EgDWZu74ucQhRQOg/3bEZkScO0prVut4eVN2URnGkpeRNtABq8+cbR6ukRDVbjcAJLYTT81frR1uCRYsQ1UiFdUrVrkf0G3ZmHWuro/yx9osG+2OzcWq9BJFcGZ1B/sUTpVBv4CQMWBlbCZu0Pzx/9ZdYw/SNf5D8uz9J4xqaz9r1/KiaZ9R1IcCaeHuryHSY02ro0cWTKYJMuSvQMT8cqLqbzMsFzYo1a9wds5bvZiffriSWeAMpZLf1lGN1ydk8fNbbPbjQ2grcb+w9ZjcfjWtQ/RuJ0eGkGAAA=\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var dayCell = 'vgwt9w2';\nexport var dayCellDate = 'vgwt9w4';\nexport var dayCellWeek = 'vgwt9w3';\nexport var weekDatePicker = 'vgwt9w0';\nexport var weekDatePickerContent = 'vgwt9w1';","import { draggable } from '@atlaskit/pragmatic-drag-and-drop/element/adapter';\nimport { centerUnderPointer } from '@atlaskit/pragmatic-drag-and-drop/element/center-under-pointer';\nimport { disableNativeDragPreview } from '@atlaskit/pragmatic-drag-and-drop/element/disable-native-drag-preview';\nimport { pointerOutsideOfPreview } from '@atlaskit/pragmatic-drag-and-drop/element/pointer-outside-of-preview';\nimport { preserveOffsetOnSource } from '@atlaskit/pragmatic-drag-and-drop/element/preserve-offset-on-source';\nimport { setCustomNativeDragPreview } from '@atlaskit/pragmatic-drag-and-drop/element/set-custom-native-drag-preview';\nimport type { DropTargetRecord } from '@atlaskit/pragmatic-drag-and-drop/types';\nimport { useEffect, useMemo, useRef, useState } from 'react';\nimport ReactDOM, { flushSync } from 'react-dom';\n\nimport type { DNDData } from './types';\n\ntype DraggableGetFeedback = Parameters<\n  NonNullable<Parameters<typeof draggable>[0]['getInitialData']>\n>[0];\n\ntype DraggableGet<T> = T | ((data: DraggableGetFeedback) => T);\n\nfunction draggableGet<T>(\n  get: T\n): T extends undefined\n  ? undefined\n  : T extends DraggableGet<infer I>\n    ? (args: DraggableGetFeedback) => I\n    : never {\n  if (get === undefined) {\n    return undefined as any;\n  }\n  return ((args: DraggableGetFeedback) =>\n    typeof get === 'function' ? (get as any)(args) : get) as any;\n}\n\nexport interface DraggableOptions<D extends DNDData = DNDData> {\n  data?: DraggableGet<D['draggable']>;\n  dataForExternal?: DraggableGet<{\n    [Key in\n      | 'text/uri-list'\n      | 'text/plain'\n      | 'text/html'\n      | 'Files'\n      // eslint-disable-next-line @typescript-eslint/ban-types\n      | (string & {})]?: string;\n  }>;\n  canDrag?: DraggableGet<boolean>;\n  disableDragPreview?: boolean;\n  dragPreviewPosition?: DraggableDragPreviewPosition;\n}\n\nexport type DraggableDragPreviewPosition =\n  | 'pointer-outside'\n  | 'pointer-center'\n  | 'native';\n\nexport type DraggableCustomDragPreviewProps = React.PropsWithChildren<{\n  position?: DraggableDragPreviewPosition;\n}>;\n\nexport const useDraggable = <D extends DNDData = DNDData>(\n  getOptions: () => DraggableOptions<D> = () => ({}),\n  deps: any[] = []\n) => {\n  const [dragging, setDragging] = useState<boolean>(false);\n  const [draggingPosition, setDraggingPosition] = useState<{\n    offsetX: number;\n    offsetY: number;\n    clientX: number;\n    clientY: number;\n    outWindow: boolean;\n  }>({ offsetX: 0, offsetY: 0, clientX: 0, clientY: 0, outWindow: false });\n  const [dropTarget, setDropTarget] = useState<\n    (DropTargetRecord & { data: D['dropTarget'] })[]\n  >([]);\n  const [customDragPreviewPortal, setCustomDragPreviewPortal] = useState<\n    React.FC<DraggableCustomDragPreviewProps>\n  >(() => () => null);\n\n  const dragRef = useRef<any>(null);\n  const dragHandleRef = useRef<any>(null);\n\n  const enableCustomDragPreview = useRef(false);\n  const enableDraggingPosition = useRef(false);\n  const enableDropTarget = useRef(false);\n  const enableDragging = useRef(false);\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const options = useMemo(getOptions, deps);\n\n  useEffect(() => {\n    if (!dragRef.current) {\n      return;\n    }\n\n    const windowEvent = {\n      dragleave: () => {\n        setDraggingPosition(state =>\n          state.outWindow === true ? state : { ...state, outWindow: true }\n        );\n      },\n      dragover: () => {\n        setDraggingPosition(state =>\n          state.outWindow === true ? { ...state, outWindow: false } : state\n        );\n      },\n    };\n\n    const cleanupDraggable = draggable({\n      element: dragRef.current,\n      dragHandle: dragHandleRef.current ?? undefined,\n      canDrag: draggableGet(options.canDrag),\n      getInitialData: draggableGet(options.data),\n      getInitialDataForExternal: draggableGet(options.dataForExternal),\n      onDragStart: args => {\n        if (enableDragging.current) {\n          setDragging(true);\n        }\n        if (enableDraggingPosition.current) {\n          document.body.addEventListener('dragleave', windowEvent.dragleave);\n          document.body.addEventListener('dragover', windowEvent.dragover);\n          setDraggingPosition({\n            offsetX: 0,\n            offsetY: 0,\n            clientX: args.location.initial.input.clientX,\n            clientY: args.location.initial.input.clientY,\n            outWindow: false,\n          });\n        }\n        if (enableDropTarget.current) {\n          setDropTarget([]);\n        }\n        if (dragRef.current) {\n          dragRef.current.dataset['dragging'] = 'true';\n        }\n      },\n      onDrop: () => {\n        if (enableDragging.current) {\n          setDragging(false);\n        }\n        if (enableDraggingPosition.current) {\n          document.body.removeEventListener('dragleave', windowEvent.dragleave);\n          document.body.removeEventListener('dragover', windowEvent.dragover);\n          setDraggingPosition({\n            offsetX: 0,\n            offsetY: 0,\n            clientX: 0,\n            clientY: 0,\n            outWindow: false,\n          });\n        }\n        if (enableDropTarget.current) {\n          setDropTarget([]);\n        }\n        if (dragRef.current) {\n          delete dragRef.current.dataset['dragging'];\n        }\n      },\n      onDrag: args => {\n        if (enableDraggingPosition.current) {\n          setDraggingPosition(prev => ({\n            offsetX:\n              args.location.current.input.clientX -\n              args.location.initial.input.clientX,\n            offsetY:\n              args.location.current.input.clientY -\n              args.location.initial.input.clientY,\n            clientX: args.location.current.input.clientX,\n            clientY: args.location.current.input.clientY,\n            outWindow: prev.outWindow,\n          }));\n        }\n      },\n      onDropTargetChange(args) {\n        if (enableDropTarget.current) {\n          setDropTarget(args.location.current.dropTargets);\n        }\n      },\n      onGenerateDragPreview({ nativeSetDragImage, source, location }) {\n        if (options.disableDragPreview) {\n          disableNativeDragPreview({ nativeSetDragImage });\n          return;\n        }\n\n        let previewPosition: DraggableDragPreviewPosition =\n          options.dragPreviewPosition ?? 'native';\n\n        if (enableCustomDragPreview.current) {\n          setCustomNativeDragPreview({\n            getOffset: (...args) => {\n              if (previewPosition === 'pointer-center') {\n                return centerUnderPointer(...args);\n              } else if (previewPosition === 'pointer-outside') {\n                return pointerOutsideOfPreview({\n                  x: '8px',\n                  y: '4px',\n                })(...args);\n              } else {\n                return preserveOffsetOnSource({\n                  element: source.element,\n                  input: location.current.input,\n                })(...args);\n              }\n            },\n            render({ container }) {\n              flushSync(() => {\n                setCustomDragPreviewPortal(\n                  () =>\n                    ({\n                      children,\n                      position,\n                    }: DraggableCustomDragPreviewProps) => {\n                      previewPosition = position || previewPosition;\n                      return ReactDOM.createPortal(children, container);\n                    }\n                );\n              });\n              return () => setCustomDragPreviewPortal(() => () => null);\n            },\n            nativeSetDragImage,\n          });\n        } else if (previewPosition !== 'native') {\n          setCustomNativeDragPreview({\n            getOffset: (...args) => {\n              if (previewPosition === 'pointer-center') {\n                return centerUnderPointer(...args);\n              } else if (previewPosition === 'pointer-outside') {\n                return pointerOutsideOfPreview({\n                  x: '8px',\n                  y: '4px',\n                })(...args);\n              } else {\n                return preserveOffsetOnSource({\n                  element: source.element,\n                  input: location.current.input,\n                })(...args);\n              }\n            },\n            render({ container }) {\n              container.append(source.element.cloneNode(true));\n            },\n            nativeSetDragImage,\n          });\n        }\n      },\n    });\n\n    return () => {\n      window.removeEventListener('dragleave', windowEvent.dragleave);\n      window.removeEventListener('dragover', windowEvent.dragover);\n      cleanupDraggable();\n    };\n  }, [options]);\n\n  return {\n    get dragging() {\n      enableDragging.current = true;\n      return dragging;\n    },\n    get draggingPosition() {\n      enableDraggingPosition.current = true;\n      return draggingPosition;\n    },\n    get CustomDragPreview() {\n      enableCustomDragPreview.current = true;\n      return customDragPreviewPortal;\n    },\n    get dropTarget() {\n      enableDropTarget.current = true;\n      return dropTarget;\n    },\n    dragRef,\n    dragHandleRef,\n  };\n};\n","import \"../component/src/ui/dnd/drop-indicator.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/ui/dnd/drop-indicator.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACr1V7W7jIBD8n6dYVTopaUtq56Pt0Yc5YRsnqAQsTHpJTn33k8GuAWOriU73z4bdndlhYJe/0v36snnerOHPDACh7j/B8Fqd3mYAlayZZlJgIFkt+VHTZlXLCkPSfCm22+v2m9NSY/ggat5XShfNTia1loc2rJJMaKoQ/aBC1xiEFPRt9jlbfrHBOKOlVNSwyqXQVGgMd3dNdsHqipMzhozL/H2c4gUxUdAThpUlcEI1uzCxw5BJVVCFMmka/M0KvQ9ZJ4b1ntrmYnu2V9NPRvL3nZJHUWDQioi6IooKbWENVC65VGGd1cKJaFmsrOjtoiIFO9YYtskPZ7XWZ04x1JKzIpSNlJqqf6JaGnYWI29FyAnP56FG8AQrT8S2td4vDvONd+C9uYyapVSHVlhONJ0bOJQst3A/OJnFI0xuL0LYXjCDitKGpROy9Zh5Nr6Z3Le4bV1uHe6A3rPZ/m93tPOgOU3rwClTd/5dB6xfDOvAGBNeerJVo9Z58Q7IKYLSmMhe7qvJ8a+eUW2KhSOTW2ro4O+yIH2KH/gziLsGAh4grU5+gcwkqtibFkBlHlSbcR1Y7hl3Ei2P3rHr4Arn+CfBiqv8EoOio7Pytkd29KoNHl9SlkxQVCl2IOpsp0rAbWpy3jjpxkdnvLvuiRho6b4XI63ER9/nXza3UZmoCAAA\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var bottom = '_1h3z464c';\nexport var edgeLine = '_1h3z464e';\nexport var horizontal = '_1h3z4647';\nexport var horizontalIndent = 'var(--_1h3z4641)';\nexport var indicatorColor = 'var(--_1h3z4642)';\nexport var left = '_1h3z464d';\nexport var lineAboveStyles = '_1h3z4644';\nexport var lineBelowStyles = '_1h3z4645';\nexport var localLineOffset = 'var(--_1h3z4649)';\nexport var outlineStyles = '_1h3z4646';\nexport var right = '_1h3z464b';\nexport var terminalSize = 'var(--_1h3z4640)';\nexport var top = '_1h3z464a';\nexport var treeLine = '_1h3z4643';\nexport var vertical = '_1h3z4648';","import type { Edge } from '@atlaskit/pragmatic-drag-and-drop-hitbox/closest-edge';\nimport type { Instruction } from '@atlaskit/pragmatic-drag-and-drop-hitbox/tree-item';\nimport { cssVar } from '@toeverything/theme';\nimport { assignInlineVars } from '@vanilla-extract/dynamic';\nimport clsx from 'clsx';\nimport { type ReactElement } from 'react';\n\nimport * as styles from './drop-indicator.css';\n\nexport type DropIndicatorProps = {\n  instruction?: Instruction | null;\n  edge?: Edge | null;\n};\n\nfunction getTreeElement({\n  instruction,\n  isBlocked,\n}: {\n  instruction: Exclude<Instruction, { type: 'instruction-blocked' }>;\n  isBlocked: boolean;\n}): ReactElement | null {\n  const style = {\n    [styles.horizontalIndent]: `${instruction.currentLevel * instruction.indentPerLevel}px`,\n    [styles.indicatorColor]: !isBlocked\n      ? cssVar('--affine-primary-color')\n      : cssVar('--affine-warning-color'),\n  };\n\n  if (instruction.type === 'reorder-above') {\n    return (\n      <div\n        className={clsx(styles.treeLine, styles.lineAboveStyles)}\n        style={assignInlineVars(style)}\n      />\n    );\n  }\n  if (instruction.type === 'reorder-below') {\n    return (\n      <div\n        className={clsx(styles.treeLine, styles.lineBelowStyles)}\n        style={assignInlineVars(style)}\n      />\n    );\n  }\n\n  if (instruction.type === 'make-child') {\n    return (\n      <div\n        className={clsx(styles.outlineStyles)}\n        style={assignInlineVars(style)}\n      />\n    );\n  }\n\n  if (instruction.type === 'reparent') {\n    style[styles.horizontalIndent] = `${\n      instruction.desiredLevel * instruction.indentPerLevel\n    }px`;\n\n    return (\n      <div\n        className={clsx(styles.treeLine, styles.lineBelowStyles)}\n        style={assignInlineVars(style)}\n      />\n    );\n  }\n  return null;\n}\n\ntype Orientation = 'horizontal' | 'vertical';\n\nconst edgeToOrientationMap: Record<Edge, Orientation> = {\n  top: 'horizontal',\n  bottom: 'horizontal',\n  left: 'vertical',\n  right: 'vertical',\n};\n\nconst orientationStyles: Record<Orientation, string> = {\n  horizontal: styles.horizontal,\n  vertical: styles.vertical,\n};\n\nconst edgeStyles: Record<Edge, string> = {\n  top: styles.top,\n  bottom: styles.bottom,\n  left: styles.left,\n  right: styles.right,\n};\n\nfunction getEdgeElement(edge: Edge, gap: number = 0) {\n  const lineOffset = `calc(-0.5 * (${gap}px + 2px))`;\n\n  const orientation = edgeToOrientationMap[edge];\n\n  return (\n    <div\n      className={clsx([\n        styles.edgeLine,\n        orientationStyles[orientation],\n        edgeStyles[edge],\n      ])}\n      style={assignInlineVars({ [styles.localLineOffset]: lineOffset })}\n    />\n  );\n}\n\nexport function DropIndicator({ instruction, edge }: DropIndicatorProps) {\n  if (edge) {\n    return getEdgeElement(edge, 0);\n  }\n  if (instruction) {\n    if (instruction.type === 'instruction-blocked') {\n      return getTreeElement({\n        instruction: instruction.desired,\n        isBlocked: true,\n      });\n    }\n    return getTreeElement({ instruction, isBlocked: false });\n  }\n  return;\n}\n","import { dropTargetForElements } from '@atlaskit/pragmatic-drag-and-drop/element/adapter';\nimport {\n  attachClosestEdge,\n  type Edge,\n  extractClosestEdge,\n} from '@atlaskit/pragmatic-drag-and-drop-hitbox/closest-edge';\nimport {\n  attachInstruction,\n  extractInstruction,\n  type Instruction,\n  type ItemMode,\n} from '@atlaskit/pragmatic-drag-and-drop-hitbox/tree-item';\nimport { useEffect, useMemo, useRef, useState } from 'react';\n\nimport type { DNDData } from './types';\n\ntype DropTargetGetFeedback<D extends DNDData> = Parameters<\n  NonNullable<Parameters<typeof dropTargetForElements>[0]['canDrop']>\n>[0] & {\n  source: {\n    data: D['draggable'];\n  };\n} & {\n  treeInstruction: Instruction | null;\n  closestEdge: Edge | null;\n};\n\ntype DropTargetGet<T, D extends DNDData> =\n  | T\n  | ((data: DropTargetGetFeedback<D>) => T);\n\nfunction dropTargetGet<T, D extends DNDData>(\n  get: T,\n  options: DropTargetOptions<D>\n): T extends undefined\n  ? undefined\n  : T extends DropTargetGet<infer I, D>\n    ? (\n        args: Omit<DropTargetGetFeedback<D>, 'treeInstruction' | 'closestEdge'>\n      ) => I\n    : never {\n  if (get === undefined) {\n    return undefined as any;\n  }\n  return ((\n    args: Omit<DropTargetGetFeedback<D>, 'treeInstruction' | 'closestEdge'>\n  ) => {\n    if (typeof get === 'function') {\n      return (get as any)({\n        ...args,\n        get treeInstruction() {\n          return options.treeInstruction\n            ? extractInstruction(\n                attachInstruction(\n                  {},\n                  {\n                    input: args.input,\n                    element: args.element,\n                    currentLevel: options.treeInstruction.currentLevel,\n                    indentPerLevel: options.treeInstruction.indentPerLevel,\n                    mode: options.treeInstruction.mode,\n                    block: options.treeInstruction.block,\n                  }\n                )\n              )\n            : null;\n        },\n        get closestEdge() {\n          return options.closestEdge\n            ? extractClosestEdge(\n                attachClosestEdge(\n                  {},\n                  {\n                    input: args.input,\n                    element: args.element,\n                    allowedEdges: options.closestEdge.allowedEdges,\n                  }\n                )\n              )\n            : null;\n        },\n      });\n    } else {\n      return get;\n    }\n  }) as any;\n}\n\nexport type DropTargetDropEvent<D extends DNDData> = Parameters<\n  NonNullable<Parameters<typeof dropTargetForElements>[0]['onDrop']>\n>[0] & { treeInstruction: Instruction | null; closestEdge: Edge | null } & {\n  source: { data: D['draggable'] };\n};\n\nexport type DropTargetDragEvent<D extends DNDData> = Parameters<\n  NonNullable<Parameters<typeof dropTargetForElements>[0]['onDrag']>\n>[0] & { treeInstruction: Instruction | null; closestEdge: Edge | null } & {\n  source: { data: D['draggable'] };\n};\n\nexport type DropTargetTreeInstruction = Instruction;\n\nexport interface DropTargetOptions<D extends DNDData = DNDData> {\n  data?: DropTargetGet<D['dropTarget'], D>;\n  canDrop?: DropTargetGet<boolean, D>;\n  dropEffect?: DropTargetGet<'copy' | 'link' | 'move', D>;\n  isSticky?: DropTargetGet<boolean, D>;\n  treeInstruction?: {\n    block?: Instruction['type'][];\n    mode: ItemMode;\n    currentLevel: number;\n    indentPerLevel: number;\n  };\n  closestEdge?: {\n    allowedEdges: Edge[];\n  };\n  onDrop?: (data: DropTargetDropEvent<D>) => void;\n  onDrag?: (data: DropTargetDragEvent<D>) => void;\n}\n\nexport const useDropTarget = <D extends DNDData = DNDData>(\n  getOptions: () => DropTargetOptions<D> = () => ({}),\n  deps: any[] = []\n) => {\n  const dropTargetRef = useRef<any>(null);\n  const [draggedOver, setDraggedOver] = useState<boolean>(false);\n  const [treeInstruction, setTreeInstruction] = useState<Instruction | null>(\n    null\n  );\n  const [closestEdge, setClosestEdge] = useState<Edge | null>(null);\n  const [dropEffect, setDropEffect] = useState<'copy' | 'link' | 'move' | null>(\n    null\n  );\n  const [draggedOverDraggable, setDraggedOverDraggable] = useState<{\n    data: D['draggable'];\n  } | null>(null);\n  const [draggedOverPosition, setDraggedOverPosition] = useState<{\n    /**\n     * relative position to the drop target element top-left corner\n     */\n    relativeX: number;\n    relativeY: number;\n    clientX: number;\n    clientY: number;\n  }>({ relativeX: 0, relativeY: 0, clientX: 0, clientY: 0 });\n\n  const enableDraggedOver = useRef(false);\n  const enableDraggedOverDraggable = useRef(false);\n  const enableDraggedOverPosition = useRef(false);\n  const enableDropEffect = useRef(false);\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const options = useMemo(getOptions, deps);\n\n  useEffect(() => {\n    if (!dropTargetRef.current) {\n      return;\n    }\n    return dropTargetForElements({\n      element: dropTargetRef.current,\n      canDrop: dropTargetGet(options.canDrop, options),\n      getDropEffect: dropTargetGet(options.dropEffect, options),\n      getIsSticky: dropTargetGet(options.isSticky, options),\n      onDrop: args => {\n        if (enableDraggedOver.current) {\n          setDraggedOver(false);\n        }\n        if (enableDraggedOverDraggable.current) {\n          setDraggedOverDraggable(null);\n        }\n        if (enableDraggedOverPosition.current) {\n          setDraggedOverPosition({\n            relativeX: 0,\n            relativeY: 0,\n            clientX: 0,\n            clientY: 0,\n          });\n        }\n        if (options.treeInstruction) {\n          setTreeInstruction(null);\n          if (dropTargetRef.current) {\n            delete dropTargetRef.current.dataset['treeInstruction'];\n          }\n        }\n        if (options.closestEdge) {\n          setClosestEdge(null);\n        }\n        if (enableDropEffect.current) {\n          setDropEffect(null);\n        }\n        if (dropTargetRef.current) {\n          delete dropTargetRef.current.dataset['draggedOver'];\n        }\n        if (\n          args.location.current.dropTargets[0]?.element ===\n          dropTargetRef.current\n        ) {\n          options.onDrop?.({\n            ...args,\n            treeInstruction: extractInstruction(args.self.data),\n            closestEdge: extractClosestEdge(args.self.data),\n          } as DropTargetDropEvent<D>);\n        }\n      },\n      getData: args => {\n        const originData = dropTargetGet(options.data ?? {}, options)(args);\n        const { input, element } = args;\n        const withInstruction = options.treeInstruction\n          ? attachInstruction(originData, {\n              input,\n              element,\n              currentLevel: options.treeInstruction.currentLevel,\n              indentPerLevel: options.treeInstruction.indentPerLevel,\n              mode: options.treeInstruction.mode,\n              block: options.treeInstruction.block,\n            })\n          : originData;\n        const withClosestEdge = options.closestEdge\n          ? attachClosestEdge(withInstruction, {\n              element,\n              input,\n              allowedEdges: options.closestEdge.allowedEdges,\n            })\n          : withInstruction;\n        return withClosestEdge;\n      },\n      onDrag: args => {\n        if (\n          args.location.current.dropTargets[0]?.element ===\n          dropTargetRef.current\n        ) {\n          if (enableDraggedOverDraggable.current) {\n            setDraggedOverDraggable({ data: args.source.data });\n          }\n          let instruction = null;\n          let closestEdge = null;\n          if (options.treeInstruction) {\n            instruction = extractInstruction(args.self.data);\n            setTreeInstruction(instruction);\n            if (dropTargetRef.current) {\n              dropTargetRef.current.dataset['treeInstruction'] =\n                instruction?.type;\n            }\n          }\n          if (options.closestEdge) {\n            closestEdge = extractClosestEdge(args.self.data);\n            setClosestEdge(closestEdge);\n          }\n          if (enableDropEffect.current) {\n            setDropEffect(args.self.dropEffect);\n          }\n          if (enableDraggedOverPosition.current) {\n            const rect = args.self.element.getBoundingClientRect();\n            const { clientX, clientY } = args.location.current.input;\n            setDraggedOverPosition({\n              relativeX: clientX - rect.x,\n              relativeY: clientY - rect.y,\n              clientX: clientX,\n              clientY: clientY,\n            });\n          }\n          options.onDrag?.({\n            ...args,\n            treeInstruction: instruction,\n            closestEdge,\n          } as DropTargetDropEvent<D>);\n        }\n      },\n      onDropTargetChange: args => {\n        if (\n          args.location.current.dropTargets[0]?.element ===\n          dropTargetRef.current\n        ) {\n          if (enableDraggedOver.current) {\n            setDraggedOver(true);\n          }\n          if (options.treeInstruction) {\n            const instruction = extractInstruction(args.self.data);\n            setTreeInstruction(instruction);\n            if (dropTargetRef.current) {\n              dropTargetRef.current.dataset['treeInstruction'] =\n                instruction?.type;\n            }\n          }\n          if (options.closestEdge) {\n            const closestEdge = extractClosestEdge(args.self.data);\n            setClosestEdge(closestEdge);\n          }\n          if (enableDropEffect.current) {\n            setDropEffect(args.self.dropEffect);\n          }\n          if (enableDraggedOverDraggable.current) {\n            setDraggedOverDraggable({ data: args.source.data });\n          }\n          if (enableDraggedOverPosition.current) {\n            const rect = args.self.element.getBoundingClientRect();\n            setDraggedOverPosition({\n              relativeX: args.location.current.input.clientX - rect.x,\n              relativeY: args.location.current.input.clientY - rect.y,\n              clientX: args.location.current.input.clientX,\n              clientY: args.location.current.input.clientY,\n            });\n          }\n          if (dropTargetRef.current) {\n            dropTargetRef.current.dataset['draggedOver'] = 'true';\n          }\n        } else {\n          if (enableDraggedOver.current) {\n            setDraggedOver(false);\n          }\n          if (enableDraggedOverDraggable.current) {\n            setDraggedOverDraggable(null);\n          }\n          if (options.treeInstruction) {\n            setTreeInstruction(null);\n            if (dropTargetRef.current) {\n              delete dropTargetRef.current.dataset['treeInstruction'];\n            }\n          }\n          if (enableDropEffect.current) {\n            setDropEffect(args.self.dropEffect);\n          }\n          if (enableDraggedOverPosition.current) {\n            setDraggedOverPosition({\n              relativeX: 0,\n              relativeY: 0,\n              clientX: 0,\n              clientY: 0,\n            });\n          }\n          if (options.closestEdge) {\n            setClosestEdge(null);\n          }\n          if (dropTargetRef.current) {\n            delete dropTargetRef.current.dataset['draggedOver'];\n          }\n        }\n      },\n    });\n  }, [options]);\n\n  return {\n    dropTargetRef,\n    get draggedOver() {\n      enableDraggedOver.current = true;\n      return draggedOver;\n    },\n    get draggedOverDraggable() {\n      enableDraggedOverDraggable.current = true;\n      return draggedOverDraggable;\n    },\n    get draggedOverPosition() {\n      enableDraggedOverPosition.current = true;\n      return draggedOverPosition;\n    },\n    get dropEffect() {\n      enableDropEffect.current = true;\n      return dropEffect;\n    },\n    treeInstruction,\n    closestEdge,\n  };\n};\n","import clsx from 'clsx';\nimport type {\n  CSSProperties,\n  ForwardedRef,\n  HTMLAttributes,\n  KeyboardEvent,\n  PropsWithChildren,\n} from 'react';\nimport {\n  useCallback,\n  useEffect,\n  useImperativeHandle,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\n\nimport Input from '../input';\nimport * as styles from './inline-edit.css';\n\nexport interface InlineEditHandle {\n  triggerEdit: () => void;\n}\n\nexport interface InlineEditProps\n  extends Omit<HTMLAttributes<HTMLSpanElement>, 'onChange' | 'onInput'> {\n  /**\n   * Content to be displayed\n   */\n  value?: string;\n  /**\n   * Whether the content is editable\n   */\n  editable?: boolean;\n  /**\n   * Whether to exit when pressing `Escape`\n   */\n  exitible?: boolean;\n\n  onInput?: (v: string) => void;\n  onChange?: (v: string) => void;\n\n  /**\n   * Trigger edit by `click` or `doubleClick`\n   * @default `'doubleClick'`\n   */\n  trigger?: 'click' | 'doubleClick';\n\n  /**\n   * whether to auto select all text when trigger edit\n   */\n  autoSelect?: boolean;\n\n  /**\n   * Placeholder when value is empty\n   */\n  placeholder?: string;\n  /**\n   * Custom placeholder `className`\n   */\n  placeholderClassName?: string;\n  /**\n   * Custom placeholder `style`\n   */\n  placeholderStyle?: CSSProperties;\n\n  handleRef?: ForwardedRef<InlineEditHandle>;\n\n  /**\n   * Customize attrs for the input\n   */\n  inputAttrs?: Omit<HTMLAttributes<HTMLInputElement>, 'onChange' | 'onBlur'>;\n}\n\nexport const InlineEdit = ({\n  value,\n  editable,\n  exitible,\n  className,\n  style,\n  trigger = 'doubleClick',\n  autoSelect,\n\n  onInput,\n  onChange,\n\n  placeholder,\n  placeholderClassName,\n  placeholderStyle,\n\n  handleRef,\n  inputAttrs,\n\n  ...attrs\n}: InlineEditProps) => {\n  const [editing, setEditing] = useState(false);\n  const [editingValue, setEditingValue] = useState(value);\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  useImperativeHandle<InlineEditHandle, InlineEditHandle>(handleRef, () => ({\n    triggerEdit,\n  }));\n\n  const triggerEdit = useCallback(() => {\n    if (!editable) return;\n    setEditing(true);\n    setTimeout(() => {\n      inputRef.current?.focus();\n      autoSelect && inputRef.current?.select();\n    }, 0);\n  }, [autoSelect, editable]);\n\n  const onDoubleClick = useCallback(() => {\n    if (trigger !== 'doubleClick') return;\n    triggerEdit();\n  }, [triggerEdit, trigger]);\n\n  const onClick = useCallback(() => {\n    if (trigger !== 'click') return;\n    triggerEdit();\n  }, [triggerEdit, trigger]);\n\n  const submit = useCallback(() => {\n    onChange?.(editingValue || '');\n  }, [editingValue, onChange]);\n\n  const onEnter = useCallback(() => {\n    inputRef.current?.blur();\n  }, []);\n\n  const onBlur = useCallback(() => {\n    setEditing(false);\n    submit();\n    // to reset input's scroll position to match actual display\n    inputRef.current?.scrollTo(0, 0);\n  }, [submit]);\n\n  const onKeyDown = useCallback(\n    (e: KeyboardEvent<HTMLInputElement>) => {\n      e.stopPropagation();\n      if (!exitible) return;\n      if (e.key !== 'Escape') return;\n      inputRef.current?.blur();\n    },\n    [exitible]\n  );\n\n  const inputHandler = useCallback(\n    (v: string) => {\n      setEditingValue(v);\n      onInput?.(v);\n    },\n    [onInput]\n  );\n\n  // update editing value when value prop changes\n  useEffect(() => {\n    setEditingValue(value);\n  }, [value]);\n\n  // to make sure text is not wrapped, and multi-space is shown normally\n  const displayValue = useMemo(() => {\n    return editingValue ? editingValue.replace(/\\n/g, '') : '';\n  }, [editingValue]);\n\n  // to make sure input's style is the same as displayed text\n  const inputWrapperInheritsStyles = {\n    margin: 'inherit',\n    padding: 'inherit',\n    borderRadius: 'inherit',\n    fontSize: 'inherit',\n    fontFamily: 'inherit',\n    lineHeight: 'inherit',\n    fontWeight: 'inherit',\n    letterSpacing: 'inherit',\n    textAlign: 'inherit',\n    color: 'inherit',\n    backgroundColor: 'inherit',\n  } as CSSProperties;\n  const inputInheritsStyles = {\n    ...inputWrapperInheritsStyles,\n    padding: 0,\n    margin: 0,\n  };\n\n  return (\n    <div\n      data-editing={editing}\n      className={clsx(styles.inlineEditWrapper, className)}\n      style={{ ...style }}\n      {...attrs}\n    >\n      {/* display area, will be transparent when input */}\n      <div\n        onClick={onClick}\n        onDoubleClick={onDoubleClick}\n        className={clsx(styles.inlineEdit)}\n      >\n        {displayValue}\n\n        {!displayValue && (\n          <Placeholder\n            className={placeholderClassName}\n            label={placeholder}\n            style={placeholderStyle}\n          />\n        )}\n      </div>\n\n      {/* actual input */}\n      {\n        <Input\n          ref={inputRef}\n          className={styles.inlineEditInput}\n          value={editingValue}\n          placeholder={placeholder}\n          onEnter={onEnter}\n          onKeyDown={onKeyDown}\n          onChange={inputHandler}\n          style={inputWrapperInheritsStyles}\n          inputStyle={inputInheritsStyles}\n          onBlur={onBlur}\n          {...inputAttrs}\n        />\n      }\n    </div>\n  );\n};\n\ninterface PlaceholderProps\n  extends PropsWithChildren,\n    HTMLAttributes<HTMLSpanElement> {\n  label?: string;\n}\nconst Placeholder = ({\n  label,\n  children,\n  className,\n  style,\n  ...attrs\n}: PlaceholderProps) => {\n  return (\n    <div\n      className={clsx(styles.placeholder, className)}\n      style={style}\n      {...attrs}\n    >\n      {children ?? label}\n    </div>\n  );\n};\n","import \"../component/src/ui/editable/inline-edit.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/ui/editable/inline-edit.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xZWpnbHA5MCB7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIGJvcmRlci1yYWRpdXM6IDRweDsKICBwYWRkaW5nOiA0cHg7CiAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogIG1pbi13aWR0aDogNTBweDsKICBtaW4taGVpZ2h0OiAyOHB4Owp9Ci5fMWVqZ2xwOTEgewogIG92ZXJmbG93OiBoaWRkZW47CiAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7CiAgd2hpdGUtc3BhY2U6IHByZTsKICB3b3JkLXdyYXA6IGJyZWFrLXdvcmQ7CiAgYm9yZGVyOiAxcHggc29saWQgdHJhbnNwYXJlbnQ7Cn0KLl8xZWpnbHA5MFtkYXRhLWVkaXRpbmc9InRydWUiXSAuXzFlamdscDkxIHsKICBvcGFjaXR5OiAwOwogIHZpc2liaWxpdHk6IGhpZGRlbjsKfQouXzFlamdscDkyIHsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgd2lkdGg6IDEwMCU7CiAgaGVpZ2h0OiAxMDAlOwogIGxlZnQ6IDA7CiAgdG9wOiAwOwogIG9wYWNpdHk6IDA7CiAgdmlzaWJpbGl0eTogaGlkZGVuOwogIHBvaW50ZXItZXZlbnRzOiBub25lOwp9Ci5fMWVqZ2xwOTBbZGF0YS1lZGl0aW5nPSJ0cnVlIl0gLl8xZWpnbHA5MiB7CiAgb3BhY2l0eTogMTsKICB2aXNpYmlsaXR5OiB2aXNpYmxlOwogIHBvaW50ZXItZXZlbnRzOiBhdXRvOwp9Ci5fMWVqZ2xwOTMgewogIG9wYWNpdHk6IDAuODsKfQ==\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var inlineEdit = '_1ejglp91';\nexport var inlineEditInput = '_1ejglp92';\nexport var inlineEditWrapper = '_1ejglp90';\nexport var placeholder = '_1ejglp93';","import \"../component/src/ui/error-message/style.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/ui/error-message/style.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xZW1kY2RiMCB7CiAgY29sb3I6IHZhcigtLWFmZmluZS1lcnJvci1jb2xvcik7CiAgZm9udC1zaXplOiAwLjZyZW07CiAgbWFyZ2luOiA0cHggOHB4IDJweCAycHg7Cn0=\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var errorMessage = '_1emdcdb0';","import clsx from 'clsx';\nimport type React from 'react';\n\nimport { errorMessage } from './style.css';\n\nexport const ErrorMessage = ({\n  children,\n  inline,\n  style,\n  className,\n}: React.PropsWithChildren<{\n  inline?: boolean;\n  style?: React.CSSProperties;\n  className?: string;\n}>) => {\n  if (inline) {\n    return (\n      <span style={style} className={clsx(className, errorMessage)}>\n        {children}\n      </span>\n    );\n  }\n  return (\n    <div style={style} className={clsx(className, errorMessage)}>\n      {children}\n    </div>\n  );\n};\n","import \"../component/src/ui/lottie/styles.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/ui/lottie/styles.css.ts.vanilla.css\\\",\\\"source\\\":\\\"LmtvNDVkczAgewogIHdpZHRoOiAxZW07CiAgaGVpZ2h0OiAxZW07CiAgZGlzcGxheTogZmxleDsKICBhbGlnbi1pdGVtczogY2VudGVyOwogIGp1c3RpZnktY29udGVudDogY2VudGVyOwp9Ci5rbzQ1ZHMwIHBhdGhbc3Ryb2tlPSJyZ2IoMTE5LDExNywxMjUpIl0gewogIHN0cm9rZTogY3VycmVudENvbG9yOwp9Ci5rbzQ1ZHMwIHBhdGhbZmlsbD0icmdiKDExOSwxMTcsMTI1KSJdIHsKICBmaWxsOiBjdXJyZW50Q29sb3I7Cn0=\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var root = 'ko45ds0';","import clsx from 'clsx';\nimport type { LottieRef } from 'lottie-react';\nimport Lottie from 'lottie-react';\nimport { useEffect, useRef } from 'react';\n\nimport animationData from './collections-icon.json';\nimport * as styles from './styles.css';\n\nexport interface CollectionsIconProps {\n  closed: boolean; // eg, when collections icon is a \"dragged over\" state\n  className?: string;\n}\n\n// animated collections icon that has two states: closed and opened\nexport const AnimatedCollectionsIcon = ({\n  closed,\n  className,\n}: CollectionsIconProps) => {\n  const lottieRef: LottieRef = useRef(null);\n\n  useEffect(() => {\n    if (lottieRef.current) {\n      const lottie = lottieRef.current;\n      if (closed) {\n        lottie.setDirection(1);\n      } else {\n        lottie.setDirection(-1);\n      }\n      lottie.play();\n    }\n  }, [closed]);\n\n  return (\n    <Lottie\n      className={clsx(styles.root, className)}\n      autoPlay={false}\n      loop={false}\n      lottieRef={lottieRef}\n      animationData={animationData}\n    />\n  );\n};\n","import clsx from 'clsx';\nimport type { LottieRef } from 'lottie-react';\nimport Lottie from 'lottie-react';\nimport { useEffect, useRef } from 'react';\n\nimport animationData from './delete-icon.json';\nimport * as styles from './styles.css';\n\nexport interface DeleteIconProps {\n  closed: boolean; // eg, when delete icon is a \"dragged over\" state\n  className?: string;\n}\n\n// animated delete icon that has two animation states\nexport const AnimatedDeleteIcon = ({ closed, className }: DeleteIconProps) => {\n  const lottieRef: LottieRef = useRef(null);\n\n  useEffect(() => {\n    if (lottieRef.current) {\n      const lottie = lottieRef.current;\n      if (closed) {\n        lottie.setDirection(1);\n      } else {\n        lottie.setDirection(-1);\n      }\n      lottie.play();\n    }\n  }, [closed]);\n\n  return (\n    <Lottie\n      className={clsx(styles.root, className)}\n      autoPlay={false}\n      loop={false}\n      lottieRef={lottieRef}\n      animationData={animationData}\n    />\n  );\n};\n","import clsx from 'clsx';\nimport type { LottieRef } from 'lottie-react';\nimport Lottie from 'lottie-react';\nimport { useEffect, useRef } from 'react';\n\nimport animationData from './folder-icon.json';\nimport * as styles from './styles.css';\n\nexport interface FolderIconProps {\n  open: boolean; // eg, when folder icon is a \"dragged over\" state\n  className?: string;\n  speed?: number;\n}\n\n// animated folder icon that has two states: closed and opened\nexport const AnimatedFolderIcon = ({\n  open,\n  className,\n  speed = 0.5,\n}: FolderIconProps) => {\n  const lottieRef: LottieRef = useRef(null);\n\n  useEffect(() => {\n    if (lottieRef.current) {\n      const lottie = lottieRef.current;\n      lottie.setSpeed(speed);\n      if (open) {\n        lottie.setDirection(1);\n      } else {\n        lottie.setDirection(-1);\n      }\n      lottie.play();\n    }\n  }, [open, speed]);\n\n  return (\n    <Lottie\n      className={clsx(styles.root, className)}\n      autoPlay={false}\n      loop={false}\n      lottieRef={lottieRef}\n      animationData={animationData}\n    />\n  );\n};\n","import type {\n  PopoverContentProps,\n  PopoverPortalProps,\n  PopoverProps as PopoverPrimitiveProps,\n} from '@radix-ui/react-popover';\nimport * as PopoverPrimitive from '@radix-ui/react-popover';\nimport clsx from 'clsx';\nimport type { ReactNode } from 'react';\nimport { useMemo } from 'react';\n\nimport * as styles from './styles.css';\n\nexport interface PopoverProps extends PopoverPrimitiveProps {\n  content?: ReactNode;\n  portalOptions?: PopoverPortalProps;\n  contentOptions?: PopoverContentProps;\n}\nexport const Popover = ({\n  content,\n  children,\n  portalOptions,\n  contentOptions: {\n    className: contentClassName,\n    style: contentStyle,\n    ...otherContentOptions\n  } = {},\n  ...props\n}: PopoverProps) => {\n  return (\n    <PopoverPrimitive.Root {...props}>\n      <PopoverPrimitive.Trigger asChild>{children}</PopoverPrimitive.Trigger>\n\n      <PopoverPrimitive.Portal {...portalOptions}>\n        <PopoverPrimitive.Content\n          className={useMemo(\n            () => clsx(styles.popoverContent, contentClassName),\n            [contentClassName]\n          )}\n          sideOffset={5}\n          align=\"start\"\n          style={{ zIndex: 'var(--affine-z-index-popover)', ...contentStyle }}\n          {...otherContentOptions}\n        >\n          {content}\n        </PopoverPrimitive.Content>\n      </PopoverPrimitive.Portal>\n    </PopoverPrimitive.Root>\n  );\n};\n\nPopover.displayName = 'Popover';\n","import \"../component/src/ui/popover/styles.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/ui/popover/styles.css.ts.vanilla.css\\\",\\\"source\\\":\\\"LmZoZm9pcjAgewogIG1pbi13aWR0aDogMTgwcHg7CiAgY29sb3I6IHZhcigtLWFmZmluZS10ZXh0LXByaW1hcnktY29sb3IpOwogIGJvcmRlci1yYWRpdXM6IDhweDsKICBwYWRkaW5nOiA4cHg7CiAgZm9udC1zaXplOiB2YXIoLS1hZmZpbmUtZm9udC1zbSk7CiAgZm9udC13ZWlnaHQ6IDQwMDsKICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1hZmZpbmUtYmFja2dyb3VuZC1vdmVybGF5LXBhbmVsLWNvbG9yKTsKICBib3gtc2hhZG93OiB2YXIoLS1hZmZpbmUtbWVudS1zaGFkb3cpOwogIHVzZXItc2VsZWN0OiBub25lOwp9\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var popoverContent = 'fhfoir0';","// components/switch.tsx\nimport clsx from 'clsx';\nimport type { HTMLAttributes, ReactNode } from 'react';\nimport { useCallback, useState } from 'react';\n\nimport * as styles from './index.css';\n\nexport type SwitchProps = Omit<HTMLAttributes<HTMLLabelElement>, 'onChange'> & {\n  checked?: boolean;\n  onChange?: (checked: boolean) => void;\n  children?: ReactNode;\n  disabled?: boolean;\n};\n\nexport const Switch = ({\n  checked: checkedProp = false,\n  onChange: onChangeProp,\n  children,\n  className,\n  disabled,\n  ...otherProps\n}: SwitchProps) => {\n  const [checkedState, setCheckedState] = useState(checkedProp);\n\n  const checked = onChangeProp ? checkedProp : checkedState;\n  const onChange = useCallback(\n    (event: React.ChangeEvent<HTMLInputElement>) => {\n      if (disabled) {\n        return;\n      }\n      const newChecked = event.target.checked;\n      if (onChangeProp) onChangeProp(newChecked);\n      else setCheckedState(newChecked);\n    },\n    [disabled, onChangeProp]\n  );\n\n  return (\n    <label className={clsx(styles.labelStyle, className)} {...otherProps}>\n      {children}\n      <input\n        className={clsx(styles.inputStyle)}\n        type=\"checkbox\"\n        value={checked ? 'on' : 'off'}\n        checked={checked}\n        onChange={onChange}\n      />\n      <span\n        className={clsx(styles.switchStyle, {\n          [styles.switchCheckedStyle]: checked,\n          [styles.switchDisabledStyle]: disabled,\n        })}\n      />\n    </label>\n  );\n};\n","import \"../component/src/ui/switch/index.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/ui/switch/index.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xbHE0OWRmMCB7CiAgZGlzcGxheTogZmxleDsKICBhbGlnbi1pdGVtczogY2VudGVyOwogIGdhcDogMTBweDsKICBjdXJzb3I6IHBvaW50ZXI7Cn0KLl8xbHE0OWRmMSB7CiAgb3BhY2l0eTogMDsKICBwb3NpdGlvbjogYWJzb2x1dGU7Cn0KLl8xbHE0OWRmMiB7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIHdpZHRoOiA0NnB4OwogIGhlaWdodDogMjZweDsKICBiYWNrZ3JvdW5kOiB2YXIoLS1hZmZpbmUtdG9nZ2xlLWRpc2FibGUtYmFja2dyb3VuZC1jb2xvcik7CiAgYm9yZGVyLXJhZGl1czogMzdweDsKICB0cmFuc2l0aW9uOiAyMDBtcyBhbGw7Cn0KLl8xbHE0OWRmMjpiZWZvcmUgewogIGNvbnRlbnQ6ICIiOwogIHRyYW5zaXRpb246IGFsbCAuMnMgY3ViaWMtYmV6aWVyKDAuMjcsIDAuMiwgMC4yNSwgMS41MSk7CiAgcG9zaXRpb246IGFic29sdXRlOwogIHdpZHRoOiAyMHB4OwogIGhlaWdodDogMjBweDsKICBib3JkZXItcmFkaXVzOiA1MCU7CiAgdG9wOiA1MCU7CiAgYmFja2dyb3VuZDogdmFyKC0tYWZmaW5lLXRvZ2dsZS1jaXJjbGUtYmFja2dyb3VuZC1jb2xvcik7CiAgdHJhbnNmb3JtOiB0cmFuc2xhdGUoM3B4LCAtNTAlKTsKfQouXzFscTQ5ZGYzIHsKICBiYWNrZ3JvdW5kOiB2YXIoLS1hZmZpbmUtcHJpbWFyeS1jb2xvcik7Cn0KLl8xbHE0OWRmMzpiZWZvcmUgewogIGJvcmRlci1jb2xvcjogdmFyKC0tYWZmaW5lLXB1cmUtYmxhY2stMTApOwogIHRyYW5zZm9ybTogdHJhbnNsYXRlKDIzcHgsLTUwJSk7Cn0KLl8xbHE0OWRmNCB7CiAgY3Vyc29yOiBub3QtYWxsb3dlZDsKICBvcGFjaXR5OiAwLjU7Cn0=\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var inputStyle = '_1lq49df1';\nexport var labelStyle = '_1lq49df0';\nexport var switchCheckedStyle = '_1lq49df3';\nexport var switchDisabledStyle = '_1lq49df4';\nexport var switchStyle = '_1lq49df2';","import { styled, textEllipsis } from '../../styles';\nimport type { TableCellProps } from './interface';\n\nexport const StyledTable = styled('table')<{ showBorder?: boolean }>(({\n  showBorder,\n}) => {\n  return {\n    fontSize: 'var(--affine-font-base)',\n    color: 'var(--affine-text-primary-color)',\n    tableLayout: 'fixed',\n    width: '100%',\n    borderCollapse: 'collapse',\n    borderSpacing: '0',\n\n    ...(typeof showBorder === 'boolean'\n      ? {\n          thead: {\n            '::after': {\n              display: 'block',\n              position: 'absolute',\n              content: '\"\"',\n              width: '100%',\n              height: '1px',\n              left: 0,\n              background: 'var(--affine-border-color)',\n              transition: 'opacity .15s',\n              opacity: showBorder ? 1 : 0,\n            },\n          },\n        }\n      : {}),\n  };\n});\n\nexport const StyledTableBody = styled('tbody')(() => {\n  return {\n    fontWeight: 400,\n  };\n});\n\nexport const StyledTableCell = styled('td')<\n  Pick<\n    TableCellProps,\n    'ellipsis' | 'align' | 'proportion' | 'active' | 'onClick'\n  >\n>(({\n  align = 'left',\n  ellipsis = false,\n  proportion,\n  active = false,\n  onClick,\n}) => {\n  const width = proportion ? `${proportion * 100}%` : 'auto';\n  return {\n    width,\n    height: '52px',\n    paddingLeft: '16px',\n    boxSizing: 'border-box',\n    textAlign: align,\n    verticalAlign: 'middle',\n    whiteSpace: 'nowrap',\n    userSelect: 'none',\n    fontSize: 'var(--affine-font-sm)',\n    ...(active ? { color: 'var(--affine-text-primary-color)' } : {}),\n    ...(ellipsis ? textEllipsis(1) : {}),\n    ...(onClick ? { cursor: 'pointer' } : {}),\n  };\n});\n\nexport const StyledTableHead = styled('thead')(() => {\n  return {\n    fontWeight: 500,\n    color: 'var(--affine-text-secondary-color)',\n  };\n});\n\nexport const StyledTHeadRow = styled('tr')({\n  td: {\n    whiteSpace: 'nowrap',\n    // How to set tbody height with overflow scroll\n    // see https://stackoverflow.com/questions/23989463/how-to-set-tbody-height-with-overflow-scroll\n    position: 'sticky',\n    top: 0,\n    background: 'var(--affine-background-primary-color)',\n  },\n});\n\nexport const StyledTBodyRow = styled('tr')(() => {\n  return {\n    td: {\n      transition: 'background .15s',\n    },\n    // Add border radius to table row\n    // see https://stackoverflow.com/questions/4094126/how-to-add-border-radius-on-table-row\n    'td:first-of-type': {\n      borderTopLeftRadius: '10px',\n      borderBottomLeftRadius: '10px',\n    },\n    'td:last-of-type': {\n      borderTopRightRadius: '10px',\n      borderBottomRightRadius: '10px',\n    },\n\n    ':hover': {\n      td: {\n        background: 'var(--affine-hover-color)',\n      },\n    },\n  };\n});\n","// Copyright: https://github.com/toeverything/blocksuite/commit/8032ef3ab97aefce01664b36502fc392c5db8b78#diff-bf5b41be21936f9165a8400c7f20e24d3dbc49644ba57b9258e0943f0dc1c464\nimport { DebugLogger } from '@affine/debug';\nimport type { TemplateResult } from 'lit';\nimport { css, html } from 'lit';\n\nconst logger = new DebugLogger('toast');\n\nexport const sleep = (ms = 0) =>\n  new Promise(resolve => setTimeout(resolve, ms));\n\nlet ToastContainer: HTMLDivElement | null = null;\n\n/**\n * DO NOT USE FOR USER INPUT\n * See https://stackoverflow.com/questions/494143/creating-a-new-dom-element-from-an-html-string-using-built-in-dom-methods-or-pro/35385518#35385518\n */\nconst htmlToElement = <T extends ChildNode>(html: string | TemplateResult) => {\n  const template = document.createElement('template');\n  if (typeof html === 'string') {\n    html = html.trim(); // Never return a text node of whitespace as the result\n    template.innerHTML = html;\n  } else {\n    const { strings, values } = html;\n    const v = [...values, '']; // + last empty part\n    template.innerHTML = strings.reduce((acc, cur, i) => acc + cur + v[i], '');\n  }\n  return template.content.firstChild as T;\n};\n\nconst createToastContainer = (portal?: HTMLElement) => {\n  portal = portal || document.body;\n  const styles = css`\n    width: 100%;\n    position: fixed;\n    z-index: 9999;\n    bottom: 78px;\n    left: 50%;\n    transform: translateX(-50%);\n    pointer-events: none;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n  `;\n  const template = html`<div\n    style=\"${styles}\"\n    data-testid=\"affine-toast-container\"\n  ></div>`;\n  const element = htmlToElement<HTMLDivElement>(template);\n  portal.append(element);\n  return element;\n};\n\nexport type ToastOptions = {\n  duration?: number;\n  portal?: HTMLElement;\n};\n\nconst animateToastOut = (toastElement: HTMLDivElement) => {\n  toastElement.style.opacity = '0';\n  setTimeout(() => toastElement.remove(), 300); // Match transition duration\n};\n\nconst createAndShowNewToast = (\n  message: string,\n  duration: number,\n  portal?: HTMLElement\n) => {\n  if (!ToastContainer || (portal && !portal.contains(ToastContainer))) {\n    ToastContainer = createToastContainer(portal);\n  }\n\n  const toastStyles = css`\n    position: absolute;\n    bottom: 0;\n    max-width: 480px;\n    text-align: center;\n    font-family: var(--affine-font-family);\n    font-size: var(--affine-font-sm);\n    padding: 10px 16px;\n    margin: 0;\n    color: var(--affine-white);\n    background: var(--affine-tooltip);\n    box-shadow: var(--affine-float-button-shadow);\n    border-radius: 8px;\n    opacity: 0;\n    transform: translateY(100%);\n    transition:\n      transform 0.3s cubic-bezier(0.25, 0.1, 0.25, 1),\n      opacity 0.3s ease;\n  `;\n\n  const toastTemplate = html`<div\n    style=\"${toastStyles}\"\n    data-testid=\"affine-toast\"\n  >\n    ${message}\n  </div>`;\n  const toastElement = htmlToElement<HTMLDivElement>(toastTemplate);\n  // message is not trusted\n  toastElement.textContent = message;\n  ToastContainer.append(toastElement);\n  logger.debug(`toast with message: \"${message}\"`);\n  window.dispatchEvent(\n    new CustomEvent('affine-toast:emit', { detail: message })\n  );\n\n  setTimeout(() => {\n    toastElement.style.opacity = '1';\n    toastElement.style.transform = 'translateY(0)';\n  }, 100);\n\n  setTimeout(() => {\n    animateToastOut(toastElement);\n  }, duration);\n};\n\n/**\n * @example\n * ```ts\n * toast('Hello World');\n * ```\n */\nexport const toast = (\n  message: string,\n  { duration = 3000, portal }: ToastOptions = {}\n) => {\n  if (ToastContainer && ToastContainer.children.length >= 2) {\n    // If there are already two toasts, remove the oldest one immediately\n    const oldestToast = ToastContainer.children[0] as HTMLDivElement;\n    oldestToast.remove();\n  }\n\n  // If there is one toast already, start its disappearing animation\n  if (ToastContainer && ToastContainer.children.length === 1) {\n    const currentToast = ToastContainer.children[0] as HTMLDivElement;\n    animateToastOut(currentToast);\n  }\n\n  createAndShowNewToast(message, duration, portal);\n};\n\nexport default toast;\n","import type { CSSProperties } from 'react';\n\nexport const displayFlex = (\n  justifyContent: CSSProperties['justifyContent'] = 'unset',\n  alignItems: CSSProperties['alignItems'] = 'unset',\n  alignContent: CSSProperties['alignContent'] = 'unset'\n): {\n  display: CSSProperties['display'];\n  justifyContent: CSSProperties['justifyContent'];\n  alignItems: CSSProperties['alignItems'];\n  alignContent: CSSProperties['alignContent'];\n} => {\n  return {\n    display: 'flex',\n    justifyContent,\n    alignItems,\n    alignContent,\n  };\n};\nexport const displayInlineFlex = (\n  justifyContent: CSSProperties['justifyContent'] = 'unset',\n  alignItems: CSSProperties['alignContent'] = 'unset',\n  alignContent: CSSProperties['alignContent'] = 'unset'\n): {\n  display: CSSProperties['display'];\n  justifyContent: CSSProperties['justifyContent'];\n  alignItems: CSSProperties['alignContent'];\n  alignContent: CSSProperties['alignContent'];\n} => {\n  return {\n    display: 'inline-flex',\n    justifyContent,\n    alignItems,\n    alignContent,\n  };\n};\n\nexport const absoluteCenter = ({\n  horizontal = false,\n  vertical = false,\n  position: { left, right, top, bottom } = {},\n}: {\n  horizontal?: boolean;\n  vertical?: boolean;\n  position?: {\n    left?: CSSProperties['left'];\n    right?: CSSProperties['right'];\n    top?: CSSProperties['top'];\n    bottom?: CSSProperties['bottom'];\n  };\n}): {\n  position: CSSProperties['position'];\n  left: CSSProperties['left'];\n  top: CSSProperties['top'];\n  right: CSSProperties['right'];\n  bottom: CSSProperties['bottom'];\n  transform: CSSProperties['transform'];\n} => {\n  return {\n    position: 'absolute',\n    left: left ? left : horizontal ? '50%' : 'auto',\n    top: top ? top : vertical ? '50%' : 'auto',\n    right: right ? right : 'auto',\n    bottom: bottom ? bottom : 'auto',\n    transform: `translate(${horizontal ? '-50%' : '0'}, ${\n      vertical ? '-50%' : '0'\n    })`,\n  };\n};\nexport const fixedCenter = ({\n  horizontal = false,\n  vertical = false,\n  position: { left, right, top, bottom } = {},\n}: {\n  horizontal?: boolean;\n  vertical?: boolean;\n  position?: {\n    left?: CSSProperties['left'];\n    right?: CSSProperties['right'];\n    top?: CSSProperties['top'];\n    bottom?: CSSProperties['bottom'];\n  };\n}): {\n  position: CSSProperties['position'];\n  left: CSSProperties['left'];\n  top: CSSProperties['top'];\n  right: CSSProperties['right'];\n  bottom: CSSProperties['bottom'];\n  transform: CSSProperties['transform'];\n} => {\n  return {\n    position: 'fixed',\n    left: left ? left : horizontal ? '50%' : 'auto',\n    top: top ? top : vertical ? '50%' : 'auto',\n    right: right ? right : 'auto',\n    bottom: bottom ? bottom : 'auto',\n    transform: `translate(${horizontal ? '-50%' : '0'}, ${\n      vertical ? '-50%' : '0'\n    })`,\n  };\n};\n\nexport const textEllipsis = (lineNum = 1): CSSProperties => {\n  if (lineNum > 1) {\n    return {\n      display: '-webkit-box',\n      wordBreak: 'break-all',\n      WebkitBoxOrient: 'vertical',\n      WebkitLineClamp: `${lineNum}`, //the number of rows to display\n      overflow: 'hidden',\n      textOverflow: 'ellipsis',\n    };\n  }\n  return {\n    overflow: 'hidden',\n    textOverflow: 'ellipsis',\n    whiteSpace: 'nowrap',\n  };\n};\n\nexport const positionAbsolute = ({\n  left,\n  top,\n  right,\n  bottom,\n}: {\n  left?: CSSProperties['left'];\n  top?: CSSProperties['top'];\n  right?: CSSProperties['right'];\n  bottom?: CSSProperties['bottom'];\n}): {\n  position: CSSProperties['position'];\n  left: CSSProperties['left'];\n  top: CSSProperties['top'];\n  right: CSSProperties['right'];\n  bottom: CSSProperties['bottom'];\n} => {\n  return {\n    position: 'absolute',\n    left,\n    top,\n    right,\n    bottom,\n  };\n};\n","import \"../component/src/ui/avatar/style.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/ui/avatar/style.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACrVWy3LiMBC85yt02SpShVi/8EO55E+2hC3DJEKiJBlCtvLvW5JtsAxxHhsuGFnj7unp0diPz+xYK7plGv0JgzCqlY7Q3zuEgl/ugpCRO4Jwkvx6cEvOakMQDsNubRQVupZqS9CWGgUvMxwsomKOcLAo0jkKFkXiFvFyjoI5Cu7tc293CIVpT9Fj5j2mo1xOUmSxQ00LS5G2FFk2ooijEUXmMSTBFEOROdAotgxh2ioqRgxJPhax9CjiYooizy12krdS3G8+IkiTW0vIg5v7EAa3bqe3u8fLTo79Tu644mD34ll0Xl8j79xprTo5Nd3JcTaiyCYp8taZZWQp4k5s9FEvRyMd4ZSO0IEGkbuE0SebORrpiKZlfKObf17ERTvfwoxBQ9+oq97uFn0bJ47pAJXZEMdsIzYM1htzXu+kBgNSEKQYpwb2zN6Ve6ZqLg8EbaCqmHgY4i6HuHnswebhCJWutOSNcagnyS6m19suviFW7mgJ5kjspl3XwA1TBK14o2Z7qmYY9ymH9/ceC5YK1iAIKpkwTHUXG0IFbGmb+nkcxBoxqhkGgWVjUC3VgapKIxA1CGjFnR7EO06PWBtqGEE72mhWeeVLXfmuh6tGCBBrLz4blrvIvXIX2US5vZHpD8zvjcubFPwAnONyQ8WaEZfl3CY+Pz/6jivRz7qSf9GVwj9ciW9LMmGLamOuHoP/qLDnZD50sn3TxsOX64e+DJRSp/T6nKhA20IRBIKDYLjmzE0ve8V6o0A8ExR4cCsHd9YRENQIzczDuZy+0DbjvrTX9mopDNbwyggqKS9n4xj0G0X3Xrp9npTDWmAwbKvJoCefGm2gPuJSCsOEGW7tmTJQUo7dowRtoaq4q0WjmcKacVYagoQU7JvjtfzM2JarJ1YaXINNzsJ5ENWnIC6S+JECrWj5vFayERUuJZeqt4zWte2QnYItVcd2z5lyLeqwAcPcrmurU+ontw/dnWXgdxf72jtveC4vtE+IfKcsl9rVekVnaTBHaThHqfueXjpdrxhExV46TVcr1ahhIc6j4XSAOxHdDlqES+3AGqUt2k7CxWFmZGN9d1U6IYZeSD0679dmV95+pHhfd3vQsALuEM8dNdQ5HCpdHiPWIYb7b4/W2z+UsmY+bQ4AAA==\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var DefaultAvatarBottomItemStyle = '_1012frs7';\nexport var DefaultAvatarBottomItemWithAnimationStyle = '_1012frs8';\nexport var DefaultAvatarContainerStyle = '_1012frs4';\nexport var DefaultAvatarMiddleItemStyle = '_1012frs5';\nexport var DefaultAvatarMiddleItemWithAnimationStyle = '_1012frs6';\nexport var DefaultAvatarTopItemStyle = '_1012frs9';\nexport var avatarFallback = '_1012frsd';\nexport var avatarImage = '_1012frsc';\nexport var avatarRoot = '_1012frsa';\nexport var avatarWrapper = '_1012frsb';\nexport var blurVar = 'var(--_1012frs1)';\nexport var hoverWrapper = '_1012frse';\nexport var removeButton = '_1012frsf';\nexport var sizeVar = 'var(--_1012frs0)';","import clsx from 'clsx';\nimport { useMemo, useRef, useState } from 'react';\n\nimport {\n  DefaultAvatarBottomItemStyle,\n  DefaultAvatarBottomItemWithAnimationStyle,\n  DefaultAvatarContainerStyle,\n  DefaultAvatarMiddleItemStyle,\n  DefaultAvatarMiddleItemWithAnimationStyle,\n  DefaultAvatarTopItemStyle,\n} from './style.css';\n\nconst colorsSchema = [\n  ['#FF0000', '#FF00E5', '#FFAE73'],\n  ['#FF5C00', '#FFC700', '#FFE073'],\n  ['#FFDA16', '#FFFBA6', '#FFBE73'],\n  ['#8CD317', '#FCFF5C', '#67CAE9'],\n  ['#28E19F', '#89FFC6', '#39A880'],\n  ['#35B7E0', '#77FFCE', '#5076FF'],\n  ['#3D39FF', '#77BEFF', '#3502FF'],\n  ['#BD08EB', '#755FFF', '#6967E4'],\n];\n\nexport const ColorfulFallback = ({ char }: { char: string }) => {\n  const colors = useMemo(() => {\n    const index = char.toUpperCase().charCodeAt(0);\n    return colorsSchema[index % colorsSchema.length];\n  }, [char]);\n\n  const timer = useRef<ReturnType<typeof setTimeout>>();\n\n  const [topColor, middleColor, bottomColor] = colors;\n  const [isHover, setIsHover] = useState(false);\n\n  return (\n    <div\n      className={DefaultAvatarContainerStyle}\n      onMouseEnter={() => {\n        timer.current = setTimeout(() => {\n          setIsHover(true);\n        }, 300);\n      }}\n      onMouseLeave={() => {\n        clearTimeout(timer.current);\n        setIsHover(false);\n      }}\n    >\n      <div\n        className={DefaultAvatarTopItemStyle}\n        style={{ background: bottomColor }}\n      ></div>\n      <div\n        className={clsx(DefaultAvatarMiddleItemStyle, {\n          [DefaultAvatarMiddleItemWithAnimationStyle]: isHover,\n        })}\n        style={{ background: middleColor }}\n      ></div>\n      <div\n        className={clsx(DefaultAvatarBottomItemStyle, {\n          [DefaultAvatarBottomItemWithAnimationStyle]: isHover,\n        })}\n        style={{ background: topColor }}\n      ></div>\n    </div>\n  );\n};\nexport default ColorfulFallback;\n","import { CloseIcon } from '@blocksuite/icons/rc';\nimport type {\n  AvatarFallbackProps,\n  AvatarImageProps,\n  AvatarProps as RadixAvatarProps,\n} from '@radix-ui/react-avatar';\nimport {\n  Fallback as AvatarFallback,\n  Image as AvatarImage,\n  Root as AvatarRoot,\n} from '@radix-ui/react-avatar';\nimport { assignInlineVars } from '@vanilla-extract/dynamic';\nimport clsx from 'clsx';\nimport type {\n  CSSProperties,\n  HTMLAttributes,\n  MouseEvent,\n  ReactElement,\n} from 'react';\nimport {\n  forwardRef,\n  useCallback,\n  useLayoutEffect,\n  useMemo,\n  useState,\n} from 'react';\n\nimport { withUnit } from '../../utils/with-unit';\nimport { IconButton } from '../button';\nimport type { TooltipProps } from '../tooltip';\nimport { Tooltip } from '../tooltip';\nimport { ColorfulFallback } from './colorful-fallback';\nimport * as style from './style.css';\nimport { blurVar, sizeVar } from './style.css';\n\nexport type AvatarProps = {\n  size?: number;\n  url?: string | null;\n  image?: ImageBitmap /* use pre-loaded image data can avoid flashing */;\n  name?: string;\n  className?: string;\n  style?: CSSProperties;\n  colorfulFallback?: boolean;\n  hoverIcon?: ReactElement;\n  onRemove?: (e: MouseEvent<HTMLButtonElement>) => void;\n  avatarTooltipOptions?: Omit<TooltipProps, 'children'>;\n  removeTooltipOptions?: Omit<TooltipProps, 'children'>;\n  /**\n   * Same as `CSS.borderRadius`, number in px or string with unit\n   * @default '50%'\n   */\n  rounded?: number | string;\n\n  fallbackProps?: AvatarFallbackProps;\n  imageProps?: Omit<\n    AvatarImageProps & React.HTMLProps<HTMLCanvasElement>,\n    'src' | 'ref'\n  >;\n  avatarProps?: RadixAvatarProps;\n  hoverWrapperProps?: HTMLAttributes<HTMLDivElement>;\n  removeButtonProps?: HTMLAttributes<HTMLButtonElement>;\n} & HTMLAttributes<HTMLSpanElement>;\n\nfunction drawImageFit(\n  img: ImageBitmap,\n  ctx: CanvasRenderingContext2D,\n  size: number\n) {\n  const hRatio = size / img.width;\n  const vRatio = size / img.height;\n  const ratio = Math.max(hRatio, vRatio);\n  const centerShift_x = (size - img.width * ratio) / 2;\n  const centerShift_y = (size - img.height * ratio) / 2;\n  ctx.drawImage(\n    img,\n    0,\n    0,\n    img.width,\n    img.height,\n    centerShift_x,\n    centerShift_y,\n    img.width * ratio,\n    img.height * ratio\n  );\n}\n\nexport const Avatar = forwardRef<HTMLSpanElement, AvatarProps>(\n  (\n    {\n      size = 20,\n      style: propsStyles = {},\n      url,\n      image,\n      name,\n      className,\n      colorfulFallback = false,\n      hoverIcon,\n      fallbackProps: { className: fallbackClassName, ...fallbackProps } = {},\n      imageProps,\n      avatarProps,\n      rounded = '50%',\n      onRemove,\n      hoverWrapperProps: {\n        className: hoverWrapperClassName,\n        ...hoverWrapperProps\n      } = {},\n      avatarTooltipOptions,\n      removeTooltipOptions,\n      removeButtonProps: {\n        className: removeButtonClassName,\n        ...removeButtonProps\n      } = {},\n      ...props\n    },\n    ref\n  ) => {\n    const firstCharOfName = useMemo(() => {\n      return name?.slice(0, 1) || 'A';\n    }, [name]);\n    const [containerDom, setContainerDom] = useState<HTMLDivElement | null>(\n      null\n    );\n    const [removeButtonDom, setRemoveButtonDom] =\n      useState<HTMLButtonElement | null>(null);\n    const [canvas, setCanvas] = useState<HTMLCanvasElement | null>(null);\n\n    useLayoutEffect(() => {\n      if (canvas && image) {\n        const ctx = canvas?.getContext('2d');\n        if (ctx) {\n          drawImageFit(image, ctx, size * window.devicePixelRatio);\n        }\n      }\n      return;\n    }, [canvas, image, size]);\n\n    const canvasRef = useCallback((node: HTMLCanvasElement | null) => {\n      setCanvas(node);\n    }, []);\n\n    return (\n      <AvatarRoot className={style.avatarRoot} {...avatarProps} ref={ref}>\n        <Tooltip\n          portalOptions={{ container: containerDom }}\n          {...avatarTooltipOptions}\n        >\n          <div\n            ref={setContainerDom}\n            className={clsx(style.avatarWrapper, className)}\n            style={{\n              ...assignInlineVars({\n                [sizeVar]: size ? `${size}px` : '20px',\n                [blurVar]: `${size * 0.3}px`,\n                borderRadius: withUnit(rounded, 'px'),\n              }),\n              ...propsStyles,\n            }}\n            {...props}\n          >\n            {image /* canvas mode */ ? (\n              <canvas\n                className={style.avatarImage}\n                ref={canvasRef}\n                width={size * window.devicePixelRatio}\n                height={size * window.devicePixelRatio}\n                {...imageProps}\n              />\n            ) : (\n              <AvatarImage\n                className={style.avatarImage}\n                src={url || ''}\n                alt={name}\n                {...imageProps}\n              />\n            )}\n\n            {!image /* no fallback on canvas mode */ && (\n              <AvatarFallback\n                className={clsx(style.avatarFallback, fallbackClassName)}\n                delayMs={url ? 600 : undefined}\n                {...fallbackProps}\n              >\n                {colorfulFallback ? (\n                  <ColorfulFallback char={firstCharOfName} />\n                ) : (\n                  firstCharOfName.toUpperCase()\n                )}\n              </AvatarFallback>\n            )}\n            {hoverIcon ? (\n              <div\n                className={clsx(style.hoverWrapper, hoverWrapperClassName)}\n                {...hoverWrapperProps}\n              >\n                {hoverIcon}\n              </div>\n            ) : null}\n          </div>\n        </Tooltip>\n\n        {onRemove ? (\n          <IconButton\n            tooltipOptions={{\n              portalOptions: { container: removeButtonDom },\n              ...removeTooltipOptions,\n            }}\n            variant=\"solid\"\n            size=\"12\"\n            className={clsx(style.removeButton, removeButtonClassName)}\n            onClick={onRemove}\n            ref={setRemoveButtonDom}\n            {...removeButtonProps}\n          >\n            <CloseIcon />\n          </IconButton>\n        ) : null}\n      </AvatarRoot>\n    );\n  }\n);\n\nAvatar.displayName = 'Avatar';\n","import clsx from 'clsx';\nimport type {\n  CSSProperties,\n  HTMLAttributes,\n  MouseEvent,\n  ReactElement,\n} from 'react';\nimport { cloneElement, forwardRef, useCallback } from 'react';\n\nimport { useAutoFocus } from '../../hooks';\nimport { Loading } from '../loading';\nimport { Tooltip, type TooltipProps } from '../tooltip';\nimport * as styles from './button.css';\n\nexport type ButtonType =\n  | 'primary'\n  | 'secondary'\n  | 'plain'\n  | 'error'\n  | 'success'\n  | 'custom';\nexport type ButtonSize = 'default' | 'large' | 'extraLarge' | 'custom';\n\nexport interface ButtonProps\n  extends Omit<HTMLAttributes<HTMLButtonElement>, 'type' | 'prefix'> {\n  /**\n   * Preset color scheme\n   * @default 'secondary'\n   */\n  variant?: ButtonType;\n  disabled?: boolean;\n  /**\n   * By default, the button is `inline-flex`, set to `true` to make it `flex`\n   * @default false\n   */\n  block?: boolean;\n  /**\n   * Preset size, will be overridden by `style` or `className`\n   * @default 'default'\n   */\n  size?: ButtonSize;\n  /**\n   * Will show a loading spinner at `prefix` position\n   */\n  loading?: boolean;\n\n  /** No hover state */\n  withoutHover?: boolean;\n\n  /**\n   * By default, it is considered as an icon with preset size and color,\n   * can be overridden by `prefixClassName` and `prefixStyle`.\n   *\n   * If `loading` is true, will be replaced by a spinner.(`prefixClassName` and `prefixStyle` still work)\n   * */\n  prefix?: ReactElement;\n  prefixClassName?: string;\n  prefixStyle?: CSSProperties;\n  contentClassName?: string;\n  contentStyle?: CSSProperties;\n\n  /**\n   * By default, it is considered as an icon with preset size and color,\n   * can be overridden by `suffixClassName` and `suffixStyle`.\n   * */\n  suffix?: ReactElement;\n  suffixClassName?: string;\n  suffixStyle?: CSSProperties;\n\n  tooltip?: TooltipProps['content'];\n  tooltipShortcut?: TooltipProps['shortcut'];\n  tooltipOptions?: Partial<Omit<TooltipProps, 'content' | 'shortcut'>>;\n}\n\nconst IconSlot = ({\n  icon,\n  loading,\n  className,\n  ...attrs\n}: {\n  icon?: ReactElement;\n  loading?: boolean;\n} & HTMLAttributes<HTMLElement>) => {\n  const showLoadingHere = loading !== undefined;\n  const visible = icon || loading;\n  return visible ? (\n    <div className={clsx(styles.icon, className)} {...attrs}>\n      {showLoadingHere && loading ? <Loading size=\"100%\" /> : null}\n      {icon && !loading\n        ? cloneElement(icon, {\n            width: '100%',\n            height: '100%',\n            ...icon.props,\n          })\n        : null}\n    </div>\n  ) : null;\n};\n\nexport const Button = forwardRef<HTMLButtonElement, ButtonProps>(\n  (\n    {\n      variant = 'secondary',\n      size = 'default',\n      children,\n      disabled,\n      block,\n      loading,\n      className,\n      withoutHover,\n\n      prefix,\n      prefixClassName,\n      prefixStyle,\n      suffix,\n      suffixClassName,\n      suffixStyle,\n      contentClassName,\n      contentStyle,\n\n      tooltip,\n      tooltipShortcut,\n      tooltipOptions,\n      autoFocus,\n      onClick,\n\n      ...otherProps\n    },\n    upstreamRef\n  ) => {\n    const ref = useAutoFocus<HTMLButtonElement>(autoFocus);\n\n    const handleClick = useCallback(\n      (e: MouseEvent<HTMLButtonElement>) => {\n        if (loading || disabled) return;\n        onClick?.(e);\n      },\n      [disabled, loading, onClick]\n    );\n\n    const buttonRef = (el: HTMLButtonElement | null) => {\n      ref.current = el;\n      if (upstreamRef) {\n        if (typeof upstreamRef === 'function') {\n          upstreamRef(el);\n        } else {\n          upstreamRef.current = el;\n        }\n      }\n    };\n\n    return (\n      <Tooltip content={tooltip} shortcut={tooltipShortcut} {...tooltipOptions}>\n        <button\n          {...otherProps}\n          ref={buttonRef}\n          className={clsx(styles.button, className)}\n          data-loading={loading || undefined}\n          data-block={block || undefined}\n          disabled={disabled}\n          data-disabled={disabled || undefined}\n          data-size={size}\n          data-variant={variant}\n          data-no-hover={withoutHover || undefined}\n          onClick={handleClick}\n        >\n          <IconSlot\n            icon={prefix}\n            loading={loading}\n            className={prefixClassName}\n            style={prefixStyle}\n          />\n          {children ? (\n            <span\n              className={clsx(styles.content, contentClassName)}\n              style={contentStyle}\n            >\n              {children}\n            </span>\n          ) : null}\n          <IconSlot\n            icon={suffix}\n            className={suffixClassName}\n            style={suffixStyle}\n          />\n        </button>\n      </Tooltip>\n    );\n  }\n);\nButton.displayName = 'Button';\nexport default Button;\n","import \"../component/src/ui/button/button.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/ui/button/button.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACtVXXWvzNhS+768QgRcaqIrtJmmq8u6i14NdbLCLUYZsHdtaVMlIcj429t+H5MSxZTtJGe/YS9vUOV96ztGjo+PH3+PlGl6EAvTXHUIYn74/EbSo9q89WUxQLQ3YvjQalTKC4sY/F7DHptRcbgiKnKRShluuJEEaBLV8C07KuKkEPRDEpeASsPNzcip4ITG38GEIykBa0E78R20szw84U9KCtF1VbUBjAwIyS5BU0odXtXVhjxBSpRlorCnjtSFo3UC1msoTNCoEenwyTpzV2ihNUKX4aQm8g3TDLaZVhTUU3kMqzDQtfHiabQqtaslwpoTz3VJ9f67Oy9zHHVPReYPP1YwytQv163kH/44zW4YWrGth7EEAQUYJzjri0aUz7zgaM/aqEnhR2lAXeV1Bq1Dx5BUVZYzLIlQuvDJX0mLD/4RQvTyrd6OrrryBZ8o4rOf5693fd48twUkKudINz1vSzGZ9QtLUKFFb6BQijqIv3eRP37tk4bIEze0IszoaVdGM28ORgQJyS9DyGEtV52cXN1f6gzSPglq4x8voywNyn/NL/KJ57goi6AE07hiVagv6py1oQQ/zIQ38OhXVIG1TDs9zDFuQ1pyPUJ90w5yPXGsV3er/xqilWKoGyvtxMx5QaMG4oakA9t7drrY1NEh6u+rjdY3bMsdjCFKhss17P2rTaYa2jpdfZwxyWgs7ew86ZERQsg5b5MK3TRQnoSIhKF6FwmWwb57uezPvW60cNaK+7JmgJKouoBZUFzCG+WkA7RLmZpEAc7wMhVMQF5cgwt5q+uMUzsVg5YXv0ygeFD05rTTAOUC5+gTKLdWcSvt1Vmn+QfVhgPIl2L60tlZJfDQPdpFOGNcafi25hV9gbwOX9PMu2bgLlxL0m6DZ5s0f1fnFfA1kSrJPZNw6XMnZwt5OlCfMlWeTlQxzPHa7GxKrBOVyLKmgAf4HGUyuyAiaONhtGqC10rfujTf+jrlYZxkYczMTG/PvLt/22utfYdHjMrjucpXVBm+54akAQmhuQY+NNFeGl/GJx48hnelkbFTuXfvnITXyP3G1HzubXBrOoEm/cyQ6ieU+B3+63H2eCxcThOCV4X4G37miY1PRDNwYsNO08jNVa1xyxkD2ghY+6PD9Y3TCTS5MuMnlWTWZnubT+etw0ph4p+kh/wGZbYP/yk62sf1k04tSBmdmQVB7x7f7Vu39X3z8r4uU3kcP6Pj7GCfzh9ZgOW00wpTjtdoQ3Jbw4YYpqjezdzSAeCuc1eoGOM9Jn1xlA8E35H9xF3y7Bj8KkFFZwGib/78hbGbwaw36/Dbir6Tm3eNK1+1bfg7P6DtBdD2Kf1W+9b5xrm/+8Wfn9m1GgvUpTHNKpivRzNXJYoB+cTqN/wA3zN9N8BEAAA==\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var button = '_158e9loe';\nexport var content = '_158e9lof';\nexport var hVar = 'var(--_158e9lo0)';\nexport var icon = '_158e9log';\nexport var iconButton = '_158e9loh';\nexport var iconSizeVar = 'var(--_158e9lo2)';\nexport var wVar = 'var(--_158e9lo1)';","import { ArrowDownSmallIcon } from '@blocksuite/icons/rc';\nimport type { ButtonHTMLAttributes, MouseEventHandler } from 'react';\nimport { forwardRef } from 'react';\n\nimport * as styles from './styles.css';\n\ntype DropdownButtonProps = {\n  size?: 'small' | 'default';\n  onClickDropDown?: MouseEventHandler<HTMLElement>;\n} & ButtonHTMLAttributes<HTMLButtonElement>;\n\nexport const DropdownButton = forwardRef<\n  HTMLButtonElement,\n  DropdownButtonProps\n>(({ onClickDropDown, children, size = 'default', ...props }, ref) => {\n  const handleClickDropDown: MouseEventHandler<HTMLElement> = e => {\n    e.stopPropagation();\n    onClickDropDown?.(e);\n  };\n  return (\n    <button\n      ref={ref}\n      data-size={size}\n      className={styles.dropdownBtn}\n      {...props}\n    >\n      <span>{children}</span>\n      <span className={styles.divider} />\n      <span className={styles.dropdownWrapper} onClick={handleClickDropDown}>\n        <ArrowDownSmallIcon\n          className={styles.dropdownIcon}\n          width={16}\n          height={16}\n        />\n      </span>\n    </button>\n  );\n});\nDropdownButton.displayName = 'DropdownButton';\n","import \"../component/src/ui/button/styles.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/ui/button/styles.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACtVZ627jKBT+36dAI43USMVyMkk39WjmCfYNVqPViU0SNgQswE26q3n3FRinBl9ycZq2UlvVhnPhnO8c4HP093jLprM0jtF/dwhlVOUMXhJEOaOc4CUj++93CAGjK46pJluVoJRwTaR5/U+hNF2+4FRwTbiuD+WQZZSvEhSjcZzva6+wpKu1TlBs3qWCCZmgZ5D3GMNyaYxqstc4l3QL0qhmQo7M1KXgGu9IKfwYW/EFpJuVFAXPAh2vAy2aFkJmRCZonO+REoxmgawdbszHEjJaqATNy+VYfxT9lwSmy/dbK7l27n6blDKFIhIrwkiqE8QFJ+blbk01wSqHlJiXOwm5DU0hlYlNLmgZ1N930SFbyVo8E2lz1hkDO6VcBl5Sxkg28pX8lYEGu4QfGVlCwfQvq9H3ukNCbYExf/5kHswf2+EdzfQ6QXE0K4NQTR8/ls+dC8joM/UzsQW5otyAalrKli9qkKpZn9Stj+P4q2fcPR8QPxjqmJGlTirHArCXNVBz7luZOx9Z02DSxKU5lDoh436qp1bOLBGvpNglaPzdPdt/6zMTLvR9wkBpLJZYv+RkZIX9SIeezkoDfSWxV6PWgPdEtiMXPt5qvWaa76vq7KhZyrSp/EyKHKs1ZGJ3H+d7ZH6NsFwt4D5+QO4nGo9GPRXaWs3NNlUP05l162dx5spPgyY/vqRrkm5I9uVXvzbru6/n0Up0tl5FUsGzoPm6wJWr/H3X4clPFBg5ZLsSPIz/0bvhNEBhg48XRO8I4T3YOK8bNnAS7FUJco0b78hiQzWGPMeSrKjgZkk4k7DyVjU/b1VHod4KMS2KdI0h1daNLXCaFwzMkxkVhTZG3Qbb2OvCzbm/XvoKegGK2BhqCVzR0htgDEXf1NGYte/nYWUfRfXB8TY0M3gh0m3no1NOG36ZzCM7thAse+1uXZU9t30z2lG9FoUu0TYaVO3zKKMKFoyU1kUOKdUvCYqm9dOB27h7V+f01MrZnSkweSZcq5bqnEdMgMFI2Sre2li10u4gPqCmb2eEnPI1kVQHZhdMpBu/YqtS9Y4NnlBKZcpI2/Y9a8y11tumjsMNdB4xkCvSf/5yCmtTQ7WPDQmy1xL+bOiehgeSSncwPzAwaYrlDCjv31G6juBV1doGkoMkXIdV7w35dkulnZbzQnp9oqsAjznn3w0YpBs8jt28vTtEhLMKrQXHlHPTve2MsLad1TMgbJo6SLwyqSBc38cZWT00TizxdITir+3vDZhHD/2rb3PyvEbUq+HSLtnrJpFSyME4sFpujAJr890x4K+86eCA/Pvyl2a/x8EdSH7YplpSdULinYobp95Zfffkh6tvc3IAAEINl0Kg101VpClRanALcHpujARn9d2REK6+zckBSAg1XIqEXjdzKcxgX0c4/VxQqbr50aAy/O6QaIlBh6uDzggNJZcfE3r9RT8Nj1AeVu3F/MAGBrfi8HT+9MqfqbWkfONu19e76LchiqaChwR4eRmvqNPqlvLYxqzW/Y+UBqlPIPKeIuJuLG5ejdX0pr3eQWp+TWLPr+rxcK0Pbw9P4XVjkK6S3LGlffQ8UBOET8HZtFHFl1IvVUinQUinDdanivrFV7u+Lyv1HByK3VVhDYIJwuFFGCITyefuNPfcF+DqTA28J1MDt2Rq4DymBq7E1ECt2zjsVl/Uwi9sdeyGTcup6YdaU8h+6arbbm9FLQ3aU2M7HW4oa+/dvrIm/PtJl2DjGEy2OHtDiu4oXXMzpsZ86zGddeK++9iz0GQ2e0Cvf+JoMhshyhVpBOLj8zYwmLdpangD3gaO8DY3omyGweGDEzgwkMAJ5a9O4MDHIXCGAeET0DkwmM5pangDOgeO0jk3Y3KGQeIT8DowmNdpangDXgdO4XVuSekMPUN8EoIHrkHwtCq5JsHzP6pCX3HEKAAA\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var button = '_1ml45c08';\nexport var buttonIcon = '_1ml45c09';\nexport var divider = '_1ml45c01';\nexport var dropdownBtn = '_1ml45c00';\nexport var dropdownIcon = '_1ml45c03';\nexport var dropdownWrapper = '_1ml45c02';\nexport var iconButton = '_1ml45c0a';\nexport var radioButton = '_1ml45c04';\nexport var radioButtonContent = '_1ml45c05';\nexport var radioButtonGroup = '_1ml45c07';\nexport var radioUncheckedButton = '_1ml45c06 _1ml45c05';","import { assignInlineVars } from '@vanilla-extract/dynamic';\nimport clsx from 'clsx';\nimport { type CSSProperties, forwardRef, type ReactElement } from 'react';\n\nimport { Button, type ButtonProps } from './button';\nimport { iconButton, iconSizeVar } from './button.css';\n\nexport interface IconButtonProps\n  extends Omit<\n    ButtonProps,\n    | 'variant'\n    | 'size'\n    | 'prefix'\n    | 'suffix'\n    | 'children'\n    | 'prefixClassName'\n    | 'prefixStyle'\n    | 'suffix'\n    | 'suffixClassName'\n    | 'suffixStyle'\n  > {\n  /**  Icon element */\n  children?: ReactElement;\n  /** Same as `children`, compatibility of the old API */\n  icon?: ReactElement;\n  variant?: 'plain' | 'solid' | 'danger' | 'custom';\n  /**\n   * Use preset size,\n   * or use custom size(px) (default padding is `2px`, have to override yourself)\n   *\n   * > These presets size are referenced from the design system.\n   * > The number is the size of the icon, the button size is calculated based on the icon size + padding.\n   * > OR, you can define `width` and `height` in `style` or `className` directly.\n   */\n  size?: '12' | '14' | '16' | '20' | '24' | number;\n  iconClassName?: string;\n  iconStyle?: CSSProperties;\n}\n\nexport const IconButton = forwardRef<HTMLButtonElement, IconButtonProps>(\n  (\n    {\n      variant = 'plain',\n      size = '20',\n      style,\n      className,\n      children,\n      icon,\n      iconClassName,\n      iconStyle,\n      ...otherProps\n    },\n    ref\n  ) => {\n    const validatedSize = isNaN(parseInt(size as string, 10)) ? 16 : size;\n\n    return (\n      <Button\n        ref={ref}\n        style={{\n          ...style,\n          ...assignInlineVars({\n            [iconSizeVar]: `${validatedSize}px`,\n          }),\n        }}\n        data-icon-variant={variant}\n        data-icon-size={validatedSize}\n        className={clsx(iconButton, className)}\n        size={'custom'}\n        variant={'custom'}\n        prefix={children ?? icon}\n        prefixClassName={iconClassName}\n        prefixStyle={iconStyle}\n        {...otherProps}\n      />\n    );\n  }\n);\n\nIconButton.displayName = 'IconButton';\nexport default IconButton;\n","import type {\n  RadioGroupItemProps,\n  RadioGroupProps,\n} from '@radix-ui/react-radio-group';\nimport * as RadixRadioGroup from '@radix-ui/react-radio-group';\nimport clsx from 'clsx';\nimport type { CSSProperties } from 'react';\nimport { forwardRef } from 'react';\n\nimport { RadioGroup } from '../radio';\nimport * as styles from './styles.css';\n\n// for reference\nRadioGroup;\n\n/**\n * @deprecated\n * use {@link RadioGroup } instead\n */\nexport const RadioButton = forwardRef<\n  HTMLButtonElement,\n  RadioGroupItemProps & { spanStyle?: string }\n>(({ children, className, spanStyle, ...props }, ref) => {\n  return (\n    <RadixRadioGroup.Item\n      ref={ref}\n      {...props}\n      className={clsx(styles.radioButton, className)}\n    >\n      <span className={clsx(styles.radioUncheckedButton, spanStyle)}>\n        {children}\n      </span>\n      <RadixRadioGroup.Indicator\n        className={clsx(styles.radioButtonContent, spanStyle)}\n      >\n        {children}\n      </RadixRadioGroup.Indicator>\n    </RadixRadioGroup.Item>\n  );\n});\nRadioButton.displayName = 'RadioButton';\n\n/**\n * @deprecated\n * use {@link RadioGroup} instead\n */\nexport const RadioButtonGroup = forwardRef<\n  HTMLDivElement,\n  RadioGroupProps & { width?: CSSProperties['width'] }\n>(({ className, style, width, ...props }, ref) => {\n  return (\n    <RadixRadioGroup.Root\n      ref={ref}\n      className={clsx(styles.radioButtonGroup, className)}\n      style={{ width, ...style }}\n      {...props}\n    ></RadixRadioGroup.Root>\n  );\n});\nRadioButtonGroup.displayName = 'RadioButtonGroup';\n","const unchecked = (\n  <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    width=\"1em\"\n    height=\"1em\"\n    viewBox=\"0 0 24 24\"\n    fill=\"none\"\n  >\n    <path\n      fillRule=\"evenodd\"\n      clipRule=\"evenodd\"\n      d=\"M6 3.25C4.48122 3.25 3.25 4.48122 3.25 6V18C3.25 19.5188 4.48122 20.75 6 20.75H18C19.5188 20.75 20.75 19.5188 20.75 18V6C20.75 4.48122 19.5188 3.25 18 3.25H6ZM4.75 6C4.75 5.30964 5.30964 4.75 6 4.75H18C18.6904 4.75 19.25 5.30964 19.25 6V18C19.25 18.6904 18.6904 19.25 18 19.25H6C5.30964 19.25 4.75 18.6904 4.75 18V6Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n);\n\nconst checked = (\n  <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    width=\"1em\"\n    height=\"1em\"\n    viewBox=\"0 0 24 24\"\n    fill=\"none\"\n  >\n    <path\n      fillRule=\"evenodd\"\n      clipRule=\"evenodd\"\n      d=\"M3.25 6C3.25 4.48122 4.48122 3.25 6 3.25H18C19.5188 3.25 20.75 4.48122 20.75 6V18C20.75 19.5188 19.5188 20.75 18 20.75H6C4.48122 20.75 3.25 19.5188 3.25 18V6ZM16.5303 9.53033C16.8232 9.23744 16.8232 8.76256 16.5303 8.46967C16.2374 8.17678 15.7626 8.17678 15.4697 8.46967L10.5 13.4393L9.03033 11.9697C8.73744 11.6768 8.26256 11.6768 7.96967 11.9697C7.67678 12.2626 7.67678 12.7374 7.96967 13.0303L9.96967 15.0303C10.2626 15.3232 10.7374 15.3232 11.0303 15.0303L16.5303 9.53033Z\"\n      fill=\"var(--affine-blue-600)\"\n    />\n  </svg>\n);\n\nconst indeterminate = (\n  <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    width=\"1em\"\n    height=\"1em\"\n    viewBox=\"0 0 24 24\"\n    fill=\"none\"\n  >\n    <path\n      fillRule=\"evenodd\"\n      clipRule=\"evenodd\"\n      d=\"M6 3.25C4.48122 3.25 3.25 4.48122 3.25 6V18C3.25 19.5188 4.48122 20.75 6 20.75H18C19.5188 20.75 20.75 19.5188 20.75 18V6C20.75 4.48122 19.5188 3.25 18 3.25H6ZM8.54 11.25C8.12579 11.25 7.79 11.5858 7.79 12C7.79 12.4142 8.12579 12.75 8.54 12.75H15.54C15.9542 12.75 16.29 12.4142 16.29 12C16.29 11.5858 15.9542 11.25 15.54 11.25H8.54Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n);\n\nexport { checked, indeterminate, unchecked };\n","// components/checkbox.tsx\nimport clsx from 'clsx';\nimport type { HTMLAttributes } from 'react';\nimport { useCallback, useEffect, useRef } from 'react';\n\nimport * as icons from './icons';\nimport * as styles from './index.css';\n\nexport type CheckboxProps = Omit<\n  HTMLAttributes<HTMLInputElement>,\n  'onChange'\n> & {\n  checked: boolean;\n  onChange: (\n    event: React.ChangeEvent<HTMLInputElement>,\n    checked: boolean\n  ) => void;\n  disabled?: boolean;\n  indeterminate?: boolean;\n  animation?: boolean;\n  name?: string;\n  label?: string;\n  inputClassName?: string;\n  labelClassName?: string;\n};\n\nexport const Checkbox = ({\n  checked,\n  onChange,\n  indeterminate,\n  disabled,\n  animation,\n  name,\n  label,\n  inputClassName,\n  labelClassName,\n  className,\n  ...otherProps\n}: CheckboxProps) => {\n  const inputRef = useRef<HTMLInputElement>(null);\n  const handleChange = useCallback(\n    (event: React.ChangeEvent<HTMLInputElement>) => {\n      const newChecked = event.target.checked;\n      onChange(event, newChecked);\n      const inputElement = inputRef.current;\n      if (newChecked && inputElement && animation) {\n        playCheckAnimation(inputElement.parentElement as Element).catch(\n          console.error\n        );\n      }\n    },\n    [onChange, animation]\n  );\n\n  useEffect(() => {\n    if (inputRef.current) {\n      inputRef.current.indeterminate = !!indeterminate;\n    }\n  }, [indeterminate]);\n\n  const icon = indeterminate\n    ? icons.indeterminate\n    : checked\n      ? icons.checked\n      : icons.unchecked;\n\n  return (\n    <div\n      className={clsx(styles.root, className, disabled && styles.disabled)}\n      role=\"checkbox\"\n      {...otherProps}\n    >\n      {icon}\n      <input\n        ref={inputRef}\n        data-testid=\"affine-checkbox\"\n        className={clsx(styles.input, inputClassName)}\n        type=\"checkbox\"\n        value={checked ? 'on' : 'off'}\n        id={name}\n        name={name}\n        checked={checked}\n        onChange={handleChange}\n      />\n      {label ? (\n        <label htmlFor={name} className={clsx(labelClassName)}>\n          {label}\n        </label>\n      ) : null}\n    </div>\n  );\n};\n\nexport const playCheckAnimation = async (refElement: Element) => {\n  const sparkingEl = document.createElement('div');\n  sparkingEl.classList.add('affine-check-animation');\n  sparkingEl.style.cssText = `\n    position: absolute;\n    width: 1em;\n    height: 1em;\n    border-radius: 50%;\n    font-size: inherit;\n  `;\n  refElement.append(sparkingEl);\n\n  await sparkingEl.animate(\n    [\n      {\n        boxShadow:\n          '0 -18px 0 -8px #1e96eb, 16px -8px 0 -8px #1e96eb, 16px 8px 0 -8px #1e96eb, 0 18px 0 -8px #1e96eb, -16px 8px 0 -8px #1e96eb, -16px -8px 0 -8px #1e96eb',\n      },\n    ],\n    { duration: 240, easing: 'ease', fill: 'forwards' }\n  ).finished;\n\n  await sparkingEl.animate(\n    [\n      {\n        boxShadow:\n          '0 -36px 0 -10px transparent, 32px -16px 0 -10px transparent, 32px 16px 0 -10px transparent, 0 36px 0 -10px transparent, -32px 16px 0 -10px transparent, -32px -16px 0 -10px transparent',\n      },\n    ],\n    { duration: 360, easing: 'ease', fill: 'forwards' }\n  ).finished;\n  sparkingEl.remove();\n};\n","import \"../component/src/ui/checkbox/index.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/ui/checkbox/index.css.ts.vanilla.css\\\",\\\"source\\\":\\\"LnlqYWRweTAgewogIGRpc3BsYXk6IGlubGluZS1mbGV4OwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgcG9zaXRpb246IHJlbGF0aXZlOwp9Ci55amFkcHkwOmhvdmVyIHN2ZyB7CiAgb3BhY2l0eTogMC44Owp9Ci55amFkcHkwOmFjdGl2ZSBzdmcgewogIG9wYWNpdHk6IDAuOTsKfQoueWphZHB5MSB7CiAgb3BhY2l0eTogMC41OwogIHBvaW50ZXItZXZlbnRzOiBub25lOwp9Ci55amFkcHkyIHsKICBvcGFjaXR5OiAwOwogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICB3aWR0aDogMWVtOwogIGhlaWdodDogMWVtOwogIGluc2V0OiAwOwogIHRvcDogNTAlOwogIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtNTAlKTsKICBjdXJzb3I6IHBvaW50ZXI7CiAgZm9udC1zaXplOiBpbmhlcml0Owp9\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var disabled = 'yjadpy1';\nexport var input = 'yjadpy2';\nexport var root = 'yjadpy0';","import clsx from 'clsx';\nimport type { HTMLAttributes, PropsWithChildren } from 'react';\nimport { forwardRef } from 'react';\n\nimport * as styles from './style.css';\nexport type DividerOrientation = 'horizontal' | 'vertical';\nexport type DividerProps = PropsWithChildren &\n  Omit<HTMLAttributes<HTMLDivElement>, 'type'> & {\n    orientation?: DividerOrientation;\n    size?: 'thinner' | 'default';\n    dividerColor?: string;\n  };\n\nexport const Divider = forwardRef<HTMLDivElement, DividerProps>(\n  (\n    {\n      orientation = 'horizontal',\n      size = 'default',\n      dividerColor = 'var(--affine-border-color)',\n      style,\n      className,\n      ...otherProps\n    },\n    ref\n  ) => {\n    return (\n      <div\n        data-divider\n        ref={ref}\n        className={clsx(\n          styles.divider,\n          {\n            [styles.verticalDivider]: orientation === 'vertical',\n            [styles.thinner]:\n              size === 'thinner' && orientation === 'horizontal',\n            [styles.verticalThinner]:\n              size === 'thinner' && orientation === 'vertical',\n          },\n          className\n        )}\n        style={{\n          backgroundColor: dividerColor ? dividerColor : undefined,\n          ...style,\n        }}\n        {...otherProps}\n      />\n    );\n  }\n);\n\nDivider.displayName = 'Divider';\nexport default Divider;\n","import \"../component/src/ui/divider/style.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/ui/divider/style.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xdGd3ankyMCB7CiAgaGVpZ2h0OiAxcHg7CiAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tYWZmaW5lLWJvcmRlci1jb2xvcik7CiAgYm9yZGVyLXJhZGl1czogOHB4OwogIG1hcmdpbjogOHB4IDA7CiAgd2lkdGg6IDEwMCU7Cn0KLl8xdGd3ankyMSB7CiAgaGVpZ2h0OiAwLjVweDsKfQouXzF0Z3dqeTIyIHsKICB3aWR0aDogMXB4OwogIGJvcmRlci1yYWRpdXM6IDhweDsKICBoZWlnaHQ6IDEwMCU7CiAgbWFyZ2luOiAwIDJweDsKfQouXzF0Z3dqeTIzIHsKICB3aWR0aDogMC41cHg7Cn0=\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var divider = '_1tgwjy20';\nexport var thinner = '_1tgwjy21';\nexport var verticalDivider = '_1tgwjy22';\nexport var verticalThinner = '_1tgwjy23';","import { memo } from 'react';\n\nexport const EmptySvg = memo(function EmptySvg({\n  style,\n  className,\n}: {\n  style?: React.CSSProperties;\n  className?: string;\n}) {\n  return (\n    <svg\n      className={className}\n      style={style}\n      width=\"248\"\n      height=\"216\"\n      viewBox=\"0 0 248 216\"\n      fill=\"currentColor\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M124.321 4.45459L5.2627 210.669H243.379L124.321 4.45459ZM239.666 207.565L182.825 109.114L125.984 141.931L239.666 207.565ZM125.153 140.49L181.993 107.673L125.153 9.22248L125.153 140.49ZM123.489 9.22248L123.489 140.49L66.6484 107.673L123.489 9.22248ZM65.8166 109.114L8.97592 207.565L122.657 141.931L65.8166 109.114ZM123.489 143.372L9.80773 209.006H123.489V143.372ZM125.153 209.006H238.834L125.153 143.372L125.153 209.006Z\"\n        fillOpacity=\"0.3\"\n      />\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M124.283 208.367C161.062 208.367 190.89 178.415 190.89 141.452C190.89 104.489 161.062 74.5371 124.283 74.5371C87.5044 74.5371 57.6765 104.489 57.6765 141.452C57.6765 178.415 87.5044 208.367 124.283 208.367ZM124.283 210.031C161.988 210.031 192.553 179.327 192.553 141.452C192.553 103.577 161.988 72.8735 124.283 72.8735C86.5785 72.8735 56.0129 103.577 56.0129 141.452C56.0129 179.327 86.5785 210.031 124.283 210.031Z\"\n        fillOpacity=\"0.3\"\n      />\n      <circle cx=\"65.7267\" cy=\"107.881\" r=\"4.93369\" fillOpacity=\"0.8\" />\n      <circle cx=\"5.26255\" cy=\"210.014\" r=\"4.93369\" fillOpacity=\"0.8\" />\n      <circle cx=\"124.359\" cy=\"210.014\" r=\"4.93369\" fillOpacity=\"0.8\" />\n      <circle cx=\"243.06\" cy=\"210.014\" r=\"4.93369\" fillOpacity=\"0.8\" />\n      <circle cx=\"183.499\" cy=\"107.881\" r=\"4.93369\" fillOpacity=\"0.8\" />\n      <circle cx=\"124.396\" cy=\"141.83\" r=\"4.93369\" fillOpacity=\"0.8\" />\n      <circle cx=\"124.344\" cy=\"5.00449\" r=\"4.93369\" fillOpacity=\"0.8\" />\n    </svg>\n  );\n});\n","import { assignInlineVars } from '@vanilla-extract/dynamic';\nimport type { CSSProperties, ReactNode } from 'react';\n\nimport { EmptySvg } from './empty-svg';\nimport * as styles from './index.css';\n\ntype ContainerStyleProps = {\n  width?: string;\n  height?: string;\n  fontSize?: string;\n};\nexport type EmptyContentProps = {\n  containerStyle?: ContainerStyleProps;\n  title?: ReactNode;\n  description?: ReactNode;\n  descriptionStyle?: CSSProperties;\n};\n\nexport const Empty = ({\n  containerStyle,\n  title,\n  description,\n  descriptionStyle,\n}: EmptyContentProps) => {\n  const cssVar = assignInlineVars({\n    [styles.svgWidth]: containerStyle?.width,\n    [styles.svgHeight]: containerStyle?.height,\n    [styles.svgFontSize]: containerStyle?.fontSize,\n  });\n  return (\n    <div className={styles.emptyContainer}>\n      <div style={{ color: 'var(--affine-black)' }}>\n        <EmptySvg className={styles.emptySvg} style={cssVar} />\n      </div>\n      {title && (\n        <p\n          style={{\n            marginTop: '30px',\n            color: 'var(--affine-text-primary-color)',\n            fontWeight: 700,\n          }}\n        >\n          {title}\n        </p>\n      )}\n      {description && (\n        <p style={{ marginTop: title ? '8px' : '30px', ...descriptionStyle }}>\n          {description}\n        </p>\n      )}\n    </div>\n  );\n};\n\nexport default Empty;\n","import \"../component/src/ui/empty/index.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/ui/empty/index.css.ts.vanilla.css\\\",\\\"source\\\":\\\"LmcyYzBhYzMgewogIGhlaWdodDogMTAwJTsKICBkaXNwbGF5OiBmbGV4OwogIGp1c3RpZnktY29udGVudDogY2VudGVyOwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgYWxpZ24tY29udGVudDogdW5zZXQ7CiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICBjb2xvcjogdmFyKC0tYWZmaW5lLXRleHQtc2Vjb25kYXJ5LWNvbG9yKTsKfQouZzJjMGFjNCB7CiAgLS1nMmMwYWMwOiAyNDhweDsKICAtLWcyYzBhYzE6IDIxNnB4OwogIC0tZzJjMGFjMjogaW5oZXJpdDsKICB3aWR0aDogdmFyKC0tZzJjMGFjMCk7CiAgaGVpZ2h0OiB2YXIoLS1nMmMwYWMxKTsKICBmb250LXNpemU6IHZhcigtLWcyYzBhYzIpOwp9\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var emptyContainer = 'g2c0ac3';\nexport var emptySvg = 'g2c0ac4';\nexport var svgFontSize = 'var(--g2c0ac2)';\nexport var svgHeight = 'var(--g2c0ac1)';\nexport var svgWidth = 'var(--g2c0ac0)';","import clsx from 'clsx';\nimport type {\n  ChangeEvent,\n  CSSProperties,\n  ForwardedRef,\n  InputHTMLAttributes,\n  KeyboardEvent,\n  KeyboardEventHandler,\n  ReactNode,\n} from 'react';\nimport { forwardRef, useCallback, useEffect } from 'react';\n\nimport { useAutoFocus, useAutoSelect } from '../../hooks';\nimport { input, inputWrapper } from './style.css';\n\nexport type InputProps = {\n  disabled?: boolean;\n  onChange?: (value: string) => void;\n  onBlur?: (ev: FocusEvent & { currentTarget: HTMLInputElement }) => void;\n  onKeyDown?: KeyboardEventHandler<HTMLInputElement>;\n  autoSelect?: boolean;\n  noBorder?: boolean;\n  status?: 'error' | 'success' | 'warning' | 'default';\n  size?: 'default' | 'large' | 'extraLarge';\n  preFix?: ReactNode;\n  endFix?: ReactNode;\n  type?: HTMLInputElement['type'];\n  inputStyle?: CSSProperties;\n  onEnter?: () => void;\n} & Omit<InputHTMLAttributes<HTMLInputElement>, 'onChange' | 'size' | 'onBlur'>;\n\nexport const Input = forwardRef<HTMLInputElement, InputProps>(function Input(\n  {\n    disabled,\n    onChange: propsOnChange,\n    noBorder = false,\n    className,\n    status = 'default',\n    style = {},\n    inputStyle = {},\n    size = 'default',\n    preFix,\n    endFix,\n    onEnter,\n    onKeyDown,\n    onBlur,\n    autoFocus,\n    autoSelect,\n    ...otherProps\n  }: InputProps,\n  upstreamRef: ForwardedRef<HTMLInputElement>\n) {\n  const focusRef = useAutoFocus<HTMLInputElement>(autoFocus);\n  const selectRef = useAutoSelect<HTMLInputElement>(autoSelect);\n\n  const inputRef = (el: HTMLInputElement | null) => {\n    focusRef.current = el;\n    selectRef.current = el;\n    if (upstreamRef) {\n      if (typeof upstreamRef === 'function') {\n        upstreamRef(el);\n      } else {\n        upstreamRef.current = el;\n      }\n    }\n  };\n\n  // use native blur event to get event after unmount\n  // don't use useLayoutEffect here, because the cleanup function will be called before unmount\n  useEffect(() => {\n    if (!onBlur) return;\n    selectRef.current?.addEventListener('blur', onBlur as any);\n    return () => {\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n      selectRef.current?.removeEventListener('blur', onBlur as any);\n    };\n  }, [onBlur, selectRef]);\n\n  return (\n    <div\n      className={clsx(inputWrapper, className, {\n        // status\n        disabled: disabled,\n        'no-border': noBorder,\n        // color\n        error: status === 'error',\n        success: status === 'success',\n        warning: status === 'warning',\n        default: status === 'default',\n        // size\n        large: size === 'large',\n        'extra-large': size === 'extraLarge',\n      })}\n      style={{\n        ...style,\n      }}\n    >\n      {preFix}\n      <input\n        className={clsx(input, {\n          large: size === 'large',\n          'extra-large': size === 'extraLarge',\n        })}\n        ref={inputRef}\n        disabled={disabled}\n        style={inputStyle}\n        onChange={useCallback(\n          (e: ChangeEvent<HTMLInputElement>) => {\n            propsOnChange?.(e.target.value);\n          },\n          [propsOnChange]\n        )}\n        onKeyDown={useCallback(\n          (e: KeyboardEvent<HTMLInputElement>) => {\n            if (e.key === 'Enter') {\n              onEnter?.();\n            }\n            onKeyDown?.(e);\n          },\n          [onKeyDown, onEnter]\n        )}\n        {...otherProps}\n      />\n      {endFix}\n    </div>\n  );\n});\n","import \"../component/src/ui/input/style.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/ui/input/style.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACoVU7a7bIAz936fgz6RWKhVp750m+jROcBKvXEBAmnTT3n0K+Vhym7uqiirM8bF9bHNyl1t4c4L93jHWkoq1ZJkQ3647xmqkqo6SnX+4rj9rMshn43kwVuB6j+FQWG29ZHfwe86hLHuHiF3kztMH+MehB+XWK/SSZa5jwWpSyQjFrfK2MYpvkWh4oOcL0DMh96CoCZKN2SoKTsNDslJjMvxsQqTywQtrIpooWYEmou+vQFNlOEX8CEtzaU3kgX7hp2ySPYeAY/iuB5Gp5JRKblNEe0dfattKVpNSaK67P7vTKPjJWD6gk/STKI0JGFc4Db7ChJmkvyTpFxDsogf+DHwb25LybUfjdyFWzooC5BrVkMas8KeS676WoTWHdWzv7bKEzfYl0JZ3aIoCQ3jlP8K2GFrwhkz1imGEbTEoLKHR8RXD8mqTQFLYy9IWTeAtxZrMkQ3H6Z/fKVCu8fAyVBOjNasZt03s108yYw3OU1eD6qdLuG7+zq5jvsphfxFHlr2LIztf3o9MnC7icF2kna0mZVr58QUQaWo0dpJl/x9xB0ols2DZ+CLwFvMbRQ7OIXgwxSLr6S6C4zVVte7DTxpEDyY48GjiFyUPOzKfF8O68v1XpJROQ4G11dOibem9wDz3N5OrDfnyiRtRWwSzIk20JWmdiCbjqpHplwnRd3I9vzVFPDAan4e/uDGxArcFAAA=\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var input = 'p3ks4p1';\nexport var inputWrapper = 'p3ks4p0';","export * from './input';\nimport { Input } from './input';\nexport default Input;\n","import type { CSSProperties } from 'react';\n\nimport { styled, textEllipsis } from '../../styles';\n\n// This component should be just used to be contained the text content\nexport type ContentProps = {\n  width?: CSSProperties['width'];\n  maxWidth?: CSSProperties['maxWidth'];\n  align?: CSSProperties['textAlign'];\n  color?: CSSProperties['color'];\n  fontSize?: CSSProperties['fontSize'];\n  weight?: CSSProperties['fontWeight'];\n  lineHeight?: CSSProperties['lineHeight'];\n  ellipsis?: boolean;\n  lineNum?: number;\n  children: React.ReactNode;\n};\nexport const Content = styled('div', {\n  shouldForwardProp: prop => {\n    return ![\n      'color',\n      'fontSize',\n      'weight',\n      'lineHeight',\n      'ellipsis',\n      'lineNum',\n      'width',\n      'maxWidth',\n      'align',\n    ].includes(prop as string);\n  },\n})<ContentProps>(({\n  color,\n  fontSize,\n  weight,\n  lineHeight,\n  ellipsis,\n  lineNum,\n  width,\n  maxWidth,\n  align,\n}) => {\n  return {\n    width,\n    maxWidth,\n    textAlign: align,\n    display: 'inline-block',\n    color: color ?? 'var(--affine-text-primary-color)',\n    fontSize: fontSize ?? 'var(--affine-font-base)',\n    fontWeight: weight ?? 400,\n    lineHeight: lineHeight ?? 1.5,\n    ...(ellipsis ? textEllipsis(lineNum) : {}),\n  };\n});\n\nexport default Content;\n","import type { CSSProperties } from 'react';\n\nimport { styled } from '../../styles';\n\nexport type WrapperProps = {\n  display?: CSSProperties['display'];\n  width?: CSSProperties['width'];\n  height?: CSSProperties['height'];\n  padding?: CSSProperties['padding'];\n  paddingTop?: CSSProperties['paddingTop'];\n  paddingRight?: CSSProperties['paddingRight'];\n  paddingLeft?: CSSProperties['paddingLeft'];\n  paddingBottom?: CSSProperties['paddingBottom'];\n  margin?: CSSProperties['margin'];\n  marginTop?: CSSProperties['marginTop'];\n  marginLeft?: CSSProperties['marginLeft'];\n  marginRight?: CSSProperties['marginRight'];\n  marginBottom?: CSSProperties['marginBottom'];\n};\n\nexport type FlexWrapperProps = {\n  display?: CSSProperties['display'];\n  flexDirection?: CSSProperties['flexDirection'];\n  justifyContent?: CSSProperties['justifyContent'];\n  alignItems?: CSSProperties['alignItems'];\n  wrap?: boolean;\n  flexShrink?: CSSProperties['flexShrink'];\n  flexGrow?: CSSProperties['flexGrow'];\n  gap?: CSSProperties['gap'];\n};\n\n// Sometimes we just want to wrap a component with a div to set flex or other styles, but we don't want to create a new component for it.\nexport const Wrapper = styled('div', {\n  shouldForwardProp: prop => {\n    return ![\n      'display',\n      'width',\n      'height',\n      'padding',\n      'margin',\n      'paddingTop',\n      'paddingRight',\n      'paddingLeft',\n      'paddingBottom',\n      'marginTop',\n      'marginLeft',\n      'marginRight',\n      'marginBottom',\n    ].includes(prop as string);\n  },\n})<WrapperProps>(({\n  display,\n  width,\n  height,\n  padding,\n  margin,\n  paddingTop,\n  paddingRight,\n  paddingLeft,\n  paddingBottom,\n  marginTop,\n  marginLeft,\n  marginRight,\n  marginBottom,\n}) => {\n  return {\n    display,\n    width,\n    height,\n    padding,\n    margin,\n    paddingTop,\n    paddingRight,\n    paddingLeft,\n    paddingBottom,\n    marginTop,\n    marginLeft,\n    marginRight,\n    marginBottom,\n  };\n});\n\nexport const FlexWrapper = styled(Wrapper, {\n  shouldForwardProp: prop => {\n    return ![\n      'justifyContent',\n      'alignItems',\n      'wrap',\n      'flexDirection',\n      'flexShrink',\n      'flexGrow',\n      'gap',\n    ].includes(prop as string);\n  },\n})<FlexWrapperProps>(({\n  justifyContent,\n  alignItems,\n  wrap = false,\n  flexDirection,\n  flexShrink,\n  flexGrow,\n  gap,\n}) => {\n  return {\n    display: 'flex',\n    justifyContent,\n    alignItems,\n    flexWrap: wrap ? 'wrap' : 'nowrap',\n    flexDirection,\n    flexShrink,\n    flexGrow,\n    gap,\n  };\n});\n\nexport default Wrapper;\n","import { assignInlineVars } from '@vanilla-extract/dynamic';\n\nimport { withUnit } from '../../utils/with-unit';\nimport { loading, speedVar } from './styles.css';\n\nexport interface LoadingProps {\n  size?: number | string;\n  speed?: number;\n  progress?: number;\n}\n\nexport const Loading = ({\n  size,\n  speed = 1.2,\n  progress = 0.2,\n}: LoadingProps) => {\n  // allow `string` such as `16px` | `100%` | `1em`\n  const sizeWithUnit = size ? withUnit(size, 'px') : '16px';\n  return (\n    <svg\n      className={loading}\n      width={sizeWithUnit}\n      height={sizeWithUnit}\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      style={{\n        ...assignInlineVars({\n          [speedVar]: `${speed}s`,\n        }),\n      }}\n    >\n      <circle\n        cx={12}\n        cy={12}\n        r={8}\n        strokeWidth={4}\n        stroke=\"var(--affine-black-10)\"\n      />\n      <circle\n        cx={12}\n        cy={12}\n        r={8}\n        strokeWidth={4}\n        stroke=\"var(--affine-primary-color)\"\n        strokeDasharray={`${2 * Math.PI * 8 * progress} ${\n          2 * Math.PI * 8 * (1 - progress)\n        }`}\n      />\n    </svg>\n  );\n};\n","import \"../component/src/ui/loading/styles.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/ui/loading/styles.css.ts.vanilla.css\\\",\\\"source\\\":\\\"QGtleWZyYW1lcyBfMWhvaDFlajEgewogIDAlIHsKICAgIHRyYW5zZm9ybTogcm90YXRlKDBkZWcpOwogIH0KICA1MCUgewogICAgdHJhbnNmb3JtOiByb3RhdGUoMTgwZGVnKTsKICB9CiAgMTAwJSB7CiAgICB0cmFuc2Zvcm06IHJvdGF0ZSgzNjBkZWcpOwogIH0KfQouXzFob2gxZWoyIHsKICAtLV8xaG9oMWVqMDogMS41czsKICB0ZXh0LXJlbmRlcmluZzogb3B0aW1pemVMZWdpYmlsaXR5OwogIHRyYW5zZm9ybTogcm90YXRlKC05MGRlZyk7CiAgYW5pbWF0aW9uOiBfMWhvaDFlajEgdmFyKC0tXzFob2gxZWowKSBpbmZpbml0ZSBsaW5lYXI7Cn0=\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var loading = '_1hoh1ej2';\nexport var speedVar = 'var(--_1hoh1ej0)';","import \"../component/src/ui/menu/styles.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/ui/menu/styles.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACqVW227jIBB9z1fwslIjLZaTplFEP2W1D8SMbRoCFoxjp6v++wpMHNu5qn2Kwsxw4HDmjBP90Ri9XJB/M0L2UtNGCiwZWWzSqn2fEZIZZSwjB25fKOV5LjVQhBZpZeWe2yMNCXOfujVWgKWWC1k7RjbdBhUXQuqi/58bjdTJT5hs2q3v531OA7IokZFVmobdebYrrKm1oNfONAibA1jFj7TiGtTofC11JRemmdTuQdcxEhJrB5Y6UJAhI9po8Iu0ge1OIuVVRS0U0mgfo8Ly4n32NUs6IpeBSCFdpfiRkVxBuDRXstBUIuwdIxloBOuXP2qHMvccagSNjLiKZ0C3gA2AHrG3qlqyWHYUTohedavKX6WMpC1HqedbmBp93nkhq63zZFZGnk4VeJKfATZCbU07vCTTBl+Y4g6pySkeK5h3AuK2kJpuDaLZx4Odq5KtMtkuJra90tL01zDrj+DIqZCObxWIvyH9pghj2uCR4z0oHECju7ynNki5UqYBcYlayqJUnsAT8APRlV5qPfiAnxD4yQ6J4LoAO9joWjVYa+xQ4U/3yLhygNtwq/3L3weOWd+CntYOwLMSsh2Im7BTz+lLX0OJ7zZGFkHnB7C58p1eSiG6XgqKOQdAKVk56XyoKSUCDd3nJdJYXvUVoXcZUZDjAHF1vdH9L3WllXrHSPrQ70r6Nr/lsjIz+vKmq8QhtzhsNxt9ctRtqwS0GGb5818mdS4H4jfpl779CBPRjoh6rN6bGny4z01BvYWSkyUuoiM+EGpneGdhR/rQVKw34InPbUakrgMqpd2/lBFeowki6wyvg4vRANGb9uaOk/eTICWL787mQAJxRknxBBWhKe5M9l78UocTn3rg8VS7MQ7vtkrr5jfm1d3J3B/+qceejMfzm1519Oe8fJ1oE5G6+vgUtXaAo7zzfLzwlevDcp0obgsYyfx1OVZjAi1aTi8TV+ngg+z0sbX2H1uD4tMc7povci8g57XCuxJ8djJ//Qc2CAR6ggoAAA==\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var menuContent = 'njwon21';\nexport var menuItem = 'njwon22';\nexport var menuItemIcon = 'njwon24';\nexport var menuSeparator = 'njwon25';\nexport var menuSpan = 'njwon23';\nexport var menuTrigger = 'njwon26';\nexport var triggerWidthVar = 'var(--njwon20)';","import type {\n  DropdownMenuContentProps,\n  DropdownMenuPortalProps,\n  DropdownMenuProps,\n} from '@radix-ui/react-dropdown-menu';\nimport * as DropdownMenu from '@radix-ui/react-dropdown-menu';\nimport clsx from 'clsx';\nimport type { ReactNode } from 'react';\n\nimport * as styles from './styles.css';\n\nexport interface MenuProps {\n  children: ReactNode;\n  items: ReactNode;\n  portalOptions?: Omit<DropdownMenuPortalProps, 'children'>;\n  rootOptions?: Omit<DropdownMenuProps, 'children'>;\n  contentOptions?: Omit<DropdownMenuContentProps, 'children'>;\n  noPortal?: boolean;\n}\n\nexport const Menu = ({\n  children,\n  items,\n  portalOptions,\n  rootOptions,\n  noPortal,\n  contentOptions: {\n    className = '',\n    style: contentStyle = {},\n    ...otherContentOptions\n  } = {},\n}: MenuProps) => {\n  return (\n    <DropdownMenu.Root {...rootOptions}>\n      <DropdownMenu.Trigger asChild>{children}</DropdownMenu.Trigger>\n\n      {noPortal ? (\n        <DropdownMenu.Content\n          className={clsx(styles.menuContent, className)}\n          sideOffset={5}\n          align=\"start\"\n          style={{ zIndex: 'var(--affine-z-index-popover)', ...contentStyle }}\n          {...otherContentOptions}\n        >\n          {items}\n        </DropdownMenu.Content>\n      ) : (\n        <DropdownMenu.Portal {...portalOptions}>\n          <DropdownMenu.Content\n            className={clsx(styles.menuContent, className)}\n            sideOffset={5}\n            align=\"start\"\n            style={{ zIndex: 'var(--affine-z-index-popover)', ...contentStyle }}\n            {...otherContentOptions}\n          >\n            {items}\n          </DropdownMenu.Content>\n        </DropdownMenu.Portal>\n      )}\n    </DropdownMenu.Root>\n  );\n};\n","import clsx from 'clsx';\nimport type { HTMLAttributes, PropsWithChildren, ReactNode } from 'react';\nimport { forwardRef, useMemo } from 'react';\n\nimport { menuItemIcon } from './styles.css';\n\nexport interface MenuIconProps\n  extends PropsWithChildren,\n    HTMLAttributes<HTMLDivElement> {\n  icon?: ReactNode;\n  position?: 'start' | 'end';\n}\n\nexport const MenuIcon = forwardRef<HTMLDivElement, MenuIconProps>(\n  ({ children, icon, position = 'start', className, ...otherProps }, ref) => {\n    return (\n      <div\n        ref={ref}\n        className={useMemo(\n          () =>\n            clsx(\n              menuItemIcon,\n              {\n                end: position === 'end',\n                start: position === 'start',\n              },\n              className\n            ),\n          [className, position]\n        )}\n        {...otherProps}\n      >\n        {icon || children}\n      </div>\n    );\n  }\n);\n\nMenuIcon.displayName = 'MenuIcon';\n","import { DoneIcon } from '@blocksuite/icons/rc';\nimport clsx from 'clsx';\nimport { useMemo } from 'react';\n\nimport type { MenuItemProps } from './menu.types';\nimport { MenuIcon } from './menu-icon';\nimport * as styles from './styles.css';\n\ninterface useMenuItemProps {\n  children: MenuItemProps['children'];\n  type: MenuItemProps['type'];\n  className: MenuItemProps['className'];\n  preFix: MenuItemProps['preFix'];\n  endFix: MenuItemProps['endFix'];\n  checked?: MenuItemProps['checked'];\n  selected?: MenuItemProps['selected'];\n  block?: MenuItemProps['block'];\n}\n\nexport const useMenuItem = ({\n  children: propsChildren,\n  type = 'default',\n  className: propsClassName,\n  preFix,\n  endFix,\n  checked,\n  selected,\n  block,\n}: useMenuItemProps) => {\n  const className = useMemo(\n    () =>\n      clsx(\n        styles.menuItem,\n        {\n          danger: type === 'danger',\n          warning: type === 'warning',\n          checked,\n          selected,\n          block,\n        },\n        propsClassName\n      ),\n    [block, checked, propsClassName, selected, type]\n  );\n\n  const children = useMemo(\n    () => (\n      <>\n        {preFix}\n        <span className={styles.menuSpan}>{propsChildren}</span>\n        {endFix}\n\n        {checked || selected ? (\n          <MenuIcon\n            position=\"end\"\n            className={clsx({\n              selected,\n              checked,\n            })}\n          >\n            <DoneIcon />\n          </MenuIcon>\n        ) : null}\n      </>\n    ),\n    [checked, endFix, preFix, propsChildren, selected]\n  );\n\n  return {\n    children,\n    className,\n  };\n};\n","import * as DropdownMenu from '@radix-ui/react-dropdown-menu';\n\nimport type { MenuItemProps } from './menu.types';\nimport { useMenuItem } from './use-menu-item';\n\nexport const MenuItem = ({\n  children: propsChildren,\n  type = 'default',\n  className: propsClassName,\n  preFix,\n  endFix,\n  checked,\n  selected,\n  block,\n  ...otherProps\n}: MenuItemProps) => {\n  const { className, children } = useMenuItem({\n    children: propsChildren,\n    className: propsClassName,\n    type,\n    preFix,\n    endFix,\n    checked,\n    selected,\n    block,\n  });\n\n  return (\n    <DropdownMenu.Item className={className} {...otherProps}>\n      {children}\n    </DropdownMenu.Item>\n  );\n};\n","import type { DropdownMenuSeparatorProps } from '@radix-ui/react-dropdown-menu';\nimport * as DropdownMenu from '@radix-ui/react-dropdown-menu';\nimport clsx from 'clsx';\nimport { useMemo } from 'react';\n\nimport * as styles from './styles.css';\n\nexport const MenuSeparator = ({\n  className,\n  ...otherProps\n}: DropdownMenuSeparatorProps) => {\n  return (\n    <DropdownMenu.Separator\n      className={useMemo(\n        () => clsx(styles.menuSeparator, className),\n        [className]\n      )}\n      {...otherProps}\n    />\n  );\n};\n","import { ArrowRightSmallIcon } from '@blocksuite/icons/rc';\nimport type {\n  DropdownMenuPortalProps,\n  DropdownMenuSubContentProps,\n  DropdownMenuSubProps,\n} from '@radix-ui/react-dropdown-menu';\nimport * as DropdownMenu from '@radix-ui/react-dropdown-menu';\nimport clsx from 'clsx';\nimport type { ReactNode } from 'react';\nimport { useMemo } from 'react';\n\nimport type { MenuItemProps } from './menu.types';\nimport { MenuIcon } from './menu-icon';\nimport * as styles from './styles.css';\nimport { useMenuItem } from './use-menu-item';\nexport interface MenuSubProps {\n  children: ReactNode;\n  items: ReactNode;\n  triggerOptions?: Omit<MenuItemProps, 'onSelect' | 'children'>;\n  portalOptions?: Omit<DropdownMenuPortalProps, 'children'>;\n  subOptions?: Omit<DropdownMenuSubProps, 'children'>;\n  subContentOptions?: Omit<DropdownMenuSubContentProps, 'children'>;\n}\n\nexport const MenuSub = ({\n  children: propsChildren,\n  items,\n  portalOptions,\n  subOptions,\n  triggerOptions: {\n    className: propsClassName,\n    preFix,\n    endFix,\n    type,\n    ...otherTriggerOptions\n  } = {},\n  subContentOptions: {\n    className: subContentClassName = '',\n    ...otherSubContentOptions\n  } = {},\n}: MenuSubProps) => {\n  const { className, children } = useMenuItem({\n    children: propsChildren,\n    className: propsClassName,\n    type,\n    preFix,\n    endFix,\n  });\n\n  return (\n    <DropdownMenu.Sub {...subOptions}>\n      <DropdownMenu.SubTrigger className={className} {...otherTriggerOptions}>\n        {children}\n        <MenuIcon position=\"end\">\n          <ArrowRightSmallIcon />\n        </MenuIcon>\n      </DropdownMenu.SubTrigger>\n      <DropdownMenu.Portal {...portalOptions}>\n        <DropdownMenu.SubContent\n          sideOffset={10}\n          className={useMemo(\n            () => clsx(styles.menuContent, subContentClassName),\n            [subContentClassName]\n          )}\n          {...otherSubContentOptions}\n        >\n          {items}\n        </DropdownMenu.SubContent>\n      </DropdownMenu.Portal>\n    </DropdownMenu.Sub>\n  );\n};\n","import { ArrowDownSmallIcon } from '@blocksuite/icons/rc';\nimport { assignInlineVars } from '@vanilla-extract/dynamic';\nimport clsx from 'clsx';\nimport type {\n  CSSProperties,\n  HTMLAttributes,\n  PropsWithChildren,\n  ReactNode,\n} from 'react';\nimport { forwardRef } from 'react';\n\nimport { MenuIcon } from './menu-icon';\nimport * as styles from './styles.css';\nimport { triggerWidthVar } from './styles.css';\n\nexport interface MenuTriggerProps\n  extends PropsWithChildren,\n    HTMLAttributes<HTMLButtonElement> {\n  width?: CSSProperties['width'];\n  disabled?: boolean;\n  noBorder?: boolean;\n  status?: 'error' | 'success' | 'warning' | 'default';\n  size?: 'default' | 'large' | 'extraLarge';\n  preFix?: ReactNode;\n  endFix?: ReactNode;\n  block?: boolean;\n}\n\nexport const MenuTrigger = forwardRef<HTMLButtonElement, MenuTriggerProps>(\n  (\n    {\n      disabled,\n      noBorder = false,\n      className,\n      status = 'default',\n      size = 'default',\n      preFix,\n      endFix,\n      block = false,\n      children,\n      width,\n      style = {},\n      ...otherProps\n    },\n    ref\n  ) => {\n    return (\n      <button\n        ref={ref}\n        style={{\n          ...assignInlineVars({\n            [triggerWidthVar]: width\n              ? typeof width === 'number'\n                ? `${width}px`\n                : width\n              : 'auto',\n          }),\n          ...style,\n        }}\n        className={clsx(styles.menuTrigger, className, {\n          // status\n          block,\n          disabled: disabled,\n          'no-border': noBorder,\n          // color\n          error: status === 'error',\n          success: status === 'success',\n          warning: status === 'warning',\n          default: status === 'default',\n          // size\n          large: size === 'large',\n          'extra-large': size === 'extraLarge',\n        })}\n        {...otherProps}\n      >\n        {preFix}\n        {children}\n        {endFix}\n        <MenuIcon position=\"end\">\n          <ArrowDownSmallIcon />\n        </MenuIcon>\n      </button>\n    );\n  }\n);\n\nMenuTrigger.displayName = 'MenuTrigger';\n","import { CloseIcon } from '@blocksuite/icons/rc';\nimport type {\n  DialogContentProps,\n  DialogOverlayProps,\n  DialogPortalProps,\n  DialogProps,\n} from '@radix-ui/react-dialog';\nimport * as Dialog from '@radix-ui/react-dialog';\nimport * as VisuallyHidden from '@radix-ui/react-visually-hidden';\nimport { assignInlineVars } from '@vanilla-extract/dynamic';\nimport clsx from 'clsx';\nimport type { CSSProperties } from 'react';\nimport { forwardRef, useCallback, useEffect, useState } from 'react';\n\nimport type { IconButtonProps } from '../button';\nimport { IconButton } from '../button';\nimport * as styles from './styles.css';\n\nexport interface ModalProps extends DialogProps {\n  width?: CSSProperties['width'];\n  height?: CSSProperties['height'];\n  minHeight?: CSSProperties['minHeight'];\n  title?: React.ReactNode;\n  description?: React.ReactNode;\n  withoutCloseButton?: boolean;\n  /**\n   * __Click outside__ or __Press `Esc`__ won't close the modal\n   * @default false\n   */\n  persistent?: boolean;\n  portalOptions?: DialogPortalProps;\n  contentOptions?: DialogContentProps;\n  overlayOptions?: DialogOverlayProps;\n  closeButtonOptions?: IconButtonProps;\n}\ntype PointerDownOutsideEvent = Parameters<\n  Exclude<DialogContentProps['onPointerDownOutside'], undefined>\n>[0];\n\nconst getVar = (style: number | string = '', defaultValue = '') => {\n  return style\n    ? typeof style === 'number'\n      ? `${style}px`\n      : style\n    : defaultValue;\n};\n\n/**\n * This component is a hack to support `startViewTransition` in the modal.\n */\nclass ModalTransitionContainer extends HTMLElement {\n  pendingTransitionNodes: Node[] = [];\n  animationFrame: number | null = null;\n\n  /**\n   * This method will be called when the modal is removed from the DOM\n   * https://github.com/facebook/react/blob/e4b4aac2a01b53f8151ca85148873096368a7de2/packages/react-dom-bindings/src/client/ReactFiberConfigDOM.js#L833\n   */\n  override removeChild<T extends Node>(child: T): T {\n    if (typeof document.startViewTransition === 'function') {\n      this.pendingTransitionNodes.push(child);\n      this.requestTransition();\n      return child;\n    } else {\n      // eslint-disable-next-line unicorn/prefer-dom-node-remove\n      return super.removeChild(child);\n    }\n  }\n\n  /**\n   * We collect all the nodes that are removed in the single frame and then trigger the transition.\n   */\n  private requestTransition() {\n    if (this.animationFrame) {\n      cancelAnimationFrame(this.animationFrame);\n    }\n\n    this.animationFrame = requestAnimationFrame(() => {\n      if (typeof document.startViewTransition === 'function') {\n        const nodes = this.pendingTransitionNodes;\n        document.startViewTransition(() => {\n          nodes.forEach(child => {\n            // eslint-disable-next-line unicorn/prefer-dom-node-remove\n            super.removeChild(child);\n          });\n        });\n        this.pendingTransitionNodes = [];\n      }\n    });\n  }\n}\n\nlet defined = false;\nfunction createContainer() {\n  if (!defined) {\n    customElements.define(\n      'modal-transition-container',\n      ModalTransitionContainer\n    );\n    defined = true;\n  }\n  const container = new ModalTransitionContainer();\n  document.body.append(container);\n  return container;\n}\n\nexport const ModalInner = forwardRef<HTMLDivElement, ModalProps>(\n  (props, ref) => {\n    const {\n      modal,\n      portalOptions,\n      open,\n      onOpenChange,\n      width,\n      height,\n      minHeight = 194,\n      title,\n      description,\n      withoutCloseButton = false,\n      persistent,\n      contentOptions: {\n        style: contentStyle,\n        className: contentClassName,\n        onPointerDownOutside,\n        onEscapeKeyDown,\n        ...otherContentOptions\n      } = {},\n      overlayOptions: {\n        className: overlayClassName,\n        style: overlayStyle,\n        ...otherOverlayOptions\n      } = {},\n      closeButtonOptions,\n      children,\n      ...otherProps\n    } = props;\n    const { className: closeButtonClassName, ...otherCloseButtonProps } =\n      closeButtonOptions || {};\n\n    const [container, setContainer] = useState<ModalTransitionContainer | null>(\n      null\n    );\n\n    useEffect(() => {\n      const container = createContainer();\n      setContainer(container);\n      return () => {\n        setTimeout(() => {\n          container.remove();\n        }, 1000) as unknown as number;\n      };\n    }, []);\n\n    const handlePointerDownOutSide = useCallback(\n      (e: PointerDownOutsideEvent) => {\n        onPointerDownOutside?.(e);\n        persistent && e.preventDefault();\n      },\n      [onPointerDownOutside, persistent]\n    );\n\n    const handleEscapeKeyDown = useCallback(\n      (e: KeyboardEvent) => {\n        onEscapeKeyDown?.(e);\n        persistent && e.preventDefault();\n      },\n      [onEscapeKeyDown, persistent]\n    );\n\n    if (!container) {\n      return;\n    }\n\n    return (\n      <Dialog.Root\n        modal={modal}\n        open={open}\n        onOpenChange={onOpenChange}\n        {...otherProps}\n      >\n        <Dialog.Portal container={container} {...portalOptions}>\n          <Dialog.Overlay\n            className={clsx(styles.modalOverlay, overlayClassName)}\n            style={{\n              ...overlayStyle,\n            }}\n            {...otherOverlayOptions}\n          />\n          <div data-modal={modal} className={clsx(styles.modalContentWrapper)}>\n            <Dialog.Content\n              onPointerDownOutside={handlePointerDownOutSide}\n              onEscapeKeyDown={handleEscapeKeyDown}\n              className={clsx(styles.modalContent, contentClassName)}\n              style={{\n                ...assignInlineVars({\n                  [styles.widthVar]: getVar(width, '50vw'),\n                  [styles.heightVar]: getVar(height, 'unset'),\n                  [styles.minHeightVar]: getVar(minHeight, '26px'),\n                }),\n                ...contentStyle,\n              }}\n              {...(description ? {} : { 'aria-describedby': undefined })}\n              {...otherContentOptions}\n              ref={ref}\n            >\n              {withoutCloseButton ? null : (\n                <Dialog.Close asChild>\n                  <IconButton\n                    size=\"20\"\n                    className={clsx(styles.closeButton, closeButtonClassName)}\n                    aria-label=\"Close\"\n                    data-testid=\"modal-close-button\"\n                    {...otherCloseButtonProps}\n                  >\n                    <CloseIcon />\n                  </IconButton>\n                </Dialog.Close>\n              )}\n              {title ? (\n                <Dialog.Title className={styles.modalHeader}>\n                  {title}\n                </Dialog.Title>\n              ) : (\n                // Refer: https://www.radix-ui.com/primitives/docs/components/dialog#title\n                // If you want to hide the title, wrap it inside our Visually Hidden utility like this <VisuallyHidden asChild>.\n                <VisuallyHidden.Root asChild>\n                  <Dialog.Title></Dialog.Title>\n                </VisuallyHidden.Root>\n              )}\n              {description ? (\n                <Dialog.Description className={styles.modalDescription}>\n                  {description}\n                </Dialog.Description>\n              ) : null}\n\n              {children}\n            </Dialog.Content>\n          </div>\n        </Dialog.Portal>\n      </Dialog.Root>\n    );\n  }\n);\n\nModalInner.displayName = 'ModalInner';\n\nexport const Modal = forwardRef<HTMLDivElement, ModalProps>((props, ref) => {\n  if (!props.open) {\n    return;\n  }\n  return <ModalInner {...props} ref={ref} />;\n});\n\nModal.displayName = 'Modal';\n","import \"../component/src/ui/modal/styles.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/ui/modal/styles.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACq1VbYvbOBD+vr9iKBQSWAXbTdLWy0HhoH+hHEcpY2scqytLRpJjZ4/+90OSkzhOdtu966ck8/o888wonx7pUBlsyMK3tHscts3wDv65A6iMbsIXAN1iKdwhh+ThDuDHHYDTc1caXT/uPl0XXL9cEMAZVLbSpsnjV4mO/lqw7O0SbImSFsnq43b5k+bPlUmORdLlCxg3oeZ16f+E8BbV12JcHZFtQ6VWW+GEVjlUYiDuo4Sy5EaEBZaPO6M7xVmppTY57NEsGMOqEorYxN1ojjIGhV5PTChOwyxhtMboEIdKNBgRnBcl3SSNhUqbHg23D1PYH34FNhe2lXjIoZI0hC5S7BQTjhqbQ0nKkfHm7511ojqwUitHyk1d/wP/esRfdoUoWUFPgswiWa2ze0juIVltPtxDepnMKiGlr0r5hDbAXlDPgqCBLlPY0LnRez+ZPJ8HackXp5BlmNcNlJvfhXIizsfQjLHj7ySHhwtDOjdk0dAL7urjrE/ZoXtNYle7uS8ia4Rit/1Z8Bd6YFY8CbXLodCGk2GFDgtRaeW8i2YCB3uBlpanqH5ssE7Cbkkfdmyarrbe1iLnoUmWtANk6zb0OC+pIYlO7Ol1J6X3ZCQeWIuKpqcVWNXIdT/LbXXrc0bnGBtYG+SiszmkWYTW4HDiUKIsF2mS7Gtg8C5rh5CoO+eZ5qC0oguRcXaBWFgtOxfIOd3mkI1NTKzvZ/LrFzVpVMT3/SWlara9Fmp7U6j1JhI3O6FYoZ3TzXEek55l6Nlrw1lhCB9zCB/MW8Ki1sIRsy2WlENriPUG2zCvPZlK6j4YLrMm5Xkof/U8Xb1D3sFI8RfernHnWBj5OjnqGugFG3ZOe9vO44kiTJGswsQ/a+3IfBGu/rMWkhtSUd1p8Ru5hvZkLEWBPFYuDJXjsuuejf7nuVmHxl0UjcWmBM7LeqHZcZ9O0ibJ2wsFDmfup8NMYD0jUd2WYs6m1LJrlM/8m6PDuKd/vKlQWnrz9epvSXh5GO1JOXu+nVupMHs157mRwgTw7nWAR+HHDf8XFeNh2ZAJAAA=\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var closeButton = '_1ukx6mxa';\nexport var confirmModalContainer = '_1ukx6mxf';\nexport var confirmModalContent = '_1ukx6mxe';\nexport var contentHide = '_1ukx6mx5';\nexport var heightVar = 'var(--_1ukx6mx1)';\nexport var minHeightVar = 'var(--_1ukx6mx2)';\nexport var modalContent = '_1ukx6mx9';\nexport var modalContentWrapper = '_1ukx6mx8';\nexport var modalDescription = '_1ukx6mxc';\nexport var modalFooter = '_1ukx6mxd';\nexport var modalHeader = '_1ukx6mxb';\nexport var modalOverlay = '_1ukx6mx6';\nexport var promptModalContent = '_1ukx6mxg';\nexport var widthVar = 'var(--_1ukx6mx0)';","import { DialogTrigger } from '@radix-ui/react-dialog';\nimport clsx from 'clsx';\nimport type { PropsWithChildren } from 'react';\nimport { createContext, useCallback, useContext, useState } from 'react';\n\nimport type { ButtonProps } from '../button';\nimport { Button } from '../button';\nimport type { ModalProps } from './modal';\nimport { Modal } from './modal';\nimport * as styles from './styles.css';\n\nexport interface ConfirmModalProps extends ModalProps {\n  confirmButtonOptions?: Omit<ButtonProps, 'children'>;\n  onConfirm?: (() => void) | (() => Promise<void>);\n  onCancel?: () => void;\n  confirmText?: React.ReactNode;\n  cancelText?: React.ReactNode;\n  cancelButtonOptions?: Omit<ButtonProps, 'children'>;\n  reverseFooter?: boolean;\n  /**\n   * Auto focus on confirm button when modal opened\n   * @default true\n   */\n  autoFocusConfirm?: boolean;\n}\n\nexport const ConfirmModal = ({\n  children,\n  confirmButtonOptions,\n  // FIXME: we need i18n\n  confirmText,\n  cancelText = 'Cancel',\n  cancelButtonOptions,\n  reverseFooter,\n  onConfirm,\n  onCancel,\n  width = 480,\n  autoFocusConfirm = true,\n  ...props\n}: ConfirmModalProps) => {\n  const onConfirmClick = useCallback(() => {\n    Promise.resolve(onConfirm?.()).catch(err => {\n      console.error(err);\n    });\n  }, [onConfirm]);\n  return (\n    <Modal\n      contentOptions={{\n        className: styles.confirmModalContainer,\n        onPointerDownOutside: e => {\n          e.stopPropagation();\n          onCancel?.();\n        },\n      }}\n      width={width}\n      closeButtonOptions={{\n        onClick: onCancel,\n      }}\n      {...props}\n    >\n      {children ? (\n        <div className={styles.confirmModalContent}>{children}</div>\n      ) : null}\n      <div\n        className={clsx(styles.modalFooter, {\n          modalFooterWithChildren: !!children,\n          reverse: reverseFooter,\n        })}\n      >\n        <DialogTrigger asChild>\n          <Button\n            onClick={onCancel}\n            data-testid=\"confirm-modal-cancel\"\n            {...cancelButtonOptions}\n          >\n            {cancelText}\n          </Button>\n        </DialogTrigger>\n        <Button\n          onClick={onConfirmClick}\n          data-testid=\"confirm-modal-confirm\"\n          autoFocus={autoFocusConfirm}\n          {...confirmButtonOptions}\n        >\n          {confirmText}\n        </Button>\n      </div>\n    </Modal>\n  );\n};\n\ninterface OpenConfirmModalOptions {\n  autoClose?: boolean;\n  onSuccess?: () => void;\n}\ninterface ConfirmModalContextProps {\n  modalProps: ConfirmModalProps;\n  openConfirmModal: (\n    props?: ConfirmModalProps,\n    options?: OpenConfirmModalOptions\n  ) => void;\n  closeConfirmModal: () => void;\n}\nconst ConfirmModalContext = createContext<ConfirmModalContextProps>({\n  modalProps: { open: false },\n  openConfirmModal: () => {},\n  closeConfirmModal: () => {},\n});\nexport const ConfirmModalProvider = ({ children }: PropsWithChildren) => {\n  const [modalProps, setModalProps] = useState<ConfirmModalProps>({\n    open: false,\n  });\n\n  const setLoading = useCallback((value: boolean) => {\n    setModalProps(prev => ({\n      ...prev,\n      confirmButtonOptions: {\n        ...prev.confirmButtonOptions,\n        loading: value,\n      },\n    }));\n  }, []);\n\n  const closeConfirmModal = useCallback(() => {\n    setModalProps({ open: false });\n  }, []);\n\n  const openConfirmModal = useCallback(\n    (props?: ConfirmModalProps, options?: OpenConfirmModalOptions) => {\n      const { autoClose = true, onSuccess } = options ?? {};\n      if (!props) {\n        setModalProps({ open: true });\n        return;\n      }\n\n      const { onConfirm: _onConfirm, ...otherProps } = props;\n\n      const onConfirm = () => {\n        setLoading(true);\n        return Promise.resolve(_onConfirm?.())\n          .then(() => onSuccess?.())\n          .catch(console.error)\n          .finally(() => setLoading(false))\n          .finally(() => autoClose && closeConfirmModal());\n      };\n      setModalProps({ ...otherProps, onConfirm, open: true });\n    },\n    [closeConfirmModal, setLoading]\n  );\n\n  const onOpenChange = useCallback(\n    (open: boolean) => {\n      modalProps.onOpenChange?.(open);\n      setModalProps(props => ({ ...props, open }));\n    },\n    [modalProps]\n  );\n\n  return (\n    <ConfirmModalContext.Provider\n      value={{ openConfirmModal, closeConfirmModal, modalProps }}\n    >\n      {children}\n      {/* TODO(@catsjuice): multi-instance support(unnecessary for now) */}\n      <ConfirmModal {...modalProps} onOpenChange={onOpenChange} />\n    </ConfirmModalContext.Provider>\n  );\n};\n\nexport const useConfirmModal = () => {\n  const context = useContext(ConfirmModalContext);\n  if (!context) {\n    throw new Error(\n      'useConfirmModal must be used within a ConfirmModalProvider'\n    );\n  }\n  return {\n    openConfirmModal: context.openConfirmModal,\n    closeConfirmModal: context.closeConfirmModal,\n  };\n};\n","import { DialogTrigger } from '@radix-ui/react-dialog';\nimport { cssVar } from '@toeverything/theme';\nimport { memo, useCallback } from 'react';\nimport { Link } from 'react-router-dom';\n\nimport type { ButtonProps } from '../button';\nimport { Button } from '../button';\nimport type { ModalProps } from './modal';\nimport { Modal } from './modal';\nimport * as styles from './overlay-modal.css';\n\nconst defaultContentOptions: ModalProps['contentOptions'] = {\n  style: {\n    padding: 0,\n    overflow: 'hidden',\n    boxShadow: cssVar('menuShadow'),\n  },\n};\nconst defaultOverlayOptions: ModalProps['overlayOptions'] = {\n  style: {\n    background: cssVar('white80'),\n    backdropFilter: 'blur(2px)',\n  },\n};\n\nexport interface OverlayModalProps extends ModalProps {\n  to?: string;\n  external?: boolean;\n  topImage?: React.ReactNode;\n  confirmText?: string;\n  confirmButtonOptions?: ButtonProps;\n  onConfirm?: () => void;\n  cancelText?: string;\n  cancelButtonOptions?: ButtonProps;\n  withoutCancelButton?: boolean;\n}\n\nexport const OverlayModal = memo(function OverlayModal({\n  open,\n  topImage,\n  onOpenChange,\n  title,\n  description,\n  onConfirm,\n  to,\n  external,\n  confirmButtonOptions,\n  cancelButtonOptions,\n  withoutCancelButton,\n  contentOptions = defaultContentOptions,\n  overlayOptions = defaultOverlayOptions,\n  // FIXME: we need i18n\n  cancelText = 'Cancel',\n  confirmText = 'Confirm',\n  width = 400,\n}: OverlayModalProps) {\n  const handleConfirm = useCallback(() => {\n    onOpenChange?.(false);\n    onConfirm?.();\n  }, [onOpenChange, onConfirm]);\n\n  return (\n    <Modal\n      contentOptions={contentOptions}\n      overlayOptions={overlayOptions}\n      open={open}\n      width={width}\n      onOpenChange={onOpenChange}\n      withoutCloseButton\n    >\n      {topImage}\n      <div className={styles.title}>{title}</div>\n      <div className={styles.content}>{description}</div>\n      <div className={styles.footer}>\n        {!withoutCancelButton ? (\n          <DialogTrigger asChild>\n            <Button {...cancelButtonOptions}>{cancelText}</Button>\n          </DialogTrigger>\n        ) : null}\n\n        {to ? (\n          external ? (\n            //FIXME: we need a more standardized way to implement this link with other click events\n            <a href={to} target=\"_blank\" rel=\"noreferrer\">\n              <Button onClick={handleConfirm} {...confirmButtonOptions}>\n                {confirmText}\n              </Button>\n            </a>\n          ) : (\n            <Link to={to}>\n              <Button onClick={handleConfirm} {...confirmButtonOptions}>\n                {confirmText}\n              </Button>\n            </Link>\n          )\n        ) : (\n          <Button onClick={handleConfirm} {...confirmButtonOptions}>\n            {confirmText}\n          </Button>\n        )}\n      </div>\n    </Modal>\n  );\n});\n","import \"../component/src/ui/modal/overlay-modal.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/ui/modal/overlay-modal.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xMzAwcXZ3MCB7CiAgcGFkZGluZzogMjBweCAyNHB4IDhweCAyNHB4OwogIGZvbnQtc2l6ZTogdmFyKC0tYWZmaW5lLWZvbnQtaC02KTsKICBmb250LWZhbWlseTogdmFyKC0tYWZmaW5lLWZvbnQtZmFtaWx5KTsKICBmb250LXdlaWdodDogNjAwOwogIGxpbmUtaGVpZ2h0OiAyNnB4Owp9Ci5fMTMwMHF2dzEgewogIHBhZGRpbmc6IDBweCAyNHB4IDhweDsKICBmb250LXNpemU6IHZhcigtLWFmZmluZS1mb250LWJhc2UpOwogIGxpbmUtaGVpZ2h0OiAyNHB4OwogIGZvbnQtd2VpZ2h0OiA0MDA7Cn0KLl8xMzAwcXZ3MiB7CiAgcGFkZGluZzogMjBweCAyNHB4OwogIGRpc3BsYXk6IGZsZXg7CiAganVzdGlmeS1jb250ZW50OiBmbGV4LWVuZDsKICBnYXA6IDIwcHg7Cn0KLl8xMzAwcXZ3MyB7CiAgZm9udC13ZWlnaHQ6IDUwMDsKfQouXzEzMDBxdnc0IHsKICBjb2xvcjogdmFyKC0tYWZmaW5lLXB1cmUtd2hpdGUpOwogIHRleHQtZGVjb3JhdGlvbjogbm9uZTsKICBjdXJzb3I6IHBvaW50ZXI7Cn0KLl8xMzAwcXZ3NDp2aXNpdGVkIHsKICBjb2xvcjogdmFyKC0tYWZmaW5lLXB1cmUtd2hpdGUpOwp9\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var buttonText = '_1300qvw4';\nexport var content = '_1300qvw1';\nexport var footer = '_1300qvw2';\nexport var gotItBtn = '_1300qvw3';\nexport var title = '_1300qvw0';","import \"../component/src/ui/notification/styles.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/ui/notification/styles.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACoVU0W7bMAx871dwAQYsDwrsNO06Ff2SoRhki7bZKJIhMXGyof8+SHYW2026R5E0j3c8evUrfzsWW10/wp87gMJ5jV54pWkfJDy1x+dLtCPNjYR8Egx8MighOEO6Dx9FaJR2nYSD8t+EUFVFFoegyJepSpXb2ru91aJ0xvlz7XmabDmCuFqxThVXUxHi/W51fn5PzFqlNdlaQv4Y5x/ln1JeU2iNOkmoDCZ+ylBtBTHuQh8UgZXnmHrbB6bqJEpnGS1LCK0qURTIHaKdNP+RmjdIdcMS1pteu8/BSrSMftJGpTbDAm52aU0cY9YFYKd8TVb4foY8m/FXEA71uH+eZV+fR1Of31fF3kzFLsaNsvhVkq720Q95fLsD+srEZ0NaR7kAGI8sLgk0htpAIaa6hhhFEliCdZ1XberqLItuGHCTJSQTbTaXOhUG+o0S8oc+9B89ykRhVjQ3jU5FVxW5T85sXSAmZyV4NIrpgFPfS2CvbGiVR8sXs0eOFqdQUhZYOY8D5OC5xWIKo4rgzJ4TDNmAPOg/O2myDXriz45wONjCqHKbuLhWlcQnCdkq28xma+Lahn/H5fIjCfhCu9Z5VpHf6Bv8qRUrURmn+GXBfo+L1/5Er3Jh1571B7i1jur2Oh6Wtwapx4tOMA8fPDNRpI/vlh/Ntu7n6Zl1xI2g0tlXuGD1qXTnLwsmNv9Y9z8mYbBiCffJtu9/AeaKI8+XBQAA\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var action = '_1jxbkdgc';\nexport var actionButton = '_1jxbkdgd';\nexport var actionTextColor = 'var(--_1jxbkdg3)';\nexport var card = '_1jxbkdg6';\nexport var cardBorderColor = 'var(--_1jxbkdg2)';\nexport var cardColor = 'var(--_1jxbkdg0)';\nexport var cardForeground = 'var(--_1jxbkdg1)';\nexport var cardInner = '_1jxbkdg7';\nexport var closeButton = '_1jxbkdge';\nexport var closeIcon = '_1jxbkdgf';\nexport var closeIconColor = 'var(--_1jxbkdg5)';\nexport var headAlignWrapper = '_1jxbkdg9';\nexport var header = '_1jxbkdg8';\nexport var icon = '_1jxbkdga';\nexport var iconColor = 'var(--_1jxbkdg4)';\nexport var main = '_1jxbkdgg';\nexport var title = '_1jxbkdgb';","import { cssVar } from '@toeverything/theme';\n\nimport type { NotificationStyle, NotificationTheme } from './types';\n\nexport const getCardColor = (\n  style: NotificationStyle,\n  theme: NotificationTheme\n) => {\n  if (style === 'information') {\n    const map: Record<NotificationTheme, string> = {\n      error: cssVar('backgroundErrorColor'),\n      info: cssVar('backgroundProcessingColor'),\n      success: cssVar('backgroundSuccessColor'),\n      warning: cssVar('backgroundWarningColor'),\n    };\n    return map[theme];\n  }\n\n  if (style === 'alert') {\n    const map: Record<NotificationTheme, string> = {\n      error: cssVar('errorColor'),\n      info: cssVar('processingColor'),\n      success: cssVar('successColor'),\n      warning: cssVar('warningColor'),\n    };\n    return map[theme];\n  }\n\n  return cssVar('white');\n};\n\nexport const getActionTextColor = (\n  style: NotificationStyle,\n  theme: NotificationTheme\n) => {\n  if (style === 'information') {\n    const map: Record<NotificationTheme, string> = {\n      error: cssVar('errorColor'),\n      info: cssVar('processingColor'),\n      success: cssVar('successColor'),\n      warning: cssVar('warningColor'),\n    };\n    return map[theme];\n  }\n\n  return getCardForegroundColor(style);\n};\n\nexport const getCardBorderColor = (style: NotificationStyle) => {\n  return style === 'normal' ? cssVar('borderColor') : cssVar('black10');\n};\n\nexport const getCardForegroundColor = (style: NotificationStyle) => {\n  return style === 'alert' ? cssVar('pureWhite') : cssVar('textPrimaryColor');\n};\n\nexport const getIconColor = (\n  style: NotificationStyle,\n  theme: NotificationTheme,\n  iconColor?: string\n) => {\n  if (style !== 'alert') {\n    const map: Record<NotificationTheme, string> = {\n      error: cssVar('errorColor'),\n      info: cssVar('processingColor'),\n      success: cssVar('successColor'),\n      warning: cssVar('warningColor'),\n    };\n    return iconColor || map[theme];\n  }\n\n  return iconColor || cssVar('pureWhite');\n};\n\nexport const getCloseIconColor = (style: NotificationStyle) => {\n  return style === 'alert'\n    ? getCardForegroundColor(style)\n    : cssVar('iconColor');\n};\n","import { CloseIcon, InformationFillDuotoneIcon } from '@blocksuite/icons/rc';\nimport { assignInlineVars } from '@vanilla-extract/dynamic';\nimport clsx from 'clsx';\nimport { type HTMLAttributes, useCallback } from 'react';\n\nimport { Button, IconButton } from '../button';\nimport * as styles from './styles.css';\nimport type { Notification } from './types';\nimport {\n  getActionTextColor,\n  getCardBorderColor,\n  getCardColor,\n  getCardForegroundColor,\n  getCloseIconColor,\n  getIconColor,\n} from './utils';\n\nexport interface NotificationCardProps extends HTMLAttributes<HTMLDivElement> {\n  notification: Notification;\n}\n\nexport const NotificationCard = ({ notification }: NotificationCardProps) => {\n  const {\n    theme = 'info',\n    style = 'normal',\n    icon = <InformationFillDuotoneIcon />,\n    iconColor,\n    thumb,\n    action,\n    title,\n    footer,\n    alignMessage = 'title',\n    onDismiss,\n    rootAttrs,\n  } = notification;\n\n  const onActionClicked = useCallback(() => {\n    action?.onClick()?.catch(console.error);\n    if (action?.autoClose !== false) {\n      onDismiss?.();\n    }\n  }, [action, onDismiss]);\n\n  return (\n    <div\n      style={assignInlineVars({\n        [styles.cardColor]: getCardColor(style, theme),\n        [styles.cardBorderColor]: getCardBorderColor(style),\n        [styles.cardForeground]: getCardForegroundColor(style),\n        [styles.actionTextColor]: getActionTextColor(style, theme),\n        [styles.iconColor]: getIconColor(style, theme, iconColor),\n        [styles.closeIconColor]: getCloseIconColor(style),\n      })}\n      data-with-icon={icon ? '' : undefined}\n      {...rootAttrs}\n      className={clsx(styles.card, rootAttrs?.className)}\n    >\n      {thumb}\n      <div className={styles.cardInner}>\n        <header className={styles.header}>\n          {icon ? (\n            <div className={clsx(styles.icon, styles.headAlignWrapper)}>\n              {icon}\n            </div>\n          ) : null}\n          <div className={styles.title}>{title}</div>\n\n          {action ? (\n            <div className={clsx(styles.headAlignWrapper, styles.action)}>\n              <Button\n                className={styles.actionButton}\n                onClick={onActionClicked}\n                {...action.buttonProps}\n              >\n                {action.label}\n              </Button>\n            </div>\n          ) : null}\n          <div\n            data-float={!!thumb}\n            className={clsx(styles.headAlignWrapper, styles.closeButton)}\n          >\n            <IconButton\n              data-testid=\"notification-close-button\"\n              onClick={onDismiss}\n            >\n              <CloseIcon className={styles.closeIcon} width={16} height={16} />\n            </IconButton>\n          </div>\n        </header>\n        <main data-align={alignMessage} className={styles.main}>\n          {notification.message}\n        </main>\n        <footer>{footer}</footer>\n      </div>\n    </div>\n  );\n};\n","import {\n  InformationFillDuotoneIcon,\n  SingleSelectSelectSolidIcon,\n} from '@blocksuite/icons/rc';\nimport { assignInlineVars } from '@vanilla-extract/dynamic';\nimport { type CSSProperties, type FC, useMemo } from 'react';\nimport { type ExternalToast, toast, Toaster } from 'sonner';\n\nimport { NotificationCard } from './notification-card';\nimport type {\n  Notification,\n  NotificationCenterProps,\n  NotificationCustomRendererProps,\n} from './types';\n\nexport function NotificationCenter({ width = 380 }: NotificationCenterProps) {\n  const style = useMemo(() => {\n    return {\n      ...assignInlineVars({\n        // override css vars inside sonner\n        '--width': `${width}px`,\n      }),\n      // radix-ui will lock pointer-events when dialog is open\n      pointerEvents: 'auto',\n    } satisfies CSSProperties;\n  }, [width]);\n\n  const toastOptions = useMemo(\n    () => ({\n      style: {\n        width: '100%',\n      },\n    }),\n    []\n  );\n\n  return (\n    <Toaster\n      className=\"affine-notification-center\"\n      style={style}\n      toastOptions={toastOptions}\n    />\n  );\n}\n\n/**\n *\n * @returns {string} toastId\n */\nexport function notify(notification: Notification, options?: ExternalToast) {\n  return toast.custom(id => {\n    const onDismiss = () => {\n      notification.onDismiss?.();\n      toast.dismiss(id);\n    };\n    return <NotificationCard notification={{ ...notification, onDismiss }} />;\n  }, options);\n}\n\nnotify.error = (notification: Notification, options?: ExternalToast) => {\n  return notify(\n    {\n      icon: <InformationFillDuotoneIcon />,\n      style: 'normal',\n      theme: 'error',\n      ...notification,\n    },\n    options\n  );\n};\n\nnotify.success = (notification: Notification, options?: ExternalToast) => {\n  return notify(\n    {\n      icon: <SingleSelectSelectSolidIcon />,\n      style: 'normal',\n      theme: 'success',\n      ...notification,\n    },\n    options\n  );\n};\n\nnotify.warning = (notification: Notification, options?: ExternalToast) => {\n  return notify(\n    {\n      icon: <InformationFillDuotoneIcon />,\n      style: 'normal',\n      theme: 'warning',\n      ...notification,\n    },\n    options\n  );\n};\n\nnotify.custom = (\n  Component: FC<NotificationCustomRendererProps>,\n  options?: ExternalToast\n) => {\n  return toast.custom(id => {\n    return <Component onDismiss={() => toast.dismiss(id)} />;\n  }, options);\n};\n\nnotify.dismiss = toast.dismiss;\n","import * as RadixRadioGroup from '@radix-ui/react-radio-group';\nimport { assignInlineVars } from '@vanilla-extract/dynamic';\nimport clsx from 'clsx';\nimport {\n  createRef,\n  memo,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n} from 'react';\n\nimport { withUnit } from '../../utils/with-unit';\nimport * as styles from './styles.css';\nimport type { RadioItem, RadioProps } from './types';\n\n/**\n * ### Radio button group (Tabs)\n * A tab-like radio button group\n *\n * #### 1. Basic usage with fixed width\n * ```tsx\n * <RadioGroup\n *   width={300}\n *   value={value}\n *   onChange={setValue}\n *   items={['Radio 1', 'Radio 2, Longer', 'S3']}\n *  />\n * ```\n *\n * #### 2. Dynamic width\n * ```tsx\n * <RadioGroup\n *   width=\"100%\"\n *   value={value}\n *   onChange={setValue}\n *   items={['Radio 1', 'Radio 2, Longer', 'S3']}\n * />\n * ```\n *\n * #### 3. `ReactNode` as label\n * ```tsx\n * const [value, setValue] = useState('ai');\n * const items: RadioItem[] = [\n *   {\n *     value: 'ai',\n *     label: <AiIcon width={20} height={20} />,\n *     style: { width: 28 },\n *   },\n *   {\n *     value: 'calendar',\n *     label: <TodayIcon width={20} height={20} />,\n *     style: { width: 28 },\n *   },\n * ];\n * return (\n *   <RadioGroup\n *     value={value}\n *     onChange={setValue}\n *     items={items}\n *     padding={4}\n *     borderRadius={12}\n *     gap={8}\n *   />\n * );\n * ```\n */\nexport const RadioGroup = memo(function RadioGroup({\n  items,\n  value,\n  width,\n  style,\n  padding = 2,\n  gap = 4,\n  borderRadius = 10,\n  itemHeight = 28,\n  animationDuration = 250,\n  animationEasing = 'cubic-bezier(.18,.22,0,1)',\n  activeItemClassName,\n  activeItemStyle,\n  iconMode,\n  onChange,\n}: RadioProps) {\n  const animationTImerRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n  const finalItems = useMemo(() => {\n    return items\n      .map(value =>\n        typeof value === 'string' ? ({ value } as RadioItem) : value\n      )\n      .map(item => ({\n        ...item,\n        ref: createRef<HTMLButtonElement>(),\n        indicatorRef: createRef<HTMLDivElement>(),\n      }));\n  }, [items]);\n  const finalStyle = useMemo(\n    () => ({\n      width,\n      ...style,\n      ...assignInlineVars({\n        [styles.outerPadding]: withUnit(padding, 'px'),\n        [styles.outerRadius]: withUnit(borderRadius, 'px'),\n        [styles.itemGap]: withUnit(gap, 'px'),\n        [styles.itemHeight]: withUnit(itemHeight, 'px'),\n      }),\n    }),\n    [width, style, padding, borderRadius, gap, itemHeight]\n  );\n\n  const animate = useCallback(\n    (oldValue?: string, newValue?: string) => {\n      if (!oldValue || !newValue) return;\n      const oldItem = finalItems.find(item => item.value === oldValue);\n      const newItem = finalItems.find(item => item.value === newValue);\n      if (!oldItem || !newItem) return;\n      const oldRect = oldItem.ref.current?.getBoundingClientRect();\n      const newRect = newItem.ref.current?.getBoundingClientRect();\n      if (!oldRect || !newRect) return;\n      const activeIndicator = newItem.indicatorRef.current;\n      if (!activeIndicator) return;\n\n      activeIndicator.style.transform = `translate3d(${oldRect.left - newRect.left}px,0,0)`;\n      activeIndicator.style.transition = 'none';\n      activeIndicator.style.width = `${oldRect.width}px`;\n\n      const animation = `${withUnit(animationDuration, 'ms')} ${animationEasing}`;\n\n      if (animationTImerRef.current) clearTimeout(animationTImerRef.current);\n      animationTImerRef.current = setTimeout(() => {\n        animationTImerRef.current = null;\n        activeIndicator.style.transition = `transform ${animation}, width ${animation}`;\n        activeIndicator.style.transform = 'none';\n        activeIndicator.style.width = '';\n      }, 50);\n    },\n    [animationDuration, animationEasing, finalItems]\n  );\n\n  // animate on value change\n  // useEffect: in case that value is changed from outside\n  const prevValue = useRef(value);\n  useEffect(() => {\n    const currentValue = value;\n    const previousValue = prevValue.current;\n    if (currentValue !== previousValue) {\n      animate(previousValue, currentValue);\n      prevValue.current = currentValue;\n    }\n  }, [animate, value]);\n\n  return (\n    <RadixRadioGroup.Root\n      value={value}\n      onValueChange={onChange}\n      className={styles.radioButtonGroup}\n      style={finalStyle}\n      data-icon-mode={iconMode}\n    >\n      {finalItems.map(({ customRender, ...item }, index) => {\n        const testId = item.testId ? { 'data-testid': item.testId } : {};\n        const active = item.value === value;\n\n        const classMap = { [styles.radioButton]: true };\n        if (activeItemClassName) classMap[activeItemClassName] = active;\n        if (item.className) classMap[item.className] = true;\n\n        const style = { ...item.style };\n        if (activeItemStyle && active) Object.assign(style, activeItemStyle);\n\n        return (\n          <RadixRadioGroup.Item\n            ref={item.ref}\n            key={item.value}\n            value={item.value}\n            className={clsx(classMap)}\n            style={style}\n            {...testId}\n            {...item.attrs}\n          >\n            <RadixRadioGroup.Indicator\n              forceMount\n              className={styles.indicator}\n              ref={item.indicatorRef}\n            />\n            <span className={styles.radioButtonContent}>\n              {customRender?.(item, index) ?? item.label ?? item.value}\n            </span>\n          </RadixRadioGroup.Item>\n        );\n      })}\n    </RadixRadioGroup.Root>\n  );\n});\n","import \"../component/src/ui/radio/styles.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/ui/radio/styles.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACp1Uy27bMBC8+yuIAAXiAw25TdNCRnJoP6PIYUWupK1pkiBXlp0i/16QtmUpsdu0J1GznH3OcqELb3tzJ37NhKgN7kqxXM2E8C4Sk7OlCGiAaYsJrVzQGGQATV0shQKjbrcQbqU8uFnOhRRjoJjPE69FalouJ6ZP2eJBa7JNKe78Tnz1u4TVzrKM9IwnAtQ1WZQZ38XM0xS9gX2Zc07Azy4y1XupnGW0XAqFljEkExhqrCTGTRzDyhkXXoWIPbFqc6TvySwZAxOEfQ7at8QooweFpbCuD+AT3EUMMqJBxQm2OBTRH+u+L4rV7GW2ODb7hwYGGRkYH25Ui2qN+uYpj+BdSflAm0NOV3x2dvBatm6LIfuuQK2b4DqrLweoOmZnvw23ZKbmKAfvpJyVG6fxgUOHT2IxFs8fMk+8Q+Yaa+gMv8Pn//XoHAlUEu24RZ8z+VmS1YPMBxlVxqn15PKjiNsmU65eup+ayZos06Mir8jub1M4fEZTOBPmF3Zwun6TlZouYjI14KfwxwzLHqs1sQTvZcAmr711UgdoRtV+ydWeHwaoojMdX3oYyLYYiPPOkOa2FMui+DB+CU7/BmsuRZGO7Pzx9M9CHYadMtnJ2IJ2/SvugXS05avOgyLen8IHsLF2YSNdoIZsmXM7C/WNFB/FpDGDt+Vq9vIb68DScVcFAAA=\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var indicator = 'd0pnwl7';\nexport var itemGap = 'var(--d0pnwl2)';\nexport var itemHeight = 'var(--d0pnwl3)';\nexport var outerPadding = 'var(--d0pnwl0)';\nexport var outerRadius = 'var(--d0pnwl1)';\nexport var radioButton = 'd0pnwl4';\nexport var radioButtonContent = 'd0pnwl5';\nexport var radioButtonGroup = 'd0pnwl6';","import \"../component/src/ui/scrollbar/index.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/ui/scrollbar/index.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACo1U247bIBB9z1dMI62UqCWyc1NFtP2RqqoI4JhdwliAc2m1/15xiTdE2W1ebIZhZg5nzjD7XR9f+j+nYwV/RwCEOG5R6y2z5KiEbyl8706bEUC26qp6CmYr1a717zYepG00HsmZQquEkGYzehvNLtnrmL1Dp7xCQ4FtHereyxDqsaNQhZWWTUi5ThVtrpDNoWIyvWXmkg07xpU/w2zhYDZ3EU/ayom3jL/uLPZGUDgwOyGENY0ykmzRCmkJR412WiL+KZhnpGUuU0I8ds9jb3s5/hVvM5Soi8B5dN7yU9BXnP5BG2WdJ7xVWsRYoVyn2ZkCR+Ol8Q6+qH2H1jPji+DFnVJX7mWZrdEyMhf+RCgreWKPo+73Jnh6Jy1xUkvuKRg0uT09bwnLhy+7+T6JzBvNTO8K5IqtsnsxBmb1ypXoaRtEFe/wcf8GB3GSoxHMnoduDig503xyHyp8hUV3ioezFrIIuxM41Eo8qpdl0ovzzMvncRqBW6FURcQqOvfM7pQhcQjWVSn1iDsQCATqeVXitEyo3lFYhpirtOubUbNSM68O8tM5EOqgri82ULcqx/t9uP+P45H+KY7mHptrSreyQStjeJ4DCuPx5vNnJMNNPcxG1FqDdk/TUjMvJ2RVPX2D8J0+8Lrtlbk8h8tl6lHYuhxLe2//ALhzY91MBQAA\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var TableScrollbar = '_1wjuzxw5';\nexport var scrollTopBorder = '_1wjuzxw1';\nexport var scrollableContainer = '_1wjuzxw3';\nexport var scrollableContainerRoot = '_1wjuzxw0';\nexport var scrollableViewport = '_1wjuzxw2';\nexport var scrollbar = '_1wjuzxw4';\nexport var scrollbarThumb = '_1wjuzxw6';","import * as ScrollArea from '@radix-ui/react-scroll-area';\nimport clsx from 'clsx';\nimport type { RefAttributes } from 'react';\nimport { forwardRef } from 'react';\n\nimport * as styles from './index.css';\n\nexport const ScrollableRoot = forwardRef<\n  HTMLDivElement,\n  ScrollArea.ScrollAreaProps & RefAttributes<HTMLDivElement>\n>(({ children, className, ...props }, ref) => {\n  return (\n    <ScrollArea.Root\n      {...props}\n      ref={ref}\n      className={clsx(className, styles.scrollableContainerRoot)}\n    >\n      {children}\n    </ScrollArea.Root>\n  );\n});\n\nScrollableRoot.displayName = 'ScrollableRoot';\n\nexport const ScrollableViewport = forwardRef<\n  HTMLDivElement,\n  ScrollArea.ScrollAreaViewportProps & RefAttributes<HTMLDivElement>\n>(({ children, className, ...props }, ref) => {\n  return (\n    <ScrollArea.Viewport\n      {...props}\n      ref={ref}\n      className={clsx(className, styles.scrollableViewport)}\n    >\n      {children}\n    </ScrollArea.Viewport>\n  );\n});\n\nScrollableViewport.displayName = 'ScrollableViewport';\n\nexport const ScrollableScrollbar = forwardRef<\n  HTMLDivElement,\n  ScrollArea.ScrollAreaScrollbarProps & RefAttributes<HTMLDivElement>\n>(({ children, className, ...props }, ref) => {\n  return (\n    <ScrollArea.Scrollbar\n      orientation=\"vertical\"\n      {...props}\n      ref={ref}\n      className={clsx(className, styles.scrollbar)}\n    >\n      <ScrollArea.Thumb className={styles.scrollbarThumb} />\n      {children}\n    </ScrollArea.Scrollbar>\n  );\n});\n\nScrollableScrollbar.displayName = 'ScrollableScrollbar';\n\nexport const Scrollable = {\n  Root: ScrollableRoot,\n  Viewport: ScrollableViewport,\n  Scrollbar: ScrollableScrollbar,\n};\n","import { debounce } from 'lodash-es';\nimport { useMemo, useState } from 'react';\n\nexport function useHasScrollTop() {\n  const [hasScrollTop, setHasScrollTop] = useState(false);\n  const containerRefFn = useMemo(() => {\n    let unsub: (() => void) | null = null;\n    return (container: HTMLElement | null) => {\n      unsub?.();\n      const updateScrollTop = debounce(() => {\n        if (container) {\n          setTimeout(() => {\n            const hasScrollTop = container.scrollTop > 0;\n            setHasScrollTop(hasScrollTop);\n          });\n        }\n      }, 50);\n      container?.addEventListener('scroll', updateScrollTop);\n      updateScrollTop();\n      unsub = () => {\n        container?.removeEventListener('scroll', updateScrollTop);\n      };\n    };\n  }, []);\n\n  return [containerRefFn, hasScrollTop] as const;\n}\n","import * as ScrollArea from '@radix-ui/react-scroll-area';\nimport clsx from 'clsx';\nimport type { PropsWithChildren } from 'react';\n\nimport * as styles from './index.css';\nimport { useHasScrollTop } from './use-has-scroll-top';\n\nexport type ScrollableContainerProps = {\n  showScrollTopBorder?: boolean;\n  inTableView?: boolean;\n  className?: string;\n  viewPortClassName?: string;\n  styles?: React.CSSProperties;\n  scrollBarClassName?: string;\n};\n\nexport const ScrollableContainer = ({\n  children,\n  showScrollTopBorder = false,\n  inTableView = false,\n  className,\n  styles: _styles,\n  viewPortClassName,\n  scrollBarClassName,\n}: PropsWithChildren<ScrollableContainerProps>) => {\n  const [setContainer, hasScrollTop] = useHasScrollTop();\n  return (\n    <ScrollArea.Root\n      style={_styles}\n      className={clsx(styles.scrollableContainerRoot, className)}\n    >\n      <div\n        data-has-scroll-top={hasScrollTop}\n        className={clsx({ [styles.scrollTopBorder]: showScrollTopBorder })}\n      />\n      <ScrollArea.Viewport\n        className={clsx([styles.scrollableViewport, viewPortClassName])}\n        ref={setContainer}\n      >\n        <div className={styles.scrollableContainer}>{children}</div>\n      </ScrollArea.Viewport>\n      <ScrollArea.Scrollbar\n        orientation=\"vertical\"\n        className={clsx(styles.scrollbar, scrollBarClassName, {\n          [styles.TableScrollbar]: inTableView,\n        })}\n      >\n        <ScrollArea.Thumb className={styles.scrollbarThumb} />\n      </ScrollArea.Scrollbar>\n    </ScrollArea.Root>\n  );\n};\n","import \"../component/src/ui/skeleton/index.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/ui/skeleton/index.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACoVU246jMAx95yuskVZqpaaCXma66ct8xr6tDBiwCAkKaTvVqv++SugFWkbzQpLjc3yJHT5rOhcWG+rgb/Jx5Hp3iuFfBBD/CguAaTFjd5aQ7COASwSwfbXFy+3NmsTfSi/R52u4ZBzOWdRdYWwj+61CR39mwnudvyYwzR6RB/n8yL5Ey1taq6DJuWsVniWkymS1J504d5UMXv2xIi4rJ2G9ar/8uVD0JbrKsq4lxB5pTceOjZZgSaHjI+1HcaRMqTCWQrzMaEfaSXh7G2sx7Yw6OPJoamxOVljM+dBJYF2RZectrDty17iD3qyDCrO6tOagc5EZZayEI9qZEFgUrEm0CjOqjPKeg30+SnMd0rsWfyv2KZGtv5KBZhM0T6TYSwek7RRp90R6nyJt+iRuHUiWK2o80KAtWQtnWl/7GEyNc6a544MQHyEEam6wv/HHc1h1QNiRYC3MwflZ74B1wZrduJe74GOq4QDmSLZQ5iSh4jwn7TFxorRmJxrsasENliTvmK8SlSj9StrNThU7WkCqMKvHrdlJiYUjOzVAE/Ukvh7FmtA+lzIcEnnlPDIITwh+xzmVi34fHlGLlrS7IrZMcbbabhfw+MTLzfxV4IH59zP+02/g3kh/UFTcpt72wxD2/QTso8t/TVsU3uUEAAA=\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var animation = {pulse:'_17vik8w7',wave:'_17vik8w8'};\nexport var root = '_17vik8w2';\nexport var variant = {circular:'_17vik8w3',rectangular:'_17vik8w4',rounded:'_17vik8w5',text:'_17vik8w6'};","import clsx from 'clsx';\n\nimport * as styles from './index.css';\nimport type { SkeletonProps } from './types';\n\nfunction getSize(size: number | string) {\n  return typeof size === 'number' || /^\\d+$/.test(size) ? `${size}px` : size;\n}\n\n/**\n *\n * @returns\n */\nexport const Skeleton = ({\n  animation = 'pulse',\n  variant = 'text',\n  children,\n\n  width: _width,\n  height: _height,\n  style: _style,\n  className: _className,\n\n  ...props\n}: SkeletonProps) => {\n  const width = _width !== undefined ? getSize(_width) : undefined;\n  const height = _height !== undefined ? getSize(_height) : undefined;\n\n  const style = {\n    width,\n    height,\n    ..._style,\n  };\n\n  return (\n    <div\n      className={clsx(\n        _className,\n        styles.root,\n        styles.variant[variant],\n        animation && styles.animation[animation]\n      )}\n      style={style}\n      {...props}\n    >\n      {children}\n    </div>\n  );\n};\n","import { isMacOS } from './platform';\n\nconst macOS = isMacOS();\n\nexport const getCommand = (cmd: '$mod' | '$shift' | '$alt' | string) => {\n  if (cmd === '$mod') return macOS ? '' : 'Ctrl';\n  if (cmd === '$alt') return macOS ? '' : 'Alt';\n  if (cmd === '$shift') return macOS ? '' : 'Shift';\n  return cmd;\n};\n","export function isMacOS() {\n  if (typeof navigator === 'undefined') return false;\n  return navigator.userAgent.indexOf('Mac') !== -1;\n}\n","import type {\n  TooltipContentProps,\n  TooltipPortalProps,\n  TooltipProps as RootProps,\n} from '@radix-ui/react-tooltip';\nimport * as TooltipPrimitive from '@radix-ui/react-tooltip';\nimport { cssVar } from '@toeverything/theme';\nimport { cssVarV2 } from '@toeverything/theme/v2';\nimport clsx from 'clsx';\nimport { type ReactElement, type ReactNode } from 'react';\n\nimport { getCommand } from '../../utils/keyboard-mapping';\nimport * as styles from './styles.css';\n\nexport interface TooltipProps {\n  // `children` can not be string, number or even undefined\n  children: ReactElement;\n  content?: ReactNode;\n  /**\n   * When shortcut is provided, will use a single line layout\n   *\n   * ```tsx\n   * <Tooltip shortcut=\"T\" />             // [T]\n   * <Tooltip shortcut=\" + K\" />         // [ + K]\n   * <Tooltip shortcut={['', 'K']} />    // [] [K]\n   * <Tooltip shortcut={['$mod', 'K']} /> // [] [K] or [Ctrl] [K]\n   * ```\n   *\n   * Mapping:\n   * | Shortcut | macOS | Windows |\n   * |----------|-------|---------|\n   * | `$mod`   | ``   | `Ctrl`  |\n   * | `$alt`   | ``   | `Alt`   |\n   * | `$shift` | ``   | `Shift` |\n   */\n  shortcut?: string | string[];\n  side?: TooltipContentProps['side'];\n  align?: TooltipContentProps['align'];\n\n  rootOptions?: Omit<RootProps, 'children'>;\n  portalOptions?: TooltipPortalProps;\n  options?: Omit<TooltipContentProps, 'side' | 'align'>;\n}\n\nconst TooltipShortcut = ({ shortcut }: { shortcut: string | string[] }) => {\n  const commands = (Array.isArray(shortcut) ? shortcut : [shortcut])\n    .map(cmd => cmd.trim())\n    .map(cmd => getCommand(cmd));\n\n  return (\n    <div className={styles.shortcut}>\n      {commands.map((cmd, index) => (\n        <div\n          key={`${index}-${cmd}`}\n          className={styles.command}\n          data-length={cmd.length}\n        >\n          {cmd}\n        </div>\n      ))}\n    </div>\n  );\n};\n\nexport const Tooltip = ({\n  children,\n  content,\n  side = 'top',\n  align = 'center',\n  shortcut,\n  options,\n  rootOptions,\n  portalOptions,\n}: TooltipProps) => {\n  if (!content) {\n    return children;\n  }\n  const { className, ...contentOptions } = options || {};\n  const { style: contentStyle, ...restContentOptions } = contentOptions;\n  return (\n    <TooltipPrimitive.Provider>\n      <TooltipPrimitive.Root delayDuration={500} {...rootOptions}>\n        <TooltipPrimitive.Trigger asChild>{children}</TooltipPrimitive.Trigger>\n\n        <TooltipPrimitive.Portal {...portalOptions}>\n          <TooltipPrimitive.Content\n            className={clsx(styles.tooltipContent, className)}\n            side={side}\n            align={align}\n            sideOffset={5}\n            style={{ zIndex: cssVar('zIndexPopover'), ...contentStyle }}\n            {...restContentOptions}\n          >\n            {shortcut ? (\n              <div className={styles.withShortcut}>\n                <div className={styles.withShortcutContent}>{content}</div>\n                <TooltipShortcut shortcut={shortcut} />\n              </div>\n            ) : (\n              content\n            )}\n            <TooltipPrimitive.Arrow asChild>\n              <svg\n                width=\"10\"\n                height=\"6\"\n                viewBox=\"0 0 10 6\"\n                fill=\"none\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n              >\n                <path\n                  d=\"M4.11111 5.55C4.55556 6.15 5.44445 6.15 5.88889 5.55L10 0H0L4.11111 5.55Z\"\n                  fill={cssVarV2('tooltips/background')}\n                />\n              </svg>\n            </TooltipPrimitive.Arrow>\n          </TooltipPrimitive.Content>\n        </TooltipPrimitive.Portal>\n      </TooltipPrimitive.Root>\n    </TooltipPrimitive.Provider>\n  );\n};\n","import \"../component/src/ui/tooltip/styles.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/ui/tooltip/styles.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xZWdxaHY5MCB7CiAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tYWZmaW5lLXRvb2x0aXBzLWJhY2tncm91bmQpOwogIGNvbG9yOiB2YXIoLS1hZmZpbmUtdG9vbHRpcHMtZm9yZWdyb3VuZCk7CiAgcGFkZGluZzogNXB4IDEycHg7CiAgZm9udC1zaXplOiB2YXIoLS1hZmZpbmUtZm9udC1zbSk7CiAgbGluZS1oZWlnaHQ6IDIycHg7CiAgYm9yZGVyLXJhZGl1czogNHB4OwogIG1heC13aWR0aDogMjgwcHg7Cn0KLl8xZWdxaHY5MSB7CiAgZGlzcGxheTogZmxleDsKICBnYXA6IDEwcHg7Cn0KLl8xZWdxaHY5MiB7CiAgd2hpdGUtc3BhY2U6IG5vd3JhcDsKICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsKICBvdmVyZmxvdzogaGlkZGVuOwp9Ci5fMWVncWh2OTMgewogIGRpc3BsYXk6IGZsZXg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBnYXA6IDJweDsKfQouXzFlZ3Fodjk0IHsKICBiYWNrZ3JvdW5kOiB2YXIoLS1hZmZpbmUtdG9vbHRpcHMtc2Vjb25kYXJ5QmFja2dyb3VuZCk7CiAgZm9udC1zaXplOiB2YXIoLS1hZmZpbmUtZm9udC14cyk7CiAgZm9udC13ZWlnaHQ6IDQwMDsKICBsaW5lLWhlaWdodDogMjBweDsKICBoZWlnaHQ6IDE2cHg7CiAgbWluLXdpZHRoOiAxNnB4OwogIGRpc3BsYXk6IGZsZXg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICBwYWRkaW5nOiAwIDRweDsKICBib3JkZXItcmFkaXVzOiA0cHg7Cn0KLl8xZWdxaHY5NFtkYXRhLWxlbmd0aD0iMSJdIHsKICB3aWR0aDogMTZweDsKfQ==\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var command = '_1egqhv94';\nexport var shortcut = '_1egqhv93';\nexport var tooltipContent = '_1egqhv90';\nexport var withShortcut = '_1egqhv91';\nexport var withShortcutContent = '_1egqhv92';","type AllowedUnits = 'px' | 'ms';\n\n/**\n * get value with unit\n */\nexport const withUnit = (\n  value: string | number,\n  unit: AllowedUnits\n): string => {\n  if (typeof value === 'number') {\n    return `${value}${unit}`;\n  }\n\n  if (/^\\d+(\\.\\d+)?$/.test(value)) {\n    return `${value}${unit}`;\n  }\n\n  return value;\n};\n","import { atom } from 'jotai';\n\nimport type { AuthProps } from '../components/affine/auth';\nimport type { CreateWorkspaceMode } from '../components/affine/create-workspace-modal';\nimport type { SettingProps } from '../components/affine/setting-modal';\nimport type { ActiveTab } from '../components/affine/setting-modal/types';\n// modal atoms\nexport const openWorkspacesModalAtom = atom(false);\nexport const openCreateWorkspaceModalAtom = atom<CreateWorkspaceMode>(false);\nexport const openSignOutModalAtom = atom(false);\nexport const openQuotaModalAtom = atom(false);\nexport const openStarAFFiNEModalAtom = atom(false);\nexport const openIssueFeedbackModalAtom = atom(false);\nexport const openHistoryTipsModalAtom = atom(false);\nexport const openInfoModalAtom = atom(false);\n\nexport const rightSidebarWidthAtom = atom(320);\n\nexport type PlansScrollAnchor =\n  | 'aiPricingPlan'\n  | 'cloudPricingPlan'\n  | 'lifetimePricingPlan';\nexport type SettingAtom = {\n  open: boolean;\n  workspaceMetadata?: SettingProps['workspaceMetadata'];\n} & (\n  | {\n      activeTab: 'plans';\n      scrollAnchor?: PlansScrollAnchor;\n    }\n  | { activeTab: Exclude<ActiveTab, 'plans'> }\n);\n\nexport const openSettingModalAtom = atom<SettingAtom>({\n  activeTab: 'appearance',\n  open: false,\n});\n\nexport type AuthAtom = {\n  openModal: boolean;\n  state: AuthProps['state'];\n  email?: string;\n  emailType?: AuthProps['emailType'];\n};\n\nexport const authAtom = atom<AuthAtom>({\n  openModal: false,\n  state: 'signIn',\n  email: '',\n  emailType: 'changeEmail',\n});\n\nexport type AllPageFilterOption = 'docs' | 'collections' | 'tags';\nexport const allPageFilterSelectAtom = atom<AllPageFilterOption>('docs');\n\nexport const openWorkspaceListModalAtom = atom(false);\n","import { type EditorHost, WithDisposable } from '@blocksuite/block-std';\nimport type {\n  AffineAIPanelState,\n  AffineAIPanelWidgetConfig,\n} from '@blocksuite/blocks';\nimport {\n  CodeBlockComponent,\n  DividerBlockComponent,\n  ListBlockComponent,\n  ParagraphBlockComponent,\n} from '@blocksuite/blocks';\nimport { BlockViewType, type Doc, type Query } from '@blocksuite/store';\nimport { css, html, LitElement, type PropertyValues } from 'lit';\nimport { customElement, property, query } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { keyed } from 'lit/directives/keyed.js';\n\nimport { CustomPageEditorBlockSpecs } from '../utils/custom-specs';\nimport { markDownToDoc } from '../utils/markdown-utils';\n\nconst textBlockStyles = css`\n  ${ParagraphBlockComponent.styles}\n  ${ListBlockComponent.styles}\n  ${DividerBlockComponent.styles}\n  ${CodeBlockComponent.styles}\n`;\n\nconst customHeadingStyles = css`\n  .custom-heading {\n    .h1 {\n      font-size: calc(var(--affine-font-h-1) - 2px);\n      code {\n        font-size: calc(var(--affine-font-base) + 6px);\n      }\n    }\n    .h2 {\n      font-size: calc(var(--affine-font-h-2) - 2px);\n      code {\n        font-size: calc(var(--affine-font-base) + 4px);\n      }\n    }\n    .h3 {\n      font-size: calc(var(--affine-font-h-3) - 2px);\n      code {\n        font-size: calc(var(--affine-font-base) + 2px);\n      }\n    }\n    .h4 {\n      font-size: calc(var(--affine-font-h-4) - 2px);\n      code {\n        font-size: var(--affine-font-base);\n      }\n    }\n    .h5 {\n      font-size: calc(var(--affine-font-h-5) - 2px);\n      code {\n        font-size: calc(var(--affine-font-base) - 2px);\n      }\n    }\n    .h6 {\n      font-size: calc(var(--affine-font-h-6) - 2px);\n      code {\n        font-size: calc(var(--affine-font-base) - 4px);\n      }\n    }\n  }\n`;\n\ntype TextRendererOptions = {\n  maxHeight?: number;\n  customHeading?: boolean;\n};\n\n@customElement('ai-answer-text')\nexport class AIAnswerText extends WithDisposable(LitElement) {\n  static override styles = css`\n    .ai-answer-text-editor.affine-page-viewport {\n      background: transparent;\n      font-family: var(--affine-font-family);\n      margin-top: 0;\n      margin-bottom: 0;\n    }\n\n    .ai-answer-text-editor .affine-page-root-block-container {\n      padding: 0;\n      line-height: var(--affine-line-height);\n      color: var(--affine-text-primary-color);\n      font-weight: 400;\n    }\n\n    .affine-paragraph-block-container {\n      line-height: 22px;\n    }\n\n    .ai-answer-text-editor {\n      .affine-note-block-container {\n        > .affine-block-children-container {\n          > :first-child,\n          > :first-child * {\n            margin-top: 0 !important;\n          }\n          > :last-child,\n          > :last-child * {\n            margin-bottom: 0 !important;\n          }\n        }\n      }\n    }\n\n    .ai-answer-text-container {\n      overflow-y: auto;\n      overflow-x: hidden;\n      padding: 0;\n      overscroll-behavior-y: none;\n    }\n    .ai-answer-text-container.show-scrollbar::-webkit-scrollbar {\n      width: 5px;\n      height: 100px;\n    }\n    .ai-answer-text-container.show-scrollbar::-webkit-scrollbar-thumb {\n      border-radius: 20px;\n    }\n    .ai-answer-text-container.show-scrollbar:hover::-webkit-scrollbar-thumb {\n      background-color: var(--affine-black-30);\n    }\n    .ai-answer-text-container.show-scrollbar::-webkit-scrollbar-corner {\n      display: none;\n    }\n\n    .ai-answer-text-container {\n      rich-text .nowrap-lines v-text span,\n      rich-text .nowrap-lines v-element span {\n        white-space: pre;\n      }\n      editor-host:focus-visible {\n        outline: none;\n      }\n      editor-host * {\n        box-sizing: border-box;\n      }\n      editor-host {\n        isolation: isolate;\n      }\n    }\n\n    ${textBlockStyles}\n    ${customHeadingStyles}\n  `;\n\n  @query('.ai-answer-text-container')\n  private accessor _container!: HTMLDivElement;\n\n  private _doc!: Doc;\n\n  private _answers: string[] = [];\n\n  private _timer?: ReturnType<typeof setInterval> | null = null;\n\n  @property({ attribute: false })\n  accessor host!: EditorHost;\n\n  @property({ attribute: false })\n  accessor answer!: string;\n\n  @property({ attribute: false })\n  accessor options!: TextRendererOptions;\n\n  @property({ attribute: false })\n  accessor state: AffineAIPanelState | undefined = undefined;\n\n  private _onWheel(e: MouseEvent) {\n    e.stopPropagation();\n    if (this.state === 'generating') {\n      e.preventDefault();\n    }\n  }\n\n  private readonly _clearTimer = () => {\n    if (this._timer) {\n      clearInterval(this._timer);\n      this._timer = null;\n    }\n  };\n\n  private readonly _query: Query = {\n    mode: 'strict',\n    match: [\n      'affine:page',\n      'affine:note',\n      'affine:surface',\n      'affine:paragraph',\n      'affine:code',\n      'affine:list',\n      'affine:divider',\n    ].map(flavour => ({ flavour, viewType: BlockViewType.Display })),\n  };\n\n  private readonly _updateDoc = () => {\n    if (this._answers.length > 0) {\n      const latestAnswer = this._answers.pop();\n      this._answers = [];\n      if (latestAnswer) {\n        markDownToDoc(this.host, latestAnswer)\n          .then(doc => {\n            this._doc = doc.blockCollection.getDoc({\n              query: this._query,\n            });\n            this.disposables.add(() => {\n              doc.blockCollection.clearQuery(this._query);\n            });\n            this._doc.awarenessStore.setReadonly(\n              this._doc.blockCollection,\n              true\n            );\n            this.requestUpdate();\n            if (this.state !== 'generating') {\n              this._clearTimer();\n            }\n          })\n          .catch(console.error);\n      }\n    }\n  };\n\n  override shouldUpdate(changedProperties: PropertyValues) {\n    if (changedProperties.has('answer')) {\n      this._answers.push(this.answer);\n      return false;\n    }\n\n    return true;\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this._answers.push(this.answer);\n\n    this._updateDoc();\n    if (this.state === 'generating') {\n      this._timer = setInterval(this._updateDoc, 600);\n    }\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    this._clearTimer();\n  }\n\n  override updated(changedProperties: PropertyValues) {\n    super.updated(changedProperties);\n    requestAnimationFrame(() => {\n      if (!this._container) return;\n      this._container.scrollTop = this._container.scrollHeight;\n    });\n  }\n\n  override render() {\n    const { maxHeight, customHeading } = this.options;\n    const classes = classMap({\n      'ai-answer-text-container': true,\n      'show-scrollbar': !!maxHeight,\n      'custom-heading': !!customHeading,\n    });\n    return html`\n      <style>\n        .ai-answer-text-container {\n          max-height: ${maxHeight ? Math.max(maxHeight, 200) + 'px' : ''};\n        }\n      </style>\n      <div class=${classes} @wheel=${this._onWheel}>\n        ${keyed(\n          this._doc,\n          html`<div class=\"ai-answer-text-editor affine-page-viewport\">\n            ${this.host.renderSpecPortal(this._doc, CustomPageEditorBlockSpecs)}\n          </div>`\n        )}\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'ai-answer-text': AIAnswerText;\n  }\n}\n\nexport const createTextRenderer: (\n  host: EditorHost,\n  options: TextRendererOptions\n) => AffineAIPanelWidgetConfig['answerRenderer'] = (host, options) => {\n  return (answer, state) => {\n    return html`<ai-answer-text\n      .host=${host}\n      .answer=${answer}\n      .state=${state}\n      .options=${options}\n    ></ai-answer-text>`;\n  };\n};\n","import { type EditorHost, WithDisposable } from '@blocksuite/block-std';\nimport {\n  type AIItemGroupConfig,\n  EdgelessRootService,\n  scrollbarStyle,\n} from '@blocksuite/blocks';\nimport { css, html, LitElement } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport { getRootService } from '../../utils/selection-utils';\n\n@customElement('ask-ai-panel')\nexport class AskAIPanel extends WithDisposable(LitElement) {\n  static override styles = css`\n    :host {\n      position: relative;\n    }\n\n    .ask-ai-panel {\n      box-sizing: border-box;\n      padding: 8px 4px 8px 8px;\n      max-height: 374px;\n      overflow-y: auto;\n      background: var(--affine-background-overlay-panel-color);\n      box-shadow: var(--affine-shadow-2);\n      border-radius: 8px;\n      z-index: var(--affine-z-index-popover);\n      scrollbar-gutter: stable;\n    }\n\n    ${scrollbarStyle('.ask-ai-panel')}\n    .ask-ai-panel:hover::-webkit-scrollbar-thumb {\n      background-color: var(--affine-black-30);\n    }\n  `;\n\n  @property({ attribute: false })\n  accessor host!: EditorHost;\n\n  @property({ attribute: false })\n  accessor actionGroups!: AIItemGroupConfig[];\n\n  @property({ attribute: false })\n  accessor abortController: AbortController | null = null;\n\n  @property({ attribute: false })\n  accessor minWidth = 330;\n\n  get _edgeless() {\n    const rootService = getRootService(this.host);\n    if (rootService instanceof EdgelessRootService) {\n      return rootService;\n    }\n    return null;\n  }\n\n  get _actionGroups() {\n    const filteredConfig = this.actionGroups\n      .map(group => ({\n        ...group,\n        items: group.items.filter(item =>\n          item.showWhen\n            ? item.showWhen(\n                this.host.command.chain(),\n                this._edgeless ? 'edgeless' : 'page',\n                this.host\n              )\n            : true\n        ),\n      }))\n      .filter(group => group.items.length > 0);\n    return filteredConfig;\n  }\n\n  override render() {\n    const style = styleMap({\n      minWidth: `${this.minWidth}px`,\n    });\n    return html`<div class=\"ask-ai-panel\" style=${style}>\n      <ai-item-list\n        .host=${this.host}\n        .groups=${this._actionGroups}\n      ></ai-item-list>\n    </div>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'ask-ai-panel': AskAIPanel;\n  }\n}\n","import './ask-ai-panel';\n\nimport { type EditorHost, WithDisposable } from '@blocksuite/block-std';\nimport {\n  type AIItemGroupConfig,\n  AIStarIcon,\n  EdgelessRootService,\n} from '@blocksuite/blocks';\nimport { createLitPortal, HoverController } from '@blocksuite/blocks';\nimport { assertExists } from '@blocksuite/global/utils';\nimport { flip, offset } from '@floating-ui/dom';\nimport { css, html, LitElement, nothing } from 'lit';\nimport { customElement, property, query } from 'lit/decorators.js';\nimport { ref } from 'lit/directives/ref.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport { getRootService } from '../../utils/selection-utils';\n\ntype buttonSize = 'small' | 'middle' | 'large';\ntype toggleType = 'hover' | 'click';\n\nconst buttonWidthMap: Record<buttonSize, string> = {\n  small: '72px',\n  middle: '76px',\n  large: '82px',\n};\n\nconst buttonHeightMap: Record<buttonSize, string> = {\n  small: '24px',\n  middle: '32px',\n  large: '32px',\n};\n\nexport type AskAIButtonOptions = {\n  size: buttonSize;\n  backgroundColor?: string;\n  boxShadow?: string;\n  panelWidth?: number;\n};\n\n@customElement('ask-ai-button')\nexport class AskAIButton extends WithDisposable(LitElement) {\n  get _edgeless() {\n    const rootService = getRootService(this.host);\n    if (rootService instanceof EdgelessRootService) {\n      return rootService;\n    }\n    return null;\n  }\n\n  static override styles = css`\n    .ask-ai-button {\n      border-radius: 4px;\n      position: relative;\n    }\n\n    .ask-ai-icon-button {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      color: var(--affine-brand-color);\n      font-size: var(--affine-font-sm);\n      font-weight: 500;\n    }\n\n    .ask-ai-icon-button.small {\n      font-size: var(--affine-font-xs);\n      svg {\n        scale: 0.8;\n        margin-right: 2px;\n      }\n    }\n\n    .ask-ai-icon-button.large {\n      font-size: var(--affine-font-md);\n      svg {\n        scale: 1.2;\n      }\n    }\n\n    .ask-ai-icon-button span {\n      line-height: 22px;\n    }\n\n    .ask-ai-icon-button svg {\n      margin-right: 4px;\n      color: var(--affine-brand-color);\n    }\n  `;\n\n  @query('.ask-ai-button')\n  private accessor _askAIButton!: HTMLDivElement;\n\n  private _abortController: AbortController | null = null;\n\n  private readonly _whenHover = new HoverController(\n    this,\n    ({ abortController }) => {\n      return {\n        template: html`<ask-ai-panel\n          .host=${this.host}\n          .actionGroups=${this.actionGroups}\n          .abortController=${abortController}\n        ></ask-ai-panel>`,\n        computePosition: {\n          referenceElement: this,\n          placement: 'bottom-start',\n          middleware: [flip(), offset({ mainAxis: 8, crossAxis: -6 })],\n          autoUpdate: true,\n        },\n      };\n    },\n    { allowMultiple: true }\n  );\n\n  @property({ attribute: false })\n  accessor host!: EditorHost;\n\n  @property({ attribute: false })\n  accessor actionGroups!: AIItemGroupConfig[];\n\n  @property({ attribute: false })\n  accessor toggleType: toggleType = 'hover';\n\n  @property({ attribute: false })\n  accessor options: AskAIButtonOptions = {\n    size: 'middle',\n    backgroundColor: undefined,\n    boxShadow: undefined,\n    panelWidth: 330,\n  };\n\n  private readonly _clearAbortController = () => {\n    if (this._abortController) {\n      this._abortController.abort();\n      this._abortController = null;\n    }\n  };\n\n  private readonly _toggleAIPanel = () => {\n    if (this.toggleType !== 'click') {\n      return;\n    }\n\n    if (this._abortController) {\n      this._clearAbortController();\n      return;\n    }\n\n    this._abortController = new AbortController();\n    assertExists(this._askAIButton);\n    const panelMinWidth = this.options.panelWidth || 330;\n    createLitPortal({\n      template: html`<ask-ai-panel\n        .host=${this.host}\n        .actionGroups=${this.actionGroups}\n        .minWidth=${panelMinWidth}\n      ></ask-ai-panel>`,\n      container: this._askAIButton,\n      computePosition: {\n        referenceElement: this._askAIButton,\n        placement: 'bottom-start',\n        middleware: [flip(), offset({ mainAxis: 8, crossAxis: -6 })],\n        autoUpdate: true,\n      },\n      abortController: this._abortController,\n      closeOnClickAway: true,\n    });\n  };\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    this._clearAbortController();\n  }\n\n  override render() {\n    const { size = 'small', backgroundColor, boxShadow } = this.options;\n    const { toggleType } = this;\n    const buttonStyles = styleMap({\n      backgroundColor: backgroundColor || 'transparent',\n      boxShadow: boxShadow || 'none',\n    });\n    return html`<div\n      class=\"ask-ai-button\"\n      style=${buttonStyles}\n      ${toggleType === 'hover' ? ref(this._whenHover.setReference) : nothing}\n      @click=${this._toggleAIPanel}\n    >\n      <icon-button\n        class=\"ask-ai-icon-button ${size}\"\n        width=${buttonWidthMap[size]}\n        height=${buttonHeightMap[size]}\n      >\n        ${AIStarIcon} <span>Ask AI</span></icon-button\n      >\n    </div>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'ask-ai-button': AskAIButton;\n  }\n}\n","import type { EditorHost } from '@blocksuite/block-std';\nimport { WithDisposable } from '@blocksuite/block-std';\nimport {\n  type AffineAIPanelWidgetConfig,\n  EdgelessEditorBlockSpecs,\n} from '@blocksuite/blocks';\nimport { AffineSchemas } from '@blocksuite/blocks/schemas';\nimport type { Doc } from '@blocksuite/store';\nimport { DocCollection, Schema } from '@blocksuite/store';\nimport { css, html, LitElement, nothing } from 'lit';\nimport { customElement, property, query } from 'lit/decorators.js';\nimport { createRef, type Ref, ref } from 'lit/directives/ref.js';\n\nimport { getAIPanel } from '../ai-panel';\nimport { PPTBuilder } from '../slides/index';\n\nexport const createSlidesRenderer: (\n  host: EditorHost,\n  ctx: {\n    get: () => Record<string, unknown>;\n    set: (data: Record<string, unknown>) => void;\n  }\n) => AffineAIPanelWidgetConfig['answerRenderer'] = (host, ctx) => {\n  return (answer, state) => {\n    if (state === 'generating') {\n      const panel = getAIPanel(host);\n      panel.generatingElement?.updateLoadingProgress(2);\n      return nothing;\n    }\n\n    if (state !== 'finished' && state !== 'error') {\n      return nothing;\n    }\n\n    return html`<style>\n        .slides-container {\n          width: 100%;\n          height: 300px;\n        }\n      </style>\n      <div class=\"slides-container\">\n        <ai-slides-renderer\n          .host=${host}\n          .ctx=${ctx}\n          .text=${answer}\n        ></ai-slides-renderer>\n      </div>`;\n  };\n};\n\n@customElement('ai-slides-renderer')\nexport class AISlidesRenderer extends WithDisposable(LitElement) {\n  static override styles = css``;\n\n  private readonly _editorContainer: Ref<HTMLDivElement> =\n    createRef<HTMLDivElement>();\n\n  private _doc!: Doc;\n\n  @query('editor-host')\n  private accessor _editorHost!: EditorHost;\n\n  @property({ attribute: false })\n  accessor text!: string;\n\n  @property({ attribute: false })\n  accessor host!: EditorHost;\n\n  @property({ attribute: false })\n  accessor ctx:\n    | {\n        get(): Record<string, unknown>;\n        set(data: Record<string, unknown>): void;\n      }\n    | undefined = undefined;\n\n  protected override firstUpdated() {\n    requestAnimationFrame(() => {\n      if (!this._editorHost) return;\n      PPTBuilder(this._editorHost)\n        .process(this.text)\n        .then(res => {\n          if (this.ctx) {\n            this.ctx.set({\n              contents: res.contents,\n              images: res.images,\n            });\n          }\n        })\n        .catch(console.error);\n    });\n  }\n\n  protected override render() {\n    return html`<style>\n        .slides-container {\n          position: relative;\n          width: 100%;\n          height: 100%;\n        }\n\n        .edgeless-container {\n          width: 100%;\n          height: 100%;\n          border-radius: 4px;\n          border: 1px solid var(--affine-border-color);\n        }\n\n        .mask {\n          position: absolute;\n          top: 0;\n          left: 0;\n          z-index: 1;\n          background-color: transparent;\n          width: 100%;\n          height: 100%;\n        }\n\n        .edgeless-container affine-edgeless-zoom-toolbar-widget,\n        edgeless-toolbar {\n          display: none;\n        }\n\n        * {\n          box-sizing: border-box;\n        }\n\n        .affine-edgeless-viewport {\n          display: block;\n          height: 100%;\n          position: relative;\n          overflow: hidden;\n          container-name: viewport;\n          container-type: inline-size;\n        }\n\n        .affine-edgeless-surface-block-container {\n          position: absolute;\n          width: 100%;\n          height: 100%;\n        }\n\n        .affine-edgeless-surface-block-container canvas {\n          width: 100%;\n          height: 100%;\n          position: relative;\n          z-index: 1;\n          pointer-events: none;\n        }\n\n        edgeless-block-portal-container {\n          position: relative;\n          box-sizing: border-box;\n          overflow: hidden;\n          display: block;\n          height: 100%;\n          font-family: var(--affine-font-family);\n          font-size: var(--affine-font-base);\n          line-height: var(--affine-line-height);\n          color: var(--affine-text-primary-color);\n          font-weight: 400;\n        }\n\n        .affine-block-children-container.edgeless {\n          padding-left: 0;\n          position: relative;\n          overflow: hidden;\n          height: 100%;\n          touch-action: none;\n          background-color: var(--affine-background-primary-color);\n          background-image: radial-gradient(\n            var(--affine-edgeless-grid-color) 1px,\n            var(--affine-background-primary-color) 1px\n          );\n          z-index: 0;\n        }\n\n        .affine-edgeless-block-child {\n          position: absolute;\n          transform-origin: center;\n          box-sizing: border-box;\n          border: 2px solid var(--affine-white-10);\n          border-radius: 8px;\n          box-shadow: var(--affine-shadow-3);\n          pointer-events: all;\n        }\n\n        affine-edgeless-image .resizable-img,\n        affine-edgeless-image .resizable-img img {\n          width: 100%;\n          height: 100%;\n        }\n\n        .affine-edgeless-layer {\n          position: absolute;\n          top: 0;\n          left: 0;\n          contain: size layout style;\n        }\n      </style>\n      <div class=\"slides-container\">\n        <div\n          class=\"edgeless-container affine-edgeless-viewport\"\n          ${ref(this._editorContainer)}\n        >\n          ${this.host.renderSpecPortal(this._doc, EdgelessEditorBlockSpecs)}\n        </div>\n        <div class=\"mask\"></div>\n      </div>`;\n  }\n\n  override connectedCallback(): void {\n    super.connectedCallback();\n\n    const schema = new Schema().register(AffineSchemas);\n    const collection = new DocCollection({\n      schema,\n      id: 'SLIDES_PREVIEW',\n      disableBacklinkIndex: true,\n      disableSearchIndex: true,\n    });\n    collection.meta.initialize();\n    collection.start();\n    const doc = collection.createDoc();\n\n    doc.load(() => {\n      const pageBlockId = doc.addBlock('affine:page', {});\n      doc.addBlock('affine:surface', {}, pageBlockId);\n    });\n\n    doc.resetHistory();\n    this._doc = doc;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'ai-slides-renderer': AISlidesRenderer;\n  }\n}\n","import type { EditorHost } from '@blocksuite/block-std';\nimport type { AffineAIPanelWidgetConfig } from '@blocksuite/blocks';\nimport { css, html, LitElement, nothing } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\n\nimport { getAIPanel } from '../ai-panel';\nimport { preprocessHtml } from '../utils/html';\n\ntype AIAnswerWrapperOptions = {\n  height: number;\n};\n\n@customElement('ai-answer-wrapper')\nexport class AIAnswerWrapper extends LitElement {\n  static override styles = css`\n    :host {\n      display: block;\n      width: 100%;\n      box-sizing: border-box;\n      border-radius: 4px;\n      border: 1px solid var(--affine-border-color);\n      box-shadow: var(--affine-shadow-1);\n      background: var(--affine-background-secondary-color);\n      overflow: hidden;\n    }\n\n    ::slotted(.ai-answer-iframe) {\n      width: 100%;\n      height: 100%;\n      border: none;\n    }\n\n    ::slotted(.ai-answer-image) {\n      width: 100%;\n      height: 100%;\n    }\n  `;\n\n  @property({ attribute: false })\n  accessor options: AIAnswerWrapperOptions | undefined = undefined;\n\n  protected override render() {\n    return html`<style>\n        :host {\n          height: ${this.options?.height\n            ? this.options?.height + 'px'\n            : '100%'};\n        }\n      </style>\n      <slot></slot> `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'ai-answer-wrapper': AIAnswerWrapper;\n  }\n}\n\nexport const createIframeRenderer: (\n  host: EditorHost,\n  options?: AIAnswerWrapperOptions\n) => AffineAIPanelWidgetConfig['answerRenderer'] = (host, options) => {\n  return (answer, state) => {\n    if (state === 'generating') {\n      const panel = getAIPanel(host);\n      panel.generatingElement?.updateLoadingProgress(2);\n      return nothing;\n    }\n\n    if (state !== 'finished' && state !== 'error') {\n      return nothing;\n    }\n\n    const template = html`<iframe\n      class=\"ai-answer-iframe\"\n      sandbox=\"allow-scripts\"\n      scrolling=\"no\"\n      allowfullscreen\n      .srcdoc=${preprocessHtml(answer)}\n    >\n    </iframe>`;\n    return html`<ai-answer-wrapper .options=${options}\n      >${template}</ai-answer-wrapper\n    >`;\n  };\n};\n\nexport const createImageRenderer: (\n  host: EditorHost,\n  options?: AIAnswerWrapperOptions\n) => AffineAIPanelWidgetConfig['answerRenderer'] = (host, options) => {\n  return (answer, state) => {\n    if (state === 'generating') {\n      const panel = getAIPanel(host);\n      panel.generatingElement?.updateLoadingProgress(2);\n      return nothing;\n    }\n\n    if (state !== 'finished' && state !== 'error') {\n      return nothing;\n    }\n\n    const template = html`<style>\n      .ai-answer-image img{\n        width: 100%;\n        height: 100%;\n        object-fit: contain;\n      }\n    </style>\n    <div class=\"ai-answer-image\">\n      <img src=${answer}></img>\n    </div>`;\n\n    return html`<ai-answer-wrapper .options=${options}\n      >${template}</ai-answer-wrapper\n    >`;\n  };\n};\n","import type { EditorHost } from '@blocksuite/block-std';\nimport { WithDisposable } from '@blocksuite/block-std';\nimport { type AIError, openFileOrFiles } from '@blocksuite/blocks';\nimport { assertExists } from '@blocksuite/global/utils';\nimport { css, html, LitElement, nothing } from 'lit';\nimport { customElement, property, query, state } from 'lit/decorators.js';\nimport { repeat } from 'lit/directives/repeat.js';\n\nimport {\n  ChatAbortIcon,\n  ChatClearIcon,\n  ChatSendIcon,\n  CloseIcon,\n  ImageIcon,\n} from '../_common/icons';\nimport { AIProvider } from '../provider';\nimport { reportResponse } from '../utils/action-reporter';\nimport { readBlobAsURL } from '../utils/image';\nimport type { ChatContextValue, ChatMessage } from './chat-context';\n\nconst MaximumImageCount = 32;\n\nfunction getFirstTwoLines(text: string) {\n  const lines = text.split('\\n');\n  return lines.slice(0, 2);\n}\n\n@customElement('chat-panel-input')\nexport class ChatPanelInput extends WithDisposable(LitElement) {\n  static override styles = css`\n    .chat-panel-input {\n      display: flex;\n      flex-direction: column;\n      justify-content: space-between;\n      gap: 12px;\n      position: relative;\n      margin-top: 12px;\n      border-radius: 4px;\n      padding: 8px;\n      min-height: 94px;\n      box-sizing: border-box;\n      border-width: 1px;\n      border-style: solid;\n\n      .chat-selection-quote {\n        padding: 4px 0px 8px 0px;\n        padding-left: 15px;\n        max-height: 56px;\n        font-size: 14px;\n        font-weight: 400;\n        line-height: 22px;\n        color: var(--affine-text-secondary-color);\n        position: relative;\n\n        div {\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n\n        .chat-quote-close {\n          position: absolute;\n          right: 0;\n          top: 0;\n          cursor: pointer;\n          display: none;\n          width: 16px;\n          height: 16px;\n          border-radius: 4px;\n          border: 1px solid var(--affine-border-color);\n          background-color: var(--affine-white);\n        }\n      }\n\n      .chat-selection-quote:hover .chat-quote-close {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n      }\n\n      .chat-selection-quote::after {\n        content: '';\n        width: 2px;\n        height: calc(100% - 10px);\n        margin-top: 5px;\n        position: absolute;\n        left: 0;\n        top: 0;\n        background: var(--affine-quote-color);\n        border-radius: 18px;\n      }\n    }\n\n    .chat-panel-input-actions {\n      display: flex;\n      gap: 8px;\n      align-items: center;\n\n      div {\n        width: 24px;\n        height: 24px;\n        cursor: pointer;\n      }\n\n      div:nth-child(2) {\n        margin-left: auto;\n      }\n\n      .image-upload {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n      }\n    }\n\n    .chat-panel-input {\n      textarea {\n        width: 100%;\n        padding: 0;\n        margin: 0;\n        border: none;\n        line-height: 22px;\n        font-size: var(--affine-font-sm);\n        font-weight: 400;\n        font-family: var(--affine-font-family);\n        color: var(--affine-text-primary-color);\n        box-sizing: border-box;\n        resize: none;\n        overflow-y: hidden;\n      }\n\n      textarea::placeholder {\n        font-size: 14px;\n        font-weight: 400;\n        font-family: var(--affine-font-family);\n        color: var(--affine-placeholder-color);\n      }\n\n      textarea:focus {\n        outline: none;\n      }\n    }\n\n    .chat-panel-images-wrapper {\n      overflow: hidden scroll;\n      max-height: 128px;\n\n      .chat-panel-images {\n        display: flex;\n        gap: 4px;\n        flex-wrap: wrap;\n        position: relative;\n\n        .image-container {\n          width: 58px;\n          height: 58px;\n          border-radius: 4px;\n          border: 1px solid var(--affine-border-color);\n          cursor: pointer;\n          overflow: hidden;\n          position: relative;\n          display: flex;\n          justify-content: center;\n          align-items: center;\n\n          img {\n            max-width: 100%;\n            max-height: 100%;\n            width: auto;\n            height: auto;\n          }\n        }\n      }\n    }\n\n    .chat-panel-send svg rect {\n      fill: var(--affine-primary-color);\n    }\n    .chat-panel-send[aria-disabled='true'] {\n      cursor: not-allowed;\n    }\n    .chat-panel-send[aria-disabled='true'] svg rect {\n      fill: var(--affine-text-disable-color);\n    }\n\n    .close-wrapper {\n      width: 16px;\n      height: 16px;\n      border-radius: 4px;\n      border: 1px solid var(--affine-border-color);\n      justify-content: center;\n      align-items: center;\n      display: none;\n      position: absolute;\n      background-color: var(--affine-white);\n      z-index: 1;\n      cursor: pointer;\n    }\n\n    .close-wrapper:hover {\n      background-color: var(--affine-background-error-color);\n      border: 1px solid var(--affine-error-color);\n    }\n\n    .close-wrapper:hover svg path {\n      fill: var(--affine-error-color);\n    }\n  `;\n\n  @property({ attribute: false })\n  accessor host!: EditorHost;\n\n  @query('.chat-panel-images')\n  accessor imagesWrapper!: HTMLDivElement;\n\n  @query('textarea')\n  accessor textarea!: HTMLTextAreaElement;\n\n  @query('.close-wrapper')\n  accessor closeWrapper!: HTMLDivElement;\n\n  @state()\n  accessor curIndex = -1;\n\n  @state()\n  accessor isInputEmpty = true;\n\n  @state()\n  accessor focused = false;\n\n  @property({ attribute: false })\n  accessor chatContextValue!: ChatContextValue;\n\n  @property({ attribute: false })\n  accessor updateContext!: (context: Partial<ChatContextValue>) => void;\n\n  @property({ attribute: false })\n  accessor cleanupHistories!: () => Promise<void>;\n\n  private _addImages(images: File[]) {\n    const oldImages = this.chatContextValue.images;\n    this.updateContext({\n      images: [...oldImages, ...images].slice(0, MaximumImageCount),\n    });\n  }\n\n  private _renderImages(images: File[]) {\n    return html`\n      <div\n        class=\"chat-panel-images-wrapper\"\n        @mouseleave=${() => {\n          this.closeWrapper.style.display = 'none';\n          this.curIndex = -1;\n        }}\n      >\n        <div class=\"chat-panel-images\">\n          ${repeat(\n            images,\n            image => image.name,\n            (image, index) =>\n              html`<div\n                class=\"image-container\"\n                @mouseenter=${(evt: MouseEvent) => {\n                  const ele = evt.target as HTMLImageElement;\n                  const rect = ele.getBoundingClientRect();\n                  assertExists(ele.parentElement?.parentElement);\n                  const parentRect =\n                    ele.parentElement.parentElement.getBoundingClientRect();\n                  const left = Math.abs(rect.right - parentRect.left) - 8;\n                  const top = Math.abs(parentRect.top - rect.top);\n                  this.curIndex = index;\n                  this.closeWrapper.style.display = 'flex';\n                  this.closeWrapper.style.left = left + 'px';\n                  this.closeWrapper.style.top = top + 'px';\n                }}\n              >\n                <img src=\"${URL.createObjectURL(image)}\" alt=\"${image.name}\" />\n              </div>`\n          )}\n        </div>\n        <div\n          class=\"close-wrapper\"\n          @click=${() => {\n            AIProvider.slots.toggleChatCards.emit({ visible: true });\n\n            if (this.curIndex >= 0 && this.curIndex < images.length) {\n              const newImages = [...images];\n              newImages.splice(this.curIndex, 1);\n              this.updateContext({ images: newImages });\n              this.curIndex = -1;\n              this.closeWrapper.style.display = 'none';\n            }\n          }}\n        >\n          ${CloseIcon}\n        </div>\n      </div>\n    `;\n  }\n\n  protected override render() {\n    const { images, status } = this.chatContextValue;\n    const hasImages = images.length > 0;\n    const maxHeight = hasImages ? 272 + 2 : 200 + 2;\n\n    return html`<style>\n        .chat-panel-input {\n          border-color: ${this.focused\n            ? 'var(--affine-primary-color)'\n            : 'var(--affine-border-color)'};\n          box-shadow: ${this.focused ? 'var(--affine-active-shadow)' : 'none'};\n          max-height: ${maxHeight}px !important;\n          user-select: none;\n        }\n      </style>\n      <div class=\"chat-panel-input\">\n        ${hasImages ? this._renderImages(images) : nothing}\n        ${this.chatContextValue.quote\n          ? html`<div class=\"chat-selection-quote\">\n              ${repeat(\n                getFirstTwoLines(this.chatContextValue.quote),\n                line => line,\n                line => html`<div>${line}</div>`\n              )}\n              <div\n                class=\"chat-quote-close\"\n                @click=${() => {\n                  AIProvider.slots.toggleChatCards.emit({ visible: true });\n                  this.updateContext({ quote: '', markdown: '' });\n                }}\n              >\n                ${CloseIcon}\n              </div>\n            </div>`\n          : nothing}\n        <textarea\n          rows=\"1\"\n          placeholder=\"What are your thoughts?\"\n          @input=${() => {\n            const { textarea } = this;\n            this.isInputEmpty = !textarea.value.trim();\n            textarea.style.height = 'auto';\n            textarea.style.height = textarea.scrollHeight + 'px';\n            let imagesHeight = this.imagesWrapper?.scrollHeight ?? 0;\n            if (imagesHeight) imagesHeight += 12;\n            if (this.scrollHeight >= 200 + imagesHeight) {\n              textarea.style.height = '148px';\n              textarea.style.overflowY = 'scroll';\n            }\n          }}\n          @keydown=${async (evt: KeyboardEvent) => {\n            if (evt.key === 'Enter' && !evt.shiftKey && !evt.isComposing) {\n              evt.preventDefault();\n              await this.send();\n            }\n          }}\n          @focus=${() => {\n            this.focused = true;\n          }}\n          @blur=${() => {\n            this.focused = false;\n          }}\n          @paste=${(event: ClipboardEvent) => {\n            const items = event.clipboardData?.items;\n            if (!items) return;\n\n            for (const index in items) {\n              const item = items[index];\n              if (item.kind === 'file' && item.type.indexOf('image') >= 0) {\n                const blob = item.getAsFile();\n                if (!blob) continue;\n                this._addImages([blob]);\n              }\n            }\n          }}\n        ></textarea>\n        <div class=\"chat-panel-input-actions\">\n          <div\n            class=\"chat-history-clear\"\n            @click=${async () => {\n              await this.cleanupHistories();\n            }}\n          >\n            ${ChatClearIcon}\n          </div>\n          ${images.length < MaximumImageCount\n            ? html`<div\n                class=\"image-upload\"\n                @click=${async () => {\n                  const images = await openFileOrFiles({\n                    acceptType: 'Images',\n                    multiple: true,\n                  });\n                  if (!images) return;\n                  this._addImages(images);\n                }}\n              >\n                ${ImageIcon}\n              </div>`\n            : nothing}\n          ${status === 'transmitting'\n            ? html`<div\n                @click=${() => {\n                  this.chatContextValue.abortController?.abort();\n                  this.updateContext({ status: 'success' });\n                  reportResponse('aborted:stop');\n                }}\n              >\n                ${ChatAbortIcon}\n              </div>`\n            : html`<div\n                @click=\"${this.send}\"\n                class=\"chat-panel-send\"\n                aria-disabled=${this.isInputEmpty}\n              >\n                ${ChatSendIcon}\n              </div>`}\n        </div>\n      </div>`;\n  }\n\n  send = async () => {\n    const { status, markdown } = this.chatContextValue;\n    if (status === 'loading' || status === 'transmitting') return;\n\n    const text = this.textarea.value;\n    const { images } = this.chatContextValue;\n    if (!text && images.length === 0) {\n      return;\n    }\n    const { doc } = this.host;\n    this.textarea.value = '';\n    this.isInputEmpty = true;\n    this.textarea.style.height = 'unset';\n    this.updateContext({\n      images: [],\n      status: 'loading',\n      error: null,\n      quote: '',\n      markdown: '',\n    });\n\n    const attachments = await Promise.all(\n      images?.map(image => readBlobAsURL(image))\n    );\n\n    const content = (markdown ? `${markdown}\\n` : '') + text;\n\n    this.updateContext({\n      items: [\n        ...this.chatContextValue.items,\n        {\n          id: '',\n          role: 'user',\n          content: content,\n          createdAt: new Date().toISOString(),\n          attachments,\n        },\n        {\n          id: '',\n          role: 'assistant',\n          content: '',\n          createdAt: new Date().toISOString(),\n        },\n      ],\n    });\n\n    try {\n      const abortController = new AbortController();\n      const stream = AIProvider.actions.chat?.({\n        input: content,\n        docId: doc.id,\n        attachments: images,\n        workspaceId: doc.collection.id,\n        host: this.host,\n        stream: true,\n        signal: abortController.signal,\n        where: 'chat-panel',\n        control: 'chat-send',\n        isRootSession: true,\n      });\n\n      if (stream) {\n        this.updateContext({ abortController });\n\n        for await (const text of stream) {\n          const items = [...this.chatContextValue.items];\n          const last = items[items.length - 1] as ChatMessage;\n          last.content += text;\n          this.updateContext({ items, status: 'transmitting' });\n        }\n\n        this.updateContext({ status: 'success' });\n\n        if (!this.chatContextValue.chatSessionId) {\n          this.updateContext({\n            chatSessionId: AIProvider.LAST_ROOT_SESSION_ID,\n          });\n        }\n\n        const { items } = this.chatContextValue;\n        const last = items[items.length - 1] as ChatMessage;\n        if (!last.id) {\n          const historyIds = await AIProvider.histories?.ids(\n            doc.collection.id,\n            doc.id,\n            { sessionId: this.chatContextValue.chatSessionId }\n          );\n          if (!historyIds || !historyIds[0]) return;\n          last.id = historyIds[0].messages.at(-1)?.id ?? '';\n        }\n      }\n    } catch (error) {\n      this.updateContext({ status: 'error', error: error as AIError });\n    } finally {\n      this.updateContext({ abortController: null });\n    }\n  };\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'chat-panel-input': ChatPanelInput;\n  }\n}\n","import { WithDisposable } from '@blocksuite/block-std';\nimport { css, html, LitElement } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\n\nimport { AIStarIconWithAnimation } from '../_common/icons';\n\n@customElement('ai-loading')\nexport class AILoading extends WithDisposable(LitElement) {\n  static override styles = css`\n    :host {\n      width: 100%;\n    }\n\n    .generating-tip {\n      display: flex;\n      width: 100%;\n      height: 22px;\n      align-items: center;\n      gap: 8px;\n\n      color: var(--light-brandColor, #1e96eb);\n\n      .text {\n        display: flex;\n        align-items: flex-start;\n        gap: 10px;\n        flex: 1 0 0;\n\n        /* light/smMedium */\n        font-family: Inter;\n        font-size: 14px;\n        font-style: normal;\n        font-weight: 500;\n        line-height: 22px; /* 157.143% */\n      }\n\n      .left,\n      .right {\n        display: flex;\n        width: 20px;\n        height: 20px;\n        justify-content: center;\n        align-items: center;\n      }\n    }\n  `;\n\n  @property({ attribute: false })\n  accessor stopGenerating!: () => void;\n\n  override render() {\n    return html`\n      <div class=\"generating-tip\">\n        <div class=\"left\">${AIStarIconWithAnimation}</div>\n        <div class=\"text\">AI is generating...</div>\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'ai-loading': AILoading;\n  }\n}\n","import type { EditorHost } from '@blocksuite/block-std';\nimport { WithDisposable } from '@blocksuite/block-std';\nimport { css, html, LitElement, nothing, type TemplateResult } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\n\nimport {\n  ActionIcon,\n  AIChangeToneIcon,\n  AIDoneIcon,\n  AIExpandMindMapIcon,\n  AIExplainIcon,\n  AIExplainSelectionIcon,\n  AIFindActionsIcon,\n  AIImageIcon,\n  AIImproveWritingIcon,\n  AIMakeLongerIcon,\n  AIMakeRealIcon,\n  AIMakeShorterIcon,\n  AIMindMapIcon,\n  AIPenIcon,\n  AIPresentationIcon,\n  ArrowDownIcon,\n  ArrowUpIcon,\n} from '../../_common/icons';\nimport { createTextRenderer } from '../../messages/text';\nimport type { ChatAction } from '../chat-context';\nimport { renderImages } from '../components/images';\nimport { HISTORY_IMAGE_ACTIONS } from '../const';\n\nconst icons: Record<string, TemplateResult<1>> = {\n  'Fix spelling for it': AIDoneIcon,\n  'Improve grammar for it': AIDoneIcon,\n  'Explain this code': AIExplainIcon,\n  'Check code error': AIExplainIcon,\n  'Explain this': AIExplainSelectionIcon,\n  Translate: ActionIcon,\n  'Change tone': AIChangeToneIcon,\n  'Improve writing for it': AIImproveWritingIcon,\n  'Make it longer': AIMakeLongerIcon,\n  'Make it shorter': AIMakeShorterIcon,\n  'Continue writing': AIPenIcon,\n  'Make it real': AIMakeRealIcon,\n  'Find action items from it': AIFindActionsIcon,\n  Summary: AIPenIcon,\n  'Create headings': AIPenIcon,\n  'Write outline': AIPenIcon,\n  image: AIImageIcon,\n  'Brainstorm mindmap': AIMindMapIcon,\n  'Expand mind map': AIExpandMindMapIcon,\n  'Create a presentation': AIPresentationIcon,\n  'Write a poem about this': AIPenIcon,\n  'Write a blog post about this': AIPenIcon,\n  'AI image filter clay style': AIImageIcon,\n  'AI image filter sketch style': AIImageIcon,\n  'AI image filter anime style': AIImageIcon,\n  'AI image filter pixel style': AIImageIcon,\n  Clearer: AIImageIcon,\n  'Remove background': AIImageIcon,\n  'Convert to sticker': AIImageIcon,\n};\n\n@customElement('action-wrapper')\nexport class ActionWrapper extends WithDisposable(LitElement) {\n  static override styles = css`\n    .action-name {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      height: 22px;\n      margin-bottom: 12px;\n\n      svg {\n        color: var(--affine-primary-color);\n      }\n\n      div:last-child {\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        flex: 1;\n\n        div:last-child svg {\n          margin-left: auto;\n        }\n      }\n    }\n\n    .answer-prompt {\n      padding: 8px;\n      background-color: var(--affine-background-secondary-color);\n      display: flex;\n      flex-direction: column;\n      gap: 4px;\n      font-size: 14px;\n      font-weight: 400;\n      color: var(--affine-text-primary-color);\n\n      .subtitle {\n        font-size: 12px;\n        font-weight: 500;\n        color: var(--affine-text-secondary-color);\n        height: 20px;\n        line-height: 20px;\n      }\n\n      .prompt {\n        margin-top: 12px;\n      }\n    }\n  `;\n\n  @state()\n  accessor promptShow = false;\n\n  @property({ attribute: false })\n  accessor item!: ChatAction;\n\n  @property({ attribute: false })\n  accessor host!: EditorHost;\n\n  protected override render() {\n    const { item } = this;\n\n    const originalText = item.messages[1].content;\n    const answer = item.messages[2]?.content;\n    const images = item.messages[1].attachments;\n\n    return html`<style></style>\n      <slot></slot>\n      <div\n        class=\"action-name\"\n        @click=${() => (this.promptShow = !this.promptShow)}\n      >\n        ${icons[item.action] ? icons[item.action] : ActionIcon}\n        <div>\n          <div>${item.action}</div>\n          <div>${this.promptShow ? ArrowDownIcon : ArrowUpIcon}</div>\n        </div>\n      </div>\n      ${this.promptShow\n        ? html`\n            <div class=\"answer-prompt\">\n              <div class=\"subtitle\">Answer</div>\n              ${HISTORY_IMAGE_ACTIONS.includes(item.action)\n                ? images && renderImages(images)\n                : nothing}\n              ${answer\n                ? createTextRenderer(this.host, { customHeading: true })(answer)\n                : nothing}\n              ${originalText\n                ? html`<div class=\"subtitle prompt\">Prompt</div>\n                    ${createTextRenderer(this.host, { customHeading: true })(\n                      item.messages[0].content + originalText\n                    )}`\n                : nothing}\n            </div>\n          `\n        : nothing} `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'action-wrapper': ActionWrapper;\n  }\n}\n","import './action-wrapper';\n\nimport type { EditorHost } from '@blocksuite/block-std';\nimport { WithDisposable } from '@blocksuite/block-std';\nimport { css, html, LitElement } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport { createTextRenderer } from '../../messages/text';\nimport type { ChatAction } from '../chat-context';\n\n@customElement('action-text')\nexport class ActionText extends WithDisposable(LitElement) {\n  static override styles = css`\n    .original-text {\n      border-radius: 4px;\n      margin-bottom: 12px;\n      font-size: var(--affine-font-sm);\n      line-height: 22px;\n    }\n  `;\n\n  @property({ attribute: false })\n  accessor item!: ChatAction;\n\n  @property({ attribute: false })\n  accessor host!: EditorHost;\n\n  @property({ attribute: false })\n  accessor isCode = false;\n\n  protected override render() {\n    const originalText = this.item.messages[1].content;\n    const { isCode } = this;\n\n    return html` <action-wrapper .host=${this.host} .item=${this.item}>\n      <div\n        style=${styleMap({\n          padding: isCode ? '0' : '10px 16px',\n          border: isCode ? 'none' : '1px solid var(--affine-border-color)',\n        })}\n        class=\"original-text\"\n      >\n        ${createTextRenderer(this.host, {\n          customHeading: true,\n        })(originalText)}\n      </div>\n    </action-wrapper>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'action-text': ActionText;\n  }\n}\n","import './action-wrapper';\n\nimport type { EditorHost } from '@blocksuite/block-std';\nimport { ShadowlessElement, WithDisposable } from '@blocksuite/block-std';\nimport { html } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport { createIframeRenderer } from '../../messages/wrapper';\nimport type { ChatAction } from '../chat-context';\n\n@customElement('action-make-real')\nexport class ActionMakeReal extends WithDisposable(ShadowlessElement) {\n  @property({ attribute: false })\n  accessor item!: ChatAction;\n\n  @property({ attribute: false })\n  accessor host!: EditorHost;\n\n  protected override render() {\n    const answer = this.item.messages[2].content;\n    return html`<action-wrapper .host=${this.host} .item=${this.item}>\n      <div style=${styleMap({ marginBottom: '12px' })}>\n        ${createIframeRenderer(this.host)(answer, 'finished')}\n      </div>\n    </action-wrapper>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'action-make-real': ActionMakeReal;\n  }\n}\n","import './action-wrapper';\nimport '../../messages/slides-renderer';\n\nimport type { EditorHost } from '@blocksuite/block-std';\nimport { ShadowlessElement, WithDisposable } from '@blocksuite/block-std';\nimport { html, nothing } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport type { ChatAction } from '../chat-context';\n\n@customElement('action-slides')\nexport class ActionSlides extends WithDisposable(ShadowlessElement) {\n  @property({ attribute: false })\n  accessor item!: ChatAction;\n\n  @property({ attribute: false })\n  accessor host!: EditorHost;\n\n  protected override render() {\n    const answer = this.item.messages[2]?.content;\n    if (!answer) return nothing;\n\n    return html`<action-wrapper .host=${this.host} .item=${this.item}>\n      <div style=${styleMap({ marginBottom: '12px', height: '174px' })}>\n        <ai-slides-renderer\n          .text=${answer}\n          .host=${this.host}\n        ></ai-slides-renderer>\n      </div>\n    </action-wrapper>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'action-slides': ActionSlides;\n  }\n}\n","import './action-wrapper';\n\nimport type { EditorHost } from '@blocksuite/block-std';\nimport { ShadowlessElement, WithDisposable } from '@blocksuite/block-std';\nimport { MiniMindmapPreview } from '@blocksuite/blocks';\nimport { noop } from '@blocksuite/global/utils';\nimport { html } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport type { ChatAction } from '../chat-context';\n\nnoop(MiniMindmapPreview);\n\n@customElement('action-mindmap')\nexport class ActionMindmap extends WithDisposable(ShadowlessElement) {\n  @property({ attribute: false })\n  accessor item!: ChatAction;\n\n  @property({ attribute: false })\n  accessor host!: EditorHost;\n\n  protected override render() {\n    const answer = this.item.messages[2].content;\n    return html`<action-wrapper .host=${this.host} .item=${this.item}>\n      <div style=${styleMap({ marginBottom: '12px', height: '140px' })}>\n        <mini-mindmap-preview\n          .host=${this.host}\n          .ctx=${{\n            get: () => ({}),\n            set: () => {},\n          }}\n          .answer=${answer}\n          .templateShow=${false}\n          .height=${140}\n        ></mini-mindmap-preview>\n      </div>\n    </action-wrapper>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'action-mindmap': ActionMindmap;\n  }\n}\n","import './action-wrapper';\n\nimport type { EditorHost } from '@blocksuite/block-std';\nimport { ShadowlessElement, WithDisposable } from '@blocksuite/block-std';\nimport { html, nothing } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\n\nimport { createTextRenderer } from '../../messages/text';\nimport { renderImages } from '../components/images';\n@customElement('chat-text')\nexport class ChatText extends WithDisposable(ShadowlessElement) {\n  @property({ attribute: false })\n  accessor host!: EditorHost;\n\n  @property({ attribute: false })\n  accessor attachments: string[] | undefined = undefined;\n\n  @property({ attribute: false })\n  accessor text!: string;\n\n  @property({ attribute: false })\n  accessor state: 'finished' | 'generating' = 'finished';\n\n  protected override render() {\n    const { attachments, text, host } = this;\n    return html`${attachments && attachments.length > 0\n      ? renderImages(attachments)\n      : nothing}${createTextRenderer(host, { customHeading: true })(\n      text,\n      this.state\n    )} `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'chat-text': ChatText;\n  }\n}\n","import './action-wrapper';\n\nimport type { EditorHost } from '@blocksuite/block-std';\nimport { ShadowlessElement, WithDisposable } from '@blocksuite/block-std';\nimport { html, nothing } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport type { ChatAction } from '../chat-context';\nimport { renderImages } from '../components/images';\n\n@customElement('action-image-to-text')\nexport class ActionImageToText extends WithDisposable(ShadowlessElement) {\n  @property({ attribute: false })\n  accessor item!: ChatAction;\n\n  @property({ attribute: false })\n  accessor host!: EditorHost;\n\n  protected override render() {\n    const answer = this.item.messages[1].attachments;\n\n    return html`<action-wrapper .host=${this.host} .item=${this.item}>\n      <div style=${styleMap({ marginBottom: '12px' })}>\n        ${answer ? renderImages(answer) : nothing}\n      </div>\n    </action-wrapper>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'action-image-to-text': ActionImageToText;\n  }\n}\n","import './action-wrapper';\n\nimport type { EditorHost } from '@blocksuite/block-std';\nimport { ShadowlessElement, WithDisposable } from '@blocksuite/block-std';\nimport { html, nothing } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport type { ChatAction } from '../chat-context';\nimport { renderImages } from '../components/images';\n\n@customElement('action-image')\nexport class ActionImage extends WithDisposable(ShadowlessElement) {\n  @property({ attribute: false })\n  accessor item!: ChatAction;\n\n  @property({ attribute: false })\n  accessor host!: EditorHost;\n\n  protected override render() {\n    const answer = this.item.messages[0].attachments;\n\n    return html`<action-wrapper .host=${this.host} .item=${this.item}>\n      <div style=${styleMap({ marginBottom: '12px' })}>\n        ${answer ? renderImages(answer) : nothing}\n      </div>\n    </action-wrapper>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'action-image': ActionImage;\n  }\n}\n","import type { EditorHost } from '@blocksuite/block-std';\nimport { WithDisposable } from '@blocksuite/block-std';\nimport {\n  type ImageBlockModel,\n  isInsideEdgelessEditor,\n  type NoteBlockModel,\n  NoteDisplayMode,\n} from '@blocksuite/blocks';\nimport type { BlockModel } from '@blocksuite/store';\nimport {\n  css,\n  html,\n  LitElement,\n  nothing,\n  type PropertyValues,\n  type TemplateResult,\n} from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { repeat } from 'lit/directives/repeat.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport {\n  CurrentSelectionIcon,\n  DocIcon,\n  SmallImageIcon,\n} from '../_common/icons';\nimport { type AIChatParams, AIProvider } from '../provider';\nimport {\n  getSelectedImagesAsBlobs,\n  getSelectedTextContent,\n  getTextContentFromBlockModels,\n  selectedToCanvas,\n} from '../utils/selection-utils';\nimport type { ChatContextValue } from './chat-context';\n\nconst cardsStyles = css`\n  .card-wrapper {\n    width: 90%;\n    max-height: 76px;\n    border-radius: 8px;\n    border: 1px solid var(--affine-border-color);\n    padding: 4px 12px;\n    cursor: pointer;\n\n    .card-title {\n      display: flex;\n      gap: 4px;\n      height: 22px;\n      margin-bottom: 2px;\n      font-weight: 500;\n      font-size: 14px;\n      color: var(--affine-text-primary-color);\n    }\n\n    .second-text {\n      font-size: 14px;\n      font-weight: 400;\n      color: var(--affine-text-secondary-color);\n    }\n  }\n`;\n\nenum CardType {\n  Text,\n  Image,\n  Block,\n  Doc,\n}\n\ntype CardBase = {\n  id: number;\n};\n\ntype CardText = CardBase & {\n  type: CardType.Text;\n  text: string;\n  markdown: string;\n};\n\ntype CardImage = CardBase & {\n  type: CardType.Image;\n  image: File;\n  caption?: string;\n};\n\ntype CardBlock = CardBase & {\n  type: CardType.Block | CardType.Doc;\n  text?: string;\n  markdown?: string;\n  images?: File[];\n};\n\ntype Card = CardText | CardImage | CardBlock;\n\nconst MAX_CARDS = 3;\n\n@customElement('chat-cards')\nexport class ChatCards extends WithDisposable(LitElement) {\n  static override styles = css`\n    :host {\n      display: none;\n      flex-direction: column;\n      gap: 12px;\n    }\n\n    :host([data-show]) {\n      display: flex;\n    }\n\n    ${cardsStyles}\n  `;\n\n  @property({ attribute: false })\n  accessor host!: EditorHost;\n\n  @property({ attribute: false })\n  accessor updateContext!: (context: Partial<ChatContextValue>) => void;\n\n  @property({ attribute: false })\n  accessor temporaryParams: AIChatParams | null = null;\n\n  @property({ attribute: false })\n  accessor isEmpty!: boolean;\n\n  @state()\n  accessor cards: Card[] = [];\n\n  private _currentDocId: string | null = null;\n  private _selectedCardId: number = 0;\n\n  static renderText({ text }: CardText) {\n    const lines = text.split('\\n');\n\n    return html`\n      <div class=\"card-wrapper\">\n        <div class=\"card-title\">\n          ${CurrentSelectionIcon}\n          <div>Start with current selection</div>\n        </div>\n        <div class=\"second-text\">\n          ${repeat(\n            lines.slice(0, 2),\n            line => line,\n            line => html`\n              <div\n                style=${styleMap({\n                  overflow: 'hidden',\n                  textOverflow: 'ellipsis',\n                  whiteSpace: 'nowrap',\n                })}\n              >\n                ${line}\n              </div>\n            `\n          )}\n        </div>\n      </div>\n    `;\n  }\n\n  static renderImage({ caption, image }: CardImage) {\n    return html`\n      <div\n        class=\"card-wrapper\"\n        style=${styleMap({\n          display: 'flex',\n          gap: '8px',\n          justifyContent: 'space-between',\n        })}\n      >\n        <div\n          style=${styleMap({\n            display: 'flex',\n            flexDirection: 'column',\n            maxWidth: 'calc(100% - 72px)',\n          })}\n        >\n          <div class=\"card-title\">\n            ${SmallImageIcon}\n            <div>Start with this Image</div>\n          </div>\n          <div class=\"second-text\">${caption ? caption : 'caption'}</div>\n        </div>\n        <img\n          style=${styleMap({\n            maxWidth: '72px',\n            maxHeight: '46px',\n          })}\n          src=\"${URL.createObjectURL(image)}\"\n        />\n      </div>\n    `;\n  }\n\n  static renderDoc({ text, images }: CardBlock) {\n    let textTpl = html`you've chosen within the doc`;\n    let imageTpl: TemplateResult<1> | typeof nothing = nothing;\n    let hasImage = false;\n\n    if (text?.length) {\n      const lines = text.split('\\n');\n      textTpl = html`${repeat(\n        lines.slice(0, 2),\n        line => line,\n        line => html`\n          <div\n            style=${styleMap({\n              overflow: 'hidden',\n              textOverflow: 'ellipsis',\n              whiteSpace: 'nowrap',\n            })}\n          >\n            ${line}\n          </div>\n        `\n      )}`;\n    }\n\n    if (images?.length) {\n      hasImage = true;\n      imageTpl = html`\n        <img\n          style=${styleMap({\n            maxWidth: '72px',\n            maxHeight: '46px',\n          })}\n          src=\"${URL.createObjectURL(images[0])}\"\n        />\n      `;\n    }\n\n    return html`\n      <div\n        class=\"card-wrapper\"\n        style=${styleMap({\n          display: 'flex',\n          gap: '8px',\n          justifyContent: 'space-between',\n        })}\n      >\n        <div\n          style=${styleMap({\n            display: 'flex',\n            flexDirection: 'column',\n            maxWidth: hasImage ? 'calc(100% - 72px)' : '100%',\n          })}\n        >\n          <div class=\"card-title\">\n            ${DocIcon}\n            <div>Start with this doc</div>\n          </div>\n          <div class=\"second-text\">${textTpl}</div>\n        </div>\n        ${imageTpl}\n      </div>\n    `;\n  }\n\n  private _renderCard(card: Card) {\n    if (card.type === CardType.Text) {\n      return ChatCards.renderText(card);\n    }\n\n    if (card.type === CardType.Image) {\n      return ChatCards.renderImage(card);\n    }\n\n    if (card.type === CardType.Doc) {\n      return ChatCards.renderDoc(card);\n    }\n\n    return nothing;\n  }\n\n  private _updateCards(card: Card) {\n    this.cards.unshift(card);\n\n    if (this.cards.length > MAX_CARDS) {\n      this.cards.pop();\n    }\n\n    this.requestUpdate();\n  }\n\n  private async _handleDocSelection(card: CardBlock) {\n    const { text, markdown, images } = await this._extractAll();\n\n    card.text = text;\n    card.markdown = markdown;\n    card.images = images;\n  }\n\n  private async _selectCard(card: Card) {\n    AIProvider.slots.toggleChatCards.emit({ visible: false });\n\n    this._selectedCardId = card.id;\n\n    switch (card.type) {\n      case CardType.Text: {\n        this.updateContext({\n          quote: card.text,\n          markdown: card.markdown,\n        });\n        break;\n      }\n      case CardType.Image: {\n        this.updateContext({\n          images: [card.image],\n        });\n        break;\n      }\n      case CardType.Block: {\n        this.updateContext({\n          quote: card.text,\n          markdown: card.markdown,\n          images: card.images,\n        });\n        break;\n      }\n\n      case CardType.Doc: {\n        await this._handleDocSelection(card);\n        this.updateContext({\n          quote: card.text,\n          markdown: card.markdown,\n          images: card.images,\n        });\n        break;\n      }\n    }\n  }\n\n  private async _extract() {\n    const text = await getSelectedTextContent(this.host, 'plain-text');\n    const images = await getSelectedImagesAsBlobs(this.host);\n    const hasText = text.length > 0;\n    const hasImages = images.length > 0;\n\n    if (hasText && !hasImages) {\n      const markdown = await getSelectedTextContent(this.host, 'markdown');\n\n      this._updateCards({\n        id: Date.now(),\n        type: CardType.Text,\n        text,\n        markdown,\n      });\n    } else if (!hasText && hasImages && images.length === 1) {\n      const [_, data] = this.host.command\n        .chain()\n        .tryAll(chain => [chain.getImageSelections()])\n        .getSelectedBlocks({\n          types: ['image'],\n        })\n        .run();\n      let caption = '';\n\n      if (data.currentImageSelections?.[0]) {\n        caption =\n          (\n            this.host.doc.getBlock(data.currentImageSelections[0].blockId)\n              ?.model as ImageBlockModel\n          ).caption ?? '';\n      }\n\n      this._updateCards({\n        id: Date.now(),\n        type: CardType.Image,\n        image: images[0],\n        caption,\n      });\n    } else {\n      const markdown =\n        (await getSelectedTextContent(this.host, 'markdown')).trim() || '';\n      this._updateCards({\n        id: Date.now(),\n        type: CardType.Block,\n        text,\n        markdown,\n        images,\n      });\n    }\n  }\n\n  private async _extractOnEdgeless(host: EditorHost) {\n    if (!isInsideEdgelessEditor(host)) return;\n\n    const canvas = await selectedToCanvas(host);\n    if (!canvas) return;\n\n    const blob: Blob | null = await new Promise(resolve =>\n      canvas.toBlob(resolve)\n    );\n    if (!blob) return;\n\n    this._updateCards({\n      id: Date.now(),\n      type: CardType.Image,\n      image: new File([blob], 'selected.png'),\n    });\n  }\n\n  private async _extractAll() {\n    const notes = this.host.doc\n      .getBlocksByFlavour('affine:note')\n      .filter(\n        note =>\n          (note.model as NoteBlockModel).displayMode !==\n          NoteDisplayMode.EdgelessOnly\n      )\n      .map(note => note.model as NoteBlockModel);\n    const selectedModels = notes.reduce((acc, note) => {\n      acc.push(...note.children);\n      return acc;\n    }, [] as BlockModel[]);\n    const text = await getTextContentFromBlockModels(\n      this.host,\n      selectedModels,\n      'plain-text'\n    );\n    const markdown = await getTextContentFromBlockModels(\n      this.host,\n      selectedModels,\n      'markdown'\n    );\n    const blobs = await Promise.all(\n      selectedModels.map(async s => {\n        if (s.flavour !== 'affine:image') return null;\n        const sourceId = (s as ImageBlockModel)?.sourceId;\n        if (!sourceId) return null;\n        const blob = await (sourceId\n          ? this.host.doc.blobSync.get(sourceId)\n          : null);\n        if (!blob) return null;\n        return new File([blob], sourceId);\n      }) ?? []\n    );\n    const images = blobs.filter((blob): blob is File => !!blob);\n\n    return {\n      text,\n      markdown,\n      images,\n    };\n  }\n\n  private async _appendCardWithParams({\n    host,\n    mode,\n    autoSelect,\n  }: AIChatParams) {\n    if (mode === 'edgeless') {\n      await this._extractOnEdgeless(host);\n    } else {\n      await this._extract();\n    }\n\n    if (!autoSelect) {\n      return;\n    }\n\n    if (this.cards.length > 0) {\n      const card = this.cards[0];\n      if (card.type === CardType.Doc) return;\n\n      await this._selectCard(card);\n    }\n  }\n\n  protected override async willUpdate(changedProperties: PropertyValues) {\n    if (changedProperties.has('temporaryParams') && this.temporaryParams) {\n      const params = this.temporaryParams;\n      await this._appendCardWithParams(params);\n      this.temporaryParams = null;\n    }\n\n    if (changedProperties.has('host')) {\n      if (this._currentDocId === this.host.doc.id) return;\n      this._currentDocId = this.host.doc.id;\n      this.cards = [];\n\n      const { text, images } = await this._extractAll();\n      const hasText = text.length > 0;\n      const hasImages = images.length > 0;\n\n      // Currently only supports checking on first load\n      if (hasText || hasImages) {\n        const card: CardBlock = {\n          id: Date.now(),\n          type: CardType.Doc,\n        };\n        if (hasText) {\n          card.text = text;\n        }\n        if (hasImages) {\n          card.images = images;\n        }\n\n        this.cards.push(card);\n        this.requestUpdate();\n      }\n    }\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    this._disposables.add(\n      AIProvider.slots.requestOpenWithChat.on(async params => {\n        await this._appendCardWithParams(params);\n      })\n    );\n\n    this._disposables.add(\n      AIProvider.slots.toggleChatCards.on(({ visible, ok }) => {\n        if (visible && ok && this._selectedCardId > 0) {\n          this.cards = this.cards.filter(\n            card => card.id !== this._selectedCardId\n          );\n          this._selectedCardId = 0;\n        }\n      })\n    );\n  }\n\n  protected override render() {\n    if (!this.isEmpty) return nothing;\n\n    return repeat(\n      this.cards,\n      card => card.id,\n      card => html`\n        <div @click=${() => this._selectCard(card)}>\n          ${this._renderCard(card)}\n        </div>\n      `\n    );\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'chat-cards': ChatCards;\n  }\n}\n","import type {\n  BlockSelection,\n  EditorHost,\n  TextSelection,\n} from '@blocksuite/block-std';\nimport type { ImageSelection } from '@blocksuite/blocks';\nimport { css, html, LitElement, nothing } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { repeat } from 'lit/directives/repeat.js';\n\nimport { insertBelow } from '../../utils/editor-actions';\nimport type { ChatAction } from '../chat-actions-handle';\n\n@customElement('chat-action-list')\nexport class ChatActionList extends LitElement {\n  static override styles = css`\n    .actions-container {\n      display: flex;\n      gap: 8px;\n    }\n    .actions-container > div {\n      display: flex;\n      gap: 8px;\n    }\n    .actions-container.horizontal {\n      flex-wrap: wrap;\n      justify-content: end;\n    }\n    .actions-container.vertical {\n      flex-direction: column;\n      align-items: flex-end;\n    }\n    .action {\n      width: fit-content;\n      height: 32px;\n      padding: 4px 18px;\n      box-sizing: border-box;\n      border-radius: 8px;\n      border: 1px solid var(--affine-border-color);\n      background-color: var(--affine-white-10);\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n      gap: 4px;\n      font-size: var(--affine-font-sm);\n      font-weight: 500;\n      color: var(--affine-text-primary-color);\n      cursor: pointer;\n      user-select: none;\n      line-height: 22px;\n    }\n    .action svg {\n      color: var(--affine-icon-color);\n    }\n  `;\n\n  private get _selectionValue() {\n    return this.host.selection.value;\n  }\n\n  private get _rootService() {\n    return this.host.spec.getService('affine:page');\n  }\n\n  private get _currentTextSelection(): TextSelection | undefined {\n    return this._selectionValue.find(v => v.type === 'text') as TextSelection;\n  }\n\n  private get _currentBlockSelections(): BlockSelection[] | undefined {\n    return this._selectionValue.filter(v => v.type === 'block');\n  }\n\n  private get _currentImageSelections(): ImageSelection[] | undefined {\n    return this._selectionValue.filter(v => v.type === 'image');\n  }\n\n  @property({ attribute: false })\n  accessor host!: EditorHost;\n\n  @property({ attribute: false })\n  accessor actions: ChatAction[] = [];\n\n  @property({ attribute: false })\n  accessor content: string = '';\n\n  @property({ attribute: false })\n  accessor chatSessionId: string | undefined = undefined;\n\n  @property({ attribute: false })\n  accessor messageId: string | undefined = undefined;\n\n  @property({ attribute: false })\n  accessor layoutDirection: 'horizontal' | 'vertical' = 'vertical'; // New property for layout direction\n\n  @property({ attribute: false })\n  accessor withMargin = false;\n\n  override render() {\n    const { actions } = this;\n    if (!actions.length) {\n      return nothing;\n    }\n\n    const { host, content, chatSessionId, messageId, layoutDirection } = this;\n    const classes = classMap({\n      'actions-container': true,\n      horizontal: layoutDirection === 'horizontal',\n      vertical: layoutDirection === 'vertical',\n    });\n\n    return html`<style>\n        .actions-container {\n          margin-top: ${this.withMargin ? '8px' : '0'};\n        }\n      </style>\n      <div class=${classes}>\n        ${repeat(\n          actions.filter(action => action.showWhen(host)),\n          action => action.title,\n          action => {\n            return html`<div class=\"action\">\n              ${action.icon}\n              <div\n                @click=${async () => {\n                  if (\n                    action.title === 'Insert below' &&\n                    this._selectionValue.length === 1 &&\n                    this._selectionValue[0].type === 'database'\n                  ) {\n                    const element = this.host.view.getBlock(\n                      this._selectionValue[0].blockId\n                    );\n                    if (!element) return;\n                    await insertBelow(host, content, element);\n                    return;\n                  }\n                  const currentSelections = {\n                    text: this._currentTextSelection,\n                    blocks: this._currentBlockSelections,\n                    images: this._currentImageSelections,\n                  };\n                  const success = await action.handler(\n                    host,\n                    content,\n                    currentSelections,\n                    chatSessionId,\n                    messageId\n                  );\n                  if (success) {\n                    this._rootService.notificationService?.notify({\n                      title: action.toast,\n                      accent: 'success',\n                      onClose: function (): void {},\n                    });\n                  }\n                }}\n              >\n                ${action.title}\n              </div>\n            </div>`;\n          }\n        )}\n      </div>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'chat-action-list': ChatActionList;\n  }\n}\n","import type {\n  BlockSelection,\n  EditorHost,\n  TextSelection,\n} from '@blocksuite/block-std';\nimport { WithDisposable } from '@blocksuite/block-std';\nimport { createButtonPopper, Tooltip } from '@blocksuite/blocks';\nimport { noop } from '@blocksuite/global/utils';\nimport { css, html, LitElement, nothing, type PropertyValues } from 'lit';\nimport { customElement, property, query, state } from 'lit/decorators.js';\nimport { repeat } from 'lit/directives/repeat.js';\n\nimport { type ChatAction } from '../../_common/chat-actions-handle';\nimport { CopyIcon, MoreIcon, RetryIcon } from '../../_common/icons';\nimport { copyText } from '../../utils/editor-actions';\n\nnoop(Tooltip);\n\n@customElement('chat-copy-more')\nexport class ChatCopyMore extends WithDisposable(LitElement) {\n  static override styles = css`\n    .copy-more {\n      display: flex;\n      gap: 8px;\n      height: 36px;\n      box-sizing: border-box;\n      justify-content: flex-end;\n      align-items: center;\n      padding: 8px 0;\n\n      div {\n        cursor: pointer;\n        border-radius: 4px;\n      }\n\n      div:hover {\n        background-color: var(--affine-hover-color);\n      }\n\n      svg {\n        color: var(--affine-icon-color);\n      }\n    }\n\n    .more-menu {\n      width: 226px;\n      border-radius: 8px;\n      background-color: var(--affine-background-overlay-panel-color);\n      box-shadow: var(--affine-menu-shadow);\n      display: flex;\n      flex-direction: column;\n      gap: 4px;\n      position: absolute;\n      z-index: 1;\n      user-select: none;\n\n      > div {\n        height: 30px;\n        display: flex;\n        gap: 8px;\n        align-items: center;\n        cursor: pointer;\n\n        svg {\n          margin-left: 12px;\n        }\n      }\n\n      > div:hover {\n        background-color: var(--affine-hover-color);\n      }\n    }\n  `;\n\n  private get _rootService() {\n    return this.host.spec.getService('affine:page');\n  }\n\n  private get _selectionValue() {\n    return this.host.selection.value;\n  }\n\n  private get _currentTextSelection(): TextSelection | undefined {\n    return this._selectionValue.find(v => v.type === 'text') as TextSelection;\n  }\n\n  private get _currentBlockSelections(): BlockSelection[] | undefined {\n    return this._selectionValue.filter(v => v.type === 'block');\n  }\n\n  @state()\n  private accessor _showMoreMenu = false;\n\n  @query('.more-button')\n  private accessor _moreButton!: HTMLDivElement;\n\n  @query('.more-menu')\n  private accessor _moreMenu!: HTMLDivElement;\n\n  private _morePopper: ReturnType<typeof createButtonPopper> | null = null;\n\n  @property({ attribute: false })\n  accessor host!: EditorHost;\n\n  @property({ attribute: false })\n  accessor actions: ChatAction[] = [];\n\n  @property({ attribute: false })\n  accessor content!: string;\n\n  @property({ attribute: false })\n  accessor chatSessionId: string | undefined = undefined;\n\n  @property({ attribute: false })\n  accessor messageId: string | undefined = undefined;\n\n  @property({ attribute: false })\n  accessor isLast!: boolean;\n\n  @property({ attribute: false })\n  accessor withMargin = false;\n\n  @property({ attribute: false })\n  accessor retry = () => {};\n\n  private _toggle() {\n    this._morePopper?.toggle();\n  }\n\n  private readonly _notifySuccess = (title: string) => {\n    const { notificationService } = this._rootService;\n    notificationService?.notify({\n      title: title,\n      accent: 'success',\n      onClose: function (): void {},\n    });\n  };\n\n  protected override updated(changed: PropertyValues): void {\n    if (changed.has('isLast')) {\n      if (this.isLast) {\n        this._morePopper?.dispose();\n        this._morePopper = null;\n      } else if (!this._morePopper) {\n        this._morePopper = createButtonPopper(\n          this._moreButton,\n          this._moreMenu,\n          ({ display }) => (this._showMoreMenu = display === 'show'),\n          {\n            mainAxis: 0,\n            crossAxis: -100,\n          }\n        );\n      }\n    }\n  }\n\n  override render() {\n    const { host, content, isLast, messageId, chatSessionId, actions } = this;\n    return html`<style>\n        .copy-more {\n          margin-top: ${this.withMargin ? '8px' : '0px'};\n          margin-bottom: ${this.withMargin ? '12px' : '0px'};\n        }\n        .more-menu {\n          padding: ${this._showMoreMenu ? '8px' : '0px'};\n        }\n      </style>\n      <div class=\"copy-more\">\n        ${content\n          ? html`<div\n              @click=${async () => {\n                const success = await copyText(host, content);\n                if (success) {\n                  this._notifySuccess('Copied to clipboard');\n                }\n              }}\n            >\n              ${CopyIcon}\n              <affine-tooltip>Copy</affine-tooltip>\n            </div>`\n          : nothing}\n        ${isLast\n          ? html`<div @click=${() => this.retry()}>\n              ${RetryIcon}\n              <affine-tooltip>Retry</affine-tooltip>\n            </div>`\n          : nothing}\n        ${isLast\n          ? nothing\n          : html`<div class=\"more-button\" @click=${this._toggle}>\n              ${MoreIcon}\n            </div> `}\n      </div>\n\n      <div class=\"more-menu\">\n        ${this._showMoreMenu\n          ? repeat(\n              actions.filter(action => action.showWhen(host)),\n              action => action.title,\n              action => {\n                const currentSelections = {\n                  text: this._currentTextSelection,\n                  blocks: this._currentBlockSelections,\n                };\n                return html`<div\n                  @click=${async () => {\n                    const success = await action.handler(\n                      host,\n                      content,\n                      currentSelections,\n                      chatSessionId,\n                      messageId\n                    );\n\n                    if (success) {\n                      this._notifySuccess(action.toast);\n                    }\n                  }}\n                >\n                  ${action.icon}\n                  <div>${action.title}</div>\n                </div>`;\n              }\n            )\n          : nothing}\n      </div>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'chat-copy-more': ChatCopyMore;\n  }\n}\n","import { type EditorHost, WithDisposable } from '@blocksuite/block-std';\nimport {\n  type AIError,\n  PaymentRequiredError,\n  UnauthorizedError,\n} from '@blocksuite/blocks';\nimport { html, LitElement, nothing, type TemplateResult } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport { ErrorTipIcon } from '../_common/icons';\nimport { AIProvider } from '../provider';\n\n@customElement('ai-error-wrapper')\nclass AIErrorWrapper extends WithDisposable(LitElement) {\n  @property({ attribute: false })\n  accessor text!: TemplateResult<1>;\n\n  protected override render() {\n    return html` <style>\n        .answer-tip {\n          display: flex;\n          flex-direction: column;\n          justify-content: center;\n          align-items: flex-start;\n          gap: 4px;\n          align-self: stretch;\n          border-radius: 4px;\n          padding: 8px;\n          background-color: var(--affine-background-error-color);\n\n          .bottom {\n            align-items: flex-start;\n            display: flex;\n            gap: 8px;\n            align-self: stretch;\n            color: var(--affine-error-color, #eb4335);\n            font-feature-settings:\n              'clig' off,\n              'liga' off;\n            /* light/sm */\n            font-size: var(--affine-font-sm);\n            font-style: normal;\n            font-weight: 400;\n            line-height: 22px; /* 157.143% */\n            margin-bottom: 4px;\n\n            a {\n              color: inherit;\n            }\n\n            div svg {\n              position: relative;\n              top: 3px;\n            }\n          }\n        }\n      </style>\n      <div class=\"answer-tip\">\n        <div class=\"bottom\">\n          <div>${ErrorTipIcon}</div>\n          <div>${this.text}</div>\n        </div>\n        <slot></slot>\n      </div>`;\n  }\n}\n\nexport const PaymentRequiredErrorRenderer = (host: EditorHost) => html`\n  <style>\n    .upgrade {\n      cursor: pointer;\n      display: flex;\n      padding: 4px 12px;\n      justify-content: center;\n      align-items: center;\n      gap: 4px;\n      border-radius: 8px;\n      margin-left: auto;\n      border: 1px solid var(--affine-border-color, #e3e2e4);\n      background: var(--affine-primary-color);\n      .content {\n        display: flex;\n        padding: 0px 4px;\n        justify-content: center;\n        align-items: center;\n        color: var(--affine-pure-white);\n        /* light/xsMedium */\n        font-size: var(--affine-font-xs);\n        font-style: normal;\n        font-weight: 500;\n        line-height: 20px; /* 166.667% */\n      }\n    }\n  </style>\n  <ai-error-wrapper\n    .text=${html`You've reached the current usage cap for AFFiNE AI. You can\n    subscribe to AFFiNE AI to continue the AI experience!`}\n  >\n    <div\n      @click=${() => AIProvider.slots.requestUpgradePlan.emit({ host: host })}\n      class=\"upgrade\"\n    >\n      <div class=\"content\">Upgrade</div>\n    </div></ai-error-wrapper\n  >\n`;\n\ntype ErrorProps = {\n  text?: TemplateResult<1>;\n  template?: TemplateResult<1>;\n  error?: TemplateResult<1>;\n};\n\nconst generateText = (error?: TemplateResult<1>) =>\n  html`${error || 'An error occurred'}, If this issue persists please let us\n    know.<a href=\"mailto:support@toeverything.info\">\n      support@toeverything.info\n    </a>`;\n\nconst nope = html`${nothing}`;\nconst GeneralErrorRenderer = (props: ErrorProps = {}) => {\n  const { text = generateText(props.error), template = nope } = props;\n  return html`<ai-error-wrapper .text=${text}>${template}</ai-error-wrapper>`;\n};\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'ai-error-wrapper': AIErrorWrapper;\n  }\n}\n\nexport function AIChatErrorRenderer(host: EditorHost, error: AIError) {\n  if (error instanceof PaymentRequiredError) {\n    return PaymentRequiredErrorRenderer(host);\n  } else if (error instanceof UnauthorizedError) {\n    return GeneralErrorRenderer({\n      text: html`You need to login to AFFiNE Cloud to continue using AFFiNE AI.`,\n      template: html`<div\n        style=${styleMap({\n          padding: '4px 12px',\n          borderRadius: '8px',\n          border: '1px solid var(--affine-border-color)',\n          cursor: 'pointer',\n          backgroundColor: 'var(--affine-hover-color)',\n        })}\n        @click=${() => AIProvider.slots.requestLogin.emit({ host })}\n      >\n        Login\n      </div>`,\n    });\n  } else {\n    const tip = error.message;\n    return GeneralErrorRenderer({\n      error: html`<style>\n          .tip {\n            position: relative;\n            cursor: pointer;\n          }\n\n          .tip:hover::after {\n            content: attr(data-tip);\n            position: absolute;\n            left: 0;\n            top: 20px;\n            background-color: black;\n            color: white;\n            padding: 5px 10px;\n            border-radius: 5px;\n            z-index: 1000;\n            white-space: pre;\n          }\n        </style>\n        <a class=\"tip\" href=\"#\" data-tip=\"${tip}\">An error occurred</a>`,\n    });\n  }\n}\n","import '../messages/slides-renderer';\nimport './ai-loading';\nimport '../messages/text';\nimport './actions/text';\nimport './actions/action-wrapper';\nimport './actions/make-real';\nimport './actions/slides';\nimport './actions/mindmap';\nimport './actions/chat-text';\nimport './actions/image-to-text';\nimport './actions/image';\nimport './chat-cards';\nimport '../_common/components/chat-action-list';\nimport '../_common/components/copy-more';\n\nimport type { BaseSelection, EditorHost } from '@blocksuite/block-std';\nimport { ShadowlessElement, WithDisposable } from '@blocksuite/block-std';\nimport {\n  type AIError,\n  isInsidePageEditor,\n  PaymentRequiredError,\n  UnauthorizedError,\n} from '@blocksuite/blocks';\nimport { css, html, nothing, type PropertyValues } from 'lit';\nimport { customElement, property, query, state } from 'lit/decorators.js';\nimport { repeat } from 'lit/directives/repeat.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport {\n  EdgelessEditorActions,\n  PageEditorActions,\n} from '../_common/chat-actions-handle';\nimport { AffineAvatarIcon, AffineIcon, DownArrowIcon } from '../_common/icons';\nimport { AIChatErrorRenderer } from '../messages/error';\nimport { AIProvider } from '../provider';\nimport type { ChatContextValue, ChatItem, ChatMessage } from './chat-context';\nimport { HISTORY_IMAGE_ACTIONS } from './const';\nimport { AIPreloadConfig } from './preload-config';\n\n@customElement('chat-panel-messages')\nexport class ChatPanelMessages extends WithDisposable(ShadowlessElement) {\n  static override styles = css`\n    chat-panel-messages {\n      position: relative;\n    }\n\n    .chat-panel-messages {\n      display: flex;\n      flex-direction: column;\n      gap: 24px;\n      height: 100%;\n      position: relative;\n      overflow-y: auto;\n\n      chat-cards {\n        position: absolute;\n        bottom: 0;\n        width: 100%;\n      }\n    }\n\n    .chat-panel-messages-placeholder {\n      width: 100%;\n      position: absolute;\n      z-index: 1;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      gap: 12px;\n    }\n\n    .item-wrapper {\n      margin-left: 32px;\n    }\n\n    .user-info {\n      display: flex;\n      align-items: center;\n      gap: 10px;\n      margin-bottom: 4px;\n      color: var(--affine-text-primary-color);\n      font-size: 14px;\n      font-weight: 500;\n      user-select: none;\n    }\n\n    .avatar-container {\n      width: 24px;\n      height: 24px;\n    }\n\n    .avatar {\n      width: 100%;\n      height: 100%;\n      border-radius: 50%;\n      background-color: var(--affine-primary-color);\n    }\n\n    .avatar-container img {\n      width: 100%;\n      height: 100%;\n      border-radius: 50%;\n      object-fit: cover;\n    }\n\n    .down-indicator {\n      position: absolute;\n      left: 50%;\n      transform: translate(-50%, 0);\n      bottom: 24px;\n      z-index: 1;\n      border-radius: 50%;\n      width: 32px;\n      height: 32px;\n      border: 0.5px solid var(--affine-border-color);\n      background-color: var(--affine-background-primary-color);\n      box-shadow: var(--affine-shadow-2);\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      cursor: pointer;\n    }\n  `;\n\n  @state()\n  accessor _selectionValue: BaseSelection[] = [];\n\n  @state()\n  accessor showDownIndicator = false;\n\n  @state()\n  accessor avatarUrl = '';\n\n  @property({ attribute: false })\n  accessor host!: EditorHost;\n\n  @property({ attribute: false })\n  accessor isLoading!: boolean;\n\n  @property({ attribute: false })\n  accessor chatContextValue!: ChatContextValue;\n\n  @property({ attribute: false })\n  accessor updateContext!: (context: Partial<ChatContextValue>) => void;\n\n  @query('.chat-panel-messages')\n  accessor messagesContainer!: HTMLDivElement;\n\n  @state()\n  accessor showChatCards = true;\n\n  protected override updated(changedProperties: PropertyValues) {\n    if (changedProperties.has('host')) {\n      const { disposables } = this;\n\n      disposables.add(\n        this.host.selection.slots.changed.on(() => {\n          this._selectionValue = this.host.selection.value;\n        })\n      );\n      const { docModeService } = this.host.spec.getService('affine:page');\n      disposables.add(docModeService.onModeChange(() => this.requestUpdate()));\n    }\n  }\n\n  private _renderAIOnboarding() {\n    return this.isLoading ||\n      !this.host?.doc.awarenessStore.getFlag('enable_ai_onboarding')\n      ? nothing\n      : html`<div\n          style=${styleMap({\n            display: 'flex',\n            gap: '8px',\n            flexDirection: 'column',\n            alignItems: 'center',\n            marginTop: '16px',\n            width: '100%',\n          })}\n        >\n          ${repeat(\n            AIPreloadConfig,\n            config => config.text,\n            config => {\n              return html`<div\n                @click=${() => config.handler()}\n                style=${styleMap({\n                  display: 'flex',\n                  height: '28px',\n                  gap: '8px',\n                  width: '88%',\n                  alignItems: 'center',\n                  justifyContent: 'start',\n                  cursor: 'pointer',\n                })}\n              >\n                ${config.icon}\n                <div\n                  style=${styleMap({\n                    fontSize: '12px',\n                    fontWeight: '400',\n                    color: 'var(--affine-text-primary-color)',\n                  })}\n                >\n                  ${config.text}\n                </div>\n              </div>`;\n            }\n          )}\n        </div>`;\n  }\n\n  protected override render() {\n    const { items } = this.chatContextValue;\n    const { isLoading } = this;\n    const filteredItems = items.filter(item => {\n      return (\n        'role' in item ||\n        item.messages?.length === 3 ||\n        (HISTORY_IMAGE_ACTIONS.includes(item.action) &&\n          item.messages?.length === 2)\n      );\n    });\n\n    return html`<style>\n        .chat-panel-messages-placeholder div {\n          color: ${isLoading\n            ? 'var(--affine-text-secondary-color)'\n            : 'var(--affine-text-primary-color)'};\n          font-size: ${isLoading ? 'var(--affine-font-sm)' : '18px'};\n          font-weight: 600;\n        }\n      </style>\n\n      <div\n        class=\"chat-panel-messages\"\n        @scroll=${(evt: Event) => {\n          const element = evt.target as HTMLDivElement;\n          this.showDownIndicator =\n            element.scrollHeight - element.scrollTop - element.clientHeight >\n            200;\n        }}\n      >\n        ${items.length === 0\n          ? html`<div class=\"chat-panel-messages-placeholder\">\n              ${AffineIcon(\n                isLoading\n                  ? 'var(--affine-icon-secondary)'\n                  : 'var(--affine-primary-color)'\n              )}\n              <div>\n                ${this.isLoading\n                  ? 'AFFiNE AI is loading history...'\n                  : 'What can I help you with?'}\n              </div>\n              ${this._renderAIOnboarding()}\n            </div> `\n          : repeat(filteredItems, (item, index) => {\n              const isLast = index === filteredItems.length - 1;\n              return html`<div class=\"message\">\n                ${this.renderAvatar(item)}\n                <div class=\"item-wrapper\">${this.renderItem(item, isLast)}</div>\n              </div>`;\n            })}\n        <chat-cards\n          .updateContext=${this.updateContext}\n          .host=${this.host}\n          .isEmpty=${items.length === 0}\n          ?data-show=${this.showChatCards}\n        ></chat-cards>\n      </div>\n      ${this.showDownIndicator\n        ? html`<div class=\"down-indicator\" @click=${() => this.scrollToDown()}>\n            ${DownArrowIcon}\n          </div>`\n        : nothing} `;\n  }\n\n  override async connectedCallback() {\n    super.connectedCallback();\n\n    const res = await AIProvider.userInfo;\n    this.avatarUrl = res?.avatarUrl ?? '';\n    this.disposables.add(\n      AIProvider.slots.userInfo.on(userInfo => {\n        const { status, error } = this.chatContextValue;\n        this.avatarUrl = userInfo?.avatarUrl ?? '';\n        if (\n          status === 'error' &&\n          error instanceof UnauthorizedError &&\n          userInfo\n        ) {\n          this.updateContext({ status: 'idle', error: null });\n        }\n      })\n    );\n\n    this.disposables.add(\n      AIProvider.slots.toggleChatCards.on(({ visible }) => {\n        this.showChatCards = visible;\n      })\n    );\n  }\n\n  renderItem(item: ChatItem, isLast: boolean) {\n    const { status, error } = this.chatContextValue;\n    const { host } = this;\n\n    if (isLast && status === 'loading') {\n      return this.renderLoading();\n    }\n\n    if (\n      isLast &&\n      status === 'error' &&\n      (error instanceof PaymentRequiredError ||\n        error instanceof UnauthorizedError)\n    ) {\n      return AIChatErrorRenderer(host, error);\n    }\n\n    if ('role' in item) {\n      const state = isLast\n        ? status !== 'loading' && status !== 'transmitting'\n          ? 'finished'\n          : 'generating'\n        : 'finished';\n      const shouldRenderError = isLast && status === 'error' && !!error;\n      return html`<chat-text\n          .host=${host}\n          .attachments=${item.attachments}\n          .text=${item.content}\n          .state=${state}\n        ></chat-text>\n        ${shouldRenderError ? AIChatErrorRenderer(host, error) : nothing}\n        ${this.renderEditorActions(item, isLast)}`;\n    } else {\n      switch (item.action) {\n        case 'Create a presentation':\n          return html`<action-slides\n            .host=${host}\n            .item=${item}\n          ></action-slides>`;\n        case 'Make it real':\n          return html`<action-make-real\n            .host=${host}\n            .item=${item}\n          ></action-make-real>`;\n        case 'Brainstorm mindmap':\n          return html`<action-mindmap\n            .host=${host}\n            .item=${item}\n          ></action-mindmap>`;\n        case 'Explain this image':\n        case 'Generate a caption':\n          return html`<action-image-to-text\n            .host=${host}\n            .item=${item}\n          ></action-image-to-text>`;\n        default:\n          if (HISTORY_IMAGE_ACTIONS.includes(item.action)) {\n            return html`<action-image\n              .host=${host}\n              .item=${item}\n            ></action-image>`;\n          }\n\n          return html`<action-text\n            .item=${item}\n            .host=${host}\n            .isCode=${item.action === 'Explain this code' ||\n            item.action === 'Check code error'}\n          ></action-text>`;\n      }\n    }\n  }\n\n  renderAvatar(item: ChatItem) {\n    const isUser = 'role' in item && item.role === 'user';\n\n    return html`<div class=\"user-info\">\n      ${isUser\n        ? html`<div class=\"avatar-container\">\n            ${this.avatarUrl\n              ? html`<img .src=${this.avatarUrl} />`\n              : html`<div class=\"avatar\"></div>`}\n          </div>`\n        : AffineAvatarIcon}\n      ${isUser ? 'You' : 'AFFINE AI'}\n    </div>`;\n  }\n\n  renderLoading() {\n    return html` <ai-loading></ai-loading>`;\n  }\n\n  scrollToDown() {\n    this.messagesContainer.scrollTo(0, this.messagesContainer.scrollHeight);\n  }\n\n  retry = async () => {\n    const { doc } = this.host;\n    try {\n      const { chatSessionId } = this.chatContextValue;\n      if (!chatSessionId) return;\n\n      const abortController = new AbortController();\n      const items = [...this.chatContextValue.items];\n      const last = items[items.length - 1];\n      if ('content' in last) {\n        last.content = '';\n        last.createdAt = new Date().toISOString();\n      }\n      this.updateContext({ items, status: 'loading', error: null });\n\n      const stream = AIProvider.actions.chat?.({\n        sessionId: chatSessionId,\n        retry: true,\n        docId: doc.id,\n        workspaceId: doc.collection.id,\n        host: this.host,\n        stream: true,\n        signal: abortController.signal,\n        where: 'chat-panel',\n        control: 'chat-send',\n        isRootSession: true,\n      });\n\n      if (stream) {\n        this.updateContext({ abortController });\n        for await (const text of stream) {\n          const items = [...this.chatContextValue.items];\n          const last = items[items.length - 1] as ChatMessage;\n          last.content += text;\n          this.updateContext({ items, status: 'transmitting' });\n        }\n\n        this.updateContext({ status: 'success' });\n      }\n    } catch (error) {\n      this.updateContext({ status: 'error', error: error as AIError });\n    } finally {\n      this.updateContext({ abortController: null });\n    }\n  };\n\n  renderEditorActions(item: ChatMessage, isLast: boolean) {\n    const { status, chatSessionId } = this.chatContextValue;\n\n    if (item.role !== 'assistant') return nothing;\n\n    if (\n      isLast &&\n      status !== 'success' &&\n      status !== 'idle' &&\n      status !== 'error'\n    )\n      return nothing;\n\n    const { host } = this;\n    const { content, id: messageId } = item;\n    const actions = isInsidePageEditor(host)\n      ? PageEditorActions\n      : EdgelessEditorActions;\n\n    return html`\n      <chat-copy-more\n        .host=${host}\n        .actions=${actions}\n        .content=${content}\n        .isLast=${isLast}\n        .chatSessionId=${chatSessionId ?? undefined}\n        .messageId=${messageId}\n        .withMargin=${true}\n        .retry=${() => this.retry()}\n      ></chat-copy-more>\n      ${isLast && !!content\n        ? html`<chat-action-list\n            .actions=${actions}\n            .host=${host}\n            .content=${content}\n            .chatSessionId=${chatSessionId ?? undefined}\n            .messageId=${messageId ?? undefined}\n            .withMargin=${true}\n          ></chat-action-list>`\n        : nothing}\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'chat-panel-messages': ChatPanelMessages;\n  }\n}\n","import './chat-panel-input';\nimport './chat-panel-messages';\n\nimport type { EditorHost } from '@blocksuite/block-std';\nimport { ShadowlessElement, WithDisposable } from '@blocksuite/block-std';\nimport { debounce } from '@blocksuite/global/utils';\nimport type { Doc } from '@blocksuite/store';\nimport { css, html, type PropertyValues } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { createRef, type Ref, ref } from 'lit/directives/ref.js';\n\nimport { AIHelpIcon, SmallHintIcon } from '../_common/icons';\nimport { AIProvider } from '../provider';\nimport {\n  getSelectedImagesAsBlobs,\n  getSelectedTextContent,\n} from '../utils/selection-utils';\nimport type { ChatAction, ChatContextValue, ChatItem } from './chat-context';\nimport type { ChatPanelMessages } from './chat-panel-messages';\n\n@customElement('chat-panel')\nexport class ChatPanel extends WithDisposable(ShadowlessElement) {\n  static override styles = css`\n    chat-panel {\n      width: 100%;\n    }\n\n    .chat-panel-container {\n      display: flex;\n      flex-direction: column;\n      padding: 0 16px;\n      padding-top: 8px;\n      height: 100%;\n    }\n\n    .chat-panel-title {\n      background: var(--affine-background-primary-color);\n      position: relative;\n      padding: 8px 0px;\n      width: 100%;\n      height: 36px;\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      z-index: 1;\n\n      div:first-child {\n        font-size: 14px;\n        font-weight: 500;\n        color: var(--affine-text-secondary-color);\n      }\n\n      div:last-child {\n        width: 24px;\n        height: 24px;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        cursor: pointer;\n      }\n    }\n\n    chat-panel-messages {\n      flex: 1;\n      overflow-y: hidden;\n    }\n\n    .chat-panel-hints {\n      margin: 0 4px;\n      padding: 8px 12px;\n      border-radius: 8px;\n      border: 1px solid var(--affine-border-color);\n      font-size: 14px;\n      font-weight: 500;\n      cursor: pointer;\n    }\n\n    .chat-panel-hints :first-child {\n      color: var(--affine-text-primary-color);\n    }\n\n    .chat-panel-hints :nth-child(2) {\n      color: var(--affine-text-secondary-color);\n    }\n\n    .chat-panel-footer {\n      margin: 8px 0px;\n      height: 20px;\n      display: flex;\n      gap: 4px;\n      align-items: center;\n      color: var(--affine-text-secondary-color);\n      font-size: 12px;\n      user-select: none;\n    }\n  `;\n\n  private readonly _chatMessages: Ref<ChatPanelMessages> =\n    createRef<ChatPanelMessages>();\n\n  private _resettingCounter = 0;\n\n  private readonly _resetItems = debounce(() => {\n    const counter = ++this._resettingCounter;\n    this.isLoading = true;\n    (async () => {\n      const { doc } = this;\n\n      const [histories, actions] = await Promise.all([\n        AIProvider.histories?.chats(doc.collection.id, doc.id, { fork: false }),\n        AIProvider.histories?.actions(doc.collection.id, doc.id),\n      ]);\n\n      if (counter !== this._resettingCounter) return;\n\n      const items: ChatItem[] = actions ? [...actions] : [];\n\n      if (histories?.at(-1)) {\n        const history = histories.at(-1);\n        if (!history) return;\n        this.chatContextValue.chatSessionId = history.sessionId;\n        items.push(...history.messages);\n        AIProvider.LAST_ROOT_SESSION_ID = history.sessionId;\n      }\n\n      this.chatContextValue = {\n        ...this.chatContextValue,\n        items: items.sort((a, b) => {\n          return (\n            new Date(a.createdAt).getTime() - new Date(b.createdAt).getTime()\n          );\n        }),\n      };\n\n      this.isLoading = false;\n      this.scrollToDown();\n    })().catch(console.error);\n  }, 200);\n\n  @property({ attribute: false })\n  accessor host!: EditorHost;\n\n  @property({ attribute: false })\n  accessor doc!: Doc;\n\n  @state()\n  accessor isLoading = false;\n\n  @state()\n  accessor chatContextValue: ChatContextValue = {\n    quote: '',\n    images: [],\n    abortController: null,\n    items: [],\n    status: 'idle',\n    error: null,\n    markdown: '',\n    chatSessionId: null,\n  };\n\n  private readonly _cleanupHistories = async () => {\n    const notification =\n      this.host.std.spec.getService('affine:page').notificationService;\n    if (!notification) return;\n\n    if (\n      await notification.confirm({\n        title: 'Clear History',\n        message:\n          'Are you sure you want to clear all history? This action will permanently delete all content, including all chat logs and data, and cannot be undone.',\n        confirmText: 'Confirm',\n        cancelText: 'Cancel',\n      })\n    ) {\n      await AIProvider.histories?.cleanup(this.doc.collection.id, this.doc.id, [\n        this.chatContextValue.chatSessionId ?? '',\n        ...(\n          this.chatContextValue.items.filter(\n            item => 'sessionId' in item\n          ) as ChatAction[]\n        ).map(item => item.sessionId),\n      ]);\n      this.chatContextValue.chatSessionId = null;\n      notification.toast('History cleared');\n      this._resetItems();\n    }\n  };\n\n  protected override updated(_changedProperties: PropertyValues) {\n    if (_changedProperties.has('doc')) {\n      this.chatContextValue.chatSessionId = null;\n      this._resetItems();\n    }\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    if (!this.doc) throw new Error('doc is required');\n\n    AIProvider.slots.actions.on(({ action, event }) => {\n      const { status } = this.chatContextValue;\n\n      if (\n        action !== 'chat' &&\n        event === 'finished' &&\n        (status === 'idle' || status === 'success')\n      ) {\n        this._resetItems();\n      }\n\n      if (action === 'chat' && event === 'finished') {\n        AIProvider.slots.toggleChatCards.emit({\n          visible: true,\n          ok: status === 'success',\n        });\n      }\n    });\n\n    AIProvider.slots.userInfo.on(userInfo => {\n      if (userInfo) {\n        this._resetItems();\n      }\n    });\n  }\n\n  updateContext = (context: Partial<ChatContextValue>) => {\n    this.chatContextValue = { ...this.chatContextValue, ...context };\n  };\n\n  continueInChat = async () => {\n    const text = await getSelectedTextContent(this.host, 'plain-text');\n    const markdown = await getSelectedTextContent(this.host, 'markdown');\n    const images = await getSelectedImagesAsBlobs(this.host);\n    this.updateContext({\n      quote: text,\n      markdown,\n      images,\n    });\n  };\n\n  scrollToDown() {\n    requestAnimationFrame(() => this._chatMessages.value?.scrollToDown());\n  }\n\n  override render() {\n    return html` <div class=\"chat-panel-container\">\n      <div class=\"chat-panel-title\">\n        <div>AFFINE AI</div>\n        <div\n          @click=${() => {\n            AIProvider.toggleGeneralAIOnboarding?.(true);\n          }}\n        >\n          ${AIHelpIcon}\n        </div>\n      </div>\n      <chat-panel-messages\n        ${ref(this._chatMessages)}\n        .chatContextValue=${this.chatContextValue}\n        .updateContext=${this.updateContext}\n        .host=${this.host}\n        .isLoading=${this.isLoading}\n      ></chat-panel-messages>\n      <chat-panel-input\n        .chatContextValue=${this.chatContextValue}\n        .updateContext=${this.updateContext}\n        .host=${this.host}\n        .cleanupHistories=${this._cleanupHistories}\n      ></chat-panel-input>\n      <div class=\"chat-panel-footer\">\n        ${SmallHintIcon}\n        <div>AI outputs can be misleading or wrong</div>\n      </div>\n    </div>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'chat-panel': ChatPanel;\n  }\n}\n","import type { EditorHost } from '@blocksuite/block-std';\nimport { type AIError, openFileOrFiles } from '@blocksuite/blocks';\nimport { type ChatMessage } from '@blocksuite/presets';\nimport { css, html, LitElement, nothing } from 'lit';\nimport { customElement, property, query, state } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { repeat } from 'lit/directives/repeat.js';\n\nimport {\n  ChatAbortIcon,\n  ChatClearIcon,\n  ChatSendIcon,\n  CloseIcon,\n  ImageIcon,\n} from '../_common/icons';\nimport { AIProvider } from '../provider';\nimport { reportResponse } from '../utils/action-reporter';\nimport { readBlobAsURL } from '../utils/image';\nimport type { ChatContext } from './types';\n\nconst MaximumImageCount = 8;\n\n@customElement('chat-block-input')\nexport class ChatBlockInput extends LitElement {\n  static override styles = css`\n    :host {\n      width: 100%;\n    }\n    .ai-chat-input {\n      display: flex;\n      width: 100%;\n      min-height: 100px;\n      max-height: 206px;\n      padding: 8px 12px;\n      box-sizing: border-box;\n      border: 1px solid var(--affine-border-color);\n      border-radius: 4px;\n      flex-direction: column;\n      justify-content: space-between;\n      gap: 12px;\n      position: relative;\n      background-color: var(--affine-white-10);\n    }\n    .ai-chat-input {\n      textarea {\n        width: 100%;\n        padding: 0;\n        margin: 0;\n        border: none;\n        line-height: 22px;\n        font-size: var(--affine-font-sm);\n        font-weight: 400;\n        font-family: var(--affine-font-family);\n        color: var(--affine-text-primary-color);\n        box-sizing: border-box;\n        resize: none;\n        overflow-y: hidden;\n        background-color: transparent;\n        user-select: none;\n      }\n      textarea::placeholder {\n        font-size: 14px;\n        font-weight: 400;\n        font-family: var(--affine-font-family);\n        color: var(--affine-placeholder-color);\n      }\n      textarea:focus {\n        outline: none;\n      }\n    }\n    .chat-input-images {\n      display: flex;\n      gap: 4px;\n      flex-wrap: wrap;\n      position: relative;\n      .image-container {\n        width: 58px;\n        height: 58px;\n        border-radius: 4px;\n        border: 1px solid var(--affine-border-color);\n        cursor: pointer;\n        overflow: hidden;\n        position: relative;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        img {\n          max-width: 100%;\n          max-height: 100%;\n          width: auto;\n          height: auto;\n        }\n      }\n    }\n\n    .chat-panel-send svg rect {\n      fill: var(--affine-primary-color);\n    }\n    .chat-panel-send[aria-disabled='true'] {\n      cursor: not-allowed;\n    }\n    .chat-panel-send[aria-disabled='true'] svg rect {\n      fill: var(--affine-text-disable-color);\n    }\n\n    .close-wrapper {\n      width: 16px;\n      height: 16px;\n      border-radius: 4px;\n      border: 1px solid var(--affine-border-color);\n      justify-content: center;\n      align-items: center;\n      display: none;\n      position: absolute;\n      background-color: var(--affine-white);\n      z-index: 1;\n      cursor: pointer;\n    }\n    .close-wrapper:hover {\n      background-color: var(--affine-background-error-color);\n      border: 1px solid var(--affine-error-color);\n    }\n    .close-wrapper:hover svg path {\n      fill: var(--affine-error-color);\n    }\n    .chat-panel-input-actions {\n      display: flex;\n      gap: 8px;\n      align-items: center;\n      div {\n        width: 24px;\n        height: 24px;\n        cursor: pointer;\n      }\n      div:nth-child(2) {\n        margin-left: auto;\n      }\n    }\n\n    .chat-history-clear.disabled {\n      cursor: not-allowed;\n      opacity: 0.5;\n    }\n  `;\n\n  override render() {\n    const { images, status, messages } = this.chatContext;\n    const hasImages = images.length > 0;\n    const maxHeight = hasImages ? 272 + 2 : 200 + 2;\n    const disableCleanUp =\n      status === 'loading' || status === 'transmitting' || !messages.length;\n    const cleanButtonClasses = classMap({\n      'chat-history-clear': true,\n      disabled: disableCleanUp,\n    });\n\n    return html`<style>\n        .chat-panel-input {\n          border-color: ${this._focused\n            ? 'var(--affine-primary-color)'\n            : 'var(--affine-border-color)'};\n          box-shadow: ${this._focused ? 'var(--affine-active-shadow)' : 'none'};\n          max-height: ${maxHeight}px;\n          user-select: none;\n        }\n      </style>\n      <div class=\"ai-chat-input\">\n        ${hasImages ? this._renderImages(images) : nothing}\n        <textarea\n          rows=\"1\"\n          placeholder=\"What are your thoughts?\"\n          @keydown=${async (evt: KeyboardEvent) => {\n            if (evt.key === 'Enter' && !evt.shiftKey && !evt.isComposing) {\n              evt.preventDefault();\n              await this._send();\n            }\n          }}\n          @input=${() => {\n            const { textarea } = this;\n            this._isInputEmpty = !textarea.value.trim();\n            textarea.style.height = 'auto';\n            textarea.style.height = textarea.scrollHeight + 'px';\n            if (this.scrollHeight >= 202) {\n              textarea.style.height = '168px';\n              textarea.style.overflowY = 'scroll';\n            }\n          }}\n          @focus=${() => {\n            this._focused = true;\n          }}\n          @blur=${() => {\n            this._focused = false;\n          }}\n          @paste=${(event: ClipboardEvent) => {\n            const items = event.clipboardData?.items;\n            if (!items) return;\n            for (const index in items) {\n              const item = items[index];\n              if (item.kind === 'file' && item.type.indexOf('image') >= 0) {\n                const blob = item.getAsFile();\n                if (!blob) continue;\n                this._addImages([blob]);\n              }\n            }\n          }}\n        ></textarea>\n        <div class=\"chat-panel-input-actions\">\n          <div\n            class=${cleanButtonClasses}\n            @click=${async () => {\n              if (disableCleanUp) {\n                return;\n              }\n              await this.cleanupHistories();\n            }}\n          >\n            ${ChatClearIcon}\n          </div>\n          ${images.length < MaximumImageCount\n            ? html`<div\n                class=\"image-upload\"\n                @click=${async () => {\n                  const images = await openFileOrFiles({\n                    acceptType: 'Images',\n                    multiple: true,\n                  });\n                  if (!images) return;\n                  this._addImages(images);\n                }}\n              >\n                ${ImageIcon}\n              </div>`\n            : nothing}\n          ${status === 'transmitting'\n            ? html`<div\n                @click=${() => {\n                  this.chatContext.abortController?.abort();\n                  this.updateContext({ status: 'success' });\n                  reportResponse('aborted:stop');\n                }}\n              >\n                ${ChatAbortIcon}\n              </div>`\n            : html`<div\n                @click=\"${this._send}\"\n                class=\"chat-panel-send\"\n                aria-disabled=${this._isInputEmpty}\n              >\n                ${ChatSendIcon}\n              </div>`}\n        </div>\n      </div>`;\n  }\n\n  @property({ attribute: false })\n  accessor parentSessionId!: string;\n\n  @property({ attribute: false })\n  accessor latestMessageId!: string;\n\n  @property({ attribute: false })\n  accessor host!: EditorHost;\n\n  @property({ attribute: false })\n  accessor updateChatBlock!: () => Promise<void>;\n\n  @property({ attribute: false })\n  accessor createChatBlock!: () => Promise<void>;\n\n  @property({ attribute: false })\n  accessor cleanupHistories!: () => Promise<void>;\n\n  @property({ attribute: false })\n  accessor updateContext!: (context: Partial<ChatContext>) => void;\n\n  @property({ attribute: false })\n  accessor chatContext!: ChatContext;\n\n  @query('textarea')\n  accessor textarea!: HTMLTextAreaElement;\n\n  @state()\n  accessor _isInputEmpty = true;\n\n  @state()\n  accessor _focused = false;\n\n  @query('.close-wrapper')\n  accessor closeWrapper: HTMLDivElement | null = null;\n\n  @state()\n  accessor _curIndex = -1;\n\n  private readonly _addImages = (images: File[]) => {\n    const oldImages = this.chatContext.images;\n    this.updateContext({\n      images: [...oldImages, ...images].slice(0, MaximumImageCount),\n    });\n  };\n\n  private _renderImages(images: File[]) {\n    return html`\n      <div\n        class=\"chat-input-images\"\n        @mouseleave=${() => {\n          if (!this.closeWrapper) return;\n          this.closeWrapper.style.display = 'none';\n          this._curIndex = -1;\n        }}\n      >\n        ${repeat(\n          images,\n          image => image.name,\n          (image, index) =>\n            html`<div\n              class=\"image-container\"\n              @mouseenter=${(evt: MouseEvent) => {\n                const ele = evt.target as HTMLImageElement;\n                const rect = ele.getBoundingClientRect();\n                if (!ele.parentElement) return;\n                const parentRect = ele.parentElement.getBoundingClientRect();\n                const left = Math.abs(rect.right - parentRect.left) - 8;\n                const top = Math.abs(parentRect.top - rect.top) - 8;\n                this._curIndex = index;\n                if (!this.closeWrapper) return;\n                this.closeWrapper.style.display = 'flex';\n                this.closeWrapper.style.left = left + 'px';\n                this.closeWrapper.style.top = top + 'px';\n              }}\n            >\n              <img src=\"${URL.createObjectURL(image)}\" alt=\"${image.name}\" />\n            </div>`\n        )}\n        <div\n          class=\"close-wrapper\"\n          @click=${() => {\n            if (this._curIndex >= 0 && this._curIndex < images.length) {\n              const newImages = [...images];\n              newImages.splice(this._curIndex, 1);\n              this.updateContext({ images: newImages });\n              this._curIndex = -1;\n              if (!this.closeWrapper) return;\n              this.closeWrapper.style.display = 'none';\n            }\n          }}\n        >\n          ${CloseIcon}\n        </div>\n      </div>\n    `;\n  }\n\n  private readonly _send = async () => {\n    const { images, status } = this.chatContext;\n    if (status === 'loading' || status === 'transmitting') return;\n\n    const text = this.textarea.value;\n    if (!text && !images.length) {\n      return;\n    }\n\n    const { doc } = this.host;\n    this.textarea.value = '';\n    this._isInputEmpty = true;\n    this.updateContext({\n      images: [],\n      status: 'loading',\n      error: null,\n    });\n\n    const attachments = await Promise.all(\n      images?.map(image => readBlobAsURL(image))\n    );\n\n    const userInfo = await AIProvider.userInfo;\n    this.updateContext({\n      messages: [\n        ...this.chatContext.messages,\n        {\n          id: '',\n          content: text,\n          role: 'user',\n          createdAt: new Date().toISOString(),\n          attachments,\n          userId: userInfo?.id,\n          userName: userInfo?.name,\n          avatarUrl: userInfo?.avatarUrl ?? undefined,\n        },\n        {\n          id: '',\n          content: '',\n          role: 'assistant',\n          createdAt: new Date().toISOString(),\n        },\n      ],\n    });\n\n    const { currentChatBlockId, currentSessionId } = this.chatContext;\n    let content = '';\n    const chatBlockExists = !!currentChatBlockId;\n    try {\n      // If has not forked a chat session, fork a new one\n      let chatSessionId = currentSessionId;\n      if (!chatSessionId) {\n        const forkSessionId = await AIProvider.forkChat?.({\n          workspaceId: doc.collection.id,\n          docId: doc.id,\n          sessionId: this.parentSessionId,\n          latestMessageId: this.latestMessageId,\n        });\n        if (!forkSessionId) return;\n        this.updateContext({\n          currentSessionId: forkSessionId,\n        });\n        chatSessionId = forkSessionId;\n      }\n\n      const abortController = new AbortController();\n      const stream = AIProvider.actions.chat?.({\n        input: text,\n        sessionId: chatSessionId,\n        docId: doc.id,\n        attachments: images,\n        workspaceId: doc.collection.id,\n        host: this.host,\n        stream: true,\n        signal: abortController.signal,\n        where: 'ai-chat-block',\n        control: 'chat-send',\n      });\n\n      if (stream) {\n        this.updateContext({\n          abortController,\n        });\n\n        for await (const text of stream) {\n          const messages = [...this.chatContext.messages];\n          const last = messages[messages.length - 1] as ChatMessage;\n          last.content += text;\n          this.updateContext({ messages, status: 'transmitting' });\n          content += text;\n        }\n\n        this.updateContext({ status: 'success' });\n      }\n    } catch (error) {\n      console.error(error);\n      this.updateContext({ status: 'error', error: error as AIError });\n    } finally {\n      if (content) {\n        if (!chatBlockExists) {\n          await this.createChatBlock();\n        }\n        // Update new chat block messages if there are contents returned from AI\n        await this.updateChatBlock();\n      }\n\n      this.updateContext({ abortController: null });\n    }\n  };\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'chat-block-input': ChatBlockInput;\n  }\n}\n","import { i18nTime } from '@affine/i18n';\nimport { css, html, LitElement } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\n\n@customElement('date-time')\nexport class DateTime extends LitElement {\n  static override styles = css`\n    :host {\n      width: 100%;\n    }\n    .date-time-container {\n      width: 100%;\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n    }\n    .line {\n      flex-grow: 1;\n      height: 0.5px;\n      background-color: var(--affine-border-color);\n    }\n    .date-time {\n      padding: 0 8px;\n      font-size: var(--affine-font-xs);\n      font-weight: 400;\n      line-height: 22px;\n      text-align: center;\n      color: var(--affine-text-secondary-color);\n    }\n  `;\n\n  override render() {\n    const date = i18nTime(this.date, {\n      relative: {\n        max: [1, 'day'],\n        accuracy: 'minute',\n        weekday: true,\n      },\n      absolute: {\n        accuracy: 'second',\n      },\n    });\n\n    return html`<div class=\"date-time-container\">\n      <div class=\"line\"></div>\n      <div class=\"date-time\">${date}</div>\n      <div class=\"line\"></div>\n    </div>`;\n  }\n\n  @property({ attribute: false })\n  accessor date!: string;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'date-time': DateTime;\n  }\n}\n","import './chat-block-input';\nimport './date-time';\nimport '../_common/components/chat-action-list';\nimport '../_common/components/copy-more';\n\nimport { type EditorHost } from '@blocksuite/block-std';\nimport {\n  type AIError,\n  CanvasElementType,\n  ConnectorMode,\n  type EdgelessRootService,\n} from '@blocksuite/blocks';\nimport {\n  type AIChatBlockModel,\n  type ChatMessage,\n  ChatMessagesSchema,\n} from '@blocksuite/presets';\nimport { html, LitElement, nothing } from 'lit';\nimport { customElement, property, query, state } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { repeat } from 'lit/directives/repeat.js';\n\nimport {\n  ChatBlockPeekViewActions,\n  constructUserInfoWithMessages,\n  queryHistoryMessages,\n} from '../_common/chat-actions-handle';\nimport { SmallHintIcon } from '../_common/icons';\nimport { AIChatErrorRenderer } from '../messages/error';\nimport { AIProvider } from '../provider';\nimport { PeekViewStyles } from './styles';\nimport type { ChatContext } from './types';\nimport { calcChildBound } from './utils';\n\n@customElement('ai-chat-block-peek-view')\nexport class AIChatBlockPeekView extends LitElement {\n  static override styles = PeekViewStyles;\n\n  private get _rootService() {\n    return this.host.spec.getService('affine:page');\n  }\n\n  private get _modeService() {\n    return this._rootService.docModeService;\n  }\n\n  private get parentSessionId() {\n    return this.parentModel.sessionId;\n  }\n\n  private get historyMessagesString() {\n    return this.parentModel.messages;\n  }\n\n  private get parentChatBlockId() {\n    return this.parentModel.id;\n  }\n\n  private get parentRootDocId() {\n    return this.parentModel.rootDocId;\n  }\n\n  private get parentRootWorkspaceId() {\n    return this.parentModel.rootWorkspaceId;\n  }\n\n  private readonly _deserializeHistoryChatMessages = (\n    historyMessagesString: string\n  ) => {\n    try {\n      const result = ChatMessagesSchema.safeParse(\n        JSON.parse(historyMessagesString)\n      );\n      if (result.success) {\n        return result.data;\n      } else {\n        return [];\n      }\n    } catch {\n      return [];\n    }\n  };\n\n  private readonly _constructBranchChatBlockMessages = async (\n    rootWorkspaceId: string,\n    rootDocId: string,\n    forkSessionId: string\n  ) => {\n    const currentUserInfo = await AIProvider.userInfo;\n    const forkMessages = await queryHistoryMessages(\n      rootWorkspaceId,\n      rootDocId,\n      forkSessionId\n    );\n    const forkLength = forkMessages.length;\n    const historyLength = this._historyMessages.length;\n\n    if (!forkLength || forkLength <= historyLength) {\n      return constructUserInfoWithMessages(forkMessages, currentUserInfo);\n    }\n\n    // Update history messages with the fork messages, keep user info\n    const historyMessages = this._historyMessages.map((message, idx) => {\n      return {\n        ...message,\n        id: forkMessages[idx]?.id ?? message.id,\n        attachments: [],\n      };\n    });\n\n    const currentChatMessages = constructUserInfoWithMessages(\n      forkMessages.slice(historyLength),\n      currentUserInfo\n    );\n    return [...historyMessages, ...currentChatMessages];\n  };\n\n  private readonly _resetContext = () => {\n    const { abortController } = this.chatContext;\n    if (abortController) {\n      abortController.abort();\n    }\n\n    this.updateContext({\n      status: 'idle',\n      error: null,\n      images: [],\n      abortController: null,\n      messages: [],\n      currentSessionId: null,\n      currentChatBlockId: null,\n    });\n  };\n\n  /**\n   * Create a new AI chat block based on the current session and history messages\n   */\n  createAIChatBlock = async () => {\n    // Only create AI chat block in edgeless mode\n    const mode = this._modeService.getMode();\n    if (mode !== 'edgeless') {\n      return;\n    }\n\n    // If there is already a chat block, do not create a new one\n    if (this.chatContext.currentChatBlockId) {\n      return;\n    }\n\n    // If there is no session id or chat messages, do not create a new chat block\n    if (\n      !this.chatContext.currentSessionId ||\n      !this.chatContext.messages.length\n    ) {\n      return;\n    }\n\n    const { doc } = this.host;\n    // create a new AI chat block\n    const surfaceBlock = doc\n      .getBlocks()\n      .find(block => block.flavour === 'affine:surface');\n    if (!surfaceBlock) {\n      return;\n    }\n\n    // Get fork session messages\n    const { parentRootWorkspaceId, parentRootDocId } = this;\n    const messages = await this._constructBranchChatBlockMessages(\n      parentRootWorkspaceId,\n      parentRootDocId,\n      this.chatContext.currentSessionId\n    );\n    if (!messages.length) {\n      return;\n    }\n\n    const edgelessService = this._rootService as EdgelessRootService;\n    const bound = calcChildBound(this.parentModel, edgelessService);\n    const aiChatBlockId = edgelessService.addBlock(\n      'affine:embed-ai-chat' as keyof BlockSuite.BlockModels,\n      {\n        xywh: bound.serialize(),\n        messages: JSON.stringify(messages),\n        sessionId: this.chatContext.currentSessionId,\n        rootWorkspaceId: parentRootWorkspaceId,\n        rootDocId: parentRootDocId,\n      },\n      surfaceBlock.id\n    );\n\n    if (!aiChatBlockId) {\n      return;\n    }\n\n    this.updateContext({ currentChatBlockId: aiChatBlockId });\n\n    // Connect the parent chat block to the AI chat block\n    edgelessService.addElement(CanvasElementType.CONNECTOR, {\n      mode: ConnectorMode.Curve,\n      controllers: [],\n      source: { id: this.parentChatBlockId },\n      target: { id: aiChatBlockId },\n    });\n\n    edgelessService.telemetryService?.track('CanvasElementAdded', {\n      control: 'conversation',\n      page: 'whiteboard editor',\n      module: 'canvas',\n      segment: 'whiteboard',\n      type: 'chat block',\n      category: 'branch',\n    });\n  };\n\n  /**\n   * Update the current chat messages with the new message\n   */\n  updateChatBlockMessages = async () => {\n    if (\n      !this.chatContext.currentChatBlockId ||\n      !this.chatContext.currentSessionId\n    ) {\n      return;\n    }\n\n    const { doc } = this.host;\n    const chatBlock = doc.getBlock(this.chatContext.currentChatBlockId);\n\n    // Get fork session messages\n    const { parentRootWorkspaceId, parentRootDocId } = this;\n    const messages = await this._constructBranchChatBlockMessages(\n      parentRootWorkspaceId,\n      parentRootDocId,\n      this.chatContext.currentSessionId\n    );\n    if (!messages.length) {\n      return;\n    }\n    doc.updateBlock(chatBlock.model, {\n      messages: JSON.stringify(messages),\n    });\n  };\n\n  updateContext = (context: Partial<ChatContext>) => {\n    this.chatContext = { ...this.chatContext, ...context };\n  };\n\n  /**\n   * Clean current chat messages and delete the newly created AI chat block\n   */\n  cleanCurrentChatHistories = async () => {\n    const { notificationService } = this._rootService;\n    if (!notificationService) {\n      return;\n    }\n\n    const { currentChatBlockId, currentSessionId } = this.chatContext;\n    if (!currentChatBlockId && !currentSessionId) {\n      return;\n    }\n\n    if (\n      await notificationService.confirm({\n        title: 'Clear History',\n        message:\n          'Are you sure you want to clear all history? This action will permanently delete all content, including all chat logs and data, and cannot be undone.',\n        confirmText: 'Confirm',\n        cancelText: 'Cancel',\n      })\n    ) {\n      const { doc } = this.host;\n      if (currentSessionId) {\n        await AIProvider.histories?.cleanup(doc.collection.id, doc.id, [\n          currentSessionId,\n        ]);\n      }\n\n      if (currentChatBlockId) {\n        const edgelessService = this._rootService as EdgelessRootService;\n        const chatBlock = doc.getBlock(currentChatBlockId).model;\n        if (chatBlock) {\n          const connectors = edgelessService.getConnectors(\n            chatBlock as AIChatBlockModel\n          );\n          doc.transact(() => {\n            // Delete the AI chat block\n            edgelessService.removeElement(currentChatBlockId);\n            // Delete the connectors\n            connectors.forEach(connector => {\n              edgelessService.removeElement(connector.id);\n            });\n          });\n        }\n      }\n\n      notificationService.toast('History cleared');\n      this._resetContext();\n    }\n  };\n\n  /**\n   * Retry the last chat message\n   */\n  retry = async () => {\n    const { doc } = this.host;\n    const { currentChatBlockId, currentSessionId } = this.chatContext;\n    if (!currentChatBlockId || !currentSessionId) {\n      return;\n    }\n\n    let content = '';\n    try {\n      const abortController = new AbortController();\n\n      const messages = [...this.chatContext.messages];\n      const last = messages[messages.length - 1];\n      if ('content' in last) {\n        last.content = '';\n        last.createdAt = new Date().toISOString();\n      }\n      this.updateContext({ messages, status: 'loading', error: null });\n\n      const stream = AIProvider.actions.chat?.({\n        sessionId: currentSessionId,\n        retry: true,\n        docId: doc.id,\n        workspaceId: doc.collection.id,\n        host: this.host,\n        stream: true,\n        signal: abortController.signal,\n        where: 'ai-chat-block',\n        control: 'chat-send',\n      });\n\n      if (stream) {\n        this.updateContext({ abortController });\n        for await (const text of stream) {\n          const messages = [...this.chatContext.messages];\n          const last = messages[messages.length - 1] as ChatMessage;\n          last.content += text;\n          this.updateContext({ messages, status: 'transmitting' });\n          content += text;\n        }\n\n        this.updateContext({ status: 'success' });\n      }\n    } catch (error) {\n      this.updateContext({ status: 'error', error: error as AIError });\n    } finally {\n      this.updateContext({ abortController: null });\n      if (content) {\n        // Update new chat block messages if there are contents returned from AI\n        await this.updateChatBlockMessages();\n      }\n    }\n  };\n\n  CurrentMessages = (currentMessages: ChatMessage[]) => {\n    if (!currentMessages.length) {\n      return nothing;\n    }\n\n    const { host } = this;\n    const actions = ChatBlockPeekViewActions;\n\n    return html`${repeat(currentMessages, (message, idx) => {\n      const { status, error } = this.chatContext;\n      const isAssistantMessage = message.role === 'assistant';\n      const isLastReply =\n        idx === currentMessages.length - 1 && isAssistantMessage;\n      const messageState =\n        isLastReply && (status === 'transmitting' || status === 'loading')\n          ? 'generating'\n          : 'finished';\n      const shouldRenderError = isLastReply && status === 'error' && !!error;\n      const isNotReady = status === 'transmitting' || status === 'loading';\n      const shouldRenderCopyMore =\n        isAssistantMessage && !(isLastReply && isNotReady);\n      const shouldRenderActions =\n        isLastReply && !!message.content && !isNotReady;\n\n      const messageClasses = classMap({\n        'assistant-message-container': isAssistantMessage,\n      });\n\n      const { attachments, role, content } = message;\n      const userInfo = {\n        userId: message.userId,\n        userName: message.userName,\n        avatarUrl: message.avatarUrl,\n      };\n\n      return html`<div class=${messageClasses}>\n        <ai-chat-message\n          .host=${host}\n          .state=${messageState}\n          .content=${content}\n          .attachments=${attachments}\n          .messageRole=${role}\n          .userInfo=${userInfo}\n        ></ai-chat-message>\n        ${shouldRenderError ? AIChatErrorRenderer(host, error) : nothing}\n        ${shouldRenderCopyMore\n          ? html` <chat-copy-more\n              .host=${host}\n              .actions=${actions}\n              .content=${message.content}\n              .isLast=${isLastReply}\n              .chatSessionId=${this.chatContext.currentSessionId ?? undefined}\n              .messageId=${message.id ?? undefined}\n              .retry=${() => this.retry()}\n            ></chat-copy-more>`\n          : nothing}\n        ${shouldRenderActions\n          ? html`<chat-action-list\n              .host=${host}\n              .actions=${actions}\n              .content=${message.content}\n              .chatSessionId=${this.chatContext.currentSessionId ?? undefined}\n              .messageId=${message.id ?? undefined}\n              .layoutDirection=${'horizontal'}\n            ></chat-action-list>`\n          : nothing}\n      </div>`;\n    })}`;\n  };\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this._historyMessages = this._deserializeHistoryChatMessages(\n      this.historyMessagesString\n    );\n    const { parentRootWorkspaceId, parentRootDocId, parentSessionId } = this;\n    queryHistoryMessages(\n      parentRootWorkspaceId,\n      parentRootDocId,\n      parentSessionId\n    )\n      .then(messages => {\n        this._historyMessages = this._historyMessages.map((message, idx) => {\n          return {\n            ...message,\n            attachments: messages[idx]?.attachments ?? [],\n          };\n        });\n      })\n      .catch((err: Error) => {\n        console.error('Query history messages failed', err);\n      });\n  }\n\n  override firstUpdated() {\n    // first time render, scroll ai-chat-messages-container to bottom\n    requestAnimationFrame(() => {\n      if (this._chatMessagesContainer) {\n        this._chatMessagesContainer.scrollTop =\n          this._chatMessagesContainer.scrollHeight;\n      }\n    });\n  }\n\n  override render() {\n    const { host, _historyMessages } = this;\n    if (!_historyMessages.length) {\n      return nothing;\n    }\n\n    const latestHistoryMessage = _historyMessages[_historyMessages.length - 1];\n    const latestMessageCreatedAt = latestHistoryMessage.createdAt;\n    const latestHistoryMessageId = latestHistoryMessage.id;\n    const {\n      parentSessionId,\n      updateChatBlockMessages,\n      createAIChatBlock,\n      cleanCurrentChatHistories,\n      chatContext,\n      updateContext,\n    } = this;\n\n    const { messages: currentChatMessages } = chatContext;\n\n    return html`<div class=\"ai-chat-block-peek-view-container\">\n      <div class=\"ai-chat-messages-container\">\n        <ai-chat-messages\n          .host=${host}\n          .messages=${_historyMessages}\n        ></ai-chat-messages>\n        <date-time .date=${latestMessageCreatedAt}></date-time>\n        <div class=\"new-chat-messages-container\">\n          ${this.CurrentMessages(currentChatMessages)}\n        </div>\n      </div>\n      <chat-block-input\n        .host=${host}\n        .parentSessionId=${parentSessionId}\n        .latestMessageId=${latestHistoryMessageId}\n        .updateChatBlock=${updateChatBlockMessages}\n        .createChatBlock=${createAIChatBlock}\n        .cleanupHistories=${cleanCurrentChatHistories}\n        .chatContext=${chatContext}\n        .updateContext=${updateContext}\n      ></chat-block-input>\n      <div class=\"peek-view-footer\">\n        ${SmallHintIcon}\n        <div>AI outputs can be misleading or wrong</div>\n      </div>\n    </div> `;\n  }\n\n  @query('.ai-chat-messages-container')\n  accessor _chatMessagesContainer!: HTMLDivElement;\n\n  @property({ attribute: false })\n  accessor parentModel!: AIChatBlockModel;\n\n  @property({ attribute: false })\n  accessor host!: EditorHost;\n\n  @state()\n  accessor _historyMessages: ChatMessage[] = [];\n\n  @state()\n  accessor chatContext: ChatContext = {\n    status: 'idle',\n    error: null,\n    images: [],\n    abortController: null,\n    messages: [],\n    currentSessionId: null,\n    currentChatBlockId: null,\n  };\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'ai-chat-block-peek-view': AIChatBlockPeekView;\n  }\n}\n\nexport const AIChatBlockPeekViewTemplate = (\n  parentModel: AIChatBlockModel,\n  host: EditorHost\n) => {\n  return html`<ai-chat-block-peek-view\n    .parentModel=${parentModel}\n    .host=${host}\n  ></ai-chat-block-peek-view>`;\n};\n","import '@dotlottie/player-component';\n\nimport { html } from 'lit';\n\nexport const AIStarIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"none\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <g clip-path=\"url(#clip0_7444_26654)\">\n    <path\n      d=\"M9.40033 4.57585C9.36627 4.27519 9.11207 4.04792 8.80948 4.04761C8.50689 4.0473 8.25223 4.27405 8.21756 4.57465C7.99211 6.52928 7.40771 7.90373 6.46492 8.84651C5.52213 9.7893 4.14769 10.3737 2.19305 10.5991C1.89246 10.6338 1.66571 10.8885 1.66602 11.1911C1.66633 11.4937 1.8936 11.7479 2.19426 11.7819C4.11659 11.9997 5.52025 12.5838 6.48542 13.5315C7.44696 14.4757 8.04356 15.8498 8.21597 17.7908C8.24327 18.0981 8.50096 18.3337 8.80954 18.3333C9.11813 18.333 9.37528 18.0969 9.40189 17.7894C9.56714 15.8804 10.1632 14.4774 11.1295 13.5111C12.0958 12.5448 13.4988 11.9487 15.4078 11.7835C15.7153 11.7569 15.9514 11.4997 15.9517 11.1911C15.9521 10.8825 15.7165 10.6249 15.4092 10.5976C13.4683 10.4252 12.0941 9.82855 11.15 8.86701C10.2022 7.90184 9.61807 6.49818 9.40033 4.57585Z\"\n      fill=\"#1E96EB\"\n    />\n    <path\n      d=\"M15.7849 1.87208C15.7717 1.75516 15.6728 1.66678 15.5551 1.66666C15.4375 1.66654 15.3384 1.75472 15.3249 1.87162C15.2373 2.63175 15.01 3.16626 14.6434 3.5329C14.2767 3.89954 13.7422 4.1268 12.9821 4.21448C12.8652 4.22796 12.777 4.327 12.7771 4.44467C12.7772 4.56234 12.8656 4.6612 12.9826 4.67445C13.7301 4.75912 14.276 4.9863 14.6513 5.35485C15.0253 5.72203 15.2573 6.25642 15.3243 7.01121C15.335 7.13075 15.4352 7.22235 15.5552 7.22221C15.6752 7.22208 15.7752 7.13025 15.7855 7.01069C15.8498 6.26831 16.0816 5.72268 16.4574 5.3469C16.8332 4.97111 17.3788 4.73932 18.1212 4.67505C18.2407 4.6647 18.3325 4.5647 18.3327 4.44469C18.3328 4.32469 18.2412 4.22448 18.1217 4.21386C17.3669 4.14681 16.8325 3.9148 16.4653 3.54087C16.0968 3.16552 15.8696 2.61966 15.7849 1.87208Z\"\n      fill=\"#1E96EB\"\n    />\n  </g>\n  <defs>\n    <clipPath id=\"clip0_7444_26654\">\n      <rect width=\"20\" height=\"20\" fill=\"white\" />\n    </clipPath>\n  </defs>\n</svg>`;\n\nexport const AIStarIconWithAnimation = html`<dotlottie-player\n  src='{\"v\":\"5.12.1\",\"fr\":120,\"ip\":0,\"op\":239,\"w\":240,\"h\":240,\"nm\":\"ai\",\"ddd\":0,\"assets\":[],\"layers\":[{\"ddd\":0,\"ind\":1,\"ty\":4,\"nm\":\"big 2\",\"sr\":1,\"ks\":{\"o\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.5],\"y\":[1]},\"o\":{\"x\":[0.5],\"y\":[0]},\"t\":38,\"s\":[80]},{\"t\":76,\"s\":[100]}],\"ix\":11},\"r\":{\"a\":0,\"k\":0,\"ix\":10},\"p\":{\"a\":0,\"k\":[107.859,132.143,0],\"ix\":2,\"l\":2},\"a\":{\"a\":0,\"k\":[8.572,11.429,0],\"ix\":1,\"l\":2},\"s\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.5,0.5,0.5],\"y\":[1,1,1]},\"o\":{\"x\":[0.5,0.5,0.5],\"y\":[0,0,0]},\"t\":38,\"s\":[0,0,100]},{\"t\":76,\"s\":[1005,1005,100]}],\"ix\":6,\"l\":2}},\"ao\":0,\"shapes\":[{\"ty\":\"gr\",\"it\":[{\"ind\":0,\"ty\":\"sh\",\"ix\":1,\"ks\":{\"a\":0,\"k\":{\"i\":[[0.261,2.307],[0.363,0],[0.041,-0.361],[1.131,-1.132],[2.346,-0.271],[-0.001,-0.363],[-0.361,-0.041],[-1.158,-1.137],[-0.207,-2.329],[-0.37,0],[-0.032,0.369],[-1.16,1.16],[-2.291,0.198],[-0.001,0.371],[0.368,0.033],[1.133,1.154]],\"o\":[[-0.041,-0.361],[-0.363,0],[-0.271,2.345],[-1.132,1.131],[-0.36,0.042],[0,0.363],[2.307,0.262],[1.154,1.133],[0.033,0.369],[0.37,0],[0.198,-2.29],[1.16,-1.159],[0.369,-0.032],[0,-0.37],[-2.329,-0.207],[-1.138,-1.158]],\"v\":[[0.71,-7.937],[0.001,-8.571],[-0.709,-7.938],[-2.812,-2.812],[-7.939,-0.709],[-8.571,0.001],[-7.937,0.71],[-2.788,2.81],[-0.711,7.921],[0.001,8.572],[0.712,7.919],[2.785,2.785],[7.919,0.712],[8.572,0.001],[7.921,-0.711],[2.81,-2.788]],\"c\":true},\"ix\":2},\"nm\":\" 1\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ty\":\"fl\",\"c\":{\"a\":0,\"k\":[0.117647058824,0.588235294118,0.921568627451,1],\"ix\":4},\"o\":{\"a\":0,\"k\":100,\"ix\":5},\"r\":1,\"bm\":0,\"nm\":\" 1\",\"mn\":\"ADBE Vector Graphic - Fill\",\"hd\":false},{\"ty\":\"tr\",\"p\":{\"a\":0,\"k\":[8.572,11.429],\"ix\":2},\"a\":{\"a\":0,\"k\":[0,0],\"ix\":1},\"s\":{\"a\":0,\"k\":[100,100],\"ix\":3},\"r\":{\"a\":0,\"k\":0,\"ix\":6},\"o\":{\"a\":0,\"k\":100,\"ix\":7},\"sk\":{\"a\":0,\"k\":0,\"ix\":4},\"sa\":{\"a\":0,\"k\":0,\"ix\":5},\"nm\":\"\"}],\"nm\":\" 1\",\"np\":4,\"cix\":2,\"bm\":0,\"ix\":1,\"mn\":\"ADBE Vector Group\",\"hd\":false}],\"ip\":0,\"op\":8400,\"st\":0,\"ct\":1,\"bm\":0},{\"ddd\":0,\"ind\":2,\"ty\":4,\"nm\":\"big\",\"sr\":1,\"ks\":{\"o\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.5],\"y\":[1]},\"o\":{\"x\":[0.5],\"y\":[0]},\"t\":0,\"s\":[100]},{\"i\":{\"x\":[0.5],\"y\":[1]},\"o\":{\"x\":[0.5],\"y\":[0]},\"t\":15,\"s\":[80]},{\"t\":38,\"s\":[0]}],\"ix\":11},\"r\":{\"a\":0,\"k\":0,\"ix\":10},\"p\":{\"a\":0,\"k\":[107.859,132.143,0],\"ix\":2,\"l\":2},\"a\":{\"a\":0,\"k\":[8.572,11.429,0],\"ix\":1,\"l\":2},\"s\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.5,0.5,0.5],\"y\":[1,1,1]},\"o\":{\"x\":[0.5,0.5,0.5],\"y\":[0,0,0]},\"t\":0,\"s\":[1005,1005,100]},{\"i\":{\"x\":[0.5,0.5,0.5],\"y\":[1,1,1]},\"o\":{\"x\":[0.5,0.5,0.5],\"y\":[0,0,0]},\"t\":15,\"s\":[1035,1035,100]},{\"t\":38,\"s\":[0,0,100]}],\"ix\":6,\"l\":2}},\"ao\":0,\"shapes\":[{\"ty\":\"gr\",\"it\":[{\"ind\":0,\"ty\":\"sh\",\"ix\":1,\"ks\":{\"a\":0,\"k\":{\"i\":[[0.261,2.307],[0.363,0],[0.041,-0.361],[1.131,-1.132],[2.346,-0.271],[-0.001,-0.363],[-0.361,-0.041],[-1.158,-1.137],[-0.207,-2.329],[-0.37,0],[-0.032,0.369],[-1.16,1.16],[-2.291,0.198],[-0.001,0.371],[0.368,0.033],[1.133,1.154]],\"o\":[[-0.041,-0.361],[-0.363,0],[-0.271,2.345],[-1.132,1.131],[-0.36,0.042],[0,0.363],[2.307,0.262],[1.154,1.133],[0.033,0.369],[0.37,0],[0.198,-2.29],[1.16,-1.159],[0.369,-0.032],[0,-0.37],[-2.329,-0.207],[-1.138,-1.158]],\"v\":[[0.71,-7.937],[0.001,-8.571],[-0.709,-7.938],[-2.812,-2.812],[-7.939,-0.709],[-8.571,0.001],[-7.937,0.71],[-2.788,2.81],[-0.711,7.921],[0.001,8.572],[0.712,7.919],[2.785,2.785],[7.919,0.712],[8.572,0.001],[7.921,-0.711],[2.81,-2.788]],\"c\":true},\"ix\":2},\"nm\":\" 1\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ty\":\"fl\",\"c\":{\"a\":0,\"k\":[0.117647058824,0.588235294118,0.921568627451,1],\"ix\":4},\"o\":{\"a\":0,\"k\":100,\"ix\":5},\"r\":1,\"bm\":0,\"nm\":\" 1\",\"mn\":\"ADBE Vector Graphic - Fill\",\"hd\":false},{\"ty\":\"tr\",\"p\":{\"a\":0,\"k\":[8.572,11.429],\"ix\":2},\"a\":{\"a\":0,\"k\":[0,0],\"ix\":1},\"s\":{\"a\":0,\"k\":[100,100],\"ix\":3},\"r\":{\"a\":0,\"k\":0,\"ix\":6},\"o\":{\"a\":0,\"k\":100,\"ix\":7},\"sk\":{\"a\":0,\"k\":0,\"ix\":4},\"sa\":{\"a\":0,\"k\":0,\"ix\":5},\"nm\":\"\"}],\"nm\":\" 1\",\"np\":4,\"cix\":2,\"bm\":0,\"ix\":1,\"mn\":\"ADBE Vector Group\",\"hd\":false}],\"ip\":0,\"op\":8400,\"st\":0,\"ct\":1,\"bm\":0},{\"ddd\":0,\"ind\":3,\"ty\":4,\"nm\":\"small 2\",\"sr\":1,\"ks\":{\"o\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.5],\"y\":[1]},\"o\":{\"x\":[0.5],\"y\":[0]},\"t\":48.074,\"s\":[80]},{\"t\":85.07421875,\"s\":[100]}],\"ix\":11},\"r\":{\"a\":0,\"k\":0,\"ix\":10},\"p\":{\"a\":0,\"k\":[183,56.999,0],\"ix\":2,\"l\":2},\"a\":{\"a\":0,\"k\":[16.667,3.333,0],\"ix\":1,\"l\":2},\"s\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.5,0.5,0.5],\"y\":[1,1,1]},\"o\":{\"x\":[0.5,0.5,0.5],\"y\":[0,0,0]},\"t\":48,\"s\":[0,0,100]},{\"t\":85.07421875,\"s\":[1005,1005,100]}],\"ix\":6,\"l\":2}},\"ao\":0,\"shapes\":[{\"ty\":\"gr\",\"it\":[{\"ind\":0,\"ty\":\"sh\",\"ix\":1,\"ks\":{\"a\":0,\"k\":{\"i\":[[0.102,0.897],[0.141,0.001],[0.016,-0.14],[0.44,-0.44],[0.912,-0.105],[0,-0.141],[-0.14,-0.016],[-0.451,-0.442],[-0.08,-0.906],[-0.144,0],[-0.013,0.144],[-0.451,0.451],[-0.89,0.077],[0,0.144],[0.143,0.013],[0.441,0.448]],\"o\":[[-0.016,-0.14],[-0.141,0],[-0.105,0.913],[-0.44,0.44],[-0.141,0.016],[0,0.141],[0.897,0.101],[0.448,0.441],[0.013,0.143],[0.144,0],[0.077,-0.891],[0.451,-0.451],[0.144,-0.013],[0,-0.144],[-0.906,-0.08],[-0.442,-0.451]],\"v\":[[0.276,-3.087],[0,-3.334],[-0.276,-3.088],[-1.094,-1.094],[-3.087,-0.276],[-3.333,0],[-3.087,0.276],[-1.084,1.092],[-0.277,3.08],[0,3.333],[0.277,3.079],[1.083,1.083],[3.079,0.277],[3.333,0],[3.08,-0.277],[1.092,-1.084]],\"c\":true},\"ix\":2},\"nm\":\" 1\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ty\":\"fl\",\"c\":{\"a\":0,\"k\":[0.117647058824,0.588235294118,0.921568627451,1],\"ix\":4},\"o\":{\"a\":0,\"k\":100,\"ix\":5},\"r\":1,\"bm\":0,\"nm\":\" 1\",\"mn\":\"ADBE Vector Graphic - Fill\",\"hd\":false},{\"ty\":\"tr\",\"p\":{\"a\":0,\"k\":[16.667,3.333],\"ix\":2},\"a\":{\"a\":0,\"k\":[0,0],\"ix\":1},\"s\":{\"a\":0,\"k\":[100,100],\"ix\":3},\"r\":{\"a\":0,\"k\":0,\"ix\":6},\"o\":{\"a\":0,\"k\":100,\"ix\":7},\"sk\":{\"a\":0,\"k\":0,\"ix\":4},\"sa\":{\"a\":0,\"k\":0,\"ix\":5},\"nm\":\"\"}],\"nm\":\" 1\",\"np\":4,\"cix\":2,\"bm\":0,\"ix\":1,\"mn\":\"ADBE Vector Group\",\"hd\":false}],\"ip\":0,\"op\":8400,\"st\":0,\"ct\":1,\"bm\":0},{\"ddd\":0,\"ind\":4,\"ty\":4,\"nm\":\"small\",\"sr\":1,\"ks\":{\"o\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.5],\"y\":[1]},\"o\":{\"x\":[0.5],\"y\":[0]},\"t\":10.074,\"s\":[100]},{\"i\":{\"x\":[0.5],\"y\":[1]},\"o\":{\"x\":[0.5],\"y\":[0]},\"t\":25.074,\"s\":[80]},{\"t\":48.07421875,\"s\":[0]}],\"ix\":11},\"r\":{\"a\":0,\"k\":0,\"ix\":10},\"p\":{\"a\":0,\"k\":[183,56.999,0],\"ix\":2,\"l\":2},\"a\":{\"a\":0,\"k\":[16.667,3.333,0],\"ix\":1,\"l\":2},\"s\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.5,0.5,0.5],\"y\":[1,1,1]},\"o\":{\"x\":[0.5,0.5,0.5],\"y\":[0,0,0]},\"t\":10.074,\"s\":[1005,1005,100]},{\"i\":{\"x\":[0.5,0.5,0.5],\"y\":[1,1,1]},\"o\":{\"x\":[0.5,0.5,0.5],\"y\":[0,0,0]},\"t\":25.074,\"s\":[1235,1235,100]},{\"t\":48,\"s\":[0,0,100]}],\"ix\":6,\"l\":2}},\"ao\":0,\"shapes\":[{\"ty\":\"gr\",\"it\":[{\"ind\":0,\"ty\":\"sh\",\"ix\":1,\"ks\":{\"a\":0,\"k\":{\"i\":[[0.102,0.897],[0.141,0.001],[0.016,-0.14],[0.44,-0.44],[0.912,-0.105],[0,-0.141],[-0.14,-0.016],[-0.451,-0.442],[-0.08,-0.906],[-0.144,0],[-0.013,0.144],[-0.451,0.451],[-0.89,0.077],[0,0.144],[0.143,0.013],[0.441,0.448]],\"o\":[[-0.016,-0.14],[-0.141,0],[-0.105,0.913],[-0.44,0.44],[-0.141,0.016],[0,0.141],[0.897,0.101],[0.448,0.441],[0.013,0.143],[0.144,0],[0.077,-0.891],[0.451,-0.451],[0.144,-0.013],[0,-0.144],[-0.906,-0.08],[-0.442,-0.451]],\"v\":[[0.276,-3.087],[0,-3.334],[-0.276,-3.088],[-1.094,-1.094],[-3.087,-0.276],[-3.333,0],[-3.087,0.276],[-1.084,1.092],[-0.277,3.08],[0,3.333],[0.277,3.079],[1.083,1.083],[3.079,0.277],[3.333,0],[3.08,-0.277],[1.092,-1.084]],\"c\":true},\"ix\":2},\"nm\":\" 1\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ty\":\"fl\",\"c\":{\"a\":0,\"k\":[0.117647058824,0.588235294118,0.921568627451,1],\"ix\":4},\"o\":{\"a\":0,\"k\":100,\"ix\":5},\"r\":1,\"bm\":0,\"nm\":\" 1\",\"mn\":\"ADBE Vector Graphic - Fill\",\"hd\":false},{\"ty\":\"tr\",\"p\":{\"a\":0,\"k\":[16.667,3.333],\"ix\":2},\"a\":{\"a\":0,\"k\":[0,0],\"ix\":1},\"s\":{\"a\":0,\"k\":[100,100],\"ix\":3},\"r\":{\"a\":0,\"k\":0,\"ix\":6},\"o\":{\"a\":0,\"k\":100,\"ix\":7},\"sk\":{\"a\":0,\"k\":0,\"ix\":4},\"sa\":{\"a\":0,\"k\":0,\"ix\":5},\"nm\":\"\"}],\"nm\":\" 1\",\"np\":4,\"cix\":2,\"bm\":0,\"ix\":1,\"mn\":\"ADBE Vector Group\",\"hd\":false}],\"ip\":0,\"op\":8400,\"st\":0,\"ct\":1,\"bm\":0}],\"markers\":[],\"props\":{}}'\n  background=\"transparent\"\n  speed=\"1\"\n  style=\"width: 20px; height: 20px;\"\n  loop\n  autoplay\n></dotlottie-player>`;\n\nexport const SmallHintIcon = html`<svg\n  width=\"16\"\n  height=\"16\"\n  viewBox=\"0 0 16 16\"\n  fill=\"none\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <path\n    fill-rule=\"evenodd\"\n    clip-rule=\"evenodd\"\n    d=\"M8.00008 3.16699C5.33071 3.16699 3.16675 5.33095 3.16675 8.00033C3.16675 10.6697 5.33071 12.8337 8.00008 12.8337C10.6695 12.8337 12.8334 10.6697 12.8334 8.00033C12.8334 5.33095 10.6695 3.16699 8.00008 3.16699ZM2.16675 8.00033C2.16675 4.77866 4.77842 2.16699 8.00008 2.16699C11.2217 2.16699 13.8334 4.77866 13.8334 8.00033C13.8334 11.222 11.2217 13.8337 8.00008 13.8337C4.77842 13.8337 2.16675 11.222 2.16675 8.00033ZM8.00008 5.12996C8.27622 5.12996 8.50008 5.35381 8.50008 5.62996V8.00033C8.50008 8.27647 8.27622 8.50033 8.00008 8.50033C7.72394 8.50033 7.50008 8.27647 7.50008 8.00033V5.62996C7.50008 5.35381 7.72394 5.12996 8.00008 5.12996ZM7.50008 10.3707C7.50008 10.0946 7.72394 9.8707 8.00008 9.8707H8.00601C8.28215 9.8707 8.50601 10.0946 8.50601 10.3707C8.50601 10.6468 8.28215 10.8707 8.00601 10.8707H8.00008C7.72394 10.8707 7.50008 10.6468 7.50008 10.3707Z\"\n    fill=\"#77757D\"\n    fill-opacity=\"0.6\"\n  />\n</svg> `;\n\nexport const AIHelpIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"none\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <g clip-path=\"url(#clip0_17283_108071)\">\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M3.125 10C3.125 6.20304 6.20304 3.125 10 3.125C13.797 3.125 16.875 6.20304 16.875 10C16.875 13.797 13.797 16.875 10 16.875C6.20304 16.875 3.125 13.797 3.125 10ZM10 1.875C5.51269 1.875 1.875 5.51269 1.875 10C1.875 14.4873 5.51269 18.125 10 18.125C14.4873 18.125 18.125 14.4873 18.125 10C18.125 5.51269 14.4873 1.875 10 1.875ZM10.1988 9.15283C9.42973 9.75667 9.16199 10.1383 9.16199 10.8105C9.16199 11.1751 9.38985 11.4486 9.80571 11.4486C10.2045 11.4486 10.3526 11.2207 10.495 10.8846C10.626 10.4061 10.814 10.2067 11.3666 9.78516C12.0957 9.24398 12.58 8.75977 12.58 7.87679C12.58 6.60645 11.5375 5.82601 10.0393 5.82601C9.23035 5.82601 8.60942 6.03678 8.19356 6.38997C7.85177 6.69189 7.6296 7.09066 7.6296 7.46663C7.6296 7.77995 7.82898 8.0363 8.18787 8.0363C8.42712 8.0363 8.56384 7.92806 8.74044 7.6945C9.01388 7.22738 9.38985 7.0166 9.93673 7.0166C10.5634 7.0166 11.059 7.38688 11.059 7.94515C11.059 8.44645 10.7513 8.71989 10.1988 9.15283ZM9.80571 12.2575C9.33289 12.2575 8.94552 12.5879 8.94552 13.0607C8.94552 13.5335 9.33289 13.8639 9.80571 13.8639C10.2785 13.8639 10.6716 13.5335 10.6716 13.0607C10.6716 12.5879 10.2785 12.2575 9.80571 12.2575Z\"\n      fill=\"#77757D\"\n    />\n  </g>\n  <defs>\n    <clipPath id=\"clip0_17283_108071\">\n      <rect width=\"20\" height=\"20\" fill=\"white\" />\n    </clipPath>\n  </defs>\n</svg> `;\n\nexport const AffineIcon = (color: string) =>\n  html`<svg\n    width=\"63\"\n    height=\"62\"\n    viewBox=\"0 0 63 62\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <g filter=\"url(#filter0_dd_5885_200419)\">\n      <rect\n        x=\"9.5\"\n        y=\"3\"\n        width=\"44\"\n        height=\"44\"\n        rx=\"8\"\n        fill=\"var(--affine-white)\"\n      />\n      <rect\n        x=\"10\"\n        y=\"3.5\"\n        width=\"43\"\n        height=\"43\"\n        rx=\"7.5\"\n        stroke=\"var(--affine-border-color)\"\n      />\n      <g clip-path=\"url(#clip0_5885_200419)\">\n        <path\n          d=\"M30.6764 17.5421C30.6296 17.1287 30.2801 16.8162 29.864 16.8158C29.448 16.8154 29.0978 17.1272 29.0501 17.5405C28.7401 20.2281 27.9366 22.118 26.6402 23.4143C25.3439 24.7106 23.454 25.5142 20.7664 25.8242C20.3531 25.8718 20.0413 26.222 20.0417 26.6381C20.0422 27.0541 20.3547 27.4037 20.7681 27.4505C23.4113 27.7499 25.3413 28.5531 26.6684 29.8562C27.9905 31.1544 28.8109 33.0439 29.0479 35.7126C29.0855 36.1353 29.4398 36.4591 29.8641 36.4587C30.2884 36.4582 30.642 36.1335 30.6786 35.7108C30.9058 33.0859 31.7254 31.1568 33.054 29.8281C34.3827 28.4994 36.3119 27.6798 38.9367 27.4526C39.3595 27.416 39.6841 27.0625 39.6846 26.6382C39.6851 26.2138 39.3612 25.8595 38.9386 25.822C36.2698 25.5849 34.3804 24.7646 33.0822 23.4425C31.779 22.1154 30.9758 20.1853 30.6764 17.5421Z\"\n          fill=${color}\n        />\n        <path\n          d=\"M39.4552 13.8245C39.437 13.6637 39.3011 13.5422 39.1393 13.542C38.9775 13.5418 38.8413 13.6631 38.8228 13.8238C38.7022 14.869 38.3897 15.6039 37.8856 16.1081C37.3815 16.6122 36.6465 16.9247 35.6013 17.0452C35.4406 17.0638 35.3194 17.2 35.3195 17.3618C35.3197 17.5236 35.4412 17.6595 35.602 17.6777C36.6299 17.7941 37.3805 18.1065 37.8966 18.6133C38.4107 19.1181 38.7297 19.8529 38.8219 20.8908C38.8365 21.0551 38.9743 21.1811 39.1393 21.1809C39.3043 21.1807 39.4418 21.0544 39.4561 20.89C39.5444 19.8693 39.8632 19.119 40.3799 18.6023C40.8966 18.0856 41.6468 17.7669 42.6676 17.6785C42.832 17.6643 42.9582 17.5268 42.9584 17.3618C42.9586 17.1968 42.8327 17.059 42.6683 17.0444C41.6304 16.9522 40.8957 16.6332 40.3908 16.119C39.884 15.6029 39.5717 14.8524 39.4552 13.8245Z\"\n          fill=${color}\n        />\n      </g>\n    </g>\n    <defs>\n      <filter\n        id=\"filter0_dd_5885_200419\"\n        x=\"0.5\"\n        y=\"0\"\n        width=\"62\"\n        height=\"62\"\n        filterUnits=\"userSpaceOnUse\"\n        color-interpolation-filters=\"sRGB\"\n      >\n        <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\n        <feColorMatrix\n          in=\"SourceAlpha\"\n          type=\"matrix\"\n          values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n          result=\"hardAlpha\"\n        />\n        <feMorphology\n          radius=\"2\"\n          operator=\"erode\"\n          in=\"SourceAlpha\"\n          result=\"effect1_dropShadow_5885_200419\"\n        />\n        <feOffset dy=\"4\" />\n        <feGaussianBlur stdDeviation=\"2\" />\n        <feColorMatrix\n          type=\"matrix\"\n          values=\"0 0 0 0 0.258824 0 0 0 0 0.254902 0 0 0 0 0.286275 0 0 0 0.1 0\"\n        />\n        <feBlend\n          mode=\"normal\"\n          in2=\"BackgroundImageFix\"\n          result=\"effect1_dropShadow_5885_200419\"\n        />\n        <feColorMatrix\n          in=\"SourceAlpha\"\n          type=\"matrix\"\n          values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n          result=\"hardAlpha\"\n        />\n        <feMorphology\n          radius=\"1\"\n          operator=\"dilate\"\n          in=\"SourceAlpha\"\n          result=\"effect2_dropShadow_5885_200419\"\n        />\n        <feOffset dy=\"6\" />\n        <feGaussianBlur stdDeviation=\"4\" />\n        <feColorMatrix\n          type=\"matrix\"\n          values=\"0 0 0 0 0.258824 0 0 0 0 0.254902 0 0 0 0 0.286275 0 0 0 0.05 0\"\n        />\n        <feBlend\n          mode=\"normal\"\n          in2=\"effect1_dropShadow_5885_200419\"\n          result=\"effect2_dropShadow_5885_200419\"\n        />\n        <feBlend\n          mode=\"normal\"\n          in=\"SourceGraphic\"\n          in2=\"effect2_dropShadow_5885_200419\"\n          result=\"shape\"\n        />\n      </filter>\n      <clipPath id=\"clip0_5885_200419\">\n        <rect\n          width=\"27.5\"\n          height=\"27.5\"\n          fill=\"white\"\n          transform=\"translate(17.75 11.25)\"\n        />\n      </clipPath>\n    </defs>\n  </svg> `;\n\nexport const ChatClearIcon = html`<svg\n  width=\"24\"\n  height=\"24\"\n  viewBox=\"0 0 24 24\"\n  fill=\"none\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <g clip-path=\"url(#clip0_7034_11049)\">\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M19.3144 5.1023C19.5618 5.34971 19.5618 5.75083 19.3144 5.99823L13.5075 11.8052C14.5763 13.2524 14.6251 15.25 13.564 16.76L11.1633 20.1764C10.9886 20.4249 10.6461 20.486 10.3964 20.3131C7.93754 18.6108 5.80584 16.4791 4.10358 14.0203C3.93067 13.7705 3.99171 13.4281 4.24025 13.2534L7.65663 10.8527C9.16673 9.79155 11.1643 9.84036 12.6116 10.9092L18.4185 5.1023C18.6659 4.8549 19.067 4.8549 19.3144 5.1023ZM10.5405 18.8589L12.5273 16.0316C12.535 16.0205 12.5427 16.0095 12.5502 15.9984C11.6977 15.6645 10.8371 15.096 10.0789 14.3378C9.3207 13.5796 8.75224 12.719 8.4183 11.8664C8.4072 11.874 8.39613 11.8816 8.38511 11.8894L5.55779 13.8761C6.96005 15.777 8.63969 17.4566 10.5405 18.8589ZM9.59298 11.3911C9.85414 12.0639 10.3184 12.7855 10.9748 13.4419C11.6312 14.0983 12.3528 14.5626 13.0255 14.8237C13.1835 13.8976 12.8979 12.9206 12.197 12.2197C11.4961 11.5187 10.5191 11.2331 9.59298 11.3911Z\"\n      fill=\"#A9A9AD\"\n    />\n  </g>\n  <defs>\n    <clipPath id=\"clip0_7034_11049\">\n      <rect width=\"20\" height=\"20\" fill=\"white\" transform=\"translate(2 2)\" />\n    </clipPath>\n  </defs>\n</svg> `;\n\nexport const ChatSendIcon = html`<svg\n  width=\"24\"\n  height=\"24\"\n  viewBox=\"0 0 24 24\"\n  fill=\"none\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <rect width=\"24\" height=\"24\" rx=\"4\" fill=\"#A9A9AD\" />\n  <g clip-path=\"url(#clip0_7455_53584)\">\n    <path\n      d=\"M18.7402 5.45305C18.7402 5.45305 20.2433 4.8669 20.1175 6.2903C20.0761 6.87646 19.7005 8.92818 19.408 11.147L18.4059 17.7205C18.4059 17.7205 18.3223 18.6835 17.5706 18.851C16.8192 19.0181 15.6918 18.2648 15.4829 18.0973C15.3157 17.9716 12.3513 16.0874 11.3074 15.1665C11.015 14.9151 10.6807 14.4129 11.3492 13.8267L15.7332 9.63969C16.2342 9.1375 16.7353 7.96519 14.6475 9.38859L8.8015 13.3659C8.8015 13.3659 8.13333 13.7849 6.88093 13.4081L4.16645 12.5705C4.16645 12.5705 3.16438 11.9425 4.87641 11.3146C9.05221 9.34681 14.1883 7.33725 18.7394 5.45305H18.7402Z\"\n      fill=\"white\"\n    />\n  </g>\n  <defs>\n    <clipPath id=\"clip0_7455_53584\">\n      <rect width=\"20\" height=\"20\" fill=\"white\" transform=\"translate(2 2)\" />\n    </clipPath>\n  </defs>\n</svg> `;\n\nexport const ChatAbortIcon = html`<svg\n  width=\"24\"\n  height=\"24\"\n  viewBox=\"0 0 24 24\"\n  fill=\"none\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <g clip-path=\"url(#clip0_12965_7241)\">\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M19.0833 11.9993C19.0833 15.9114 15.912 19.0827 12 19.0827C8.08798 19.0827 4.91667 15.9114 4.91667 11.9993C4.91667 8.08733 8.08798 4.91602 12 4.91602C15.912 4.91602 19.0833 8.08733 19.0833 11.9993ZM20.3333 11.9993C20.3333 16.6017 16.6024 20.3327 12 20.3327C7.39763 20.3327 3.66667 16.6017 3.66667 11.9993C3.66667 7.39698 7.39763 3.66602 12 3.66602C16.6024 3.66602 20.3333 7.39698 20.3333 11.9993ZM10.3333 8.66602C9.41286 8.66602 8.66667 9.41221 8.66667 10.3327V13.666C8.66667 14.5865 9.41286 15.3327 10.3333 15.3327H13.6667C14.5871 15.3327 15.3333 14.5865 15.3333 13.666V10.3327C15.3333 9.41221 14.5871 8.66602 13.6667 8.66602H10.3333Z\"\n      fill=\"#1E96EB\"\n    />\n  </g>\n  <defs>\n    <clipPath id=\"clip0_12965_7241\">\n      <rect width=\"20\" height=\"20\" fill=\"white\" transform=\"translate(2 2)\" />\n    </clipPath>\n  </defs>\n</svg> `;\n\nexport const CurrentSelectionIcon = html`<svg\n  width=\"16\"\n  height=\"17\"\n  viewBox=\"0 0 16 17\"\n  fill=\"none\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <g clip-path=\"url(#clip0_7289_18670)\">\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M1.89392 3.54492C1.61778 3.54492 1.39392 3.76878 1.39392 4.04492V5.37826C1.39392 5.6544 1.61778 5.87826 1.89392 5.87826C2.17006 5.87826 2.39392 5.6544 2.39392 5.37826V4.54492H4.66665V11.5449H3.34847C3.07232 11.5449 2.84847 11.7688 2.84847 12.0449C2.84847 12.3211 3.07232 12.5449 3.34847 12.5449H5.16665H6.98483C7.26097 12.5449 7.48483 12.3211 7.48483 12.0449C7.48483 11.7688 7.26097 11.5449 6.98483 11.5449H5.66665V4.54492H7.93938V5.37826C7.93938 5.6544 8.16323 5.87826 8.43937 5.87826C8.71552 5.87826 8.93937 5.6544 8.93937 5.37826V4.04492C8.93937 3.76878 8.71552 3.54492 8.43937 3.54492H5.16665H1.89392ZM10.403 3.54492C10.1269 3.54492 9.90299 3.76878 9.90299 4.04492C9.90299 4.32106 10.1269 4.54492 10.403 4.54492H14.0394C14.3155 4.54492 14.5394 4.32106 14.5394 4.04492C14.5394 3.76878 14.3155 3.54492 14.0394 3.54492H10.403ZM9.90299 8.04492C9.90299 7.76878 10.1269 7.54492 10.403 7.54492H14.0394C14.3155 7.54492 14.5394 7.76878 14.5394 8.04492C14.5394 8.32106 14.3155 8.54492 14.0394 8.54492H10.403C10.1269 8.54492 9.90299 8.32106 9.90299 8.04492ZM10.403 11.5449C10.1269 11.5449 9.90299 11.7688 9.90299 12.0449C9.90299 12.3211 10.1269 12.5449 10.403 12.5449H14.0394C14.3155 12.5449 14.5394 12.3211 14.5394 12.0449C14.5394 11.7688 14.3155 11.5449 14.0394 11.5449H10.403Z\"\n      fill=\"#77757D\"\n    />\n  </g>\n  <defs>\n    <clipPath id=\"clip0_7289_18670\">\n      <rect\n        width=\"16\"\n        height=\"16\"\n        fill=\"white\"\n        transform=\"translate(0 0.0449219)\"\n      />\n    </clipPath>\n  </defs>\n</svg> `;\n\nexport const ImageIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"none\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <path\n    fill-rule=\"evenodd\"\n    clip-rule=\"evenodd\"\n    d=\"M4.99992 2.7085C3.73427 2.7085 2.70825 3.73451 2.70825 5.00016V13.3335V15.0002C2.70825 16.2658 3.73427 17.2918 4.99992 17.2918H14.9999C16.2656 17.2918 17.2916 16.2658 17.2916 15.0002V11.6668V5.00016C17.2916 3.73451 16.2656 2.7085 14.9999 2.7085H4.99992ZM3.95825 15.0002V13.5924L7.59668 9.95395C8.00348 9.54715 8.66303 9.54715 9.06982 9.95395L11.2246 12.1088L12.8913 13.7754C13.1354 14.0195 13.5311 14.0195 13.7752 13.7754C14.0193 13.5314 14.0193 13.1356 13.7752 12.8916L12.5505 11.6668L13.43 10.7873C13.8368 10.3805 14.4964 10.3805 14.9032 10.7873L16.0416 11.9257V15.0002C16.0416 15.5755 15.5752 16.0418 14.9999 16.0418H4.99992C4.42462 16.0418 3.95825 15.5755 3.95825 15.0002ZM9.9537 9.07007L11.6666 10.7829L12.5461 9.9034C13.4411 9.00845 14.8921 9.00845 15.787 9.9034L16.0416 10.1579V5.00016C16.0416 4.42487 15.5752 3.9585 14.9999 3.9585H4.99992C4.42462 3.9585 3.95825 4.42487 3.95825 5.00016V11.8246L6.7128 9.07007C7.60775 8.17512 9.05875 8.17511 9.9537 9.07007ZM11.6666 7.50016C12.1268 7.50016 12.4999 7.12707 12.4999 6.66683C12.4999 6.20659 12.1268 5.8335 11.6666 5.8335C11.2063 5.8335 10.8333 6.20659 10.8333 6.66683C10.8333 7.12707 11.2063 7.50016 11.6666 7.50016Z\"\n    fill=\"#77757D\"\n  />\n</svg> `;\n\nexport const SmallImageIcon = html`<svg\n  width=\"16\"\n  height=\"17\"\n  viewBox=\"0 0 16 17\"\n  fill=\"none\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <g clip-path=\"url(#clip0_7289_20293)\">\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M4 2.6665C2.98748 2.6665 2.16666 3.48732 2.16666 4.49984V11.1665V12.4998C2.16666 13.5124 2.98748 14.3332 4 14.3332H12C13.0125 14.3332 13.8333 13.5124 13.8333 12.4998V9.83317V4.49984C13.8333 3.48732 13.0125 2.6665 12 2.6665H4ZM3.16666 12.4998V11.3736L6.07741 8.46287C6.40284 8.13743 6.93048 8.13743 7.25592 8.46287L8.97978 10.1867L10.3131 11.5201C10.5084 11.7153 10.825 11.7153 11.0202 11.5201C11.2155 11.3248 11.2155 11.0082 11.0202 10.813L10.0404 9.83317L10.7441 9.12953C11.0695 8.8041 11.5971 8.8041 11.9226 9.12953L12.8333 10.0403V12.4998C12.8333 12.9601 12.4602 13.3332 12 13.3332H4C3.53976 13.3332 3.16666 12.9601 3.16666 12.4998ZM7.96303 7.75576L9.33333 9.12606L10.037 8.42243C10.7529 7.70647 11.9137 7.70646 12.6297 8.42243L12.8333 8.62606V4.49984C12.8333 4.0396 12.4602 3.6665 12 3.6665H4C3.53976 3.6665 3.16666 4.0396 3.16666 4.49984V9.9594L5.3703 7.75576C6.08626 7.0398 7.24706 7.0398 7.96303 7.75576ZM9.33333 6.49984C9.70152 6.49984 10 6.20136 10 5.83317C10 5.46498 9.70152 5.1665 9.33333 5.1665C8.96514 5.1665 8.66666 5.46498 8.66666 5.83317C8.66666 6.20136 8.96514 6.49984 9.33333 6.49984Z\"\n      fill=\"#77757D\"\n    />\n  </g>\n  <defs>\n    <clipPath id=\"clip0_7289_20293\">\n      <rect width=\"16\" height=\"16\" fill=\"white\" transform=\"translate(0 0.5)\" />\n    </clipPath>\n  </defs>\n</svg> `;\n\nexport const DocIcon = html`<svg\n  width=\"16\"\n  height=\"17\"\n  viewBox=\"0 0 16 17\"\n  fill=\"none\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <g clip-path=\"url(#clip0_7289_21903)\">\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M4.66667 2.6665C3.65415 2.6665 2.83334 3.48732 2.83334 4.49984V12.4998C2.83334 13.5124 3.65415 14.3332 4.66667 14.3332H11.3333C12.3459 14.3332 13.1667 13.5124 13.1667 12.4998V4.49984C13.1667 3.48732 12.3459 2.6665 11.3333 2.6665H4.66667ZM3.83334 4.49984C3.83334 4.0396 4.20643 3.6665 4.66667 3.6665H11.3333C11.7936 3.6665 12.1667 4.0396 12.1667 4.49984V12.4998C12.1667 12.9601 11.7936 13.3332 11.3333 13.3332H4.66667C4.20643 13.3332 3.83334 12.9601 3.83334 12.4998V4.49984ZM6 5.33317C5.72386 5.33317 5.5 5.55703 5.5 5.83317C5.5 6.10931 5.72386 6.33317 6 6.33317H8.33334C8.60948 6.33317 8.83334 6.10931 8.83334 5.83317C8.83334 5.55703 8.60948 5.33317 8.33334 5.33317H6ZM5.5 8.1665C5.5 7.89036 5.72386 7.6665 6 7.6665H10C10.2761 7.6665 10.5 7.89036 10.5 8.1665C10.5 8.44265 10.2761 8.6665 10 8.6665H6C5.72386 8.6665 5.5 8.44265 5.5 8.1665ZM6 9.99984C5.72386 9.99984 5.5 10.2237 5.5 10.4998C5.5 10.776 5.72386 10.9998 6 10.9998H9.33334C9.60948 10.9998 9.83334 10.776 9.83334 10.4998C9.83334 10.2237 9.60948 9.99984 9.33334 9.99984H6Z\"\n      fill=\"#77757D\"\n    />\n  </g>\n  <defs>\n    <clipPath id=\"clip0_7289_21903\">\n      <rect width=\"16\" height=\"16\" fill=\"white\" transform=\"translate(0 0.5)\" />\n    </clipPath>\n  </defs>\n</svg> `;\n\nexport const DownArrowIcon = html`<svg\n  width=\"24\"\n  height=\"24\"\n  viewBox=\"0 0 24 24\"\n  fill=\"none\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <path\n    fill-rule=\"evenodd\"\n    clip-rule=\"evenodd\"\n    d=\"M17.5073 13.0032C17.2022 12.723 16.7278 12.7432 16.4476 13.0483L12.75 17.0745L12.75 5C12.75 4.58579 12.4142 4.25 12 4.25C11.5858 4.25 11.25 4.58579 11.25 5L11.25 17.0745L7.55239 13.0483C7.27222 12.7432 6.79777 12.723 6.49269 13.0032C6.18761 13.2833 6.16742 13.7578 6.4476 14.0629L11.4476 19.5073C11.5896 19.662 11.79 19.75 12 19.75C12.21 19.75 12.4104 19.662 12.5524 19.5073L17.5524 14.0629C17.8326 13.7578 17.8124 13.2833 17.5073 13.0032Z\"\n    fill=\"#77757D\"\n  />\n</svg> `;\n\nexport const CloseIcon = html`<svg\n  width=\"12\"\n  height=\"12\"\n  viewBox=\"0 0 12 12\"\n  fill=\"none\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <path\n    fill-rule=\"evenodd\"\n    clip-rule=\"evenodd\"\n    d=\"M2.73483 2.73483C2.88128 2.58839 3.11872 2.58839 3.26517 2.73483L6 5.46967L8.73484 2.73484C8.88128 2.58839 9.11872 2.58839 9.26516 2.73484C9.41161 2.88128 9.41161 3.11872 9.26516 3.26517L6.53033 6L9.26516 8.73484C9.41161 8.88128 9.41161 9.11872 9.26516 9.26516C9.11872 9.41161 8.88128 9.41161 8.73483 9.26516L6 6.53033L3.26517 9.26516C3.11872 9.41161 2.88128 9.41161 2.73483 9.26516C2.58839 9.11872 2.58839 8.88128 2.73483 8.73484L5.46967 6L2.73483 3.26516C2.58839 3.11872 2.58839 2.88128 2.73483 2.73483Z\"\n    fill=\"#77757D\"\n  />\n</svg> `;\n\nexport const ReplaceIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"currentColor\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <path\n    fill-rule=\"evenodd\"\n    clip-rule=\"evenodd\"\n    d=\"M14.8142 11.2536C14.6948 11.3846 14.5255 11.4588 14.3483 11.4577C14.1712 11.4566 14.0028 11.3803 13.885 11.2479L12.0332 9.16458C11.8039 8.90659 11.8271 8.51154 12.0851 8.28222C12.3431 8.05289 12.7381 8.07613 12.9675 8.33412L13.7272 9.18881V4.99935C13.7272 4.88429 13.6339 4.79102 13.5188 4.79102H8.33366C7.98849 4.79102 7.70866 4.51119 7.70866 4.16602C7.70866 3.82084 7.98849 3.54102 8.33366 3.54102H13.5188C14.3243 3.54102 14.9772 4.19393 14.9772 4.99935V9.2187L15.7883 8.32842C16.0208 8.07326 16.4161 8.05488 16.6713 8.28735C16.9264 8.51982 16.9448 8.91513 16.7123 9.17028L14.8142 11.2536ZM5.60315 8.74508C5.72248 8.61411 5.8918 8.53994 6.06898 8.54103C6.24616 8.54212 6.41456 8.61836 6.53227 8.75079L8.38413 10.8341C8.61345 11.0921 8.59021 11.4872 8.33222 11.7165C8.07423 11.9458 7.67919 11.9226 7.44987 11.6646L6.69014 10.8099V14.9993C6.69014 15.1144 6.78342 15.2077 6.89848 15.2077H12.0837C12.4288 15.2077 12.7087 15.4875 12.7087 15.8327C12.7087 16.1779 12.4288 16.4577 12.0837 16.4577H6.89848C6.09306 16.4577 5.44014 15.8048 5.44014 14.9993V10.78L4.62899 11.6703C4.39652 11.9254 4.00122 11.9438 3.74607 11.7113C3.49091 11.4789 3.47252 11.0836 3.705 10.8284L5.60315 8.74508Z\"\n  />\n</svg> `;\n\nexport const InsertBelowIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"currentColor\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <path\n    fill-rule=\"evenodd\"\n    clip-rule=\"evenodd\"\n    d=\"M3.54199 5.41602C3.54199 5.07084 3.82181 4.79102 4.16699 4.79102H15.8337C16.1788 4.79102 16.4587 5.07084 16.4587 5.41602C16.4587 5.76119 16.1788 6.04102 15.8337 6.04102H4.16699C3.82181 6.04102 3.54199 5.76119 3.54199 5.41602ZM3.54199 8.33268C3.54199 7.9875 3.82181 7.70768 4.16699 7.70768H15.8337C16.1788 7.70768 16.4587 7.9875 16.4587 8.33268C16.4587 8.67786 16.1788 8.95768 15.8337 8.95768H4.16699C3.82181 8.95768 3.54199 8.67786 3.54199 8.33268ZM10.8337 10.6243C10.4885 10.6243 10.2087 10.9042 10.2087 11.2493C10.2087 11.5945 10.4885 11.8743 10.8337 11.8743H15.8337C16.1788 11.8743 16.4587 11.5945 16.4587 11.2493C16.4587 10.9042 16.1788 10.6243 15.8337 10.6243H10.8337ZM10.2087 14.166C10.2087 13.8208 10.4885 13.541 10.8337 13.541H15.8337C16.1788 13.541 16.4587 13.8208 16.4587 14.166C16.4587 14.5112 16.1788 14.791 15.8337 14.791H10.8337C10.4885 14.791 10.2087 14.5112 10.2087 14.166ZM5.20866 10.8327C5.20866 10.4875 4.92884 10.2077 4.58366 10.2077C4.23848 10.2077 3.95866 10.4875 3.95866 10.8327V13.3327C3.95866 13.6779 4.23848 13.9577 4.58366 13.9577H6.87533V14.5827C6.87533 14.8355 7.0276 15.0634 7.26115 15.1601C7.49469 15.2568 7.76352 15.2034 7.94227 15.0246L9.19227 13.7746C9.43635 13.5305 9.43635 13.1348 9.19227 12.8907L7.94227 11.6407C7.76352 11.462 7.49469 11.4085 7.26115 11.5053C7.0276 11.602 6.87533 11.8299 6.87533 12.0827V12.7077H5.20866V10.8327Z\"\n  />\n</svg> `;\n\nexport const InsertTopIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"currentColor\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <path\n    fill-rule=\"evenodd\"\n    clip-rule=\"evenodd\"\n    d=\"M5.20833 9.16668C5.20833 9.51186 4.92851 9.79168 4.58333 9.79168C4.23816 9.79168 3.95833 9.51186 3.95833 9.16668V6.66668C3.95833 6.32151 4.23816 6.04168 4.58333 6.04168H6.875V5.41668C6.875 5.1639 7.02728 4.936 7.26082 4.83926C7.49437 4.74252 7.76319 4.79599 7.94194 4.97474L9.19194 6.22474C9.43602 6.46882 9.43602 6.86455 9.19194 7.10863L7.94194 8.35863C7.76319 8.53738 7.49437 8.59085 7.26082 8.49411C7.02728 8.39737 6.875 8.16947 6.875 7.91668V7.29168H5.20833V9.16668ZM10.2083 5.83335C10.2083 5.48817 10.4882 5.20835 10.8333 5.20835H15.8333C16.1785 5.20835 16.4583 5.48817 16.4583 5.83335C16.4583 6.17853 16.1785 6.45835 15.8333 6.45835H10.8333C10.4882 6.45835 10.2083 6.17853 10.2083 5.83335ZM10.2083 8.75002C10.2083 8.40484 10.4882 8.12502 10.8333 8.12502H15.8333C16.1785 8.12502 16.4583 8.40484 16.4583 8.75002C16.4583 9.0952 16.1785 9.37502 15.8333 9.37502H10.8333C10.4882 9.37502 10.2083 9.0952 10.2083 8.75002ZM4.16667 11.0417C3.82149 11.0417 3.54167 11.3215 3.54167 11.6667C3.54167 12.0119 3.82149 12.2917 4.16667 12.2917H15.8333C16.1785 12.2917 16.4583 12.0119 16.4583 11.6667C16.4583 11.3215 16.1785 11.0417 15.8333 11.0417H4.16667ZM3.54167 14.5834C3.54167 14.2382 3.82149 13.9584 4.16667 13.9584H15.8333C16.1785 13.9584 16.4583 14.2382 16.4583 14.5834C16.4583 14.9285 16.1785 15.2084 15.8333 15.2084H4.16667C3.82149 15.2084 3.54167 14.9285 3.54167 14.5834Z\"\n  />\n</svg>`;\n\nexport const NewBlockIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"none\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <g clip-path=\"url(#clip0_9809_47818)\">\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M9.74916 2.34342C9.90886 2.27355 10.0905 2.27355 10.2502 2.34342L16.9169 5.26008C17.1443 5.35961 17.2913 5.58437 17.2913 5.83268V14.166C17.2913 14.4143 17.1443 14.6391 16.9169 14.7386L10.2502 17.6553C10.0905 17.7251 9.90886 17.7251 9.74916 17.6553L3.0825 14.7386C2.855 14.6391 2.70801 14.4143 2.70801 14.166V5.83268C2.70801 5.58437 2.855 5.35961 3.0825 5.26008L9.74916 2.34342ZM3.95801 6.78832V13.7573L9.37467 16.127V9.15811L3.95801 6.78832ZM10.6247 9.15811V16.127L16.0413 13.7573V6.78832L10.6247 9.15811ZM15.107 5.83268L9.99967 8.06715L4.89232 5.83268L9.99967 3.59821L15.107 5.83268Z\"\n      fill=\"#77757D\"\n    />\n  </g>\n  <defs>\n    <clipPath id=\"clip0_9809_47818\">\n      <rect width=\"20\" height=\"20\" fill=\"white\" />\n    </clipPath>\n  </defs>\n</svg> `;\n\nexport const CreateIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"currentColor\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <g clip-path=\"url(#clip0_9809_87475)\">\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M5.83366 2.70898C4.56801 2.70898 3.54199 3.735 3.54199 5.00065V15.0007C3.54199 16.2663 4.56801 17.2923 5.83366 17.2923H14.167C15.4326 17.2923 16.4587 16.2663 16.4587 15.0007V5.00065C16.4587 3.735 15.4326 2.70898 14.167 2.70898H5.83366ZM4.79199 5.00065C4.79199 4.42535 5.25836 3.95898 5.83366 3.95898H14.167C14.7423 3.95898 15.2087 4.42535 15.2087 5.00065V15.0007C15.2087 15.5759 14.7423 16.0423 14.167 16.0423H5.83366C5.25836 16.0423 4.79199 15.5759 4.79199 15.0007V5.00065ZM7.50033 6.04232C7.15515 6.04232 6.87533 6.32214 6.87533 6.66732C6.87533 7.0125 7.15515 7.29232 7.50033 7.29232H10.417C10.7622 7.29232 11.042 7.0125 11.042 6.66732C11.042 6.32214 10.7622 6.04232 10.417 6.04232H7.50033ZM6.87533 9.58398C6.87533 9.23881 7.15515 8.95898 7.50033 8.95898H12.5003C12.8455 8.95898 13.1253 9.23881 13.1253 9.58398C13.1253 9.92916 12.8455 10.209 12.5003 10.209H7.50033C7.15515 10.209 6.87533 9.92916 6.87533 9.58398ZM7.50033 11.8757C7.15515 11.8757 6.87533 12.1555 6.87533 12.5007C6.87533 12.8458 7.15515 13.1257 7.50033 13.1257H11.667C12.0122 13.1257 12.292 12.8458 12.292 12.5007C12.292 12.1555 12.0122 11.8757 11.667 11.8757H7.50033Z\"\n    />\n  </g>\n  <defs>\n    <clipPath id=\"clip0_9809_87475\">\n      <rect width=\"20\" height=\"20\" fill=\"white\" />\n    </clipPath>\n  </defs>\n</svg> `;\n\nexport const AffineAvatarIcon = html`<svg\n  width=\"24\"\n  height=\"24\"\n  viewBox=\"0 0 24 24\"\n  fill=\"none\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <path\n    d=\"M11.2812 5.49104C11.2403 5.13024 10.9353 4.85751 10.5722 4.85714C10.2091 4.85677 9.90345 5.12887 9.86185 5.48959C9.59131 7.83515 8.89003 9.48448 7.75868 10.6158C6.62734 11.7472 4.97801 12.4485 2.63244 12.719C2.27173 12.7606 1.99963 13.0662 2 13.4293C2.00037 13.7924 2.2731 14.0975 2.63389 14.1383C4.94069 14.3996 6.62508 15.1006 7.78328 16.2379C8.93713 17.3709 9.65305 19.0198 9.85994 21.3489C9.89271 21.7178 10.2019 22.0004 10.5722 22C10.9425 21.9996 11.2511 21.7162 11.2831 21.3473C11.4813 19.0565 12.1966 17.3729 13.3562 16.2133C14.5157 15.0537 16.1994 14.3385 18.4902 14.1402C18.8591 14.1083 19.1424 13.7997 19.1429 13.4294C19.1433 13.0591 18.8606 12.7499 18.4918 12.7171C16.1627 12.5102 14.5137 11.7943 13.3807 10.6404C12.2435 9.48222 11.5425 7.79783 11.2812 5.49104Z\"\n    fill=\"#1E96EB\"\n  />\n  <path\n    d=\"M18.9427 2.24651C18.9268 2.1062 18.8082 2.00014 18.667 2C18.5257 1.99986 18.4069 2.10567 18.3907 2.24595C18.2855 3.15811 18.0128 3.79952 17.5728 4.23949C17.1329 4.67946 16.4914 4.95218 15.5793 5.05739C15.439 5.07356 15.3332 5.19241 15.3333 5.33362C15.3335 5.47482 15.4395 5.59345 15.5798 5.60935C16.4769 5.71096 17.132 5.98357 17.5824 6.42584C18.0311 6.86644 18.3095 7.50771 18.39 8.41347C18.4027 8.55691 18.523 8.66683 18.667 8.66667C18.811 8.6665 18.931 8.55632 18.9434 8.41284C19.0205 7.52199 19.2987 6.86723 19.7496 6.41629C20.2006 5.96534 20.8553 5.68719 21.7462 5.61008C21.8896 5.59766 21.9998 5.47765 22 5.33365C22.0002 5.18964 21.8902 5.06939 21.7468 5.05664C20.841 4.97619 20.1998 4.69777 19.7592 4.24905C19.3169 3.79864 19.0443 3.1436 18.9427 2.24651Z\"\n    fill=\"#1E96EB\"\n  />\n</svg> `;\n\nexport const ActionIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"currentColor\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <path\n    fill-rule=\"evenodd\"\n    clip-rule=\"evenodd\"\n    d=\"M7.50002 1.875C7.84519 1.875 8.12502 2.15482 8.12502 2.5V3.54167H10.6141C10.6215 3.54154 10.6289 3.54154 10.6363 3.54167H12.5C12.8452 3.54167 13.125 3.82149 13.125 4.16667C13.125 4.51184 12.8452 4.79167 12.5 4.79167H11.1457C10.6638 7.16518 9.64425 9.34282 8.21994 11.1922C8.50418 11.4886 8.80693 11.7614 9.12502 12C9.40116 12.2071 9.45712 12.5989 9.25002 12.875C9.04291 13.1511 8.65116 13.2071 8.37502 13C8.0371 12.7466 7.71603 12.4624 7.41396 12.1563C6.10806 13.5972 4.53708 14.7931 2.77816 15.6672C2.46905 15.8208 2.09393 15.6947 1.94032 15.3856C1.7867 15.0765 1.91276 14.7014 2.22187 14.5478C3.88548 13.721 5.36607 12.5816 6.58683 11.2065C5.71204 10.0729 5.07099 8.78956 4.74363 7.67633C4.64624 7.34517 4.83575 6.99777 5.16691 6.90039C5.49807 6.80301 5.84547 6.99252 5.94285 7.32367C6.20868 8.22765 6.71757 9.2665 7.39878 10.2054C8.57204 8.61888 9.42653 6.78272 9.86785 4.79167H2.91668C2.5715 4.79167 2.29168 4.51184 2.29168 4.16667C2.29168 3.82149 2.5715 3.54167 2.91668 3.54167H6.87502V2.5C6.87502 2.15482 7.15484 1.875 7.50002 1.875ZM13.3333 8.54167C13.5701 8.54167 13.7865 8.67542 13.8924 8.88716L16.8034 14.7093C16.8075 14.7169 16.8114 14.7247 16.8151 14.7326L18.059 17.2205C18.2134 17.5292 18.0883 17.9046 17.7795 18.059C17.4708 18.2134 17.0954 18.0882 16.941 17.7795L15.8637 15.625H10.803L9.7257 17.7795C9.57133 18.0882 9.19591 18.2134 8.88717 18.059C8.57844 17.9046 8.4533 17.5292 8.60767 17.2205L9.85161 14.7326C9.85535 14.7247 9.85924 14.7169 9.86328 14.7093L12.7743 8.88716C12.8802 8.67542 13.0966 8.54167 13.3333 8.54167ZM11.428 14.375H15.2387L13.3333 10.5642L11.428 14.375Z\"\n  />\n</svg> `;\n\nexport const LanguageIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"currentColor\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <path\n    fill-rule=\"evenodd\"\n    clip-rule=\"evenodd\"\n    d=\"M7.50014 1.875C7.84532 1.875 8.12514 2.15482 8.12514 2.5V3.54167H10.6143C10.6216 3.54154 10.629 3.54154 10.6364 3.54167H12.5001C12.8453 3.54167 13.1251 3.82149 13.1251 4.16667C13.1251 4.51184 12.8453 4.79167 12.5001 4.79167H11.1458C10.6639 7.16518 9.64438 9.34282 8.22006 11.1922C8.5043 11.4886 8.80705 11.7614 9.12514 12C9.40128 12.2071 9.45724 12.5989 9.25014 12.875C9.04303 13.1511 8.65128 13.2071 8.37514 13C8.03723 12.7466 7.71615 12.4624 7.41408 12.1563C6.10818 13.5972 4.5372 14.7931 2.77828 15.6672C2.46917 15.8208 2.09406 15.6947 1.94044 15.3856C1.78683 15.0765 1.91288 14.7014 2.22199 14.5478C3.88561 13.721 5.36619 12.5816 6.58695 11.2065C5.71216 10.0729 5.07111 8.78956 4.74375 7.67633C4.64637 7.34517 4.83588 6.99777 5.16703 6.90039C5.49819 6.80301 5.84559 6.99252 5.94297 7.32367C6.2088 8.22765 6.71769 9.26651 7.3989 10.2054C8.57216 8.61889 9.42665 6.78272 9.86797 4.79167H2.9168C2.57163 4.79167 2.2918 4.51184 2.2918 4.16667C2.2918 3.82149 2.57163 3.54167 2.9168 3.54167H6.87514V2.5C6.87514 2.15482 7.15496 1.875 7.50014 1.875ZM13.3335 8.54167C13.5702 8.54167 13.7866 8.67542 13.8925 8.88716L16.8035 14.7093C16.8076 14.7169 16.8115 14.7247 16.8152 14.7326L18.0592 17.2205C18.2135 17.5292 18.0884 17.9046 17.7796 18.059C17.4709 18.2134 17.0955 18.0882 16.9411 17.7795L15.8639 15.625H10.8031L9.72582 17.7795C9.57145 18.0882 9.19603 18.2134 8.8873 18.059C8.57856 17.9046 8.45342 17.5292 8.60779 17.2205L9.85174 14.7326C9.85547 14.7247 9.85936 14.7169 9.86341 14.7093L12.7745 8.88716C12.8803 8.67542 13.0967 8.54167 13.3335 8.54167ZM11.4281 14.375H15.2389L13.3335 10.5642L11.4281 14.375Z\"\n  />\n</svg> `;\n\nexport const ImproveWritingIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"currentColor\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <path\n    fill-rule=\"evenodd\"\n    clip-rule=\"evenodd\"\n    d=\"M8.54167 2.5C8.54167 2.15482 8.26184 1.875 7.91667 1.875C7.57149 1.875 7.29167 2.15482 7.29167 2.5V5C7.29167 5.34518 7.57149 5.625 7.91667 5.625C8.26184 5.625 8.54167 5.34518 8.54167 5V2.5ZM8.54167 10.8333C8.54167 10.4882 8.26184 10.2083 7.91667 10.2083C7.57149 10.2083 7.29167 10.4882 7.29167 10.8333V13.3333C7.29167 13.6785 7.57149 13.9583 7.91667 13.9583C8.26184 13.9583 8.54167 13.6785 8.54167 13.3333V10.8333ZM5.625 7.91667C5.625 8.26184 5.34518 8.54167 5 8.54167H2.5C2.15482 8.54167 1.875 8.26184 1.875 7.91667C1.875 7.57149 2.15482 7.29167 2.5 7.29167H5C5.34518 7.29167 5.625 7.57149 5.625 7.91667ZM13.3333 8.54167C13.6785 8.54167 13.9583 8.26184 13.9583 7.91667C13.9583 7.57149 13.6785 7.29167 13.3333 7.29167H10.8333C10.4882 7.29167 10.2083 7.57149 10.2083 7.91667C10.2083 8.26184 10.4882 8.54167 10.8333 8.54167H13.3333ZM6.29623 6.29623C6.05215 6.54031 5.65642 6.54031 5.41235 6.29623L3.64458 4.52846C3.4005 4.28439 3.4005 3.88866 3.64458 3.64458C3.88866 3.4005 4.28439 3.4005 4.52846 3.64458L6.29623 5.41235C6.54031 5.65642 6.54031 6.05215 6.29623 6.29623ZM15.8081 16.6919C16.0521 16.936 16.4479 16.936 16.6919 16.6919C16.936 16.4479 16.936 16.0521 16.6919 15.8081L10.421 9.53712C10.1769 9.29304 9.7812 9.29304 9.53712 9.53712C9.29304 9.7812 9.29304 10.1769 9.53712 10.421L15.8081 16.6919ZM6.29623 9.5371C6.54031 9.78118 6.54031 10.1769 6.29623 10.421L4.52846 12.1888C4.28439 12.4328 3.88866 12.4328 3.64458 12.1888C3.4005 11.9447 3.4005 11.5489 3.64458 11.3049L5.41235 9.5371C5.65642 9.29303 6.05215 9.29303 6.29623 9.5371ZM12.1888 4.52845C12.4328 4.28437 12.4328 3.88864 12.1888 3.64457C11.9447 3.40049 11.549 3.40049 11.3049 3.64457L9.53712 5.41233C9.29304 5.65641 9.29304 6.05214 9.53712 6.29622C9.7812 6.54029 10.1769 6.54029 10.421 6.29622L12.1888 4.52845Z\"\n  />\n</svg> `;\n\nexport const AIDoneIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"currentColor\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <path\n    fill-rule=\"evenodd\"\n    clip-rule=\"evenodd\"\n    d=\"M16.2751 5.39143C16.5192 5.63551 16.5192 6.03124 16.2751 6.27532L7.94178 14.6086C7.6977 14.8527 7.30197 14.8527 7.0579 14.6086L3.72456 11.2753C3.48048 11.0312 3.48048 10.6355 3.72456 10.3914C3.96864 10.1474 4.36437 10.1474 4.60845 10.3914L7.49984 13.2828L15.3912 5.39143C15.6353 5.14735 16.031 5.14735 16.2751 5.39143Z\"\n  />\n</svg> `;\n\nexport const ShorterIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"currentColor\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <path\n    fill-rule=\"evenodd\"\n    clip-rule=\"evenodd\"\n    d=\"M4.1665 4.79163C3.82133 4.79163 3.5415 5.07145 3.5415 5.41663C3.5415 5.7618 3.82133 6.04163 4.1665 6.04163H15.8332C16.1783 6.04163 16.4582 5.7618 16.4582 5.41663C16.4582 5.07145 16.1783 4.79163 15.8332 4.79163H4.1665ZM4.1665 7.70829C3.82133 7.70829 3.5415 7.98811 3.5415 8.33329C3.5415 8.67847 3.82133 8.95829 4.1665 8.95829H9.99984C10.345 8.95829 10.6248 8.67847 10.6248 8.33329C10.6248 7.98811 10.345 7.70829 9.99984 7.70829H4.1665Z\"\n  />\n</svg> `;\n\nexport const LongerIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"currentColor\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <path\n    fill-rule=\"evenodd\"\n    clip-rule=\"evenodd\"\n    d=\"M4.1665 4.79163C3.82133 4.79163 3.5415 5.07145 3.5415 5.41663C3.5415 5.7618 3.82133 6.04163 4.1665 6.04163H15.8332C16.1783 6.04163 16.4582 5.7618 16.4582 5.41663C16.4582 5.07145 16.1783 4.79163 15.8332 4.79163H4.1665ZM4.1665 7.70829C3.82133 7.70829 3.5415 7.98811 3.5415 8.33329C3.5415 8.67847 3.82133 8.95829 4.1665 8.95829H15.8332C16.1783 8.95829 16.4582 8.67847 16.4582 8.33329C16.4582 7.98811 16.1783 7.70829 15.8332 7.70829H4.1665ZM3.5415 11.25C3.5415 10.9048 3.82133 10.625 4.1665 10.625H15.8332C16.1783 10.625 16.4582 10.9048 16.4582 11.25C16.4582 11.5951 16.1783 11.875 15.8332 11.875H4.1665C3.82133 11.875 3.5415 11.5951 3.5415 11.25ZM4.1665 13.5416C3.82133 13.5416 3.5415 13.8214 3.5415 14.1666C3.5415 14.5118 3.82133 14.7916 4.1665 14.7916H9.99984C10.345 14.7916 10.6248 14.5118 10.6248 14.1666C10.6248 13.8214 10.345 13.5416 9.99984 13.5416H4.1665Z\"\n  />\n</svg> `;\n\nexport const ExplainIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"currentColor\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <path\n    fill-rule=\"evenodd\"\n    clip-rule=\"evenodd\"\n    d=\"M4.1665 4.375C3.82133 4.375 3.5415 4.65482 3.5415 5V15C3.5415 15.3452 3.82133 15.625 4.1665 15.625H5.83317C6.17835 15.625 6.45817 15.3452 6.45817 15C6.45817 14.6548 6.17835 14.375 5.83317 14.375H4.7915V5.625H5.83317C6.17835 5.625 6.45817 5.34518 6.45817 5C6.45817 4.65482 6.17835 4.375 5.83317 4.375H4.1665ZM15.8332 4.375C16.1783 4.375 16.4582 4.65482 16.4582 5V15C16.4582 15.3452 16.1783 15.625 15.8332 15.625H14.1665C13.8213 15.625 13.5415 15.3452 13.5415 15C13.5415 14.6548 13.8213 14.375 14.1665 14.375H15.2082V5.625H14.1665C13.8213 5.625 13.5415 5.34518 13.5415 5C13.5415 4.65482 13.8213 4.375 14.1665 4.375H15.8332Z\"\n  />\n</svg> `;\n\nexport const AIExplainIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"none\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <g clip-path=\"url(#clip0_13930_38120)\">\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M4.1665 4.375C3.82133 4.375 3.5415 4.65482 3.5415 5V15C3.5415 15.3452 3.82133 15.625 4.1665 15.625H5.83317C6.17835 15.625 6.45817 15.3452 6.45817 15C6.45817 14.6548 6.17835 14.375 5.83317 14.375H4.7915V5.625H5.83317C6.17835 5.625 6.45817 5.34518 6.45817 5C6.45817 4.65482 6.17835 4.375 5.83317 4.375H4.1665ZM15.8332 4.375C16.1783 4.375 16.4582 4.65482 16.4582 5V15C16.4582 15.3452 16.1783 15.625 15.8332 15.625H14.1665C13.8213 15.625 13.5415 15.3452 13.5415 15C13.5415 14.6548 13.8213 14.375 14.1665 14.375H15.2082V5.625H14.1665C13.8213 5.625 13.5415 5.34518 13.5415 5C13.5415 4.65482 13.8213 4.375 14.1665 4.375H15.8332Z\"\n      fill=\"#1E96EB\"\n    />\n  </g>\n  <defs>\n    <clipPath id=\"clip0_13930_38120\">\n      <rect width=\"20\" height=\"20\" fill=\"white\" />\n    </clipPath>\n  </defs>\n</svg> `;\n\nexport const SelectionIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"currentColor\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <path\n    fill-rule=\"evenodd\"\n    clip-rule=\"evenodd\"\n    d=\"M5.00016 2.70837C3.73451 2.70837 2.7085 3.73439 2.7085 5.00004V15C2.7085 16.2657 3.73451 17.2917 5.00016 17.2917H9.16683C9.51201 17.2917 9.79183 17.0119 9.79183 16.6667C9.79183 16.3215 9.51201 16.0417 9.16683 16.0417H5.00016C4.42487 16.0417 3.9585 15.5753 3.9585 15V5.00004C3.9585 4.42474 4.42487 3.95837 5.00016 3.95837H15.0002C15.5755 3.95837 16.0418 4.42474 16.0418 5.00004V9.16671C16.0418 9.51189 16.3217 9.79171 16.6668 9.79171C17.012 9.79171 17.2918 9.51189 17.2918 9.16671V5.00004C17.2918 3.73439 16.2658 2.70837 15.0002 2.70837H5.00016ZM11.616 11.076C11.2776 10.9436 10.9438 11.2775 11.0762 11.6159L13.54 17.9123C13.6801 18.2704 14.1891 18.2637 14.3198 17.9021L15.2048 15.4548C15.2469 15.3384 15.3385 15.2467 15.4549 15.2046L17.9023 14.3197C18.2639 14.1889 18.2705 13.68 17.9124 13.5398L11.616 11.076Z\"\n  />\n</svg>`;\n\nexport const AIExplainSelectionIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"none\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <g clip-path=\"url(#clip0_13930_32480)\">\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M5.00016 2.70837C3.73451 2.70837 2.7085 3.73439 2.7085 5.00004V15C2.7085 16.2657 3.73451 17.2917 5.00016 17.2917H9.16683C9.51201 17.2917 9.79183 17.0119 9.79183 16.6667C9.79183 16.3215 9.51201 16.0417 9.16683 16.0417H5.00016C4.42487 16.0417 3.9585 15.5753 3.9585 15V5.00004C3.9585 4.42474 4.42487 3.95837 5.00016 3.95837H15.0002C15.5755 3.95837 16.0418 4.42474 16.0418 5.00004V9.16671C16.0418 9.51189 16.3217 9.79171 16.6668 9.79171C17.012 9.79171 17.2918 9.51189 17.2918 9.16671V5.00004C17.2918 3.73439 16.2658 2.70837 15.0002 2.70837H5.00016ZM11.616 11.076C11.2776 10.9436 10.9438 11.2775 11.0762 11.6159L13.54 17.9123C13.6801 18.2704 14.1891 18.2637 14.3198 17.9021L15.2048 15.4548C15.2469 15.3384 15.3385 15.2467 15.4549 15.2046L17.9023 14.3197C18.2639 14.1889 18.2705 13.68 17.9124 13.5398L11.616 11.076Z\"\n      fill=\"#1E96EB\"\n    />\n  </g>\n  <defs>\n    <clipPath id=\"clip0_13930_32480\">\n      <rect width=\"20\" height=\"20\" fill=\"white\" />\n    </clipPath>\n  </defs>\n</svg> `;\n\nexport const ToneIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"currentColor\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <path\n    fill-rule=\"evenodd\"\n    clip-rule=\"evenodd\"\n    d=\"M7.6411 7.08838L6.71487 9.4857C6.60938 9.75873 6.34683 9.93875 6.05413 9.93875H3.3335C2.98832 9.93875 2.7085 9.65893 2.7085 9.31375C2.7085 8.96857 2.98832 8.68875 3.3335 8.68875H5.68272L7.09896 5.02319C7.34911 4.37576 8.28457 4.43706 8.44809 5.11159L10.0805 11.8452L11.5785 7.1197C11.7512 6.57492 12.4648 6.44842 12.8142 6.90064L14.196 8.68875H16.6668C17.012 8.68875 17.2918 8.96857 17.2918 9.31375C17.2918 9.65893 17.012 9.93875 16.6668 9.93875H13.93C13.7106 9.93875 13.5036 9.83711 13.3695 9.66353L12.4575 8.48336L10.6861 14.0712C10.4695 14.7545 9.49134 14.7206 9.32248 14.024L7.6411 7.08838Z\"\n  />\n</svg> `;\n\nexport const AIChangeToneIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"none\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <g clip-path=\"url(#clip0_13930_43808)\">\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M7.6411 7.08838L6.71487 9.4857C6.60938 9.75873 6.34683 9.93875 6.05413 9.93875H3.3335C2.98832 9.93875 2.7085 9.65893 2.7085 9.31375C2.7085 8.96857 2.98832 8.68875 3.3335 8.68875H5.68272L7.09896 5.02319C7.34911 4.37576 8.28457 4.43706 8.44809 5.11159L10.0805 11.8452L11.5785 7.1197C11.7512 6.57492 12.4648 6.44842 12.8142 6.90064L14.196 8.68875H16.6668C17.012 8.68875 17.2918 8.96857 17.2918 9.31375C17.2918 9.65893 17.012 9.93875 16.6668 9.93875H13.93C13.7106 9.93875 13.5036 9.83711 13.3695 9.66353L12.4575 8.48336L10.6861 14.0712C10.4695 14.7545 9.49134 14.7206 9.32248 14.024L7.6411 7.08838Z\"\n      fill=\"#1E96EB\"\n    />\n  </g>\n  <defs>\n    <clipPath id=\"clip0_13930_43808\">\n      <rect width=\"20\" height=\"20\" fill=\"white\" />\n    </clipPath>\n  </defs>\n</svg> `;\n\nexport const AISearchIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"currentColor\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <path\n    fill-rule=\"evenodd\"\n    clip-rule=\"evenodd\"\n    d=\"M3.125 7.91667C3.125 5.2703 5.2703 3.125 7.91667 3.125C10.563 3.125 12.7083 5.2703 12.7083 7.91667C12.7083 10.563 10.563 12.7083 7.91667 12.7083C5.2703 12.7083 3.125 10.563 3.125 7.91667ZM7.91667 1.875C4.57995 1.875 1.875 4.57995 1.875 7.91667C1.875 11.2534 4.57995 13.9583 7.91667 13.9583C9.35991 13.9583 10.685 13.4523 11.724 12.6079L16.2247 17.1086C16.4688 17.3527 16.8645 17.3527 17.1086 17.1086C17.3527 16.8645 17.3527 16.4688 17.1086 16.2247L12.6079 11.724C13.4523 10.685 13.9583 9.35991 13.9583 7.91667C13.9583 4.57995 11.2534 1.875 7.91667 1.875Z\"\n  />\n</svg> `;\n\nexport const AIImproveWritingIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"none\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <g clip-path=\"url(#clip0_13930_43819)\">\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M8.54167 2.5C8.54167 2.15482 8.26184 1.875 7.91667 1.875C7.57149 1.875 7.29167 2.15482 7.29167 2.5V5C7.29167 5.34518 7.57149 5.625 7.91667 5.625C8.26184 5.625 8.54167 5.34518 8.54167 5V2.5ZM8.54167 10.8333C8.54167 10.4882 8.26184 10.2083 7.91667 10.2083C7.57149 10.2083 7.29167 10.4882 7.29167 10.8333V13.3333C7.29167 13.6785 7.57149 13.9583 7.91667 13.9583C8.26184 13.9583 8.54167 13.6785 8.54167 13.3333V10.8333ZM5.625 7.91667C5.625 8.26184 5.34518 8.54167 5 8.54167H2.5C2.15482 8.54167 1.875 8.26184 1.875 7.91667C1.875 7.57149 2.15482 7.29167 2.5 7.29167H5C5.34518 7.29167 5.625 7.57149 5.625 7.91667ZM13.3333 8.54167C13.6785 8.54167 13.9583 8.26184 13.9583 7.91667C13.9583 7.57149 13.6785 7.29167 13.3333 7.29167H10.8333C10.4882 7.29167 10.2083 7.57149 10.2083 7.91667C10.2083 8.26184 10.4882 8.54167 10.8333 8.54167H13.3333ZM6.29623 6.29623C6.05215 6.54031 5.65642 6.54031 5.41235 6.29623L3.64458 4.52846C3.4005 4.28439 3.4005 3.88866 3.64458 3.64458C3.88866 3.4005 4.28439 3.4005 4.52846 3.64458L6.29623 5.41235C6.54031 5.65642 6.54031 6.05215 6.29623 6.29623ZM15.8081 16.6919C16.0521 16.936 16.4479 16.936 16.6919 16.6919C16.936 16.4479 16.936 16.0521 16.6919 15.8081L10.421 9.53712C10.1769 9.29304 9.7812 9.29304 9.53712 9.53712C9.29304 9.7812 9.29304 10.1769 9.53712 10.421L15.8081 16.6919ZM6.29623 9.5371C6.54031 9.78118 6.54031 10.1769 6.29623 10.421L4.52846 12.1888C4.28439 12.4328 3.88866 12.4328 3.64458 12.1888C3.4005 11.9447 3.4005 11.5489 3.64458 11.3049L5.41235 9.5371C5.65642 9.29303 6.05215 9.29303 6.29623 9.5371ZM12.1888 4.52845C12.4328 4.28437 12.4328 3.88864 12.1888 3.64457C11.9447 3.40049 11.549 3.40049 11.3049 3.64457L9.53712 5.41233C9.29304 5.65641 9.29304 6.05214 9.53712 6.29622C9.7812 6.54029 10.1769 6.54029 10.421 6.29622L12.1888 4.52845Z\"\n      fill=\"#1E96EB\"\n    />\n  </g>\n  <defs>\n    <clipPath id=\"clip0_13930_43819\">\n      <rect width=\"20\" height=\"20\" fill=\"white\" />\n    </clipPath>\n  </defs>\n</svg> `;\n\nexport const AIMakeLongerIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"none\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <g clip-path=\"url(#clip0_13930_61753)\">\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M4.1665 4.79163C3.82133 4.79163 3.5415 5.07145 3.5415 5.41663C3.5415 5.7618 3.82133 6.04163 4.1665 6.04163H15.8332C16.1783 6.04163 16.4582 5.7618 16.4582 5.41663C16.4582 5.07145 16.1783 4.79163 15.8332 4.79163H4.1665ZM4.1665 7.70829C3.82133 7.70829 3.5415 7.98811 3.5415 8.33329C3.5415 8.67847 3.82133 8.95829 4.1665 8.95829H15.8332C16.1783 8.95829 16.4582 8.67847 16.4582 8.33329C16.4582 7.98811 16.1783 7.70829 15.8332 7.70829H4.1665ZM3.5415 11.25C3.5415 10.9048 3.82133 10.625 4.1665 10.625H15.8332C16.1783 10.625 16.4582 10.9048 16.4582 11.25C16.4582 11.5951 16.1783 11.875 15.8332 11.875H4.1665C3.82133 11.875 3.5415 11.5951 3.5415 11.25ZM4.1665 13.5416C3.82133 13.5416 3.5415 13.8214 3.5415 14.1666C3.5415 14.5118 3.82133 14.7916 4.1665 14.7916H9.99984C10.345 14.7916 10.6248 14.5118 10.6248 14.1666C10.6248 13.8214 10.345 13.5416 9.99984 13.5416H4.1665Z\"\n      fill=\"#1E96EB\"\n    />\n  </g>\n  <defs>\n    <clipPath id=\"clip0_13930_61753\">\n      <rect width=\"20\" height=\"20\" fill=\"white\" />\n    </clipPath>\n  </defs>\n</svg> `;\n\nexport const AIMakeShorterIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"none\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <g clip-path=\"url(#clip0_13930_16541)\">\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M4.1665 4.79163C3.82133 4.79163 3.5415 5.07145 3.5415 5.41663C3.5415 5.7618 3.82133 6.04163 4.1665 6.04163H15.8332C16.1783 6.04163 16.4582 5.7618 16.4582 5.41663C16.4582 5.07145 16.1783 4.79163 15.8332 4.79163H4.1665ZM4.1665 7.70829C3.82133 7.70829 3.5415 7.98811 3.5415 8.33329C3.5415 8.67847 3.82133 8.95829 4.1665 8.95829H9.99984C10.345 8.95829 10.6248 8.67847 10.6248 8.33329C10.6248 7.98811 10.345 7.70829 9.99984 7.70829H4.1665Z\"\n      fill=\"#1E96EB\"\n    />\n  </g>\n  <defs>\n    <clipPath id=\"clip0_13930_16541\">\n      <rect width=\"20\" height=\"20\" fill=\"white\" />\n    </clipPath>\n  </defs>\n</svg> `;\n\nexport const AIMakeRealIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"none\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <g clip-path=\"url(#clip0_13930_69049)\">\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M1.89506 9.08921C1.36098 9.7358 1.85634 10.708 2.69338 10.656L5.70784 10.4686L7.3281 13.0175C7.77801 13.7253 8.85573 13.5546 9.06491 12.7424L9.63712 10.5208L15.8083 16.6919C16.0524 16.936 16.4481 16.936 16.6922 16.6919C16.9362 16.4479 16.9362 16.0521 16.6922 15.8081L10.5208 9.63666L12.743 9.0643C13.5552 8.85512 13.7259 7.7774 13.0181 7.32749L10.4692 5.70723L10.6566 2.69278C10.7086 1.85574 9.73642 1.36036 9.08982 1.89445L6.76121 3.81789L3.9522 2.70817C3.17221 2.40003 2.40064 3.17159 2.70878 3.95159L3.8185 6.7606L1.89506 9.08921ZM5.80215 9.21036L3.28715 9.36669L4.8919 7.42389C5.11419 7.15478 5.17258 6.7861 5.04433 6.46147L4.11848 4.11787L6.46208 5.04372C6.78671 5.17197 7.15539 5.11358 7.4245 4.89129L9.36729 3.28654L9.21097 5.80154C9.18931 6.14991 9.35878 6.48251 9.65335 6.66975L11.7799 8.02156L9.33969 8.65007C9.00168 8.73713 8.73774 9.00107 8.65068 9.33909L8.02217 11.7793L6.67036 9.65274C6.48312 9.35817 6.15052 9.18871 5.80215 9.21036Z\"\n      fill=\"#1E96EB\"\n    />\n  </g>\n  <defs>\n    <clipPath id=\"clip0_13930_69049\">\n      <rect width=\"20\" height=\"20\" fill=\"white\" />\n    </clipPath>\n  </defs>\n</svg> `;\n\nexport const AIPenIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"currentColor\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <path\n    fill-rule=\"evenodd\"\n    clip-rule=\"evenodd\"\n    d=\"M16.0654 3.93417C15.5409 3.41078 14.6902 3.41078 14.1658 3.93417L13.4285 4.67003L15.3263 6.56414L16.0654 5.82654C16.5891 5.30384 16.5891 4.45687 16.0654 3.93417ZM14.4416 7.44716L12.5437 5.55304L3.5415 14.5375V16.4583H5.41262L14.4416 7.44716ZM13.2828 3.04941C14.2951 2.03903 15.936 2.03903 16.9484 3.04941C17.9614 4.06047 17.9614 5.70024 16.9484 6.7113L6.11265 17.5257C5.99547 17.6427 5.83669 17.7083 5.67114 17.7083H2.9165C2.57133 17.7083 2.2915 17.4285 2.2915 17.0833V14.2783C2.2915 14.1123 2.35752 13.9532 2.475 13.8359L13.2828 3.04941Z\"\n  />\n</svg> `;\n\nexport const AIPenIconWithAnimation = html`<dotlottie-player\n  src='{\"v\":\"5.12.1\",\"fr\":120,\"ip\":0,\"op\":151,\"w\":300,\"h\":300,\"nm\":\"Pen\",\"ddd\":0,\"assets\":[],\"layers\":[{\"ddd\":0,\"ind\":1,\"ty\":4,\"nm\":\"Pen 3\",\"sr\":1,\"ks\":{\"o\":{\"a\":0,\"k\":100,\"ix\":11},\"r\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.207],\"y\":[1]},\"o\":{\"x\":[0.5],\"y\":[0]},\"t\":48,\"s\":[-89]},{\"t\":98,\"s\":[0]}],\"ix\":10},\"p\":{\"a\":1,\"k\":[{\"i\":{\"x\":0.207,\"y\":1},\"o\":{\"x\":0.5,\"y\":0},\"t\":48,\"s\":[258.044,260.849,0],\"to\":[0,0,0],\"ti\":[0,0,0]},{\"t\":98,\"s\":[42.044,260.849,0]}],\"ix\":2,\"l\":2},\"a\":{\"a\":0,\"k\":[0.75,19.25,0],\"ix\":1,\"l\":2},\"s\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.833,0.833,0.833],\"y\":[0.833,0.833,1.017]},\"o\":{\"x\":[0.5,0.5,0.5],\"y\":[0,0,0]},\"t\":48,\"s\":[1178,1178,100]},{\"i\":{\"x\":[0.403,0.403,0],\"y\":[1,1,1]},\"o\":{\"x\":[0.167,0.167,0.167],\"y\":[0.167,0.167,0.017]},\"t\":72.324,\"s\":[975,975,100]},{\"t\":98,\"s\":[1178,1178,100]}],\"ix\":6,\"l\":2}},\"ao\":0,\"shapes\":[{\"ty\":\"gr\",\"it\":[{\"ind\":0,\"ty\":\"sh\",\"ix\":1,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[0,0],[0,0],[0,0]],\"o\":[[0,0],[0,0],[0,0],[0,0]],\"v\":[[2.371,-5.714],[5.71,-2.38],[6.77,-3.443],[3.431,-6.775]],\"c\":true},\"ix\":2},\"nm\":\" 1\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ind\":1,\"ty\":\"sh\",\"ix\":2,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[0,0],[0,0],[0,0]],\"o\":[[0,0],[0,0],[0,0],[0,0]],\"v\":[[-9.402,8.652],[-7.902,8.652],[-7.902,5.286],[-9.402,5.286]],\"c\":true},\"ix\":2},\"nm\":\" 2\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ind\":2,\"ty\":\"sh\",\"ix\":3,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0]],\"o\":[[0,0]],\"v\":[[-9.402,5.286]],\"c\":false},\"ix\":2},\"nm\":\" 3\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ind\":3,\"ty\":\"sh\",\"ix\":4,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[0,0],[0,0],[0,0]],\"o\":[[0,0],[0,0],[0,0],[0,0]],\"v\":[[3.788,-8.189],[-9.182,4.755],[-8.122,5.816],[4.847,-7.128]],\"c\":true},\"ix\":2},\"nm\":\" 4\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ind\":4,\"ty\":\"sh\",\"ix\":5,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[0,0],[0,0],[0,0]],\"o\":[[0,0],[0,0],[0,0],[0,0]],\"v\":[[-5.346,7.902],[-8.652,7.902],[-8.652,9.402],[-5.346,9.402]],\"c\":true},\"ix\":2},\"nm\":\" 5\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ind\":5,\"ty\":\"sh\",\"ix\":6,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[0,0],[0,0],[0,0]],\"o\":[[0,0],[0,0],[0,0],[0,0]],\"v\":[[7.127,-4.857],[-5.876,8.12],[-4.816,9.182],[8.186,-3.794]],\"c\":true},\"ix\":2},\"nm\":\" 6\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ind\":6,\"ty\":\"sh\",\"ix\":7,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[0.628,-0.627],[0,0],[1.216,1.214]],\"o\":[[0.628,0.627],[0,0],[1.216,-1.214],[0,0]],\"v\":[[7.127,-7.128],[7.127,-4.857],[8.186,-3.794],[8.186,-8.189]],\"c\":true},\"ix\":2},\"nm\":\" 7\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ind\":7,\"ty\":\"sh\",\"ix\":8,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[-0.629,-0.628],[0,0],[1.215,-1.212]],\"o\":[[0.63,-0.628],[0,0],[-1.214,-1.212],[0,0]],\"v\":[[4.847,-7.128],[7.127,-7.128],[8.186,-8.189],[3.788,-8.189]],\"c\":true},\"ix\":2},\"nm\":\" 8\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ind\":8,\"ty\":\"sh\",\"ix\":9,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[0,0],[0,-0.199]],\"o\":[[0,0],[-0.141,0.141],[0,0]],\"v\":[[-8.652,5.286],[-9.182,4.755],[-9.402,5.286]],\"c\":true},\"ix\":2},\"nm\":\" 9\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ind\":9,\"ty\":\"sh\",\"ix\":10,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[0,0],[-0.414,0]],\"o\":[[0,0],[0,0.414],[0,0]],\"v\":[[-8.652,8.652],[-9.402,8.652],[-8.652,9.402]],\"c\":true},\"ix\":2},\"nm\":\" 10\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ind\":10,\"ty\":\"sh\",\"ix\":11,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[0,0],[-0.141,0.14]],\"o\":[[0,0],[0.198,0],[0,0]],\"v\":[[-5.346,8.652],[-5.346,9.402],[-4.816,9.182]],\"c\":true},\"ix\":2},\"nm\":\" 11\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ind\":11,\"ty\":\"sh\",\"ix\":12,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[0,0]],\"o\":[[0,0],[0,0]],\"v\":[[7.657,-7.659],[8.186,-8.189]],\"c\":true},\"ix\":2},\"nm\":\" 12\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ty\":\"mm\",\"mm\":1,\"nm\":\" 1\",\"mn\":\"ADBE Vector Filter - Merge\",\"hd\":false},{\"ty\":\"fl\",\"c\":{\"a\":0,\"k\":[0.117647058824,0.588235294118,0.921568627451,1],\"ix\":4},\"o\":{\"a\":0,\"k\":100,\"ix\":5},\"r\":1,\"bm\":0,\"nm\":\" 1\",\"mn\":\"ADBE Vector Graphic - Fill\",\"hd\":false},{\"ty\":\"tr\",\"p\":{\"a\":0,\"k\":[10.152,9.848],\"ix\":2},\"a\":{\"a\":0,\"k\":[0,0],\"ix\":1},\"s\":{\"a\":0,\"k\":[100,100],\"ix\":3},\"r\":{\"a\":0,\"k\":0,\"ix\":6},\"o\":{\"a\":0,\"k\":100,\"ix\":7},\"sk\":{\"a\":0,\"k\":0,\"ix\":4},\"sa\":{\"a\":0,\"k\":0,\"ix\":5},\"nm\":\"\"}],\"nm\":\" 1\",\"np\":14,\"cix\":2,\"bm\":0,\"ix\":1,\"mn\":\"ADBE Vector Group\",\"hd\":false}],\"ip\":48,\"op\":8416,\"st\":16,\"ct\":1,\"bm\":0},{\"ddd\":0,\"ind\":2,\"ty\":4,\"nm\":\"Pen\",\"sr\":1,\"ks\":{\"o\":{\"a\":0,\"k\":100,\"ix\":11},\"r\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.67],\"y\":[1]},\"o\":{\"x\":[0.5],\"y\":[0]},\"t\":0,\"s\":[0]},{\"t\":48,\"s\":[-89]}],\"ix\":10},\"p\":{\"a\":1,\"k\":[{\"i\":{\"x\":0.833,\"y\":0.833},\"o\":{\"x\":0.5,\"y\":0},\"t\":0,\"s\":[38.998,260.999,0],\"to\":[0,0,0],\"ti\":[0,0,0]},{\"i\":{\"x\":0.67,\"y\":1},\"o\":{\"x\":0.167,\"y\":0.167},\"t\":24,\"s\":[150.369,238.999,0],\"to\":[0,0,0],\"ti\":[0,0,0]},{\"t\":48,\"s\":[258.965,260.999,0]}],\"ix\":2,\"l\":2},\"a\":{\"a\":0,\"k\":[0.75,19.25,0],\"ix\":1,\"l\":2},\"s\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.833,0.833,0.833],\"y\":[0.833,0.833,1]},\"o\":{\"x\":[0.5,0.5,0.5],\"y\":[0,0,0]},\"t\":0,\"s\":[1200,1200,100]},{\"i\":{\"x\":[0.67,0.67,0.67],\"y\":[1,1,1]},\"o\":{\"x\":[0.167,0.167,0.167],\"y\":[0.167,0.167,0]},\"t\":24,\"s\":[787,787,100]},{\"t\":48,\"s\":[1178,1178,100]}],\"ix\":6,\"l\":2}},\"ao\":0,\"shapes\":[{\"ty\":\"gr\",\"it\":[{\"ind\":0,\"ty\":\"sh\",\"ix\":1,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[0,0],[0,0],[0,0]],\"o\":[[0,0],[0,0],[0,0],[0,0]],\"v\":[[2.371,-5.714],[5.71,-2.38],[6.77,-3.443],[3.431,-6.775]],\"c\":true},\"ix\":2},\"nm\":\" 1\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ind\":1,\"ty\":\"sh\",\"ix\":2,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[0,0],[0,0],[0,0]],\"o\":[[0,0],[0,0],[0,0],[0,0]],\"v\":[[-9.402,8.652],[-7.902,8.652],[-7.902,5.286],[-9.402,5.286]],\"c\":true},\"ix\":2},\"nm\":\" 2\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ind\":2,\"ty\":\"sh\",\"ix\":3,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0]],\"o\":[[0,0]],\"v\":[[-9.402,5.286]],\"c\":false},\"ix\":2},\"nm\":\" 3\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ind\":3,\"ty\":\"sh\",\"ix\":4,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[0,0],[0,0],[0,0]],\"o\":[[0,0],[0,0],[0,0],[0,0]],\"v\":[[3.788,-8.189],[-9.182,4.755],[-8.122,5.816],[4.847,-7.128]],\"c\":true},\"ix\":2},\"nm\":\" 4\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ind\":4,\"ty\":\"sh\",\"ix\":5,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[0,0],[0,0],[0,0]],\"o\":[[0,0],[0,0],[0,0],[0,0]],\"v\":[[-5.346,7.902],[-8.652,7.902],[-8.652,9.402],[-5.346,9.402]],\"c\":true},\"ix\":2},\"nm\":\" 5\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ind\":5,\"ty\":\"sh\",\"ix\":6,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[0,0],[0,0],[0,0]],\"o\":[[0,0],[0,0],[0,0],[0,0]],\"v\":[[7.127,-4.857],[-5.876,8.12],[-4.816,9.182],[8.186,-3.794]],\"c\":true},\"ix\":2},\"nm\":\" 6\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ind\":6,\"ty\":\"sh\",\"ix\":7,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[0.628,-0.627],[0,0],[1.216,1.214]],\"o\":[[0.628,0.627],[0,0],[1.216,-1.214],[0,0]],\"v\":[[7.127,-7.128],[7.127,-4.857],[8.186,-3.794],[8.186,-8.189]],\"c\":true},\"ix\":2},\"nm\":\" 7\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ind\":7,\"ty\":\"sh\",\"ix\":8,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[-0.629,-0.628],[0,0],[1.215,-1.212]],\"o\":[[0.63,-0.628],[0,0],[-1.214,-1.212],[0,0]],\"v\":[[4.847,-7.128],[7.127,-7.128],[8.186,-8.189],[3.788,-8.189]],\"c\":true},\"ix\":2},\"nm\":\" 8\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ind\":8,\"ty\":\"sh\",\"ix\":9,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[0,0],[0,-0.199]],\"o\":[[0,0],[-0.141,0.141],[0,0]],\"v\":[[-8.652,5.286],[-9.182,4.755],[-9.402,5.286]],\"c\":true},\"ix\":2},\"nm\":\" 9\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ind\":9,\"ty\":\"sh\",\"ix\":10,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[0,0],[-0.414,0]],\"o\":[[0,0],[0,0.414],[0,0]],\"v\":[[-8.652,8.652],[-9.402,8.652],[-8.652,9.402]],\"c\":true},\"ix\":2},\"nm\":\" 10\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ind\":10,\"ty\":\"sh\",\"ix\":11,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[0,0],[-0.141,0.14]],\"o\":[[0,0],[0.198,0],[0,0]],\"v\":[[-5.346,8.652],[-5.346,9.402],[-4.816,9.182]],\"c\":true},\"ix\":2},\"nm\":\" 11\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ind\":11,\"ty\":\"sh\",\"ix\":12,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[0,0]],\"o\":[[0,0],[0,0]],\"v\":[[7.657,-7.659],[8.186,-8.189]],\"c\":true},\"ix\":2},\"nm\":\" 12\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ty\":\"mm\",\"mm\":1,\"nm\":\" 1\",\"mn\":\"ADBE Vector Filter - Merge\",\"hd\":false},{\"ty\":\"fl\",\"c\":{\"a\":0,\"k\":[0.117647058824,0.588235294118,0.921568627451,1],\"ix\":4},\"o\":{\"a\":0,\"k\":100,\"ix\":5},\"r\":1,\"bm\":0,\"nm\":\" 1\",\"mn\":\"ADBE Vector Graphic - Fill\",\"hd\":false},{\"ty\":\"tr\",\"p\":{\"a\":0,\"k\":[10.152,9.848],\"ix\":2},\"a\":{\"a\":0,\"k\":[0,0],\"ix\":1},\"s\":{\"a\":0,\"k\":[100,100],\"ix\":3},\"r\":{\"a\":0,\"k\":0,\"ix\":6},\"o\":{\"a\":0,\"k\":100,\"ix\":7},\"sk\":{\"a\":0,\"k\":0,\"ix\":4},\"sa\":{\"a\":0,\"k\":0,\"ix\":5},\"nm\":\"\"}],\"nm\":\" 1\",\"np\":14,\"cix\":2,\"bm\":0,\"ix\":1,\"mn\":\"ADBE Vector Group\",\"hd\":false}],\"ip\":0,\"op\":48,\"st\":0,\"ct\":1,\"bm\":0},{\"ddd\":0,\"ind\":3,\"ty\":4,\"nm\":\"line 2\",\"sr\":1,\"ks\":{\"o\":{\"a\":0,\"k\":100,\"ix\":11},\"r\":{\"a\":0,\"k\":0,\"ix\":10},\"p\":{\"a\":0,\"k\":[49.5,252.5,0],\"ix\":2,\"l\":2},\"a\":{\"a\":0,\"k\":[-104,104,0],\"ix\":1,\"l\":2},\"s\":{\"a\":0,\"k\":[100,100,100],\"ix\":6,\"l\":2}},\"ao\":0,\"shapes\":[{\"ty\":\"gr\",\"it\":[{\"ind\":0,\"ty\":\"sh\",\"ix\":1,\"ks\":{\"a\":1,\"k\":[{\"i\":{\"x\":0.833,\"y\":0.833},\"o\":{\"x\":0.167,\"y\":0.167},\"t\":0,\"s\":[{\"i\":[[0,0],[0,0]],\"o\":[[0,0],[0,0]],\"v\":[[-79,104],[98,104]],\"c\":false}]},{\"t\":38,\"s\":[{\"i\":[[0,0],[0,0]],\"o\":[[0,0],[0,0]],\"v\":[[-105,104],[98,104]],\"c\":false}]}],\"ix\":2},\"nm\":\" 1\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ty\":\"st\",\"c\":{\"a\":0,\"k\":[0.117647058824,0.588235294118,0.921568627451,1],\"ix\":3},\"o\":{\"a\":0,\"k\":100,\"ix\":4},\"w\":{\"a\":0,\"k\":17,\"ix\":5},\"lc\":2,\"lj\":1,\"ml\":4,\"bm\":0,\"nm\":\" 1\",\"mn\":\"ADBE Vector Graphic - Stroke\",\"hd\":false},{\"ty\":\"tr\",\"p\":{\"a\":0,\"k\":[0,0],\"ix\":2},\"a\":{\"a\":0,\"k\":[0,0],\"ix\":1},\"s\":{\"a\":0,\"k\":[100,100],\"ix\":3},\"r\":{\"a\":0,\"k\":0,\"ix\":6},\"o\":{\"a\":0,\"k\":100,\"ix\":7},\"sk\":{\"a\":0,\"k\":0,\"ix\":4},\"sa\":{\"a\":0,\"k\":0,\"ix\":5},\"nm\":\"\"}],\"nm\":\" 1\",\"np\":3,\"cix\":2,\"bm\":0,\"ix\":1,\"mn\":\"ADBE Vector Group\",\"hd\":false},{\"ty\":\"tm\",\"s\":{\"a\":0,\"k\":0,\"ix\":1},\"e\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.833],\"y\":[0.833]},\"o\":{\"x\":[0.167],\"y\":[0.167]},\"t\":0,\"s\":[100]},{\"t\":38,\"s\":[0]}],\"ix\":2},\"o\":{\"a\":0,\"k\":0,\"ix\":3},\"m\":1,\"ix\":2,\"nm\":\" 1\",\"mn\":\"ADBE Vector Filter - Trim\",\"hd\":false}],\"ip\":0,\"op\":8400,\"st\":0,\"ct\":1,\"bm\":0},{\"ddd\":0,\"ind\":4,\"ty\":4,\"nm\":\"line\",\"sr\":1,\"ks\":{\"o\":{\"a\":0,\"k\":100,\"ix\":11},\"r\":{\"a\":0,\"k\":0,\"ix\":10},\"p\":{\"a\":0,\"k\":[49.5,252.5,0],\"ix\":2,\"l\":2},\"a\":{\"a\":0,\"k\":[-104,104,0],\"ix\":1,\"l\":2},\"s\":{\"a\":0,\"k\":[100,100,100],\"ix\":6,\"l\":2}},\"ao\":0,\"shapes\":[{\"ty\":\"gr\",\"it\":[{\"ind\":0,\"ty\":\"sh\",\"ix\":1,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[0,0]],\"o\":[[0,0],[0,0]],\"v\":[[-94,104],[98,104]],\"c\":false},\"ix\":2},\"nm\":\" 1\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ty\":\"st\",\"c\":{\"a\":0,\"k\":[0.117647058824,0.588235294118,0.921568627451,1],\"ix\":3},\"o\":{\"a\":0,\"k\":100,\"ix\":4},\"w\":{\"a\":0,\"k\":17,\"ix\":5},\"lc\":2,\"lj\":1,\"ml\":4,\"bm\":0,\"nm\":\" 1\",\"mn\":\"ADBE Vector Graphic - Stroke\",\"hd\":false},{\"ty\":\"tr\",\"p\":{\"a\":0,\"k\":[0,0],\"ix\":2},\"a\":{\"a\":0,\"k\":[0,0],\"ix\":1},\"s\":{\"a\":0,\"k\":[100,100],\"ix\":3},\"r\":{\"a\":0,\"k\":0,\"ix\":6},\"o\":{\"a\":0,\"k\":100,\"ix\":7},\"sk\":{\"a\":0,\"k\":0,\"ix\":4},\"sa\":{\"a\":0,\"k\":0,\"ix\":5},\"nm\":\"\"}],\"nm\":\" 1\",\"np\":3,\"cix\":2,\"bm\":0,\"ix\":1,\"mn\":\"ADBE Vector Group\",\"hd\":false},{\"ty\":\"tm\",\"s\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.575],\"y\":[1]},\"o\":{\"x\":[0.429],\"y\":[0]},\"t\":48,\"s\":[100]},{\"t\":88,\"s\":[0]}],\"ix\":1},\"e\":{\"a\":0,\"k\":100,\"ix\":2},\"o\":{\"a\":0,\"k\":0,\"ix\":3},\"m\":1,\"ix\":2,\"nm\":\" 1\",\"mn\":\"ADBE Vector Filter - Trim\",\"hd\":false}],\"ip\":0,\"op\":8400,\"st\":0,\"ct\":1,\"bm\":0}],\"markers\":[],\"props\":{}}'\n  background=\"transparent\"\n  speed=\"1\"\n  style=\"width: 20px; height: 20px;\"\n  loop\n  autoplay\n></dotlottie-player>`;\n\nexport const AIPresentationIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"currentColor\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <g clip-path=\"url(#clip0_14287_43677)\">\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M1.875 5.41663C1.875 4.38109 2.71447 3.54163 3.75 3.54163H16.25C17.2855 3.54163 18.125 4.38109 18.125 5.41663V14.5833C18.125 15.6188 17.2855 16.4583 16.25 16.4583H3.75C2.71447 16.4583 1.875 15.6188 1.875 14.5833V5.41663ZM3.75 4.79163C3.40482 4.79163 3.125 5.07145 3.125 5.41663V14.5833C3.125 14.9285 3.40482 15.2083 3.75 15.2083H16.25C16.5952 15.2083 16.875 14.9285 16.875 14.5833V5.41663C16.875 5.07145 16.5952 4.79163 16.25 4.79163H3.75ZM4.79167 7.08329C4.79167 6.73811 5.07149 6.45829 5.41667 6.45829H6.25C6.59518 6.45829 6.875 6.73811 6.875 7.08329C6.875 7.42847 6.59518 7.70829 6.25 7.70829H5.41667C5.07149 7.70829 4.79167 7.42847 4.79167 7.08329ZM5.41667 9.37496C5.07149 9.37496 4.79167 9.65478 4.79167 9.99996C4.79167 10.3451 5.07149 10.625 5.41667 10.625H10.8333C11.1785 10.625 11.4583 10.3451 11.4583 9.99996C11.4583 9.65478 11.1785 9.37496 10.8333 9.37496H5.41667ZM12.2917 9.99996C12.2917 9.65478 12.5715 9.37496 12.9167 9.37496H14.5833C14.9285 9.37496 15.2083 9.65478 15.2083 9.99996C15.2083 10.3451 14.9285 10.625 14.5833 10.625H12.9167C12.5715 10.625 12.2917 10.3451 12.2917 9.99996ZM5.41667 12.2916C5.07149 12.2916 4.79167 12.5714 4.79167 12.9166C4.79167 13.2618 5.07149 13.5416 5.41667 13.5416H14.5833C14.9285 13.5416 15.2083 13.2618 15.2083 12.9166C15.2083 12.5714 14.9285 12.2916 14.5833 12.2916H5.41667Z\"\n    />\n  </g>\n  <defs>\n    <clipPath id=\"clip0_14287_43677\">\n      <rect width=\"20\" height=\"20\" fill=\"white\" />\n    </clipPath>\n  </defs>\n</svg> `;\n\nexport const AIPresentationIconWithAnimation = html`<dotlottie-player\n  src='{\"v\":\"5.12.1\",\"fr\":120,\"ip\":0,\"op\":150,\"w\":240,\"h\":240,\"nm\":\"ppt\",\"ddd\":0,\"assets\":[],\"layers\":[{\"ddd\":0,\"ind\":1,\"ty\":4,\"nm\":\" 2\",\"parent\":5,\"sr\":1,\"ks\":{\"o\":{\"a\":0,\"k\":100,\"ix\":11},\"r\":{\"a\":0,\"k\":0,\"ix\":10},\"p\":{\"a\":0,\"k\":[6.5,15.5,0],\"ix\":2,\"l\":2},\"a\":{\"a\":0,\"k\":[6.5,15.5,0],\"ix\":1,\"l\":2},\"s\":{\"a\":0,\"k\":[100,100,100],\"ix\":6,\"l\":2}},\"ao\":0,\"shapes\":[{\"ty\":\"gr\",\"it\":[{\"ind\":0,\"ty\":\"sh\",\"ix\":1,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[0,0]],\"o\":[[0,0],[0,0]],\"v\":[[6.5,15.5],[17.5,15.5]],\"c\":false},\"ix\":2},\"nm\":\" 1\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ty\":\"st\",\"c\":{\"a\":0,\"k\":[0.117647058824,0.588235294118,0.921568627451,1],\"ix\":3},\"o\":{\"a\":0,\"k\":100,\"ix\":4},\"w\":{\"a\":0,\"k\":1.5,\"ix\":5},\"lc\":2,\"lj\":2,\"bm\":0,\"nm\":\" 1\",\"mn\":\"ADBE Vector Graphic - Stroke\",\"hd\":false},{\"ty\":\"tr\",\"p\":{\"a\":0,\"k\":[0,0],\"ix\":2},\"a\":{\"a\":0,\"k\":[0,0],\"ix\":1},\"s\":{\"a\":0,\"k\":[100,100],\"ix\":3},\"r\":{\"a\":0,\"k\":0,\"ix\":6},\"o\":{\"a\":0,\"k\":100,\"ix\":7},\"sk\":{\"a\":0,\"k\":0,\"ix\":4},\"sa\":{\"a\":0,\"k\":0,\"ix\":5},\"nm\":\"\"}],\"nm\":\" 1\",\"np\":2,\"cix\":2,\"bm\":0,\"ix\":1,\"mn\":\"ADBE Vector Group\",\"hd\":false},{\"ty\":\"tm\",\"s\":{\"a\":0,\"k\":0,\"ix\":1},\"e\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.7],\"y\":[1]},\"o\":{\"x\":[0.3],\"y\":[0]},\"t\":59,\"s\":[0]},{\"t\":85.21875,\"s\":[100]}],\"ix\":2},\"o\":{\"a\":0,\"k\":0,\"ix\":3},\"m\":1,\"ix\":2,\"nm\":\" 1\",\"mn\":\"ADBE Vector Filter - Trim\",\"hd\":false}],\"ip\":0,\"op\":10823,\"st\":0,\"ct\":1,\"bm\":0},{\"ddd\":0,\"ind\":2,\"ty\":4,\"nm\":\" 3\",\"parent\":5,\"sr\":1,\"ks\":{\"o\":{\"a\":0,\"k\":100,\"ix\":11},\"r\":{\"a\":0,\"k\":0,\"ix\":10},\"p\":{\"a\":0,\"k\":[15.5,12,0],\"ix\":2,\"l\":2},\"a\":{\"a\":0,\"k\":[15.5,12,0],\"ix\":1,\"l\":2},\"s\":{\"a\":0,\"k\":[100,100,100],\"ix\":6,\"l\":2}},\"ao\":0,\"shapes\":[{\"ty\":\"gr\",\"it\":[{\"ind\":0,\"ty\":\"sh\",\"ix\":1,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[0,0]],\"o\":[[0,0],[0,0]],\"v\":[[15.5,12],[17.5,12]],\"c\":false},\"ix\":2},\"nm\":\" 1\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ty\":\"st\",\"c\":{\"a\":0,\"k\":[0.117647058824,0.588235294118,0.921568627451,1],\"ix\":3},\"o\":{\"a\":0,\"k\":100,\"ix\":4},\"w\":{\"a\":0,\"k\":1.5,\"ix\":5},\"lc\":2,\"lj\":2,\"bm\":0,\"nm\":\" 1\",\"mn\":\"ADBE Vector Graphic - Stroke\",\"hd\":false},{\"ty\":\"tr\",\"p\":{\"a\":0,\"k\":[0,0],\"ix\":2},\"a\":{\"a\":0,\"k\":[0,0],\"ix\":1},\"s\":{\"a\":0,\"k\":[100,100],\"ix\":3},\"r\":{\"a\":0,\"k\":0,\"ix\":6},\"o\":{\"a\":0,\"k\":100,\"ix\":7},\"sk\":{\"a\":0,\"k\":0,\"ix\":4},\"sa\":{\"a\":0,\"k\":0,\"ix\":5},\"nm\":\"\"}],\"nm\":\" 1\",\"np\":2,\"cix\":2,\"bm\":0,\"ix\":1,\"mn\":\"ADBE Vector Group\",\"hd\":false},{\"ty\":\"tm\",\"s\":{\"a\":0,\"k\":0,\"ix\":1},\"e\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.7],\"y\":[1]},\"o\":{\"x\":[0.3],\"y\":[0]},\"t\":39,\"s\":[0]},{\"t\":65.23046875,\"s\":[100]}],\"ix\":2},\"o\":{\"a\":0,\"k\":0,\"ix\":3},\"m\":1,\"ix\":2,\"nm\":\" 1\",\"mn\":\"ADBE Vector Filter - Trim\",\"hd\":false}],\"ip\":0,\"op\":10823,\"st\":0,\"ct\":1,\"bm\":0},{\"ddd\":0,\"ind\":3,\"ty\":4,\"nm\":\" 4\",\"parent\":5,\"sr\":1,\"ks\":{\"o\":{\"a\":0,\"k\":100,\"ix\":11},\"r\":{\"a\":0,\"k\":0,\"ix\":10},\"p\":{\"a\":0,\"k\":[6.5,12,0],\"ix\":2,\"l\":2},\"a\":{\"a\":0,\"k\":[6.5,12,0],\"ix\":1,\"l\":2},\"s\":{\"a\":0,\"k\":[100,100,100],\"ix\":6,\"l\":2}},\"ao\":0,\"shapes\":[{\"ty\":\"gr\",\"it\":[{\"ind\":0,\"ty\":\"sh\",\"ix\":1,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[0,0]],\"o\":[[0,0],[0,0]],\"v\":[[6.5,12],[13,12]],\"c\":false},\"ix\":2},\"nm\":\" 1\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ty\":\"st\",\"c\":{\"a\":0,\"k\":[0.117647058824,0.588235294118,0.921568627451,1],\"ix\":3},\"o\":{\"a\":0,\"k\":100,\"ix\":4},\"w\":{\"a\":0,\"k\":1.5,\"ix\":5},\"lc\":2,\"lj\":2,\"bm\":0,\"nm\":\" 1\",\"mn\":\"ADBE Vector Graphic - Stroke\",\"hd\":false},{\"ty\":\"tr\",\"p\":{\"a\":0,\"k\":[0,0],\"ix\":2},\"a\":{\"a\":0,\"k\":[0,0],\"ix\":1},\"s\":{\"a\":0,\"k\":[100,100],\"ix\":3},\"r\":{\"a\":0,\"k\":0,\"ix\":6},\"o\":{\"a\":0,\"k\":100,\"ix\":7},\"sk\":{\"a\":0,\"k\":0,\"ix\":4},\"sa\":{\"a\":0,\"k\":0,\"ix\":5},\"nm\":\"\"}],\"nm\":\" 1\",\"np\":2,\"cix\":2,\"bm\":0,\"ix\":1,\"mn\":\"ADBE Vector Group\",\"hd\":false},{\"ty\":\"tm\",\"s\":{\"a\":0,\"k\":0,\"ix\":1},\"e\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.7],\"y\":[1]},\"o\":{\"x\":[0.3],\"y\":[0]},\"t\":27.332,\"s\":[0]},{\"t\":53.55078125,\"s\":[100]}],\"ix\":2},\"o\":{\"a\":0,\"k\":0,\"ix\":3},\"m\":1,\"ix\":2,\"nm\":\" 1\",\"mn\":\"ADBE Vector Filter - Trim\",\"hd\":false}],\"ip\":0,\"op\":10823,\"st\":0,\"ct\":1,\"bm\":0},{\"ddd\":0,\"ind\":4,\"ty\":4,\"nm\":\" 5\",\"parent\":5,\"sr\":1,\"ks\":{\"o\":{\"a\":0,\"k\":100,\"ix\":11},\"r\":{\"a\":0,\"k\":0,\"ix\":10},\"p\":{\"a\":0,\"k\":[6.5,8.5,0],\"ix\":2,\"l\":2},\"a\":{\"a\":0,\"k\":[6.5,8.5,0],\"ix\":1,\"l\":2},\"s\":{\"a\":0,\"k\":[100,100,100],\"ix\":6,\"l\":2}},\"ao\":0,\"shapes\":[{\"ty\":\"gr\",\"it\":[{\"ind\":0,\"ty\":\"sh\",\"ix\":1,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[0,0]],\"o\":[[0,0],[0,0]],\"v\":[[6.5,8.5],[7.5,8.5]],\"c\":false},\"ix\":2},\"nm\":\" 1\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ty\":\"st\",\"c\":{\"a\":0,\"k\":[0.117647058824,0.588235294118,0.921568627451,1],\"ix\":3},\"o\":{\"a\":0,\"k\":100,\"ix\":4},\"w\":{\"a\":0,\"k\":1.5,\"ix\":5},\"lc\":2,\"lj\":2,\"bm\":0,\"nm\":\" 1\",\"mn\":\"ADBE Vector Graphic - Stroke\",\"hd\":false},{\"ty\":\"tr\",\"p\":{\"a\":0,\"k\":[0,0],\"ix\":2},\"a\":{\"a\":0,\"k\":[0,0],\"ix\":1},\"s\":{\"a\":0,\"k\":[100,100],\"ix\":3},\"r\":{\"a\":0,\"k\":0,\"ix\":6},\"o\":{\"a\":0,\"k\":100,\"ix\":7},\"sk\":{\"a\":0,\"k\":0,\"ix\":4},\"sa\":{\"a\":0,\"k\":0,\"ix\":5},\"nm\":\"\"}],\"nm\":\" 1\",\"np\":2,\"cix\":2,\"bm\":0,\"ix\":1,\"mn\":\"ADBE Vector Group\",\"hd\":false}],\"ip\":0,\"op\":10823,\"st\":0,\"ct\":1,\"bm\":0},{\"ddd\":0,\"ind\":5,\"ty\":4,\"nm\":\" 6\",\"sr\":1,\"ks\":{\"o\":{\"a\":0,\"k\":100,\"ix\":11},\"r\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.833],\"y\":[0.833]},\"o\":{\"x\":[0.167],\"y\":[0.167]},\"t\":22.332,\"s\":[0]},{\"i\":{\"x\":[0.833],\"y\":[0.833]},\"o\":{\"x\":[0.167],\"y\":[0.167]},\"t\":29.832,\"s\":[3]},{\"i\":{\"x\":[0.833],\"y\":[0.833]},\"o\":{\"x\":[0.167],\"y\":[0.167]},\"t\":37.332,\"s\":[-3]},{\"i\":{\"x\":[0.833],\"y\":[0.833]},\"o\":{\"x\":[0.167],\"y\":[0.167]},\"t\":44.832,\"s\":[3]},{\"t\":52.33203125,\"s\":[0]}],\"ix\":10},\"p\":{\"a\":0,\"k\":[120,120,0],\"ix\":2,\"l\":2},\"a\":{\"a\":0,\"k\":[12,12,0],\"ix\":1,\"l\":2},\"s\":{\"a\":0,\"k\":[1000,1000,100],\"ix\":6,\"l\":2}},\"ao\":0,\"shapes\":[{\"ty\":\"gr\",\"it\":[{\"ind\":0,\"ty\":\"sh\",\"ix\":1,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[-0.828,0],[0,0],[0,-0.828],[0,0],[0.828,0],[0,0],[0,0.828]],\"o\":[[0,-0.828],[0,0],[0.828,0],[0,0],[0,0.828],[0,0],[-0.828,0],[0,0]],\"v\":[[-9,-5.5],[-7.5,-7],[7.5,-7],[9,-5.5],[9,5.5],[7.5,7],[-7.5,7],[-9,5.5]],\"c\":true},\"ix\":2},\"nm\":\" 1\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ty\":\"st\",\"c\":{\"a\":0,\"k\":[0.117647058824,0.588235294118,0.921568627451,1],\"ix\":3},\"o\":{\"a\":0,\"k\":100,\"ix\":4},\"w\":{\"a\":0,\"k\":1.5,\"ix\":5},\"lc\":1,\"lj\":2,\"bm\":0,\"nm\":\" 1\",\"mn\":\"ADBE Vector Graphic - Stroke\",\"hd\":false},{\"ty\":\"tr\",\"p\":{\"a\":0,\"k\":[12,12],\"ix\":2},\"a\":{\"a\":0,\"k\":[0,0],\"ix\":1},\"s\":{\"a\":0,\"k\":[100,100],\"ix\":3},\"r\":{\"a\":0,\"k\":0,\"ix\":6},\"o\":{\"a\":0,\"k\":100,\"ix\":7},\"sk\":{\"a\":0,\"k\":0,\"ix\":4},\"sa\":{\"a\":0,\"k\":0,\"ix\":5},\"nm\":\"\"}],\"nm\":\" 1\",\"np\":2,\"cix\":2,\"bm\":0,\"ix\":1,\"mn\":\"ADBE Vector Group\",\"hd\":false}],\"ip\":0,\"op\":10823,\"st\":0,\"ct\":1,\"bm\":0}],\"markers\":[],\"props\":{}}'\n  background=\"transparent\"\n  speed=\"1\"\n  style=\"width: 20px; height: 20px;\"\n  loop\n  autoplay\n></dotlottie-player>`;\n\nexport const AIMindMapIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"currentColor\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <g clip-path=\"url(#clip0_14287_43617)\">\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M8.71486 4.95829H8.12484C6.97424 4.95829 6.0415 5.89103 6.0415 7.04163C6.0415 8.0372 5.60504 8.93084 4.91302 9.54163H8.62426C8.87653 8.67493 9.67672 8.04158 10.6248 8.04158H15.2082C16.3588 8.04158 17.2915 8.97433 17.2915 10.1249C17.2915 11.2755 16.3588 12.2083 15.2082 12.2083H10.6248C9.70741 12.2083 8.92849 11.6152 8.65047 10.7916H4.91302C5.60504 11.4024 6.0415 12.296 6.0415 13.2916C6.0415 14.4422 6.97424 15.375 8.12484 15.375H8.58318C8.77621 14.424 9.61694 13.7083 10.6248 13.7083H15.2082C16.3588 13.7083 17.2915 14.641 17.2915 15.7916C17.2915 16.9422 16.3588 17.875 15.2082 17.875H10.6248C9.77054 17.875 9.03634 17.3608 8.71485 16.625H8.12484C6.28389 16.625 4.7915 15.1326 4.7915 13.2916C4.7915 12.141 3.85876 11.2083 2.70817 11.2083H1.6665V10.375V9.95829V9.12496H2.70817C3.85876 9.12496 4.7915 8.19222 4.7915 7.04163C4.7915 5.20068 6.28389 3.70829 8.12484 3.70829H8.58318C8.77621 2.75736 9.61694 2.04163 10.6248 2.04163H15.2082C16.3588 2.04163 17.2915 2.97437 17.2915 4.12496C17.2915 5.27555 16.3588 6.20829 15.2082 6.20829H10.6248C9.77054 6.20829 9.03634 5.69409 8.71486 4.95829ZM9.7915 4.12496C9.7915 3.66472 10.1646 3.29163 10.6248 3.29163H15.2082C15.6684 3.29163 16.0415 3.66472 16.0415 4.12496C16.0415 4.5852 15.6684 4.95829 15.2082 4.95829H10.6248C10.1646 4.95829 9.7915 4.5852 9.7915 4.12496ZM9.7915 10.1249C9.7915 9.66468 10.1646 9.29158 10.6248 9.29158H15.2082C15.6684 9.29158 16.0415 9.66468 16.0415 10.1249C16.0415 10.5852 15.6684 10.9583 15.2082 10.9583H10.6248C10.1646 10.9583 9.7915 10.5852 9.7915 10.1249ZM10.6248 14.9583C10.1646 14.9583 9.7915 15.3314 9.7915 15.7916C9.7915 16.2519 10.1646 16.625 10.6248 16.625H15.2082C15.6684 16.625 16.0415 16.2519 16.0415 15.7916C16.0415 15.3314 15.6684 14.9583 15.2082 14.9583H10.6248Z\"\n    />\n  </g>\n  <defs>\n    <clipPath id=\"clip0_14287_43617\">\n      <rect width=\"20\" height=\"20\" fill=\"white\" />\n    </clipPath>\n  </defs>\n</svg> `;\n\nexport const AIMindMapIconWithAnimation = html`<dotlottie-player\n  src='{\"v\":\"5.12.1\",\"fr\":120,\"ip\":0,\"op\":150,\"w\":240,\"h\":240,\"nm\":\"Mindmap\",\"ddd\":0,\"assets\":[],\"layers\":[{\"ddd\":0,\"ind\":1,\"ty\":4,\"nm\":\" 3\",\"sr\":1,\"ks\":{\"o\":{\"a\":0,\"k\":100,\"ix\":11},\"r\":{\"a\":0,\"k\":0,\"ix\":10},\"p\":{\"a\":0,\"k\":[120,120,0],\"ix\":2,\"l\":2},\"a\":{\"a\":0,\"k\":[0,0,0],\"ix\":1,\"l\":2},\"s\":{\"a\":0,\"k\":[100,100,100],\"ix\":6,\"l\":2}},\"ao\":0,\"shapes\":[{\"ty\":\"gr\",\"it\":[{\"ind\":0,\"ty\":\"sh\",\"ix\":1,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[0,0]],\"o\":[[0,0],[0,0]],\"v\":[[-95,1],[-11,1]],\"c\":false},\"ix\":2},\"nm\":\" 1\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ty\":\"st\",\"c\":{\"a\":0,\"k\":[0.117646998985,0.588234994926,0.921568986481,1],\"ix\":3},\"o\":{\"a\":0,\"k\":100,\"ix\":4},\"w\":{\"a\":0,\"k\":15,\"ix\":5},\"lc\":1,\"lj\":1,\"ml\":4,\"bm\":0,\"nm\":\" 1\",\"mn\":\"ADBE Vector Graphic - Stroke\",\"hd\":false},{\"ty\":\"tr\",\"p\":{\"a\":0,\"k\":[0,0],\"ix\":2},\"a\":{\"a\":0,\"k\":[0,0],\"ix\":1},\"s\":{\"a\":0,\"k\":[100,100],\"ix\":3},\"r\":{\"a\":0,\"k\":0,\"ix\":6},\"o\":{\"a\":0,\"k\":100,\"ix\":7},\"sk\":{\"a\":0,\"k\":0,\"ix\":4},\"sa\":{\"a\":0,\"k\":0,\"ix\":5},\"nm\":\"\"}],\"nm\":\" 1\",\"np\":3,\"cix\":2,\"bm\":0,\"ix\":1,\"mn\":\"ADBE Vector Group\",\"hd\":false}],\"ip\":0,\"op\":10823,\"st\":0,\"ct\":1,\"bm\":0},{\"ddd\":0,\"ind\":2,\"ty\":4,\"nm\":\" 2\",\"sr\":1,\"ks\":{\"o\":{\"a\":0,\"k\":100,\"ix\":11},\"r\":{\"a\":0,\"k\":0,\"ix\":10},\"p\":{\"a\":0,\"k\":[120,120,0],\"ix\":2,\"l\":2},\"a\":{\"a\":0,\"k\":[0,0,0],\"ix\":1,\"l\":2},\"s\":{\"a\":0,\"k\":[100,-100,100],\"ix\":6,\"l\":2}},\"ao\":0,\"shapes\":[{\"ty\":\"gr\",\"it\":[{\"ind\":0,\"ty\":\"sh\",\"ix\":1,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[-8.5,-0.25],[0,-7.778],[-3.135,-12.359],[-6.128,0],[-6.25,0]],\"o\":[[8.583,0],[7.775,0.229],[0,12.75],[1.507,5.94],[8.25,0],[0,0]],\"v\":[[-96,1.75],[-70.25,1.75],[-55,18.25],[-53.75,56.5],[-40.75,69.5],[-15.75,69.5]],\"c\":false},\"ix\":2},\"nm\":\" 1\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ty\":\"st\",\"c\":{\"a\":0,\"k\":[0.117646998985,0.588234994926,0.921568986481,1],\"ix\":3},\"o\":{\"a\":0,\"k\":100,\"ix\":4},\"w\":{\"a\":0,\"k\":15,\"ix\":5},\"lc\":1,\"lj\":2,\"bm\":0,\"nm\":\" 1\",\"mn\":\"ADBE Vector Graphic - Stroke\",\"hd\":false},{\"ty\":\"tr\",\"p\":{\"a\":0,\"k\":[0,-1.25],\"ix\":2},\"a\":{\"a\":0,\"k\":[0,0],\"ix\":1},\"s\":{\"a\":0,\"k\":[100,100],\"ix\":3},\"r\":{\"a\":0,\"k\":0,\"ix\":6},\"o\":{\"a\":0,\"k\":100,\"ix\":7},\"sk\":{\"a\":0,\"k\":0,\"ix\":4},\"sa\":{\"a\":0,\"k\":0,\"ix\":5},\"nm\":\"\"}],\"nm\":\" 1\",\"np\":3,\"cix\":2,\"bm\":0,\"ix\":1,\"mn\":\"ADBE Vector Group\",\"hd\":false},{\"ty\":\"tm\",\"s\":{\"a\":0,\"k\":0,\"ix\":1},\"e\":{\"a\":0,\"k\":100,\"ix\":2},\"o\":{\"a\":0,\"k\":0,\"ix\":3},\"m\":1,\"ix\":2,\"nm\":\" 1\",\"mn\":\"ADBE Vector Filter - Trim\",\"hd\":false}],\"ip\":0,\"op\":10823,\"st\":0,\"ct\":1,\"bm\":0},{\"ddd\":0,\"ind\":3,\"ty\":4,\"nm\":\" 1\",\"sr\":1,\"ks\":{\"o\":{\"a\":0,\"k\":100,\"ix\":11},\"r\":{\"a\":0,\"k\":0,\"ix\":10},\"p\":{\"a\":0,\"k\":[120,120,0],\"ix\":2,\"l\":2},\"a\":{\"a\":0,\"k\":[0,0,0],\"ix\":1,\"l\":2},\"s\":{\"a\":0,\"k\":[100,100,100],\"ix\":6,\"l\":2}},\"ao\":0,\"shapes\":[{\"ty\":\"gr\",\"it\":[{\"ind\":0,\"ty\":\"sh\",\"ix\":1,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[-8.5,-0.25],[0,-7.778],[-3.135,-12.359],[-6.128,0],[-6.25,0]],\"o\":[[8.583,0],[7.775,0.229],[0,12.75],[1.507,5.94],[8.25,0],[0,0]],\"v\":[[-96,1.75],[-70.25,1.75],[-55,18.25],[-53.75,56.5],[-40.75,69.5],[-15.75,69.5]],\"c\":false},\"ix\":2},\"nm\":\" 1\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ty\":\"st\",\"c\":{\"a\":0,\"k\":[0.117646998985,0.588234994926,0.921568986481,1],\"ix\":3},\"o\":{\"a\":0,\"k\":100,\"ix\":4},\"w\":{\"a\":0,\"k\":15,\"ix\":5},\"lc\":1,\"lj\":2,\"bm\":0,\"nm\":\" 1\",\"mn\":\"ADBE Vector Graphic - Stroke\",\"hd\":false},{\"ty\":\"tr\",\"p\":{\"a\":0,\"k\":[0,-1.25],\"ix\":2},\"a\":{\"a\":0,\"k\":[0,0],\"ix\":1},\"s\":{\"a\":0,\"k\":[100,100],\"ix\":3},\"r\":{\"a\":0,\"k\":0,\"ix\":6},\"o\":{\"a\":0,\"k\":100,\"ix\":7},\"sk\":{\"a\":0,\"k\":0,\"ix\":4},\"sa\":{\"a\":0,\"k\":0,\"ix\":5},\"nm\":\"\"}],\"nm\":\" 1\",\"np\":3,\"cix\":2,\"bm\":0,\"ix\":1,\"mn\":\"ADBE Vector Group\",\"hd\":false},{\"ty\":\"tm\",\"s\":{\"a\":0,\"k\":0,\"ix\":1},\"e\":{\"a\":0,\"k\":100,\"ix\":2},\"o\":{\"a\":0,\"k\":0,\"ix\":3},\"m\":1,\"ix\":2,\"nm\":\" 1\",\"mn\":\"ADBE Vector Filter - Trim\",\"hd\":false}],\"ip\":0,\"op\":10823,\"st\":0,\"ct\":1,\"bm\":0},{\"ddd\":0,\"ind\":4,\"ty\":4,\"nm\":\" 5 3\",\"sr\":1,\"ks\":{\"o\":{\"a\":0,\"k\":100,\"ix\":11},\"r\":{\"a\":0,\"k\":0,\"ix\":10},\"p\":{\"a\":0,\"k\":[154,51.5,0],\"ix\":2,\"l\":2},\"a\":{\"a\":0,\"k\":[15.5,18.95,0],\"ix\":1,\"l\":2},\"s\":{\"a\":0,\"k\":[1000,1000,100],\"ix\":6,\"l\":2}},\"ao\":0,\"shapes\":[{\"ty\":\"gr\",\"it\":[{\"ind\":0,\"ty\":\"sh\",\"ix\":1,\"ks\":{\"a\":0,\"k\":{\"i\":[[-0.966,0],[0,0],[0,-0.966],[0.967,0],[0,0],[0,0.967]],\"o\":[[0,0],[0.967,0],[0,0.967],[0,0],[-0.966,0],[0,-0.966]],\"v\":[[-2.75,-1.75],[2.75,-1.75],[4.5,0],[2.75,1.75],[-2.75,1.75],[-4.5,0]],\"c\":true},\"ix\":2},\"nm\":\" 1\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ty\":\"st\",\"c\":{\"a\":0,\"k\":[0.117647058824,0.588235294118,0.921568627451,1],\"ix\":3},\"o\":{\"a\":0,\"k\":100,\"ix\":4},\"w\":{\"a\":0,\"k\":1.5,\"ix\":5},\"lc\":2,\"lj\":2,\"bm\":0,\"nm\":\" 1\",\"mn\":\"ADBE Vector Graphic - Stroke\",\"hd\":false},{\"ty\":\"tr\",\"p\":{\"a\":0,\"k\":[15.5,18.95],\"ix\":2},\"a\":{\"a\":0,\"k\":[0,0],\"ix\":1},\"s\":{\"a\":0,\"k\":[100,100],\"ix\":3},\"r\":{\"a\":0,\"k\":0,\"ix\":6},\"o\":{\"a\":0,\"k\":100,\"ix\":7},\"sk\":{\"a\":0,\"k\":0,\"ix\":4},\"sa\":{\"a\":0,\"k\":0,\"ix\":5},\"nm\":\"\"}],\"nm\":\" 1\",\"np\":2,\"cix\":2,\"bm\":0,\"ix\":1,\"mn\":\"ADBE Vector Group\",\"hd\":false},{\"ty\":\"tm\",\"s\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.1],\"y\":[1]},\"o\":{\"x\":[0.5],\"y\":[0]},\"t\":0,\"s\":[38]},{\"t\":57,\"s\":[100]}],\"ix\":1},\"e\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.1],\"y\":[1]},\"o\":{\"x\":[0.5],\"y\":[0]},\"t\":0,\"s\":[38]},{\"t\":57,\"s\":[0]}],\"ix\":2},\"o\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.1],\"y\":[1]},\"o\":{\"x\":[0.5],\"y\":[0]},\"t\":0,\"s\":[180]},{\"t\":57,\"s\":[138]}],\"ix\":3},\"m\":1,\"ix\":2,\"nm\":\" 1\",\"mn\":\"ADBE Vector Filter - Trim\",\"hd\":false}],\"ip\":0,\"op\":10823,\"st\":0,\"ct\":1,\"bm\":0},{\"ddd\":0,\"ind\":5,\"ty\":4,\"nm\":\" 5 2\",\"sr\":1,\"ks\":{\"o\":{\"a\":0,\"k\":100,\"ix\":11},\"r\":{\"a\":0,\"k\":0,\"ix\":10},\"p\":{\"a\":0,\"k\":[154,120.5,0],\"ix\":2,\"l\":2},\"a\":{\"a\":0,\"k\":[15.5,18.95,0],\"ix\":1,\"l\":2},\"s\":{\"a\":0,\"k\":[1000,1000,100],\"ix\":6,\"l\":2}},\"ao\":0,\"shapes\":[{\"ty\":\"gr\",\"it\":[{\"ind\":0,\"ty\":\"sh\",\"ix\":1,\"ks\":{\"a\":0,\"k\":{\"i\":[[-0.966,0],[0,0],[0,-0.966],[0.967,0],[0,0],[0,0.967]],\"o\":[[0,0],[0.967,0],[0,0.967],[0,0],[-0.966,0],[0,-0.966]],\"v\":[[-2.75,-1.75],[2.75,-1.75],[4.5,0],[2.75,1.75],[-2.75,1.75],[-4.5,0]],\"c\":true},\"ix\":2},\"nm\":\" 1\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ty\":\"st\",\"c\":{\"a\":0,\"k\":[0.117647058824,0.588235294118,0.921568627451,1],\"ix\":3},\"o\":{\"a\":0,\"k\":100,\"ix\":4},\"w\":{\"a\":0,\"k\":1.5,\"ix\":5},\"lc\":2,\"lj\":2,\"bm\":0,\"nm\":\" 1\",\"mn\":\"ADBE Vector Graphic - Stroke\",\"hd\":false},{\"ty\":\"tr\",\"p\":{\"a\":0,\"k\":[15.5,18.95],\"ix\":2},\"a\":{\"a\":0,\"k\":[0,0],\"ix\":1},\"s\":{\"a\":0,\"k\":[100,100],\"ix\":3},\"r\":{\"a\":0,\"k\":0,\"ix\":6},\"o\":{\"a\":0,\"k\":100,\"ix\":7},\"sk\":{\"a\":0,\"k\":0,\"ix\":4},\"sa\":{\"a\":0,\"k\":0,\"ix\":5},\"nm\":\"\"}],\"nm\":\" 1\",\"np\":2,\"cix\":2,\"bm\":0,\"ix\":1,\"mn\":\"ADBE Vector Group\",\"hd\":false},{\"ty\":\"tm\",\"s\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.1],\"y\":[1]},\"o\":{\"x\":[0.5],\"y\":[0]},\"t\":12,\"s\":[38]},{\"t\":69,\"s\":[100]}],\"ix\":1},\"e\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.1],\"y\":[1]},\"o\":{\"x\":[0.5],\"y\":[0]},\"t\":12,\"s\":[38]},{\"t\":69,\"s\":[0]}],\"ix\":2},\"o\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.1],\"y\":[1]},\"o\":{\"x\":[0.5],\"y\":[0]},\"t\":12,\"s\":[180]},{\"t\":69,\"s\":[138]}],\"ix\":3},\"m\":1,\"ix\":2,\"nm\":\" 1\",\"mn\":\"ADBE Vector Filter - Trim\",\"hd\":false}],\"ip\":12,\"op\":10835,\"st\":12,\"ct\":1,\"bm\":0},{\"ddd\":0,\"ind\":6,\"ty\":4,\"nm\":\" 5\",\"sr\":1,\"ks\":{\"o\":{\"a\":0,\"k\":100,\"ix\":11},\"r\":{\"a\":0,\"k\":0,\"ix\":10},\"p\":{\"a\":0,\"k\":[154,189.5,0],\"ix\":2,\"l\":2},\"a\":{\"a\":0,\"k\":[15.5,18.95,0],\"ix\":1,\"l\":2},\"s\":{\"a\":0,\"k\":[1000,1000,100],\"ix\":6,\"l\":2}},\"ao\":0,\"shapes\":[{\"ty\":\"gr\",\"it\":[{\"ind\":0,\"ty\":\"sh\",\"ix\":1,\"ks\":{\"a\":0,\"k\":{\"i\":[[-0.966,0],[0,0],[0,-0.966],[0.967,0],[0,0],[0,0.967]],\"o\":[[0,0],[0.967,0],[0,0.967],[0,0],[-0.966,0],[0,-0.966]],\"v\":[[-2.75,-1.75],[2.75,-1.75],[4.5,0],[2.75,1.75],[-2.75,1.75],[-4.5,0]],\"c\":true},\"ix\":2},\"nm\":\" 1\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ty\":\"st\",\"c\":{\"a\":0,\"k\":[0.117647058824,0.588235294118,0.921568627451,1],\"ix\":3},\"o\":{\"a\":0,\"k\":100,\"ix\":4},\"w\":{\"a\":0,\"k\":1.5,\"ix\":5},\"lc\":2,\"lj\":2,\"bm\":0,\"nm\":\" 1\",\"mn\":\"ADBE Vector Graphic - Stroke\",\"hd\":false},{\"ty\":\"tr\",\"p\":{\"a\":0,\"k\":[15.5,18.95],\"ix\":2},\"a\":{\"a\":0,\"k\":[0,0],\"ix\":1},\"s\":{\"a\":0,\"k\":[100,100],\"ix\":3},\"r\":{\"a\":0,\"k\":0,\"ix\":6},\"o\":{\"a\":0,\"k\":100,\"ix\":7},\"sk\":{\"a\":0,\"k\":0,\"ix\":4},\"sa\":{\"a\":0,\"k\":0,\"ix\":5},\"nm\":\"\"}],\"nm\":\" 1\",\"np\":2,\"cix\":2,\"bm\":0,\"ix\":1,\"mn\":\"ADBE Vector Group\",\"hd\":false},{\"ty\":\"tm\",\"s\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.1],\"y\":[1]},\"o\":{\"x\":[0.5],\"y\":[0]},\"t\":23,\"s\":[38]},{\"t\":80,\"s\":[100]}],\"ix\":1},\"e\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.1],\"y\":[1]},\"o\":{\"x\":[0.5],\"y\":[0]},\"t\":23,\"s\":[38]},{\"t\":80,\"s\":[0]}],\"ix\":2},\"o\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.1],\"y\":[1]},\"o\":{\"x\":[0.5],\"y\":[0]},\"t\":23,\"s\":[180]},{\"t\":80,\"s\":[138]}],\"ix\":3},\"m\":1,\"ix\":2,\"nm\":\" 1\",\"mn\":\"ADBE Vector Filter - Trim\",\"hd\":false}],\"ip\":23,\"op\":10846,\"st\":23,\"ct\":1,\"bm\":0}],\"markers\":[],\"props\":{}}'\n  background=\"transparent\"\n  speed=\"1\"\n  style=\"width: 20px; height: 20px;\"\n  loop\n  autoplay\n></dotlottie-player>`;\n\nexport const AIExpandMindMapIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"currentColor\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <g clip-path=\"url(#clip0_14287_43641)\">\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M10.6248 3.75C9.67672 3.75 8.87653 4.38335 8.62426 5.25004H7.30376C6.03811 5.25004 5.01209 6.27605 5.01209 7.54171V8.37504C5.01209 8.95034 4.54572 9.41671 3.97043 9.41671H1.6665V10.6667H3.97043C4.54572 10.6667 5.01209 11.1331 5.01209 11.7084V12.5417C5.01209 13.8074 6.03811 14.8334 7.30376 14.8334H8.65047C8.92849 15.657 9.70741 16.25 10.6248 16.25H15.2082C16.3588 16.25 17.2915 15.3173 17.2915 14.1667C17.2915 13.0161 16.3588 12.0833 15.2082 12.0833H10.6248C9.67672 12.0833 8.87653 12.7167 8.62426 13.5834H7.30376C6.72846 13.5834 6.26209 13.117 6.26209 12.5417V11.7084C6.26209 11.0517 5.98589 10.4595 5.54332 10.0417C5.98589 9.62389 6.26209 9.03172 6.26209 8.37504V7.54171C6.26209 6.96641 6.72846 6.50004 7.30376 6.50004H8.65047C8.92849 7.32366 9.70741 7.91667 10.6248 7.91667H15.2082C16.3588 7.91667 17.2915 6.98393 17.2915 5.83333C17.2915 4.68274 16.3588 3.75 15.2082 3.75H10.6248ZM9.7915 5.83333C9.7915 5.3731 10.1646 5 10.6248 5H15.2082C15.6684 5 16.0415 5.3731 16.0415 5.83333C16.0415 6.29357 15.6684 6.66667 15.2082 6.66667H10.6248C10.1646 6.66667 9.7915 6.29357 9.7915 5.83333ZM9.7915 14.1667C9.7915 13.7064 10.1646 13.3333 10.6248 13.3333H15.2082C15.6684 13.3333 16.0415 13.7064 16.0415 14.1667C16.0415 14.6269 15.6684 15 15.2082 15H10.6248C10.1646 15 9.7915 14.6269 9.7915 14.1667Z\"\n    />\n  </g>\n  <defs>\n    <clipPath id=\"clip0_14287_43641\">\n      <rect width=\"20\" height=\"20\" fill=\"white\" />\n    </clipPath>\n  </defs>\n</svg> `;\n\nexport const AIFindActionsIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"currentColor\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <path\n    fill-rule=\"evenodd\"\n    clip-rule=\"evenodd\"\n    d=\"M3.125 7.91667C3.125 5.2703 5.2703 3.125 7.91667 3.125C10.563 3.125 12.7083 5.2703 12.7083 7.91667C12.7083 10.563 10.563 12.7083 7.91667 12.7083C5.2703 12.7083 3.125 10.563 3.125 7.91667ZM7.91667 1.875C4.57995 1.875 1.875 4.57995 1.875 7.91667C1.875 11.2534 4.57995 13.9583 7.91667 13.9583C9.35991 13.9583 10.685 13.4523 11.724 12.6079L16.2247 17.1086C16.4688 17.3527 16.8645 17.3527 17.1086 17.1086C17.3527 16.8645 17.3527 16.4688 17.1086 16.2247L12.6079 11.724C13.4523 10.685 13.9583 9.35991 13.9583 7.91667C13.9583 4.57995 11.2534 1.875 7.91667 1.875Z\"\n  />\n</svg> `;\n\nexport const AIImageIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"none\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <g clip-path=\"url(#clip0_14287_69586)\">\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M5.00016 2.70837C3.73451 2.70837 2.7085 3.73439 2.7085 5.00004V13.3334V15C2.7085 16.2657 3.73451 17.2917 5.00016 17.2917H15.0002C16.2658 17.2917 17.2918 16.2657 17.2918 15V11.6667V5.00004C17.2918 3.73439 16.2658 2.70837 15.0002 2.70837H5.00016ZM3.9585 15V13.5923L7.59693 9.95383C8.00372 9.54703 8.66327 9.54703 9.07007 9.95383L11.2249 12.1086L12.8916 13.7753C13.1356 14.0194 13.5314 14.0194 13.7754 13.7753C14.0195 13.5312 14.0195 13.1355 13.7754 12.8914L12.5507 11.6667L13.4303 10.7872C13.8371 10.3804 14.4966 10.3804 14.9034 10.7872L16.0418 11.9256V15C16.0418 15.5753 15.5755 16.0417 15.0002 16.0417H5.00016C4.42487 16.0417 3.9585 15.5753 3.9585 15ZM9.95395 9.06994L11.6668 10.7828L12.5464 9.90328C13.4413 9.00833 14.8923 9.00832 15.7873 9.90328L16.0418 10.1578V5.00004C16.0418 4.42474 15.5755 3.95837 15.0002 3.95837H5.00016C4.42487 3.95837 3.9585 4.42474 3.9585 5.00004V11.8245L6.71304 9.06994C7.60799 8.17499 9.059 8.17499 9.95395 9.06994ZM11.6668 7.50004C12.1271 7.50004 12.5002 7.12694 12.5002 6.66671C12.5002 6.20647 12.1271 5.83337 11.6668 5.83337C11.2066 5.83337 10.8335 6.20647 10.8335 6.66671C10.8335 7.12694 11.2066 7.50004 11.6668 7.50004Z\"\n      fill=\"#1E96EB\"\n    />\n  </g>\n  <defs>\n    <clipPath id=\"clip0_14287_69586\">\n      <rect width=\"20\" height=\"20\" fill=\"white\" />\n    </clipPath>\n  </defs>\n</svg> `;\n\nexport const AIImageIconWithAnimation = html`<dotlottie-player\n  src='{\"v\":\"5.12.1\",\"fr\":120,\"ip\":0,\"op\":276,\"w\":240,\"h\":240,\"nm\":\"Image\",\"ddd\":0,\"assets\":[],\"layers\":[{\"ddd\":0,\"ind\":1,\"ty\":4,\"nm\":\"moon\",\"sr\":1,\"ks\":{\"o\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.667],\"y\":[1]},\"o\":{\"x\":[0.333],\"y\":[0]},\"t\":49.984,\"s\":[0]},{\"i\":{\"x\":[0.667],\"y\":[1]},\"o\":{\"x\":[0.333],\"y\":[0]},\"t\":61.34,\"s\":[100]},{\"i\":{\"x\":[0.667],\"y\":[1]},\"o\":{\"x\":[0.333],\"y\":[0]},\"t\":157.852,\"s\":[100]},{\"t\":167.58203125,\"s\":[0]}],\"ix\":11},\"r\":{\"a\":0,\"k\":0,\"ix\":10},\"p\":{\"a\":1,\"k\":[{\"i\":{\"x\":0.667,\"y\":0.652},\"o\":{\"x\":0.333,\"y\":0},\"t\":42.684,\"s\":[145,145.5,0],\"to\":[0,-14.667,0],\"ti\":[0,12.917,0]},{\"i\":{\"x\":0.667,\"y\":1},\"o\":{\"x\":0.333,\"y\":0.595},\"t\":73.027,\"s\":[145,57.5,0],\"to\":[0,-12.917,0],\"ti\":[0,-1.75,0]},{\"i\":{\"x\":0.667,\"y\":0.667},\"o\":{\"x\":0.333,\"y\":0.333},\"t\":84.047,\"s\":[145,68,0],\"to\":[0,0,0],\"ti\":[0,0,0]},{\"i\":{\"x\":0.667,\"y\":0.405},\"o\":{\"x\":0.333,\"y\":0},\"t\":137.574,\"s\":[145,68,0],\"to\":[0,-1.75,0],\"ti\":[0,-12.917,0]},{\"i\":{\"x\":0.667,\"y\":1},\"o\":{\"x\":0.333,\"y\":0.348},\"t\":146.863,\"s\":[145,57.5,0],\"to\":[0,12.917,0],\"ti\":[0,-14.667,0]},{\"t\":172.44921875,\"s\":[145,145.5,0]}],\"ix\":2,\"l\":2},\"a\":{\"a\":0,\"k\":[0.947,2,0],\"ix\":1,\"l\":2},\"s\":{\"a\":0,\"k\":[1800,1800,100],\"ix\":6,\"l\":2}},\"ao\":0,\"shapes\":[{\"ty\":\"gr\",\"it\":[{\"ind\":0,\"ty\":\"sh\",\"ix\":1,\"ks\":{\"a\":0,\"k\":{\"i\":[[-0.164,0.327],[0,0.567],[-0.016,0.08],[0.008,0],[0,-0.552],[-0.552,0]],\"o\":[[-0.517,-0.153],[0,-0.085],[-0.008,0],[-0.552,0],[0,0.553],[0.391,0]],\"v\":[[0.947,0.449],[0.053,-0.75],[0.078,-0.999],[0.053,-1],[-0.947,0],[0.053,1]],\"c\":true},\"ix\":2},\"nm\":\" 1\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ty\":\"fl\",\"c\":{\"a\":0,\"k\":[0.117647058824,0.588235294118,0.921568627451,1],\"ix\":4},\"o\":{\"a\":0,\"k\":100,\"ix\":5},\"r\":1,\"bm\":0,\"nm\":\" 1\",\"mn\":\"ADBE Vector Graphic - Fill\",\"hd\":false},{\"ty\":\"tr\",\"p\":{\"a\":0,\"k\":[0.947,2],\"ix\":2},\"a\":{\"a\":0,\"k\":[0,0],\"ix\":1},\"s\":{\"a\":0,\"k\":[100,100],\"ix\":3},\"r\":{\"a\":0,\"k\":0,\"ix\":6},\"o\":{\"a\":0,\"k\":100,\"ix\":7},\"sk\":{\"a\":0,\"k\":0,\"ix\":4},\"sa\":{\"a\":0,\"k\":0,\"ix\":5},\"nm\":\"\"}],\"nm\":\" 1\",\"np\":2,\"cix\":2,\"bm\":0,\"ix\":1,\"mn\":\"ADBE Vector Group\",\"hd\":false}],\"ip\":0,\"op\":8400,\"st\":0,\"ct\":1,\"bm\":0},{\"ddd\":0,\"ind\":2,\"ty\":4,\"nm\":\"sun\",\"parent\":3,\"sr\":1,\"ks\":{\"o\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.667],\"y\":[1]},\"o\":{\"x\":[0.333],\"y\":[0]},\"t\":20.789,\"s\":[100]},{\"i\":{\"x\":[0.667],\"y\":[1]},\"o\":{\"x\":[0.333],\"y\":[0]},\"t\":32.141,\"s\":[0]},{\"i\":{\"x\":[0.667],\"y\":[1]},\"o\":{\"x\":[0.333],\"y\":[0]},\"t\":182.18,\"s\":[0]},{\"t\":195.96875,\"s\":[100]}],\"ix\":11},\"r\":{\"a\":0,\"k\":0,\"ix\":10},\"p\":{\"a\":1,\"k\":[{\"i\":{\"x\":0.667,\"y\":0.405},\"o\":{\"x\":0.333,\"y\":0},\"t\":7,\"s\":[11,5,0],\"to\":[0,-0.128,0],\"ti\":[0,-0.987,0]},{\"i\":{\"x\":0.667,\"y\":1},\"o\":{\"x\":0.333,\"y\":0.346},\"t\":16.234,\"s\":[11,4.231,0],\"to\":[0,0.987,0],\"ti\":[0,-1.115,0]},{\"i\":{\"x\":0.667,\"y\":0.667},\"o\":{\"x\":0.333,\"y\":0.333},\"t\":41.875,\"s\":[11,10.923,0],\"to\":[0,0,0],\"ti\":[0,0,0]},{\"i\":{\"x\":0.667,\"y\":0.654},\"o\":{\"x\":0.333,\"y\":0},\"t\":171.637,\"s\":[11,10.923,0],\"to\":[0,-1.115,0],\"ti\":[0,0.987,0]},{\"i\":{\"x\":0.667,\"y\":1},\"o\":{\"x\":0.333,\"y\":0.595},\"t\":202.051,\"s\":[11,4.231,0],\"to\":[0,-0.987,0],\"ti\":[0,-0.128,0]},{\"t\":213,\"s\":[11,5,0]}],\"ix\":2,\"l\":2},\"a\":{\"a\":0,\"k\":[11,5,0],\"ix\":1,\"l\":2},\"s\":{\"a\":0,\"k\":[134.615,134.615,100],\"ix\":6,\"l\":2}},\"ao\":0,\"shapes\":[{\"ty\":\"gr\",\"it\":[{\"ind\":0,\"ty\":\"sh\",\"ix\":1,\"ks\":{\"a\":0,\"k\":{\"i\":[[-0.552,0],[0,-0.552],[0.552,0],[0,0.552]],\"o\":[[0.552,0],[0,0.552],[-0.552,0],[0,-0.552]],\"v\":[[0,-1],[1,0],[0,1],[-1,0]],\"c\":true},\"ix\":2},\"nm\":\" 1\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ty\":\"fl\",\"c\":{\"a\":0,\"k\":[0.117647058824,0.588235294118,0.921568627451,1],\"ix\":4},\"o\":{\"a\":0,\"k\":100,\"ix\":5},\"r\":1,\"bm\":0,\"nm\":\" 1\",\"mn\":\"ADBE Vector Graphic - Fill\",\"hd\":false},{\"ty\":\"tr\",\"p\":{\"a\":0,\"k\":[11,5],\"ix\":2},\"a\":{\"a\":0,\"k\":[0,0],\"ix\":1},\"s\":{\"a\":0,\"k\":[100,100],\"ix\":3},\"r\":{\"a\":0,\"k\":0,\"ix\":6},\"o\":{\"a\":0,\"k\":100,\"ix\":7},\"sk\":{\"a\":0,\"k\":0,\"ix\":4},\"sa\":{\"a\":0,\"k\":0,\"ix\":5},\"nm\":\"\"}],\"nm\":\" 1\",\"np\":2,\"cix\":2,\"bm\":0,\"ix\":1,\"mn\":\"ADBE Vector Group\",\"hd\":false}],\"ip\":0,\"op\":8594,\"st\":0,\"ct\":1,\"bm\":0},{\"ddd\":0,\"ind\":3,\"ty\":4,\"nm\":\"bg\",\"sr\":1,\"ks\":{\"o\":{\"a\":0,\"k\":100,\"ix\":11},\"r\":{\"a\":0,\"k\":0,\"ix\":10},\"p\":{\"a\":0,\"k\":[120,120,0],\"ix\":2,\"l\":2},\"a\":{\"a\":0,\"k\":[9,9,0],\"ix\":1,\"l\":2},\"s\":{\"a\":0,\"k\":[1300,1300,100],\"ix\":6,\"l\":2}},\"ao\":0,\"shapes\":[{\"ty\":\"gr\",\"it\":[{\"ind\":0,\"ty\":\"sh\",\"ix\":1,\"ks\":{\"a\":0,\"k\":{\"i\":[[-1.105,0],[0,0],[0,1.105],[0,0],[1.105,0],[0,0],[0,-1.105],[0,0]],\"o\":[[0,0],[1.105,0],[0,0],[0,-1.105],[0,0],[-1.105,0],[0,0],[0,1.105]],\"v\":[[-6,8],[6,8],[8,6],[8,-6],[6,-8],[-6,-8],[-8,-6],[-8,6]],\"c\":true},\"ix\":2},\"nm\":\" 1\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ind\":1,\"ty\":\"sh\",\"ix\":2,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[0,0],[-0.781,-0.781],[0,0]],\"o\":[[0,0],[0.781,-0.781],[0,0],[0,0]],\"v\":[[2,2],[3.586,0.414],[6.414,0.414],[8,2]],\"c\":false},\"ix\":2},\"nm\":\" 2\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ind\":2,\"ty\":\"sh\",\"ix\":3,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[0,0],[-0.781,-0.781],[0,0]],\"o\":[[0,0],[0.781,-0.781],[0,0],[0,0]],\"v\":[[-8,4],[-3.414,-0.586],[-0.586,-0.586],[4,4]],\"c\":false},\"ix\":2},\"nm\":\" 3\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ty\":\"mm\",\"mm\":1,\"nm\":\" 1\",\"mn\":\"ADBE Vector Filter - Merge\",\"hd\":false},{\"ty\":\"st\",\"c\":{\"a\":0,\"k\":[0.117647058824,0.588235294118,0.921568627451,1],\"ix\":3},\"o\":{\"a\":0,\"k\":100,\"ix\":4},\"w\":{\"a\":0,\"k\":1.5,\"ix\":5},\"lc\":2,\"lj\":2,\"bm\":0,\"nm\":\" 1\",\"mn\":\"ADBE Vector Graphic - Stroke\",\"hd\":false},{\"ty\":\"tr\",\"p\":{\"a\":0,\"k\":[9,9],\"ix\":2},\"a\":{\"a\":0,\"k\":[0,0],\"ix\":1},\"s\":{\"a\":0,\"k\":[100,100],\"ix\":3},\"r\":{\"a\":0,\"k\":0,\"ix\":6},\"o\":{\"a\":0,\"k\":100,\"ix\":7},\"sk\":{\"a\":0,\"k\":0,\"ix\":4},\"sa\":{\"a\":0,\"k\":0,\"ix\":5},\"nm\":\"\"}],\"nm\":\" 1\",\"np\":5,\"cix\":2,\"bm\":0,\"ix\":1,\"mn\":\"ADBE Vector Group\",\"hd\":false}],\"ip\":0,\"op\":8400,\"st\":0,\"ct\":1,\"bm\":0}],\"markers\":[],\"props\":{}}'\n  background=\"transparent\"\n  speed=\"1\"\n  style=\"width: 20px; height: 20px;\"\n  loop\n  autoplay\n></dotlottie-player>`;\n\nexport const ChatWithAIIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"currentColor\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <path\n    fill-rule=\"evenodd\"\n    clip-rule=\"evenodd\"\n    d=\"M3.12926 6.59386C2.2839 5.82997 2.79173 4.375 3.97096 4.375H15.8351C16.8185 4.375 17.3998 5.44049 16.9328 6.27292L11.1139 16.6458C10.543 17.6636 9.04423 17.4269 8.78738 16.306L7.45823 10.5057L3.12926 6.59386ZM8.73556 10.4835L10.0058 16.0268C10.0075 16.0342 10.0092 16.0381 10.01 16.0396C10.011 16.0401 10.013 16.041 10.0161 16.0414C10.0172 16.0416 10.0182 16.0417 10.0191 16.0417C10.0202 16.0401 10.0218 16.0377 10.0238 16.0343L15.26 6.70001L8.73556 10.4835ZM14.622 5.625H3.97096C3.96952 5.625 3.96831 5.62504 3.96732 5.6251C3.96581 5.62713 3.96365 5.63059 3.96169 5.63585C3.95772 5.64646 3.95838 5.65425 3.95884 5.65639C3.95897 5.65699 3.95903 5.65711 3.95919 5.65738L3.9592 5.6574C3.95926 5.6575 3.961 5.66071 3.96732 5.66642L8.10424 9.40467L14.622 5.625Z\"\n  />\n</svg> `;\n\nexport const MakeItRealIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"currentColor\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <path\n    fill-rule=\"evenodd\"\n    clip-rule=\"evenodd\"\n    d=\"M1.89506 9.08909C1.36098 9.73568 1.85634 10.7079 2.69338 10.6559L5.70784 10.4685L7.3281 13.0174C7.77801 13.7251 8.85573 13.5545 9.06491 12.7423L9.63712 10.5207L15.8083 16.6918C16.0524 16.9359 16.4481 16.9359 16.6922 16.6918C16.9362 16.4477 16.9362 16.052 16.6922 15.8079L10.5208 9.63654L12.743 9.06417C13.5552 8.855 13.7259 7.77728 13.0181 7.32737L10.4692 5.7071L10.6566 2.69265C10.7086 1.85562 9.73642 1.36024 9.08982 1.89433L6.76121 3.81777L3.9522 2.70805C3.17221 2.39991 2.40064 3.17147 2.70878 3.95147L3.8185 6.76048L1.89506 9.08909ZM5.80215 9.21024L3.28715 9.36656L4.8919 7.42377C5.11419 7.15466 5.17258 6.78598 5.04433 6.46135L4.11848 4.11775L6.46208 5.0436C6.78671 5.17185 7.15539 5.11346 7.4245 4.89117L9.36729 3.28642L9.21097 5.80142C9.18931 6.14979 9.35878 6.48238 9.65335 6.66963L11.7799 8.02144L9.33969 8.64995C9.00168 8.737 8.73774 9.00095 8.65068 9.33896L8.02217 11.7792L6.67036 9.65261C6.48312 9.35805 6.15052 9.18858 5.80215 9.21024Z\"\n  />\n</svg> `;\n\nexport const MakeItRealIconWithAnimation = html`<dotlottie-player\n  src='{\"v\":\"5.12.1\",\"fr\":60,\"ip\":0,\"op\":120,\"w\":240,\"h\":240,\"nm\":\"Make it real\",\"ddd\":0,\"assets\":[],\"layers\":[{\"ddd\":0,\"ind\":1,\"ty\":4,\"nm\":\" 2 3\",\"sr\":1,\"ks\":{\"o\":{\"a\":0,\"k\":100,\"ix\":11},\"r\":{\"a\":0,\"k\":0,\"ix\":10},\"p\":{\"a\":0,\"k\":[201.5,91.5,0],\"ix\":2,\"l\":2},\"a\":{\"a\":0,\"k\":[13,13,0],\"ix\":1,\"l\":2},\"s\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.7,0.7,0.7],\"y\":[1,1,1]},\"o\":{\"x\":[0.3,0.3,0.3],\"y\":[0,0,0]},\"t\":17,\"s\":[0,0,100]},{\"i\":{\"x\":[0.7,0.7,0.7],\"y\":[1,1,1]},\"o\":{\"x\":[0.3,0.3,0.3],\"y\":[0,0,0]},\"t\":29,\"s\":[160,160,100]},{\"i\":{\"x\":[0.7,0.7,0.7],\"y\":[1,1,1]},\"o\":{\"x\":[0.3,0.3,0.3],\"y\":[0,0,0]},\"t\":46,\"s\":[160,160,100]},{\"t\":61,\"s\":[0,0,100]}],\"ix\":6,\"l\":2}},\"ao\":0,\"shapes\":[{\"ty\":\"gr\",\"it\":[{\"ind\":0,\"ty\":\"sh\",\"ix\":1,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],\"o\":[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],\"v\":[[-0.001,-13],[-2.04,-2.041],[-13.001,0.001],[-2.04,2.041],[-0.001,13],[2.04,2.041],[13.001,0.001],[2.04,-2.041]],\"c\":true},\"ix\":2},\"nm\":\" 1\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ty\":\"fl\",\"c\":{\"a\":0,\"k\":[0.117647066303,0.588235294118,0.921568687289,1],\"ix\":4},\"o\":{\"a\":0,\"k\":100,\"ix\":5},\"r\":1,\"bm\":0,\"nm\":\" 1\",\"mn\":\"ADBE Vector Graphic - Fill\",\"hd\":false},{\"ty\":\"tr\",\"p\":{\"a\":0,\"k\":[13,13],\"ix\":2},\"a\":{\"a\":0,\"k\":[0,0],\"ix\":1},\"s\":{\"a\":0,\"k\":[100,100],\"ix\":3},\"r\":{\"a\":0,\"k\":0,\"ix\":6},\"o\":{\"a\":0,\"k\":100,\"ix\":7},\"sk\":{\"a\":0,\"k\":0,\"ix\":4},\"sa\":{\"a\":0,\"k\":0,\"ix\":5},\"nm\":\"\"}],\"nm\":\" 1\",\"np\":2,\"cix\":2,\"bm\":0,\"ix\":1,\"mn\":\"ADBE Vector Group\",\"hd\":false},{\"ty\":\"gr\",\"it\":[{\"ty\":\"fl\",\"c\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.833],\"y\":[0.833]},\"o\":{\"x\":[0.167],\"y\":[0.167]},\"t\":17,\"s\":[0.376470595598,0.811764717102,0.980392158031,1]},{\"i\":{\"x\":[0.833],\"y\":[0.833]},\"o\":{\"x\":[0.167],\"y\":[0.167]},\"t\":29,\"s\":[0.117647066303,0.588235294118,0.921568687289,1]},{\"i\":{\"x\":[0.833],\"y\":[0.833]},\"o\":{\"x\":[0.167],\"y\":[0.167]},\"t\":46,\"s\":[0.117647066303,0.588235294118,0.921568687289,1]},{\"t\":61,\"s\":[0.376470595598,0.811764717102,0.980392158031,1]}],\"ix\":4},\"o\":{\"a\":0,\"k\":100,\"ix\":5},\"r\":1,\"bm\":0,\"nm\":\" 1\",\"mn\":\"ADBE Vector Graphic - Fill\",\"hd\":false},{\"ty\":\"tr\",\"p\":{\"a\":0,\"k\":[0,0],\"ix\":2},\"a\":{\"a\":0,\"k\":[0,0],\"ix\":1},\"s\":{\"a\":0,\"k\":[100,100],\"ix\":3},\"r\":{\"a\":0,\"k\":0,\"ix\":6},\"o\":{\"a\":0,\"k\":100,\"ix\":7},\"sk\":{\"a\":0,\"k\":0,\"ix\":4},\"sa\":{\"a\":0,\"k\":0,\"ix\":5},\"nm\":\"\"}],\"nm\":\" 2\",\"np\":1,\"cix\":2,\"bm\":0,\"ix\":2,\"mn\":\"ADBE Vector Group\",\"hd\":false}],\"ip\":0,\"op\":18060,\"st\":0,\"ct\":1,\"bm\":0},{\"ddd\":0,\"ind\":2,\"ty\":4,\"nm\":\" 2 2\",\"sr\":1,\"ks\":{\"o\":{\"a\":0,\"k\":100,\"ix\":11},\"r\":{\"a\":0,\"k\":0,\"ix\":10},\"p\":{\"a\":0,\"k\":[79,28,0],\"ix\":2,\"l\":2},\"a\":{\"a\":0,\"k\":[13,13,0],\"ix\":1,\"l\":2},\"s\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.7,0.7,0.7],\"y\":[1,1,1]},\"o\":{\"x\":[0.3,0.3,0.3],\"y\":[0,0,0]},\"t\":31,\"s\":[0,0,100]},{\"i\":{\"x\":[0.7,0.7,0.7],\"y\":[1,1,1]},\"o\":{\"x\":[0.3,0.3,0.3],\"y\":[0,0,0]},\"t\":43,\"s\":[120,120,100]},{\"i\":{\"x\":[0.7,0.7,0.7],\"y\":[1,1,1]},\"o\":{\"x\":[0.3,0.3,0.3],\"y\":[0,0,0]},\"t\":60,\"s\":[120,120,100]},{\"t\":75,\"s\":[0,0,100]}],\"ix\":6,\"l\":2}},\"ao\":0,\"shapes\":[{\"ty\":\"gr\",\"it\":[{\"ind\":0,\"ty\":\"sh\",\"ix\":1,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],\"o\":[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],\"v\":[[-0.001,-13],[-2.04,-2.041],[-13.001,0.001],[-2.04,2.041],[-0.001,13],[2.04,2.041],[13.001,0.001],[2.04,-2.041]],\"c\":true},\"ix\":2},\"nm\":\" 1\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ty\":\"fl\",\"c\":{\"a\":0,\"k\":[0.117647066303,0.588235294118,0.921568687289,1],\"ix\":4},\"o\":{\"a\":0,\"k\":100,\"ix\":5},\"r\":1,\"bm\":0,\"nm\":\" 1\",\"mn\":\"ADBE Vector Graphic - Fill\",\"hd\":false},{\"ty\":\"tr\",\"p\":{\"a\":0,\"k\":[13,13],\"ix\":2},\"a\":{\"a\":0,\"k\":[0,0],\"ix\":1},\"s\":{\"a\":0,\"k\":[100,100],\"ix\":3},\"r\":{\"a\":0,\"k\":0,\"ix\":6},\"o\":{\"a\":0,\"k\":100,\"ix\":7},\"sk\":{\"a\":0,\"k\":0,\"ix\":4},\"sa\":{\"a\":0,\"k\":0,\"ix\":5},\"nm\":\"\"}],\"nm\":\" 1\",\"np\":2,\"cix\":2,\"bm\":0,\"ix\":1,\"mn\":\"ADBE Vector Group\",\"hd\":false},{\"ty\":\"gr\",\"it\":[{\"ty\":\"fl\",\"c\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.833],\"y\":[0.833]},\"o\":{\"x\":[0.167],\"y\":[0.167]},\"t\":31,\"s\":[0.376470595598,0.811764717102,0.980392158031,1]},{\"i\":{\"x\":[0.833],\"y\":[0.833]},\"o\":{\"x\":[0.167],\"y\":[0.167]},\"t\":43,\"s\":[0.117647066303,0.588235294118,0.921568687289,1]},{\"i\":{\"x\":[0.833],\"y\":[0.833]},\"o\":{\"x\":[0.167],\"y\":[0.167]},\"t\":60,\"s\":[0.117647066303,0.588235294118,0.921568687289,1]},{\"t\":75,\"s\":[0.376470595598,0.811764717102,0.980392158031,1]}],\"ix\":4},\"o\":{\"a\":0,\"k\":100,\"ix\":5},\"r\":1,\"bm\":0,\"nm\":\" 1\",\"mn\":\"ADBE Vector Graphic - Fill\",\"hd\":false},{\"ty\":\"tr\",\"p\":{\"a\":0,\"k\":[0,0],\"ix\":2},\"a\":{\"a\":0,\"k\":[0,0],\"ix\":1},\"s\":{\"a\":0,\"k\":[100,100],\"ix\":3},\"r\":{\"a\":0,\"k\":0,\"ix\":6},\"o\":{\"a\":0,\"k\":100,\"ix\":7},\"sk\":{\"a\":0,\"k\":0,\"ix\":4},\"sa\":{\"a\":0,\"k\":0,\"ix\":5},\"nm\":\"\"}],\"nm\":\" 2\",\"np\":1,\"cix\":2,\"bm\":0,\"ix\":2,\"mn\":\"ADBE Vector Group\",\"hd\":false}],\"ip\":0,\"op\":18060,\"st\":0,\"ct\":1,\"bm\":0},{\"ddd\":0,\"ind\":3,\"ty\":4,\"nm\":\" 2\",\"sr\":1,\"ks\":{\"o\":{\"a\":0,\"k\":100,\"ix\":11},\"r\":{\"a\":0,\"k\":0,\"ix\":10},\"p\":{\"a\":0,\"k\":[47,191,0],\"ix\":2,\"l\":2},\"a\":{\"a\":0,\"k\":[13,13,0],\"ix\":1,\"l\":2},\"s\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.7,0.7,0.7],\"y\":[1,1,1]},\"o\":{\"x\":[0.3,0.3,0.3],\"y\":[0,0,0]},\"t\":10,\"s\":[0,0,100]},{\"i\":{\"x\":[0.7,0.7,0.7],\"y\":[1,1,1]},\"o\":{\"x\":[0.3,0.3,0.3],\"y\":[0,0,0]},\"t\":22,\"s\":[200,200,100]},{\"i\":{\"x\":[0.7,0.7,0.7],\"y\":[1,1,1]},\"o\":{\"x\":[0.3,0.3,0.3],\"y\":[0,0,0]},\"t\":39,\"s\":[200,200,100]},{\"t\":54,\"s\":[0,0,100]}],\"ix\":6,\"l\":2}},\"ao\":0,\"shapes\":[{\"ty\":\"gr\",\"it\":[{\"ind\":0,\"ty\":\"sh\",\"ix\":1,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],\"o\":[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],\"v\":[[-0.001,-13],[-2.04,-2.041],[-13.001,0.001],[-2.04,2.041],[-0.001,13],[2.04,2.041],[13.001,0.001],[2.04,-2.041]],\"c\":true},\"ix\":2},\"nm\":\" 1\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ty\":\"fl\",\"c\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.833],\"y\":[0.833]},\"o\":{\"x\":[0.167],\"y\":[0.167]},\"t\":10,\"s\":[0.376470595598,0.811764717102,0.980392158031,1]},{\"i\":{\"x\":[0.833],\"y\":[0.833]},\"o\":{\"x\":[0.167],\"y\":[0.167]},\"t\":22,\"s\":[0.117647066303,0.588235294118,0.921568687289,1]},{\"i\":{\"x\":[0.833],\"y\":[0.833]},\"o\":{\"x\":[0.167],\"y\":[0.167]},\"t\":39,\"s\":[0.117647066303,0.588235294118,0.921568687289,1]},{\"t\":54,\"s\":[0.376470595598,0.811764717102,0.980392158031,1]}],\"ix\":4},\"o\":{\"a\":0,\"k\":100,\"ix\":5},\"r\":1,\"bm\":0,\"nm\":\" 1\",\"mn\":\"ADBE Vector Graphic - Fill\",\"hd\":false},{\"ty\":\"tr\",\"p\":{\"a\":0,\"k\":[13,13],\"ix\":2},\"a\":{\"a\":0,\"k\":[0,0],\"ix\":1},\"s\":{\"a\":0,\"k\":[100,100],\"ix\":3},\"r\":{\"a\":0,\"k\":0,\"ix\":6},\"o\":{\"a\":0,\"k\":100,\"ix\":7},\"sk\":{\"a\":0,\"k\":0,\"ix\":4},\"sa\":{\"a\":0,\"k\":0,\"ix\":5},\"nm\":\"\"}],\"nm\":\" 1\",\"np\":2,\"cix\":2,\"bm\":0,\"ix\":1,\"mn\":\"ADBE Vector Group\",\"hd\":false}],\"ip\":0,\"op\":18060,\"st\":0,\"ct\":1,\"bm\":0},{\"ddd\":0,\"ind\":4,\"ty\":4,\"nm\":\" 3\",\"sr\":1,\"ks\":{\"o\":{\"a\":0,\"k\":100,\"ix\":11},\"r\":{\"a\":1,\"k\":[{\"i\":{\"x\":[0.3],\"y\":[1]},\"o\":{\"x\":[0.167],\"y\":[0.099]},\"t\":0,\"s\":[0]},{\"i\":{\"x\":[0.3],\"y\":[1]},\"o\":{\"x\":[0.167],\"y\":[0.112]},\"t\":9.428,\"s\":[8]},{\"i\":{\"x\":[0.3],\"y\":[1]},\"o\":{\"x\":[0.167],\"y\":[0.124]},\"t\":21.215,\"s\":[-8]},{\"i\":{\"x\":[0.3],\"y\":[1]},\"o\":{\"x\":[0.167],\"y\":[0.167]},\"t\":30.799,\"s\":[5]},{\"i\":{\"x\":[0.3],\"y\":[1]},\"o\":{\"x\":[0.167],\"y\":[0.167]},\"t\":37.4,\"s\":[-3]},{\"t\":44,\"s\":[0]}],\"ix\":10},\"p\":{\"a\":0,\"k\":[198.999,200.999,0],\"ix\":2,\"l\":2},\"a\":{\"a\":0,\"k\":[19.5,19.5,0],\"ix\":1,\"l\":2},\"s\":{\"a\":0,\"k\":[1000,1000,100],\"ix\":6,\"l\":2}},\"ao\":0,\"shapes\":[{\"ty\":\"gr\",\"it\":[{\"ind\":0,\"ty\":\"sh\",\"ix\":1,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[-0.223,0.27],[0,0],[0.054,0.135],[0,0],[-0.326,-0.129],[0,0],[-0.112,0.092],[0,0],[0.022,-0.349],[0,0],[-0.123,-0.078],[0,0],[0.339,-0.087],[0,0],[0.036,-0.141],[0,0],[0.188,0.295],[0,0],[0.145,-0.009]],\"o\":[[-0.349,0.022],[0,0],[0.092,-0.112],[0,0],[-0.129,-0.326],[0,0],[0.135,0.054],[0,0],[0.27,-0.223],[0,0],[-0.009,0.145],[0,0],[0.295,0.188],[0,0],[-0.141,0.036],[0,0],[-0.087,0.339],[0,0],[-0.078,-0.123],[0,0]],\"v\":[[-5.887,2.967],[-6.219,2.314],[-3.779,-0.641],[-3.717,-1.042],[-5.124,-4.605],[-4.605,-5.124],[-1.042,-3.717],[-0.641,-3.779],[2.314,-6.219],[2.967,-5.887],[2.73,-2.062],[2.915,-1.701],[6.148,0.355],[6.033,1.079],[2.322,2.036],[2.036,2.322],[1.079,6.033],[0.355,6.148],[-1.701,2.915],[-2.062,2.73]],\"c\":true},\"ix\":2},\"nm\":\" 1\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ty\":\"st\",\"c\":{\"a\":0,\"k\":[0.117647066303,0.588235294118,0.921568687289,1],\"ix\":3},\"o\":{\"a\":0,\"k\":100,\"ix\":4},\"w\":{\"a\":0,\"k\":1.5,\"ix\":5},\"lc\":1,\"lj\":1,\"ml\":4,\"bm\":0,\"nm\":\" 1\",\"mn\":\"ADBE Vector Graphic - Stroke\",\"hd\":false},{\"ty\":\"tr\",\"p\":{\"a\":0,\"k\":[9.072,9.071],\"ix\":2},\"a\":{\"a\":0,\"k\":[0,0],\"ix\":1},\"s\":{\"a\":0,\"k\":[100,100],\"ix\":3},\"r\":{\"a\":0,\"k\":0,\"ix\":6},\"o\":{\"a\":0,\"k\":100,\"ix\":7},\"sk\":{\"a\":0,\"k\":0,\"ix\":4},\"sa\":{\"a\":0,\"k\":0,\"ix\":5},\"nm\":\"\"}],\"nm\":\" 1\",\"np\":2,\"cix\":2,\"bm\":0,\"ix\":1,\"mn\":\"ADBE Vector Group\",\"hd\":false},{\"ty\":\"gr\",\"it\":[{\"ind\":0,\"ty\":\"sh\",\"ix\":1,\"ks\":{\"a\":0,\"k\":{\"i\":[[0,0],[0,0]],\"o\":[[0,0],[0,0]],\"v\":[[-3.762,-3.762],[3.762,3.762]],\"c\":false},\"ix\":2},\"nm\":\" 1\",\"mn\":\"ADBE Vector Shape - Group\",\"hd\":false},{\"ty\":\"st\",\"c\":{\"a\":0,\"k\":[0.117647066303,0.588235294118,0.921568687289,1],\"ix\":3},\"o\":{\"a\":0,\"k\":100,\"ix\":4},\"w\":{\"a\":0,\"k\":1.5,\"ix\":5},\"lc\":2,\"lj\":1,\"ml\":4,\"bm\":0,\"nm\":\" 1\",\"mn\":\"ADBE Vector Graphic - Stroke\",\"hd\":false},{\"ty\":\"tr\",\"p\":{\"a\":0,\"k\":[15.737,15.737],\"ix\":2},\"a\":{\"a\":0,\"k\":[0,0],\"ix\":1},\"s\":{\"a\":0,\"k\":[100,100],\"ix\":3},\"r\":{\"a\":0,\"k\":0,\"ix\":6},\"o\":{\"a\":0,\"k\":100,\"ix\":7},\"sk\":{\"a\":0,\"k\":0,\"ix\":4},\"sa\":{\"a\":0,\"k\":0,\"ix\":5},\"nm\":\"\"}],\"nm\":\" 2\",\"np\":2,\"cix\":2,\"bm\":0,\"ix\":2,\"mn\":\"ADBE Vector Group\",\"hd\":false}],\"ip\":0,\"op\":18060,\"st\":0,\"ct\":1,\"bm\":0}],\"markers\":[],\"props\":{}}'\n  background=\"transparent\"\n  speed=\"1\"\n  style=\"width: 20px; height: 20px;\"\n  loop\n  autoplay\n></dotlottie-player>`;\n\nexport const ArrowDownIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"none\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <path\n    d=\"M10.9581 12.6095C10.7175 13.0188 10.1159 13.0188 9.87523 12.6095L7.16803 8.00422C6.92739 7.59487 7.22819 7.08317 7.70947 7.08317L13.1239 7.08317C13.6051 7.08317 13.9059 7.59487 13.6653 8.00422L10.9581 12.6095Z\"\n    fill=\"#77757D\"\n    fill-opacity=\"0.6\"\n  />\n</svg> `;\n\nexport const ArrowUpIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"none\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <path\n    d=\"M10.9581 6.97352C10.7175 6.56416 10.1159 6.56416 9.87523 6.97352L7.16803 11.5788C6.92739 11.9881 7.22819 12.4998 7.70947 12.4998H13.1239C13.6051 12.4998 13.9059 11.9881 13.6653 11.5788L10.9581 6.97352Z\"\n    fill=\"#77757D\"\n    fill-opacity=\"0.6\"\n  />\n</svg> `;\n\nexport const DiscardIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"currentColor\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <path\n    fill-rule=\"evenodd\"\n    clip-rule=\"evenodd\"\n    d=\"M9.16667 1.87512C7.90101 1.87512 6.875 2.90114 6.875 4.16679V5.12504H3.33333C2.94213 5.12504 2.625 5.44217 2.625 5.83337C2.625 6.22458 2.94213 6.54171 3.33333 6.54171H3.59066L4.26602 15.9967C4.35168 17.196 5.34957 18.1251 6.55186 18.1251H13.4481C14.6504 18.1251 15.6483 17.196 15.734 15.9967L16.4093 6.54171H16.6667C17.0579 6.54171 17.375 6.22458 17.375 5.83337C17.375 5.44217 17.0579 5.12504 16.6667 5.12504H13.125V4.16679C13.125 2.90114 12.099 1.87512 10.8333 1.87512H9.16667ZM11.875 5.12504V4.16679C11.875 3.59149 11.4086 3.12512 10.8333 3.12512H9.16667C8.59137 3.12512 8.125 3.59149 8.125 4.16679V5.12504H11.875ZM15.1562 6.54171H4.84385L5.51285 15.9077C5.55178 16.4528 6.00537 16.8751 6.55186 16.8751H13.4481C13.9946 16.8751 14.4482 16.4528 14.4872 15.9077L15.1562 6.54171ZM8.95833 9.16679C8.95833 8.82161 8.67851 8.54179 8.33333 8.54179C7.98815 8.54179 7.70833 8.82161 7.70833 9.16679V14.1668C7.70833 14.512 7.98815 14.7918 8.33333 14.7918C8.67851 14.7918 8.95833 14.512 8.95833 14.1668V9.16679ZM11.6667 8.54179C12.0118 8.54179 12.2917 8.82161 12.2917 9.16679V14.1668C12.2917 14.512 12.0118 14.7918 11.6667 14.7918C11.3215 14.7918 11.0417 14.512 11.0417 14.1668V9.16679C11.0417 8.82161 11.3215 8.54179 11.6667 8.54179Z\"\n  />\n</svg>`;\n\nexport const ErrorTipIcon = html`<svg\n  width=\"16\"\n  height=\"16\"\n  viewBox=\"0 0 16 16\"\n  fill=\"none\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <path\n    fill-rule=\"evenodd\"\n    clip-rule=\"evenodd\"\n    d=\"M7.99984 3.16699C5.33046 3.16699 3.1665 5.33095 3.1665 8.00033C3.1665 10.6697 5.33046 12.8337 7.99984 12.8337C10.6692 12.8337 12.8332 10.6697 12.8332 8.00033C12.8332 5.33095 10.6692 3.16699 7.99984 3.16699ZM2.1665 8.00033C2.1665 4.77866 4.77818 2.16699 7.99984 2.16699C11.2215 2.16699 13.8332 4.77866 13.8332 8.00033C13.8332 11.222 11.2215 13.8337 7.99984 13.8337C4.77818 13.8337 2.1665 11.222 2.1665 8.00033ZM7.99984 5.12996C8.27598 5.12996 8.49984 5.35381 8.49984 5.62996V8.00033C8.49984 8.27647 8.27598 8.50033 7.99984 8.50033C7.72369 8.50033 7.49984 8.27647 7.49984 8.00033V5.62996C7.49984 5.35381 7.72369 5.12996 7.99984 5.12996ZM7.49984 10.3707C7.49984 10.0946 7.72369 9.8707 7.99984 9.8707H8.00576C8.28191 9.8707 8.50576 10.0946 8.50576 10.3707C8.50576 10.6468 8.28191 10.8707 8.00576 10.8707H7.99984C7.72369 10.8707 7.49984 10.6468 7.49984 10.3707Z\"\n    fill=\"#EB4335\"\n  />\n</svg>`;\n\nexport const CopyIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"none\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <g clip-path=\"url(#clip0_9512_250387)\">\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M2.70801 4.99967C2.70801 3.73402 3.73402 2.70801 4.99967 2.70801H11.6663C12.932 2.70801 13.958 3.73402 13.958 4.99967V6.04134H14.9997C16.2653 6.04134 17.2913 7.06736 17.2913 8.33301V14.9997C17.2913 16.2653 16.2653 17.2913 14.9997 17.2913H8.33301C7.06736 17.2913 6.04134 16.2653 6.04134 14.9997V13.958H4.99967C3.73402 13.958 2.70801 12.932 2.70801 11.6663V4.99967ZM7.29134 14.9997C7.29134 15.575 7.75771 16.0413 8.33301 16.0413H14.9997C15.575 16.0413 16.0413 15.575 16.0413 14.9997V8.33301C16.0413 7.75771 15.575 7.29134 14.9997 7.29134H8.33301C7.75771 7.29134 7.29134 7.75771 7.29134 8.33301V14.9997ZM12.708 6.04134H8.33301C7.06736 6.04134 6.04134 7.06736 6.04134 8.33301V12.708H4.99967C4.42438 12.708 3.95801 12.2416 3.95801 11.6663V4.99967C3.95801 4.42438 4.42438 3.95801 4.99967 3.95801H11.6663C12.2416 3.95801 12.708 4.42438 12.708 4.99967V6.04134Z\"\n      fill=\"#77757D\"\n    />\n  </g>\n  <defs>\n    <clipPath id=\"clip0_9512_250387\">\n      <rect width=\"20\" height=\"20\" fill=\"white\" />\n    </clipPath>\n  </defs>\n</svg> `;\n\nexport const RetryIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"currentColor\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <path\n    fill-rule=\"evenodd\"\n    clip-rule=\"evenodd\"\n    d=\"M2.70837 9.99998C2.70837 5.9729 5.97296 2.70831 10 2.70831C11.8672 2.70831 13.5717 3.41091 14.8613 4.56514L14.8633 4.56693L16.0417 5.63077V3.33331C16.0417 2.98814 16.3215 2.70831 16.6667 2.70831C17.0119 2.70831 17.2917 2.98814 17.2917 3.33331V7.03702C17.2917 7.38219 17.0119 7.66202 16.6667 7.66202H12.963C12.6178 7.66202 12.338 7.38219 12.338 7.03702C12.338 6.69184 12.6178 6.41202 12.963 6.41202H15.0417L14.0277 5.49656C14.0273 5.49626 14.027 5.49597 14.0267 5.49567C12.9575 4.53915 11.5473 3.95831 10 3.95831C6.66332 3.95831 3.95837 6.66326 3.95837 9.99998C3.95837 13.3367 6.66332 16.0416 10 16.0416C12.8745 16.0416 15.2815 14.0336 15.892 11.3432C15.9684 11.0065 16.3032 10.7956 16.6398 10.872C16.9764 10.9483 17.1874 11.2831 17.111 11.6198C16.3742 14.8671 13.471 17.2916 10 17.2916C5.97296 17.2916 2.70837 14.0271 2.70837 9.99998Z\"\n  />\n</svg> `;\n\nexport const MoreIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"none\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <g clip-path=\"url(#clip0_12805_40201)\">\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M3.75 9.99992C3.75 10.7965 4.39574 11.4422 5.19231 11.4422C5.98887 11.4422 6.63462 10.7965 6.63462 9.99992C6.63462 9.20336 5.98887 8.55762 5.19231 8.55762C4.39574 8.55762 3.75 9.20336 3.75 9.99992ZM10 11.4422C9.20343 11.4422 8.55769 10.7965 8.55769 9.99992C8.55769 9.20336 9.20343 8.55762 10 8.55762C10.7966 8.55762 11.4423 9.20336 11.4423 9.99992C11.4423 10.7965 10.7966 11.4422 10 11.4422ZM14.8077 11.4422C14.0111 11.4422 13.3654 10.7965 13.3654 9.99992C13.3654 9.20336 14.0111 8.55762 14.8077 8.55762C15.6043 8.55762 16.25 9.20336 16.25 9.99992C16.25 10.7965 15.6043 11.4422 14.8077 11.4422Z\"\n      fill=\"#77757D\"\n    />\n  </g>\n  <defs>\n    <clipPath id=\"clip0_12805_40201\">\n      <rect width=\"20\" height=\"20\" fill=\"white\" />\n    </clipPath>\n  </defs>\n</svg> `;\n\nexport const ArticleIcon = html`<svg\n  width=\"16\"\n  height=\"16\"\n  viewBox=\"0 0 16 16\"\n  fill=\"none\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <g clip-path=\"url(#clip0_9181_12018)\">\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M6.00011 1.5C6.27625 1.5 6.50011 1.72386 6.50011 2V2.83333H8.49141C8.49729 2.83323 8.5032 2.83323 8.50912 2.83333H10.0001C10.2763 2.83333 10.5001 3.05719 10.5001 3.33333C10.5001 3.60948 10.2763 3.83333 10.0001 3.83333H8.91664C8.53113 5.73215 7.7155 7.47425 6.57605 8.95378C6.80344 9.19092 7.04564 9.40915 7.30011 9.6C7.52102 9.76569 7.5658 10.0791 7.40011 10.3C7.23443 10.5209 6.92102 10.5657 6.70011 10.4C6.42978 10.1973 6.17292 9.96996 5.93126 9.72506C4.88654 10.8777 3.62976 11.8344 2.22263 12.5337C1.97534 12.6566 1.67525 12.5558 1.55235 12.3085C1.42946 12.0612 1.5303 11.7611 1.77759 11.6382C3.10849 10.9768 4.29295 10.0653 5.26956 8.96521C4.56973 8.05833 4.05689 7.03164 3.795 6.14106C3.71709 5.87614 3.8687 5.59822 4.13363 5.52031C4.39855 5.4424 4.67647 5.59401 4.75438 5.85894C4.96704 6.58212 5.37415 7.4132 5.91912 8.16428C6.85773 6.89511 7.54132 5.42617 7.89438 3.83333H2.33344C2.0573 3.83333 1.83344 3.60948 1.83344 3.33333C1.83344 3.05719 2.0573 2.83333 2.33344 2.83333H5.50011V2C5.50011 1.72386 5.72397 1.5 6.00011 1.5ZM10.6668 6.83333C10.8562 6.83333 11.0293 6.94033 11.114 7.10973L13.4428 11.7674C13.4461 11.7736 13.4492 11.7798 13.4522 11.7861L14.4473 13.7764C14.5708 14.0234 14.4707 14.3237 14.2237 14.4472C13.9767 14.5707 13.6764 14.4706 13.5529 14.2236L12.6911 12.5H8.64246L7.78066 14.2236C7.65716 14.4706 7.35683 14.5707 7.10984 14.4472C6.86285 14.3237 6.76274 14.0234 6.88623 13.7764L7.88139 11.7861C7.88437 11.7798 7.88749 11.7736 7.89072 11.7674L10.2196 7.10973C10.3043 6.94033 10.4774 6.83333 10.6668 6.83333ZM9.14246 11.5H12.1911L10.6668 8.45137L9.14246 11.5Z\"\n      fill=\"#77757D\"\n    />\n  </g>\n  <defs>\n    <clipPath id=\"clip0_9181_12018\">\n      <rect width=\"16\" height=\"16\" fill=\"white\" />\n    </clipPath>\n  </defs>\n</svg> `;\n\nexport const MindmapIcon = html`<svg\n  width=\"16\"\n  height=\"16\"\n  viewBox=\"0 0 16 16\"\n  fill=\"none\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <g clip-path=\"url(#clip0_9181_2174)\">\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M6.97267 3.96663H5.66732C5.20708 3.96663 4.83398 4.33973 4.83398 4.79997V6.66667C4.83398 6.96672 4.7619 7.24995 4.6341 7.49996H6.94524C7.18611 6.87594 7.79168 6.43327 8.50065 6.43327H12.1673C13.0878 6.43327 13.834 7.17946 13.834 8.09993C13.834 9.02041 13.0878 9.7666 12.1673 9.7666H8.50065C7.71807 9.7666 7.06147 9.22723 6.8823 8.49996H4.63406C4.76188 8.74999 4.83398 9.03324 4.83398 9.33333V11.2057C4.83398 11.6659 5.20708 12.039 5.66732 12.039H6.94305C7.18243 11.412 7.78953 10.9666 8.50065 10.9666H12.1673C13.0878 10.9666 13.834 11.7128 13.834 12.6333C13.834 13.5538 13.0878 14.3 12.1673 14.3H8.50065C7.72011 14.3 7.0649 13.7634 6.88371 13.039H5.66732C4.6548 13.039 3.83398 12.2182 3.83398 11.2057V9.33333C3.83398 8.8731 3.46089 8.5 3.00065 8.5L1.33398 8.5V8.49996V7.5V7.49996H3.00897C3.46538 7.49549 3.83398 7.12413 3.83398 6.66667V4.79997C3.83398 3.78745 4.6548 2.96663 5.66732 2.96663H6.86732C7.02175 2.20589 7.69433 1.6333 8.50065 1.6333H12.1673C13.0878 1.6333 13.834 2.37949 13.834 3.29997C13.834 4.22044 13.0878 4.96663 12.1673 4.96663H8.50065C7.81721 4.96663 7.22985 4.55527 6.97267 3.96663ZM7.83398 3.29997C7.83398 2.93178 8.13246 2.6333 8.50065 2.6333H12.1673C12.5355 2.6333 12.834 2.93178 12.834 3.29997C12.834 3.66816 12.5355 3.96663 12.1673 3.96663H8.50065C8.13246 3.96663 7.83398 3.66816 7.83398 3.29997ZM7.83398 8.09993C7.83398 7.73175 8.13246 7.43327 8.50065 7.43327H12.1673C12.5355 7.43327 12.834 7.73174 12.834 8.09993C12.834 8.46812 12.5355 8.7666 12.1673 8.7666H8.50065C8.13246 8.7666 7.83398 8.46812 7.83398 8.09993ZM8.50065 11.9666C8.13246 11.9666 7.83398 12.2651 7.83398 12.6333C7.83398 13.0015 8.13246 13.3 8.50065 13.3H12.1673C12.5355 13.3 12.834 13.0015 12.834 12.6333C12.834 12.2651 12.5355 11.9666 12.1673 11.9666H8.50065Z\"\n      fill=\"#77757D\"\n    />\n  </g>\n  <defs>\n    <clipPath id=\"clip0_9181_2174\">\n      <rect width=\"16\" height=\"16\" fill=\"white\" />\n    </clipPath>\n  </defs>\n</svg> `;\n\nexport const PreloadImageIcon = html`<svg\n  width=\"16\"\n  height=\"16\"\n  viewBox=\"0 0 16 16\"\n  fill=\"none\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <g clip-path=\"url(#clip0_9181_11778)\">\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M3.99935 2.16675C2.98683 2.16675 2.16602 2.98756 2.16602 4.00008V10.6667V12.0001C2.16602 13.0126 2.98683 13.8334 3.99935 13.8334H11.9993C13.0119 13.8334 13.8327 13.0126 13.8327 12.0001V9.33341V4.00008C13.8327 2.98756 13.0119 2.16675 11.9993 2.16675H3.99935ZM3.16602 12.0001V10.8739L6.07676 7.96311C6.4022 7.63767 6.92983 7.63767 7.25527 7.96311L8.97913 9.68697L10.3125 11.0203C10.5077 11.2156 10.8243 11.2156 11.0196 11.0203C11.2148 10.825 11.2148 10.5085 11.0196 10.3132L10.0398 9.33341L10.7434 8.62978C11.0689 8.30434 11.5965 8.30434 11.9219 8.62978L12.8327 9.54052V12.0001C12.8327 12.4603 12.4596 12.8334 11.9993 12.8334H3.99935C3.53911 12.8334 3.16602 12.4603 3.16602 12.0001ZM7.96238 7.256L9.33268 8.62631L10.0363 7.92267C10.7523 7.20671 11.9131 7.20671 12.629 7.92267L12.8327 8.12631V4.00008C12.8327 3.53984 12.4596 3.16675 11.9993 3.16675H3.99935C3.53911 3.16675 3.16602 3.53984 3.16602 4.00008V9.45964L5.36965 7.256C6.08561 6.54004 7.24642 6.54004 7.96238 7.256ZM9.33268 6.00008C9.70087 6.00008 9.99935 5.7016 9.99935 5.33341C9.99935 4.96522 9.70087 4.66675 9.33268 4.66675C8.96449 4.66675 8.66602 4.96522 8.66602 5.33341C8.66602 5.7016 8.96449 6.00008 9.33268 6.00008Z\"\n      fill=\"#77757D\"\n    />\n  </g>\n  <defs>\n    <clipPath id=\"clip0_9181_11778\">\n      <rect width=\"16\" height=\"16\" fill=\"white\" />\n    </clipPath>\n  </defs>\n</svg> `;\n\nexport const PreloadPenIcon = html`<svg\n  width=\"16\"\n  height=\"16\"\n  viewBox=\"0 0 16 16\"\n  fill=\"none\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <path\n    fill-rule=\"evenodd\"\n    clip-rule=\"evenodd\"\n    d=\"M12.8531 3.14728C12.4335 2.72857 11.7529 2.72857 11.3334 3.14728L10.7436 3.73597L12.2618 5.25127L12.8531 4.66119C13.2721 4.24302 13.2721 3.56545 12.8531 3.14728ZM11.554 5.95768L10.0357 4.44238L2.83398 11.63V13.1666H4.33088L11.554 5.95768ZM10.627 2.43948C11.4369 1.63118 12.7496 1.63118 13.5595 2.43948C14.3699 3.24833 14.3699 4.56014 13.5595 5.36899L4.8909 14.0205C4.79716 14.1141 4.67013 14.1666 4.53769 14.1666H2.33398C2.05784 14.1666 1.83398 13.9428 1.83398 13.6666V11.4226C1.83398 11.2898 1.8868 11.1625 1.98078 11.0687L10.627 2.43948Z\"\n    fill=\"#77757D\"\n  />\n</svg> `;\n\nexport const CommunicateIcon = html`<svg\n  width=\"16\"\n  height=\"16\"\n  viewBox=\"0 0 16 16\"\n  fill=\"none\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <g clip-path=\"url(#clip0_9181_1783)\">\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M2.5038 5.27509C1.82751 4.66398 2.23378 3.5 3.17716 3.5H12.6684C13.4552 3.5 13.9202 4.35239 13.5466 5.01833L8.89155 13.3167C8.43479 14.1309 7.23578 13.9415 7.0303 13.0448L5.96697 8.40452L2.5038 5.27509ZM6.98884 8.38683L8.00503 12.8214C8.00639 12.8273 8.00778 12.8305 8.00839 12.8317C8.00918 12.8321 8.01076 12.8328 8.01323 12.8331C8.01418 12.8333 8.01499 12.8333 8.01564 12.8333C8.01657 12.8321 8.01786 12.8302 8.0194 12.8274L12.2084 5.36001L6.98884 8.38683ZM11.698 4.5H3.17716C3.17601 4.5 3.17504 4.50003 3.17425 4.50008C3.17304 4.50171 3.17131 4.50447 3.16974 4.50868C3.16657 4.51717 3.1671 4.5234 3.16746 4.52511C3.16756 4.52559 3.16762 4.52568 3.16774 4.5259L3.16775 4.52592C3.1678 4.526 3.16919 4.52857 3.17425 4.53314L6.48378 7.52374L11.698 4.5Z\"\n      fill=\"#77757D\"\n    />\n  </g>\n  <defs>\n    <clipPath id=\"clip0_9181_1783\">\n      <rect width=\"16\" height=\"16\" fill=\"white\" />\n    </clipPath>\n  </defs>\n</svg> `;\n\nexport const CommentIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"currentColor\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <path\n    fill-rule=\"evenodd\"\n    clip-rule=\"evenodd\"\n    d=\"M10.4167 3.125C6.84987 3.125 3.95837 6.01649 3.95837 9.58333C3.95837 10.5626 4.1759 11.4893 4.56469 12.3193C4.62513 12.4484 4.64581 12.5938 4.62202 12.7365L4.09372 15.9063L7.26351 15.378C7.40628 15.3542 7.55167 15.3749 7.68071 15.4354C8.51071 15.8241 9.43744 16.0417 10.4167 16.0417C13.9835 16.0417 16.875 13.1502 16.875 9.58333C16.875 6.01649 13.9835 3.125 10.4167 3.125ZM2.70837 9.58333C2.70837 5.32614 6.15951 1.875 10.4167 1.875C14.6739 1.875 18.125 5.32614 18.125 9.58333C18.125 13.8405 14.6739 17.2917 10.4167 17.2917C9.31104 17.2917 8.25828 17.0585 7.30619 16.6382L3.5512 17.264C3.07179 17.3439 2.65615 16.9283 2.73606 16.4488L3.36189 12.6939C2.94154 11.7418 2.70837 10.689 2.70837 9.58333Z\"\n  />\n</svg>`;\n\nexport const BlockIcon = html`<svg\n  width=\"20\"\n  height=\"20\"\n  viewBox=\"0 0 20 20\"\n  fill=\"currentColor\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n>\n  <path\n    fill-rule=\"evenodd\"\n    clip-rule=\"evenodd\"\n    d=\"M9.7495 2.34391C9.9092 2.27404 10.0908 2.27404 10.2505 2.34391L16.9172 5.26057C17.1447 5.3601 17.2917 5.58486 17.2917 5.83317V14.1665C17.2917 14.4148 17.1447 14.6396 16.9172 14.7391L10.2505 17.6558C10.0908 17.7256 9.9092 17.7256 9.7495 17.6558L3.08283 14.7391C2.85534 14.6396 2.70834 14.4148 2.70834 14.1665V5.83317C2.70834 5.58486 2.85534 5.3601 3.08283 5.26057L9.7495 2.34391ZM3.95834 6.78881V13.7577L9.37501 16.1275V9.1586L3.95834 6.78881ZM10.625 9.1586V16.1275L16.0417 13.7577V6.78881L10.625 9.1586ZM15.1074 5.83317L10 8.06764L4.89265 5.83317L10 3.5987L15.1074 5.83317Z\"\n  />\n</svg>`;\n","export const EXCLUDING_COPY_ACTIONS = [\n  'brainstormMindmap',\n  'expandMindmap',\n  'makeItReal',\n  'createSlides',\n  'createImage',\n  'findActions',\n  'filterImage',\n  'processImage',\n];\n\nexport const EXCLUDING_INSERT_ACTIONS = ['generateCaption'];\n\nexport const IMAGE_ACTIONS = ['createImage', 'processImage', 'filterImage'];\n\nconst commonImageStages = ['Generating image', 'Rendering image'];\n\nexport const generatingStages: {\n  [key in keyof Partial<BlockSuitePresets.AIActions>]: string[];\n} = {\n  makeItReal: ['Coding for you', 'Rendering the code'],\n  brainstormMindmap: ['Thinking about this topic', 'Rendering mindmap'],\n  createSlides: ['Thinking about this topic', 'Rendering slides'],\n  createImage: commonImageStages,\n  processImage: commonImageStages,\n  filterImage: commonImageStages,\n};\n\nexport const INSERT_ABOVE_ACTIONS = ['createHeadings'];\n","import { PageEditorBlockSpecs, PageRootService } from '@blocksuite/blocks';\nimport { literal } from 'lit/static-html.js';\n\n/**\n * Custom PageRootService that does not load fonts\n */\nclass CustomPageRootService extends PageRootService {\n  override loadFonts() {}\n}\n\nexport const CustomPageEditorBlockSpecs = PageEditorBlockSpecs.map(spec => {\n  if (spec.schema.model.flavour === 'affine:page') {\n    return {\n      ...spec,\n      service: CustomPageRootService,\n      view: {\n        component: literal`affine-page-root`,\n      },\n    };\n  }\n  return spec;\n});\n","import type {\n  EditorHost,\n  TextRangePoint,\n  TextSelection,\n} from '@blocksuite/block-std';\nimport {\n  defaultImageProxyMiddleware,\n  embedSyncedDocMiddleware,\n  MarkdownAdapter,\n  MixTextAdapter,\n  pasteMiddleware,\n  PlainTextAdapter,\n  titleMiddleware,\n} from '@blocksuite/blocks';\nimport { assertExists } from '@blocksuite/global/utils';\nimport type {\n  BlockModel,\n  BlockSnapshot,\n  Doc,\n  DraftModel,\n  Slice,\n  SliceSnapshot,\n} from '@blocksuite/store';\nimport { DocCollection, Job } from '@blocksuite/store';\n\nconst updateSnapshotText = (\n  point: TextRangePoint,\n  snapshot: BlockSnapshot,\n  model: DraftModel\n) => {\n  const { index, length } = point;\n  if (!snapshot.props.text || length === 0) {\n    return;\n  }\n  (snapshot.props.text as Record<string, unknown>).delta =\n    model.text?.sliceToDelta(index, length + index);\n};\n\nfunction processSnapshot(\n  snapshot: BlockSnapshot,\n  text: TextSelection,\n  host: EditorHost\n) {\n  const model = host.doc.getBlockById(snapshot.id);\n  assertExists(model);\n\n  const modelId = model.id;\n  if (text.from.blockId === modelId) {\n    updateSnapshotText(text.from, snapshot, model);\n  }\n  if (text.to && text.to.blockId === modelId) {\n    updateSnapshotText(text.to, snapshot, model);\n  }\n\n  // If the snapshot has children, handle them recursively\n  snapshot.children.forEach(childSnapshot =>\n    processSnapshot(childSnapshot, text, host)\n  );\n}\n\n/**\n * Processes the text in the given snapshot if there is a text selection.\n * Only the selected portion of the snapshot will be processed.\n */\nfunction processTextInSnapshot(snapshot: SliceSnapshot, host: EditorHost) {\n  const { content } = snapshot;\n  const text = host.selection.find('text');\n  if (!content.length || !text) return;\n\n  content.forEach(snapshot => processSnapshot(snapshot, text, host));\n}\n\nexport async function getContentFromSlice(\n  host: EditorHost,\n  slice: Slice,\n  type: 'markdown' | 'plain-text' = 'markdown'\n) {\n  const job = new Job({\n    collection: host.std.doc.collection,\n    middlewares: [titleMiddleware, embedSyncedDocMiddleware('content')],\n  });\n  const snapshot = await job.sliceToSnapshot(slice);\n  if (!snapshot) {\n    return '';\n  }\n  processTextInSnapshot(snapshot, host);\n  const adapter =\n    type === 'markdown' ? new MarkdownAdapter(job) : new PlainTextAdapter(job);\n  const content = await adapter.fromSliceSnapshot({\n    snapshot,\n    assets: job.assetsManager,\n  });\n  return content.file;\n}\n\nexport async function getPlainTextFromSlice(host: EditorHost, slice: Slice) {\n  const job = new Job({\n    collection: host.std.doc.collection,\n    middlewares: [titleMiddleware],\n  });\n  const snapshot = await job.sliceToSnapshot(slice);\n  if (!snapshot) {\n    return '';\n  }\n  processTextInSnapshot(snapshot, host);\n  const plainTextAdapter = new PlainTextAdapter(job);\n  const plainText = await plainTextAdapter.fromSliceSnapshot({\n    snapshot,\n    assets: job.assetsManager,\n  });\n  return plainText.file;\n}\n\nexport const markdownToSnapshot = async (\n  markdown: string,\n  host: EditorHost\n) => {\n  const job = new Job({\n    collection: host.std.doc.collection,\n    middlewares: [defaultImageProxyMiddleware, pasteMiddleware(host.std)],\n  });\n  const markdownAdapter = new MixTextAdapter(job);\n  const { blockVersions, workspaceVersion, pageVersion } =\n    host.std.doc.collection.meta;\n  if (!blockVersions || !workspaceVersion || !pageVersion)\n    throw new Error(\n      'Need blockVersions, workspaceVersion, pageVersion meta information to get slice'\n    );\n  const payload = {\n    file: markdown,\n    assets: job.assetsManager,\n    blockVersions,\n    pageVersion,\n    workspaceVersion,\n    workspaceId: host.std.doc.collection.id,\n    pageId: host.std.doc.id,\n  };\n\n  const snapshot = await markdownAdapter.toSliceSnapshot(payload);\n  assertExists(snapshot, 'import markdown failed, expected to get a snapshot');\n\n  return {\n    snapshot,\n    job,\n  };\n};\n\nexport async function insertFromMarkdown(\n  host: EditorHost,\n  markdown: string,\n  doc: Doc,\n  parent?: string,\n  index?: number\n) {\n  const { snapshot, job } = await markdownToSnapshot(markdown, host);\n\n  const snapshots = snapshot.content.flatMap(x => x.children);\n\n  const models: BlockModel[] = [];\n  for (let i = 0; i < snapshots.length; i++) {\n    const blockSnapshot = snapshots[i];\n    const model = await job.snapshotToBlock(\n      blockSnapshot,\n      doc,\n      parent,\n      (index ?? 0) + i\n    );\n    if (model) {\n      models.push(model);\n    }\n  }\n\n  return models;\n}\n\n// FIXME: replace when selection is block is buggy right not\nexport async function replaceFromMarkdown(\n  host: EditorHost,\n  markdown: string,\n  parent?: string,\n  index?: number\n) {\n  const { snapshot, job } = await markdownToSnapshot(markdown, host);\n  await job.snapshotToSlice(snapshot, host.doc, parent, index);\n}\n\nexport async function markDownToDoc(host: EditorHost, answer: string) {\n  const schema = host.std.doc.collection.schema;\n  // Should not create a new doc in the original collection\n  const collection = new DocCollection({\n    schema,\n    disableBacklinkIndex: true,\n    disableSearchIndex: true,\n  });\n  collection.meta.initialize();\n  const job = new Job({\n    collection,\n    middlewares: [defaultImageProxyMiddleware],\n  });\n  const mdAdapter = new MarkdownAdapter(job);\n  const doc = await mdAdapter.toDoc({\n    file: answer,\n    assets: job.assetsManager,\n  });\n  if (!doc) {\n    console.error('Failed to convert markdown to doc');\n  }\n  return doc as Doc;\n}\n","import type { EditorHost } from '@blocksuite/block-std';\nimport { PaymentRequiredError, UnauthorizedError } from '@blocksuite/blocks';\nimport { Slot } from '@blocksuite/store';\n\nexport interface AIUserInfo {\n  id: string;\n  email: string;\n  name: string;\n  avatarUrl: string | null;\n}\n\nexport interface AIChatParams {\n  host: EditorHost;\n  mode?: 'page' | 'edgeless';\n  // Auto select and append selection to input via `Continue with AI` action.\n  autoSelect?: boolean;\n}\n\nexport type ActionEventType =\n  | 'started'\n  | 'finished'\n  | 'error'\n  | 'aborted:paywall'\n  | 'aborted:login-required'\n  | 'aborted:server-error'\n  | 'aborted:stop'\n  | 'result:insert'\n  | 'result:replace'\n  | 'result:use-as-caption'\n  | 'result:add-page'\n  | 'result:add-note'\n  | 'result:continue-in-chat'\n  | 'result:discard'\n  | 'result:retry';\n\n/**\n * AI provider for the block suite\n *\n * To use it, downstream (affine) has to provide AI actions implementation,\n * user info etc\n *\n * TODO: breakdown into different parts?\n */\nexport class AIProvider {\n  static get slots() {\n    return AIProvider.instance.slots;\n  }\n\n  static get actions() {\n    return AIProvider.instance.actions;\n  }\n\n  static get userInfo() {\n    return AIProvider.instance.userInfoFn();\n  }\n\n  static get photoEngine() {\n    return AIProvider.instance.photoEngine;\n  }\n\n  static get histories() {\n    return AIProvider.instance.histories;\n  }\n\n  static get actionHistory() {\n    return AIProvider.instance.actionHistory;\n  }\n\n  static get toggleGeneralAIOnboarding() {\n    return AIProvider.instance.toggleGeneralAIOnboarding;\n  }\n\n  static get forkChat() {\n    return AIProvider.instance.forkChat;\n  }\n\n  private static readonly instance = new AIProvider();\n\n  static LAST_ACTION_SESSIONID = '';\n\n  static LAST_ROOT_SESSION_ID = '';\n\n  static MAX_LOCAL_HISTORY = 10;\n\n  private readonly actions: Partial<BlockSuitePresets.AIActions> = {};\n\n  private photoEngine: BlockSuitePresets.AIPhotoEngineService | null = null;\n\n  private histories: BlockSuitePresets.AIHistoryService | null = null;\n\n  private toggleGeneralAIOnboarding: ((value: boolean) => void) | null = null;\n\n  private forkChat:\n    | ((\n        options: BlockSuitePresets.AIForkChatSessionOptions\n      ) => string | Promise<string>)\n    | null = null;\n\n  private readonly slots = {\n    // use case: when user selects \"continue in chat\" in an ask ai result panel\n    // do we need to pass the context to the chat panel?\n    requestOpenWithChat: new Slot<AIChatParams>(),\n    requestInsertTemplate: new Slot<{\n      template: string;\n      mode: 'page' | 'edgeless';\n    }>(),\n    requestLogin: new Slot<{ host: EditorHost }>(),\n    requestUpgradePlan: new Slot<{ host: EditorHost }>(),\n    // when an action is requested to run in edgeless mode (show a toast in affine)\n    requestRunInEdgeless: new Slot<{ host: EditorHost }>(),\n    // stream of AI actions triggered by users\n    actions: new Slot<{\n      action: keyof BlockSuitePresets.AIActions;\n      options: BlockSuitePresets.AITextActionOptions;\n      event: ActionEventType;\n    }>(),\n    // downstream can emit this slot to notify ai presets that user info has been updated\n    userInfo: new Slot<AIUserInfo | null>(),\n    // add more if needed\n    toggleChatCards: new Slot<{\n      visible: boolean;\n      ok?: boolean;\n    }>(),\n  };\n\n  // track the history of triggered actions (in memory only)\n  private readonly actionHistory: {\n    action: keyof BlockSuitePresets.AIActions;\n    options: BlockSuitePresets.AITextActionOptions;\n  }[] = [];\n\n  private userInfoFn: () => AIUserInfo | Promise<AIUserInfo> | null = () =>\n    null;\n\n  private provideAction<T extends keyof BlockSuitePresets.AIActions>(\n    id: T,\n    action: (\n      ...options: Parameters<BlockSuitePresets.AIActions[T]>\n    ) => ReturnType<BlockSuitePresets.AIActions[T]>\n  ): void {\n    if (this.actions[id]) {\n      console.warn(`AI action ${id} is already provided`);\n    }\n\n    // @ts-expect-error TODO: maybe fix this\n    this.actions[id] = (\n      ...args: Parameters<BlockSuitePresets.AIActions[T]>\n    ) => {\n      const options = args[0];\n      const slots = this.slots;\n      slots.actions.emit({\n        action: id,\n        options,\n        event: 'started',\n      });\n      this.actionHistory.push({ action: id, options });\n      if (this.actionHistory.length > AIProvider.MAX_LOCAL_HISTORY) {\n        this.actionHistory.shift();\n      }\n      // wrap the action with slot actions\n      const result: BlockSuitePresets.TextStream | Promise<string> = action(\n        ...args\n      );\n      const isTextStream = (\n        m: BlockSuitePresets.TextStream | Promise<string>\n      ): m is BlockSuitePresets.TextStream =>\n        Reflect.has(m, Symbol.asyncIterator);\n      if (isTextStream(result)) {\n        return {\n          [Symbol.asyncIterator]: async function* () {\n            try {\n              yield* result;\n              slots.actions.emit({\n                action: id,\n                options,\n                event: 'finished',\n              });\n            } catch (err) {\n              slots.actions.emit({\n                action: id,\n                options,\n                event: 'error',\n              });\n              if (err instanceof PaymentRequiredError) {\n                slots.actions.emit({\n                  action: id,\n                  options,\n                  event: 'aborted:paywall',\n                });\n              } else if (err instanceof UnauthorizedError) {\n                slots.actions.emit({\n                  action: id,\n                  options,\n                  event: 'aborted:login-required',\n                });\n              } else {\n                slots.actions.emit({\n                  action: id,\n                  options,\n                  event: 'aborted:server-error',\n                });\n              }\n              throw err;\n            }\n          },\n        };\n      } else {\n        return result\n          .then(result => {\n            slots.actions.emit({\n              action: id,\n              options,\n              event: 'finished',\n            });\n            return result;\n          })\n          .catch(err => {\n            slots.actions.emit({\n              action: id,\n              options,\n              event: 'error',\n            });\n            if (err instanceof PaymentRequiredError) {\n              slots.actions.emit({\n                action: id,\n                options,\n                event: 'aborted:paywall',\n              });\n            }\n            throw err;\n          });\n      }\n    };\n  }\n\n  static provide(\n    id: 'userInfo',\n    fn: () => AIUserInfo | Promise<AIUserInfo> | null\n  ): void;\n\n  static provide(\n    id: 'histories',\n    service: BlockSuitePresets.AIHistoryService\n  ): void;\n\n  static provide(\n    id: 'photoEngine',\n    engine: BlockSuitePresets.AIPhotoEngineService\n  ): void;\n\n  static provide(\n    id: 'forkChat',\n    fn: (\n      options: BlockSuitePresets.AIForkChatSessionOptions\n    ) => string | Promise<string>\n  ): void;\n\n  static provide(id: 'onboarding', fn: (value: boolean) => void): void;\n\n  // actions:\n  static provide<T extends keyof BlockSuitePresets.AIActions>(\n    id: T,\n    action: (\n      ...options: Parameters<BlockSuitePresets.AIActions[T]>\n    ) => ReturnType<BlockSuitePresets.AIActions[T]>\n  ): void;\n\n  static provide(id: unknown, action: unknown) {\n    if (id === 'userInfo') {\n      AIProvider.instance.userInfoFn = action as () => AIUserInfo;\n    } else if (id === 'histories') {\n      AIProvider.instance.histories =\n        action as BlockSuitePresets.AIHistoryService;\n    } else if (id === 'photoEngine') {\n      AIProvider.instance.photoEngine =\n        action as BlockSuitePresets.AIPhotoEngineService;\n    } else if (id === 'onboarding') {\n      AIProvider.instance.toggleGeneralAIOnboarding = action as (\n        value: boolean\n      ) => void;\n    } else if (id === 'forkChat') {\n      AIProvider.instance.forkChat = action as (\n        options: BlockSuitePresets.AIForkChatSessionOptions\n      ) => string | Promise<string>;\n    } else {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      AIProvider.instance.provideAction(id as any, action as any);\n    }\n  }\n}\n","import { type ActionEventType, AIProvider } from '../provider';\n\nexport function reportResponse(event: ActionEventType) {\n  const lastAction = AIProvider.actionHistory.at(-1);\n  if (!lastAction) return;\n\n  AIProvider.slots.actions.emit({\n    action: lastAction.action,\n    options: lastAction.options,\n    event,\n  });\n}\n","import type { BlockComponent, EditorHost } from '@blocksuite/block-std';\nimport {\n  AFFINE_EDGELESS_COPILOT_WIDGET,\n  type EdgelessCopilotWidget,\n  type EdgelessRootService,\n  matchFlavours,\n  MindmapElementModel,\n  type ShapeElementModel,\n} from '@blocksuite/blocks';\n\nexport function mindMapToMarkdown(mindmap: MindmapElementModel) {\n  let markdownStr = '';\n\n  const traverse = (\n    node: MindmapElementModel['tree']['children'][number],\n    indent: number = 0\n  ) => {\n    const text = (node.element as ShapeElementModel).text?.toString() ?? '';\n\n    markdownStr += `${'  '.repeat(indent)}- ${text}\\n`;\n\n    if (node.children) {\n      node.children.forEach(node => traverse(node, indent + 2));\n    }\n  };\n\n  traverse(mindmap.tree, 0);\n\n  return markdownStr;\n}\n\nexport function isMindMapRoot(ele: BlockSuite.EdgelessModel) {\n  const group = ele?.group;\n\n  return group instanceof MindmapElementModel && group.tree.element === ele;\n}\n\nexport function isMindmapChild(ele: BlockSuite.EdgelessModel) {\n  return ele?.group instanceof MindmapElementModel && !isMindMapRoot(ele);\n}\n\nexport function getService(host: EditorHost) {\n  const edgelessService = host.spec.getService(\n    'affine:page'\n  ) as EdgelessRootService;\n\n  return edgelessService;\n}\n\nexport function getEdgelessCopilotWidget(\n  host: EditorHost\n): EdgelessCopilotWidget {\n  const rootBlockId = host.doc.root?.id as string;\n  const copilotWidget = host.view.getWidget(\n    AFFINE_EDGELESS_COPILOT_WIDGET,\n    rootBlockId\n  ) as EdgelessCopilotWidget;\n\n  return copilotWidget;\n}\n\nexport function findNoteBlockModel(blockElement: BlockComponent) {\n  let curBlock = blockElement;\n  while (curBlock) {\n    if (matchFlavours(curBlock.model, ['affine:note'])) {\n      return curBlock.model;\n    }\n    if (matchFlavours(curBlock.model, ['affine:page', 'affine:surface'])) {\n      return null;\n    }\n    curBlock = curBlock.parentBlock;\n  }\n  return null;\n}\n","import type {\n  BlockComponent,\n  EditorHost,\n  TextSelection,\n} from '@blocksuite/block-std';\nimport type { AffineAIPanelWidget } from '@blocksuite/blocks';\nimport { isInsideEdgelessEditor } from '@blocksuite/blocks';\nimport { type BlockModel, Slice } from '@blocksuite/store';\n\nimport {\n  insertFromMarkdown,\n  markDownToDoc,\n  markdownToSnapshot,\n} from './markdown-utils';\n\nconst getNoteId = (blockElement: BlockComponent) => {\n  let element = blockElement;\n  while (element.flavour !== 'affine:note') {\n    element = element.parentBlock;\n  }\n\n  return element.model.id;\n};\n\nconst setBlockSelection = (\n  host: EditorHost,\n  parent: BlockComponent,\n  models: BlockModel[]\n) => {\n  const selections = models\n    .map(model => model.id)\n    .map(blockId => host.selection.create('block', { blockId }));\n\n  if (isInsideEdgelessEditor(host)) {\n    const surfaceElementId = getNoteId(parent);\n    const surfaceSelection = host.selection.create(\n      'surface',\n      selections[0].blockId,\n      [surfaceElementId],\n      true\n    );\n\n    selections.push(surfaceSelection);\n    host.selection.set(selections);\n  } else {\n    host.selection.setGroup('note', selections);\n  }\n};\n\nexport const insert = async (\n  host: EditorHost,\n  content: string,\n  selectBlock: BlockComponent,\n  below: boolean = true\n) => {\n  const blockParent = selectBlock.parentBlock;\n  const index = blockParent.model.children.findIndex(\n    model => model.id === selectBlock.model.id\n  );\n  const insertIndex = below ? index + 1 : index;\n\n  const { doc } = host;\n  const models = await insertFromMarkdown(\n    host,\n    content,\n    doc,\n    blockParent.model.id,\n    insertIndex\n  );\n  await host.updateComplete;\n  requestAnimationFrame(() => setBlockSelection(host, blockParent, models));\n};\n\nexport const insertBelow = async (\n  host: EditorHost,\n  content: string,\n  selectBlock: BlockComponent\n) => {\n  await insert(host, content, selectBlock, true);\n};\n\nexport const insertAbove = async (\n  host: EditorHost,\n  content: string,\n  selectBlock: BlockComponent\n) => {\n  await insert(host, content, selectBlock, false);\n};\n\nexport const replace = async (\n  host: EditorHost,\n  content: string,\n  firstBlock: BlockComponent,\n  selectedModels: BlockModel[],\n  textSelection?: TextSelection\n) => {\n  const firstBlockParent = firstBlock.parentBlock;\n  const firstIndex = firstBlockParent.model.children.findIndex(\n    model => model.id === firstBlock.model.id\n  );\n\n  if (textSelection) {\n    const { snapshot, job } = await markdownToSnapshot(content, host);\n    await job.snapshotToSlice(\n      snapshot,\n      host.doc,\n      firstBlockParent.model.id,\n      firstIndex + 1\n    );\n  } else {\n    selectedModels.forEach(model => {\n      host.doc.deleteBlock(model);\n    });\n\n    const { doc } = host;\n    const models = await insertFromMarkdown(\n      host,\n      content,\n      doc,\n      firstBlockParent.model.id,\n      firstIndex\n    );\n\n    await host.updateComplete;\n    requestAnimationFrame(() =>\n      setBlockSelection(host, firstBlockParent, models)\n    );\n  }\n};\n\nexport const copyTextAnswer = async (panel: AffineAIPanelWidget) => {\n  const host = panel.host;\n  if (!panel.answer) {\n    return false;\n  }\n  return copyText(host, panel.answer);\n};\n\nexport const copyText = async (host: EditorHost, text: string) => {\n  const previewDoc = await markDownToDoc(host, text);\n  const models = previewDoc\n    .getBlocksByFlavour('affine:note')\n    .map(b => b.model)\n    .flatMap(model => model.children);\n  const slice = Slice.fromModels(previewDoc, models);\n  await host.std.clipboard.copySlice(slice);\n  return true;\n};\n","import type { EditorHost } from '@blocksuite/block-std';\nimport {\n  type CopilotSelectionController,\n  type FrameBlockModel,\n  ImageBlockModel,\n  type SurfaceBlockComponent,\n} from '@blocksuite/blocks';\nimport { BlocksUtils, EdgelessRootService } from '@blocksuite/blocks';\nimport { assertExists } from '@blocksuite/global/utils';\nimport {\n  type BlockModel,\n  type DraftModel,\n  Slice,\n  toDraftModel,\n} from '@blocksuite/store';\n\nimport { getEdgelessCopilotWidget, getService } from './edgeless';\nimport { getContentFromSlice } from './markdown-utils';\n\nexport const getRootService = (host: EditorHost) => {\n  return host.std.spec.getService('affine:page');\n};\n\nexport function getEdgelessRootFromEditor(editor: EditorHost) {\n  const edgelessRoot = editor.getElementsByTagName('affine-edgeless-root')[0];\n  if (!edgelessRoot) {\n    alert('Please switch to edgeless mode');\n    throw new Error('Please open switch to edgeless mode');\n  }\n  return edgelessRoot;\n}\nexport function getEdgelessService(editor: EditorHost) {\n  const rootService = editor.std.spec.getService('affine:page');\n  if (rootService instanceof EdgelessRootService) {\n    return rootService;\n  }\n  alert('Please switch to edgeless mode');\n  throw new Error('Please open switch to edgeless mode');\n}\n\nexport async function selectedToCanvas(editor: EditorHost) {\n  const edgelessRoot = getEdgelessRootFromEditor(editor);\n  const { notes, frames, shapes, images } = BlocksUtils.splitElements(\n    edgelessRoot.service.selection.selectedElements\n  );\n  if (notes.length + frames.length + images.length + shapes.length === 0) {\n    return;\n  }\n  const canvas = await edgelessRoot.clipboardController.toCanvas(\n    [...notes, ...frames, ...images],\n    shapes\n  );\n  if (!canvas) {\n    return;\n  }\n  return canvas;\n}\n\nexport async function frameToCanvas(\n  frame: FrameBlockModel,\n  editor: EditorHost\n) {\n  const edgelessRoot = getEdgelessRootFromEditor(editor);\n  const { notes, frames, shapes, images } = BlocksUtils.splitElements(\n    edgelessRoot.service.frame.getElementsInFrame(frame, true)\n  );\n  if (notes.length + frames.length + images.length + shapes.length === 0) {\n    return;\n  }\n  const canvas = await edgelessRoot.clipboardController.toCanvas(\n    [...notes, ...frames, ...images],\n    shapes\n  );\n  if (!canvas) {\n    return;\n  }\n  return canvas;\n}\n\nexport async function selectedToPng(editor: EditorHost) {\n  return (await selectedToCanvas(editor))?.toDataURL('image/png');\n}\n\nexport function getSelectedModels(editorHost: EditorHost) {\n  const chain = editorHost.std.command.chain();\n  const [_, ctx] = chain\n    .getSelectedModels({\n      types: ['block', 'text'],\n    })\n    .run();\n  const { selectedModels } = ctx;\n  return selectedModels;\n}\n\nfunction traverse(model: DraftModel, drafts: DraftModel[]) {\n  const isDatabase = model.flavour === 'affine:database';\n  const children = isDatabase\n    ? model.children\n    : model.children.filter(child => {\n        const idx = drafts.findIndex(m => m.id === child.id);\n        return idx >= 0;\n      });\n\n  children.forEach(child => {\n    const idx = drafts.findIndex(m => m.id === child.id);\n    if (idx >= 0) {\n      drafts.splice(idx, 1);\n    }\n    traverse(child, drafts);\n  });\n  model.children = children;\n}\n\nexport async function getTextContentFromBlockModels(\n  editorHost: EditorHost,\n  models: BlockModel[],\n  type: 'markdown' | 'plain-text' = 'markdown'\n) {\n  // Currently only filter out images and databases\n  const selectedTextModels = models.filter(\n    model =>\n      !BlocksUtils.matchFlavours(model, ['affine:image', 'affine:database'])\n  );\n  const drafts = selectedTextModels.map(toDraftModel);\n  drafts.forEach(draft => traverse(draft, drafts));\n  const slice = Slice.fromModels(editorHost.std.doc, drafts);\n  return getContentFromSlice(editorHost, slice, type);\n}\n\nexport async function getSelectedTextContent(\n  editorHost: EditorHost,\n  type: 'markdown' | 'plain-text' = 'markdown'\n) {\n  const selectedModels = getSelectedModels(editorHost);\n  assertExists(selectedModels);\n  return getTextContentFromBlockModels(editorHost, selectedModels, type);\n}\n\nexport async function selectAboveBlocks(editorHost: EditorHost, num = 10) {\n  let selectedModels = getSelectedModels(editorHost);\n  assertExists(selectedModels);\n\n  const lastLeafModel = selectedModels[selectedModels.length - 1];\n\n  let noteModel: BlockModel | null = lastLeafModel;\n  let lastRootModel: BlockModel | null = null;\n  while (noteModel && noteModel.flavour !== 'affine:note') {\n    lastRootModel = noteModel;\n    noteModel = editorHost.doc.getParent(noteModel);\n  }\n  assertExists(noteModel);\n  assertExists(lastRootModel);\n\n  const endIndex = noteModel.children.indexOf(lastRootModel) + 1;\n  const startIndex = Math.max(0, endIndex - num);\n  const startBlock = noteModel.children[startIndex];\n\n  selectedModels = [];\n  let stop = false;\n  const traverse = (model: BlockModel): void => {\n    if (stop) return;\n\n    selectedModels.push(model);\n\n    if (model === lastLeafModel) {\n      stop = true;\n      return;\n    }\n\n    model.children.forEach(child => traverse(child));\n  };\n  noteModel.children.slice(startIndex, endIndex).forEach(traverse);\n\n  const { selection } = editorHost;\n  selection.set([\n    selection.create('text', {\n      from: {\n        blockId: startBlock.id,\n        index: 0,\n        length: startBlock.text?.length ?? 0,\n      },\n      to: {\n        blockId: lastLeafModel.id,\n        index: 0,\n        length: selection.find('text')?.from.index ?? 0,\n      },\n    }),\n  ]);\n\n  return getTextContentFromBlockModels(editorHost, selectedModels);\n}\n\nexport const stopPropagation = (e: Event) => {\n  e.stopPropagation();\n};\n\nexport function getSurfaceElementFromEditor(editor: EditorHost) {\n  const { doc } = editor;\n  const surfaceModel = doc.getBlockByFlavour('affine:surface')[0];\n  assertExists(surfaceModel);\n\n  const surfaceId = surfaceModel.id;\n  const surfaceElement = editor.querySelector(\n    `affine-surface[data-block-id=\"${surfaceId}\"]`\n  ) as SurfaceBlockComponent;\n  assertExists(surfaceElement);\n\n  return surfaceElement;\n}\n\nexport const getFirstImageInFrame = (\n  frame: FrameBlockModel,\n  editor: EditorHost\n) => {\n  const edgelessRoot = getEdgelessRootFromEditor(editor);\n  const elements = edgelessRoot.service.frame.getElementsInFrame(frame, false);\n  const image = elements.find(ele => {\n    if (!BlocksUtils.isCanvasElement(ele)) {\n      return ele.flavour === 'affine:image';\n    }\n    return false;\n  }) as ImageBlockModel | undefined;\n  return image?.id;\n};\n\nexport const getSelections = (\n  host: EditorHost,\n  mode: 'flat' | 'highest' = 'flat'\n) => {\n  const [_, data] = host.command\n    .chain()\n    .tryAll(chain => [\n      chain.getTextSelection(),\n      chain.getBlockSelections(),\n      chain.getImageSelections(),\n    ])\n    .getSelectedBlocks({ types: ['text', 'block', 'image'], mode })\n    .run();\n\n  return data;\n};\n\nexport const getSelectedImagesAsBlobs = async (host: EditorHost) => {\n  const [_, data] = host.command\n    .chain()\n    .tryAll(chain => [\n      chain.getTextSelection(),\n      chain.getBlockSelections(),\n      chain.getImageSelections(),\n    ])\n    .getSelectedBlocks({\n      types: ['block', 'image'],\n    })\n    .run();\n\n  const blobs = await Promise.all(\n    data.selectedBlocks?.map(async b => {\n      const sourceId = (b.model as ImageBlockModel).sourceId;\n      if (!sourceId) return null;\n      const blob = await host.doc.blobSync.get(sourceId);\n      if (!blob) return null;\n      return new File([blob], sourceId);\n    }) ?? []\n  );\n  return blobs.filter((blob): blob is File => !!blob);\n};\n\nexport const getSelectedNoteAnchor = (host: EditorHost, id: string) => {\n  return host.querySelector(`[data-portal-block-id=\"${id}\"] .note-background`);\n};\n\nexport function getCopilotSelectedElems(\n  host: EditorHost\n): BlockSuite.EdgelessModel[] {\n  const service = getService(host);\n  const copilotWidget = getEdgelessCopilotWidget(host);\n\n  if (copilotWidget.visible) {\n    return (service.tool.controllers['copilot'] as CopilotSelectionController)\n      .selectedElements;\n  }\n\n  return service.selection.selectedElements;\n}\n\nexport const imageCustomInput = async (host: EditorHost) => {\n  const selectedElements = getCopilotSelectedElems(host);\n  if (selectedElements.length !== 1) return;\n\n  const imageBlock = selectedElements[0];\n  if (!(imageBlock instanceof ImageBlockModel)) return;\n  if (!imageBlock.sourceId) return;\n\n  const blob = await host.doc.blobSync.get(imageBlock.sourceId);\n  if (!blob) return;\n\n  return {\n    attachments: [blob],\n  };\n};\n","import type { EditorHost } from '@blocksuite/block-std';\nimport {\n  AFFINE_AI_PANEL_WIDGET,\n  AffineAIPanelWidget,\n  type AffineAIPanelWidgetConfig,\n  type AIItemConfig,\n  ImageBlockModel,\n  isInsideEdgelessEditor,\n  matchFlavours,\n  NoteDisplayMode,\n} from '@blocksuite/blocks';\nimport { assertExists, Bound } from '@blocksuite/global/utils';\nimport type { TemplateResult } from 'lit';\n\nimport {\n  AIPenIcon,\n  AIStarIconWithAnimation,\n  ChatWithAIIcon,\n  CreateIcon,\n  DiscardIcon,\n  InsertBelowIcon,\n  InsertTopIcon,\n  ReplaceIcon,\n  RetryIcon,\n} from './_common/icons';\nimport { INSERT_ABOVE_ACTIONS } from './actions/consts';\nimport { createTextRenderer } from './messages/text';\nimport { AIProvider } from './provider';\nimport { reportResponse } from './utils/action-reporter';\nimport { findNoteBlockModel, getService } from './utils/edgeless';\nimport {\n  copyTextAnswer,\n  insertAbove,\n  insertBelow,\n  replace,\n} from './utils/editor-actions';\nimport { insertFromMarkdown } from './utils/markdown-utils';\nimport { getSelections } from './utils/selection-utils';\n\nfunction getSelection(host: EditorHost) {\n  const textSelection = host.selection.find('text');\n  const mode = textSelection ? 'flat' : 'highest';\n  const { selectedBlocks } = getSelections(host, mode);\n  assertExists(selectedBlocks);\n  const length = selectedBlocks.length;\n  const firstBlock = selectedBlocks[0];\n  const lastBlock = selectedBlocks[length - 1];\n  const selectedModels = selectedBlocks.map(block => block.model);\n  return {\n    textSelection,\n    selectedModels,\n    firstBlock,\n    lastBlock,\n  };\n}\n\nfunction asCaption<T extends keyof BlockSuitePresets.AIActions>(\n  host: EditorHost,\n  id?: T\n): AIItemConfig {\n  return {\n    name: 'Use as caption',\n    icon: AIPenIcon,\n    showWhen: () => {\n      const panel = getAIPanel(host);\n      return id === 'generateCaption' && !!panel.answer;\n    },\n    handler: () => {\n      reportResponse('result:use-as-caption');\n      const panel = getAIPanel(host);\n      const caption = panel.answer;\n      if (!caption) return;\n\n      const { selectedBlocks } = getSelections(host);\n      if (!selectedBlocks || selectedBlocks.length !== 1) return;\n\n      const imageBlock = selectedBlocks[0].model;\n      if (!(imageBlock instanceof ImageBlockModel)) return;\n\n      host.doc.updateBlock(imageBlock, { caption });\n      panel.hide();\n    },\n  };\n}\n\nfunction createNewNote(host: EditorHost): AIItemConfig {\n  return {\n    name: 'Create new note',\n    icon: CreateIcon,\n    showWhen: () => {\n      const panel = getAIPanel(host);\n      return !!panel.answer && isInsideEdgelessEditor(host);\n    },\n    handler: () => {\n      reportResponse('result:add-note');\n      // get the note block\n      const { selectedBlocks } = getSelections(host);\n      if (!selectedBlocks || !selectedBlocks.length) return;\n      const firstBlock = selectedBlocks[0];\n      const noteModel = findNoteBlockModel(firstBlock);\n      if (!noteModel) return;\n\n      // create a new note block at the left of the current note block\n      const bound = Bound.deserialize(noteModel.xywh);\n      const newBound = new Bound(bound.x - bound.w - 20, bound.y, bound.w, 72);\n      const doc = host.doc;\n      const panel = getAIPanel(host);\n      const service = getService(host);\n      doc.transact(() => {\n        assertExists(doc.root);\n        const noteBlockId = doc.addBlock(\n          'affine:note',\n          {\n            xywh: newBound.serialize(),\n            displayMode: NoteDisplayMode.EdgelessOnly,\n            index: service.generateIndex('affine:note'),\n          },\n          doc.root.id\n        );\n\n        assertExists(panel.answer);\n        insertFromMarkdown(host, panel.answer, doc, noteBlockId)\n          .then(() => {\n            service.selection.set({\n              elements: [noteBlockId],\n              editing: false,\n            });\n\n            // set the viewport to show the new note block and original note block\n            const newNote = doc.getBlock(noteBlockId)?.model;\n            if (!newNote || !matchFlavours(newNote, ['affine:note'])) return;\n            const newNoteBound = Bound.deserialize(newNote.xywh);\n\n            const bounds = [bound, newNoteBound];\n            const { zoom, centerX, centerY } = service.getFitToScreenData(\n              [20, 20, 20, 20],\n              bounds\n            );\n            service.viewport.setViewport(zoom, [centerX, centerY]);\n          })\n          .catch(err => {\n            console.error(err);\n          });\n      });\n      // hide the panel\n      panel.hide();\n    },\n  };\n}\n\nasync function replaceWithAnswer(panel: AffineAIPanelWidget) {\n  const { host } = panel;\n  const selection = getSelection(host);\n  if (!selection || !panel.answer) return;\n\n  const { textSelection, firstBlock, selectedModels } = selection;\n  await replace(host, panel.answer, firstBlock, selectedModels, textSelection);\n\n  panel.hide();\n}\n\nasync function insertAnswerBelow(panel: AffineAIPanelWidget) {\n  const { host } = panel;\n  const selection = getSelection(host);\n\n  if (!selection || !panel.answer) {\n    return;\n  }\n\n  const { lastBlock } = selection;\n  await insertBelow(host, panel.answer, lastBlock);\n  panel.hide();\n}\n\nasync function insertAnswerAbove(panel: AffineAIPanelWidget) {\n  const { host } = panel;\n  const selection = getSelection(host);\n  if (!selection || !panel.answer) return;\n\n  const { firstBlock } = selection;\n  await insertAbove(host, panel.answer, firstBlock);\n  panel.hide();\n}\n\nexport function buildTextResponseConfig<\n  T extends keyof BlockSuitePresets.AIActions,\n>(panel: AffineAIPanelWidget, id?: T) {\n  const host = panel.host;\n\n  return [\n    {\n      name: 'Response',\n      items: [\n        {\n          name: 'Insert below',\n          icon: InsertBelowIcon,\n          showWhen: () =>\n            !!panel.answer && (!id || !INSERT_ABOVE_ACTIONS.includes(id)),\n          handler: () => {\n            reportResponse('result:insert');\n            insertAnswerBelow(panel).catch(console.error);\n          },\n        },\n        {\n          name: 'Insert above',\n          icon: InsertTopIcon,\n          showWhen: () =>\n            !!panel.answer && !!id && INSERT_ABOVE_ACTIONS.includes(id),\n          handler: () => {\n            reportResponse('result:insert');\n            insertAnswerAbove(panel).catch(console.error);\n          },\n        },\n        asCaption(host, id),\n        {\n          name: 'Replace selection',\n          icon: ReplaceIcon,\n          showWhen: () => !!panel.answer,\n          handler: () => {\n            reportResponse('result:replace');\n            replaceWithAnswer(panel).catch(console.error);\n          },\n        },\n        createNewNote(host),\n      ],\n    },\n    {\n      name: '',\n      items: [\n        {\n          name: 'Continue in chat',\n          icon: ChatWithAIIcon,\n          handler: () => {\n            reportResponse('result:continue-in-chat');\n            AIProvider.slots.requestOpenWithChat.emit({ host });\n            panel.hide();\n          },\n        },\n        {\n          name: 'Regenerate',\n          icon: RetryIcon,\n          handler: () => {\n            reportResponse('result:retry');\n            panel.generate();\n          },\n        },\n        {\n          name: 'Discard',\n          icon: DiscardIcon,\n          handler: () => {\n            panel.discard();\n          },\n        },\n      ],\n    },\n  ];\n}\n\nexport function buildErrorResponseConfig<\n  T extends keyof BlockSuitePresets.AIActions,\n>(panel: AffineAIPanelWidget, id?: T) {\n  const host = panel.host;\n\n  return [\n    {\n      name: 'Response',\n      items: [\n        {\n          name: 'Replace selection',\n          icon: ReplaceIcon,\n          showWhen: () => !!panel.answer,\n          handler: () => {\n            replaceWithAnswer(panel).catch(console.error);\n          },\n        },\n        {\n          name: 'Insert below',\n          icon: InsertBelowIcon,\n          showWhen: () =>\n            !!panel.answer && (!id || !INSERT_ABOVE_ACTIONS.includes(id)),\n          handler: () => {\n            insertAnswerBelow(panel).catch(console.error);\n          },\n        },\n        {\n          name: 'Insert above',\n          icon: InsertTopIcon,\n          showWhen: () =>\n            !!panel.answer && !!id && INSERT_ABOVE_ACTIONS.includes(id),\n          handler: () => {\n            reportResponse('result:insert');\n            insertAnswerAbove(panel).catch(console.error);\n          },\n        },\n        asCaption(host, id),\n        createNewNote(host),\n      ],\n    },\n    {\n      name: '',\n      items: [\n        {\n          name: 'Retry',\n          icon: RetryIcon,\n          showWhen: () => true,\n          handler: () => {\n            reportResponse('result:retry');\n            panel.generate();\n          },\n        },\n        {\n          name: 'Discard',\n          icon: DiscardIcon,\n          showWhen: () => !!panel.answer,\n          handler: () => {\n            panel.discard();\n          },\n        },\n      ],\n    },\n  ];\n}\n\nexport function buildFinishConfig<T extends keyof BlockSuitePresets.AIActions>(\n  panel: AffineAIPanelWidget,\n  id?: T\n) {\n  return {\n    responses: buildTextResponseConfig(panel, id),\n    actions: [],\n  };\n}\n\nexport function buildErrorConfig<T extends keyof BlockSuitePresets.AIActions>(\n  panel: AffineAIPanelWidget,\n  id?: T\n) {\n  return {\n    upgrade: () => {\n      AIProvider.slots.requestUpgradePlan.emit({ host: panel.host });\n      panel.hide();\n    },\n    login: () => {\n      AIProvider.slots.requestLogin.emit({ host: panel.host });\n      panel.hide();\n    },\n    cancel: () => {\n      panel.hide();\n    },\n    responses: buildErrorResponseConfig(panel, id),\n  };\n}\n\nexport function buildGeneratingConfig(generatingIcon?: TemplateResult<1>) {\n  return {\n    generatingIcon: generatingIcon ?? AIStarIconWithAnimation,\n  };\n}\n\nexport function buildCopyConfig(panel: AffineAIPanelWidget) {\n  return {\n    allowed: true,\n    onCopy: () => {\n      return copyTextAnswer(panel);\n    },\n  };\n}\n\nexport function buildAIPanelConfig(\n  panel: AffineAIPanelWidget\n): AffineAIPanelWidgetConfig {\n  return {\n    answerRenderer: createTextRenderer(panel.host, { maxHeight: 320 }),\n    finishStateConfig: buildFinishConfig(panel),\n    generatingStateConfig: buildGeneratingConfig(),\n    errorStateConfig: buildErrorConfig(panel),\n    copy: buildCopyConfig(panel),\n  };\n}\n\nexport const getAIPanel = (host: EditorHost): AffineAIPanelWidget => {\n  const rootBlockId = host.doc.root?.id;\n  assertExists(rootBlockId);\n  const aiPanel = host.view.getWidget(AFFINE_AI_PANEL_WIDGET, rootBlockId);\n  assertExists(aiPanel);\n  if (!(aiPanel instanceof AffineAIPanelWidget)) {\n    throw new Error('AI panel not found');\n  }\n  return aiPanel;\n};\n","import type { EditorHost } from '@blocksuite/block-std';\nimport type {\n  AffineAIPanelWidget,\n  AffineAIPanelWidgetConfig,\n  AIError,\n} from '@blocksuite/blocks';\nimport { assertExists } from '@blocksuite/global/utils';\nimport type { TemplateResult } from 'lit';\n\nimport {\n  buildCopyConfig,\n  buildErrorConfig,\n  buildFinishConfig,\n  buildGeneratingConfig,\n  getAIPanel,\n} from '../ai-panel';\nimport { createTextRenderer } from '../messages/text';\nimport { AIProvider } from '../provider';\nimport { reportResponse } from '../utils/action-reporter';\nimport {\n  getSelectedImagesAsBlobs,\n  getSelectedTextContent,\n  getSelections,\n  selectAboveBlocks,\n} from '../utils/selection-utils';\n\nexport function bindTextStream(\n  stream: BlockSuitePresets.TextStream,\n  {\n    update,\n    finish,\n    signal,\n  }: {\n    update: (text: string) => void;\n    finish: (state: 'success' | 'error' | 'aborted', err?: AIError) => void;\n    signal?: AbortSignal;\n  }\n) {\n  (async () => {\n    let answer = '';\n    signal?.addEventListener('abort', () => {\n      finish('aborted');\n      reportResponse('aborted:stop');\n    });\n    for await (const data of stream) {\n      if (signal?.aborted) {\n        return;\n      }\n      answer += data;\n      update(answer);\n    }\n    finish('success');\n  })().catch(err => {\n    if (signal?.aborted) return;\n    if (err.name === 'AbortError') {\n      finish('aborted');\n    } else {\n      finish('error', err);\n    }\n  });\n}\n\nexport function actionToStream<T extends keyof BlockSuitePresets.AIActions>(\n  id: T,\n  signal?: AbortSignal,\n  variants?: Omit<\n    Parameters<BlockSuitePresets.AIActions[T]>[0],\n    keyof BlockSuitePresets.AITextActionOptions\n  >,\n  trackerOptions?: BlockSuitePresets.TrackerOptions\n) {\n  const action = AIProvider.actions[id];\n  if (!action || typeof action !== 'function') return;\n  return (host: EditorHost): BlockSuitePresets.TextStream => {\n    let stream: BlockSuitePresets.TextStream | undefined;\n    return {\n      async *[Symbol.asyncIterator]() {\n        const { currentTextSelection, selectedBlocks } = getSelections(host);\n\n        let markdown: string;\n        let attachments: File[] = [];\n\n        if (currentTextSelection?.isCollapsed()) {\n          markdown = await selectAboveBlocks(host);\n        } else {\n          [markdown, attachments] = await Promise.all([\n            getSelectedTextContent(host),\n            getSelectedImagesAsBlobs(host),\n          ]);\n        }\n\n        // for now if there are more than one selected blocks, we will not omit the attachments\n        const sendAttachments =\n          selectedBlocks?.length === 1 && attachments.length > 0;\n        const models = selectedBlocks?.map(block => block.model);\n        const control = trackerOptions?.control ?? 'format-bar';\n        const where = trackerOptions?.where ?? 'ai-panel';\n        const options = {\n          ...variants,\n          attachments: sendAttachments ? attachments : undefined,\n          input: sendAttachments ? '' : markdown,\n          stream: true,\n          host,\n          models,\n          signal,\n          control,\n          where,\n          docId: host.doc.id,\n          workspaceId: host.doc.collection.id,\n        } as Parameters<typeof action>[0];\n        // @ts-expect-error TODO(@Peng): maybe fix this\n        stream = action(options);\n        if (!stream) return;\n        yield* stream;\n      },\n    };\n  };\n}\n\nexport function actionToGenerateAnswer<\n  T extends keyof BlockSuitePresets.AIActions,\n>(\n  id: T,\n  variants?: Omit<\n    Parameters<BlockSuitePresets.AIActions[T]>[0],\n    keyof BlockSuitePresets.AITextActionOptions\n  >,\n  trackerOptions?: BlockSuitePresets.TrackerOptions\n) {\n  return (host: EditorHost) => {\n    return ({\n      signal,\n      update,\n      finish,\n    }: {\n      input: string;\n      signal?: AbortSignal;\n      update: (text: string) => void;\n      finish: (state: 'success' | 'error' | 'aborted', err?: AIError) => void;\n    }) => {\n      const { selectedBlocks: blocks } = getSelections(host);\n      if (!blocks || blocks.length === 0) return;\n      const stream = actionToStream(\n        id,\n        signal,\n        variants,\n        trackerOptions\n      )?.(host);\n      if (!stream) return;\n      bindTextStream(stream, { update, finish, signal });\n    };\n  };\n}\n\n/**\n * TODO: Should update config according to the action type\n * When support mind-map. generate image, generate slides on doc mode or in edgeless note block\n * Currently, only support text action\n */\nfunction updateAIPanelConfig<T extends keyof BlockSuitePresets.AIActions>(\n  aiPanel: AffineAIPanelWidget,\n  id: T,\n  generatingIcon: TemplateResult<1>,\n  variants?: Omit<\n    Parameters<BlockSuitePresets.AIActions[T]>[0],\n    keyof BlockSuitePresets.AITextActionOptions\n  >,\n  trackerOptions?: BlockSuitePresets.TrackerOptions\n) {\n  const { config, host } = aiPanel;\n  assertExists(config);\n  config.generateAnswer = actionToGenerateAnswer(\n    id,\n    variants,\n    trackerOptions\n  )(host);\n  config.answerRenderer = createTextRenderer(host, { maxHeight: 320 });\n  config.finishStateConfig = buildFinishConfig(aiPanel, id);\n  config.generatingStateConfig = buildGeneratingConfig(generatingIcon);\n  config.errorStateConfig = buildErrorConfig(aiPanel);\n  config.copy = buildCopyConfig(aiPanel);\n  config.discardCallback = () => {\n    reportResponse('result:discard');\n  };\n}\n\nexport function actionToHandler<T extends keyof BlockSuitePresets.AIActions>(\n  id: T,\n  generatingIcon: TemplateResult<1>,\n  variants?: Omit<\n    Parameters<BlockSuitePresets.AIActions[T]>[0],\n    keyof BlockSuitePresets.AITextActionOptions\n  >,\n  trackerOptions?: BlockSuitePresets.TrackerOptions\n) {\n  return (host: EditorHost) => {\n    const aiPanel = getAIPanel(host);\n    updateAIPanelConfig(aiPanel, id, generatingIcon, variants, trackerOptions);\n    const { selectedBlocks: blocks } = getSelections(aiPanel.host);\n    if (!blocks || blocks.length === 0) return;\n    const block = blocks.at(-1);\n    assertExists(block);\n    aiPanel.toggle(block, 'placeholder');\n  };\n}\n\nexport function handleInlineAskAIAction(host: EditorHost) {\n  const panel = getAIPanel(host);\n  const selection = host.selection.find('text');\n  const lastBlockPath = selection\n    ? (selection.to?.blockId ?? selection.blockId)\n    : null;\n  if (!lastBlockPath) return;\n  const block = host.view.getBlock(lastBlockPath);\n  if (!block) return;\n  const generateAnswer: AffineAIPanelWidgetConfig['generateAnswer'] = ({\n    finish,\n    input,\n    signal,\n    update,\n  }) => {\n    if (!AIProvider.actions.chat) return;\n\n    // recover selection to get content from above blocks\n    assertExists(selection);\n    host.selection.set([selection]);\n\n    selectAboveBlocks(host)\n      .then(context => {\n        assertExists(AIProvider.actions.chat);\n        const stream = AIProvider.actions.chat({\n          input: `${context}\\n${input}`,\n          stream: true,\n          host,\n          where: 'inline-chat-panel',\n          control: 'chat-send',\n          docId: host.doc.id,\n          workspaceId: host.doc.collection.id,\n        });\n        bindTextStream(stream, { update, finish, signal });\n      })\n      .catch(console.error);\n  };\n  assertExists(panel.config);\n  panel.config.generateAnswer = generateAnswer;\n  panel.toggle(block);\n}\n","import type { EditorHost } from '@blocksuite/block-std';\nimport type {\n  AffineAIPanelWidgetConfig,\n  MindmapStyle,\n} from '@blocksuite/blocks';\nimport { markdownToMindmap, MiniMindmapPreview } from '@blocksuite/blocks';\nimport { noop } from '@blocksuite/global/utils';\nimport { html, nothing } from 'lit';\n\nimport { getAIPanel } from '../ai-panel';\n\nnoop(MiniMindmapPreview);\n\nexport const createMindmapRenderer: (\n  host: EditorHost,\n  /**\n   * Used to store data for later use during rendering.\n   */\n  ctx: {\n    get: () => Record<string, unknown>;\n    set: (data: Record<string, unknown>) => void;\n  },\n  style?: MindmapStyle\n) => AffineAIPanelWidgetConfig['answerRenderer'] = (host, ctx, style) => {\n  return (answer, state) => {\n    if (state === 'generating') {\n      const panel = getAIPanel(host);\n      panel.generatingElement?.updateLoadingProgress(2);\n    }\n\n    if (state !== 'finished' && state !== 'error') {\n      return nothing;\n    }\n\n    return html`<mini-mindmap-preview\n      .ctx=${ctx}\n      .host=${host}\n      .answer=${answer}\n      .mindmapStyle=${style}\n      .templateShow=${style === undefined}\n      .height=${300}\n    ></mini-mindmap-preview>`;\n  };\n};\n\n/**\n * Creates a renderer for executing a handler.\n * The ai panel will not display anything after the answer is generated.\n */\nexport const createMindmapExecuteRenderer: (\n  host: EditorHost,\n  /**\n   * Used to store data for later use during rendering.\n   */\n  ctx: {\n    get: () => Record<string, unknown>;\n    set: (data: Record<string, unknown>) => void;\n  },\n  handler: (ctx: {\n    get: () => Record<string, unknown>;\n    set: (data: Record<string, unknown>) => void;\n  }) => void\n) => AffineAIPanelWidgetConfig['answerRenderer'] = (host, ctx, handler) => {\n  return (answer, state) => {\n    if (state !== 'finished') {\n      const panel = getAIPanel(host);\n      panel.generatingElement?.updateLoadingProgress(2);\n      return nothing;\n    }\n\n    ctx.set({\n      node: markdownToMindmap(answer, host.doc),\n    });\n\n    handler(ctx);\n\n    return nothing;\n  };\n};\n","import type { EditorHost } from '@blocksuite/block-std';\nimport { MarkdownAdapter, titleMiddleware } from '@blocksuite/blocks';\nimport { assertExists } from '@blocksuite/global/utils';\nimport { type BlockModel, Job, type Slice } from '@blocksuite/store';\n\nexport async function getMarkdownFromSlice(host: EditorHost, slice: Slice) {\n  const job = new Job({\n    collection: host.std.doc.collection,\n    middlewares: [titleMiddleware],\n  });\n  const markdownAdapter = new MarkdownAdapter(job);\n  const markdown = await markdownAdapter.fromSlice(slice);\n  if (!markdown) {\n    return '';\n  }\n\n  return markdown.file;\n}\nexport const markdownToSnapshot = async (\n  markdown: string,\n  host: EditorHost\n) => {\n  const job = new Job({ collection: host.std.doc.collection });\n  const markdownAdapter = new MarkdownAdapter(job);\n  const { blockVersions, workspaceVersion, pageVersion } =\n    host.std.doc.collection.meta;\n  if (!blockVersions || !workspaceVersion || !pageVersion)\n    throw new Error(\n      'Need blockVersions, workspaceVersion, pageVersion meta information to get slice'\n    );\n\n  const payload = {\n    file: markdown,\n    assets: job.assetsManager,\n    blockVersions,\n    pageVersion,\n    workspaceVersion,\n    workspaceId: host.std.doc.collection.id,\n    pageId: host.std.doc.id,\n  };\n\n  const snapshot = await markdownAdapter.toSliceSnapshot(payload);\n  assertExists(snapshot, 'import markdown failed, expected to get a snapshot');\n\n  return {\n    snapshot,\n    job,\n  };\n};\nexport async function insertFromMarkdown(\n  host: EditorHost,\n  markdown: string,\n  parent?: string,\n  index?: number\n) {\n  const { snapshot, job } = await markdownToSnapshot(markdown, host);\n\n  const snapshots = snapshot.content[0].children;\n\n  const models: BlockModel[] = [];\n  for (let i = 0; i < snapshots.length; i++) {\n    const blockSnapshot = snapshots[i];\n    const model = await job.snapshotToBlock(\n      blockSnapshot,\n      host.std.doc,\n      parent,\n      (index ?? 0) + i\n    );\n    if (model) {\n      models.push(model);\n    }\n  }\n\n  return models;\n}\n","import type { EditorHost } from '@blocksuite/block-std';\nimport {\n  BlocksUtils,\n  EdgelessRootService,\n  type FrameBlockModel,\n  type ImageBlockModel,\n  type SurfaceBlockComponent,\n} from '@blocksuite/blocks';\nimport { assertExists } from '@blocksuite/global/utils';\nimport { Slice } from '@blocksuite/store';\n\nimport { getMarkdownFromSlice } from './markdown-utils';\n\nexport const getRootService = (host: EditorHost) => {\n  return host.std.spec.getService('affine:page');\n};\n\nexport function getEdgelessRootFromEditor(editor: EditorHost) {\n  const edgelessRoot = editor.getElementsByTagName('affine-edgeless-root')[0];\n  if (!edgelessRoot) {\n    alert('Please switch to edgeless mode');\n    throw new Error('Please open switch to edgeless mode');\n  }\n  return edgelessRoot;\n}\nexport function getEdgelessService(editor: EditorHost) {\n  const rootService = editor.std.spec.getService('affine:page');\n  if (rootService instanceof EdgelessRootService) {\n    return rootService;\n  }\n  alert('Please switch to edgeless mode');\n  throw new Error('Please open switch to edgeless mode');\n}\n\nexport async function selectedToCanvas(editor: EditorHost) {\n  const edgelessRoot = getEdgelessRootFromEditor(editor);\n  const { notes, frames, shapes, images } = BlocksUtils.splitElements(\n    edgelessRoot.service.selection.selectedElements\n  );\n  if (notes.length + frames.length + images.length + shapes.length === 0) {\n    return;\n  }\n  const canvas = await edgelessRoot.clipboardController.toCanvas(\n    [...notes, ...frames, ...images],\n    shapes\n  );\n  if (!canvas) {\n    return;\n  }\n  return canvas;\n}\n\nexport async function frameToCanvas(\n  frame: FrameBlockModel,\n  editor: EditorHost\n) {\n  const edgelessRoot = getEdgelessRootFromEditor(editor);\n  const { notes, frames, shapes, images } = BlocksUtils.splitElements(\n    edgelessRoot.service.frame.getElementsInFrame(frame, true)\n  );\n  if (notes.length + frames.length + images.length + shapes.length === 0) {\n    return;\n  }\n  const canvas = await edgelessRoot.clipboardController.toCanvas(\n    [...notes, ...frames, ...images],\n    shapes\n  );\n  if (!canvas) {\n    return;\n  }\n  return canvas;\n}\n\nexport async function selectedToPng(editor: EditorHost) {\n  return (await selectedToCanvas(editor))?.toDataURL('image/png');\n}\n\nexport async function getSelectedTextContent(editorHost: EditorHost) {\n  const slice = Slice.fromModels(\n    editorHost.std.doc,\n    getRootService(editorHost).selectedModels\n  );\n  return getMarkdownFromSlice(editorHost, slice);\n}\n\nexport const stopPropagation = (e: Event) => {\n  e.stopPropagation();\n};\n\nexport function getSurfaceElementFromEditor(editor: EditorHost) {\n  const { doc } = editor;\n  const surfaceModel = doc.getBlockByFlavour('affine:surface')[0];\n  assertExists(surfaceModel);\n\n  const surfaceId = surfaceModel.id;\n  const surfaceElement = editor.querySelector(\n    `affine-surface[data-block-id=\"${surfaceId}\"]`\n  ) as SurfaceBlockComponent;\n  assertExists(surfaceElement);\n\n  return surfaceElement;\n}\n\nexport const getFirstImageInFrame = (\n  frame: FrameBlockModel,\n  editor: EditorHost\n) => {\n  const edgelessRoot = getEdgelessRootFromEditor(editor);\n  const elements = edgelessRoot.service.frame.getElementsInFrame(frame, false);\n  const image = elements.find(ele => {\n    if (!BlocksUtils.isCanvasElement(ele)) {\n      return ele.flavour === 'affine:image';\n    }\n    return false;\n  }) as ImageBlockModel | undefined;\n  return image?.id;\n};\n","import { Bound } from '@blocksuite/global/utils';\nimport { nanoid } from '@blocksuite/store';\n\nimport { AIProvider } from '../provider';\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst replaceText = (text: Record<string, string>, template: any) => {\n  if (template != null && typeof template === 'object') {\n    if (Array.isArray(template)) {\n      template.forEach(v => replaceText(text, v));\n      return;\n    }\n    if (typeof template.insert === 'string') {\n      template.insert = text[template.insert] ?? template.insert;\n    }\n    Object.values(template).forEach(v => replaceText(text, v));\n    return;\n  }\n};\n\nfunction seededRNG(seed: string) {\n  const a = 1664525;\n  const c = 1013904223;\n  const m = 2 ** 32;\n  const seededNumber = stringToNumber(seed);\n  return ((a * seededNumber + c) % m) / m;\n\n  function stringToNumber(str: string) {\n    let res = 0;\n    for (let i = 0; i < str.length; i++) {\n      const character = str.charCodeAt(i);\n      res += character;\n    }\n    return res;\n  }\n}\n\nconst getImageUrlByKeyword =\n  (keyword: string) =>\n  async (w: number, h: number): Promise<string> => {\n    const photos = await AIProvider.photoEngine?.searchImages({\n      query: keyword,\n      width: w,\n      height: h,\n    });\n\n    if (photos == null || photos.length === 0) {\n      return ''; // fixme: give a default image\n    }\n\n    // use a stable random seed\n    const rng = seededRNG(`${w}.${h}.${keyword}`);\n    return photos[Math.floor(rng * photos.length)];\n  };\n\nconst getImages = async (\n  images: Record<string, (w: number, h: number) => Promise<string> | string>,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  template: any\n): Promise<TemplateImage[]> => {\n  const imgs: Record<\n    string,\n    {\n      id: string;\n      width: number;\n      height: number;\n    }\n  > = {};\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const run = (data: any) => {\n    if (data != null && typeof data === 'object') {\n      if (Array.isArray(data)) {\n        data.forEach(v => run(v));\n        return;\n      }\n      if (typeof data.caption === 'string') {\n        const bound = Bound.deserialize(data.xywh);\n        const id = nanoid();\n        data.sourceId = id;\n        imgs[data.caption] = {\n          id: id,\n          width: bound.w,\n          height: bound.h,\n        };\n        delete data.caption;\n      }\n      Object.values(data).forEach(v => run(v));\n      return;\n    }\n  };\n  run(template);\n  const list = await Promise.all(\n    Object.entries(imgs).map(async ([name, data]) => {\n      const getImage = images[name];\n      if (!getImage) {\n        return;\n      }\n      const url = await getImage(data.width, data.height);\n      return {\n        id: data.id,\n        url,\n      } satisfies TemplateImage;\n    })\n  );\n  const notNull = (v?: TemplateImage): v is TemplateImage => {\n    return v != null;\n  };\n  return list.filter(notNull);\n};\n\nexport type PPTSection = {\n  title: string;\n  content: string;\n  keywords: string;\n};\n\nexport type TemplateImage = {\n  id: string;\n  url: string;\n};\n\ntype DocTemplate = {\n  images: TemplateImage[];\n  content: unknown;\n};\n\nconst createBasicCover = async (\n  title: string,\n  section1: PPTSection\n): Promise<DocTemplate> => {\n  const templates = (await import('./templates/cover.json')).default;\n  const template = getRandomElement(templates);\n  replaceText(\n    {\n      title: title,\n      'section1.title': section1.title,\n      'section1.content': section1.content,\n    },\n    template\n  );\n  return {\n    images: await getImages(\n      {\n        'section1.image': getImageUrlByKeyword(section1.keywords),\n      },\n      template\n    ),\n    content: template,\n  };\n};\n\nfunction getRandomElement<T>(arr: T[]): T {\n  return JSON.parse(\n    JSON.stringify(arr[Math.floor(Math.random() * arr.length)])\n  );\n}\n\nconst basic1section = async (\n  title: string,\n  section1: PPTSection\n): Promise<DocTemplate> => {\n  const templates = (await import('./templates/one.json')).default;\n  const template = getRandomElement(templates);\n  replaceText(\n    {\n      title: title,\n      'section1.title': section1.title,\n      'section1.content': section1.content,\n    },\n    template\n  );\n  const images = await getImages(\n    {\n      'section1.image': getImageUrlByKeyword(section1.keywords),\n      'section1.image2': getImageUrlByKeyword(section1.keywords),\n      'section1.image3': getImageUrlByKeyword(section1.keywords),\n    },\n    template\n  );\n\n  return {\n    images: images,\n    content: template,\n  };\n};\n\nconst basic2section = async (\n  title: string,\n  section1: PPTSection,\n  section2: PPTSection\n): Promise<DocTemplate> => {\n  const templates = (await import('./templates/two.json')).default;\n  const template = getRandomElement(templates);\n  replaceText(\n    {\n      title: title,\n      'section1.title': section1.title,\n      'section1.content': section1.content,\n      'section2.title': section2.title,\n      'section2.content': section2.content,\n    },\n    template\n  );\n  return {\n    images: await getImages(\n      {\n        'section1.image': getImageUrlByKeyword(section1.keywords),\n        'section2.image': getImageUrlByKeyword(section2.keywords),\n        background: () =>\n          'https://cdn.affine.pro/ppt-images/background/basic_2_selection_background.png',\n      },\n      template\n    ),\n    content: template,\n  };\n};\n\nconst basic3section = async (\n  title: string,\n  section1: PPTSection,\n  section2: PPTSection,\n  section3: PPTSection\n): Promise<DocTemplate> => {\n  const templates = (await import('./templates/three.json')).default;\n  const template = getRandomElement(templates);\n  replaceText(\n    {\n      title: title,\n      'section1.title': section1.title,\n      'section1.content': section1.content,\n      'section2.title': section2.title,\n      'section2.content': section2.content,\n      'section3.title': section3.title,\n      'section3.content': section3.content,\n    },\n    template\n  );\n  return {\n    images: await getImages(\n      {\n        'section1.image': getImageUrlByKeyword(section1.keywords),\n        'section2.image': getImageUrlByKeyword(section2.keywords),\n        'section3.image': getImageUrlByKeyword(section3.keywords),\n        background: () =>\n          'https://cdn.affine.pro/ppt-images/background/basic_3_selection_background.png',\n      },\n      template\n    ),\n    content: template,\n  };\n};\n\nconst basic4section = async (\n  title: string,\n  section1: PPTSection,\n  section2: PPTSection,\n  section3: PPTSection,\n  section4: PPTSection\n): Promise<DocTemplate> => {\n  const templates = (await import('./templates/four.json')).default;\n  const template = getRandomElement(templates);\n  replaceText(\n    {\n      title: title,\n      'section1.title': section1.title,\n      'section1.content': section1.content,\n      'section2.title': section2.title,\n      'section2.content': section2.content,\n      'section3.title': section3.title,\n      'section3.content': section3.content,\n      'section4.title': section4.title,\n      'section4.content': section4.content,\n    },\n    template\n  );\n  return {\n    images: await getImages(\n      {\n        'section1.image': getImageUrlByKeyword(section1.keywords),\n        'section2.image': getImageUrlByKeyword(section2.keywords),\n        'section3.image': getImageUrlByKeyword(section3.keywords),\n        'section4.image': getImageUrlByKeyword(section4.keywords),\n        background: () =>\n          'https://cdn.affine.pro/ppt-images/background/basic_4_selection_background.png',\n      },\n      template\n    ),\n    content: template,\n  };\n};\n\nexport type PPTDoc = {\n  isCover: boolean;\n  title: string;\n  sections: PPTSection[];\n};\n\nexport const basicTheme = (doc: PPTDoc) => {\n  if (doc.isCover) {\n    return createBasicCover(doc.title, doc.sections[0]);\n  }\n  if (doc.sections.length === 1) {\n    return basic1section(doc.title, doc.sections[0]);\n  }\n  if (doc.sections.length === 2) {\n    return basic2section(doc.title, doc.sections[0], doc.sections[1]);\n  }\n  if (doc.sections.length === 3) {\n    return basic3section(\n      doc.title,\n      doc.sections[0],\n      doc.sections[1],\n      doc.sections[2]\n    );\n  }\n  return basic4section(\n    doc.title,\n    doc.sections[0],\n    doc.sections[1],\n    doc.sections[2],\n    doc.sections[3]\n  );\n};\n","import type { EditorHost } from '@blocksuite/block-std';\nimport type { EdgelessRootService } from '@blocksuite/blocks';\nimport type { BlockSnapshot } from '@blocksuite/store';\n\nimport { markdownToSnapshot } from '../_common/markdown-utils';\nimport { getSurfaceElementFromEditor } from '../_common/selection-utils';\nimport {\n  basicTheme,\n  type PPTDoc,\n  type PPTSection,\n  type TemplateImage,\n} from './template';\n\nexport const PPTBuilder = (host: EditorHost) => {\n  const service = host.spec.getService<EdgelessRootService>('affine:page');\n  const docs: PPTDoc[] = [];\n  const contents: unknown[] = [];\n  const allImages: TemplateImage[][] = [];\n\n  const addDoc = async (block: BlockSnapshot) => {\n    const sections = block.children.map(v => {\n      const title = getText(v);\n      const keywords = getText(v.children[0]);\n      const content = getText(v.children[1]);\n      return {\n        title,\n        keywords,\n        content,\n      } satisfies PPTSection;\n    });\n    const doc: PPTDoc = {\n      isCover: docs.length === 0,\n      title: getText(block),\n      sections,\n    };\n    docs.push(doc);\n\n    if (doc.isCover) return;\n    const job = service.createTemplateJob('template');\n    const { images, content } = await basicTheme(doc);\n    contents.push(content);\n    allImages.push(images);\n    if (images.length) {\n      await Promise.all(\n        images.map(({ id, url }) =>\n          fetch(url)\n            .then(res => res.blob())\n            .then(blob => job.job.assets.set(id, blob))\n        )\n      );\n    }\n    await job.insertTemplate(content);\n    getSurfaceElementFromEditor(host).refresh();\n  };\n\n  return {\n    process: async (text: string) => {\n      try {\n        const snapshot = await markdownToSnapshot(text, host);\n\n        const block = snapshot.snapshot.content[0];\n        for (const child of block.children) {\n          await addDoc(child);\n          const { centerX, centerY, zoom } = service.getFitToScreenData();\n          service.viewport.setViewport(zoom, [centerX, centerY]);\n        }\n      } catch (e) {\n        console.error(e);\n      }\n\n      return { contents, images: allImages };\n    },\n    done: async (text: string) => {\n      const snapshot = await markdownToSnapshot(text, host);\n      const block = snapshot.snapshot.content[0];\n      await addDoc(block.children[block.children.length - 1]);\n    },\n  };\n};\n\nconst getText = (block: BlockSnapshot) => {\n  // @ts-expect-error allow\n  return block.props.text?.delta?.[0]?.insert ?? '';\n};\n","export function preprocessHtml(answer: string) {\n  const start = answer.indexOf('<!DOCTYPE html>');\n  const end = answer.indexOf('</html>');\n  return answer.slice(start, end + '</html>'.length);\n}\n","import { fetchImage } from '@blocksuite/blocks';\nimport { assertExists } from '@blocksuite/global/utils';\n\nexport async function fetchImageToFile(\n  url: string,\n  filename: string,\n  imageProxy?: string\n): Promise<File | void> {\n  try {\n    const res = await fetchImage(url, undefined, imageProxy);\n    if (res && res.ok) {\n      let blob = await res.blob();\n      if (!blob.type || !blob.type.startsWith('image/')) {\n        blob = await convertToPng(blob).then(tmp => tmp || blob);\n      }\n      return new File([blob], filename, { type: blob.type || 'image/png' });\n    }\n  } catch (err) {\n    console.error(err);\n  }\n\n  return fetchImageFallback(url, filename);\n}\n\nfunction fetchImageFallback(\n  url: string,\n  filename: string\n): Promise<File | void> {\n  return new Promise(resolve => {\n    const img = new Image();\n    img.onload = () => {\n      const c = document.createElement('canvas');\n      c.width = img.width;\n      c.height = img.height;\n      const ctx = c.getContext('2d');\n      assertExists(ctx);\n      ctx.imageSmoothingEnabled = true;\n      ctx.imageSmoothingQuality = 'high';\n      ctx.drawImage(img, 0, 0);\n      c.toBlob(blob => {\n        if (blob) {\n          return resolve(new File([blob], filename, { type: blob.type }));\n        }\n        resolve();\n      }, 'image/png');\n    };\n    img.onerror = () => resolve();\n    img.crossOrigin = 'anonymous';\n    img.src = url;\n  });\n}\n\nfunction convertToPng(blob: Blob): Promise<Blob | null> {\n  return new Promise(resolve => {\n    const reader = new FileReader();\n    reader.addEventListener('load', _ => {\n      const img = new Image();\n      img.onload = () => {\n        const c = document.createElement('canvas');\n        c.width = img.width;\n        c.height = img.height;\n        const ctx = c.getContext('2d');\n        assertExists(ctx);\n        ctx.imageSmoothingEnabled = true;\n        ctx.imageSmoothingQuality = 'high';\n        ctx.drawImage(img, 0, 0);\n        c.toBlob(resolve, 'image/png');\n      };\n      img.onerror = () => resolve(null);\n      img.src = reader.result as string;\n    });\n    reader.addEventListener('error', () => resolve(null));\n    reader.readAsDataURL(blob);\n  });\n}\n\nexport function readBlobAsURL(blob: Blob | File) {\n  return new Promise<string>((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = e => {\n      if (typeof e.target?.result === 'string') {\n        resolve(e.target.result);\n      } else {\n        reject();\n      }\n    };\n    reader.onerror = reject;\n    reader.readAsDataURL(blob);\n  });\n}\n\nexport function canvasToBlob(\n  canvas: HTMLCanvasElement,\n  type = 'image/png',\n  quality?: number\n) {\n  return new Promise<Blob | null>(resolve =>\n    canvas.toBlob(resolve, type, quality)\n  );\n}\n\nexport function randomSeed(min = 0, max = Date.now()) {\n  return Math.round(Math.random() * (max - min)) + min;\n}\n","import type { EditorHost } from '@blocksuite/block-std';\nimport type {\n  AffineAIPanelWidget,\n  AIItemConfig,\n  EdgelessCopilotWidget,\n  EdgelessElementToolbarWidget,\n  EdgelessRootService,\n  MindmapElementModel,\n  ShapeElementModel,\n  SurfaceBlockModel,\n} from '@blocksuite/blocks';\nimport {\n  DeleteIcon,\n  EDGELESS_ELEMENT_TOOLBAR_WIDGET,\n  EDGELESS_TEXT_BLOCK_MIN_HEIGHT,\n  EDGELESS_TEXT_BLOCK_MIN_WIDTH,\n  EdgelessTextBlockModel,\n  fitContent,\n  ImageBlockModel,\n  InsertBelowIcon,\n  NoteDisplayMode,\n  ResetIcon,\n} from '@blocksuite/blocks';\nimport { assertExists, Bound } from '@blocksuite/global/utils';\nimport type { TemplateResult } from 'lit';\n\nimport { AIPenIcon, ChatWithAIIcon } from '../_common/icons';\nimport { insertFromMarkdown } from '../_common/markdown-utils';\nimport { getSurfaceElementFromEditor } from '../_common/selection-utils';\nimport { getAIPanel } from '../ai-panel';\nimport { AIProvider } from '../provider';\nimport { reportResponse } from '../utils/action-reporter';\nimport {\n  getEdgelessCopilotWidget,\n  getService,\n  isMindMapRoot,\n} from '../utils/edgeless';\nimport { preprocessHtml } from '../utils/html';\nimport { fetchImageToFile } from '../utils/image';\nimport {\n  getCopilotSelectedElems,\n  getEdgelessRootFromEditor,\n  getEdgelessService,\n} from '../utils/selection-utils';\nimport { EXCLUDING_INSERT_ACTIONS, generatingStages } from './consts';\nimport type { CtxRecord } from './types';\n\ntype FinishConfig = Exclude<\n  AffineAIPanelWidget['config'],\n  null\n>['finishStateConfig'];\n\ntype ErrorConfig = Exclude<\n  AffineAIPanelWidget['config'],\n  null\n>['errorStateConfig'];\n\nexport function getElementToolbar(\n  host: EditorHost\n): EdgelessElementToolbarWidget {\n  const rootBlockId = host.doc.root?.id as string;\n  const elementToolbar = host.view.getWidget(\n    EDGELESS_ELEMENT_TOOLBAR_WIDGET,\n    rootBlockId\n  ) as EdgelessElementToolbarWidget;\n\n  return elementToolbar;\n}\n\nexport function getTriggerEntry(host: EditorHost) {\n  const copilotWidget = getEdgelessCopilotWidget(host);\n\n  return copilotWidget.visible ? 'selection' : 'toolbar';\n}\n\nexport function discard(\n  panel: AffineAIPanelWidget,\n  _: EdgelessCopilotWidget\n): AIItemConfig {\n  return {\n    name: 'Discard',\n    icon: DeleteIcon,\n    showWhen: () => !!panel.answer,\n    handler: () => {\n      panel.discard();\n    },\n  };\n}\n\nexport function retry(panel: AffineAIPanelWidget): AIItemConfig {\n  return {\n    name: 'Retry',\n    icon: ResetIcon,\n    handler: () => {\n      reportResponse('result:retry');\n      panel.generate();\n    },\n  };\n}\n\nexport function createInsertResp<T extends keyof BlockSuitePresets.AIActions>(\n  id: T,\n  handler: (host: EditorHost, ctx: CtxRecord) => void,\n  host: EditorHost,\n  ctx: CtxRecord,\n  buttonText: string = 'Insert below'\n): AIItemConfig {\n  return {\n    name: buttonText,\n    icon: InsertBelowIcon,\n    showWhen: () => {\n      const panel = getAIPanel(host);\n      return !EXCLUDING_INSERT_ACTIONS.includes(id) && !!panel.answer;\n    },\n    handler: () => {\n      reportResponse('result:insert');\n      handler(host, ctx);\n      const panel = getAIPanel(host);\n      panel.hide();\n    },\n  };\n}\n\nexport function asCaption<T extends keyof BlockSuitePresets.AIActions>(\n  id: T,\n  host: EditorHost\n): AIItemConfig {\n  return {\n    name: 'Use as caption',\n    icon: AIPenIcon,\n    showWhen: () => {\n      const panel = getAIPanel(host);\n      return id === 'generateCaption' && !!panel.answer;\n    },\n    handler: () => {\n      reportResponse('result:use-as-caption');\n      const panel = getAIPanel(host);\n      const caption = panel.answer;\n      if (!caption) return;\n\n      const selectedElements = getCopilotSelectedElems(host);\n      if (selectedElements.length !== 1) return;\n\n      const imageBlock = selectedElements[0];\n      if (!(imageBlock instanceof ImageBlockModel)) return;\n\n      host.doc.updateBlock(imageBlock, { caption });\n      panel.hide();\n    },\n  };\n}\n\ntype MindMapNode = {\n  text: string;\n  children: MindMapNode[];\n};\n\nfunction insertBelow(\n  host: EditorHost,\n  markdown: string,\n  parentId: string,\n  index = 0\n) {\n  insertFromMarkdown(host, markdown, parentId, index)\n    .then(() => {\n      const service = getService(host);\n\n      service.selection.set({\n        elements: [parentId],\n        editing: false,\n      });\n    })\n    .catch(err => {\n      console.error(err);\n    });\n}\n\nfunction createBlockAndInsert(\n  host: EditorHost,\n  markdown: string,\n  type: 'edgelessText' | 'note'\n) {\n  const doc = host.doc;\n  const edgelessCopilot = getEdgelessCopilotWidget(host);\n  doc.transact(() => {\n    assertExists(doc.root);\n    let blockId = '';\n    const bounds = edgelessCopilot.determineInsertionBounds(\n      EDGELESS_TEXT_BLOCK_MIN_WIDTH,\n      EDGELESS_TEXT_BLOCK_MIN_HEIGHT\n    );\n    const surfaceBlock = doc.getBlocksByFlavour('affine:surface')[0];\n    if (type === 'edgelessText') {\n      blockId = doc.addBlock(\n        'affine:edgeless-text',\n        {\n          xywh: bounds.serialize(),\n        },\n        surfaceBlock.id\n      );\n    } else {\n      const bounds = edgelessCopilot.determineInsertionBounds(800, 95);\n      blockId = doc.addBlock(\n        'affine:note',\n        {\n          xywh: bounds.serialize(),\n          displayMode: NoteDisplayMode.EdgelessOnly,\n        },\n        doc.root.id\n      );\n    }\n\n    insertBelow(host, markdown, blockId);\n  });\n}\n\n/**\n * defaultHandler is the default handler for inserting AI response into the edgeless document.\n * Three situations are handled by this handler:\n * 1. When selection is a single EdgelessText block, insert the response to the last of the block.\n * 2. When selections are multiple EdgelessText blocks, insert the response to a new EdgelessBlock.\n * 3. Otherwise, insert the response to a new Note block.\n * @param host EditorHost\n */\nconst defaultHandler = (host: EditorHost) => {\n  const panel = getAIPanel(host);\n  const selectedElements = getCopilotSelectedElems(host);\n\n  assertExists(panel.answer);\n  if (\n    selectedElements.length === 1 &&\n    selectedElements[0] instanceof EdgelessTextBlockModel\n  ) {\n    const edgelessTextBlockId = selectedElements[0].id;\n    const index = selectedElements[0].children.length;\n    insertBelow(host, panel.answer, edgelessTextBlockId, index);\n  } else if (\n    selectedElements.length > 1 &&\n    selectedElements.every(el => el instanceof EdgelessTextBlockModel)\n  ) {\n    createBlockAndInsert(host, panel.answer, 'edgelessText');\n  } else {\n    createBlockAndInsert(host, panel.answer, 'note');\n  }\n};\n\n/**\n * Image handler for inserting generated image into the edgeless document.\n * Should make the inserting image size same with the input image if there is an input image.\n * @param host\n */\nconst imageHandler = (host: EditorHost) => {\n  const aiPanel = getAIPanel(host);\n  // `DataURL` or `URL`\n  const data = aiPanel.answer;\n  if (!data) return;\n\n  const edgelessCopilot = getEdgelessCopilotWidget(host);\n  const bounds = edgelessCopilot.determineInsertionBounds();\n  const selectedElements = getCopilotSelectedElems(host);\n  const selectedImageBlockModel = selectedElements.find(\n    model => model instanceof ImageBlockModel\n  );\n  const selectedBound = selectedImageBlockModel\n    ? Bound.deserialize(selectedImageBlockModel.xywh)\n    : null;\n\n  edgelessCopilot.hideCopilotPanel();\n  aiPanel.hide();\n\n  const filename = 'image';\n  const imageProxy = host.std.clipboard.configs.get('imageProxy');\n\n  fetchImageToFile(data, filename, imageProxy)\n    .then(img => {\n      if (!img) return;\n\n      const edgelessRoot = getEdgelessRootFromEditor(host);\n      const { minX, minY } = bounds;\n      const [x, y] = edgelessRoot.service.viewport.toViewCoord(minX, minY);\n\n      host.doc.transact(() => {\n        edgelessRoot\n          .addImages([img], [x, y], true)\n          .then(blockIds => {\n            const imageBlockId = blockIds[0];\n            const imageBlock = host.doc.getBlock(imageBlockId);\n            if (!imageBlock || !selectedBound) return;\n\n            // Update the image width and height to the same with the selected image\n            const imageModel = imageBlock.model as ImageBlockModel;\n            const imageBound = Bound.deserialize(imageModel.xywh);\n            const newBound = new Bound(\n              imageBound.x,\n              imageBound.y,\n              selectedBound.w,\n              selectedBound.h\n            );\n            host.doc.updateBlock(imageModel, { xywh: newBound.serialize() });\n          })\n          .catch(console.error);\n      });\n    })\n    .catch(console.error);\n};\n\nexport const responses: {\n  [key in keyof Partial<BlockSuitePresets.AIActions>]: (\n    host: EditorHost,\n    ctx: CtxRecord\n  ) => void;\n} = {\n  expandMindmap: (host, ctx) => {\n    const [surface] = host.doc.getBlockByFlavour(\n      'affine:surface'\n    ) as SurfaceBlockModel[];\n\n    const elements = ctx.get()[\n      'selectedElements'\n    ] as BlockSuite.EdgelessModel[];\n    const data = ctx.get() as {\n      node: MindMapNode;\n    };\n\n    queueMicrotask(() => {\n      getAIPanel(host).hide();\n    });\n\n    const mindmap = elements[0].group as MindmapElementModel;\n\n    if (!data?.node) return;\n\n    if (data.node.children) {\n      data.node.children.forEach(childTree => {\n        mindmap.addTree(elements[0].id, childTree);\n      });\n\n      const subtree = mindmap.getNode(elements[0].id);\n\n      if (!subtree) return;\n\n      surface.doc.transact(() => {\n        const updateNodeSize = (node: typeof subtree) => {\n          fitContent(node.element as ShapeElementModel);\n\n          node.children.forEach(child => {\n            updateNodeSize(child);\n          });\n        };\n\n        updateNodeSize(subtree);\n      });\n\n      setTimeout(() => {\n        const edgelessService = getEdgelessService(host);\n\n        edgelessService.selection.set({\n          elements: [subtree.element.id],\n          editing: false,\n        });\n      });\n    }\n  },\n  brainstormMindmap: (host, ctx) => {\n    const aiPanel = getAIPanel(host);\n    const edgelessService = getEdgelessService(host);\n    const edgelessCopilot = getEdgelessCopilotWidget(host);\n    const selectionRect = edgelessCopilot.selectionModelRect;\n    const [surface] = host.doc.getBlockByFlavour(\n      'affine:surface'\n    ) as SurfaceBlockModel[];\n    const elements = ctx.get()[\n      'selectedElements'\n    ] as BlockSuite.EdgelessModel[];\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const data = ctx.get() as any;\n    let newGenerated = true;\n\n    // This means regenerate\n    if (isMindMapRoot(elements[0])) {\n      const mindmap = elements[0].group as MindmapElementModel;\n      const xywh = mindmap.tree.element.xywh;\n\n      surface.removeElement(mindmap.id);\n\n      if (data.node) {\n        data.node.xywh = xywh;\n        newGenerated = false;\n      }\n    }\n\n    edgelessCopilot.hideCopilotPanel();\n    aiPanel.hide();\n\n    const mindmapId = surface.addElement({\n      type: 'mindmap',\n      children: data.node,\n      style: data.style,\n    });\n    const mindmap = surface.getElementById(mindmapId) as MindmapElementModel;\n\n    host.doc.transact(() => {\n      mindmap.childElements.forEach(shape => {\n        fitContent(shape as ShapeElementModel);\n      });\n    });\n\n    edgelessService.telemetryService?.track('CanvasElementAdded', {\n      control: 'ai',\n      page: 'whiteboard editor',\n      module: 'toolbar',\n      segment: 'toolbar',\n      type: 'mindmap',\n    });\n\n    queueMicrotask(() => {\n      if (newGenerated && selectionRect) {\n        mindmap.moveTo([\n          selectionRect.x,\n          selectionRect.y,\n          selectionRect.width,\n          selectionRect.height,\n        ]);\n      }\n    });\n\n    // This is a workaround to make sure mindmap and other microtask are done\n    setTimeout(() => {\n      edgelessService.viewport.setViewportByBound(\n        mindmap.elementBound,\n        [20, 20, 20, 20],\n        true\n      );\n\n      edgelessService.selection.set({\n        elements: [mindmap.tree.element.id],\n        editing: false,\n      });\n    });\n  },\n  makeItReal: (host, ctx) => {\n    const aiPanel = getAIPanel(host);\n    let html = aiPanel.answer;\n    if (!html) return;\n    html = preprocessHtml(html);\n\n    const edgelessCopilot = getEdgelessCopilotWidget(host);\n    const [surface] = host.doc.getBlockByFlavour(\n      'affine:surface'\n    ) as SurfaceBlockModel[];\n\n    const data = ctx.get();\n    const bounds = edgelessCopilot.determineInsertionBounds(\n      (data['width'] as number) || 800,\n      (data['height'] as number) || 600\n    );\n\n    edgelessCopilot.hideCopilotPanel();\n    aiPanel.hide();\n\n    const edgelessRoot = getEdgelessRootFromEditor(host);\n\n    host.doc.transact(() => {\n      edgelessRoot.doc.addBlock(\n        'affine:embed-html',\n        {\n          html,\n          design: 'ai:makeItReal', // as tag\n          xywh: bounds.serialize(),\n        },\n        surface.id\n      );\n    });\n  },\n  createSlides: (host, ctx) => {\n    const data = ctx.get();\n    const contents = data.contents as unknown[];\n    if (!contents) return;\n    const images = data.images as { url: string; id: string }[][];\n    const service = host.spec.getService<EdgelessRootService>('affine:page');\n\n    (async function () {\n      for (let i = 0; i < contents.length - 1; i++) {\n        const image = images[i];\n        const content = contents[i];\n        const job = service.createTemplateJob('template');\n        await Promise.all(\n          image.map(({ id, url }) =>\n            fetch(url)\n              .then(res => res.blob())\n              .then(blob => job.job.assets.set(id, blob))\n          )\n        );\n        await job.insertTemplate(content);\n        getSurfaceElementFromEditor(host).refresh();\n      }\n    })().catch(console.error);\n  },\n  createImage: imageHandler,\n  processImage: imageHandler,\n  filterImage: imageHandler,\n};\n\nconst getButtonText: {\n  [key in keyof Partial<BlockSuitePresets.AIActions>]: (\n    variants?: Omit<\n      Parameters<BlockSuitePresets.AIActions[key]>[0],\n      keyof BlockSuitePresets.AITextActionOptions\n    >\n  ) => string | undefined;\n} = {\n  brainstormMindmap: variants => {\n    return variants?.regenerate ? 'Replace' : undefined;\n  },\n};\n\nexport function getInsertAndReplaceHandler<\n  T extends keyof BlockSuitePresets.AIActions,\n>(\n  id: T,\n  host: EditorHost,\n  ctx: CtxRecord,\n  variants?: Omit<\n    Parameters<BlockSuitePresets.AIActions[T]>[0],\n    keyof BlockSuitePresets.AITextActionOptions\n  >\n) {\n  const handler = responses[id] ?? defaultHandler;\n  const buttonText = getButtonText[id]?.(variants) ?? undefined;\n\n  return createInsertResp(id, handler, host, ctx, buttonText);\n}\n\nexport function actionToResponse<T extends keyof BlockSuitePresets.AIActions>(\n  id: T,\n  host: EditorHost,\n  ctx: CtxRecord,\n  variants?: Omit<\n    Parameters<BlockSuitePresets.AIActions[T]>[0],\n    keyof BlockSuitePresets.AITextActionOptions\n  >\n): FinishConfig {\n  return {\n    responses: [\n      {\n        name: 'Response',\n        items: [\n          {\n            name: 'Continue in chat',\n            icon: ChatWithAIIcon,\n            handler: () => {\n              reportResponse('result:continue-in-chat');\n              const panel = getAIPanel(host);\n              AIProvider.slots.requestOpenWithChat.emit({ host });\n              panel.hide();\n            },\n          },\n          getInsertAndReplaceHandler(id, host, ctx, variants),\n          asCaption(id, host),\n          retry(getAIPanel(host)),\n          discard(getAIPanel(host), getEdgelessCopilotWidget(host)),\n        ],\n      },\n    ],\n    actions: [],\n  };\n}\n\nexport function actionToGenerating<T extends keyof BlockSuitePresets.AIActions>(\n  id: T,\n  generatingIcon: TemplateResult<1>\n) {\n  return {\n    generatingIcon,\n    stages: generatingStages[id],\n  };\n}\n\nexport function actionToErrorResponse<\n  T extends keyof BlockSuitePresets.AIActions,\n>(\n  panel: AffineAIPanelWidget,\n  id: T,\n  host: EditorHost,\n  ctx: CtxRecord,\n  variants?: Omit<\n    Parameters<BlockSuitePresets.AIActions[T]>[0],\n    keyof BlockSuitePresets.AITextActionOptions\n  >\n): ErrorConfig {\n  return {\n    upgrade: () => {\n      AIProvider.slots.requestUpgradePlan.emit({ host: panel.host });\n      panel.hide();\n    },\n    login: () => {\n      AIProvider.slots.requestLogin.emit({ host: panel.host });\n      panel.hide();\n    },\n    cancel: () => {\n      panel.hide();\n    },\n    responses: [\n      {\n        name: 'Response',\n        items: [getInsertAndReplaceHandler(id, host, ctx, variants)],\n      },\n      {\n        name: '',\n        items: [\n          retry(getAIPanel(host)),\n          discard(getAIPanel(host), getEdgelessCopilotWidget(host)),\n        ],\n      },\n    ],\n  };\n}\n","import type { EditorHost } from '@blocksuite/block-std';\nimport type {\n  AffineAIPanelWidget,\n  AIError,\n  EdgelessCopilotWidget,\n  MindmapElementModel,\n} from '@blocksuite/blocks';\nimport {\n  BlocksUtils,\n  EdgelessTextBlockModel,\n  EmbedSyncedDocModel,\n  ImageBlockModel,\n  NoteBlockModel,\n  ShapeElementModel,\n  TextElementModel,\n} from '@blocksuite/blocks';\nimport { assertExists } from '@blocksuite/global/utils';\nimport { AIChatBlockModel } from '@blocksuite/presets';\nimport { Slice } from '@blocksuite/store';\nimport type { TemplateResult } from 'lit';\n\nimport { getAIPanel } from '../ai-panel';\nimport {\n  createMindmapExecuteRenderer,\n  createMindmapRenderer,\n} from '../messages/mindmap';\nimport { createSlidesRenderer } from '../messages/slides-renderer';\nimport { createTextRenderer } from '../messages/text';\nimport { createIframeRenderer, createImageRenderer } from '../messages/wrapper';\nimport { AIProvider } from '../provider';\nimport { reportResponse } from '../utils/action-reporter';\nimport {\n  getEdgelessCopilotWidget,\n  isMindmapChild,\n  isMindMapRoot,\n} from '../utils/edgeless';\nimport { copyTextAnswer } from '../utils/editor-actions';\nimport { getContentFromSlice } from '../utils/markdown-utils';\nimport {\n  getCopilotSelectedElems,\n  getSelectedNoteAnchor,\n  getSelections,\n} from '../utils/selection-utils';\nimport { EXCLUDING_COPY_ACTIONS, IMAGE_ACTIONS } from './consts';\nimport { bindTextStream } from './doc-handler';\nimport {\n  actionToErrorResponse,\n  actionToGenerating,\n  actionToResponse,\n  getElementToolbar,\n  responses,\n} from './edgeless-response';\nimport type { CtxRecord } from './types';\n\ntype AnswerRenderer = NonNullable<\n  AffineAIPanelWidget['config']\n>['answerRenderer'];\n\nfunction actionToRenderer<T extends keyof BlockSuitePresets.AIActions>(\n  id: T,\n  host: EditorHost,\n  ctx: CtxRecord\n): AnswerRenderer {\n  if (id === 'brainstormMindmap') {\n    const selectedElements = ctx.get()[\n      'selectedElements'\n    ] as BlockSuite.EdgelessModel[];\n\n    if (\n      isMindMapRoot(selectedElements[0] || isMindmapChild(selectedElements[0]))\n    ) {\n      const mindmap = selectedElements[0].group as MindmapElementModel;\n\n      return createMindmapRenderer(host, ctx, mindmap.style);\n    }\n\n    return createMindmapRenderer(host, ctx);\n  }\n\n  if (id === 'expandMindmap') {\n    return createMindmapExecuteRenderer(host, ctx, ctx => {\n      responses['expandMindmap']?.(host, ctx);\n    });\n  }\n\n  if (id === 'createSlides') {\n    return createSlidesRenderer(host, ctx);\n  }\n\n  if (id === 'makeItReal') {\n    return createIframeRenderer(host, { height: 300 });\n  }\n\n  if (IMAGE_ACTIONS.includes(id)) {\n    return createImageRenderer(host, { height: 300 });\n  }\n\n  return createTextRenderer(host, { maxHeight: 320 });\n}\n\nasync function getContentFromEmbedSyncedDocModel(\n  host: EditorHost,\n  models: EmbedSyncedDocModel[]\n) {\n  const slice = Slice.fromModels(host.doc, models);\n  return (await getContentFromSlice(host, slice)).trim();\n}\n\nasync function getContentFromHubBlockModel(\n  host: EditorHost,\n  models: EdgelessTextBlockModel[] | NoteBlockModel[]\n) {\n  return (\n    await Promise.all(\n      models.map(model => {\n        const slice = Slice.fromModels(host.doc, model.children);\n        return getContentFromSlice(host, slice);\n      })\n    )\n  )\n    .map(content => content.trim())\n    .filter(content => content.length);\n}\n\nexport async function getContentFromSelected(\n  host: EditorHost,\n  selected: BlockSuite.EdgelessModel[]\n) {\n  type RemoveUndefinedKey<T, K extends keyof T> = T & {\n    [P in K]-?: Exclude<T[P], undefined>;\n  };\n\n  function isShapeWithText(\n    el: ShapeElementModel\n  ): el is RemoveUndefinedKey<ShapeElementModel, 'text'> {\n    return el.text !== undefined && el.text.length !== 0;\n  }\n\n  function isImageWithCaption(\n    el: ImageBlockModel\n  ): el is RemoveUndefinedKey<ImageBlockModel, 'caption'> {\n    return el.caption !== undefined && el.caption.length !== 0;\n  }\n\n  const { notes, texts, shapes, images, edgelessTexts, embedSyncedDocs } =\n    selected.reduce<{\n      notes: NoteBlockModel[];\n      texts: TextElementModel[];\n      shapes: RemoveUndefinedKey<ShapeElementModel, 'text'>[];\n      images: RemoveUndefinedKey<ImageBlockModel, 'caption'>[];\n      edgelessTexts: EdgelessTextBlockModel[];\n      embedSyncedDocs: EmbedSyncedDocModel[];\n    }>(\n      (pre, cur) => {\n        if (cur instanceof NoteBlockModel) {\n          pre.notes.push(cur);\n        } else if (cur instanceof TextElementModel) {\n          pre.texts.push(cur);\n        } else if (cur instanceof ShapeElementModel && isShapeWithText(cur)) {\n          pre.shapes.push(cur);\n        } else if (cur instanceof ImageBlockModel && isImageWithCaption(cur)) {\n          pre.images.push(cur);\n        } else if (cur instanceof EdgelessTextBlockModel) {\n          pre.edgelessTexts.push(cur);\n        } else if (cur instanceof EmbedSyncedDocModel) {\n          pre.embedSyncedDocs.push(cur);\n        }\n\n        return pre;\n      },\n      {\n        notes: [],\n        texts: [],\n        shapes: [],\n        images: [],\n        edgelessTexts: [],\n        embedSyncedDocs: [],\n      }\n    );\n\n  const noteContent = await getContentFromHubBlockModel(host, notes);\n  const edgelessTextContent = await getContentFromHubBlockModel(\n    host,\n    edgelessTexts\n  );\n  const syncedDocsContent = await getContentFromEmbedSyncedDocModel(\n    host,\n    embedSyncedDocs\n  );\n\n  return `${noteContent.join('\\n')}\n${edgelessTextContent.join('\\n')}\n${syncedDocsContent}\n${texts.map(text => text.text.toString()).join('\\n')}\n${shapes.map(shape => shape.text.toString()).join('\\n')}\n${images.map(image => image.caption.toString()).join('\\n')}\n`.trim();\n}\n\nfunction getTextFromSelected(host: EditorHost) {\n  const selected = getCopilotSelectedElems(host);\n  return getContentFromSelected(host, selected);\n}\n\nfunction actionToStream<T extends keyof BlockSuitePresets.AIActions>(\n  id: T,\n  signal?: AbortSignal,\n  variants?: Omit<\n    Parameters<BlockSuitePresets.AIActions[T]>[0],\n    keyof BlockSuitePresets.AITextActionOptions\n  >,\n  extract?: (\n    host: EditorHost,\n    ctx: CtxRecord\n  ) => Promise<{\n    content?: string;\n    attachments?: (string | Blob)[];\n    seed?: string;\n  } | void>,\n  trackerOptions?: BlockSuitePresets.TrackerOptions\n) {\n  const action = AIProvider.actions[id];\n\n  if (!action || typeof action !== 'function') return;\n\n  if (extract && typeof extract === 'function') {\n    return (host: EditorHost, ctx: CtxRecord): BlockSuitePresets.TextStream => {\n      let stream: BlockSuitePresets.TextStream | undefined;\n      const control = trackerOptions?.control || 'format-bar';\n      const where = trackerOptions?.where || 'ai-panel';\n      return {\n        async *[Symbol.asyncIterator]() {\n          const models = getCopilotSelectedElems(host);\n          const options = {\n            ...variants,\n            signal,\n            input: '',\n            stream: true,\n            control,\n            where,\n            models,\n            host,\n            docId: host.doc.id,\n            workspaceId: host.doc.collection.id,\n          } as Parameters<typeof action>[0];\n\n          const data = await extract(host, ctx);\n          if (data) {\n            Object.assign(options, data);\n          }\n\n          // @ts-expect-error TODO(@Peng): maybe fix this\n          stream = action(options);\n          if (!stream) return;\n          yield* stream;\n        },\n      };\n    };\n  }\n\n  return (host: EditorHost): BlockSuitePresets.TextStream => {\n    let stream: BlockSuitePresets.TextStream | undefined;\n    return {\n      async *[Symbol.asyncIterator]() {\n        const panel = getAIPanel(host);\n        const models = getCopilotSelectedElems(host);\n        const markdown = await getTextFromSelected(panel.host);\n\n        const options = {\n          ...variants,\n          signal,\n          input: markdown,\n          stream: true,\n          where: 'ai-panel',\n          models,\n          control: 'format-bar',\n          host,\n          docId: host.doc.id,\n          workspaceId: host.doc.collection.id,\n        } as Parameters<typeof action>[0];\n\n        // @ts-expect-error TODO(@Peng): maybe fix this\n        stream = action(options);\n        if (!stream) return;\n        yield* stream;\n      },\n    };\n  };\n}\n\nfunction actionToGeneration<T extends keyof BlockSuitePresets.AIActions>(\n  id: T,\n  variants?: Omit<\n    Parameters<BlockSuitePresets.AIActions[T]>[0],\n    keyof BlockSuitePresets.AITextActionOptions\n  >,\n  extract?: (\n    host: EditorHost,\n    ctx: CtxRecord\n  ) => Promise<{\n    content?: string;\n    attachments?: (string | Blob)[];\n    seed?: string;\n  } | void>,\n  trackerOptions?: BlockSuitePresets.TrackerOptions\n) {\n  return (host: EditorHost, ctx: CtxRecord) => {\n    return ({\n      signal,\n      update,\n      finish,\n    }: {\n      input: string;\n      signal?: AbortSignal;\n      update: (text: string) => void;\n      finish: (state: 'success' | 'error' | 'aborted', err?: AIError) => void;\n    }) => {\n      if (!extract) {\n        const selectedElements = getCopilotSelectedElems(host);\n        if (selectedElements.length === 0) return;\n      }\n\n      const stream = actionToStream(\n        id,\n        signal,\n        variants,\n        extract,\n        trackerOptions\n      )?.(host, ctx);\n\n      if (!stream) return;\n\n      bindTextStream(stream, { update, finish, signal });\n    };\n  };\n}\n\nfunction updateEdgelessAIPanelConfig<\n  T extends keyof BlockSuitePresets.AIActions,\n>(\n  aiPanel: AffineAIPanelWidget,\n  edgelessCopilot: EdgelessCopilotWidget,\n  id: T,\n  generatingIcon: TemplateResult<1>,\n  ctx: CtxRecord,\n  variants?: Omit<\n    Parameters<BlockSuitePresets.AIActions[T]>[0],\n    keyof BlockSuitePresets.AITextActionOptions\n  >,\n  customInput?: (\n    host: EditorHost,\n    ctx: CtxRecord\n  ) => Promise<{\n    input?: string;\n    content?: string;\n    attachments?: (string | Blob)[];\n    seed?: string;\n  } | void>,\n  trackerOptions?: BlockSuitePresets.TrackerOptions\n) {\n  const host = aiPanel.host;\n  const { config } = aiPanel;\n  assertExists(config);\n  config.answerRenderer = actionToRenderer(id, host, ctx);\n  config.generateAnswer = actionToGeneration(\n    id,\n    variants,\n    customInput,\n    trackerOptions\n  )(host, ctx);\n  config.finishStateConfig = actionToResponse(id, host, ctx, variants);\n  config.generatingStateConfig = actionToGenerating(id, generatingIcon);\n  config.errorStateConfig = actionToErrorResponse(\n    aiPanel,\n    id,\n    host,\n    ctx,\n    variants\n  );\n  config.copy = {\n    allowed: !EXCLUDING_COPY_ACTIONS.includes(id),\n    onCopy: () => {\n      return copyTextAnswer(aiPanel);\n    },\n  };\n  config.discardCallback = () => {\n    reportResponse('result:discard');\n  };\n  config.hideCallback = () => {\n    aiPanel.updateComplete\n      .finally(() => {\n        edgelessCopilot.edgeless.service.tool.switchToDefaultMode({\n          elements: [],\n          editing: false,\n        });\n        host.selection.clear();\n        edgelessCopilot.lockToolbar(false);\n      })\n      .catch(console.error);\n  };\n}\n\nexport function actionToHandler<T extends keyof BlockSuitePresets.AIActions>(\n  id: T,\n  generatingIcon: TemplateResult<1>,\n  variants?: Omit<\n    Parameters<BlockSuitePresets.AIActions[T]>[0],\n    keyof BlockSuitePresets.AITextActionOptions\n  >,\n  customInput?: (\n    host: EditorHost,\n    ctx: CtxRecord\n  ) => Promise<{\n    input?: string;\n    content?: string;\n    attachments?: (string | Blob)[];\n    seed?: string;\n  } | void>,\n  trackerOptions?: BlockSuitePresets.TrackerOptions\n) {\n  return (host: EditorHost) => {\n    const aiPanel = getAIPanel(host);\n    const edgelessCopilot = getEdgelessCopilotWidget(host);\n    let internal: Record<string, unknown> = {};\n    const selectedElements = getCopilotSelectedElems(host);\n    const { selectedBlocks } = getSelections(host);\n    const ctx = {\n      get() {\n        return {\n          ...internal,\n          selectedElements,\n        };\n      },\n      set(data: Record<string, unknown>) {\n        internal = data;\n      },\n    };\n\n    edgelessCopilot.hideCopilotPanel();\n    edgelessCopilot.lockToolbar(true);\n\n    updateEdgelessAIPanelConfig(\n      aiPanel,\n      edgelessCopilot,\n      id,\n      generatingIcon,\n      ctx,\n      variants,\n      customInput,\n      trackerOptions\n    );\n\n    const elementToolbar = getElementToolbar(host);\n    const isEmpty = selectedElements.length === 0;\n    const isCreateImageAction = id === 'createImage';\n    const isMakeItRealAction = !isCreateImageAction && id === 'makeItReal';\n    let referenceElement = null;\n    let togglePanel = () => Promise.resolve(isEmpty);\n\n    if (selectedBlocks && selectedBlocks.length !== 0) {\n      referenceElement = selectedBlocks.at(-1);\n    } else if (edgelessCopilot.visible && edgelessCopilot.selectionElem) {\n      referenceElement = edgelessCopilot.selectionElem;\n    } else if (elementToolbar.toolbarVisible) {\n      referenceElement = getElementToolbar(host);\n    } else if (!isEmpty) {\n      const lastSelected = selectedElements.at(-1)?.id;\n      assertExists(lastSelected);\n      referenceElement = getSelectedNoteAnchor(host, lastSelected);\n    }\n\n    if (!referenceElement) return;\n\n    if (isCreateImageAction || isMakeItRealAction) {\n      togglePanel = async () => {\n        if (isEmpty) return true;\n        const { notes, shapes, images, edgelessTexts, embedSyncedDocs } =\n          BlocksUtils.splitElements(selectedElements);\n        const blocks = [\n          ...notes,\n          ...shapes,\n          ...images,\n          ...edgelessTexts,\n          ...embedSyncedDocs,\n        ];\n        if (blocks.length === 0) return true;\n        const content = await getContentFromSelected(host, blocks);\n        ctx.set({\n          content,\n        });\n        return content.length === 0;\n      };\n    }\n\n    togglePanel()\n      .then(isEmpty => {\n        aiPanel.toggle(referenceElement, isEmpty ? undefined : 'placeholder');\n      })\n      .catch(console.error);\n  };\n}\n\nexport function noteBlockOrTextShowWhen(\n  _: unknown,\n  __: unknown,\n  host: EditorHost\n) {\n  const selected = getCopilotSelectedElems(host);\n\n  return selected.some(\n    el =>\n      el instanceof NoteBlockModel ||\n      el instanceof TextElementModel ||\n      el instanceof EdgelessTextBlockModel\n  );\n}\n\n/**\n * Checks if the selected element is a NoteBlockModel with a single child element of code block.\n */\nexport function noteWithCodeBlockShowWen(\n  _: unknown,\n  __: unknown,\n  host: EditorHost\n) {\n  const selected = getCopilotSelectedElems(host);\n  if (!selected.length) return false;\n\n  return (\n    selected[0] instanceof NoteBlockModel &&\n    selected[0].children.length === 1 &&\n    BlocksUtils.matchFlavours(selected[0].children[0], ['affine:code'])\n  );\n}\n\nexport function mindmapChildShowWhen(\n  _: unknown,\n  __: unknown,\n  host: EditorHost\n) {\n  const selected = getCopilotSelectedElems(host);\n\n  return selected.length === 1 && isMindmapChild(selected[0]);\n}\n\nexport function imageOnlyShowWhen(_: unknown, __: unknown, host: EditorHost) {\n  const selected = getCopilotSelectedElems(host);\n\n  return selected.length === 1 && selected[0] instanceof ImageBlockModel;\n}\n\nexport function mindmapRootShowWhen(_: unknown, __: unknown, host: EditorHost) {\n  const selected = getCopilotSelectedElems(host);\n\n  return selected.length === 1 && isMindMapRoot(selected[0]);\n}\n\n// TODO(@chen): remove this function after the new AI chat block related function is fully implemented\nexport function notAllAIChatBlockShowWhen(\n  _: unknown,\n  __: unknown,\n  host: EditorHost\n) {\n  const selected = getCopilotSelectedElems(host);\n  if (selected.length === 0) return true;\n\n  const allAIChatBlocks = selected.every(\n    model => model instanceof AIChatBlockModel\n  );\n  return !allAIChatBlocks;\n}\n","import type { getCopilotHistoriesQuery, RequestOptions } from '@affine/graphql';\nimport type { EditorHost } from '@blocksuite/block-std';\nimport type { BlockModel } from '@blocksuite/store';\n\nexport const translateLangs = [\n  'English',\n  'Spanish',\n  'German',\n  'French',\n  'Italian',\n  'Simplified Chinese',\n  'Traditional Chinese',\n  'Japanese',\n  'Russian',\n  'Korean',\n] as const;\n\nexport const textTones = [\n  'Professional',\n  'Informal',\n  'Friendly',\n  'Critical',\n  'Humorous',\n] as const;\n\nexport const imageFilterStyles = [\n  'Clay style',\n  'Sketch style',\n  'Anime style',\n  'Pixel style',\n] as const;\n\nexport const imageProcessingTypes = [\n  'Clearer',\n  'Remove background',\n  'Convert to sticker',\n] as const;\n\nexport type CtxRecord = {\n  get(): Record<string, unknown>;\n  set(data: Record<string, unknown>): void;\n};\n\ndeclare global {\n  // eslint-disable-next-line @typescript-eslint/no-namespace\n  namespace BlockSuitePresets {\n    type TrackerControl =\n      | 'format-bar'\n      | 'slash-menu'\n      | 'chat-send'\n      | 'block-action-bar';\n\n    type TrackerWhere =\n      | 'chat-panel'\n      | 'inline-chat-panel'\n      | 'ai-panel'\n      | 'ai-chat-block';\n\n    interface TrackerOptions {\n      control: TrackerControl;\n      where: TrackerWhere;\n    }\n\n    interface AITextActionOptions {\n      input?: string;\n      stream?: boolean;\n      attachments?: (string | File | Blob)[]; // blob could only be strings for the moments (url or data urls)\n      signal?: AbortSignal;\n      retry?: boolean;\n\n      // action's context\n      docId: string;\n      workspaceId: string;\n\n      // internal context\n      host: EditorHost;\n      models?: (BlockModel | BlockSuite.SurfaceElementModel)[];\n      control: TrackerControl;\n      where: TrackerWhere;\n    }\n\n    interface AIForkChatSessionOptions {\n      docId: string;\n      workspaceId: string;\n      sessionId: string;\n      latestMessageId: string;\n    }\n\n    interface AIImageActionOptions extends AITextActionOptions {\n      content?: string;\n      seed?: string;\n    }\n\n    interface FilterImageOptions extends AIImageActionOptions {\n      style: (typeof imageFilterStyles)[number];\n    }\n\n    interface ProcessImageOptions extends AIImageActionOptions {\n      type: (typeof imageProcessingTypes)[number];\n    }\n\n    type TextStream = {\n      [Symbol.asyncIterator](): AsyncIterableIterator<string>;\n    };\n\n    type AIActionTextResponse<T extends AITextActionOptions> =\n      T['stream'] extends true ? TextStream : Promise<string>;\n\n    interface ChatOptions extends AITextActionOptions {\n      sessionId?: string;\n      isRootSession?: boolean;\n    }\n\n    interface TranslateOptions extends AITextActionOptions {\n      lang: (typeof translateLangs)[number];\n    }\n\n    interface ChangeToneOptions extends AITextActionOptions {\n      tone: (typeof textTones)[number];\n    }\n\n    interface ExpandMindMap extends AITextActionOptions {\n      mindmap: string;\n    }\n\n    interface BrainstormMindMap extends AITextActionOptions {\n      regenerate?: boolean;\n    }\n\n    interface AIActions {\n      // chat is a bit special because it's has a internally maintained session\n      chat<T extends ChatOptions>(options: T): AIActionTextResponse<T>;\n\n      summary<T extends AITextActionOptions>(\n        options: T\n      ): AIActionTextResponse<T>;\n      improveWriting<T extends AITextActionOptions>(\n        options: T\n      ): AIActionTextResponse<T>;\n      improveGrammar<T extends AITextActionOptions>(\n        options: T\n      ): AIActionTextResponse<T>;\n      fixSpelling<T extends AITextActionOptions>(\n        options: T\n      ): AIActionTextResponse<T>;\n      createHeadings<T extends AITextActionOptions>(\n        options: T\n      ): AIActionTextResponse<T>;\n      makeLonger<T extends AITextActionOptions>(\n        options: T\n      ): AIActionTextResponse<T>;\n      makeShorter<T extends AITextActionOptions>(\n        options: T\n      ): AIActionTextResponse<T>;\n      continueWriting<T extends AITextActionOptions>(\n        options: T\n      ): AIActionTextResponse<T>;\n      checkCodeErrors<T extends AITextActionOptions>(\n        options: T\n      ): AIActionTextResponse<T>;\n      explainCode<T extends AITextActionOptions>(\n        options: T\n      ): AIActionTextResponse<T>;\n      writeArticle<T extends AITextActionOptions>(\n        options: T\n      ): AIActionTextResponse<T>;\n      writeTwitterPost<T extends AITextActionOptions>(\n        options: T\n      ): AIActionTextResponse<T>;\n      writePoem<T extends AITextActionOptions>(\n        options: T\n      ): AIActionTextResponse<T>;\n      writeBlogPost<T extends AITextActionOptions>(\n        options: T\n      ): AIActionTextResponse<T>;\n      brainstorm<T extends AITextActionOptions>(\n        options: T\n      ): AIActionTextResponse<T>;\n      writeOutline<T extends AITextActionOptions>(\n        options: T\n      ): AIActionTextResponse<T>;\n\n      explainImage<T extends AITextActionOptions>(\n        options: T\n      ): AIActionTextResponse<T>;\n\n      findActions<T extends AITextActionOptions>(\n        options: T\n      ): AIActionTextResponse<T>;\n\n      // mindmap\n      brainstormMindmap<T extends BrainstormMindMap>(\n        options: T\n      ): AIActionTextResponse<T>;\n      expandMindmap<T extends ExpandMindMap>(\n        options: T\n      ): AIActionTextResponse<T>;\n\n      // presentation\n      createSlides<T extends AITextActionOptions>(\n        options: T\n      ): AIActionTextResponse<T>;\n\n      // explain this\n      explain<T extends AITextActionOptions>(\n        options: T\n      ): AIActionTextResponse<T>;\n\n      // actions with variants\n      translate<T extends TranslateOptions>(\n        options: T\n      ): AIActionTextResponse<T>;\n      changeTone<T extends ChangeToneOptions>(\n        options: T\n      ): AIActionTextResponse<T>;\n\n      // make it real, image to text\n      makeItReal<T extends AIImageActionOptions>(\n        options: T\n      ): AIActionTextResponse<T>;\n      createImage<T extends AIImageActionOptions>(\n        options: T\n      ): AIActionTextResponse<T>;\n      processImage<T extends ProcessImageOptions>(\n        options: T\n      ): AIActionTextResponse<T>;\n      filterImage<T extends FilterImageOptions>(\n        options: T\n      ): AIActionTextResponse<T>;\n      generateCaption<T extends AITextActionOptions>(\n        options: T\n      ): AIActionTextResponse<T>;\n    }\n\n    // TODO(@Peng): should be refactored to get rid of implement details (like messages, action, role, etc.)\n    interface AIHistory {\n      sessionId: string;\n      tokens: number;\n      action: string;\n      createdAt: string;\n      messages: {\n        id: string; // message id\n        content: string;\n        createdAt: string;\n        role: MessageRole;\n        attachments?: string[];\n      }[];\n    }\n\n    type MessageRole = 'user' | 'assistant';\n\n    type AIHistoryIds = Pick<AIHistory, 'sessionId' | 'messages'> & {\n      messages: Pick<\n        AIHistory['messages'][number],\n        'id' | 'createdAt' | 'role'\n      >[];\n    };\n\n    interface AIHistoryService {\n      // non chat histories\n      actions: (\n        workspaceId: string,\n        docId?: string\n      ) => Promise<AIHistory[] | undefined>;\n      chats: (\n        workspaceId: string,\n        docId?: string,\n        options?: RequestOptions<\n          typeof getCopilotHistoriesQuery\n        >['variables']['options']\n      ) => Promise<AIHistory[] | undefined>;\n      cleanup: (\n        workspaceId: string,\n        docId: string,\n        sessionIds: string[]\n      ) => Promise<void>;\n      ids: (\n        workspaceId: string,\n        docId?: string,\n        options?: RequestOptions<\n          typeof getCopilotHistoriesQuery\n        >['variables']['options']\n      ) => Promise<AIHistoryIds[] | undefined>;\n    }\n\n    interface AIPhotoEngineService {\n      searchImages(options: {\n        width: number;\n        height: number;\n        query: string;\n      }): Promise<string[]>;\n    }\n  }\n}\n","import type { Chain, EditorHost, InitCommandCtx } from '@blocksuite/block-std';\nimport {\n  type AIItemGroupConfig,\n  type AISubItemConfig,\n  type CopilotSelectionController,\n  EDGELESS_ELEMENT_TOOLBAR_WIDGET,\n  type EdgelessElementToolbarWidget,\n  matchFlavours,\n} from '@blocksuite/blocks';\nimport type { TemplateResult } from 'lit';\n\nimport { actionToHandler } from '../actions/doc-handler';\nimport { actionToHandler as edgelessActionToHandler } from '../actions/edgeless-handler';\nimport {\n  imageFilterStyles,\n  imageProcessingTypes,\n  textTones,\n  translateLangs,\n} from '../actions/types';\nimport { getAIPanel } from '../ai-panel';\nimport { AIProvider } from '../provider';\nimport {\n  getSelectedImagesAsBlobs,\n  getSelectedTextContent,\n  getSelections,\n} from '../utils/selection-utils';\nimport {\n  AIDoneIcon,\n  AIImageIcon,\n  AIImageIconWithAnimation,\n  AIMindMapIcon,\n  AIPenIcon,\n  AIPenIconWithAnimation,\n  AIPresentationIcon,\n  AIPresentationIconWithAnimation,\n  AISearchIcon,\n  AIStarIconWithAnimation,\n  ChatWithAIIcon,\n  CommentIcon,\n  ExplainIcon,\n  ImproveWritingIcon,\n  LanguageIcon,\n  LongerIcon,\n  MakeItRealIcon,\n  MakeItRealIconWithAnimation,\n  SelectionIcon,\n  ShorterIcon,\n  ToneIcon,\n} from './icons';\n\nexport const translateSubItem: AISubItemConfig[] = translateLangs.map(lang => {\n  return {\n    type: lang,\n    handler: actionToHandler('translate', AIStarIconWithAnimation, { lang }),\n  };\n});\n\nexport const toneSubItem: AISubItemConfig[] = textTones.map(tone => {\n  return {\n    type: tone,\n    handler: actionToHandler('changeTone', AIStarIconWithAnimation, { tone }),\n  };\n});\n\nexport function createImageFilterSubItem(\n  trackerOptions?: BlockSuitePresets.TrackerOptions\n) {\n  return imageFilterStyles.map(style => {\n    return {\n      type: style,\n      handler: edgelessHandler(\n        'filterImage',\n        AIImageIconWithAnimation,\n        {\n          style,\n        },\n        trackerOptions\n      ),\n    };\n  });\n}\n\nexport function createImageProcessingSubItem(\n  trackerOptions?: BlockSuitePresets.TrackerOptions\n) {\n  return imageProcessingTypes.map(type => {\n    return {\n      type,\n      handler: edgelessHandler(\n        'processImage',\n        AIImageIconWithAnimation,\n        {\n          type,\n        },\n        trackerOptions\n      ),\n    };\n  });\n}\n\nconst blockActionTrackerOptions: BlockSuitePresets.TrackerOptions = {\n  control: 'block-action-bar',\n  where: 'ai-panel',\n};\n\nconst textBlockShowWhen = (chain: Chain<InitCommandCtx>) => {\n  const [_, ctx] = chain\n    .getSelectedModels({\n      types: ['block', 'text'],\n    })\n    .run();\n  const { selectedModels } = ctx;\n  if (!selectedModels || selectedModels.length === 0) return false;\n\n  return selectedModels.some(model =>\n    matchFlavours(model, ['affine:paragraph', 'affine:list'])\n  );\n};\n\nconst codeBlockShowWhen = (chain: Chain<InitCommandCtx>) => {\n  const [_, ctx] = chain\n    .getSelectedModels({\n      types: ['block', 'text'],\n    })\n    .run();\n  const { selectedModels } = ctx;\n  if (!selectedModels || selectedModels.length > 1) return false;\n\n  const model = selectedModels[0];\n  return matchFlavours(model, ['affine:code']);\n};\n\nconst imageBlockShowWhen = (chain: Chain<InitCommandCtx>) => {\n  const [_, ctx] = chain\n    .getSelectedModels({\n      types: ['block'],\n    })\n    .run();\n  const { selectedModels } = ctx;\n  if (!selectedModels || selectedModels.length > 1) return false;\n\n  const model = selectedModels[0];\n  return matchFlavours(model, ['affine:image']);\n};\n\nconst EditAIGroup: AIItemGroupConfig = {\n  name: 'edit with ai',\n  items: [\n    {\n      name: 'Translate to',\n      icon: LanguageIcon,\n      showWhen: textBlockShowWhen,\n      subItem: translateSubItem,\n    },\n    {\n      name: 'Change tone to',\n      icon: ToneIcon,\n      showWhen: textBlockShowWhen,\n      subItem: toneSubItem,\n    },\n    {\n      name: 'Improve writing',\n      icon: ImproveWritingIcon,\n      showWhen: textBlockShowWhen,\n      handler: actionToHandler('improveWriting', AIStarIconWithAnimation),\n    },\n    {\n      name: 'Make it longer',\n      icon: LongerIcon,\n      showWhen: textBlockShowWhen,\n      handler: actionToHandler('makeLonger', AIStarIconWithAnimation),\n    },\n    {\n      name: 'Make it shorter',\n      icon: ShorterIcon,\n      showWhen: textBlockShowWhen,\n      handler: actionToHandler('makeShorter', AIStarIconWithAnimation),\n    },\n    {\n      name: 'Continue writing',\n      icon: AIPenIcon,\n      showWhen: textBlockShowWhen,\n      handler: actionToHandler('continueWriting', AIPenIconWithAnimation),\n    },\n  ],\n};\n\nconst DraftAIGroup: AIItemGroupConfig = {\n  name: 'draft with ai',\n  items: [\n    {\n      name: 'Write an article about this',\n      icon: AIPenIcon,\n      showWhen: textBlockShowWhen,\n      handler: actionToHandler('writeArticle', AIPenIconWithAnimation),\n    },\n    {\n      name: 'Write a tweet about this',\n      icon: AIPenIcon,\n      showWhen: textBlockShowWhen,\n      handler: actionToHandler('writeTwitterPost', AIPenIconWithAnimation),\n    },\n    {\n      name: 'Write a poem about this',\n      icon: AIPenIcon,\n      showWhen: textBlockShowWhen,\n      handler: actionToHandler('writePoem', AIPenIconWithAnimation),\n    },\n    {\n      name: 'Write a blog post about this',\n      icon: AIPenIcon,\n      showWhen: textBlockShowWhen,\n      handler: actionToHandler('writeBlogPost', AIPenIconWithAnimation),\n    },\n    {\n      name: 'Brainstorm ideas about this',\n      icon: AIPenIcon,\n      showWhen: textBlockShowWhen,\n      handler: actionToHandler('brainstorm', AIPenIconWithAnimation),\n    },\n  ],\n};\n\n// actions that initiated from a note in edgeless mode\n// 1. when running in doc mode, call requestRunInEdgeless (let affine to show toast)\n// 2. when running in edgeless mode\n//    a. get selected in the note and let the edgeless action to handle it\n//    b. insert the result using the note shape\nfunction edgelessHandler<T extends keyof BlockSuitePresets.AIActions>(\n  id: T,\n  generatingIcon: TemplateResult<1>,\n  variants?: Omit<\n    Parameters<BlockSuitePresets.AIActions[T]>[0],\n    keyof BlockSuitePresets.AITextActionOptions\n  >,\n  trackerOptions?: BlockSuitePresets.TrackerOptions\n) {\n  return (host: EditorHost) => {\n    if (host.doc.root?.id === undefined) return;\n    const edgeless = (\n      host.view.getWidget(\n        EDGELESS_ELEMENT_TOOLBAR_WIDGET,\n        host.doc.root.id\n      ) as EdgelessElementToolbarWidget\n    )?.edgeless;\n\n    if (!edgeless) {\n      AIProvider.slots.requestRunInEdgeless.emit({ host });\n    } else {\n      edgeless.tools.setEdgelessTool({ type: 'copilot' });\n      const currentController = edgeless.tools.controllers[\n        'copilot'\n      ] as CopilotSelectionController;\n      const selectedElements = edgeless.service.selection.selectedElements;\n      currentController.updateDragPointsWith(selectedElements, 10);\n      currentController.draggingAreaUpdated.emit(false); // do not show edgeless panel\n\n      return edgelessActionToHandler(\n        id,\n        generatingIcon,\n        variants,\n        async () => {\n          const selections = getSelections(host);\n          const [markdown, attachments] = await Promise.all([\n            getSelectedTextContent(host),\n            getSelectedImagesAsBlobs(host),\n          ]);\n          // for now if there are more than one selected blocks, we will not omit the attachments\n          const sendAttachments =\n            selections?.selectedBlocks?.length === 1 && attachments.length > 0;\n          return {\n            attachments: sendAttachments ? attachments : undefined,\n            content: sendAttachments ? '' : markdown,\n          };\n        },\n        trackerOptions\n      )(host);\n    }\n  };\n}\n\nconst ReviewWIthAIGroup: AIItemGroupConfig = {\n  name: 'review with ai',\n  items: [\n    {\n      name: 'Fix spelling',\n      icon: AIDoneIcon,\n      showWhen: textBlockShowWhen,\n      handler: actionToHandler('fixSpelling', AIStarIconWithAnimation),\n    },\n    {\n      name: 'Fix grammar',\n      icon: AIDoneIcon,\n      showWhen: textBlockShowWhen,\n      handler: actionToHandler('improveGrammar', AIStarIconWithAnimation),\n    },\n    {\n      name: 'Explain this image',\n      icon: AIPenIcon,\n      showWhen: imageBlockShowWhen,\n      handler: actionToHandler('explainImage', AIStarIconWithAnimation),\n    },\n    {\n      name: 'Explain this code',\n      icon: ExplainIcon,\n      showWhen: codeBlockShowWhen,\n      handler: actionToHandler('explainCode', AIStarIconWithAnimation),\n    },\n    {\n      name: 'Check code error',\n      icon: ExplainIcon,\n      showWhen: codeBlockShowWhen,\n      handler: actionToHandler('checkCodeErrors', AIStarIconWithAnimation),\n    },\n    {\n      name: 'Explain selection',\n      icon: SelectionIcon,\n      showWhen: textBlockShowWhen,\n      handler: actionToHandler('explain', AIStarIconWithAnimation),\n    },\n  ],\n};\n\nconst GenerateWithAIGroup: AIItemGroupConfig = {\n  name: 'generate with ai',\n  items: [\n    {\n      name: 'Summarize',\n      icon: AIPenIcon,\n      showWhen: textBlockShowWhen,\n      handler: actionToHandler('summary', AIPenIconWithAnimation),\n    },\n    {\n      name: 'Generate headings',\n      icon: AIPenIcon,\n      beta: true,\n      handler: actionToHandler('createHeadings', AIPenIconWithAnimation),\n      showWhen: chain => {\n        const [_, ctx] = chain\n          .getSelectedModels({\n            types: ['block', 'text'],\n          })\n          .run();\n        const { selectedModels } = ctx;\n        if (!selectedModels || selectedModels.length === 0) return false;\n\n        return selectedModels.every(\n          model =>\n            matchFlavours(model, ['affine:paragraph', 'affine:list']) &&\n            !model.type.startsWith('h')\n        );\n      },\n    },\n    {\n      name: 'Generate an image',\n      icon: AIImageIcon,\n      showWhen: textBlockShowWhen,\n      handler: edgelessHandler('createImage', AIImageIconWithAnimation),\n    },\n    {\n      name: 'Generate outline',\n      icon: AIPenIcon,\n      showWhen: textBlockShowWhen,\n      handler: actionToHandler('writeOutline', AIPenIconWithAnimation),\n    },\n    {\n      name: 'Brainstorm ideas with mind map',\n      icon: AIMindMapIcon,\n      showWhen: textBlockShowWhen,\n      handler: edgelessHandler('brainstormMindmap', AIPenIconWithAnimation),\n    },\n    {\n      name: 'Generate presentation',\n      icon: AIPresentationIcon,\n      showWhen: textBlockShowWhen,\n      handler: edgelessHandler('createSlides', AIPresentationIconWithAnimation),\n      beta: true,\n    },\n    {\n      name: 'Make it real',\n      icon: MakeItRealIcon,\n      beta: true,\n      showWhen: textBlockShowWhen,\n      handler: edgelessHandler('makeItReal', MakeItRealIconWithAnimation),\n    },\n    {\n      name: 'Find actions',\n      icon: AISearchIcon,\n      showWhen: textBlockShowWhen,\n      handler: actionToHandler('findActions', AIStarIconWithAnimation),\n      beta: true,\n    },\n  ],\n};\n\nconst OthersAIGroup: AIItemGroupConfig = {\n  name: 'Others',\n  items: [\n    {\n      name: 'Continue with AI',\n      icon: CommentIcon,\n      handler: host => {\n        const panel = getAIPanel(host);\n        AIProvider.slots.requestOpenWithChat.emit({ host, autoSelect: true });\n        panel.hide();\n      },\n    },\n    {\n      name: 'Open AI Chat',\n      icon: ChatWithAIIcon,\n      handler: host => {\n        const panel = getAIPanel(host);\n        AIProvider.slots.requestOpenWithChat.emit({ host });\n        panel.hide();\n      },\n    },\n  ],\n};\n\nexport const AIItemGroups: AIItemGroupConfig[] = [\n  ReviewWIthAIGroup,\n  EditAIGroup,\n  GenerateWithAIGroup,\n  DraftAIGroup,\n  OthersAIGroup,\n];\n\nexport function buildAIImageItemGroups(): AIItemGroupConfig[] {\n  return [\n    {\n      name: 'edit with ai',\n      items: [\n        {\n          name: 'Explain this image',\n          icon: AIImageIcon,\n          showWhen: () => true,\n          handler: actionToHandler(\n            'explainImage',\n            AIStarIconWithAnimation,\n            undefined,\n            blockActionTrackerOptions\n          ),\n        },\n      ],\n    },\n    {\n      name: 'generate with ai',\n      items: [\n        {\n          name: 'Generate an image',\n          icon: AIImageIcon,\n          showWhen: () => true,\n          handler: edgelessHandler(\n            'createImage',\n            AIImageIconWithAnimation,\n            undefined,\n            blockActionTrackerOptions\n          ),\n        },\n        {\n          name: 'Image processing',\n          icon: AIImageIcon,\n          showWhen: () => true,\n          subItem: createImageProcessingSubItem(blockActionTrackerOptions),\n          subItemOffset: [12, -6],\n          beta: true,\n        },\n        {\n          name: 'AI image filter',\n          icon: ImproveWritingIcon,\n          showWhen: () => true,\n          subItem: createImageFilterSubItem(blockActionTrackerOptions),\n          subItemOffset: [12, -4],\n          beta: true,\n        },\n        {\n          name: 'Generate a caption',\n          icon: AIPenIcon,\n          showWhen: () => true,\n          beta: true,\n          handler: actionToHandler(\n            'generateCaption',\n            AIStarIconWithAnimation,\n            undefined,\n            blockActionTrackerOptions\n          ),\n        },\n      ],\n    },\n    OthersAIGroup,\n  ];\n}\n\nexport function buildAICodeItemGroups(): AIItemGroupConfig[] {\n  return [\n    {\n      name: 'edit with ai',\n      items: [\n        {\n          name: 'Explain this code',\n          icon: ExplainIcon,\n          showWhen: () => true,\n          handler: actionToHandler(\n            'explainCode',\n            AIStarIconWithAnimation,\n            undefined,\n            blockActionTrackerOptions\n          ),\n        },\n        {\n          name: 'Check code error',\n          icon: ExplainIcon,\n          showWhen: () => true,\n          handler: actionToHandler(\n            'checkCodeErrors',\n            AIStarIconWithAnimation,\n            undefined,\n            blockActionTrackerOptions\n          ),\n        },\n      ],\n    },\n    OthersAIGroup,\n  ];\n}\n","import '../../_common/components/ask-ai-button';\n\nimport type {\n  AffineCodeToolbarWidget,\n  CodeBlockComponent,\n} from '@blocksuite/blocks';\nimport { html } from 'lit';\n\nconst AICodeItemGroups = buildAICodeItemGroups();\nconst buttonOptions: AskAIButtonOptions = {\n  size: 'small',\n  panelWidth: 240,\n};\n\nimport type { AskAIButtonOptions } from '../../_common/components/ask-ai-button';\nimport { buildAICodeItemGroups } from '../../_common/config';\nimport { AIStarIcon } from '../../_common/icons';\n\nexport function setupCodeToolbarEntry(codeToolbar: AffineCodeToolbarWidget) {\n  const onAskAIClick = () => {\n    const { host } = codeToolbar;\n    const { selection } = host;\n    const codeBlock = codeToolbar.block;\n    selection.setGroup('note', [\n      selection.create('block', { blockId: codeBlock.blockId }),\n    ]);\n  };\n  codeToolbar.setupDefaultConfig();\n  codeToolbar.addItems(\n    [\n      {\n        type: 'custom',\n        name: 'Ask AI',\n        tooltip: 'Ask AI',\n        icon: AIStarIcon,\n        showWhen: CodeBlockComponent => !CodeBlockComponent.doc.readonly,\n        render(codeBlock: CodeBlockComponent, onClick?: () => void) {\n          return html`<ask-ai-button\n            class=\"code-toolbar-button ask-ai\"\n            .host=${codeBlock.host}\n            .actionGroups=${AICodeItemGroups}\n            .toggleType=${'click'}\n            .options=${buttonOptions}\n            @click=${(e: MouseEvent) => {\n              e.stopPropagation();\n              onAskAIClick();\n              onClick?.();\n            }}\n          ></ask-ai-button>`;\n        },\n      },\n    ],\n    0\n  );\n}\n","import {\n  type AIItemGroupConfig,\n  AIStarIconWithAnimation,\n  BlocksUtils,\n  MindmapElementModel,\n  ShapeElementModel,\n  TextElementModel,\n} from '@blocksuite/blocks';\n\nimport {\n  AIExpandMindMapIcon,\n  AIImageIcon,\n  AIImageIconWithAnimation,\n  AIMindMapIcon,\n  AIMindMapIconWithAnimation,\n  AIPenIcon,\n  AIPenIconWithAnimation,\n  AIPresentationIcon,\n  AIPresentationIconWithAnimation,\n  AISearchIcon,\n  ChatWithAIIcon,\n  CommentIcon,\n  ExplainIcon,\n  ImproveWritingIcon,\n  LanguageIcon,\n  LongerIcon,\n  MakeItRealIcon,\n  MakeItRealIconWithAnimation,\n  SelectionIcon,\n  ShorterIcon,\n  ToneIcon,\n} from '../../_common/icons';\nimport {\n  actionToHandler,\n  imageOnlyShowWhen,\n  mindmapChildShowWhen,\n  mindmapRootShowWhen,\n  notAllAIChatBlockShowWhen,\n  noteBlockOrTextShowWhen,\n  noteWithCodeBlockShowWen,\n} from '../../actions/edgeless-handler';\nimport {\n  imageFilterStyles,\n  imageProcessingTypes,\n  textTones,\n  translateLangs,\n} from '../../actions/types';\nimport { getAIPanel } from '../../ai-panel';\nimport { AIProvider } from '../../provider';\nimport { mindMapToMarkdown } from '../../utils/edgeless';\nimport { canvasToBlob, randomSeed } from '../../utils/image';\nimport {\n  getCopilotSelectedElems,\n  getEdgelessRootFromEditor,\n  imageCustomInput,\n} from '../../utils/selection-utils';\n\nconst translateSubItem = translateLangs.map(lang => {\n  return {\n    type: lang,\n    handler: actionToHandler('translate', AIStarIconWithAnimation, { lang }),\n  };\n});\n\nconst toneSubItem = textTones.map(tone => {\n  return {\n    type: tone,\n    handler: actionToHandler('changeTone', AIStarIconWithAnimation, { tone }),\n  };\n});\n\nexport const imageFilterSubItem = imageFilterStyles.map(style => {\n  return {\n    type: style,\n    handler: actionToHandler(\n      'filterImage',\n      AIImageIconWithAnimation,\n      {\n        style,\n      },\n      imageCustomInput\n    ),\n  };\n});\n\nexport const imageProcessingSubItem = imageProcessingTypes.map(type => {\n  return {\n    type,\n    handler: actionToHandler(\n      'processImage',\n      AIImageIconWithAnimation,\n      {\n        type,\n      },\n      imageCustomInput\n    ),\n  };\n});\n\nconst othersGroup: AIItemGroupConfig = {\n  name: 'others',\n  items: [\n    {\n      name: 'Continue with AI',\n      icon: CommentIcon,\n      showWhen: () => true,\n      handler: host => {\n        const panel = getAIPanel(host);\n        AIProvider.slots.requestOpenWithChat.emit({\n          host,\n          mode: 'edgeless',\n          autoSelect: true,\n        });\n        panel.hide();\n      },\n    },\n    {\n      name: 'Open AI Chat',\n      icon: ChatWithAIIcon,\n      showWhen: () => true,\n      handler: host => {\n        const panel = getAIPanel(host);\n        AIProvider.slots.requestOpenWithChat.emit({ host, mode: 'edgeless' });\n        panel.hide();\n      },\n    },\n  ],\n};\n\nconst editGroup: AIItemGroupConfig = {\n  name: 'edit with ai',\n  items: [\n    {\n      name: 'Translate to',\n      icon: LanguageIcon,\n      showWhen: noteBlockOrTextShowWhen,\n      subItem: translateSubItem,\n    },\n    {\n      name: 'Change tone to',\n      icon: ToneIcon,\n      showWhen: noteBlockOrTextShowWhen,\n      subItem: toneSubItem,\n    },\n    {\n      name: 'Improve writing',\n      icon: ImproveWritingIcon,\n      showWhen: noteBlockOrTextShowWhen,\n      handler: actionToHandler('improveWriting', AIStarIconWithAnimation),\n    },\n\n    {\n      name: 'Make it longer',\n      icon: LongerIcon,\n      showWhen: noteBlockOrTextShowWhen,\n      handler: actionToHandler('makeLonger', AIStarIconWithAnimation),\n    },\n    {\n      name: 'Make it shorter',\n      icon: ShorterIcon,\n      showWhen: noteBlockOrTextShowWhen,\n      handler: actionToHandler('makeShorter', AIStarIconWithAnimation),\n    },\n    {\n      name: 'Continue writing',\n      icon: AIPenIcon,\n      showWhen: noteBlockOrTextShowWhen,\n      handler: actionToHandler('continueWriting', AIPenIconWithAnimation),\n    },\n  ],\n};\n\nconst draftGroup: AIItemGroupConfig = {\n  name: 'draft with ai',\n  items: [\n    {\n      name: 'Write an article about this',\n      icon: AIPenIcon,\n      showWhen: noteBlockOrTextShowWhen,\n      handler: actionToHandler('writeArticle', AIPenIconWithAnimation),\n    },\n    {\n      name: 'Write a tweet about this',\n      icon: AIPenIcon,\n      showWhen: noteBlockOrTextShowWhen,\n      handler: actionToHandler('writeTwitterPost', AIPenIconWithAnimation),\n    },\n    {\n      name: 'Write a poem about this',\n      icon: AIPenIcon,\n      showWhen: noteBlockOrTextShowWhen,\n      handler: actionToHandler('writePoem', AIPenIconWithAnimation),\n    },\n    {\n      name: 'Write a blog post about this',\n      icon: AIPenIcon,\n      showWhen: noteBlockOrTextShowWhen,\n      handler: actionToHandler('writeBlogPost', AIPenIconWithAnimation),\n    },\n    {\n      name: 'Brainstorm ideas about this',\n      icon: AIPenIcon,\n      showWhen: noteBlockOrTextShowWhen,\n      handler: actionToHandler('brainstorm', AIPenIconWithAnimation),\n    },\n  ],\n};\n\nconst reviewGroup: AIItemGroupConfig = {\n  name: 'review with ai',\n  items: [\n    {\n      name: 'Fix spelling',\n      icon: AIPenIcon,\n      showWhen: noteBlockOrTextShowWhen,\n      handler: actionToHandler('fixSpelling', AIStarIconWithAnimation),\n    },\n    {\n      name: 'Fix grammar',\n      icon: AIPenIcon,\n      showWhen: noteBlockOrTextShowWhen,\n      handler: actionToHandler('improveGrammar', AIStarIconWithAnimation),\n    },\n    {\n      name: 'Explain this image',\n      icon: AIPenIcon,\n      showWhen: imageOnlyShowWhen,\n      handler: actionToHandler(\n        'explainImage',\n        AIStarIconWithAnimation,\n        undefined,\n        imageCustomInput\n      ),\n    },\n    {\n      name: 'Explain this code',\n      icon: ExplainIcon,\n      showWhen: noteWithCodeBlockShowWen,\n      handler: actionToHandler('explainCode', AIStarIconWithAnimation),\n    },\n    {\n      name: 'Check code error',\n      icon: ExplainIcon,\n      showWhen: noteWithCodeBlockShowWen,\n      handler: actionToHandler('checkCodeErrors', AIStarIconWithAnimation),\n    },\n    {\n      name: 'Explain selection',\n      icon: SelectionIcon,\n      showWhen: noteBlockOrTextShowWhen,\n      handler: actionToHandler('explain', AIStarIconWithAnimation),\n    },\n  ],\n};\n\nconst generateGroup: AIItemGroupConfig = {\n  name: 'generate with ai',\n  items: [\n    {\n      name: 'Summarize',\n      icon: AIPenIcon,\n      showWhen: noteBlockOrTextShowWhen,\n      handler: actionToHandler('summary', AIPenIconWithAnimation),\n    },\n    {\n      name: 'Generate headings',\n      icon: AIPenIcon,\n      handler: actionToHandler('createHeadings', AIPenIconWithAnimation),\n      showWhen: noteBlockOrTextShowWhen,\n      beta: true,\n    },\n    {\n      name: 'Generate an image',\n      icon: AIImageIcon,\n      showWhen: notAllAIChatBlockShowWhen,\n      handler: actionToHandler(\n        'createImage',\n        AIImageIconWithAnimation,\n        undefined,\n        async (host, ctx) => {\n          const selectedElements = getCopilotSelectedElems(host);\n          const len = selectedElements.length;\n\n          const aiPanel = getAIPanel(host);\n          // text to image\n          // from user input\n          if (len === 0) {\n            const content = aiPanel.inputText?.trim();\n            if (!content) return;\n            return {\n              content,\n            };\n          }\n\n          let content = (ctx.get()['content'] as string) || '';\n\n          // from user input\n          if (content.length === 0) {\n            content = aiPanel.inputText?.trim() || '';\n          }\n\n          const {\n            images,\n            shapes,\n            notes: _,\n            frames: __,\n          } = BlocksUtils.splitElements(selectedElements);\n\n          const pureShapes = shapes.filter(\n            e =>\n              !(\n                e instanceof TextElementModel ||\n                (e instanceof ShapeElementModel && e.text?.length)\n              )\n          );\n\n          // text to image\n          if (content.length && images.length + pureShapes.length === 0) {\n            return {\n              content,\n            };\n          }\n\n          // image to image\n          const edgelessRoot = getEdgelessRootFromEditor(host);\n          const canvas = await edgelessRoot.clipboardController.toCanvas(\n            images,\n            pureShapes,\n            {\n              dpr: 1,\n              padding: 0,\n              background: 'white',\n            }\n          );\n          if (!canvas) return;\n\n          const png = await canvasToBlob(canvas);\n          if (!png) return;\n          return {\n            content,\n            attachments: [png],\n            seed: String(randomSeed()),\n          };\n        }\n      ),\n    },\n    {\n      name: 'Generate outline',\n      icon: AIPenIcon,\n      showWhen: noteBlockOrTextShowWhen,\n      handler: actionToHandler('writeOutline', AIPenIconWithAnimation),\n    },\n    {\n      name: 'Expand from this mind map node',\n      icon: AIExpandMindMapIcon,\n      showWhen: mindmapChildShowWhen,\n      handler: actionToHandler(\n        'expandMindmap',\n        AIMindMapIconWithAnimation,\n        undefined,\n        function (host) {\n          const selected = getCopilotSelectedElems(host);\n          const firstSelected = selected[0] as ShapeElementModel;\n          const mindmap = firstSelected?.group;\n\n          if (!(mindmap instanceof MindmapElementModel)) {\n            return Promise.resolve({});\n          }\n\n          return Promise.resolve({\n            input: firstSelected.text?.toString() ?? '',\n            mindmap: mindMapToMarkdown(mindmap),\n          });\n        }\n      ),\n      beta: true,\n    },\n    {\n      name: 'Brainstorm ideas with mind map',\n      icon: AIMindMapIcon,\n      showWhen: noteBlockOrTextShowWhen,\n      handler: actionToHandler('brainstormMindmap', AIMindMapIconWithAnimation),\n    },\n    {\n      name: 'Regenerate mind map',\n      icon: AIMindMapIcon,\n      showWhen: mindmapRootShowWhen,\n      handler: actionToHandler(\n        'brainstormMindmap',\n        AIMindMapIconWithAnimation,\n        {\n          regenerate: true,\n        }\n      ),\n    },\n    {\n      name: 'Generate presentation',\n      icon: AIPresentationIcon,\n      showWhen: noteBlockOrTextShowWhen,\n      handler: actionToHandler('createSlides', AIPresentationIconWithAnimation),\n      beta: true,\n    },\n    {\n      name: 'Make it real',\n      icon: MakeItRealIcon,\n      beta: true,\n      showWhen: notAllAIChatBlockShowWhen,\n      handler: actionToHandler(\n        'makeItReal',\n        MakeItRealIconWithAnimation,\n        undefined,\n        async (host, ctx) => {\n          const selectedElements = getCopilotSelectedElems(host);\n\n          // from user input\n          if (selectedElements.length === 0) {\n            const aiPanel = getAIPanel(host);\n            const content = aiPanel.inputText?.trim();\n            if (!content) return;\n            return {\n              content,\n            };\n          }\n\n          const { notes, frames, shapes, images, edgelessTexts } =\n            BlocksUtils.splitElements(selectedElements);\n          const f = frames.length;\n          const i = images.length;\n          const n = notes.length;\n          const s = shapes.length;\n          const e = edgelessTexts.length;\n\n          if (f + i + n + s + e === 0) {\n            return;\n          }\n          let content = (ctx.get()['content'] as string) || '';\n\n          // single note, text\n          if (\n            i === 0 &&\n            n + s + e === 1 &&\n            (n === 1 ||\n              e === 1 ||\n              (s === 1 && shapes[0] instanceof TextElementModel))\n          ) {\n            return {\n              content,\n            };\n          }\n\n          // from user input\n          if (content.length === 0) {\n            const aiPanel = getAIPanel(host);\n            content = aiPanel.inputText?.trim() || '';\n          }\n\n          const edgelessRoot = getEdgelessRootFromEditor(host);\n          const canvas = await edgelessRoot.clipboardController.toCanvas(\n            [...notes, ...frames, ...images],\n            shapes,\n            {\n              dpr: 1,\n              background: 'white',\n            }\n          );\n          if (!canvas) return;\n          const png = await canvasToBlob(canvas);\n          if (!png) return;\n          ctx.set({\n            width: canvas.width,\n            height: canvas.height,\n          });\n\n          return {\n            content,\n            attachments: [png],\n          };\n        }\n      ),\n    },\n    {\n      name: 'AI image filter',\n      icon: ImproveWritingIcon,\n      showWhen: imageOnlyShowWhen,\n      subItem: imageFilterSubItem,\n      subItemOffset: [12, -4],\n      beta: true,\n    },\n    {\n      name: 'Image processing',\n      icon: AIImageIcon,\n      showWhen: imageOnlyShowWhen,\n      subItem: imageProcessingSubItem,\n      subItemOffset: [12, -6],\n      beta: true,\n    },\n    {\n      name: 'Generate a caption',\n      icon: AIPenIcon,\n      showWhen: imageOnlyShowWhen,\n      beta: true,\n      handler: actionToHandler(\n        'generateCaption',\n        AIStarIconWithAnimation,\n        undefined,\n        imageCustomInput\n      ),\n    },\n    {\n      name: 'Find actions',\n      icon: AISearchIcon,\n      showWhen: noteBlockOrTextShowWhen,\n      handler: actionToHandler('findActions', AIStarIconWithAnimation),\n      beta: true,\n    },\n  ],\n};\n\nexport const edgelessActionGroups = [\n  reviewGroup,\n  editGroup,\n  generateGroup,\n  draftGroup,\n  othersGroup,\n];\n","import '../../_common/components/ask-ai-button';\n\nimport {\n  type AffineFormatBarWidget,\n  toolbarDefaultConfig,\n} from '@blocksuite/blocks';\nimport { html, type TemplateResult } from 'lit';\n\nimport { AIItemGroups } from '../../_common/config';\n\nexport function setupFormatBarEntry(formatBar: AffineFormatBarWidget) {\n  toolbarDefaultConfig(formatBar);\n  formatBar.addRawConfigItems(\n    [\n      {\n        type: 'custom' as const,\n        render(formatBar: AffineFormatBarWidget): TemplateResult | null {\n          return html` <ask-ai-button\n            .host=${formatBar.host}\n            .actionGroups=${AIItemGroups}\n            .toggleType=${'hover'}\n          ></ask-ai-button>`;\n        },\n      },\n      { type: 'divider' },\n    ],\n    0\n  );\n}\n","import type {\n  AIItemGroupConfig,\n  EdgelessCopilotWidget,\n  EdgelessElementToolbarWidget,\n  EdgelessRootBlockComponent,\n} from '@blocksuite/blocks';\nimport { EdgelessCopilotToolbarEntry } from '@blocksuite/blocks';\nimport { noop } from '@blocksuite/global/utils';\nimport { html } from 'lit';\n\nimport { edgelessActionGroups } from './actions-config';\n\nnoop(EdgelessCopilotToolbarEntry);\n\nexport function setupEdgelessCopilot(widget: EdgelessCopilotWidget) {\n  widget.groups = edgelessActionGroups;\n}\n\nexport function setupEdgelessElementToolbarEntry(\n  widget: EdgelessElementToolbarWidget\n) {\n  widget.registerEntry({\n    when: () => {\n      return true;\n    },\n    render: (edgeless: EdgelessRootBlockComponent) => {\n      const chain = edgeless.service.std.command.chain();\n      const filteredGroups = edgelessActionGroups.reduce((pre, group) => {\n        const filtered = group.items.filter(item =>\n          item.showWhen?.(chain, 'edgeless', edgeless.host)\n        );\n\n        if (filtered.length > 0) pre.push({ ...group, items: filtered });\n\n        return pre;\n      }, [] as AIItemGroupConfig[]);\n\n      if (filteredGroups.every(group => group.items.length === 0)) return null;\n\n      return html`<edgeless-copilot-toolbar-entry\n        .edgeless=${edgeless}\n        .host=${edgeless.host}\n        .groups=${edgelessActionGroups}\n      ></edgeless-copilot-toolbar-entry>`;\n    },\n  });\n}\n","import '../../_common/components/ask-ai-button';\n\nimport type {\n  AffineImageToolbarWidget,\n  ImageBlockComponent,\n} from '@blocksuite/blocks';\nimport { html } from 'lit';\n\nimport type { AskAIButtonOptions } from '../../_common/components/ask-ai-button';\nimport { buildAIImageItemGroups } from '../../_common/config';\n\nconst AIImageItemGroups = buildAIImageItemGroups();\nconst buttonOptions: AskAIButtonOptions = {\n  size: 'small',\n  backgroundColor: 'var(--affine-white)',\n  panelWidth: 300,\n};\n\nexport function setupImageToolbarEntry(imageToolbar: AffineImageToolbarWidget) {\n  const onAskAIClick = () => {\n    const { host } = imageToolbar;\n    const { selection } = host;\n    const imageBlock = imageToolbar.block;\n    selection.setGroup('note', [\n      selection.create('image', { blockId: imageBlock.blockId }),\n    ]);\n  };\n  imageToolbar.buildDefaultConfig();\n  imageToolbar.addConfigItems(\n    [\n      {\n        type: 'custom',\n        render(imageBlock: ImageBlockComponent, onClick?: () => void) {\n          return html`<ask-ai-button\n            class=\"image-toolbar-button ask-ai\"\n            .host=${imageBlock.host}\n            .actionGroups=${AIImageItemGroups}\n            .toggleType=${'click'}\n            .options=${buttonOptions}\n            @click=${(e: MouseEvent) => {\n              e.stopPropagation();\n              onAskAIClick();\n              onClick?.();\n            }}\n          ></ask-ai-button>`;\n        },\n        showWhen: imageBlockComponent => !imageBlockComponent.doc.readonly,\n      },\n    ],\n    0\n  );\n}\n","import type {\n  AffineAIPanelWidget,\n  AffineSlashMenuActionItem,\n  AffineSlashMenuContext,\n  AffineSlashMenuItem,\n  AffineSlashSubMenu,\n  AIItemConfig,\n} from '@blocksuite/blocks';\nimport {\n  AFFINE_AI_PANEL_WIDGET,\n  AffineSlashMenuWidget,\n  AIStarIcon,\n  MoreHorizontalIcon,\n} from '@blocksuite/blocks';\nimport { assertExists } from '@blocksuite/global/utils';\nimport { html } from 'lit';\n\nimport { AIItemGroups } from '../../_common/config';\nimport { handleInlineAskAIAction } from '../../actions/doc-handler';\nimport { AIProvider } from '../../provider';\n\nexport function setupSlashMenuEntry(slashMenu: AffineSlashMenuWidget) {\n  const AIItems = AIItemGroups.map(group => group.items).flat();\n\n  const iconWrapper = (icon: AIItemConfig['icon']) => {\n    return html`<div style=\"color: var(--affine-primary-color)\">\n      ${typeof icon === 'function' ? html`${icon()}` : icon}\n    </div>`;\n  };\n\n  const showWhenWrapper =\n    (item?: AIItemConfig) =>\n    ({ rootComponent }: AffineSlashMenuContext) => {\n      const affineAIPanelWidget = rootComponent.host.view.getWidget(\n        AFFINE_AI_PANEL_WIDGET,\n        rootComponent.model.id\n      );\n      if (affineAIPanelWidget === null) return false;\n\n      const chain = rootComponent.host.command.chain();\n      const editorMode = rootComponent.service.docModeService.getMode(\n        rootComponent.doc.id\n      );\n\n      return item?.showWhen?.(chain, editorMode, rootComponent.host) ?? true;\n    };\n\n  const actionItemWrapper = (\n    item: AIItemConfig\n  ): AffineSlashMenuActionItem => ({\n    ...basicItemConfig(item),\n    action: ({ rootComponent }: AffineSlashMenuContext) => {\n      item?.handler?.(rootComponent.host);\n    },\n  });\n\n  const subMenuWrapper = (item: AIItemConfig): AffineSlashSubMenu => {\n    assertExists(item.subItem);\n    return {\n      ...basicItemConfig(item),\n      subMenu: item.subItem.map<AffineSlashMenuActionItem>(\n        ({ type, handler }) => ({\n          name: type,\n          action: ({ rootComponent }) => handler?.(rootComponent.host),\n        })\n      ),\n    };\n  };\n\n  const basicItemConfig = (item: AIItemConfig) => {\n    return {\n      name: item.name,\n      icon: iconWrapper(item.icon),\n      alias: ['ai'],\n      showWhen: showWhenWrapper(item),\n    };\n  };\n\n  const menu = slashMenu.config.items.slice();\n  menu.unshift({\n    name: 'Ask AI',\n    icon: AIStarIcon,\n    showWhen: showWhenWrapper(),\n    action: ({ rootComponent }) => {\n      const view = rootComponent.host.view;\n      const affineAIPanelWidget = view.getWidget(\n        AFFINE_AI_PANEL_WIDGET,\n        rootComponent.model.id\n      ) as AffineAIPanelWidget;\n      assertExists(affineAIPanelWidget);\n      assertExists(AIProvider.actions.chat);\n      assertExists(affineAIPanelWidget.host);\n      handleInlineAskAIAction(affineAIPanelWidget.host);\n    },\n  });\n\n  const AIMenuItems: AffineSlashMenuItem[] = [\n    { groupName: 'AFFiNE AI' },\n    ...AIItems.filter(({ name }) =>\n      ['Fix spelling', 'Fix grammar'].includes(name)\n    ).map(item => ({\n      ...actionItemWrapper(item),\n      name: `${item.name} from above`,\n    })),\n\n    ...AIItems.filter(({ name }) =>\n      ['Summarize', 'Continue writing'].includes(name)\n    ).map(actionItemWrapper),\n\n    {\n      name: 'Action with above',\n      icon: iconWrapper(MoreHorizontalIcon),\n      subMenu: [\n        { groupName: 'Action with above' },\n        ...AIItems.filter(({ name }) =>\n          ['Translate to', 'Change tone to'].includes(name)\n        ).map(subMenuWrapper),\n\n        ...AIItems.filter(({ name }) =>\n          [\n            'Improve writing',\n            'Make it longer',\n            'Make it shorter',\n            'Generate outline',\n            'Find actions',\n          ].includes(name)\n        ).map(actionItemWrapper),\n      ],\n    },\n  ];\n\n  const basicGroupEnd = menu.findIndex(\n    item => 'groupName' in item && item.groupName === 'List'\n  );\n  // insert ai item after basic group\n  menu.splice(basicGroupEnd, 0, ...AIMenuItems);\n\n  slashMenu.config = {\n    ...AffineSlashMenuWidget.DEFAULT_CONFIG,\n    items: menu,\n  };\n}\n","import type { AffineAIPanelWidget } from '@blocksuite/blocks';\n\nimport { handleInlineAskAIAction } from '../../actions/doc-handler';\nimport { AIProvider } from '../../provider';\n\nexport function setupSpaceEntry(panel: AffineAIPanelWidget) {\n  panel.handleEvent('keyDown', ctx => {\n    const host = panel.host;\n    const keyboardState = ctx.get('keyboardState');\n    if (\n      AIProvider.actions.chat &&\n      keyboardState.raw.key === ' ' &&\n      !keyboardState.raw.isComposing\n    ) {\n      const selection = host.selection.find('text');\n      if (selection && selection.isCollapsed() && selection.from.index === 0) {\n        const block = host.view.getBlock(selection.blockId);\n        if (!block?.model?.text || block.model.text?.length > 0) return;\n\n        keyboardState.raw.preventDefault();\n        handleInlineAskAIAction(host);\n      }\n    }\n  });\n}\n","import type { BlockSpec } from '@blocksuite/block-std';\nimport {\n  AFFINE_AI_PANEL_WIDGET,\n  AFFINE_EDGELESS_COPILOT_WIDGET,\n  AffineAIPanelWidget,\n  AffineCodeToolbarWidget,\n  AffineFormatBarWidget,\n  AffineImageToolbarWidget,\n  AffineSlashMenuWidget,\n  CodeBlockSpec,\n  EdgelessCopilotWidget,\n  EdgelessElementToolbarWidget,\n  EdgelessRootBlockSpec,\n  ImageBlockSpec,\n  PageRootBlockSpec,\n  ParagraphBlockService,\n  ParagraphBlockSpec,\n} from '@blocksuite/blocks';\nimport { assertInstanceOf } from '@blocksuite/global/utils';\nimport { literal, unsafeStatic } from 'lit/static-html.js';\n\nimport { buildAIPanelConfig } from './ai-panel';\nimport { setupCodeToolbarEntry } from './entries/code-toolbar/setup-code-toolbar';\nimport {\n  setupEdgelessCopilot,\n  setupEdgelessElementToolbarEntry,\n} from './entries/edgeless/index';\nimport { setupFormatBarEntry } from './entries/format-bar/setup-format-bar';\nimport { setupImageToolbarEntry } from './entries/image-toolbar/setup-image-toolbar';\nimport { setupSlashMenuEntry } from './entries/slash-menu/setup-slash-menu';\nimport { setupSpaceEntry } from './entries/space/setup-space';\n\nexport const AIPageRootBlockSpec: BlockSpec = {\n  ...PageRootBlockSpec,\n  view: {\n    ...PageRootBlockSpec.view,\n    widgets: {\n      ...PageRootBlockSpec.view.widgets,\n      [AFFINE_AI_PANEL_WIDGET]: literal`${unsafeStatic(\n        AFFINE_AI_PANEL_WIDGET\n      )}`,\n    },\n  },\n  setup: (slots, disposableGroup) => {\n    PageRootBlockSpec.setup?.(slots, disposableGroup);\n    disposableGroup.add(\n      slots.widgetConnected.on(view => {\n        if (view.component instanceof AffineAIPanelWidget) {\n          view.component.style.width = '630px';\n          view.component.config = buildAIPanelConfig(view.component);\n          setupSpaceEntry(view.component);\n        }\n\n        if (view.component instanceof AffineFormatBarWidget) {\n          setupFormatBarEntry(view.component);\n        }\n\n        if (view.component instanceof AffineSlashMenuWidget) {\n          setupSlashMenuEntry(view.component);\n        }\n      })\n    );\n  },\n};\n\nexport const AIEdgelessRootBlockSpec: BlockSpec = {\n  ...EdgelessRootBlockSpec,\n  view: {\n    ...EdgelessRootBlockSpec.view,\n    widgets: {\n      ...EdgelessRootBlockSpec.view.widgets,\n      [AFFINE_EDGELESS_COPILOT_WIDGET]: literal`${unsafeStatic(\n        AFFINE_EDGELESS_COPILOT_WIDGET\n      )}`,\n      [AFFINE_AI_PANEL_WIDGET]: literal`${unsafeStatic(\n        AFFINE_AI_PANEL_WIDGET\n      )}`,\n    },\n  },\n  setup(slots, disposableGroup) {\n    EdgelessRootBlockSpec.setup?.(slots, disposableGroup);\n    slots.widgetConnected.on(view => {\n      if (view.component instanceof AffineAIPanelWidget) {\n        view.component.style.width = '430px';\n        view.component.config = buildAIPanelConfig(view.component);\n        setupSpaceEntry(view.component);\n      }\n\n      if (view.component instanceof EdgelessCopilotWidget) {\n        setupEdgelessCopilot(view.component);\n      }\n\n      if (view.component instanceof EdgelessElementToolbarWidget) {\n        setupEdgelessElementToolbarEntry(view.component);\n      }\n\n      if (view.component instanceof AffineFormatBarWidget) {\n        setupFormatBarEntry(view.component);\n      }\n\n      if (view.component instanceof AffineSlashMenuWidget) {\n        setupSlashMenuEntry(view.component);\n      }\n    });\n  },\n};\n\nexport const AIParagraphBlockSpec: BlockSpec = {\n  ...ParagraphBlockSpec,\n  setup(slots, disposableGroup) {\n    ParagraphBlockSpec.setup?.(slots, disposableGroup);\n    slots.mounted.on(({ service }) => {\n      assertInstanceOf(service, ParagraphBlockService);\n      service.placeholderGenerator = model => {\n        if (model.type === 'text') {\n          return \"Type '/' for commands, 'space' for AI\";\n        }\n\n        const placeholders = {\n          h1: 'Heading 1',\n          h2: 'Heading 2',\n          h3: 'Heading 3',\n          h4: 'Heading 4',\n          h5: 'Heading 5',\n          h6: 'Heading 6',\n          quote: '',\n        };\n        return placeholders[model.type];\n      };\n    });\n  },\n};\n\nexport const AICodeBlockSpec: BlockSpec = {\n  ...CodeBlockSpec,\n  setup(slots, disposableGroup) {\n    CodeBlockSpec.setup?.(slots, disposableGroup);\n    slots.widgetConnected.on(view => {\n      if (view.component instanceof AffineCodeToolbarWidget) {\n        setupCodeToolbarEntry(view.component);\n      }\n    });\n  },\n};\n\nexport const AIImageBlockSpec: BlockSpec = {\n  ...ImageBlockSpec,\n  setup(slots, disposableGroup) {\n    ImageBlockSpec.setup?.(slots, disposableGroup);\n    slots.widgetConnected.on(view => {\n      if (view.component instanceof AffineImageToolbarWidget) {\n        setupImageToolbarEntry(view.component);\n      }\n    });\n  },\n};\n","import { html } from 'lit';\nimport { repeat } from 'lit/directives/repeat.js';\n\nexport const renderImages = (images: string[]) => {\n  return html`<style>\n      .images-container {\n        display: flex;\n        gap: 12px;\n        flex-direction: column;\n        margin-bottom: 8px;\n      }\n      .image-container {\n        border-radius: 4px;\n        overflow: hidden;\n        position: relative;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        width: 70%;\n        max-width: 320px;\n\n        img {\n          max-width: 100%;\n          max-height: 100%;\n          width: auto;\n          height: auto;\n        }\n      }\n    </style>\n    <div class=\"images-container\">\n      ${repeat(\n        images,\n        image => image,\n        image => {\n          return html`<div class=\"image-container\">\n            <img src=\"${image}\" />\n          </div>`;\n        }\n      )}\n    </div>`;\n};\n","export const HISTORY_IMAGE_ACTIONS = [\n  'image',\n  'AI image filter clay style',\n  'AI image filter sketch style',\n  'AI image filter anime style',\n  'AI image filter pixel style',\n  'Clearer',\n  'Remove background',\n  'Convert to sticker',\n];\n","import { ChatHistoryOrder } from '@affine/graphql';\nimport type {\n  BlockSelection,\n  EditorHost,\n  TextSelection,\n} from '@blocksuite/block-std';\nimport type {\n  DocMode,\n  EdgelessRootService,\n  ImageSelection,\n  PageRootService,\n} from '@blocksuite/blocks';\nimport {\n  BlocksUtils,\n  getElementsBound,\n  NoteDisplayMode,\n} from '@blocksuite/blocks';\nimport { Bound, type SerializedXYWH } from '@blocksuite/global/utils';\nimport { type ChatMessage } from '@blocksuite/presets';\nimport type { Doc } from '@blocksuite/store';\nimport type { TemplateResult } from 'lit';\n\nimport { AIProvider, type AIUserInfo } from '../provider';\nimport { reportResponse } from '../utils/action-reporter';\nimport { insertBelow, replace } from '../utils/editor-actions';\nimport { insertFromMarkdown } from '../utils/markdown-utils';\nimport { BlockIcon, CreateIcon, InsertBelowIcon, ReplaceIcon } from './icons';\n\nconst { matchFlavours } = BlocksUtils;\n\ntype Selections = {\n  text?: TextSelection;\n  blocks?: BlockSelection[];\n  images?: ImageSelection[];\n};\n\nexport type ChatAction = {\n  icon: TemplateResult<1>;\n  title: string;\n  toast: string;\n  showWhen: (host: EditorHost) => boolean;\n  handler: (\n    host: EditorHost,\n    content: string,\n    currentSelections: Selections,\n    chatSessionId?: string,\n    messageId?: string\n  ) => Promise<boolean>;\n};\n\nexport async function queryHistoryMessages(\n  workspaceId: string,\n  docId: string,\n  forkSessionId: string\n) {\n  // Get fork session messages\n  const histories = await AIProvider.histories?.chats(workspaceId, docId, {\n    sessionId: forkSessionId,\n    messageOrder: ChatHistoryOrder.asc,\n  });\n\n  if (!histories || !histories.length) {\n    return [];\n  }\n\n  return histories[0].messages;\n}\n\n// Construct user info with messages\nexport function constructUserInfoWithMessages(\n  messages: ChatMessage[],\n  userInfo: AIUserInfo | null\n) {\n  return messages.map(message => {\n    const { role, id, content, createdAt } = message;\n    const isUser = role === 'user';\n    const userInfoProps = isUser\n      ? {\n          userId: userInfo?.id,\n          userName: userInfo?.name,\n          avatarUrl: userInfo?.avatarUrl ?? undefined,\n        }\n      : {};\n    return {\n      id,\n      role,\n      content,\n      createdAt,\n      attachments: [],\n      ...userInfoProps,\n    };\n  });\n}\n\nexport async function constructRootChatBlockMessages(\n  doc: Doc,\n  forkSessionId: string\n) {\n  // Convert chat messages to AI chat block messages\n  const userInfo = await AIProvider.userInfo;\n  const forkMessages = await queryHistoryMessages(\n    doc.collection.id,\n    doc.id,\n    forkSessionId\n  );\n  return constructUserInfoWithMessages(forkMessages, userInfo);\n}\n\nfunction getViewportCenter(\n  mode: DocMode,\n  rootService: PageRootService | EdgelessRootService\n) {\n  const center = { x: 400, y: 50 };\n  if (mode === 'page') {\n    const viewport = rootService.editPropsStore.getStorage('viewport');\n    if (viewport) {\n      if ('xywh' in viewport) {\n        const bound = Bound.deserialize(viewport.xywh);\n        center.x = bound.x + bound.w / 2;\n        center.y = bound.y + bound.h / 2;\n      } else {\n        center.x = viewport.centerX;\n        center.y = viewport.centerY;\n      }\n    }\n  } else {\n    // Else we should get latest viewport center from the edgeless root service\n    const edgelessService = rootService as EdgelessRootService;\n    center.x = edgelessService.viewport.centerX;\n    center.y = edgelessService.viewport.centerY;\n  }\n\n  return center;\n}\n\n// Add AI chat block and focus on it\nfunction addAIChatBlock(\n  host: EditorHost,\n  messages: ChatMessage[],\n  sessionId: string,\n  viewportCenter: { x: number; y: number },\n  index: string\n) {\n  if (!messages.length || !sessionId) {\n    return;\n  }\n\n  const { doc } = host;\n  const surfaceBlock = doc\n    .getBlocks()\n    .find(block => block.flavour === 'affine:surface');\n  if (!surfaceBlock) {\n    return;\n  }\n\n  // Add AI chat block to the center of the viewport\n  const width = 300; // AI_CHAT_BLOCK_WIDTH = 300\n  const height = 320; // AI_CHAT_BLOCK_HEIGHT = 320\n  const x = viewportCenter.x - width / 2;\n  const y = viewportCenter.y - height / 2;\n  const bound = new Bound(x, y, width, height);\n  const aiChatBlockId = doc.addBlock(\n    'affine:embed-ai-chat' as keyof BlockSuite.BlockModels,\n    {\n      xywh: bound.serialize(),\n      messages: JSON.stringify(messages),\n      index,\n      sessionId,\n      rootWorkspaceId: doc.collection.id,\n      rootDocId: doc.id,\n    },\n    surfaceBlock.id\n  );\n\n  return aiChatBlockId;\n}\n\nexport function promptDocTitle(host: EditorHost, autofill?: string) {\n  const notification =\n    host.std.spec.getService('affine:page').notificationService;\n  if (!notification) return Promise.resolve(undefined);\n\n  return notification.prompt({\n    title: 'Create linked doc',\n    message: 'Enter a title for the new doc.',\n    placeholder: 'Untitled',\n    autofill,\n    confirmText: 'Confirm',\n    cancelText: 'Cancel',\n  });\n}\n\nconst REPLACE_SELECTION = {\n  icon: ReplaceIcon,\n  title: 'Replace selection',\n  showWhen: (host: EditorHost) => {\n    const textSelection = host.selection.find('text');\n    const blockSelections = host.selection.filter('block');\n    if (\n      (!textSelection || textSelection.from.length === 0) &&\n      blockSelections?.length === 0\n    ) {\n      return false;\n    }\n    return true;\n  },\n  toast: 'Successfully replaced',\n  handler: async (\n    host: EditorHost,\n    content: string,\n    currentSelections: Selections\n  ) => {\n    const currentTextSelection = currentSelections.text;\n    const currentBlockSelections = currentSelections.blocks;\n    const [_, data] = host.command\n      .chain()\n      .getSelectedBlocks({\n        currentTextSelection,\n        currentBlockSelections,\n      })\n      .run();\n    if (!data.selectedBlocks) return false;\n\n    reportResponse('result:replace');\n\n    if (currentTextSelection) {\n      const { doc } = host;\n      const block = doc.getBlock(currentTextSelection.blockId);\n      if (matchFlavours(block?.model ?? null, ['affine:paragraph'])) {\n        block?.model.text?.replace(\n          currentTextSelection.from.index,\n          currentTextSelection.from.length,\n          content\n        );\n        return true;\n      }\n    }\n\n    await replace(\n      host,\n      content,\n      data.selectedBlocks[0],\n      data.selectedBlocks.map(block => block.model),\n      currentTextSelection\n    );\n    return true;\n  },\n};\n\nconst INSERT_BELOW = {\n  icon: InsertBelowIcon,\n  title: 'Insert below',\n  showWhen: () => true,\n  toast: 'Successfully inserted',\n  handler: async (\n    host: EditorHost,\n    content: string,\n    currentSelections: Selections\n  ) => {\n    const currentTextSelection = currentSelections.text;\n    const currentBlockSelections = currentSelections.blocks;\n    const currentImageSelections = currentSelections.images;\n    const [_, data] = host.command\n      .chain()\n      .getSelectedBlocks({\n        currentTextSelection,\n        currentBlockSelections,\n        currentImageSelections,\n      })\n      .run();\n    if (!data.selectedBlocks) return false;\n    reportResponse('result:insert');\n    await insertBelow(\n      host,\n      content,\n      data.selectedBlocks[data.selectedBlocks?.length - 1]\n    );\n    return true;\n  },\n};\n\nconst SAVE_CHAT_TO_BLOCK_ACTION: ChatAction = {\n  icon: BlockIcon,\n  title: 'Save chat to block',\n  toast: 'Successfully saved chat to a block',\n  showWhen: () => true,\n  handler: async (\n    host: EditorHost,\n    _,\n    __,\n    chatSessionId?: string,\n    messageId?: string\n  ) => {\n    // The chat session id and the latest message id are required to fork the chat session\n    const parentSessionId = chatSessionId;\n    if (!messageId || !parentSessionId) {\n      return false;\n    }\n\n    const rootService = host.spec.getService('affine:page');\n    const surfaceService = host.spec.getService('affine:surface');\n    if (!rootService || !surfaceService) return false;\n\n    const { docModeService, notificationService } = rootService;\n    const { layer } = surfaceService;\n    const curMode = docModeService.getMode();\n    const viewportCenter = getViewportCenter(curMode, rootService);\n    const newBlockIndex = layer.generateIndex('affine:embed-ai-chat');\n    // If current mode is not edgeless, switch to edgeless mode first\n    if (curMode !== 'edgeless') {\n      // Set mode to edgeless\n      docModeService.setMode('edgeless');\n      // Notify user to switch to edgeless mode\n      notificationService?.notify({\n        title: 'Save chat to a block',\n        accent: 'info',\n        message:\n          'This feature is not available in the page editor. Switch to edgeless mode.',\n        onClose: function (): void {},\n      });\n    }\n\n    try {\n      const newSessionId = await AIProvider.forkChat?.({\n        workspaceId: host.doc.collection.id,\n        docId: host.doc.id,\n        sessionId: parentSessionId,\n        latestMessageId: messageId,\n      });\n\n      if (!newSessionId) {\n        return false;\n      }\n\n      // Get messages before the latest message\n      const messages = await constructRootChatBlockMessages(\n        host.doc,\n        newSessionId\n      );\n\n      // After switching to edgeless mode, the user can save the chat to a block\n      const blockId = addAIChatBlock(\n        host,\n        messages,\n        newSessionId,\n        viewportCenter,\n        newBlockIndex\n      );\n      if (!blockId) {\n        return false;\n      }\n\n      rootService.telemetryService?.track('CanvasElementAdded', {\n        control: 'manually save',\n        page: 'whiteboard editor',\n        module: 'ai chat panel',\n        segment: 'right sidebar',\n        type: 'chat block',\n        category: 'root',\n      });\n      return true;\n    } catch (err) {\n      console.error(err);\n      notificationService?.notify({\n        title: 'Failed to save chat to a block',\n        accent: 'error',\n        onClose: function (): void {},\n      });\n      return false;\n    }\n  },\n};\n\nconst ADD_TO_EDGELESS_AS_NOTE = {\n  icon: CreateIcon,\n  title: 'Add to edgeless as note',\n  showWhen: () => true,\n  toast: 'New note created',\n  handler: async (host: EditorHost, content: string) => {\n    reportResponse('result:add-note');\n    const { doc } = host;\n    const service = host.spec.getService<EdgelessRootService>('affine:page');\n    const elements = service.selection.selectedElements;\n\n    const props: { displayMode: NoteDisplayMode; xywh?: SerializedXYWH } = {\n      displayMode: NoteDisplayMode.EdgelessOnly,\n    };\n\n    if (elements.length > 0) {\n      const bound = getElementsBound(\n        elements.map(e => Bound.deserialize(e.xywh))\n      );\n      const newBound = new Bound(bound.x, bound.maxY + 10, bound.w);\n      props.xywh = newBound.serialize();\n    }\n\n    const id = doc.addBlock('affine:note', props, doc.root?.id);\n\n    await insertFromMarkdown(host, content, doc, id, 0);\n\n    service.selection.set({\n      elements: [id],\n      editing: false,\n    });\n\n    return true;\n  },\n};\n\nconst CREATE_AS_DOC = {\n  icon: CreateIcon,\n  title: 'Create as a doc',\n  showWhen: () => true,\n  toast: 'New doc created',\n  handler: (host: EditorHost, content: string) => {\n    reportResponse('result:add-page');\n    const newDoc = host.doc.collection.createDoc();\n    newDoc.load();\n    const rootId = newDoc.addBlock('affine:page');\n    newDoc.addBlock('affine:surface', {}, rootId);\n    const noteId = newDoc.addBlock('affine:note', {}, rootId);\n\n    host.spec.getService('affine:page').slots.docLinkClicked.emit({\n      docId: newDoc.id,\n    });\n    let complete = false;\n    (function addContent() {\n      if (complete) return;\n      const newHost = document.querySelector('editor-host');\n      // FIXME: this is a hack to wait for the host to be ready, now we don't have a way to know if the new host is ready\n      if (!newHost || newHost === host) {\n        setTimeout(addContent, 100);\n        return;\n      }\n      complete = true;\n      const { doc } = newHost;\n      insertFromMarkdown(newHost, content, doc, noteId, 0).catch(console.error);\n    })();\n\n    return true;\n  },\n};\n\nconst CREATE_AS_LINKED_DOC = {\n  icon: CreateIcon,\n  title: 'Create as a linked doc',\n  showWhen: () => true,\n  toast: 'New doc created',\n  handler: async (host: EditorHost, content: string) => {\n    reportResponse('result:add-page');\n\n    const { doc } = host;\n    const surfaceBlock = doc\n      .getBlocks()\n      .find(block => block.flavour === 'affine:surface');\n    if (!surfaceBlock) {\n      return false;\n    }\n\n    const service = host.spec.getService<EdgelessRootService>('affine:page');\n    const mode = service.docModeService.getMode();\n    if (mode !== 'edgeless') {\n      return false;\n    }\n\n    // Create a new doc and add the content to it\n    const newDoc = host.doc.collection.createDoc();\n    newDoc.load();\n    const rootId = newDoc.addBlock('affine:page');\n    newDoc.addBlock('affine:surface', {}, rootId);\n    const noteId = newDoc.addBlock('affine:note', {}, rootId);\n    await insertFromMarkdown(host, content, newDoc, noteId, 0);\n\n    // Add a linked doc card to link to the new doc\n    const elements = service.selection.selectedElements;\n    const width = 364;\n    const height = 390;\n    let x = 0;\n    let y = 0;\n    if (elements.length) {\n      // Calculate the bound of the selected elements first\n      const bound = getElementsBound(\n        elements.map(e => Bound.deserialize(e.xywh))\n      );\n      x = bound.x;\n      y = bound.y + bound.h + 100;\n    }\n\n    // If the selected elements are not in the viewport, center the linked doc card\n    if (x === Number.POSITIVE_INFINITY || y === Number.POSITIVE_INFINITY) {\n      const viewportCenter = getViewportCenter(mode, service);\n      x = viewportCenter.x - width / 2;\n      y = viewportCenter.y - height / 2;\n    }\n\n    service.addBlock(\n      'affine:embed-linked-doc',\n      {\n        xywh: `[${x}, ${y}, ${width}, ${height}]`,\n        style: 'vertical',\n        pageId: newDoc.id,\n      },\n      surfaceBlock.id\n    );\n\n    return true;\n  },\n};\n\nconst CommonActions: ChatAction[] = [REPLACE_SELECTION, INSERT_BELOW];\n\nexport const PageEditorActions = [\n  ...CommonActions,\n  CREATE_AS_DOC,\n  SAVE_CHAT_TO_BLOCK_ACTION,\n];\n\nexport const EdgelessEditorActions = [\n  ...CommonActions,\n  ADD_TO_EDGELESS_AS_NOTE,\n  SAVE_CHAT_TO_BLOCK_ACTION,\n];\n\nexport const ChatBlockPeekViewActions = [\n  ADD_TO_EDGELESS_AS_NOTE,\n  CREATE_AS_LINKED_DOC,\n];\n","import {\n  ArticleIcon,\n  CommunicateIcon,\n  MindmapIcon,\n  PreloadImageIcon,\n  PreloadPenIcon,\n} from '../_common/icons.js';\nimport { AIProvider } from '../provider.js';\nimport completeWritingWithAI from './templates/completeWritingWithAI.zip';\nimport freelyCommunicateWithAI from './templates/freelyCommunicateWithAI.zip';\nimport readAforeign from './templates/readAforeign.zip';\nimport redHat from './templates/redHat.zip';\nimport TidyMindMapV3 from './templates/TidyMindMapV3.zip';\n\nexport const AIPreloadConfig = [\n  {\n    icon: ArticleIcon,\n    text: 'Read a foreign language article with AI',\n    handler: () => {\n      AIProvider.slots.requestInsertTemplate.emit({\n        template: readAforeign,\n        mode: 'edgeless',\n      });\n    },\n  },\n  {\n    icon: MindmapIcon,\n    text: 'Tidy a article with AI MindMap Action',\n    handler: () => {\n      AIProvider.slots.requestInsertTemplate.emit({\n        template: TidyMindMapV3,\n        mode: 'edgeless',\n      });\n    },\n  },\n  {\n    icon: PreloadImageIcon,\n    text: 'Add illustrations to the article',\n    handler: () => {\n      AIProvider.slots.requestInsertTemplate.emit({\n        template: redHat,\n        mode: 'edgeless',\n      });\n    },\n  },\n  {\n    icon: PreloadPenIcon,\n    text: 'Complete writing with AI',\n    handler: () => {\n      AIProvider.slots.requestInsertTemplate.emit({\n        template: completeWritingWithAI,\n        mode: 'edgeless',\n      });\n    },\n  },\n  {\n    icon: CommunicateIcon,\n    text: 'Freely communicate with AI',\n    handler: () => {\n      AIProvider.slots.requestInsertTemplate.emit({\n        template: freelyCommunicateWithAI,\n        mode: 'edgeless',\n      });\n    },\n  },\n];\n","import { baseTheme } from '@toeverything/theme';\nimport { css, unsafeCSS } from 'lit';\n\nexport const PeekViewStyles = css`\n  :host {\n    width: 100%;\n    height: 100%;\n  }\n\n  .ai-chat-block-peek-view-container {\n    gap: 8px;\n    width: 100%;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    box-sizing: border-box;\n    justify-content: start;\n    flex-direction: column;\n    box-sizing: border-box;\n    padding: 24px 120px 16px 120px;\n    font-family: ${unsafeCSS(baseTheme.fontSansFamily)};\n  }\n\n  .ai-chat-messages-container {\n    display: flex;\n    align-items: center;\n    justify-content: start;\n    flex-direction: column;\n    box-sizing: border-box;\n    width: 100%;\n    color: var(--affine-text-primary-color);\n    line-height: 22px;\n    font-size: var(--affine-font-sm);\n    overflow-y: auto;\n    overflow-x: hidden;\n    flex: 1;\n    gap: 24px;\n    -ms-overflow-style: none; /* IE and Edge */\n    scrollbar-width: none; /* Firefox */\n  }\n\n  .new-chat-messages-container {\n    width: 100%;\n    box-sizing: border-box;\n    min-height: 450px;\n    display: flex;\n    flex-direction: column;\n    gap: 24px;\n  }\n\n  .ai-chat-messages-container::-webkit-scrollbar {\n    display: none;\n  }\n\n  .assistant-message-container {\n    width: 100%;\n    box-sizing: border-box;\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n  }\n\n  .peek-view-footer {\n    padding: 0 12px;\n    width: 100%;\n    height: 20px;\n    display: flex;\n    gap: 4px;\n    align-items: center;\n    color: var(--affine-text-secondary-color);\n    font-size: var(--affine-font-xs);\n    user-select: none;\n  }\n`;\n","import type { EdgelessRootService } from '@blocksuite/blocks';\nimport { Bound } from '@blocksuite/global/utils';\nimport {\n  type AIChatBlockModel,\n  CHAT_BLOCK_HEIGHT,\n  CHAT_BLOCK_WIDTH,\n} from '@blocksuite/presets';\n\n/**\n * Calculates the bounding box for a child block\n * Based on the parent block's position and the existing connectors.\n * Place the child block to the right of the parent block as much as possible.\n * If the parent block already has connected child blocks\n * Distribute them evenly along the y-axis as much as possible.\n * @param parentModel - The model of the parent block.\n * @param service - The EdgelessRootService instance.\n * @returns The calculated bounding box for the child block.\n */\nexport function calcChildBound(\n  parentModel: AIChatBlockModel,\n  service: EdgelessRootService\n) {\n  const parentXYWH = Bound.deserialize(parentModel.xywh);\n  const { x: parentX, y: parentY, w: parentWidth } = parentXYWH;\n\n  const connectors = service.getConnectors(parentModel.id);\n  const gapX = CHAT_BLOCK_WIDTH;\n  const gapY = 60;\n  const defaultX = parentX + parentWidth + gapX;\n  const defaultY = parentY;\n\n  if (!connectors.length) {\n    return new Bound(defaultX, defaultY, CHAT_BLOCK_WIDTH, CHAT_BLOCK_HEIGHT);\n  } else {\n    // Filter out the connectors which source is the parent block\n    const childConnectors = connectors.filter(\n      connector => connector.source.id === parentModel.id\n    );\n    // Get all the target blocks of the child connectors\n    const targetBlocks = childConnectors\n      .map(connector => connector.target.id)\n      .filter(id => id !== undefined)\n      .map(id => service.getElementById(id))\n      .filter(block => !!block);\n\n    if (targetBlocks.length) {\n      // Sort target blocks by their y position\n      targetBlocks.sort(\n        (a, b) => Bound.deserialize(a.xywh).y - Bound.deserialize(b.xywh).y\n      );\n\n      let x, y;\n      // Calculate the position based on the number of target blocks\n      const middleIndex = Math.floor((targetBlocks.length - 1) / 2);\n      const middleBlock = targetBlocks[middleIndex];\n      const { y: middleY, h: middleHeight } = Bound.deserialize(\n        middleBlock.xywh\n      );\n      const lastBlock = targetBlocks[targetBlocks.length - 1];\n      const {\n        x: lastX,\n        y: lastY,\n        h: lastHeight,\n      } = Bound.deserialize(lastBlock.xywh);\n\n      if (targetBlocks.length % 2 === 0) {\n        // If even number of target blocks\n        // place the new bound above the middle block with same same gap as the last block\n        x = lastX;\n        const gap = lastY - (middleY + middleHeight);\n        y = middleY - gap - CHAT_BLOCK_HEIGHT;\n      } else {\n        // If odd number of target blocks, place the new bound below the last block with a gap\n        x = lastX;\n        y = lastY + lastHeight + gapY;\n      }\n\n      return new Bound(x, y, CHAT_BLOCK_WIDTH, CHAT_BLOCK_HEIGHT);\n    } else {\n      // If no valid target blocks, fallback to default position\n      return new Bound(defaultX, defaultY, CHAT_BLOCK_WIDTH, CHAT_BLOCK_HEIGHT);\n    }\n  }\n}\n","import FiveWTwoH from './edgeless/5W2H.json';\nimport ConceptMap from './edgeless/Concept Map.json';\nimport Flowchart from './edgeless/Flowchart.json';\nimport SMART from './edgeless/SMART.json';\nimport SWOT from './edgeless/SWOT.json';\nimport FourPMarketingMatrix from './edgeless/4P Marketing Matrix.json';\nimport Storyboard from './edgeless/Storyboard.json';\nimport UserJourneyMap from './edgeless/User Journey Map.json';\nimport BusinessProposal from './edgeless/Business Proposal.json';\nimport DataAnalysis from './edgeless/Data Analysis.json';\nimport SimplePresentation from './edgeless/Simple Presentation.json';\nimport FishboneDiagram from './edgeless/Fishbone Diagram.json';\nimport GanttChart from './edgeless/Gantt Chart.json';\nimport MonthlyCalendar from './edgeless/Monthly Calendar.json';\nimport ProjectPlanning from './edgeless/Project Planning.json';\nimport ProjectTrackingKanban from './edgeless/Project Tracking Kanban.json';\n\nconst templates = {\n  'Brainstorming': [\n    FiveWTwoH,\n    ConceptMap,\n    Flowchart,\n    SMART,\n    SWOT\n  ],\n  'Marketing': [\n    FourPMarketingMatrix,\n    Storyboard,\n    UserJourneyMap\n  ],\n  'Presentation': [\n    BusinessProposal,\n    DataAnalysis,\n    SimplePresentation\n  ],\n  'Project Management': [\n    FishboneDiagram,\n    GanttChart,\n    MonthlyCalendar,\n    ProjectPlanning,\n    ProjectTrackingKanban\n  ]\n}\n\nfunction lcs(text1: string, text2: string) {\n  const dp: number[][] = Array.from({ length: text1.length + 1 })\n    .fill(null)\n    .map(() => Array.from<number>({length: text2.length + 1}).fill(0));\n\n  for (let i = 1; i <= text1.length; i++) {\n    for (let j = 1; j <= text2.length; j++) {\n      if (text1[i - 1] === text2[j - 1]) {\n        dp[i][j] = dp[i - 1][j - 1] + 1;\n      } else {\n        dp[i][j] = Math.max(dp[i - 1][j], dp[i][j - 1]);\n      }\n    }\n  }\n\n  return dp[text1.length][text2.length];\n}\n\nexport const builtInTemplates = {\n  list: async (category: string) => {\n    // @ts-expect-error type should be asserted when using\n    return templates[category] ?? []\n  },\n\n  categories: async () => {\n    return Object.keys(templates)\n  },\n\n  search: async(query: string) => {\n    const candidates: unknown[] = [];\n    const cates = Object.keys(templates);\n\n    query = query.toLowerCase();\n\n    for(let cate of cates) {\n      // @ts-expect-error type should be asserted when using\n      const templatesOfCate = templates[cate];\n\n      for(let temp of templatesOfCate) {\n        if(lcs(query, temp.name.toLowerCase()) === query.length) {\n          candidates.push(temp);\n        }\n      }\n    }\n\n    return candidates;\n  },\n}\n","\n/* eslint-disable */\n// @ts-nocheck\n\nimport stickerCover000 from './stickers/Arrows/Cover/arrow-1.svg';\nimport stickerContent000 from './stickers/Arrows/Content/arrow-1.svg';\nimport stickerCover001 from './stickers/Arrows/Cover/arrow-2.svg';\nimport stickerContent001 from './stickers/Arrows/Content/arrow-2.svg';\nimport stickerCover002 from './stickers/Arrows/Cover/arrow-3.svg';\nimport stickerContent002 from './stickers/Arrows/Content/arrow-3.svg';\nimport stickerCover003 from './stickers/Arrows/Cover/arrow-4.svg';\nimport stickerContent003 from './stickers/Arrows/Content/arrow-4.svg';\nimport stickerCover004 from './stickers/Arrows/Cover/arrow-5.svg';\nimport stickerContent004 from './stickers/Arrows/Content/arrow-5.svg';\nimport stickerCover005 from './stickers/Arrows/Cover/arrow-6.svg';\nimport stickerContent005 from './stickers/Arrows/Content/arrow-6.svg';\nimport stickerCover006 from './stickers/Arrows/Cover/arrow-7.svg';\nimport stickerContent006 from './stickers/Arrows/Content/arrow-7.svg';\nimport stickerCover007 from './stickers/Arrows/Cover/arrow-8.svg';\nimport stickerContent007 from './stickers/Arrows/Content/arrow-8.svg';\nimport stickerCover008 from './stickers/Arrows/Cover/arrow-9.svg';\nimport stickerContent008 from './stickers/Arrows/Content/arrow-9.svg';\nimport stickerCover009 from './stickers/Arrows/Cover/arrow-10.svg';\nimport stickerContent009 from './stickers/Arrows/Content/arrow-10.svg';\nimport stickerCover010 from './stickers/Arrows/Cover/arrow-11.svg';\nimport stickerContent010 from './stickers/Arrows/Content/arrow-11.svg';\nimport stickerCover011 from './stickers/Arrows/Cover/arrow-12.svg';\nimport stickerContent011 from './stickers/Arrows/Content/arrow-12.svg';\nimport stickerCover012 from './stickers/Arrows/Cover/arrow-13.svg';\nimport stickerContent012 from './stickers/Arrows/Content/arrow-13.svg';\nimport stickerCover013 from './stickers/Arrows/Cover/arrow-14.svg';\nimport stickerContent013 from './stickers/Arrows/Content/arrow-14.svg';\nimport stickerCover014 from './stickers/Arrows/Cover/arrow-15.svg';\nimport stickerContent014 from './stickers/Arrows/Content/arrow-15.svg';\nimport stickerCover015 from './stickers/Arrows/Cover/arrow-16.svg';\nimport stickerContent015 from './stickers/Arrows/Content/arrow-16.svg';\nimport stickerCover016 from './stickers/Arrows/Cover/arrow-17.svg';\nimport stickerContent016 from './stickers/Arrows/Content/arrow-17.svg';\nimport stickerCover017 from './stickers/Arrows/Cover/arrow-18.svg';\nimport stickerContent017 from './stickers/Arrows/Content/arrow-18.svg';\nimport stickerCover018 from './stickers/Arrows/Cover/arrow-19.svg';\nimport stickerContent018 from './stickers/Arrows/Content/arrow-19.svg';\nimport stickerCover019 from './stickers/Arrows/Cover/arrow-20.svg';\nimport stickerContent019 from './stickers/Arrows/Content/arrow-20.svg';\nimport stickerCover020 from './stickers/Arrows/Cover/arrow-21.svg';\nimport stickerContent020 from './stickers/Arrows/Content/arrow-21.svg';\nimport stickerCover021 from './stickers/Arrows/Cover/arrow-22.svg';\nimport stickerContent021 from './stickers/Arrows/Content/arrow-22.svg';\nimport stickerCover022 from './stickers/Arrows/Cover/arrow-23.svg';\nimport stickerContent022 from './stickers/Arrows/Content/arrow-23.svg';\nimport stickerCover023 from './stickers/Arrows/Cover/arrow-24.svg';\nimport stickerContent023 from './stickers/Arrows/Content/arrow-24.svg';\nimport stickerCover024 from './stickers/Arrows/Cover/arrow-25.svg';\nimport stickerContent024 from './stickers/Arrows/Content/arrow-25.svg';\nimport stickerCover025 from './stickers/Arrows/Cover/arrow-26.svg';\nimport stickerContent025 from './stickers/Arrows/Content/arrow-26.svg';\nimport stickerCover026 from './stickers/Arrows/Cover/arrow-27.svg';\nimport stickerContent026 from './stickers/Arrows/Content/arrow-27.svg';\nimport stickerCover027 from './stickers/Arrows/Cover/arrow-28.svg';\nimport stickerContent027 from './stickers/Arrows/Content/arrow-28.svg';\nimport stickerCover028 from './stickers/Arrows/Cover/arrow-29.svg';\nimport stickerContent028 from './stickers/Arrows/Content/arrow-29.svg';\nimport stickerCover029 from './stickers/Arrows/Cover/arrow-30.svg';\nimport stickerContent029 from './stickers/Arrows/Content/arrow-30.svg';\nimport stickerCover030 from './stickers/Arrows/Cover/arrow-31.svg';\nimport stickerContent030 from './stickers/Arrows/Content/arrow-31.svg';\nimport stickerCover031 from './stickers/Arrows/Cover/arrow-32.svg';\nimport stickerContent031 from './stickers/Arrows/Content/arrow-32.svg';\nimport stickerCover032 from './stickers/Arrows/Cover/arrow-33.svg';\nimport stickerContent032 from './stickers/Arrows/Content/arrow-33.svg';\nimport stickerCover033 from './stickers/Arrows/Cover/arrow-34.svg';\nimport stickerContent033 from './stickers/Arrows/Content/arrow-34.svg';\nimport stickerCover034 from './stickers/Arrows/Cover/arrow-35.svg';\nimport stickerContent034 from './stickers/Arrows/Content/arrow-35.svg';\nimport stickerCover035 from './stickers/Arrows/Cover/arrow-36.svg';\nimport stickerContent035 from './stickers/Arrows/Content/arrow-36.svg';\nimport stickerCover036 from './stickers/Arrows/Cover/arrow-37.svg';\nimport stickerContent036 from './stickers/Arrows/Content/arrow-37.svg';\nimport stickerCover037 from './stickers/Arrows/Cover/arrow-38.svg';\nimport stickerContent037 from './stickers/Arrows/Content/arrow-38.svg';\nimport stickerCover038 from './stickers/Arrows/Cover/arrow-39.svg';\nimport stickerContent038 from './stickers/Arrows/Content/arrow-39.svg';\nimport stickerCover039 from './stickers/Arrows/Cover/arrow-40.svg';\nimport stickerContent039 from './stickers/Arrows/Content/arrow-40.svg';\nimport stickerCover040 from './stickers/Arrows/Cover/arrow-41.svg';\nimport stickerContent040 from './stickers/Arrows/Content/arrow-41.svg';\nimport stickerCover041 from './stickers/Arrows/Cover/arrow-42.svg';\nimport stickerContent041 from './stickers/Arrows/Content/arrow-42.svg';\nimport stickerCover042 from './stickers/Arrows/Cover/arrow-43.svg';\nimport stickerContent042 from './stickers/Arrows/Content/arrow-43.svg';\nimport stickerCover043 from './stickers/Arrows/Cover/arrow-44.svg';\nimport stickerContent043 from './stickers/Arrows/Content/arrow-44.svg';\nimport stickerCover044 from './stickers/Arrows/Cover/arrow-45.svg';\nimport stickerContent044 from './stickers/Arrows/Content/arrow-45.svg';\nimport stickerCover045 from './stickers/Arrows/Cover/arrow-46.svg';\nimport stickerContent045 from './stickers/Arrows/Content/arrow-46.svg';\nimport stickerCover046 from './stickers/Arrows/Cover/arrow-47.svg';\nimport stickerContent046 from './stickers/Arrows/Content/arrow-47.svg';\nimport stickerCover047 from './stickers/Arrows/Cover/arrow-48.svg';\nimport stickerContent047 from './stickers/Arrows/Content/arrow-48.svg';\nimport stickerCover048 from './stickers/Arrows/Cover/arrow-49.svg';\nimport stickerContent048 from './stickers/Arrows/Content/arrow-49.svg';\nimport stickerCover049 from './stickers/Arrows/Cover/arrow-50.svg';\nimport stickerContent049 from './stickers/Arrows/Content/arrow-50.svg';\nimport stickerCover050 from './stickers/Arrows/Cover/arrow-51.svg';\nimport stickerContent050 from './stickers/Arrows/Content/arrow-51.svg';\nimport stickerCover051 from './stickers/Arrows/Cover/arrow-52.svg';\nimport stickerContent051 from './stickers/Arrows/Content/arrow-52.svg';\nimport stickerCover052 from './stickers/Arrows/Cover/arrow-53.svg';\nimport stickerContent052 from './stickers/Arrows/Content/arrow-53.svg';\nimport stickerCover053 from './stickers/Arrows/Cover/arrow-54.svg';\nimport stickerContent053 from './stickers/Arrows/Content/arrow-54.svg';\nimport stickerCover054 from './stickers/Arrows/Cover/arrow-55.svg';\nimport stickerContent054 from './stickers/Arrows/Content/arrow-55.svg';\nimport stickerCover055 from './stickers/Arrows/Cover/arrow-56.svg';\nimport stickerContent055 from './stickers/Arrows/Content/arrow-56.svg';\nimport stickerCover056 from './stickers/Arrows/Cover/arrow-57.svg';\nimport stickerContent056 from './stickers/Arrows/Content/arrow-57.svg';\nimport stickerCover057 from './stickers/Arrows/Cover/arrow-58.svg';\nimport stickerContent057 from './stickers/Arrows/Content/arrow-58.svg';\nimport stickerCover058 from './stickers/Arrows/Cover/arrow-59.svg';\nimport stickerContent058 from './stickers/Arrows/Content/arrow-59.svg';\nimport stickerCover059 from './stickers/Arrows/Cover/arrow-60.svg';\nimport stickerContent059 from './stickers/Arrows/Content/arrow-60.svg';\nimport stickerCover060 from './stickers/Arrows/Cover/arrow-61.svg';\nimport stickerContent060 from './stickers/Arrows/Content/arrow-61.svg';\nimport stickerCover061 from './stickers/Arrows/Cover/arrow-62.svg';\nimport stickerContent061 from './stickers/Arrows/Content/arrow-62.svg';\nimport stickerCover062 from './stickers/Arrows/Cover/arrow-63.svg';\nimport stickerContent062 from './stickers/Arrows/Content/arrow-63.svg';\nimport stickerCover063 from './stickers/Arrows/Cover/arrow-64.svg';\nimport stickerContent063 from './stickers/Arrows/Content/arrow-64.svg';\nimport stickerCover064 from './stickers/Arrows/Cover/arrow-65.svg';\nimport stickerContent064 from './stickers/Arrows/Content/arrow-65.svg';\nimport stickerCover065 from './stickers/Arrows/Cover/arrow-66.svg';\nimport stickerContent065 from './stickers/Arrows/Content/arrow-66.svg';\nimport stickerCover066 from './stickers/Arrows/Cover/arrow-67.svg';\nimport stickerContent066 from './stickers/Arrows/Content/arrow-67.svg';\nimport stickerCover067 from './stickers/Arrows/Cover/arrow-68.svg';\nimport stickerContent067 from './stickers/Arrows/Content/arrow-68.svg';\nimport stickerCover068 from './stickers/Arrows/Cover/arrow-69.svg';\nimport stickerContent068 from './stickers/Arrows/Content/arrow-69.svg';\nimport stickerCover069 from './stickers/Arrows/Cover/arrow-70.svg';\nimport stickerContent069 from './stickers/Arrows/Content/arrow-70.svg';\nimport stickerCover070 from './stickers/Arrows/Cover/arrow-71.svg';\nimport stickerContent070 from './stickers/Arrows/Content/arrow-71.svg';\nimport stickerCover071 from './stickers/Arrows/Cover/arrow-72.svg';\nimport stickerContent071 from './stickers/Arrows/Content/arrow-72.svg';\nimport stickerCover072 from './stickers/Arrows/Cover/arrow-73.svg';\nimport stickerContent072 from './stickers/Arrows/Content/arrow-73.svg';\nimport stickerCover073 from './stickers/Arrows/Cover/arrow-74.svg';\nimport stickerContent073 from './stickers/Arrows/Content/arrow-74.svg';\nimport stickerCover074 from './stickers/Arrows/Cover/arrow-75.svg';\nimport stickerContent074 from './stickers/Arrows/Content/arrow-75.svg';\nimport stickerCover075 from './stickers/Arrows/Cover/arrow-76.svg';\nimport stickerContent075 from './stickers/Arrows/Content/arrow-76.svg';\nimport stickerCover076 from './stickers/Arrows/Cover/arrow-77.svg';\nimport stickerContent076 from './stickers/Arrows/Content/arrow-77.svg';\nimport stickerCover077 from './stickers/Arrows/Cover/arrow-78.svg';\nimport stickerContent077 from './stickers/Arrows/Content/arrow-78.svg';\nimport stickerCover078 from './stickers/Arrows/Cover/arrow-79.svg';\nimport stickerContent078 from './stickers/Arrows/Content/arrow-79.svg';\nimport stickerCover079 from './stickers/Arrows/Cover/arrow-80.svg';\nimport stickerContent079 from './stickers/Arrows/Content/arrow-80.svg';\nimport stickerCover080 from './stickers/Arrows/Cover/arrow-81.svg';\nimport stickerContent080 from './stickers/Arrows/Content/arrow-81.svg';\nimport stickerCover081 from './stickers/Arrows/Cover/arrow-82.svg';\nimport stickerContent081 from './stickers/Arrows/Content/arrow-82.svg';\nimport stickerCover082 from './stickers/Arrows/Cover/arrow-83.svg';\nimport stickerContent082 from './stickers/Arrows/Content/arrow-83.svg';\nimport stickerCover083 from './stickers/Arrows/Cover/arrow-84.svg';\nimport stickerContent083 from './stickers/Arrows/Content/arrow-84.svg';\nimport stickerCover084 from './stickers/Arrows/Cover/arrow-85.svg';\nimport stickerContent084 from './stickers/Arrows/Content/arrow-85.svg';\nimport stickerCover085 from './stickers/Arrows/Cover/arrow-86.svg';\nimport stickerContent085 from './stickers/Arrows/Content/arrow-86.svg';\nimport stickerCover086 from './stickers/Arrows/Cover/arrow-87.svg';\nimport stickerContent086 from './stickers/Arrows/Content/arrow-87.svg';\nimport stickerCover087 from './stickers/Arrows/Cover/arrow-88.svg';\nimport stickerContent087 from './stickers/Arrows/Content/arrow-88.svg';\nimport stickerCover088 from './stickers/Arrows/Cover/arrow-89.svg';\nimport stickerContent088 from './stickers/Arrows/Content/arrow-89.svg';\nimport stickerCover089 from './stickers/Arrows/Cover/arrow-90.svg';\nimport stickerContent089 from './stickers/Arrows/Content/arrow-90.svg';\nimport stickerCover090 from './stickers/Arrows/Cover/arrow-91.svg';\nimport stickerContent090 from './stickers/Arrows/Content/arrow-91.svg';\nimport stickerCover091 from './stickers/Arrows/Cover/arrow-92.svg';\nimport stickerContent091 from './stickers/Arrows/Content/arrow-92.svg';\nimport stickerCover092 from './stickers/Arrows/Cover/arrow-93.svg';\nimport stickerContent092 from './stickers/Arrows/Content/arrow-93.svg';\nimport stickerCover093 from './stickers/Arrows/Cover/arrow-94.svg';\nimport stickerContent093 from './stickers/Arrows/Content/arrow-94.svg';\nimport stickerCover094 from './stickers/Arrows/Cover/arrow-95.svg';\nimport stickerContent094 from './stickers/Arrows/Content/arrow-95.svg';\nimport stickerCover095 from './stickers/Arrows/Cover/arrow-96.svg';\nimport stickerContent095 from './stickers/Arrows/Content/arrow-96.svg';\nimport stickerCover096 from './stickers/Arrows/Cover/arrow-97.svg';\nimport stickerContent096 from './stickers/Arrows/Content/arrow-97.svg';\nimport stickerCover097 from './stickers/Arrows/Cover/arrow-98.svg';\nimport stickerContent097 from './stickers/Arrows/Content/arrow-98.svg';\nimport stickerCover098 from './stickers/Arrows/Cover/arrow-99.svg';\nimport stickerContent098 from './stickers/Arrows/Content/arrow-99.svg';\nimport stickerCover099 from './stickers/Arrows/Cover/arrow-100.svg';\nimport stickerContent099 from './stickers/Arrows/Content/arrow-100.svg';\nimport stickerCover100 from './stickers/Arrows/Cover/arrow-101.svg';\nimport stickerContent100 from './stickers/Arrows/Content/arrow-101.svg';\nimport stickerCover101 from './stickers/Arrows/Cover/arrow-102.svg';\nimport stickerContent101 from './stickers/Arrows/Content/arrow-102.svg';\nimport stickerCover102 from './stickers/Arrows/Cover/arrow-103.svg';\nimport stickerContent102 from './stickers/Arrows/Content/arrow-103.svg';\nimport stickerCover103 from './stickers/Arrows/Cover/arrow-104.svg';\nimport stickerContent103 from './stickers/Arrows/Content/arrow-104.svg';\nimport stickerCover104 from './stickers/Arrows/Cover/arrow-105.svg';\nimport stickerContent104 from './stickers/Arrows/Content/arrow-105.svg';\nimport stickerCover105 from './stickers/Arrows/Cover/arrow-106.svg';\nimport stickerContent105 from './stickers/Arrows/Content/arrow-106.svg';\nimport stickerCover106 from './stickers/Arrows/Cover/arrow-107.svg';\nimport stickerContent106 from './stickers/Arrows/Content/arrow-107.svg';\nimport stickerCover107 from './stickers/Arrows/Cover/arrow-108.svg';\nimport stickerContent107 from './stickers/Arrows/Content/arrow-108.svg';\nimport stickerCover108 from './stickers/Arrows/Cover/arrow-109.svg';\nimport stickerContent108 from './stickers/Arrows/Content/arrow-109.svg';\nimport stickerCover109 from './stickers/Arrows/Cover/arrow-110.svg';\nimport stickerContent109 from './stickers/Arrows/Content/arrow-110.svg';\nimport stickerCover110 from './stickers/Arrows/Cover/arrow-111.svg';\nimport stickerContent110 from './stickers/Arrows/Content/arrow-111.svg';\nimport stickerCover111 from './stickers/Arrows/Cover/arrow-112.svg';\nimport stickerContent111 from './stickers/Arrows/Content/arrow-112.svg';\nimport stickerCover112 from './stickers/Arrows/Cover/arrow-113.svg';\nimport stickerContent112 from './stickers/Arrows/Content/arrow-113.svg';\nimport stickerCover113 from './stickers/Arrows/Cover/arrow-114.svg';\nimport stickerContent113 from './stickers/Arrows/Content/arrow-114.svg';\nimport stickerCover114 from './stickers/Arrows/Cover/arrow-115.svg';\nimport stickerContent114 from './stickers/Arrows/Content/arrow-115.svg';\nimport stickerCover115 from './stickers/Arrows/Cover/arrow-116.svg';\nimport stickerContent115 from './stickers/Arrows/Content/arrow-116.svg';\nimport stickerCover116 from './stickers/Arrows/Cover/arrow-117.svg';\nimport stickerContent116 from './stickers/Arrows/Content/arrow-117.svg';\nimport stickerCover117 from './stickers/Arrows/Cover/arrow-118.svg';\nimport stickerContent117 from './stickers/Arrows/Content/arrow-118.svg';\nimport stickerCover118 from './stickers/Arrows/Cover/arrow-119.svg';\nimport stickerContent118 from './stickers/Arrows/Content/arrow-119.svg';\nimport stickerCover119 from './stickers/Arrows/Cover/arrow-120.svg';\nimport stickerContent119 from './stickers/Arrows/Content/arrow-120.svg';\nimport stickerCover120 from './stickers/Arrows/Cover/arrow-121.svg';\nimport stickerContent120 from './stickers/Arrows/Content/arrow-121.svg';\nimport stickerCover121 from './stickers/Arrows/Cover/arrow-122.svg';\nimport stickerContent121 from './stickers/Arrows/Content/arrow-122.svg';\nimport stickerCover122 from './stickers/Arrows/Cover/arrow-123.svg';\nimport stickerContent122 from './stickers/Arrows/Content/arrow-123.svg';\nimport stickerCover123 from './stickers/Arrows/Cover/arrow-124.svg';\nimport stickerContent123 from './stickers/Arrows/Content/arrow-124.svg';\nimport stickerCover124 from './stickers/Arrows/Cover/arrow-125.svg';\nimport stickerContent124 from './stickers/Arrows/Content/arrow-125.svg';\nimport stickerCover125 from './stickers/Arrows/Cover/arrow-126.svg';\nimport stickerContent125 from './stickers/Arrows/Content/arrow-126.svg';\nimport stickerCover126 from './stickers/Arrows/Cover/arrow-127.svg';\nimport stickerContent126 from './stickers/Arrows/Content/arrow-127.svg';\nimport stickerCover127 from './stickers/Arrows/Cover/arrow-128.svg';\nimport stickerContent127 from './stickers/Arrows/Content/arrow-128.svg';\nimport stickerCover128 from './stickers/Arrows/Cover/arrow-129.svg';\nimport stickerContent128 from './stickers/Arrows/Content/arrow-129.svg';\nimport stickerCover129 from './stickers/Arrows/Cover/arrow-130.svg';\nimport stickerContent129 from './stickers/Arrows/Content/arrow-130.svg';\nimport stickerCover130 from './stickers/Arrows/Cover/arrow-131.svg';\nimport stickerContent130 from './stickers/Arrows/Content/arrow-131.svg';\nimport stickerCover131 from './stickers/Arrows/Cover/arrow-132.svg';\nimport stickerContent131 from './stickers/Arrows/Content/arrow-132.svg';\nimport stickerCover132 from './stickers/Arrows/Cover/arrow-133.svg';\nimport stickerContent132 from './stickers/Arrows/Content/arrow-133.svg';\nimport stickerCover133 from './stickers/Arrows/Cover/arrow-134.svg';\nimport stickerContent133 from './stickers/Arrows/Content/arrow-134.svg';\nimport stickerCover134 from './stickers/Arrows/Cover/arrow-135.svg';\nimport stickerContent134 from './stickers/Arrows/Content/arrow-135.svg';\nimport stickerCover135 from './stickers/Arrows/Cover/arrow-136.svg';\nimport stickerContent135 from './stickers/Arrows/Content/arrow-136.svg';\nimport stickerCover136 from './stickers/Arrows/Cover/arrow-137.svg';\nimport stickerContent136 from './stickers/Arrows/Content/arrow-137.svg';\nimport stickerCover137 from './stickers/Arrows/Cover/arrow-138.svg';\nimport stickerContent137 from './stickers/Arrows/Content/arrow-138.svg';\nimport stickerCover138 from './stickers/Arrows/Cover/arrow-139.svg';\nimport stickerContent138 from './stickers/Arrows/Content/arrow-139.svg';\nimport stickerCover139 from './stickers/Arrows/Cover/arrow-140.svg';\nimport stickerContent139 from './stickers/Arrows/Content/arrow-140.svg';\nimport stickerCover140 from './stickers/Arrows/Cover/arrow-141.svg';\nimport stickerContent140 from './stickers/Arrows/Content/arrow-141.svg';\nimport stickerCover141 from './stickers/Arrows/Cover/arrow-142.svg';\nimport stickerContent141 from './stickers/Arrows/Content/arrow-142.svg';\nimport stickerCover142 from './stickers/Arrows/Cover/arrow-143.svg';\nimport stickerContent142 from './stickers/Arrows/Content/arrow-143.svg';\nimport stickerCover143 from './stickers/Arrows/Cover/arrow-144.svg';\nimport stickerContent143 from './stickers/Arrows/Content/arrow-144.svg';\nimport stickerCover144 from './stickers/Arrows/Cover/arrow-145.svg';\nimport stickerContent144 from './stickers/Arrows/Content/arrow-145.svg';\nimport stickerCover145 from './stickers/Arrows/Cover/arrow-146.svg';\nimport stickerContent145 from './stickers/Arrows/Content/arrow-146.svg';\nimport stickerCover146 from './stickers/Arrows/Cover/arrow-147.svg';\nimport stickerContent146 from './stickers/Arrows/Content/arrow-147.svg';\nimport stickerCover147 from './stickers/Arrows/Cover/arrow-148.svg';\nimport stickerContent147 from './stickers/Arrows/Content/arrow-148.svg';\nimport stickerCover148 from './stickers/Arrows/Cover/arrow-149.svg';\nimport stickerContent148 from './stickers/Arrows/Content/arrow-149.svg';\nimport stickerCover149 from './stickers/Arrows/Cover/arrow-150.svg';\nimport stickerContent149 from './stickers/Arrows/Content/arrow-150.svg';\nimport stickerCover150 from './stickers/Arrows/Cover/arrow-151.svg';\nimport stickerContent150 from './stickers/Arrows/Content/arrow-151.svg';\nimport stickerCover151 from './stickers/Arrows/Cover/arrow-152.svg';\nimport stickerContent151 from './stickers/Arrows/Content/arrow-152.svg';\nimport stickerCover152 from './stickers/Arrows/Cover/arrow-153.svg';\nimport stickerContent152 from './stickers/Arrows/Content/arrow-153.svg';\nimport stickerCover153 from './stickers/Arrows/Cover/arrow-154.svg';\nimport stickerContent153 from './stickers/Arrows/Content/arrow-154.svg';\nimport stickerCover154 from './stickers/Arrows/Cover/arrow-155.svg';\nimport stickerContent154 from './stickers/Arrows/Content/arrow-155.svg';\nimport stickerCover155 from './stickers/Arrows/Cover/arrow-156.svg';\nimport stickerContent155 from './stickers/Arrows/Content/arrow-156.svg';\nimport stickerCover156 from './stickers/Arrows/Cover/arrow-157.svg';\nimport stickerContent156 from './stickers/Arrows/Content/arrow-157.svg';\nimport stickerCover157 from './stickers/Arrows/Cover/arrow-158.svg';\nimport stickerContent157 from './stickers/Arrows/Content/arrow-158.svg';\nimport stickerCover158 from './stickers/Arrows/Cover/arrow-159.svg';\nimport stickerContent158 from './stickers/Arrows/Content/arrow-159.svg';\nimport stickerCover159 from './stickers/Arrows/Cover/arrow-160.svg';\nimport stickerContent159 from './stickers/Arrows/Content/arrow-160.svg';\nimport stickerCover160 from './stickers/Arrows/Cover/arrow-161.svg';\nimport stickerContent160 from './stickers/Arrows/Content/arrow-161.svg';\nimport stickerCover161 from './stickers/Arrows/Cover/arrow-162.svg';\nimport stickerContent161 from './stickers/Arrows/Content/arrow-162.svg';\nimport stickerCover162 from './stickers/Arrows/Cover/arrow-163.svg';\nimport stickerContent162 from './stickers/Arrows/Content/arrow-163.svg';\nimport stickerCover163 from './stickers/Arrows/Cover/arrow-164.svg';\nimport stickerContent163 from './stickers/Arrows/Content/arrow-164.svg';\nimport stickerCover164 from './stickers/Arrows/Cover/arrow-165.svg';\nimport stickerContent164 from './stickers/Arrows/Content/arrow-165.svg';\nimport stickerCover165 from './stickers/Arrows/Cover/arrow-166.svg';\nimport stickerContent165 from './stickers/Arrows/Content/arrow-166.svg';\nimport stickerCover166 from './stickers/Arrows/Cover/arrow-167.svg';\nimport stickerContent166 from './stickers/Arrows/Content/arrow-167.svg';\nimport stickerCover167 from './stickers/Arrows/Cover/arrow-168.svg';\nimport stickerContent167 from './stickers/Arrows/Content/arrow-168.svg';\nimport stickerCover168 from './stickers/Arrows/Cover/arrow-169.svg';\nimport stickerContent168 from './stickers/Arrows/Content/arrow-169.svg';\nimport stickerCover169 from './stickers/Arrows/Cover/arrow-170.svg';\nimport stickerContent169 from './stickers/Arrows/Content/arrow-170.svg';\nimport stickerCover170 from './stickers/Arrows/Cover/arrow-171.svg';\nimport stickerContent170 from './stickers/Arrows/Content/arrow-171.svg';\nimport stickerCover171 from './stickers/Arrows/Cover/arrow-172.svg';\nimport stickerContent171 from './stickers/Arrows/Content/arrow-172.svg';\nimport stickerCover172 from './stickers/Arrows/Cover/arrow-173.svg';\nimport stickerContent172 from './stickers/Arrows/Content/arrow-173.svg';\nimport stickerCover173 from './stickers/Arrows/Cover/arrow-174.svg';\nimport stickerContent173 from './stickers/Arrows/Content/arrow-174.svg';\nimport stickerCover174 from './stickers/Arrows/Cover/arrow-175.svg';\nimport stickerContent174 from './stickers/Arrows/Content/arrow-175.svg';\nimport stickerCover175 from './stickers/Arrows/Cover/arrow-176.svg';\nimport stickerContent175 from './stickers/Arrows/Content/arrow-176.svg';\nimport stickerCover176 from './stickers/Arrows/Cover/arrow-177.svg';\nimport stickerContent176 from './stickers/Arrows/Content/arrow-177.svg';\nimport stickerCover177 from './stickers/Arrows/Cover/arrow-178.svg';\nimport stickerContent177 from './stickers/Arrows/Content/arrow-178.svg';\nimport stickerCover178 from './stickers/Arrows/Cover/arrow-179.svg';\nimport stickerContent178 from './stickers/Arrows/Content/arrow-179.svg';\nimport stickerCover179 from './stickers/Arrows/Cover/arrow-180.svg';\nimport stickerContent179 from './stickers/Arrows/Content/arrow-180.svg';\nimport stickerCover180 from './stickers/Arrows/Cover/arrow-181.svg';\nimport stickerContent180 from './stickers/Arrows/Content/arrow-181.svg';\nimport stickerCover181 from './stickers/Arrows/Cover/arrow-182.svg';\nimport stickerContent181 from './stickers/Arrows/Content/arrow-182.svg';\nimport stickerCover182 from './stickers/Arrows/Cover/arrow-183.svg';\nimport stickerContent182 from './stickers/Arrows/Content/arrow-183.svg';\nimport stickerCover183 from './stickers/Arrows/Cover/arrow-184.svg';\nimport stickerContent183 from './stickers/Arrows/Content/arrow-184.svg';\nimport stickerCover184 from './stickers/Arrows/Cover/arrow-185.svg';\nimport stickerContent184 from './stickers/Arrows/Content/arrow-185.svg';\nimport stickerCover185 from './stickers/Arrows/Cover/source.svg';\nimport stickerContent185 from './stickers/Arrows/Content/source.svg';\nimport stickerCover186 from './stickers/Cheeky Piggies/Cover/Crybaby.svg';\nimport stickerContent186 from './stickers/Cheeky Piggies/Content/Crybaby.svg';\nimport stickerCover187 from './stickers/Cheeky Piggies/Cover/Drool.svg';\nimport stickerContent187 from './stickers/Cheeky Piggies/Content/Drool.svg';\nimport stickerCover188 from './stickers/Cheeky Piggies/Cover/Fuming.svg';\nimport stickerContent188 from './stickers/Cheeky Piggies/Content/Fuming.svg';\nimport stickerCover189 from './stickers/Cheeky Piggies/Cover/Hi~.svg';\nimport stickerContent189 from './stickers/Cheeky Piggies/Content/Hi~.svg';\nimport stickerCover190 from './stickers/Cheeky Piggies/Cover/Holding Tears.svg';\nimport stickerContent190 from './stickers/Cheeky Piggies/Content/Holding Tears.svg';\nimport stickerCover191 from './stickers/Cheeky Piggies/Cover/Love Blows.svg';\nimport stickerContent191 from './stickers/Cheeky Piggies/Content/Love Blows.svg';\nimport stickerCover192 from './stickers/Cheeky Piggies/Cover/Me_ Really_.svg';\nimport stickerContent192 from './stickers/Cheeky Piggies/Content/Me_ Really_.svg';\nimport stickerCover193 from './stickers/Cheeky Piggies/Cover/OK.svg';\nimport stickerContent193 from './stickers/Cheeky Piggies/Content/OK.svg';\nimport stickerCover194 from './stickers/Cheeky Piggies/Cover/Sassy Flick.svg';\nimport stickerContent194 from './stickers/Cheeky Piggies/Content/Sassy Flick.svg';\nimport stickerCover195 from './stickers/Cheeky Piggies/Cover/Shockwave.svg';\nimport stickerContent195 from './stickers/Cheeky Piggies/Content/Shockwave.svg';\nimport stickerCover196 from './stickers/Cheeky Piggies/Cover/Snooze Drool.svg';\nimport stickerContent196 from './stickers/Cheeky Piggies/Content/Snooze Drool.svg';\nimport stickerCover197 from './stickers/Cheeky Piggies/Cover/Swag.svg';\nimport stickerContent197 from './stickers/Cheeky Piggies/Content/Swag.svg';\nimport stickerCover198 from './stickers/Cheeky Piggies/Cover/Sweatdrop.svg';\nimport stickerContent198 from './stickers/Cheeky Piggies/Content/Sweatdrop.svg';\nimport stickerCover199 from './stickers/Cheeky Piggies/Cover/Thumbs Up.svg';\nimport stickerContent199 from './stickers/Cheeky Piggies/Content/Thumbs Up.svg';\nimport stickerCover200 from './stickers/Cheeky Piggies/Cover/What_.svg';\nimport stickerContent200 from './stickers/Cheeky Piggies/Content/What_.svg';\nimport stickerCover201 from './stickers/Contorted Stickers/Cover/AFFiNE.svg';\nimport stickerContent201 from './stickers/Contorted Stickers/Content/AFFiNE.svg';\nimport stickerCover202 from './stickers/Contorted Stickers/Cover/AI.svg';\nimport stickerContent202 from './stickers/Contorted Stickers/Content/AI.svg';\nimport stickerCover203 from './stickers/Contorted Stickers/Cover/Cat.svg';\nimport stickerContent203 from './stickers/Contorted Stickers/Content/Cat.svg';\nimport stickerCover204 from './stickers/Contorted Stickers/Cover/Closed.svg';\nimport stickerContent204 from './stickers/Contorted Stickers/Content/Closed.svg';\nimport stickerCover205 from './stickers/Contorted Stickers/Cover/Eyes.svg';\nimport stickerContent205 from './stickers/Contorted Stickers/Content/Eyes.svg';\nimport stickerCover206 from './stickers/Contorted Stickers/Cover/Fire.svg';\nimport stickerContent206 from './stickers/Contorted Stickers/Content/Fire.svg';\nimport stickerCover207 from './stickers/Contorted Stickers/Cover/Info.svg';\nimport stickerContent207 from './stickers/Contorted Stickers/Content/Info.svg';\nimport stickerCover208 from './stickers/Contorted Stickers/Cover/King.svg';\nimport stickerContent208 from './stickers/Contorted Stickers/Content/King.svg';\nimport stickerCover209 from './stickers/Contorted Stickers/Cover/Love Face.svg';\nimport stickerContent209 from './stickers/Contorted Stickers/Content/Love Face.svg';\nimport stickerCover210 from './stickers/Contorted Stickers/Cover/Love.svg';\nimport stickerContent210 from './stickers/Contorted Stickers/Content/Love.svg';\nimport stickerCover211 from './stickers/Contorted Stickers/Cover/Notice.svg';\nimport stickerContent211 from './stickers/Contorted Stickers/Content/Notice.svg';\nimport stickerCover212 from './stickers/Contorted Stickers/Cover/Pin.svg';\nimport stickerContent212 from './stickers/Contorted Stickers/Content/Pin.svg';\nimport stickerCover213 from './stickers/Contorted Stickers/Cover/Question.svg';\nimport stickerContent213 from './stickers/Contorted Stickers/Content/Question.svg';\nimport stickerCover214 from './stickers/Contorted Stickers/Cover/Smile Face.svg';\nimport stickerContent214 from './stickers/Contorted Stickers/Content/Smile Face.svg';\nimport stickerCover215 from './stickers/Contorted Stickers/Cover/Stop.svg';\nimport stickerContent215 from './stickers/Contorted Stickers/Content/Stop.svg';\nimport stickerCover216 from './stickers/Paper/Cover/+1.svg';\nimport stickerContent216 from './stickers/Paper/Content/+1.svg';\nimport stickerCover217 from './stickers/Paper/Cover/A lot of question.svg';\nimport stickerContent217 from './stickers/Paper/Content/A lot of question.svg';\nimport stickerCover218 from './stickers/Paper/Cover/AFFiNE AI.svg';\nimport stickerContent218 from './stickers/Paper/Content/AFFiNE AI.svg';\nimport stickerCover219 from './stickers/Paper/Cover/Arrow.svg';\nimport stickerContent219 from './stickers/Paper/Content/Arrow.svg';\nimport stickerCover220 from './stickers/Paper/Cover/Atention.svg';\nimport stickerContent220 from './stickers/Paper/Content/Atention.svg';\nimport stickerCover221 from './stickers/Paper/Cover/Blue Screen.svg';\nimport stickerContent221 from './stickers/Paper/Content/Blue Screen.svg';\nimport stickerCover222 from './stickers/Paper/Cover/Boom.svg';\nimport stickerContent222 from './stickers/Paper/Content/Boom.svg';\nimport stickerCover223 from './stickers/Paper/Cover/Cool.svg';\nimport stickerContent223 from './stickers/Paper/Content/Cool.svg';\nimport stickerCover224 from './stickers/Paper/Cover/Dino.svg';\nimport stickerContent224 from './stickers/Paper/Content/Dino.svg';\nimport stickerCover225 from './stickers/Paper/Cover/Histogram.svg';\nimport stickerContent225 from './stickers/Paper/Content/Histogram.svg';\nimport stickerCover226 from './stickers/Paper/Cover/Local First.svg';\nimport stickerContent226 from './stickers/Paper/Content/Local First.svg';\nimport stickerCover227 from './stickers/Paper/Cover/Medal.svg';\nimport stickerContent227 from './stickers/Paper/Content/Medal.svg';\nimport stickerCover228 from './stickers/Paper/Cover/Notice.svg';\nimport stickerContent228 from './stickers/Paper/Content/Notice.svg';\nimport stickerCover229 from './stickers/Paper/Cover/Pin.svg';\nimport stickerContent229 from './stickers/Paper/Content/Pin.svg';\nimport stickerCover230 from './stickers/Paper/Cover/Star.svg';\nimport stickerContent230 from './stickers/Paper/Content/Star.svg';\n\nfunction buildStickerTemplate(data) {\n  return {\n    name: data.name,\n    preview: data.cover,\n    type: 'sticker',\n    assets: {\n      [data.hash]: data.content,\n    },\n    content: {\n      type: 'page',\n      meta: {\n        id: 'doc:home',\n        title: 'Sticker',\n        createDate: 1701765881935,\n        tags: [],\n      },\n      blocks: {\n        type: 'block',\n        id: 'block:1VxnfD_8xb',\n        flavour: 'affine:page',\n        props: {\n          title: {\n            '$blocksuite:internal:text$': true,\n            delta: [\n              {\n                insert: 'Sticker',\n              },\n            ],\n          },\n        },\n        children: [\n          {\n            type: 'block',\n            id: 'block:pcmYJQ63hX',\n            flavour: 'affine:surface',\n            props: {\n              elements: {},\n            },\n            children: [\n              {\n                type: 'block',\n                id: 'block:N24al1Qgl7',\n                flavour: 'affine:image',\n                props: {\n                  caption: '',\n                  sourceId: data.hash,\n                  width: 0,\n                  height: 0,\n                  index: 'b0D',\n                  xywh: '[0,0,460,430]',\n                  rotate: 0,\n                },\n                children: [],\n              },\n            ],\n          },\n        ],\n      },\n    },\n  };\n}\n\nfunction lcs(text1: string, text2: string) {\n  const dp: number[][] = Array.from({ length: text1.length + 1 })\n    .fill(null)\n    .map(() => Array.from<number>({length: text2.length + 1}).fill(0));\n\n  for (let i = 1; i <= text1.length; i++) {\n    for (let j = 1; j <= text2.length; j++) {\n      if (text1[i - 1] === text2[j - 1]) {\n        dp[i][j] = dp[i - 1][j - 1] + 1;\n      } else {\n        dp[i][j] = Math.max(dp[i - 1][j], dp[i][j - 1]);\n      }\n    }\n  }\n\n  return dp[text1.length][text2.length];\n}\n\nconst templates = {\n  \"Arrows\": [     buildStickerTemplate({\n        name: \"arrow-1\",\n        cover: stickerCover000,\n        content: stickerContent000,\n        hash: \"YaaYGysUizxrn-koKS9MlYXg2R2zpQecoFx08jya0aQ=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-2\",\n        cover: stickerCover001,\n        content: stickerContent001,\n        hash: \"T3QfBMbD4gWhI6lL4TRNe5FMat02T2YBvPe-Rm4FkrY=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-3\",\n        cover: stickerCover002,\n        content: stickerContent002,\n        hash: \"zfqg42rHf9B8I74XfxaZ4-mXnmFlwX9SZk47AN-MuY8=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-4\",\n        cover: stickerCover003,\n        content: stickerContent003,\n        hash: \"OYOorxDDTlC73QmhkhpxYlpCl00nZGG_MY3fCaChAyw=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-5\",\n        cover: stickerCover004,\n        content: stickerContent004,\n        hash: \"lVpqGZ4JOJLnF8Lj6LUr3HXt8Uzg14HUKTdy61mA06E=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-6\",\n        cover: stickerCover005,\n        content: stickerContent005,\n        hash: \"YQvXGmyQ5CMoeQOqiICDhRlPMx4GxJbK1s1VcCgWJXg=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-7\",\n        cover: stickerCover006,\n        content: stickerContent006,\n        hash: \"W0soM0fGEdNGDj8Aes2l2XpXfC8ib-8zpCw8HbEMcsI=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-8\",\n        cover: stickerCover007,\n        content: stickerContent007,\n        hash: \"UU1vpJSy17AzURffXHIfQbkNPQ8nH5_Z60xTYUy2ifI=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-9\",\n        cover: stickerCover008,\n        content: stickerContent008,\n        hash: \"SrCFM2aHAyR6-oBEqHdhiflZVmVL2zt-rDbgLtANvAM=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-10\",\n        cover: stickerCover009,\n        content: stickerContent009,\n        hash: \"lehO7Xs0UKt0MR8RyZ6kV74M_zCy0GgrTSiOD7oNRmE=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-11\",\n        cover: stickerCover010,\n        content: stickerContent010,\n        hash: \"_dXUvx5tTcm4IykbislTxwNoSLJ4g3oqmd7A9x4ONdY=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-12\",\n        cover: stickerCover011,\n        content: stickerContent011,\n        hash: \"cwaReNMJ3a7-qEjDWyiqV-BZB3hH7yJmm7xTRyEQktM=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-13\",\n        cover: stickerCover012,\n        content: stickerContent012,\n        hash: \"OZS78ZRp59njtnYy4EMPrDJRBaW7GHCHOAnlB7oquBo=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-14\",\n        cover: stickerCover013,\n        content: stickerContent013,\n        hash: \"3htAxVQCWAm3c0_xy0sUXKB_TAzwqwcodLA2W-633nA=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-15\",\n        cover: stickerCover014,\n        content: stickerContent014,\n        hash: \"xjqPPHMP_NtP_T4c8SDW-9XMiZJOf01BnXATYq7WwUc=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-16\",\n        cover: stickerCover015,\n        content: stickerContent015,\n        hash: \"celWgMBt-s1RP6U9e4XY0Cl2DbQ640-d-dmmKJOTPbU=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-17\",\n        cover: stickerCover016,\n        content: stickerContent016,\n        hash: \"tlHzKPxi-aD8VBnvYY92WL44AXLrS1fiiAT4Q2BZM0A=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-18\",\n        cover: stickerCover017,\n        content: stickerContent017,\n        hash: \"_XMVZ9Ky61ezOSN9lhOUpIozBo8s0rzWDnb7wmOhpXA=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-19\",\n        cover: stickerCover018,\n        content: stickerContent018,\n        hash: \"Wz0AJRnxvmUP5tVN2lauHdJ8zTaM9YNp6bDGqz1oeJk=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-20\",\n        cover: stickerCover019,\n        content: stickerContent019,\n        hash: \"spOLMoa4_zQrMdEQVp7N9WNP2p-fidto0KBHPcONRPE=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-21\",\n        cover: stickerCover020,\n        content: stickerContent020,\n        hash: \"h38dM2XAmu4KuVJX9ub4KN0BRoTz9HL0bSF6wsH-GZU=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-22\",\n        cover: stickerCover021,\n        content: stickerContent021,\n        hash: \"Q06vAxpk3bVg7tPPx6d_rLt_BXSn2XtQm04Y83o5mVE=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-23\",\n        cover: stickerCover022,\n        content: stickerContent022,\n        hash: \"A4rLg-FbEFkqP7NMZV1clkPRT-QINd26jg16Fa3fVwU=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-24\",\n        cover: stickerCover023,\n        content: stickerContent023,\n        hash: \"WvD3rniT5lIIXDPzZjLDRFA8Dyh9fyZXu3pTWEtF1-s=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-25\",\n        cover: stickerCover024,\n        content: stickerContent024,\n        hash: \"Qvp034XeuAbYvvHqbJJ6FYU15EqR9JMSQwNVLBVHeyk=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-26\",\n        cover: stickerCover025,\n        content: stickerContent025,\n        hash: \"e7hjjnG2FI3n2dfUfRg5Knpn944nnMQYhdr1LVCNhRU=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-27\",\n        cover: stickerCover026,\n        content: stickerContent026,\n        hash: \"c8fsJDnXqHrRFg3Ju83wRHa1RCO9k3o2NFF1Tjr8thQ=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-28\",\n        cover: stickerCover027,\n        content: stickerContent027,\n        hash: \"JGY17Y2grsR8lGd0sZf85_ZjL6-uvAp0ONtX3FK95ck=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-29\",\n        cover: stickerCover028,\n        content: stickerContent028,\n        hash: \"F4YbPiTTNGq9cyiqSKjIxAEBYdWORNLFYxHMmfAs24o=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-30\",\n        cover: stickerCover029,\n        content: stickerContent029,\n        hash: \"wDMTQN26VcBOOF9nDhlem7ovgKLdNbFOvPyEDoHk6H0=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-31\",\n        cover: stickerCover030,\n        content: stickerContent030,\n        hash: \"c9p-sdq9YXFyNcsfgn6CC6n-DNDi9MxAW7v-4u_sLbo=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-32\",\n        cover: stickerCover031,\n        content: stickerContent031,\n        hash: \"lQr19wl2u3bkJ4y_q5BaLDe6K2DtIpu8AUktOAEou38=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-33\",\n        cover: stickerCover032,\n        content: stickerContent032,\n        hash: \"wGi2efXTFGlBV97YvMm72_miToeWITK_SfSgEmL04LY=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-34\",\n        cover: stickerCover033,\n        content: stickerContent033,\n        hash: \"-nOQjmN_oJrfSZqwRVK5SxKVNcLNDjsgd1CkpOyBIyY=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-35\",\n        cover: stickerCover034,\n        content: stickerContent034,\n        hash: \"I0WOQG_uY4j7l7xonH2D0dEpcvsqE7g5h_B8ZZqxBgI=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-36\",\n        cover: stickerCover035,\n        content: stickerContent035,\n        hash: \"Cov5L8kmEp9w5xza4bDj_EQ6u--_Xx1GNO3vcGgx3YE=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-37\",\n        cover: stickerCover036,\n        content: stickerContent036,\n        hash: \"3V1oNO4Mpy2GMi8uAqSqpYXYPJBGp_1ZCgDaEl9wVxI=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-38\",\n        cover: stickerCover037,\n        content: stickerContent037,\n        hash: \"uvdQrHq3w8jVwJe5KRBJHi9kd0CmEJl2sZfAEj2XKdM=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-39\",\n        cover: stickerCover038,\n        content: stickerContent038,\n        hash: \"Az86WgB08HFKq7bUIokNEw-nEp42A27Gt3_ZbJXksyw=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-40\",\n        cover: stickerCover039,\n        content: stickerContent039,\n        hash: \"X0XV84s7C0Kdu3YwrSPgENA9ljWCXzSXpgY3A-xyaXA=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-41\",\n        cover: stickerCover040,\n        content: stickerContent040,\n        hash: \"mYOSSo5okBDq6skCILrS8LTpW6-xfwusBoKVlkuCkzQ=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-42\",\n        cover: stickerCover041,\n        content: stickerContent041,\n        hash: \"4l6wtVF-XjqEnsKe-IorebIcgUG4GGLLLlbns2LFh5Y=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-43\",\n        cover: stickerCover042,\n        content: stickerContent042,\n        hash: \"3gR8h5LNWKGH8gA2C5_AjzrfDZD62pgJADPVTFDDaCw=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-44\",\n        cover: stickerCover043,\n        content: stickerContent043,\n        hash: \"qDhEedh5a5F5qXuGGec6_y_v4Qp1TFrgtuKqF4PG9Xc=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-45\",\n        cover: stickerCover044,\n        content: stickerContent044,\n        hash: \"R2Xz-yMk_8lA_svgD8p0kt1qEiDoNh0kmqggaMcqLAE=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-46\",\n        cover: stickerCover045,\n        content: stickerContent045,\n        hash: \"zJ8gOpjZ-v9dgH7lsJBohyTCPqCLCY_hAmRLkgnXuOs=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-47\",\n        cover: stickerCover046,\n        content: stickerContent046,\n        hash: \"AmYp6Sz1U336rD4IbOlLFg0vxCbuhhSXbqBdXz7Uxjw=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-48\",\n        cover: stickerCover047,\n        content: stickerContent047,\n        hash: \"TKnls2KcG0don7CExsXGfGoCR__wxKHywMClrdalLt4=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-49\",\n        cover: stickerCover048,\n        content: stickerContent048,\n        hash: \"39a8HJTi7-d-fWMsbS52trjZRXv6dCeZprY3C7Z87K8=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-50\",\n        cover: stickerCover049,\n        content: stickerContent049,\n        hash: \"EbBer46rRfgwQrkn-wmvGtlnPt8E0BPtys5AZaAiCBg=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-51\",\n        cover: stickerCover050,\n        content: stickerContent050,\n        hash: \"0AUgxWzhjSlb6dJ00JdlaDauf3XYbu6s5LkREGOQu2o=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-52\",\n        cover: stickerCover051,\n        content: stickerContent051,\n        hash: \"lod43ond8UWBEt1BuCtARNI4CR4dxM7rWpslbDpgI64=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-53\",\n        cover: stickerCover052,\n        content: stickerContent052,\n        hash: \"Jacw1kzigDegUKTqoGCblNRKLZ1x5v0DKdDzeX1ZOI4=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-54\",\n        cover: stickerCover053,\n        content: stickerContent053,\n        hash: \"Kt1rXTJAbBpYPBFa503w_lT5tB3T1elds1FAFZP3uSQ=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-55\",\n        cover: stickerCover054,\n        content: stickerContent054,\n        hash: \"B9NdjtekEcN5oAl5OJNCS_nLpKejXTRNgsCoHDlrMOU=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-56\",\n        cover: stickerCover055,\n        content: stickerContent055,\n        hash: \"qHg56iOOdWQuE-rZaow6EjW8xCmM8KW89s2kUXnsPPk=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-57\",\n        cover: stickerCover056,\n        content: stickerContent056,\n        hash: \"10MHITGc7WLFxUHX48DBaT4kGB4-_U387XnY8sLckyk=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-58\",\n        cover: stickerCover057,\n        content: stickerContent057,\n        hash: \"AR3Vb5Ls8s1bYxNcKyqNp1hzbEN_0ONG7XbCOOP9MIQ=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-59\",\n        cover: stickerCover058,\n        content: stickerContent058,\n        hash: \"FhklHxC9FkPnYOelqR9fmyDePimgC2AdFUal9lQTxT0=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-60\",\n        cover: stickerCover059,\n        content: stickerContent059,\n        hash: \"qxGeYRvhJdFiDHFKeh1x1PFdGOwMB5vcS_TS84plCnU=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-61\",\n        cover: stickerCover060,\n        content: stickerContent060,\n        hash: \"KAdP7kc19_WdMA8-liEOPC1ziXaxTXmA7tppdFq8e9s=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-62\",\n        cover: stickerCover061,\n        content: stickerContent061,\n        hash: \"UnGxrjNjKzW34c_q1Aot6xquEa2tmLht9FjTSM4tABg=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-63\",\n        cover: stickerCover062,\n        content: stickerContent062,\n        hash: \"T7jQAdOwCgw3q4kPSWiuhMuiTyYSqc66OSnvfs9FRJ0=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-64\",\n        cover: stickerCover063,\n        content: stickerContent063,\n        hash: \"sKzuGfE90E8IIluGiUwuyx8OJKbvoTReiOAHDCSRp1M=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-65\",\n        cover: stickerCover064,\n        content: stickerContent064,\n        hash: \"XI_NKdIzwCHUdpKJWIjLbcIRAfqWcndTysQM4rih9ts=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-66\",\n        cover: stickerCover065,\n        content: stickerContent065,\n        hash: \"RleQTrXAxdfBAULTfmrQniFREUI_Qsz4dTjmDGhccQo=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-67\",\n        cover: stickerCover066,\n        content: stickerContent066,\n        hash: \"x5TMf4rI1S-YzA0V9wERKTdOaMbRKBZD1NDu_1I5THY=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-68\",\n        cover: stickerCover067,\n        content: stickerContent067,\n        hash: \"a6KuDZVNqxg1m8zcdPJ5X37yp1Z2RaPBibLON6DHG_o=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-69\",\n        cover: stickerCover068,\n        content: stickerContent068,\n        hash: \"w9ONvmYzWnZZOOjQNGZHNvHBj4O_tEii3aSSk27604E=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-70\",\n        cover: stickerCover069,\n        content: stickerContent069,\n        hash: \"q-TzLIs1Vnom51w4gCmvmcsB_X8ZzauX-reEqIzL4AE=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-71\",\n        cover: stickerCover070,\n        content: stickerContent070,\n        hash: \"nJt3Lie_4lb7JfZvJYbr_JbanmvN2HspMw11Cd1FsGw=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-72\",\n        cover: stickerCover071,\n        content: stickerContent071,\n        hash: \"_4yssK79DQYCjYpmVR71G1J_jGDsWqUpnLRjl2fxl1g=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-73\",\n        cover: stickerCover072,\n        content: stickerContent072,\n        hash: \"XxN6YXRVZMVXGhkZbuqrTGZapUCKWQ5eCKkWqzWpm6o=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-74\",\n        cover: stickerCover073,\n        content: stickerContent073,\n        hash: \"gTDGr6agieS0aX7Zqn_JeHzXwK_4zh_bu21dT_azrEg=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-75\",\n        cover: stickerCover074,\n        content: stickerContent074,\n        hash: \"cQQFdMzD9BHwFEKveUdf4TBSSn5v6RzFEWRgNbT-2aE=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-76\",\n        cover: stickerCover075,\n        content: stickerContent075,\n        hash: \"jLYcblTKLLbF3LqlH2y6hct4davXDEGzgL47IYNgjMA=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-77\",\n        cover: stickerCover076,\n        content: stickerContent076,\n        hash: \"_mWNkJ8I_nAuO7KsPgKm-3MjAutNc-WSS0uYvvKlYz8=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-78\",\n        cover: stickerCover077,\n        content: stickerContent077,\n        hash: \"koB_mtrAP5nO43INYL17oBFgMcdAOBg01myAEa-WeaU=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-79\",\n        cover: stickerCover078,\n        content: stickerContent078,\n        hash: \"sxgXGRnY1INaau0E7lB-9BIUdKSDuRv3yhkhZ735WNo=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-80\",\n        cover: stickerCover079,\n        content: stickerContent079,\n        hash: \"WoKb0XxY2vkV9qwFyGMYC0T7sPFlUmP9CZIKypuDM4Q=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-81\",\n        cover: stickerCover080,\n        content: stickerContent080,\n        hash: \"eKh09dHTXqvmMICV1HoJeEKQUBFP3uD0n6dB2qs6etM=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-82\",\n        cover: stickerCover081,\n        content: stickerContent081,\n        hash: \"uaezPvW7KieyG0_58MD6BkJEbfjnnUpQBIE3ZhsRGiw=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-83\",\n        cover: stickerCover082,\n        content: stickerContent082,\n        hash: \"1EGNaIXzya6Gy_MhxB_nuvzVWVa3osLYhcAj6ZpX4BI=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-84\",\n        cover: stickerCover083,\n        content: stickerContent083,\n        hash: \"mvQMRlR_GJ8tp8ncap4jIgBmPalapJV-cJVdTRMZgXM=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-85\",\n        cover: stickerCover084,\n        content: stickerContent084,\n        hash: \"qFvtDG3q_nsUl5FR3cPH6bcfkbVwOWn1XCyac8QoQBY=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-86\",\n        cover: stickerCover085,\n        content: stickerContent085,\n        hash: \"uXpsDDpWzxUBu2OaMxFJFGkHuJDQ59NTQXocl5HmiNE=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-87\",\n        cover: stickerCover086,\n        content: stickerContent086,\n        hash: \"2V5PR2qrVW516Td2advDoYFrQVPO2HGHv82xZ5jxVds=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-88\",\n        cover: stickerCover087,\n        content: stickerContent087,\n        hash: \"YxmlQ71SPxltuf3pHx6DUOvCFtQB9z9nCgETxX4iW8Y=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-89\",\n        cover: stickerCover088,\n        content: stickerContent088,\n        hash: \"hIeVzZMwHE5mKg7s0cQ__4v9MIOKNbgvoYybrChR9_c=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-90\",\n        cover: stickerCover089,\n        content: stickerContent089,\n        hash: \"e2Fh3BuJJ9r3eyN92MeLeP-rTfGVgtGw4-10BeIfR-c=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-91\",\n        cover: stickerCover090,\n        content: stickerContent090,\n        hash: \"quwM6cyRSvnsn1j6fsB4saZUpAxooky3F_9BSLKn21Y=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-92\",\n        cover: stickerCover091,\n        content: stickerContent091,\n        hash: \"poYBN2TaRZ2vqOU7SSDl2lfftpWZxqQW0iC7JWK-EaA=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-93\",\n        cover: stickerCover092,\n        content: stickerContent092,\n        hash: \"XWVUNPUtdC-XouXk1lduRIftYPrv6evaATxUWnUh7P0=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-94\",\n        cover: stickerCover093,\n        content: stickerContent093,\n        hash: \"9MGtE1XdWXKTCdBJr7nnA5bpcxLCCu_A8aBBSWzpCSI=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-95\",\n        cover: stickerCover094,\n        content: stickerContent094,\n        hash: \"hgMEGBkWqMHfIkWVLcZ1PbK-LVqRxgXYapd6EuBWcaA=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-96\",\n        cover: stickerCover095,\n        content: stickerContent095,\n        hash: \"IceU12pEQ7MBcrQC35LhJ_Zn3L04QuFV3Mdv7YT7FMk=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-97\",\n        cover: stickerCover096,\n        content: stickerContent096,\n        hash: \"o_H8jR75oxwJEF9JZobNHeQaxz_UXNeGyVHErb95bo4=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-98\",\n        cover: stickerCover097,\n        content: stickerContent097,\n        hash: \"T_Nv1A4TIaiyXAwt8gljpkAT2Z3J_LTB02_x-fx3QfY=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-99\",\n        cover: stickerCover098,\n        content: stickerContent098,\n        hash: \"RKbA1LvkNKrqITLidXxAtkabVSmqXn4CyUBc3CZ3oKc=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-100\",\n        cover: stickerCover099,\n        content: stickerContent099,\n        hash: \"YHrOpB868jEjxFoCAEjx11RMw7AEhnLEoBCMwlt3LYo=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-101\",\n        cover: stickerCover100,\n        content: stickerContent100,\n        hash: \"maGNtNtcIRjZNSCvmrg06iUnJa1w5Nf4JvzSmIGY8ws=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-102\",\n        cover: stickerCover101,\n        content: stickerContent101,\n        hash: \"ODaH0-jBWhlR0xy2ELPGP78Xokjrr5VjoQnfPZu0EcE=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-103\",\n        cover: stickerCover102,\n        content: stickerContent102,\n        hash: \"qYjgNfKU265UxXMDWPWYUNsjeN46VUYS6jnEJ4xeQUI=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-104\",\n        cover: stickerCover103,\n        content: stickerContent103,\n        hash: \"Tj0oBWQKtSO_1528dsfUlwgOqnPq8EBhC7aZYDWXfhs=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-105\",\n        cover: stickerCover104,\n        content: stickerContent104,\n        hash: \"KJS9VQh7NVNidvVTr8ue0mHPABDIe_OCqlWYejZr1Hg=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-106\",\n        cover: stickerCover105,\n        content: stickerContent105,\n        hash: \"Ut25LI6ck53-qeZ78Cydd0R3l1Rc6NORHudUd6wvTj4=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-107\",\n        cover: stickerCover106,\n        content: stickerContent106,\n        hash: \"7HpyfAAitzLHycn52giubS8TI7nVsR29LQ1oP4m8tEs=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-108\",\n        cover: stickerCover107,\n        content: stickerContent107,\n        hash: \"eoAS3h5skTCH12LqQ1_XkpZkZnSiJIoz51l-Q7Hhcuc=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-109\",\n        cover: stickerCover108,\n        content: stickerContent108,\n        hash: \"MagxHByjiJ2s33LdBCxP9JNTEy-qnHdYJ_EOg1OYdb4=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-110\",\n        cover: stickerCover109,\n        content: stickerContent109,\n        hash: \"UoOMFSmjXcHqtngkSNdx68zRVhU5Hp3uxERKLlooQVY=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-111\",\n        cover: stickerCover110,\n        content: stickerContent110,\n        hash: \"m2DEb21bFxLa6XkfLvCtxmIQfnDDllSdOrxXvFcOMT4=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-112\",\n        cover: stickerCover111,\n        content: stickerContent111,\n        hash: \"OokShOsH5aZC5Zbfh8Lkqj01HoPbnfbjdQkJQaaw3ug=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-113\",\n        cover: stickerCover112,\n        content: stickerContent112,\n        hash: \"dnKWQym8Dgz0UzYcUaK2tfph0kp7PrP0pY1wEFIcgZ0=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-114\",\n        cover: stickerCover113,\n        content: stickerContent113,\n        hash: \"QrU4_P6AF-1K1EaD68OHBQf0uPXOhTG24QfdcqOMa1Y=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-115\",\n        cover: stickerCover114,\n        content: stickerContent114,\n        hash: \"GMkgR0E8CJUZ-tmyXAElVSAYz_NRG4sYrZdOv2oRB3Q=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-116\",\n        cover: stickerCover115,\n        content: stickerContent115,\n        hash: \"UHl_GxFYv6N0vv14tia8ikpumzM_0U60tQBu7IRRgas=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-117\",\n        cover: stickerCover116,\n        content: stickerContent116,\n        hash: \"djrkvvGtEKWqJaKEJYEtULt3-irEqCbrKpR9ZO5ZfEs=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-118\",\n        cover: stickerCover117,\n        content: stickerContent117,\n        hash: \"FSjNcXiifqvpDqKTJgJmAbftD_NwfbUm5ls24hupE3A=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-119\",\n        cover: stickerCover118,\n        content: stickerContent118,\n        hash: \"_-fmAAV8-Y_46ovEt7Cj4vjpguT_IUTNXMfzwmzpXvM=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-120\",\n        cover: stickerCover119,\n        content: stickerContent119,\n        hash: \"GkDSsSD4vncYvGWmx5jD-VkyGLPZe74i34HHEV6lxs4=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-121\",\n        cover: stickerCover120,\n        content: stickerContent120,\n        hash: \"54oAfew92u5k2i2m_wKzDrDKCZMPVwecWPNu-j8SlYI=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-122\",\n        cover: stickerCover121,\n        content: stickerContent121,\n        hash: \"KORPcjmy9n9mMG0vqyxmBQA-4vJ0RjD7KoS5S45T3jw=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-123\",\n        cover: stickerCover122,\n        content: stickerContent122,\n        hash: \"Qz59poJguyJw9AGiHRRPf3PW0ZeE8OgglRSmBa1D2rc=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-124\",\n        cover: stickerCover123,\n        content: stickerContent123,\n        hash: \"GKr2EbYxDpz_q1Zkr6JJXTFzfSHUt2LJFbRAD75h9Bw=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-125\",\n        cover: stickerCover124,\n        content: stickerContent124,\n        hash: \"WFMY2PQ03BRTNXwBu1JnMUUymFpkYMrRXDtnSPdldHQ=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-126\",\n        cover: stickerCover125,\n        content: stickerContent125,\n        hash: \"gmsqvXOgIMM16zlHXLbfwZABSzAN3C0FBGq5Wk-v1xg=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-127\",\n        cover: stickerCover126,\n        content: stickerContent126,\n        hash: \"e5bXvc6Uf0qPkajmzAL0sNSg8gFHPhPpKGh3O5eh1M0=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-128\",\n        cover: stickerCover127,\n        content: stickerContent127,\n        hash: \"XDRUK8DczeG1-oCVPE8NGSkKT0DWo4LebdZ_qcW-frk=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-129\",\n        cover: stickerCover128,\n        content: stickerContent128,\n        hash: \"7OUGO8MAMnuXrlJTa3n9tV_97BEUdmvUTEJJ_Su5o00=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-130\",\n        cover: stickerCover129,\n        content: stickerContent129,\n        hash: \"UBjSYs2MzMR8knqu3SkZNerIpoQAesAFv9jb9y0qaWM=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-131\",\n        cover: stickerCover130,\n        content: stickerContent130,\n        hash: \"gw0lkMrt8Nxf7VH4WB82psFO1CI1cge29F2FFDE6HVU=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-132\",\n        cover: stickerCover131,\n        content: stickerContent131,\n        hash: \"JgcPNXMXJrlbGiVc_IyLcwxiAYjXVGTQKxZLvGnr_uk=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-133\",\n        cover: stickerCover132,\n        content: stickerContent132,\n        hash: \"luQXiAzIJ7hxWEqiG483JKupOtkFpgOAKKgI8Wzms1o=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-134\",\n        cover: stickerCover133,\n        content: stickerContent133,\n        hash: \"H5XE_wOB5dg1TKso2zxseeXIubLIhSwNZ3Py3n9k-FE=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-135\",\n        cover: stickerCover134,\n        content: stickerContent134,\n        hash: \"HtTxkr8kBtSDHy7HW2_E_csFc4KhDRi3Z5gkZyDm4kM=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-136\",\n        cover: stickerCover135,\n        content: stickerContent135,\n        hash: \"sDe_sAZ9japs2uB025cVp5qViZVw4m2LeAWE6HZKQnU=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-137\",\n        cover: stickerCover136,\n        content: stickerContent136,\n        hash: \"75EsFpQ8QYEh2z-sLanaSWaJttlvuthbMPzQJjply64=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-138\",\n        cover: stickerCover137,\n        content: stickerContent137,\n        hash: \"MLrbqX_vUy3k6lm42iKp4qJZWzXFDzf1DxzjQghElqI=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-139\",\n        cover: stickerCover138,\n        content: stickerContent138,\n        hash: \"PQ4Qj4DuBFKF4J5SOmW2jcNLjtlIcnzoYYfiEdFU5Hk=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-140\",\n        cover: stickerCover139,\n        content: stickerContent139,\n        hash: \"y8nOErU_v0Ko_nvzIhSlilF0ue6lbSTE7D3Tdla5cYo=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-141\",\n        cover: stickerCover140,\n        content: stickerContent140,\n        hash: \"rta9VUGWRd_0PQ-5ZATrec3K4TKzPfoOXZ4aQbYJlC8=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-142\",\n        cover: stickerCover141,\n        content: stickerContent141,\n        hash: \"JLhISwmOHa6UNuU5cQSXRZHWdbtWF-B7m7whN7H-440=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-143\",\n        cover: stickerCover142,\n        content: stickerContent142,\n        hash: \"FPtqso4jtpd234L1b2f8aYJVSpoMdjrbDuTjTkGFSl8=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-144\",\n        cover: stickerCover143,\n        content: stickerContent143,\n        hash: \"7O9NNBRHcHVsVWpzgx7gYSjR5F93SRw4MV2n53b-rfo=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-145\",\n        cover: stickerCover144,\n        content: stickerContent144,\n        hash: \"Zy_Qh9RquYQy-NAqdd4f71SnULIw4kfih0clDMUXoJU=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-146\",\n        cover: stickerCover145,\n        content: stickerContent145,\n        hash: \"unLJEDYQ-wmBigb-qUBQMoHbAkr0kpzmNaAkurJPd9I=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-147\",\n        cover: stickerCover146,\n        content: stickerContent146,\n        hash: \"zFD6YXAGNl_BaxcnPe-MwXOj-6v1IoHWkyBb21ssnrE=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-148\",\n        cover: stickerCover147,\n        content: stickerContent147,\n        hash: \"P6zOprXE8RAaqavT7JB_2Wm8TTtKe9SlWDslfayDG3I=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-149\",\n        cover: stickerCover148,\n        content: stickerContent148,\n        hash: \"qDvs8pxqTYqjZRSIvjr4JIcLo00MMK5-REo_foIxqGk=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-150\",\n        cover: stickerCover149,\n        content: stickerContent149,\n        hash: \"Xmw_3s09sxS2x68zK_4tKRJchcEGPOT4ekldYUBwuhc=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-151\",\n        cover: stickerCover150,\n        content: stickerContent150,\n        hash: \"ncvXReXL12IJ_-jSPP3MNoaUm0sbJEiwDFbSOCm5YrA=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-152\",\n        cover: stickerCover151,\n        content: stickerContent151,\n        hash: \"tc6g4G4P6sXFh_-RyIwC-mPARxlI9GGTWT2qM4qGQv8=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-153\",\n        cover: stickerCover152,\n        content: stickerContent152,\n        hash: \"fgv878SEsW1-XSuSQvmtfvSEGTz6n2d_bkEX2LpFhxM=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-154\",\n        cover: stickerCover153,\n        content: stickerContent153,\n        hash: \"ehrIzGjsE2q-5vqSG_mv8QBpMp9KYacRxxh9MoRgj4Y=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-155\",\n        cover: stickerCover154,\n        content: stickerContent154,\n        hash: \"kLQkz14oGfs8pra_VArR6TwO6u08J3S58n4qfIm54PM=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-156\",\n        cover: stickerCover155,\n        content: stickerContent155,\n        hash: \"rkK3vR72XGsQ7HnaZlaQe_ooBNy7wvELFPl-hIOR_Vk=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-157\",\n        cover: stickerCover156,\n        content: stickerContent156,\n        hash: \"QEKKz5wIKf2cQotvTq3C86KkXhDMqSbE2lylbwkXDh4=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-158\",\n        cover: stickerCover157,\n        content: stickerContent157,\n        hash: \"sqjVjNiIlEF3tO8g9JVEFScUKCPBY0caznqsP0G9H9Y=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-159\",\n        cover: stickerCover158,\n        content: stickerContent158,\n        hash: \"2HmHLWQm_D9n8s-b8ozrmwfMLusAZ9ZJ6Ho2CAvvIDU=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-160\",\n        cover: stickerCover159,\n        content: stickerContent159,\n        hash: \"oITqoWKu7lLGPUuIYVaxeZriD-9ScH54HJ_GSUEGeWY=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-161\",\n        cover: stickerCover160,\n        content: stickerContent160,\n        hash: \"tT1v09rMg2t7jsjdBQlan-VhY3zn2HOQNt41bQz-CB4=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-162\",\n        cover: stickerCover161,\n        content: stickerContent161,\n        hash: \"n5sh39cXKuzEt3xgOKe5qXL4jcxAWq-ofTPsZVFkQS0=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-163\",\n        cover: stickerCover162,\n        content: stickerContent162,\n        hash: \"HVd59C5Za0TPfjZ7VP2VkgT33gdGL9EEod2JtyiKMzI=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-164\",\n        cover: stickerCover163,\n        content: stickerContent163,\n        hash: \"2-UWNL3XDEYX1zQkORaDLLePdZDYYUdB8LdnxU3uGMA=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-165\",\n        cover: stickerCover164,\n        content: stickerContent164,\n        hash: \"1-kbw2QzT09CqljGliDnNnqOIeDimVBCYaSgLkPMPsE=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-166\",\n        cover: stickerCover165,\n        content: stickerContent165,\n        hash: \"m3NKcP-reCn2I5O2do79AtYyC-WvKEgWOYfFCUhsxDk=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-167\",\n        cover: stickerCover166,\n        content: stickerContent166,\n        hash: \"7_2MDEWn8DO6re_dBgDXqST_KD8P8oU8fLqCXgqX5yU=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-168\",\n        cover: stickerCover167,\n        content: stickerContent167,\n        hash: \"uqghDJdRp3nYpE3w3bDhga8Hplwl9Wqj610njR0IF_Y=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-169\",\n        cover: stickerCover168,\n        content: stickerContent168,\n        hash: \"L8rCxau1aGk5jTgkDJnJOxKuR5AJ8c0m6ba7-A7nJ44=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-170\",\n        cover: stickerCover169,\n        content: stickerContent169,\n        hash: \"E3KTyPCwLWhSMK_yEYUJIBvcBEDahQDyBq3iWCidIrk=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-171\",\n        cover: stickerCover170,\n        content: stickerContent170,\n        hash: \"mpnL0nWiiZQgc8J2k3waH0KfEatljxPRyqiDOMls0EM=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-172\",\n        cover: stickerCover171,\n        content: stickerContent171,\n        hash: \"wOh96Sl2ZJa_dOYHD6jasbMmdy8M-vnui64gX5L-kLY=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-173\",\n        cover: stickerCover172,\n        content: stickerContent172,\n        hash: \"Jcz5e418FcYZO3VkkFT7_2agkFzjFEsaA2zepwdOjgc=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-174\",\n        cover: stickerCover173,\n        content: stickerContent173,\n        hash: \"NX8g8xaf9VaR_IUxYFvGN4W96gtY08t1xn3o7ABRO7c=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-175\",\n        cover: stickerCover174,\n        content: stickerContent174,\n        hash: \"wB3lJNTCUkHF3-TL9DLlevqxHlLHdJxi7HoR5r0Wg08=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-176\",\n        cover: stickerCover175,\n        content: stickerContent175,\n        hash: \"jn9sQ9iPETR1k3hep0hH03f74x-nWtpDsFHP3h2yor8=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-177\",\n        cover: stickerCover176,\n        content: stickerContent176,\n        hash: \"9GO5x53CdMLEodGlKfjBwMHcUDMZ2KoxFrxKdy3i1DY=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-178\",\n        cover: stickerCover177,\n        content: stickerContent177,\n        hash: \"PAwkZBx_VXXXPLHhPJtf4fpWbYa4YJe8iZbhsovXrB4=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-179\",\n        cover: stickerCover178,\n        content: stickerContent178,\n        hash: \"SJR0JAX-p8esSoC6csYz1fRl3AXBs3VJglyf5nd8Deg=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-180\",\n        cover: stickerCover179,\n        content: stickerContent179,\n        hash: \"cTLltuV1M3z6lmdrtDDx0MbHJUnKp7KVG-WanFqjxTI=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-181\",\n        cover: stickerCover180,\n        content: stickerContent180,\n        hash: \"enogocPOFTCe_-q8scyRcK2E326DG_3h8YM0CvoPyuw=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-182\",\n        cover: stickerCover181,\n        content: stickerContent181,\n        hash: \"iNTYzdLr4Y5sbhnjgAWgXFuf7WYB03oxzKVDfudR42k=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-183\",\n        cover: stickerCover182,\n        content: stickerContent182,\n        hash: \"FuV06U5Dc6S8b8m3pp0fml_1Imi_wMfVOZEAUOM_71g=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-184\",\n        cover: stickerCover183,\n        content: stickerContent183,\n        hash: \"SQdUoVHFVgchAjKVwpaLSdvrqKsi9hkJh1b3Ev85S-w=\",\n      }),\n     buildStickerTemplate({\n        name: \"arrow-185\",\n        cover: stickerCover184,\n        content: stickerContent184,\n        hash: \"vADqPOh_77ICtLfNIWFfI0IvORhi8GFitltmLfk1TKk=\",\n      }),\n     buildStickerTemplate({\n        name: \"source\",\n        cover: stickerCover185,\n        content: stickerContent185,\n        hash: \"jrNiKwN_bph3bSCDPhK5EkzUATynRUUxhrDvcMkDNEQ=\",\n      }),],\n\"Cheeky Piggies\": [     buildStickerTemplate({\n        name: \"Crybaby\",\n        cover: stickerCover186,\n        content: stickerContent186,\n        hash: \"bRWBcaZveq6swjn8MwKVISsVnAr2tf4ZHTSTU-eRA5Q=\",\n      }),\n     buildStickerTemplate({\n        name: \"Drool\",\n        cover: stickerCover187,\n        content: stickerContent187,\n        hash: \"BUwkYl7SHNQCypB_SvkggKwAD3XxCRUPV6dorpW_ki0=\",\n      }),\n     buildStickerTemplate({\n        name: \"Fuming\",\n        cover: stickerCover188,\n        content: stickerContent188,\n        hash: \"Iu2DZ5PecYn6Rg7ONIzLqIVZa2v5WYnRKkMv8qTD8a8=\",\n      }),\n     buildStickerTemplate({\n        name: \"Hi~\",\n        cover: stickerCover189,\n        content: stickerContent189,\n        hash: \"h6r0wW-eIhWUF1AkN_EnHv-q8VfpZ4NOQKKTsbU8RPc=\",\n      }),\n     buildStickerTemplate({\n        name: \"Holding Tears\",\n        cover: stickerCover190,\n        content: stickerContent190,\n        hash: \"NnXjSqFfmw_D3Ne13JOx0yXIWtA9Exm6hggPGDgDfgc=\",\n      }),\n     buildStickerTemplate({\n        name: \"Love Blows\",\n        cover: stickerCover191,\n        content: stickerContent191,\n        hash: \"Oggqz68tzBBYevbwcwXqZjb4im48-f3hh94wf8RS-Ok=\",\n      }),\n     buildStickerTemplate({\n        name: \"Me_ Really_\",\n        cover: stickerCover192,\n        content: stickerContent192,\n        hash: \"W8dfy2MD-Fu2VOIPcYfHOuPNBnEIWcFg8TJJeta9iOc=\",\n      }),\n     buildStickerTemplate({\n        name: \"OK\",\n        cover: stickerCover193,\n        content: stickerContent193,\n        hash: \"aTpuWm7bxzUevhFn_xyIz0HO5YD-I4GmdoPvmw590PY=\",\n      }),\n     buildStickerTemplate({\n        name: \"Sassy Flick\",\n        cover: stickerCover194,\n        content: stickerContent194,\n        hash: \"ai5PdJq184Vxlagtbo5fo90RIvT7K0kQtKlhFF0T3h0=\",\n      }),\n     buildStickerTemplate({\n        name: \"Shockwave\",\n        cover: stickerCover195,\n        content: stickerContent195,\n        hash: \"NfiIZ-FHd2XWYF8L7pp8X1M3nGTM3-005VUtCOchld8=\",\n      }),\n     buildStickerTemplate({\n        name: \"Snooze Drool\",\n        cover: stickerCover196,\n        content: stickerContent196,\n        hash: \"HiRDmqZNvnKQDBX05caQF4Fg9PHh4_ZS0n_alWZcQ_M=\",\n      }),\n     buildStickerTemplate({\n        name: \"Swag\",\n        cover: stickerCover197,\n        content: stickerContent197,\n        hash: \"4bEGq5-p-s6HfbtbVNwGEvEg-YEQ8wA8NA7Uj_vxTBE=\",\n      }),\n     buildStickerTemplate({\n        name: \"Sweatdrop\",\n        cover: stickerCover198,\n        content: stickerContent198,\n        hash: \"6axmrPIHx4ahOGB_TtjLOPh4J6HYggLxxx0VGxnMu2E=\",\n      }),\n     buildStickerTemplate({\n        name: \"Thumbs Up\",\n        cover: stickerCover199,\n        content: stickerContent199,\n        hash: \"r97GwoejPTxjumyvS9kdAnB16nZvlM81xsHo0FqdUrM=\",\n      }),\n     buildStickerTemplate({\n        name: \"What_\",\n        cover: stickerCover200,\n        content: stickerContent200,\n        hash: \"JqWfcP9Q0kGE4wDuVZCi4lW2U7O15trpL--fdNrRJvQ=\",\n      }),],\n\"Contorted Stickers\": [     buildStickerTemplate({\n        name: \"AFFiNE\",\n        cover: stickerCover201,\n        content: stickerContent201,\n        hash: \"i3piAMnoD4STQnEjTrAe_ZRdwHcD34n-sJZY8IN1blg=\",\n      }),\n     buildStickerTemplate({\n        name: \"AI\",\n        cover: stickerCover202,\n        content: stickerContent202,\n        hash: \"VZJPB8ZBVtiZ-m04KNtlguY_t9VLx4itHILIQ3l1MRw=\",\n      }),\n     buildStickerTemplate({\n        name: \"Cat\",\n        cover: stickerCover203,\n        content: stickerContent203,\n        hash: \"IS6xbnAo5WXDRxnP98UBkdOP2Zt2luQXEojcLfnfsR4=\",\n      }),\n     buildStickerTemplate({\n        name: \"Closed\",\n        cover: stickerCover204,\n        content: stickerContent204,\n        hash: \"wzrJyCiyflFnyvvHdH2XONsuwbuw119wiFCekvopsmQ=\",\n      }),\n     buildStickerTemplate({\n        name: \"Eyes\",\n        cover: stickerCover205,\n        content: stickerContent205,\n        hash: \"eT4Nbl90OC9ivTjRBmEabaWqjdmITjCgOtTJNSJu1SU=\",\n      }),\n     buildStickerTemplate({\n        name: \"Fire\",\n        cover: stickerCover206,\n        content: stickerContent206,\n        hash: \"cQnt7T9qxI5-It-reeo3E4XVA3HA89L2myi1k2EJfn8=\",\n      }),\n     buildStickerTemplate({\n        name: \"Info\",\n        cover: stickerCover207,\n        content: stickerContent207,\n        hash: \"kwKlgzVYNRk4AyOJs3Xtyt0vMWovo-7BfEqaWndDInM=\",\n      }),\n     buildStickerTemplate({\n        name: \"King\",\n        cover: stickerCover208,\n        content: stickerContent208,\n        hash: \"W-RCNTaadPNEI9OALAGHqv1cGmYD1y7KxIRGLsbr-DM=\",\n      }),\n     buildStickerTemplate({\n        name: \"Love Face\",\n        cover: stickerCover209,\n        content: stickerContent209,\n        hash: \"51B1S9eZ1rgxT-zG5npI_5l1sGss6dTVYiyut5fNPrs=\",\n      }),\n     buildStickerTemplate({\n        name: \"Love\",\n        cover: stickerCover210,\n        content: stickerContent210,\n        hash: \"fK5Bk7hxwSEHuNQ2WfO-ysII_T20z37P1JvLf00ocUQ=\",\n      }),\n     buildStickerTemplate({\n        name: \"Notice\",\n        cover: stickerCover211,\n        content: stickerContent211,\n        hash: \"RS787c3FcijjBEhKrKFa6KwB8ZINUD5MSCEMWL7F53w=\",\n      }),\n     buildStickerTemplate({\n        name: \"Pin\",\n        cover: stickerCover212,\n        content: stickerContent212,\n        hash: \"HDozRCXEtlDfNFFs3sSozkvXUVAP3XXd3zQVI8aW1ak=\",\n      }),\n     buildStickerTemplate({\n        name: \"Question\",\n        cover: stickerCover213,\n        content: stickerContent213,\n        hash: \"bvNeY3Q-At8NxFzcjTYx_mn3YnJkbUhh6XEBp3xB0Uk=\",\n      }),\n     buildStickerTemplate({\n        name: \"Smile Face\",\n        cover: stickerCover214,\n        content: stickerContent214,\n        hash: \"nBVc87wjO0NnM4utzjOLxjUzFjeFcf90C0jkgrpBhrA=\",\n      }),\n     buildStickerTemplate({\n        name: \"Stop\",\n        cover: stickerCover215,\n        content: stickerContent215,\n        hash: \"oH6E3y8ZpdgrMGbtcSX5k3NASEkgayohDCEoO0eU7hE=\",\n      }),],\n\"Paper\": [     buildStickerTemplate({\n        name: \"+1\",\n        cover: stickerCover216,\n        content: stickerContent216,\n        hash: \"FEF1FPZ9H1lIO54e6gP5RlNNZqukz3ADuzPFgog5qH4=\",\n      }),\n     buildStickerTemplate({\n        name: \"A lot of question\",\n        cover: stickerCover217,\n        content: stickerContent217,\n        hash: \"yKPa7vqOxC6rh-e0SVdlp0RwMWQ9mzDKTtE5g2UnHGk=\",\n      }),\n     buildStickerTemplate({\n        name: \"AFFiNE AI\",\n        cover: stickerCover218,\n        content: stickerContent218,\n        hash: \"FwBs2WApEGkiFmu1XR4fHZ_7fOlSsSBdYEyGs2lDeLk=\",\n      }),\n     buildStickerTemplate({\n        name: \"Arrow\",\n        cover: stickerCover219,\n        content: stickerContent219,\n        hash: \"evuSkommPr7PBAWCioYDRQpKPZGoY6izIGev2C8Xdt0=\",\n      }),\n     buildStickerTemplate({\n        name: \"Atention\",\n        cover: stickerCover220,\n        content: stickerContent220,\n        hash: \"Lmvftjmkw5oQEyZ2VP6eTohbXgQyEtNWKkrg9AbDknI=\",\n      }),\n     buildStickerTemplate({\n        name: \"Blue Screen\",\n        cover: stickerCover221,\n        content: stickerContent221,\n        hash: \"30OHymd5x-3zr_5KxQm3DzVfxyWWAf0QnmfHpIOoLzQ=\",\n      }),\n     buildStickerTemplate({\n        name: \"Boom\",\n        cover: stickerCover222,\n        content: stickerContent222,\n        hash: \"mpTlbN8fJWJUMlHcCCrQuzKTK844-F9YuebgR0kgJa8=\",\n      }),\n     buildStickerTemplate({\n        name: \"Cool\",\n        cover: stickerCover223,\n        content: stickerContent223,\n        hash: \"3OujPx_YOY1MTqmgrbWaNDJlJeoLNvTWw96gW22rxps=\",\n      }),\n     buildStickerTemplate({\n        name: \"Dino\",\n        cover: stickerCover224,\n        content: stickerContent224,\n        hash: \"j13ZqHGUnVdGW3_1uWw_sFYeHj1SFoNsi5JwrTvpC-k=\",\n      }),\n     buildStickerTemplate({\n        name: \"Histogram\",\n        cover: stickerCover225,\n        content: stickerContent225,\n        hash: \"A1oGPUmv-Ypb-W7_jPgpSsVGA71J8njyr9f-97UnJQg=\",\n      }),\n     buildStickerTemplate({\n        name: \"Local First\",\n        cover: stickerCover226,\n        content: stickerContent226,\n        hash: \"LFIRZK4TswzJvThRO2Vch_aqfY2UZ6kjAyAEsQS-hHM=\",\n      }),\n     buildStickerTemplate({\n        name: \"Medal\",\n        cover: stickerCover227,\n        content: stickerContent227,\n        hash: \"cMIe6PYQLi0s9ryW3fbiXA9ACs3YsQFDtKjlfliXTC8=\",\n      }),\n     buildStickerTemplate({\n        name: \"Notice\",\n        cover: stickerCover228,\n        content: stickerContent228,\n        hash: \"oafBAmM8MB094GI9I4U2iG6TWoZpCoa4nDmGY2eH_Kw=\",\n      }),\n     buildStickerTemplate({\n        name: \"Pin\",\n        cover: stickerCover229,\n        content: stickerContent229,\n        hash: \"kEy0pTA3dsClFtIwaJJV9NZQvn2xib-biyFJvRp9tzM=\",\n      }),\n     buildStickerTemplate({\n        name: \"Star\",\n        cover: stickerCover230,\n        content: stickerContent230,\n        hash: \"Au-JbxT7XZvvDueaVg37tJ4kyH9vLxiC7tLgcbrZV48=\",\n      }),],\n}\n\nexport const builtInTemplates = {\n  list: async (category: string) => {\n    return templates[category] ?? []\n  },\n\n  categories: async () => {\n    return Object.keys(templates)\n  },\n\n  search: async(query: string) => {\n    const candidates: unknown[] = [];\n    const cates = Object.keys(templates);\n\n    query = query.toLowerCase();\n\n    for(const cate of cates) {\n      const templatesOfCate = templates[cate];\n\n      for(const temp of templatesOfCate) {\n        if(lcs(query, temp.name.toLowerCase()) === query.length) {\n          candidates.push(temp);\n        }\n      }\n    }\n\n    return candidates;\n  },\n}\n","import { builtInTemplates as builtInEdgelessTemplates } from '@affine/templates/edgeless';\nimport { builtInTemplates as builtInStickersTemplates } from '@affine/templates/stickers';\nimport type { TemplateManager } from '@blocksuite/blocks';\nimport { EdgelessTemplatePanel } from '@blocksuite/blocks';\n\nEdgelessTemplatePanel.templates.extend(\n  builtInStickersTemplates as TemplateManager\n);\nEdgelessTemplatePanel.templates.extend(\n  builtInEdgelessTemplates as TemplateManager\n);\n","import '@affine/env/constant';\nimport './edgeless-template';\n\nimport { setupGlobal } from '@affine/env/global';\nimport { ResizeObserver } from '@juggle/resize-observer';\n\nsetupGlobal();\n\nwindow.ResizeObserver = ResizeObserver;\n","import type { ReactNode } from 'react';\n\n// TODO(@Peng): need better way for composing different precondition strategies\nexport enum PreconditionStrategy {\n  Always,\n  InPaperOrEdgeless,\n  InPaper,\n  InEdgeless,\n  InEdgelessPresentationMode,\n  NoSearchResult,\n  Never,\n}\n\nexport type CommandCategory =\n  | 'editor:insert-object'\n  | 'editor:page'\n  | 'editor:edgeless'\n  | 'affine:recent'\n  | 'affine:pages'\n  | 'affine:edgeless'\n  | 'affine:collections'\n  | 'affine:navigation'\n  | 'affine:creation'\n  | 'affine:settings'\n  | 'affine:layout'\n  | 'affine:updates'\n  | 'affine:help'\n  | 'affine:general'\n  | 'affine:results';\n\nexport interface KeybindingOptions {\n  binding: string;\n  capture?: boolean;\n  // some keybindings are already registered in blocksuite\n  // we can skip the registration of these keybindings __FOR NOW__\n  skipRegister?: boolean;\n}\n\nexport interface AffineCommandOptions {\n  id: string;\n  // a set of predefined precondition strategies, but also allow user to customize their own\n  // note: this only controls the visibility of the command, not the availability (e.g., shortcut keybinding still works)\n  preconditionStrategy?: PreconditionStrategy | (() => boolean);\n  // main text on the left..\n  // make text a function so that we can do i18n and interpolation when we need to\n  label:\n    | string\n    | (() => string)\n    | {\n        title: string;\n        subTitle?: string;\n      }\n    | (() => {\n        title: string;\n        subTitle?: string;\n      });\n  icon: ReactNode; // TODO(@JimmFly): need a mapping from string -> React element/SVG\n  category?: CommandCategory;\n  // we use https://github.com/jamiebuilds/tinykeys so that we can use the same keybinding definition\n  // for both mac and windows\n  keyBinding?: KeybindingOptions | string;\n  run: () => void | Promise<void>;\n}\n\nexport interface AffineCommand {\n  readonly id: string;\n  readonly preconditionStrategy: PreconditionStrategy | (() => boolean);\n  readonly label: {\n    title: string;\n    subTitle?: string;\n  };\n  readonly icon?: ReactNode; // icon name\n  readonly category: CommandCategory;\n  readonly keyBinding?: KeybindingOptions;\n  run(): void | Promise<void>;\n}\n\nexport function createAffineCommand(\n  options: AffineCommandOptions\n): AffineCommand {\n  return {\n    id: options.id,\n    run: options.run,\n    icon: options.icon,\n    preconditionStrategy:\n      options.preconditionStrategy ?? PreconditionStrategy.Always,\n    category: options.category ?? 'affine:general',\n    get label() {\n      let label = options.label;\n      label = typeof label === 'function' ? label?.() : label;\n      label =\n        typeof label === 'string'\n          ? {\n              title: label,\n            }\n          : label;\n      return label;\n    },\n    keyBinding:\n      typeof options.keyBinding === 'string'\n        ? { binding: options.keyBinding }\n        : options.keyBinding,\n  };\n}\n","import { DebugLogger } from '@affine/debug';\n// @ts-expect-error upstream type is wrong\nimport { createKeybindingsHandler } from 'tinykeys';\n\nimport type { AffineCommand, AffineCommandOptions } from './command';\nimport { createAffineCommand } from './command';\n\nconst commandLogger = new DebugLogger('command:registry');\n\ninterface KeyBindingMap {\n  [keybinding: string]: (event: KeyboardEvent) => void;\n}\n\nexport interface KeyBindingOptions {\n  /**\n   * Key presses will listen to this event (default: \"keydown\").\n   */\n  event?: 'keydown' | 'keyup';\n\n  /**\n   * Whether to capture the event during the capture phase (default: false).\n   */\n  capture?: boolean;\n\n  /**\n   * Keybinding sequences will wait this long between key presses before\n   * cancelling (default: 1000).\n   *\n   * **Note:** Setting this value too low (i.e. `300`) will be too fast for many\n   * of your users.\n   */\n  timeout?: number;\n}\n\nconst bindKeys = (\n  target: Window | HTMLElement,\n  keyBindingMap: KeyBindingMap,\n  options: KeyBindingOptions = {}\n) => {\n  const event = options.event ?? 'keydown';\n  const onKeyEvent = createKeybindingsHandler(keyBindingMap, options);\n  target.addEventListener(event, onKeyEvent, options.capture);\n  return () => {\n    target.removeEventListener(event, onKeyEvent, options.capture);\n  };\n};\n\nexport const AffineCommandRegistry = new (class {\n  readonly commands: Map<string, AffineCommand> = new Map();\n\n  register(options: AffineCommandOptions) {\n    if (this.commands.has(options.id)) {\n      commandLogger.warn(`Command ${options.id} already registered.`);\n      return () => {};\n    }\n    const command = createAffineCommand(options);\n    this.commands.set(command.id, command);\n\n    let unsubKb: (() => void) | undefined;\n\n    if (\n      command.keyBinding &&\n      !command.keyBinding.skipRegister &&\n      typeof window !== 'undefined'\n    ) {\n      const { binding: keybinding, capture } = command.keyBinding;\n      unsubKb = bindKeys(\n        window,\n        {\n          [keybinding]: (e: Event) => {\n            e.preventDefault();\n            command.run()?.catch(e => {\n              console.error(`Failed to run command [${command.id}]`, e);\n            });\n          },\n        },\n        {\n          capture,\n        }\n      );\n    }\n\n    commandLogger.debug(`Registered command ${command.id}`);\n    return () => {\n      unsubKb?.();\n      this.commands.delete(command.id);\n      commandLogger.debug(`Unregistered command ${command.id}`);\n    };\n  }\n\n  get(id: string): AffineCommand | undefined {\n    if (!this.commands.has(id)) {\n      commandLogger.warn(`Command ${id} not registered.`);\n      return undefined;\n    }\n    return this.commands.get(id);\n  }\n\n  getAll(): AffineCommand[] {\n    return Array.from(this.commands.values());\n  }\n})();\n\nexport function registerAffineCommand(options: AffineCommandOptions) {\n  return AffineCommandRegistry.register(options);\n}\n","import type { useI18n } from '@affine/i18n';\nimport { ImportIcon, PlusIcon } from '@blocksuite/icons/rc';\nimport type { createStore } from 'jotai';\n\nimport { openCreateWorkspaceModalAtom } from '../atoms';\nimport type { usePageHelper } from '../components/blocksuite/block-suite-page-list/utils';\nimport { track } from '../mixpanel';\nimport { registerAffineCommand } from './registry';\n\nexport function registerAffineCreationCommands({\n  store,\n  pageHelper,\n  t,\n}: {\n  t: ReturnType<typeof useI18n>;\n  store: ReturnType<typeof createStore>;\n  pageHelper: ReturnType<typeof usePageHelper>;\n}) {\n  const unsubs: Array<() => void> = [];\n  unsubs.push(\n    registerAffineCommand({\n      id: 'affine:new-page',\n      category: 'affine:creation',\n      label: t['com.affine.cmdk.affine.new-page'](),\n      icon: <PlusIcon />,\n      keyBinding: environment.isDesktop\n        ? {\n            binding: '$mod+N',\n            skipRegister: true,\n          }\n        : undefined,\n      run() {\n        track.$.cmdk.creation.createDoc({ mode: 'page' });\n\n        pageHelper.createPage();\n      },\n    })\n  );\n\n  unsubs.push(\n    registerAffineCommand({\n      id: 'affine:new-edgeless-page',\n      category: 'affine:creation',\n      icon: <PlusIcon />,\n      label: t['com.affine.cmdk.affine.new-edgeless-page'](),\n      run() {\n        track.$.cmdk.creation.createDoc({\n          mode: 'edgeless',\n        });\n\n        pageHelper.createEdgeless();\n      },\n    })\n  );\n\n  unsubs.push(\n    registerAffineCommand({\n      id: 'affine:new-workspace',\n      category: 'affine:creation',\n      icon: <PlusIcon />,\n      label: t['com.affine.cmdk.affine.new-workspace'](),\n      run() {\n        track.$.cmdk.workspace.createWorkspace();\n\n        store.set(openCreateWorkspaceModalAtom, 'new');\n      },\n    })\n  );\n  unsubs.push(\n    registerAffineCommand({\n      id: 'affine:import-workspace',\n      category: 'affine:creation',\n      icon: <ImportIcon />,\n      label: t['com.affine.cmdk.affine.import-workspace'](),\n      preconditionStrategy: () => {\n        return environment.isDesktop;\n      },\n      run() {\n        track.$.cmdk.workspace.createWorkspace({\n          control: 'import',\n        });\n\n        store.set(openCreateWorkspaceModalAtom, 'add');\n      },\n    })\n  );\n\n  return () => {\n    unsubs.forEach(unsub => unsub());\n  };\n}\n","import type { useI18n } from '@affine/i18n';\nimport { ContactWithUsIcon, NewIcon } from '@blocksuite/icons/rc';\nimport type { createStore } from 'jotai';\n\nimport { openSettingModalAtom } from '../atoms';\nimport { track } from '../mixpanel';\nimport { popupWindow } from '../utils';\nimport { registerAffineCommand } from './registry';\n\nexport function registerAffineHelpCommands({\n  t,\n  store,\n}: {\n  t: ReturnType<typeof useI18n>;\n  store: ReturnType<typeof createStore>;\n}) {\n  const unsubs: Array<() => void> = [];\n  unsubs.push(\n    registerAffineCommand({\n      id: 'affine:help-whats-new',\n      category: 'affine:help',\n      icon: <NewIcon />,\n      label: t['com.affine.cmdk.affine.whats-new'](),\n      run() {\n        track.$.cmdk.help.openChangelog();\n        popupWindow(runtimeConfig.changelogUrl);\n      },\n    })\n  );\n  unsubs.push(\n    registerAffineCommand({\n      id: 'affine:help-contact-us',\n      category: 'affine:help',\n      icon: <ContactWithUsIcon />,\n      label: t['com.affine.cmdk.affine.contact-us'](),\n      run() {\n        track.$.cmdk.help.contactUs();\n        store.set(openSettingModalAtom, {\n          open: true,\n          activeTab: 'about',\n          workspaceMetadata: null,\n        });\n      },\n    })\n  );\n\n  return () => {\n    unsubs.forEach(unsub => unsub());\n  };\n}\n","import type { useI18n } from '@affine/i18n';\nimport { SidebarIcon } from '@blocksuite/icons/rc';\nimport type { createStore } from 'jotai';\n\nimport { appSidebarOpenAtom } from '../components/app-sidebar';\nimport { track } from '../mixpanel';\nimport { registerAffineCommand } from './registry';\n\nexport function registerAffineLayoutCommands({\n  t,\n  store,\n}: {\n  t: ReturnType<typeof useI18n>;\n  store: ReturnType<typeof createStore>;\n}) {\n  const unsubs: Array<() => void> = [];\n  unsubs.push(\n    registerAffineCommand({\n      id: 'affine:toggle-left-sidebar',\n      category: 'affine:layout',\n      icon: <SidebarIcon />,\n      label: () =>\n        store.get(appSidebarOpenAtom)\n          ? t['com.affine.cmdk.affine.left-sidebar.collapse']()\n          : t['com.affine.cmdk.affine.left-sidebar.expand'](),\n\n      keyBinding: {\n        binding: '$mod+/',\n      },\n      run() {\n        track.$.navigationPanel.$.toggle();\n\n        store.set(appSidebarOpenAtom, v => !v);\n      },\n    })\n  );\n\n  return () => {\n    unsubs.forEach(unsub => unsub());\n  };\n}\n","import { WorkspaceSubPath } from '@affine/core/shared';\nimport type { useI18n } from '@affine/i18n';\nimport { ArrowRightBigIcon } from '@blocksuite/icons/rc';\nimport type { DocCollection } from '@blocksuite/store';\nimport type { createStore } from 'jotai';\n\nimport { openSettingModalAtom, openWorkspaceListModalAtom } from '../atoms';\nimport type { useNavigateHelper } from '../hooks/use-navigate-helper';\nimport { track } from '../mixpanel';\nimport { registerAffineCommand } from './registry';\n\nexport function registerAffineNavigationCommands({\n  t,\n  store,\n  docCollection,\n  navigationHelper,\n}: {\n  t: ReturnType<typeof useI18n>;\n  store: ReturnType<typeof createStore>;\n  navigationHelper: ReturnType<typeof useNavigateHelper>;\n  docCollection: DocCollection;\n}) {\n  const unsubs: Array<() => void> = [];\n  unsubs.push(\n    registerAffineCommand({\n      id: 'affine:goto-all-pages',\n      category: 'affine:navigation',\n      icon: <ArrowRightBigIcon />,\n      label: t['com.affine.cmdk.affine.navigation.goto-all-pages'](),\n      run() {\n        track.$.cmdk.navigation.navigate({\n          to: 'allDocs',\n        });\n\n        navigationHelper.jumpToSubPath(docCollection.id, WorkspaceSubPath.ALL);\n      },\n    })\n  );\n\n  unsubs.push(\n    registerAffineCommand({\n      id: 'affine:goto-collection-list',\n      category: 'affine:navigation',\n      icon: <ArrowRightBigIcon />,\n      label: 'Go to Collection List',\n      run() {\n        track.$.cmdk.navigation.navigate({\n          to: 'collectionList',\n        });\n\n        navigationHelper.jumpToCollections(docCollection.id);\n      },\n    })\n  );\n\n  unsubs.push(\n    registerAffineCommand({\n      id: 'affine:goto-tag-list',\n      category: 'affine:navigation',\n      icon: <ArrowRightBigIcon />,\n      label: 'Go to Tag List',\n      run() {\n        track.$.cmdk.navigation.navigate({\n          to: 'tagList',\n        });\n\n        navigationHelper.jumpToTags(docCollection.id);\n      },\n    })\n  );\n\n  unsubs.push(\n    registerAffineCommand({\n      id: 'affine:goto-workspace',\n      category: 'affine:navigation',\n      icon: <ArrowRightBigIcon />,\n      label: t['com.affine.cmdk.affine.navigation.goto-workspace'](),\n      run() {\n        track.$.cmdk.navigation.navigate({\n          to: 'workspace',\n        });\n\n        store.set(openWorkspaceListModalAtom, true);\n      },\n    })\n  );\n\n  unsubs.push(\n    registerAffineCommand({\n      id: 'affine:open-settings',\n      category: 'affine:navigation',\n      icon: <ArrowRightBigIcon />,\n      label: t['com.affine.cmdk.affine.navigation.open-settings'](),\n      keyBinding: '$mod+,',\n      run() {\n        track.$.cmdk.settings.openSettings();\n        store.set(openSettingModalAtom, s => ({\n          activeTab: 'appearance',\n          open: !s.open,\n        }));\n      },\n    })\n  );\n\n  unsubs.push(\n    registerAffineCommand({\n      id: 'affine:open-account',\n      category: 'affine:navigation',\n      icon: <ArrowRightBigIcon />,\n      label: t['com.affine.cmdk.affine.navigation.open-account-settings'](),\n      run() {\n        track.$.cmdk.settings.openSettings({ to: 'account' });\n        store.set(openSettingModalAtom, s => ({\n          activeTab: 'account',\n          open: !s.open,\n        }));\n      },\n    })\n  );\n\n  unsubs.push(\n    registerAffineCommand({\n      id: 'affine:goto-trash',\n      category: 'affine:navigation',\n      icon: <ArrowRightBigIcon />,\n      label: t['com.affine.cmdk.affine.navigation.goto-trash'](),\n      run() {\n        track.$.cmdk.navigation.navigate({\n          to: 'trash',\n        });\n\n        navigationHelper.jumpToSubPath(\n          docCollection.id,\n          WorkspaceSubPath.TRASH\n        );\n      },\n    })\n  );\n\n  return () => {\n    unsubs.forEach(unsub => unsub());\n  };\n}\n","import type { useI18n } from '@affine/i18n';\nimport { SettingsIcon } from '@blocksuite/icons/rc';\nimport type { AffineEditorContainer } from '@blocksuite/presets';\nimport { appSettingAtom } from '@toeverything/infra';\nimport type { createStore } from 'jotai';\nimport type { useTheme } from 'next-themes';\n\nimport type { useLanguageHelper } from '../hooks/affine/use-language-helper';\nimport { track } from '../mixpanel';\nimport { registerAffineCommand } from './registry';\n\nexport function registerAffineSettingsCommands({\n  t,\n  store,\n  theme,\n  languageHelper,\n}: {\n  t: ReturnType<typeof useI18n>;\n  store: ReturnType<typeof createStore>;\n  theme: ReturnType<typeof useTheme>;\n  languageHelper: ReturnType<typeof useLanguageHelper>;\n  editor: AffineEditorContainer | null;\n}) {\n  const unsubs: Array<() => void> = [];\n  const { onLanguageChange, languagesList, currentLanguage } = languageHelper;\n\n  // color modes\n  unsubs.push(\n    registerAffineCommand({\n      id: 'affine:change-color-mode-to-auto',\n      label: `${t['com.affine.cmdk.affine.color-mode.to']()} ${t[\n        'com.affine.themeSettings.system'\n      ]()}`,\n      category: 'affine:settings',\n      icon: <SettingsIcon />,\n      preconditionStrategy: () => theme.theme !== 'system',\n      run() {\n        track.$.cmdk.settings.changeAppSetting({\n          key: 'theme',\n          value: 'system',\n        });\n        theme.setTheme('system');\n      },\n    })\n  );\n  unsubs.push(\n    registerAffineCommand({\n      id: 'affine:change-color-mode-to-dark',\n      label: `${t['com.affine.cmdk.affine.color-mode.to']()} ${t[\n        'com.affine.themeSettings.dark'\n      ]()}`,\n      category: 'affine:settings',\n      icon: <SettingsIcon />,\n      preconditionStrategy: () => theme.theme !== 'dark',\n      run() {\n        track.$.cmdk.settings.changeAppSetting({\n          key: 'theme',\n          value: 'dark',\n        });\n        theme.setTheme('dark');\n      },\n    })\n  );\n\n  unsubs.push(\n    registerAffineCommand({\n      id: 'affine:change-color-mode-to-light',\n      label: `${t['com.affine.cmdk.affine.color-mode.to']()} ${t[\n        'com.affine.themeSettings.light'\n      ]()}`,\n      category: 'affine:settings',\n      icon: <SettingsIcon />,\n      preconditionStrategy: () => theme.theme !== 'light',\n      run() {\n        track.$.cmdk.settings.changeAppSetting({\n          key: 'theme',\n          value: 'light',\n        });\n\n        theme.setTheme('light');\n      },\n    })\n  );\n\n  // Font styles\n  unsubs.push(\n    registerAffineCommand({\n      id: 'affine:change-font-style-to-sans',\n      label: `${t['com.affine.cmdk.affine.font-style.to']()} ${t[\n        'com.affine.appearanceSettings.fontStyle.sans'\n      ]()}`,\n      category: 'affine:settings',\n      icon: <SettingsIcon />,\n      preconditionStrategy: () =>\n        store.get(appSettingAtom).fontStyle !== 'Sans',\n      run() {\n        track.$.cmdk.settings.changeAppSetting({\n          key: 'fontStyle',\n          value: 'Sans',\n        });\n\n        store.set(appSettingAtom, prev => ({\n          ...prev,\n          fontStyle: 'Sans',\n        }));\n      },\n    })\n  );\n\n  unsubs.push(\n    registerAffineCommand({\n      id: 'affine:change-font-style-to-serif',\n      label: `${t['com.affine.cmdk.affine.font-style.to']()} ${t[\n        'com.affine.appearanceSettings.fontStyle.serif'\n      ]()}`,\n      category: 'affine:settings',\n      icon: <SettingsIcon />,\n      preconditionStrategy: () =>\n        store.get(appSettingAtom).fontStyle !== 'Serif',\n      run() {\n        track.$.cmdk.settings.changeAppSetting({\n          key: 'fontStyle',\n          value: 'Serif',\n        });\n\n        store.set(appSettingAtom, prev => ({\n          ...prev,\n          fontStyle: 'Serif',\n        }));\n      },\n    })\n  );\n\n  unsubs.push(\n    registerAffineCommand({\n      id: 'affine:change-font-style-to-mono',\n      label: `${t['com.affine.cmdk.affine.font-style.to']()} ${t[\n        'com.affine.appearanceSettings.fontStyle.mono'\n      ]()}`,\n      category: 'affine:settings',\n      icon: <SettingsIcon />,\n      preconditionStrategy: () =>\n        store.get(appSettingAtom).fontStyle !== 'Mono',\n      run() {\n        track.$.cmdk.settings.changeAppSetting({\n          key: 'fontStyle',\n          value: 'Mono',\n        });\n\n        store.set(appSettingAtom, prev => ({\n          ...prev,\n          fontStyle: 'Mono',\n        }));\n      },\n    })\n  );\n\n  // Display Language\n  languagesList.forEach(language => {\n    unsubs.push(\n      registerAffineCommand({\n        id: `affine:change-display-language-to-${language.name}`,\n        label: `${t['com.affine.cmdk.affine.display-language.to']()} ${\n          language.originalName\n        }`,\n        category: 'affine:settings',\n        icon: <SettingsIcon />,\n        preconditionStrategy: () => currentLanguage?.tag !== language.tag,\n        run() {\n          track.$.cmdk.settings.changeAppSetting({\n            key: 'language',\n            value: language.name,\n          });\n\n          onLanguageChange(language.tag);\n        },\n      })\n    );\n  });\n\n  // Layout Style\n  unsubs.push(\n    registerAffineCommand({\n      id: `affine:change-client-border-style`,\n      label: () => `${t['com.affine.cmdk.affine.client-border-style.to']()} ${t[\n        store.get(appSettingAtom).clientBorder\n          ? 'com.affine.cmdk.affine.switch-state.off'\n          : 'com.affine.cmdk.affine.switch-state.on'\n      ]()}\n        `,\n      category: 'affine:settings',\n      icon: <SettingsIcon />,\n      preconditionStrategy: () => environment.isDesktop,\n      run() {\n        track.$.cmdk.settings.changeAppSetting({\n          key: 'clientBorder',\n          value: store.get(appSettingAtom).clientBorder ? 'off' : 'on',\n        });\n        store.set(appSettingAtom, prev => ({\n          ...prev,\n          clientBorder: !prev.clientBorder,\n        }));\n      },\n    })\n  );\n\n  unsubs.push(\n    registerAffineCommand({\n      id: `affine:change-full-width-layout`,\n      label: () =>\n        `${t['com.affine.cmdk.affine.full-width-layout.to']()} ${t[\n          store.get(appSettingAtom).fullWidthLayout\n            ? 'com.affine.cmdk.affine.switch-state.off'\n            : 'com.affine.cmdk.affine.switch-state.on'\n        ]()}`,\n      category: 'affine:settings',\n      icon: <SettingsIcon />,\n      run() {\n        track.$.cmdk.settings.changeAppSetting({\n          key: 'fullWidthLayout',\n          value: store.get(appSettingAtom).fullWidthLayout ? 'off' : 'on',\n        });\n\n        store.set(appSettingAtom, prev => ({\n          ...prev,\n          fullWidthLayout: !prev.fullWidthLayout,\n        }));\n      },\n    })\n  );\n\n  unsubs.push(\n    registerAffineCommand({\n      id: `affine:change-noise-background-on-the-sidebar`,\n      label: () =>\n        `${t[\n          'com.affine.cmdk.affine.noise-background-on-the-sidebar.to'\n        ]()} ${t[\n          store.get(appSettingAtom).enableNoisyBackground\n            ? 'com.affine.cmdk.affine.switch-state.off'\n            : 'com.affine.cmdk.affine.switch-state.on'\n        ]()}`,\n      category: 'affine:settings',\n      icon: <SettingsIcon />,\n      preconditionStrategy: () => environment.isDesktop,\n      run() {\n        track.$.cmdk.settings.changeAppSetting({\n          key: 'enableNoisyBackground',\n          value: store.get(appSettingAtom).enableNoisyBackground ? 'off' : 'on',\n        });\n\n        store.set(appSettingAtom, prev => ({\n          ...prev,\n          enableNoisyBackground: !prev.enableNoisyBackground,\n        }));\n      },\n    })\n  );\n\n  unsubs.push(\n    registerAffineCommand({\n      id: `affine:change-translucent-ui-on-the-sidebar`,\n      label: () =>\n        `${t['com.affine.cmdk.affine.translucent-ui-on-the-sidebar.to']()} ${t[\n          store.get(appSettingAtom).enableBlurBackground\n            ? 'com.affine.cmdk.affine.switch-state.off'\n            : 'com.affine.cmdk.affine.switch-state.on'\n        ]()}`,\n      category: 'affine:settings',\n      icon: <SettingsIcon />,\n      preconditionStrategy: () => environment.isDesktop && environment.isMacOs,\n      run() {\n        track.$.cmdk.settings.changeAppSetting({\n          key: 'enableBlurBackground',\n          value: store.get(appSettingAtom).enableBlurBackground ? 'off' : 'on',\n        });\n        store.set(appSettingAtom, prev => ({\n          ...prev,\n          enableBlurBackground: !prev.enableBlurBackground,\n        }));\n      },\n    })\n  );\n\n  return () => {\n    unsubs.forEach(unsub => unsub());\n  };\n}\n","import { notify } from '@affine/component';\nimport { updateReadyAtom } from '@affine/core/hooks/use-app-updater';\nimport { apis } from '@affine/electron-api';\nimport type { useI18n } from '@affine/i18n';\nimport { ResetIcon } from '@blocksuite/icons/rc';\nimport type { createStore } from 'jotai';\n\nimport { track } from '../mixpanel';\nimport { registerAffineCommand } from './registry';\n\nexport function registerAffineUpdatesCommands({\n  t,\n  store,\n}: {\n  t: ReturnType<typeof useI18n>;\n  store: ReturnType<typeof createStore>;\n}) {\n  const unsubs: Array<() => void> = [];\n\n  unsubs.push(\n    registerAffineCommand({\n      id: 'affine:restart-to-upgrade',\n      category: 'affine:updates',\n      icon: <ResetIcon />,\n      label: t['com.affine.cmdk.affine.restart-to-upgrade'](),\n      preconditionStrategy: () => !!store.get(updateReadyAtom),\n      run() {\n        track.$.cmdk.updates.quitAndInstall();\n\n        apis?.updater.quitAndInstall().catch(err => {\n          notify.error({\n            title: 'Failed to restart to upgrade',\n            message: 'Please restart the app manually to upgrade.',\n          });\n          console.error(err);\n        });\n      },\n    })\n  );\n\n  return () => {\n    unsubs.forEach(unsub => unsub());\n  };\n}\n","import type { FC } from 'react';\n\nexport interface FallbackProps<T = unknown> {\n  error: T;\n  resetError?: () => void;\n}\n\nexport const ERROR_REFLECT_KEY = Symbol('ERROR_REFLECT_KEY');\n\nexport function createErrorFallback<T extends Error>(\n  ErrorConstructor: abstract new (...args: any[]) => T,\n  Component: FC<FallbackProps<T>>\n): FC<FallbackProps<T>> {\n  Reflect.set(Component, ERROR_REFLECT_KEY, ErrorConstructor);\n  return Component;\n}\n","import {\n  GlobalContextService,\n  useLiveData,\n  useServices,\n} from '@toeverything/infra';\nimport { useEffect } from 'react';\nimport { useLocation, useParams } from 'react-router-dom';\n\nexport interface DumpInfoProps {\n  error: any;\n}\n\nexport const DumpInfo = (_props: DumpInfoProps) => {\n  const { globalContextService } = useServices({ GlobalContextService });\n  const location = useLocation();\n  const currentWorkspaceId = useLiveData(\n    globalContextService.globalContext.workspaceId.$\n  );\n  const path = location.pathname;\n  const query = useParams();\n  useEffect(() => {\n    console.info('DumpInfo', {\n      path,\n      query,\n      currentWorkspaceId: currentWorkspaceId,\n    });\n  }, [path, query, currentWorkspaceId]);\n  return null;\n};\n","import { Button } from '@affine/component/ui/button';\nimport { useAsyncCallback } from '@affine/core/hooks/affine-async-hooks';\nimport { Trans, useI18n } from '@affine/i18n';\nimport { useTheme } from 'next-themes';\nimport type { FC, PropsWithChildren, ReactNode } from 'react';\nimport { useState } from 'react';\n\nimport imageUrlFor404 from '../error-assets/404-status.assets.svg';\nimport imageUrlForDark500 from '../error-assets/dark-500-status.assets.svg';\nimport imageUrlForLight500 from '../error-assets/light-500-status.assets.svg';\nimport * as styles from './error-detail.css';\n\nexport enum ErrorStatus {\n  NotFound = 404,\n  Unexpected = 500,\n}\n\nexport interface ErrorDetailProps extends PropsWithChildren {\n  status?: ErrorStatus;\n  direction?: 'column' | 'row';\n  title: string;\n  description: ReactNode | Array<ReactNode>;\n  buttonText?: string;\n  onButtonClick?: () => void | Promise<void>;\n  resetError?: () => void;\n  withoutImage?: boolean;\n}\n\nconst imageMap = new Map([\n  [\n    ErrorStatus.NotFound,\n    {\n      light: imageUrlFor404, // TODO(@catsjuice): Ask designer for dark/light mode image.\n      dark: imageUrlFor404,\n    },\n  ],\n  [\n    ErrorStatus.Unexpected,\n    {\n      light: imageUrlForLight500, // TODO(@catsjuice): Split assets lib and use image hook to handle light and dark.\n      dark: imageUrlForDark500,\n    },\n  ],\n]);\n\n/**\n * TODO(@eyhn): Unify with NotFoundPage.\n */\nexport const ErrorDetail: FC<ErrorDetailProps> = props => {\n  const {\n    status = ErrorStatus.Unexpected,\n    direction = 'row',\n    description,\n    onButtonClick,\n    resetError,\n    withoutImage,\n  } = props;\n  const descriptions = Array.isArray(description) ? description : [description];\n  const [isBtnLoading, setBtnLoading] = useState(false);\n  const t = useI18n();\n  const { resolvedTheme } = useTheme();\n\n  const onBtnClick = useAsyncCallback(async () => {\n    try {\n      setBtnLoading(true);\n      await onButtonClick?.();\n      resetError?.(); // Only reset when retry success.\n    } finally {\n      setBtnLoading(false);\n    }\n  }, [onButtonClick, resetError]);\n\n  return (\n    <div className={styles.errorLayout} style={{ flexDirection: direction }}>\n      <div className={styles.errorDetailStyle}>\n        <h1 className={styles.errorTitle}>{props.title}</h1>\n        {descriptions.map((item, i) => (\n          <p key={i} className={styles.errorDescription}>\n            {item}\n          </p>\n        ))}\n        <div className={styles.errorFooter}>\n          <Button\n            variant=\"primary\"\n            onClick={onBtnClick}\n            loading={isBtnLoading}\n            size=\"extraLarge\"\n          >\n            {props.buttonText ?? t['com.affine.error.retry']()}\n          </Button>\n        </div>\n      </div>\n      {withoutImage ? null : (\n        <div\n          className={styles.errorImage}\n          style={{\n            backgroundImage: `url(${\n              imageMap.get(status)?.[resolvedTheme as 'light' | 'dark']\n            })`,\n          }}\n        />\n      )}\n    </div>\n  );\n};\n\nexport function ContactUS() {\n  return (\n    <Trans>\n      If you are still experiencing this issue, please{' '}\n      <a\n        style={{ color: 'var(--affine-primary-color)' }}\n        href=\"https://community.affine.pro\"\n        target=\"__blank\"\n      >\n        contact us through the community.\n      </a>\n    </Trans>\n  );\n}\n","import \"../core/src/components/affine/affine-error-boundary/error-basic/error-detail.css.ts.vanilla.css!=!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/affine/affine-error-boundary/error-basic/error-detail.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Lnc2aGNqazAgewogIGRpc3BsYXk6IGZsZXg7CiAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBoZWlnaHQ6IDEwMCU7CiAgd2lkdGg6IDEwMCU7CiAgZ2FwOiAyMHB4Owp9Ci53NmhjamsxIHsKICBkaXNwbGF5OiBmbGV4OwogIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgbWF4LXdpZHRoOiA0MjBweDsKfQoudzZoY2prMiB7CiAgZm9udC1zaXplOiAzMnB4OwogIGxpbmUtaGVpZ2h0OiA0NHB4OwogIGZvbnQtd2VpZ2h0OiA3MDA7Cn0KLnc2aGNqazMgewogIGhlaWdodDogMTc4cHg7CiAgbWF4LXdpZHRoOiA0MDBweDsKICBmbGV4LWdyb3c6IDE7CiAgYmFja2dyb3VuZC1zaXplOiBjb3ZlcjsKfQoudzZoY2prNCB7CiAgbWFyZ2luLXRvcDogMjRweDsKfQoudzZoY2prNSB7CiAgbWFyZ2luLXRvcDogMjRweDsKfQoudzZoY2prNiB7CiAgd2lkdGg6IDIwcHg7CiAgaGVpZ2h0OiAxMDAlOwp9\\\"}!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var errorDescription = 'w6hcjk4';\nexport var errorDetailStyle = 'w6hcjk1';\nexport var errorDivider = 'w6hcjk6';\nexport var errorFooter = 'w6hcjk5';\nexport var errorImage = 'w6hcjk3';\nexport var errorLayout = 'w6hcjk0';\nexport var errorTitle = 'w6hcjk2';","import { useI18n } from '@affine/i18n';\nimport type { FC } from 'react';\nimport { useCallback } from 'react';\n\nimport { ErrorDetail } from '../error-basic/error-detail';\nimport type { FallbackProps } from '../error-basic/fallback-creator';\n\n/**\n * TODO(@eyhn): Support reload and retry two reset actions in page error and area error.\n */\nexport const AnyErrorFallback: FC<FallbackProps> = props => {\n  const { error } = props;\n  const t = useI18n();\n\n  const reloadPage = useCallback(() => {\n    document.location.reload();\n  }, []);\n\n  return (\n    <ErrorDetail\n      title={t['com.affine.error.unexpected-error.title']()}\n      resetError={reloadPage}\n      buttonText={t['com.affine.error.reload']()}\n      description={\n        'message' in (error as Error) ? (error as Error).message : `${error}`\n      }\n    />\n  );\n};\n","import { NoPageRootError } from '@affine/core/components/blocksuite/block-suite-editor/no-page-error';\nimport { useI18n } from '@affine/i18n';\n\nimport { ContactUS, ErrorDetail } from '../error-basic/error-detail';\nimport { createErrorFallback } from '../error-basic/fallback-creator';\n\nexport const NoPageRootFallback = createErrorFallback(\n  NoPageRootError,\n  props => {\n    const { resetError } = props;\n    const t = useI18n();\n\n    return (\n      <ErrorDetail\n        title={t['com.affine.error.no-page-root.title']()}\n        description={<ContactUS />}\n        resetError={resetError}\n      />\n    );\n  }\n);\n","import { PageNotFoundError } from '@affine/env/constant';\nimport { useI18n } from '@affine/i18n';\nimport { useCallback } from 'react';\n\nimport {\n  RouteLogic,\n  useNavigateHelper,\n} from '../../../../hooks/use-navigate-helper';\nimport { ErrorDetail, ErrorStatus } from '../error-basic/error-detail';\nimport { createErrorFallback } from '../error-basic/fallback-creator';\n\nexport const PageNotFoundDetail = createErrorFallback(PageNotFoundError, () => {\n  const t = useI18n();\n  const { jumpToIndex } = useNavigateHelper();\n\n  const onBtnClick = useCallback(\n    () => jumpToIndex(RouteLogic.REPLACE),\n    [jumpToIndex]\n  );\n\n  return (\n    <ErrorDetail\n      title={t['com.affine.notFoundPage.title']()}\n      description={t['404.hint']()}\n      buttonText={t['404.back']()}\n      onButtonClick={onBtnClick}\n      status={ErrorStatus.NotFound}\n    />\n  );\n});\n","import { getCurrentStore } from '@toeverything/infra';\nimport { Provider } from 'jotai/react';\nimport type { FC } from 'react';\nimport { useMemo } from 'react';\n\nimport * as styles from './affine-error-fallback.css';\nimport type { FallbackProps } from './error-basic/fallback-creator';\nimport { ERROR_REFLECT_KEY } from './error-basic/fallback-creator';\nimport { DumpInfo } from './error-basic/info-logger';\nimport { AnyErrorFallback } from './error-fallbacks/any-error-fallback';\nimport { NoPageRootFallback } from './error-fallbacks/no-page-root-fallback';\nimport { PageNotFoundDetail } from './error-fallbacks/page-not-found-fallback';\nimport { RecoverableErrorFallback } from './error-fallbacks/recoverable-error-fallback';\n\n/**\n * Register all fallback components here.\n * If have new one just add it to the set.\n */\nconst fallbacks = new Set([\n  PageNotFoundDetail,\n  RecoverableErrorFallback,\n  NoPageRootFallback,\n]);\n\nfunction getErrorFallbackComponent(error: any): FC<FallbackProps> {\n  for (const Component of fallbacks) {\n    const ErrorConstructor = Reflect.get(Component, ERROR_REFLECT_KEY);\n    if (ErrorConstructor && error instanceof ErrorConstructor) {\n      return Component as FC<FallbackProps>;\n    }\n  }\n  return AnyErrorFallback;\n}\n\nexport interface AffineErrorFallbackProps extends FallbackProps {\n  height?: number | string;\n}\n\nexport const AffineErrorFallback: FC<AffineErrorFallbackProps> = props => {\n  const { error, resetError, height } = props;\n  const Component = useMemo(() => getErrorFallbackComponent(error), [error]);\n\n  return (\n    <div className={styles.viewport} style={{ height }}>\n      <Component error={error} resetError={resetError} />\n      <Provider key=\"JotaiProvider\" store={getCurrentStore()}>\n        <DumpInfo error={error} />\n      </Provider>\n    </div>\n  );\n};\n","import { useI18n } from '@affine/i18n';\nimport { useCallback, useMemo, useState } from 'react';\n\nimport { RecoverableError } from '../../../../unexpected-application-state/errors';\nimport { ContactUS, ErrorDetail } from '../error-basic/error-detail';\nimport { createErrorFallback } from '../error-basic/fallback-creator';\n\nexport const RecoverableErrorFallback = createErrorFallback(\n  RecoverableError,\n  props => {\n    const { error, resetError } = props;\n    const t = useI18n();\n    const [count, rerender] = useState(0);\n\n    const canRetry = error.canRetry();\n    const buttonDesc = useMemo(() => {\n      if (canRetry) {\n        return t['com.affine.error.refetch']();\n      }\n      return t['com.affine.error.reload']();\n    }, [canRetry, t]);\n    const onRetry = useCallback(async () => {\n      if (canRetry) {\n        rerender(count + 1);\n        await error.retry();\n      } else {\n        document.location.reload();\n      }\n    }, [error, count, canRetry]);\n\n    return (\n      <ErrorDetail\n        title={t['com.affine.error.unexpected-error.title']()}\n        resetError={resetError}\n        buttonText={buttonDesc}\n        onButtonClick={onRetry}\n        description={[error.message, <ContactUS key=\"contact-us\" />]}\n      />\n    );\n  }\n);\n","export abstract class RecoverableError extends Error {\n  protected ttl = 3;\n\n  canRetry(): boolean {\n    return this.ttl > 0;\n  }\n\n  abstract retry(): void | Promise<void>;\n}\n\n// the first session request failed after login or signup succeed.\n// should give a hint to the user to refetch the session.\nexport class SessionFetchErrorRightAfterLoginOrSignUp extends RecoverableError {\n  constructor(\n    message: string,\n    private readonly onRetry: () => void\n  ) {\n    super(message);\n  }\n\n  retry(): void {\n    if (this.ttl <= 0) {\n      return;\n    }\n    try {\n      this.onRetry();\n    } finally {\n      this.ttl--;\n    }\n  }\n}\n","import \"../core/src/components/affine/affine-error-boundary/affine-error-fallback.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/affine/affine-error-boundary/affine-error-fallback.css.ts.vanilla.css\\\",\\\"source\\\":\\\"LnZ3MDU3eDAgewogIGhlaWdodDogMTAwJTsKICB3aWR0aDogMTAwJTsKfQ==\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var viewport = 'vw057x0';","import { ErrorBoundary, type FallbackRender } from '@sentry/react';\nimport type { FC, PropsWithChildren } from 'react';\nimport { useCallback } from 'react';\n\nimport { AffineErrorFallback } from './affine-error-fallback';\n\nexport { type FallbackProps } from './error-basic/fallback-creator';\n\nexport interface AffineErrorBoundaryProps extends PropsWithChildren {\n  height?: number | string;\n}\n\n/**\n * TODO(@eyhn): Unify with SWRErrorBoundary\n */\nexport const AffineErrorBoundary: FC<AffineErrorBoundaryProps> = props => {\n  const fallbackRender: FallbackRender = useCallback(\n    fallbackProps => {\n      return <AffineErrorFallback {...fallbackProps} height={props.height} />;\n    },\n    [props.height]\n  );\n\n  const onError = useCallback((error: unknown, componentStack?: string) => {\n    console.error('Uncaught error:', error, componentStack);\n  }, []);\n\n  return (\n    <ErrorBoundary fallback={fallbackRender} onError={onError}>\n      {props.children}\n    </ErrorBoundary>\n  );\n};\n","import type { ReactElement } from 'react';\n\nimport { useAppSettingHelper } from '../../hooks/affine/use-app-setting-helper';\nimport { AppSidebarFallback } from '../app-sidebar';\nimport type { WorkspaceRootProps } from '../workspace';\nimport {\n  AppContainer as AppContainerWithoutSettings,\n  MainContainer,\n} from '../workspace';\n\nexport const AppContainer = (props: WorkspaceRootProps) => {\n  const { appSettings } = useAppSettingHelper();\n\n  return (\n    <AppContainerWithoutSettings\n      useNoisyBackground={appSettings.enableNoisyBackground}\n      useBlurBackground={\n        appSettings.enableBlurBackground &&\n        environment.isDesktop &&\n        environment.isMacOs\n      }\n      {...props}\n    />\n  );\n};\n\nexport const AppFallback = (): ReactElement => {\n  return (\n    <AppContainer>\n      <AppSidebarFallback />\n      <MainContainer />\n    </AppContainer>\n  );\n};\n","import { useConfirmModal } from '@affine/component';\nimport { authAtom } from '@affine/core/atoms';\nimport { useI18n } from '@affine/i18n';\nimport { atom, useAtom, useSetAtom } from 'jotai';\nimport { useCallback, useEffect } from 'react';\n\nexport const showAILoginRequiredAtom = atom(false);\n\nexport const AiLoginRequiredModal = () => {\n  const t = useI18n();\n  const [open, setOpen] = useAtom(showAILoginRequiredAtom);\n  const setAuth = useSetAtom(authAtom);\n  const { openConfirmModal, closeConfirmModal } = useConfirmModal();\n\n  const openSignIn = useCallback(() => {\n    setAuth(prev => ({ ...prev, openModal: true }));\n  }, [setAuth]);\n\n  useEffect(() => {\n    if (open) {\n      openConfirmModal({\n        title: t['com.affine.ai.login-required.dialog-title'](),\n        description: t['com.affine.ai.login-required.dialog-content'](),\n        onConfirm: () => {\n          setOpen(false);\n          openSignIn();\n        },\n        confirmText: t['com.affine.ai.login-required.dialog-confirm'](),\n        confirmButtonOptions: {\n          variant: 'primary',\n        },\n        cancelText: t['com.affine.ai.login-required.dialog-cancel'](),\n        onOpenChange: setOpen,\n      });\n    } else {\n      closeConfirmModal();\n    }\n  }, [closeConfirmModal, open, openConfirmModal, openSignIn, setOpen, t]);\n\n  return null;\n};\n","import { apis } from '@affine/electron-api';\nimport { Turnstile } from '@marsidev/react-turnstile';\nimport { atom, useAtom, useSetAtom } from 'jotai';\nimport { useEffect, useRef } from 'react';\nimport useSWR from 'swr';\n\nimport * as style from './style.css';\n\ntype Challenge = {\n  challenge: string;\n  resource: string;\n};\n\nconst challengeFetcher = async (url: string) => {\n  if (!environment.isDesktop) {\n    return undefined;\n  }\n\n  const res = await fetch(url);\n  if (!res.ok) {\n    throw new Error('Failed to fetch challenge');\n  }\n  const challenge = (await res.json()) as Challenge;\n  if (!challenge || !challenge.challenge || !challenge.resource) {\n    throw new Error('Invalid challenge');\n  }\n\n  return challenge;\n};\nconst generateChallengeResponse = async (challenge: string) => {\n  if (!environment.isDesktop) {\n    return undefined;\n  }\n\n  return await apis?.ui?.getChallengeResponse(challenge);\n};\n\nconst captchaAtom = atom<string | undefined>(undefined);\nconst responseAtom = atom<string | undefined>(undefined);\n\nexport const Captcha = () => {\n  const setCaptcha = useSetAtom(captchaAtom);\n  const [response] = useAtom(responseAtom);\n\n  if (!runtimeConfig.enableCaptcha) {\n    return null;\n  }\n\n  if (environment.isDesktop) {\n    if (response) {\n      return <div className={style.captchaWrapper}>Making Challenge</div>;\n    } else {\n      return <div className={style.captchaWrapper}>Verified Client</div>;\n    }\n  }\n\n  return (\n    <Turnstile\n      className={style.captchaWrapper}\n      siteKey={process.env.CAPTCHA_SITE_KEY || '1x00000000000000000000AA'}\n      onSuccess={setCaptcha}\n    />\n  );\n};\n\nexport const useCaptcha = (): [string | undefined, string?] => {\n  const [verifyToken] = useAtom(captchaAtom);\n  const [response, setResponse] = useAtom(responseAtom);\n\n  const { data: challenge } = useSWR('/api/auth/challenge', challengeFetcher, {\n    suspense: false,\n    revalidateOnFocus: false,\n  });\n  const prevChallenge = useRef('');\n\n  useEffect(() => {\n    if (\n      runtimeConfig.enableCaptcha &&\n      environment.isDesktop &&\n      challenge?.challenge &&\n      prevChallenge.current !== challenge.challenge\n    ) {\n      prevChallenge.current = challenge.challenge;\n      generateChallengeResponse(challenge.resource)\n        .then(setResponse)\n        .catch(err => {\n          console.error('Error getting challenge response:', err);\n        });\n    }\n  }, [challenge, setResponse]);\n\n  if (!runtimeConfig.enableCaptcha) {\n    return ['XXXX.DUMMY.TOKEN.XXXX'];\n  }\n\n  if (environment.isDesktop) {\n    if (response) {\n      return [response, challenge?.challenge];\n    } else {\n      return [undefined, challenge?.challenge];\n    }\n  }\n\n  return [verifyToken];\n};\n","import { notify, Wrapper } from '@affine/component';\nimport {\n  AuthContent,\n  AuthInput,\n  BackButton,\n  ModalHeader,\n} from '@affine/component/auth-components';\nimport { Button } from '@affine/component/ui/button';\nimport { useAsyncCallback } from '@affine/core/hooks/affine-async-hooks';\nimport {\n  sendChangeEmailMutation,\n  sendChangePasswordEmailMutation,\n  sendSetPasswordEmailMutation,\n  sendVerifyEmailMutation,\n} from '@affine/graphql';\nimport { useI18n } from '@affine/i18n';\nimport { useLiveData, useService } from '@toeverything/infra';\nimport { useCallback, useState } from 'react';\n\nimport { useMutation } from '../../../hooks/use-mutation';\nimport { ServerConfigService } from '../../../modules/cloud';\nimport type { AuthPanelProps } from './index';\n\nconst useEmailTitle = (emailType: AuthPanelProps['emailType']) => {\n  const t = useI18n();\n\n  switch (emailType) {\n    case 'setPassword':\n      return t['com.affine.auth.set.password']();\n    case 'changePassword':\n      return t['com.affine.auth.reset.password']();\n    case 'changeEmail':\n      return t['com.affine.settings.email.action.change']();\n    case 'verifyEmail':\n      return t['com.affine.settings.email.action.verify']();\n  }\n};\n\nconst useNotificationHint = (emailType: AuthPanelProps['emailType']) => {\n  const t = useI18n();\n\n  switch (emailType) {\n    case 'setPassword':\n      return t['com.affine.auth.sent.set.password.hint']();\n    case 'changePassword':\n      return t['com.affine.auth.sent.change.password.hint']();\n    case 'changeEmail':\n    case 'verifyEmail':\n      return t['com.affine.auth.sent.verify.email.hint']();\n  }\n};\nconst useButtonContent = (emailType: AuthPanelProps['emailType']) => {\n  const t = useI18n();\n\n  switch (emailType) {\n    case 'setPassword':\n      return t['com.affine.auth.send.set.password.link']();\n    case 'changePassword':\n      return t['com.affine.auth.send.reset.password.link']();\n    case 'changeEmail':\n    case 'verifyEmail':\n      return t['com.affine.auth.send.verify.email.hint']();\n  }\n};\n\nconst useSendEmail = (emailType: AuthPanelProps['emailType']) => {\n  const {\n    trigger: sendChangePasswordEmail,\n    isMutating: isChangePasswordMutating,\n  } = useMutation({\n    mutation: sendChangePasswordEmailMutation,\n  });\n  const { trigger: sendSetPasswordEmail, isMutating: isSetPasswordMutating } =\n    useMutation({\n      mutation: sendSetPasswordEmailMutation,\n    });\n  const { trigger: sendChangeEmail, isMutating: isChangeEmailMutating } =\n    useMutation({\n      mutation: sendChangeEmailMutation,\n    });\n  const { trigger: sendVerifyEmail, isMutating: isVerifyEmailMutation } =\n    useMutation({\n      mutation: sendVerifyEmailMutation,\n    });\n\n  return {\n    loading:\n      isChangePasswordMutating ||\n      isSetPasswordMutating ||\n      isChangeEmailMutating ||\n      isVerifyEmailMutation,\n    sendEmail: useCallback(\n      (email: string) => {\n        let trigger: (args: {\n          email: string;\n          callbackUrl: string;\n        }) => Promise<unknown>;\n        let callbackUrl;\n        switch (emailType) {\n          case 'setPassword':\n            trigger = sendSetPasswordEmail;\n            callbackUrl = 'setPassword';\n            break;\n          case 'changePassword':\n            trigger = sendChangePasswordEmail;\n            callbackUrl = 'changePassword';\n            break;\n          case 'changeEmail':\n            trigger = sendChangeEmail;\n            callbackUrl = 'changeEmail';\n            break;\n          case 'verifyEmail':\n            trigger = sendVerifyEmail;\n            callbackUrl = 'verify-email';\n            break;\n        }\n        // TODO(@eyhn): add error handler\n        return trigger({\n          email,\n          callbackUrl: `/auth/${callbackUrl}?isClient=${\n            environment.isDesktop ? 'true' : 'false'\n          }`,\n        });\n      },\n      [\n        emailType,\n        sendChangeEmail,\n        sendChangePasswordEmail,\n        sendSetPasswordEmail,\n        sendVerifyEmail,\n      ]\n    ),\n  };\n};\n\nexport const SendEmail = ({\n  setAuthState,\n  email,\n  emailType,\n}: AuthPanelProps) => {\n  const t = useI18n();\n  const serverConfig = useService(ServerConfigService).serverConfig;\n\n  const passwordLimits = useLiveData(\n    serverConfig.credentialsRequirement$.map(r => r?.password)\n  );\n  const [hasSentEmail, setHasSentEmail] = useState(false);\n\n  const title = useEmailTitle(emailType);\n  const hint = useNotificationHint(emailType);\n  const buttonContent = useButtonContent(emailType);\n  const { loading, sendEmail } = useSendEmail(emailType);\n\n  const onSendEmail = useAsyncCallback(async () => {\n    // TODO(@eyhn): add error handler\n    await sendEmail(email);\n\n    notify.success({ title: hint });\n    setHasSentEmail(true);\n  }, [email, hint, sendEmail]);\n\n  const onBack = useCallback(() => {\n    setAuthState('signIn');\n  }, [setAuthState]);\n\n  if (!passwordLimits) {\n    // TODO(@eyhn): loading & error UI\n    return null;\n  }\n\n  const content =\n    emailType === 'setPassword'\n      ? t['com.affine.auth.set.password.message']({\n          min: String(passwordLimits.minLength),\n          max: String(passwordLimits.maxLength),\n        })\n      : emailType === 'changePassword'\n        ? t['com.affine.auth.reset.password.message']()\n        : emailType === 'changeEmail' || emailType === 'verifyEmail'\n          ? t['com.affine.auth.verify.email.message']({ email })\n          : null;\n\n  return (\n    <>\n      <ModalHeader\n        title={t['com.affine.brand.affineCloud']()}\n        subTitle={title}\n      />\n      <AuthContent>{content}</AuthContent>\n\n      <Wrapper\n        marginTop={30}\n        marginBottom={50}\n        style={{\n          position: 'relative',\n        }}\n      >\n        <AuthInput\n          label={t['com.affine.settings.email']()}\n          disabled={true}\n          value={email}\n        />\n      </Wrapper>\n\n      <Button\n        variant=\"primary\"\n        size=\"extraLarge\"\n        style={{ width: '100%' }}\n        disabled={hasSentEmail}\n        loading={loading}\n        onClick={onSendEmail}\n      >\n        {hasSentEmail ? t['com.affine.auth.sent']() : buttonContent}\n      </Button>\n      <BackButton onClick={onBack} />\n    </>\n  );\n};\n","export const emailRegex =\n  /^(?:(?:[^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@(?:(?:\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|((?:[a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n","import { notify, Skeleton } from '@affine/component';\nimport { Button } from '@affine/component/ui/button';\nimport { useAsyncCallback } from '@affine/core/hooks/affine-async-hooks';\nimport { track } from '@affine/core/mixpanel';\nimport { OAuthProviderType } from '@affine/graphql';\nimport { GithubIcon, GoogleDuotoneIcon } from '@blocksuite/icons/rc';\nimport { useLiveData, useService } from '@toeverything/infra';\nimport type { ReactElement } from 'react';\nimport { useState } from 'react';\n\nimport { AuthService, ServerConfigService } from '../../../modules/cloud';\n\nconst OAuthProviderMap: Record<\n  OAuthProviderType,\n  {\n    icon: ReactElement;\n  }\n> = {\n  [OAuthProviderType.Google]: {\n    icon: <GoogleDuotoneIcon />,\n  },\n\n  [OAuthProviderType.GitHub]: {\n    icon: <GithubIcon />,\n  },\n\n  [OAuthProviderType.OIDC]: {\n    // TODO(@catsjuice): Add OIDC icon\n    icon: <GoogleDuotoneIcon />,\n  },\n};\n\nexport function OAuth({ redirectUri }: { redirectUri?: string | null }) {\n  const serverConfig = useService(ServerConfigService).serverConfig;\n  const oauth = useLiveData(serverConfig.features$.map(r => r?.oauth));\n  const oauthProviders = useLiveData(\n    serverConfig.config$.map(r => r?.oauthProviders)\n  );\n\n  if (!oauth) {\n    return (\n      <>\n        <br />\n        <Skeleton height={50} />\n      </>\n    );\n  }\n\n  return oauthProviders?.map(provider => (\n    <OAuthProvider\n      key={provider}\n      provider={provider}\n      redirectUri={redirectUri}\n    />\n  ));\n}\n\nfunction OAuthProvider({\n  provider,\n  redirectUri,\n}: {\n  provider: OAuthProviderType;\n  redirectUri?: string | null;\n}) {\n  const { icon } = OAuthProviderMap[provider];\n  const authService = useService(AuthService);\n  const [isConnecting, setIsConnecting] = useState(false);\n\n  const onClick = useAsyncCallback(async () => {\n    try {\n      setIsConnecting(true);\n      await authService.signInOauth(provider, redirectUri);\n    } catch (err) {\n      console.error(err);\n      notify.error({ title: 'Failed to sign in, please try again.' });\n    } finally {\n      setIsConnecting(false);\n      track.$.$.auth.oauth({ provider });\n    }\n  }, [authService, provider, redirectUri]);\n\n  return (\n    <Button\n      key={provider}\n      variant=\"primary\"\n      block\n      size=\"extraLarge\"\n      style={{ marginTop: 30, width: '100%' }}\n      prefix={icon}\n      onClick={onClick}\n    >\n      Continue with {provider}\n      {isConnecting && '...'}\n    </Button>\n  );\n}\n","import type { AuthModalProps as AuthModalBaseProps } from '@affine/component/auth-components';\nimport { AuthModal as AuthModalBase } from '@affine/component/auth-components';\nimport type { FC } from 'react';\nimport { useCallback, useMemo } from 'react';\n\nimport { AfterSignInSendEmail } from './after-sign-in-send-email';\nimport { AfterSignUpSendEmail } from './after-sign-up-send-email';\nimport { SendEmail } from './send-email';\nimport { SignIn } from './sign-in';\nimport { SignInWithPassword } from './sign-in-with-password';\n\nexport type AuthProps = {\n  state:\n    | 'signIn'\n    | 'afterSignUpSendEmail'\n    | 'afterSignInSendEmail'\n    // throw away\n    | 'signInWithPassword'\n    | 'sendEmail';\n  setAuthState: (state: AuthProps['state']) => void;\n  setAuthEmail: (state: AuthProps['email']) => void;\n  setEmailType: (state: AuthProps['emailType']) => void;\n  email: string;\n  emailType: 'setPassword' | 'changePassword' | 'changeEmail' | 'verifyEmail';\n  onSignedIn?: () => void;\n};\n\nexport type AuthPanelProps = {\n  email: string;\n  setAuthState: AuthProps['setAuthState'];\n  setAuthEmail: AuthProps['setAuthEmail'];\n  setEmailType: AuthProps['setEmailType'];\n  emailType: AuthProps['emailType'];\n  onSignedIn?: () => void;\n};\n\nconst config: {\n  [k in AuthProps['state']]: FC<AuthPanelProps>;\n} = {\n  signIn: SignIn,\n  afterSignUpSendEmail: AfterSignUpSendEmail,\n  afterSignInSendEmail: AfterSignInSendEmail,\n  signInWithPassword: SignInWithPassword,\n  sendEmail: SendEmail,\n};\n\nexport const AuthModal: FC<AuthModalBaseProps & AuthProps> = ({\n  open,\n  state,\n  setOpen,\n  email,\n  setAuthEmail,\n  setAuthState,\n  setEmailType,\n  emailType,\n}) => {\n  const onSignedIn = useCallback(() => {\n    setAuthState('signIn');\n    setAuthEmail('');\n    setOpen(false);\n  }, [setAuthState, setAuthEmail, setOpen]);\n\n  return (\n    <AuthModalBase open={open} setOpen={setOpen}>\n      <AuthPanel\n        state={state}\n        email={email}\n        setAuthEmail={setAuthEmail}\n        setAuthState={setAuthState}\n        setEmailType={setEmailType}\n        emailType={emailType}\n        onSignedIn={onSignedIn}\n      />\n    </AuthModalBase>\n  );\n};\n\nexport const AuthPanel: FC<AuthProps> = ({\n  state,\n  email,\n  setAuthEmail,\n  setAuthState,\n  setEmailType,\n  emailType,\n  onSignedIn,\n}) => {\n  const CurrentPanel = useMemo(() => {\n    return config[state];\n  }, [state]);\n\n  return (\n    <CurrentPanel\n      email={email}\n      setAuthState={setAuthState}\n      setAuthEmail={setAuthEmail}\n      setEmailType={setEmailType}\n      emailType={emailType}\n      onSignedIn={onSignedIn}\n    />\n  );\n};\n","import { notify } from '@affine/component';\nimport { AuthInput, ModalHeader } from '@affine/component/auth-components';\nimport { Button } from '@affine/component/ui/button';\nimport { authAtom } from '@affine/core/atoms';\nimport { useAsyncCallback } from '@affine/core/hooks/affine-async-hooks';\nimport { track } from '@affine/core/mixpanel';\nimport { Trans, useI18n } from '@affine/i18n';\nimport { ArrowRightBigIcon } from '@blocksuite/icons/rc';\nimport { useLiveData, useService } from '@toeverything/infra';\nimport { cssVar } from '@toeverything/theme';\nimport { useAtomValue } from 'jotai';\nimport type { FC } from 'react';\nimport { useCallback, useEffect, useState } from 'react';\nimport { useSearchParams } from 'react-router-dom';\n\nimport { AuthService } from '../../../modules/cloud';\nimport { emailRegex } from '../../../utils/email-regex';\nimport type { AuthPanelProps } from './index';\nimport { OAuth } from './oauth';\nimport * as style from './style.css';\nimport { Captcha, useCaptcha } from './use-captcha';\n\nfunction validateEmail(email: string) {\n  return emailRegex.test(email);\n}\n\nexport const SignIn: FC<AuthPanelProps> = ({\n  setAuthState,\n  setAuthEmail,\n  email,\n  onSignedIn,\n}) => {\n  const t = useI18n();\n  const authService = useService(AuthService);\n  const [searchParams] = useSearchParams();\n  const [isMutating, setIsMutating] = useState(false);\n  const [verifyToken, challenge] = useCaptcha();\n\n  const [isValidEmail, setIsValidEmail] = useState(true);\n  const { openModal } = useAtomValue(authAtom);\n\n  useEffect(() => {\n    const timeout = setInterval(() => {\n      // revalidate session to get the latest status\n      authService.session.revalidate();\n    }, 3000);\n    return () => {\n      clearInterval(timeout);\n    };\n  }, [authService]);\n  const loginStatus = useLiveData(authService.session.status$);\n  if (loginStatus === 'authenticated' && openModal) {\n    onSignedIn?.();\n  }\n\n  const onContinue = useAsyncCallback(async () => {\n    if (!validateEmail(email)) {\n      setIsValidEmail(false);\n      return;\n    }\n\n    setIsValidEmail(true);\n\n    setIsMutating(true);\n\n    setAuthEmail(email);\n    try {\n      const { hasPassword, isExist: isUserExist } =\n        await authService.checkUserByEmail(email);\n\n      if (verifyToken) {\n        if (isUserExist) {\n          // provider password sign-in if user has by default\n          //  If with payment, onl support email sign in to avoid redirect to affine app\n          if (hasPassword) {\n            setAuthState('signInWithPassword');\n          } else {\n            track.$.$.auth.signIn();\n            await authService.sendEmailMagicLink(\n              email,\n              verifyToken,\n              challenge,\n              searchParams.get('redirect_uri')\n            );\n            setAuthState('afterSignInSendEmail');\n          }\n        } else {\n          await authService.sendEmailMagicLink(\n            email,\n            verifyToken,\n            challenge,\n            searchParams.get('redirect_uri')\n          );\n          track.$.$.auth.signUp();\n          setAuthState('afterSignUpSendEmail');\n        }\n      }\n    } catch (err) {\n      console.error(err);\n\n      // TODO(@eyhn): better error handling\n      notify.error({\n        title: 'Failed to send email. Please try again.',\n      });\n    }\n\n    setIsMutating(false);\n  }, [\n    authService,\n    challenge,\n    email,\n    searchParams,\n    setAuthEmail,\n    setAuthState,\n    verifyToken,\n  ]);\n\n  return (\n    <>\n      <ModalHeader\n        title={t['com.affine.auth.sign.in']()}\n        subTitle={t['com.affine.brand.affineCloud']()}\n      />\n\n      <OAuth redirectUri={searchParams.get('redirect_uri')} />\n\n      <div className={style.authModalContent}>\n        <AuthInput\n          label={t['com.affine.settings.email']()}\n          placeholder={t['com.affine.auth.sign.email.placeholder']()}\n          value={email}\n          onChange={useCallback(\n            (value: string) => {\n              setAuthEmail(value);\n            },\n            [setAuthEmail]\n          )}\n          error={!isValidEmail}\n          errorHint={\n            isValidEmail ? '' : t['com.affine.auth.sign.email.error']()\n          }\n          onEnter={onContinue}\n        />\n\n        {verifyToken ? null : <Captcha />}\n\n        {verifyToken ? (\n          <Button\n            style={{ width: '100%' }}\n            size=\"extraLarge\"\n            data-testid=\"continue-login-button\"\n            block\n            loading={isMutating}\n            suffix={<ArrowRightBigIcon />}\n            suffixStyle={{ width: 20, height: 20, color: cssVar('blue') }}\n            onClick={onContinue}\n          >\n            {t['com.affine.auth.sign.email.continue']()}\n          </Button>\n        ) : null}\n\n        <div className={style.authMessage}>\n          {/*prettier-ignore*/}\n          <Trans i18nKey=\"com.affine.auth.sign.message\">\n              By clicking &quot;Continue with Google/Email&quot; above, you acknowledge that\n              you agree to AFFiNE&apos;s <a href=\"https://affine.pro/terms\" target=\"_blank\" rel=\"noreferrer\">Terms of Conditions</a> and <a href=\"https://affine.pro/privacy\" target=\"_blank\" rel=\"noreferrer\">Privacy Policy</a>.\n          </Trans>\n        </div>\n      </div>\n    </>\n  );\n};\n","import { notify } from '@affine/component';\nimport {\n  AuthContent,\n  BackButton,\n  CountDownRender,\n  ModalHeader,\n} from '@affine/component/auth-components';\nimport { Button } from '@affine/component/ui/button';\nimport { useAsyncCallback } from '@affine/core/hooks/affine-async-hooks';\nimport { Trans, useI18n } from '@affine/i18n';\nimport { useLiveData, useService } from '@toeverything/infra';\nimport type { FC } from 'react';\nimport { useCallback, useEffect, useState } from 'react';\n\nimport { AuthService } from '../../../modules/cloud';\nimport type { AuthPanelProps } from './index';\nimport * as style from './style.css';\nimport { Captcha, useCaptcha } from './use-captcha';\n\nexport const AfterSignUpSendEmail: FC<AuthPanelProps> = ({\n  setAuthState,\n  email,\n  onSignedIn,\n}) => {\n  const [resendCountDown, setResendCountDown] = useState(60);\n\n  useEffect(() => {\n    const timer = setInterval(() => {\n      setResendCountDown(c => Math.max(c - 1, 0));\n    }, 1000);\n\n    return () => {\n      clearInterval(timer);\n    };\n  }, []);\n\n  const [isSending, setIsSending] = useState(false);\n  const t = useI18n();\n  const authService = useService(AuthService);\n  const loginStatus = useLiveData(authService.session.status$);\n  useEffect(() => {\n    const timeout = setInterval(() => {\n      // revalidate session to get the latest status\n      authService.session.revalidate();\n    }, 3000);\n    return () => {\n      clearInterval(timeout);\n    };\n  }, [authService]);\n  if (loginStatus === 'authenticated') {\n    onSignedIn?.();\n  }\n\n  const [verifyToken, challenge] = useCaptcha();\n\n  const onResendClick = useAsyncCallback(async () => {\n    setIsSending(true);\n    try {\n      if (verifyToken) {\n        await authService.sendEmailMagicLink(email, verifyToken, challenge);\n      }\n      setResendCountDown(60);\n    } catch (err) {\n      console.error(err);\n      notify.error({\n        title: 'Failed to send email, please try again.',\n      });\n    }\n    setIsSending(false);\n  }, [authService, challenge, email, verifyToken]);\n\n  return (\n    <>\n      <ModalHeader\n        title={t['com.affine.auth.sign.up']()}\n        subTitle={t['com.affine.auth.sign.up.sent.email.subtitle']()}\n      />\n      <AuthContent style={{ height: 100 }}>\n        <Trans\n          i18nKey=\"com.affine.auth.sign.sent.email.message.sent-tips\"\n          values={{ email }}\n          components={{ a: <a href={`mailto:${email}`} /> }}\n        />\n        {t['com.affine.auth.sign.sent.email.message.sent-tips.sign-up']()}\n      </AuthContent>\n\n      <div className={style.resendWrapper}>\n        {resendCountDown <= 0 ? (\n          <>\n            <Captcha />\n            <Button\n              style={!verifyToken ? { cursor: 'not-allowed' } : {}}\n              disabled={!verifyToken || isSending}\n              variant=\"plain\"\n              size=\"large\"\n              onClick={onResendClick}\n            >\n              {t['com.affine.auth.sign.auth.code.resend.hint']()}\n            </Button>\n          </>\n        ) : (\n          <div className={style.sentRow}>\n            <div className={style.sentMessage}>\n              {t['com.affine.auth.sent']()}\n            </div>\n            <CountDownRender\n              className={style.resendCountdown}\n              timeLeft={resendCountDown}\n            />\n          </div>\n        )}\n      </div>\n\n      <div className={style.authMessage} style={{ marginTop: 20 }}>\n        {t['com.affine.auth.sign.auth.code.message']()}\n      </div>\n\n      <BackButton\n        onClick={useCallback(() => {\n          setAuthState('signIn');\n        }, [setAuthState])}\n      />\n    </>\n  );\n};\n","import { notify } from '@affine/component';\nimport {\n  AuthContent,\n  BackButton,\n  CountDownRender,\n  ModalHeader,\n} from '@affine/component/auth-components';\nimport { Button } from '@affine/component/ui/button';\nimport { useAsyncCallback } from '@affine/core/hooks/affine-async-hooks';\nimport { AuthService } from '@affine/core/modules/cloud';\nimport { Trans, useI18n } from '@affine/i18n';\nimport { useLiveData, useService } from '@toeverything/infra';\nimport { useCallback, useEffect, useState } from 'react';\n\nimport type { AuthPanelProps } from './index';\nimport * as style from './style.css';\nimport { Captcha, useCaptcha } from './use-captcha';\n\nexport const AfterSignInSendEmail = ({\n  setAuthState,\n  email,\n  onSignedIn,\n}: AuthPanelProps) => {\n  const [resendCountDown, setResendCountDown] = useState(60);\n\n  useEffect(() => {\n    const timer = setInterval(() => {\n      setResendCountDown(c => Math.max(c - 1, 0));\n    }, 1000);\n\n    return () => {\n      clearInterval(timer);\n    };\n  }, []);\n\n  const [isSending, setIsSending] = useState(false);\n\n  const t = useI18n();\n  const authService = useService(AuthService);\n  useEffect(() => {\n    const timer = setInterval(() => {\n      authService.session.revalidate();\n    }, 3000);\n\n    return () => {\n      clearInterval(timer);\n    };\n  }, [authService]);\n  const loginStatus = useLiveData(authService.session.status$);\n  const [verifyToken, challenge] = useCaptcha();\n\n  if (loginStatus === 'authenticated') {\n    onSignedIn?.();\n  }\n\n  const onResendClick = useAsyncCallback(async () => {\n    setIsSending(true);\n    try {\n      if (verifyToken) {\n        setResendCountDown(60);\n        await authService.sendEmailMagicLink(email, verifyToken, challenge);\n      }\n    } catch (err) {\n      console.error(err);\n      notify.error({\n        title: 'Failed to send email, please try again.',\n      });\n    }\n    setIsSending(false);\n  }, [authService, challenge, email, verifyToken]);\n\n  const onSignInWithPasswordClick = useCallback(() => {\n    setAuthState('signInWithPassword');\n  }, [setAuthState]);\n\n  const onBackBottomClick = useCallback(() => {\n    setAuthState('signIn');\n  }, [setAuthState]);\n\n  return (\n    <>\n      <ModalHeader\n        title={t['com.affine.auth.sign.in']()}\n        subTitle={t['com.affine.auth.sign.in.sent.email.subtitle']()}\n      />\n      <AuthContent style={{ height: 100 }}>\n        <Trans\n          i18nKey=\"com.affine.auth.sign.sent.email.message.sent-tips\"\n          values={{ email }}\n          components={{ a: <a href={`mailto:${email}`} /> }}\n        />\n        {t['com.affine.auth.sign.sent.email.message.sent-tips.sign-in']()}\n      </AuthContent>\n\n      <div className={style.resendWrapper}>\n        {resendCountDown <= 0 ? (\n          <>\n            <Captcha />\n            <Button\n              style={!verifyToken ? { cursor: 'not-allowed' } : {}}\n              disabled={!verifyToken || isSending}\n              variant=\"plain\"\n              size=\"large\"\n              onClick={onResendClick}\n            >\n              {t['com.affine.auth.sign.auth.code.resend.hint']()}\n            </Button>\n          </>\n        ) : (\n          <div className={style.sentRow}>\n            <div className={style.sentMessage}>\n              {t['com.affine.auth.sent']()}\n            </div>\n            <CountDownRender\n              className={style.resendCountdown}\n              timeLeft={resendCountDown}\n            />\n          </div>\n        )}\n      </div>\n\n      <div className={style.authMessage} style={{ marginTop: 20 }}>\n        {t['com.affine.auth.sign.auth.code.message']()}\n        &nbsp;\n        <Trans\n          i18nKey=\"com.affine.auth.sign.auth.code.message.password\"\n          components={{\n            1: (\n              <span\n                className=\"link\"\n                data-testid=\"sign-in-with-password\"\n                onClick={onSignInWithPasswordClick}\n              />\n            ),\n          }}\n        />\n      </div>\n\n      <BackButton onClick={onBackBottomClick} />\n    </>\n  );\n};\n","import { notify, Wrapper } from '@affine/component';\nimport {\n  AuthInput,\n  BackButton,\n  ModalHeader,\n} from '@affine/component/auth-components';\nimport { Button } from '@affine/component/ui/button';\nimport { useAsyncCallback } from '@affine/core/hooks/affine-async-hooks';\nimport { AuthService } from '@affine/core/modules/cloud';\nimport { useI18n } from '@affine/i18n';\nimport { useService } from '@toeverything/infra';\nimport type { FC } from 'react';\nimport { useCallback, useState } from 'react';\n\nimport type { AuthPanelProps } from './index';\nimport * as styles from './style.css';\nimport { useCaptcha } from './use-captcha';\n\nexport const SignInWithPassword: FC<AuthPanelProps> = ({\n  setAuthState,\n  setEmailType,\n  email,\n  onSignedIn,\n}) => {\n  const t = useI18n();\n  const authService = useService(AuthService);\n\n  const [password, setPassword] = useState('');\n  const [passwordError, setPasswordError] = useState(false);\n  const [verifyToken, challenge] = useCaptcha();\n  const [isLoading, setIsLoading] = useState(false);\n  const [sendingEmail, setSendingEmail] = useState(false);\n\n  const onSignIn = useAsyncCallback(async () => {\n    if (isLoading) return;\n    setIsLoading(true);\n\n    try {\n      await authService.signInPassword({\n        email,\n        password,\n      });\n      onSignedIn?.();\n    } catch (err) {\n      console.error(err);\n      setPasswordError(true);\n    } finally {\n      setIsLoading(false);\n    }\n  }, [isLoading, authService, email, password, onSignedIn]);\n\n  const sendMagicLink = useAsyncCallback(async () => {\n    if (sendingEmail) return;\n    setSendingEmail(true);\n    try {\n      if (verifyToken) {\n        await authService.sendEmailMagicLink(email, verifyToken, challenge);\n        setAuthState('afterSignInSendEmail');\n      }\n    } catch (err) {\n      console.error(err);\n      notify.error({\n        title: 'Failed to send email, please try again.',\n      });\n      // TODO(@eyhn): handle error better\n    }\n    setSendingEmail(false);\n  }, [sendingEmail, verifyToken, authService, email, challenge, setAuthState]);\n\n  const sendChangePasswordEmail = useCallback(() => {\n    setEmailType('changePassword');\n    setAuthState('sendEmail');\n  }, [setAuthState, setEmailType]);\n\n  return (\n    <>\n      <ModalHeader\n        title={t['com.affine.auth.sign.in']()}\n        subTitle={t['com.affine.brand.affineCloud']()}\n      />\n\n      <Wrapper\n        marginTop={30}\n        style={{\n          position: 'relative',\n        }}\n      >\n        <AuthInput\n          label={t['com.affine.settings.email']()}\n          disabled={true}\n          value={email}\n        />\n        <AuthInput\n          autoFocus\n          data-testid=\"password-input\"\n          label={t['com.affine.auth.password']()}\n          value={password}\n          type=\"password\"\n          onChange={useCallback((value: string) => {\n            setPassword(value);\n          }, [])}\n          error={passwordError}\n          errorHint={t['com.affine.auth.password.error']()}\n          onEnter={onSignIn}\n        />\n        <div\n          className={styles.forgetPasswordButtonRow}\n          style={{ display: 'none' }} // Not implemented yet.\n        >\n          <a\n            className={styles.linkButton}\n            onClick={sendChangePasswordEmail}\n            style={{\n              color: 'var(--affine-text-secondary-color)',\n              fontSize: 'var(--affine-font-sm)',\n            }}\n          >\n            {t['com.affine.auth.forget']()}\n          </a>\n        </div>\n        <div className={styles.sendMagicLinkButtonRow}>\n          <a\n            data-testid=\"send-magic-link-button\"\n            className={styles.linkButton}\n            onClick={sendMagicLink}\n          >\n            {t['com.affine.auth.sign.auth.code.send-email.sign-in']()}\n          </a>\n        </div>\n        <Button\n          data-testid=\"sign-in-button\"\n          variant=\"primary\"\n          size=\"extraLarge\"\n          style={{ width: '100%' }}\n          disabled={isLoading}\n          onClick={onSignIn}\n        >\n          {t['com.affine.auth.sign.in']()}\n        </Button>\n      </Wrapper>\n      <BackButton\n        onClick={useCallback(() => {\n          setAuthState('signIn');\n        }, [setAuthState])}\n      />\n    </>\n  );\n};\n","import { Tooltip } from '@affine/component/ui/tooltip';\nimport { useCatchEventCallback } from '@affine/core/hooks/use-catch-event-hook';\nimport { SubscriptionPlan } from '@affine/graphql';\nimport { useI18n } from '@affine/i18n';\nimport { useLiveData, useServices } from '@toeverything/infra';\nimport { useSetAtom } from 'jotai';\nimport { useEffect } from 'react';\n\nimport { openSettingModalAtom } from '../../../atoms';\nimport {\n  ServerConfigService,\n  SubscriptionService,\n} from '../../../modules/cloud';\nimport * as styles from './style.css';\n\nexport const UserPlanButton = () => {\n  const { serverConfigService, subscriptionService } = useServices({\n    ServerConfigService,\n    SubscriptionService,\n  });\n\n  const hasPayment = useLiveData(\n    serverConfigService.serverConfig.features$.map(r => r?.payment)\n  );\n  const plan = useLiveData(\n    subscriptionService.subscription.pro$.map(subscription =>\n      subscription !== null ? subscription?.plan : null\n    )\n  );\n  const isBeliever = useLiveData(subscriptionService.subscription.isBeliever$);\n  const isLoading = plan === null;\n\n  useEffect(() => {\n    // revalidate subscription to get the latest status\n    subscriptionService.subscription.revalidate();\n  }, [subscriptionService]);\n\n  const setSettingModalAtom = useSetAtom(openSettingModalAtom);\n  const handleClick = useCatchEventCallback(() => {\n    setSettingModalAtom({\n      open: true,\n      activeTab: 'plans',\n      scrollAnchor: 'cloudPricingPlan',\n    });\n  }, [setSettingModalAtom]);\n\n  const t = useI18n();\n\n  if (!hasPayment) {\n    // no payment feature\n    return;\n  }\n\n  if (isLoading) {\n    // loading, do nothing\n    return;\n  }\n\n  const planLabel = isBeliever ? 'Believer' : (plan ?? SubscriptionPlan.Free);\n\n  return (\n    <Tooltip content={t['com.affine.payment.tag-tooltips']()} side=\"top\">\n      <div\n        data-is-believer={isBeliever ? 'true' : undefined}\n        className={styles.userPlanButton}\n        onClick={handleClick}\n        data-event-props=\"$.settingsPanel.profileAndBadge.viewPlans\"\n      >\n        {planLabel}\n      </div>\n    </Tooltip>\n  );\n};\n","import { ConfirmModal } from '@affine/component';\nimport { WorkspacePropertiesAdapter } from '@affine/core/modules/properties';\nimport type { PageInfoCustomPropertyMeta } from '@affine/core/modules/properties/services/schema';\nimport { Trans, useI18n } from '@affine/i18n';\nimport { useService } from '@toeverything/infra';\nimport { useMemo } from 'react';\n\nimport { PagePropertiesMetaManager } from './page-properties-manager';\n\nexport const ConfirmDeletePropertyModal = ({\n  onConfirm,\n  onCancel,\n  property,\n  show,\n}: {\n  property: PageInfoCustomPropertyMeta;\n  show: boolean;\n  onConfirm: () => void;\n  onCancel: () => void;\n}) => {\n  const t = useI18n();\n  const adapter = useService(WorkspacePropertiesAdapter);\n  const count = useMemo(() => {\n    const manager = new PagePropertiesMetaManager(adapter);\n    return manager.getPropertyRelatedPages(property.id)?.size || 0;\n  }, [adapter, property.id]);\n\n  return (\n    <ConfirmModal\n      open={show}\n      closeButtonOptions={{\n        onClick: onCancel,\n      }}\n      title={t['com.affine.settings.workspace.properties.delete-property']()}\n      description={\n        <Trans\n          values={{\n            name: property.name,\n            count,\n          }}\n          i18nKey=\"com.affine.settings.workspace.properties.delete-property-prompt\"\n        >\n          The <strong>{{ name: property.name } as any}</strong> property will be\n          removed from count doc(s). This action cannot be undone.\n        </Trans>\n      }\n      confirmText={t['Confirm']()}\n      onConfirm={onConfirm}\n      cancelButtonOptions={{\n        onClick: onCancel,\n      }}\n      confirmButtonOptions={{\n        variant: 'error',\n      }}\n    />\n  );\n};\n","import { PagePropertyType } from '@affine/core/modules/properties/services/schema';\nimport * as icons from '@blocksuite/icons/rc';\nimport type { SVGProps } from 'react';\n\ntype IconType = (props: SVGProps<SVGSVGElement>) => JSX.Element;\n\n// assume all exports in icons are icon Components\ntype LibIconComponentName = keyof typeof icons;\n\ntype fromLibIconName<T extends string> = T extends `${infer N}Icon`\n  ? Uncapitalize<N>\n  : never;\n\nexport const iconNames = [\n  'ai',\n  'email',\n  'text',\n  'dateTime',\n  'keyboard',\n  'pen',\n  'account',\n  'embedWeb',\n  'layer',\n  'pin',\n  'appearance',\n  'eraser',\n  'layout',\n  'presentation',\n  'bookmark',\n  'exportToHtml',\n  'lightMode',\n  'progress',\n  'bulletedList',\n  'exportToMarkdown',\n  'link',\n  'publish',\n  'camera',\n  'exportToPdf',\n  'linkedEdgeless',\n  'quote',\n  'checkBoxCheckLinear',\n  'exportToPng',\n  'linkedPage',\n  'save',\n  'cloudWorkspace',\n  'exportToSvg',\n  'localData',\n  'shape',\n  'code',\n  'favorite',\n  'localWorkspace',\n  'style',\n  'codeBlock',\n  'file',\n  'lock',\n  'tag',\n  'collaboration',\n  'folder',\n  'multiSelect',\n  'tags',\n  'colorPicker',\n  'frame',\n  'new',\n  'today',\n  'contactWithUs',\n  'grid',\n  'now',\n  'upgrade',\n  'darkMode',\n  'grouping',\n  'number',\n  'userGuide',\n  'databaseKanbanView',\n  'image',\n  'numberedList',\n  'view',\n  'databaseListView',\n  'inbox',\n  'other',\n  'viewLayers',\n  'databaseTableView',\n  'info',\n  'page',\n  'attachment',\n  'delete',\n  'issue',\n  'paste',\n  'heartbreak',\n  'edgeless',\n  'journal',\n  'payment',\n] as const satisfies fromLibIconName<LibIconComponentName>[];\n\nexport type PagePropertyIcon = (typeof iconNames)[number];\n\nexport const getDefaultIconName = (\n  type: PagePropertyType\n): PagePropertyIcon => {\n  switch (type) {\n    case 'text':\n      return 'text';\n    case 'tags':\n      return 'tag';\n    case 'date':\n      return 'dateTime';\n    case 'progress':\n      return 'progress';\n    case 'checkbox':\n      return 'checkBoxCheckLinear';\n    case 'number':\n      return 'number';\n    default:\n      return 'text';\n  }\n};\n\nexport const getSafeIconName = (\n  iconName: string,\n  type?: PagePropertyType\n): PagePropertyIcon => {\n  return iconNames.includes(iconName as any)\n    ? (iconName as PagePropertyIcon)\n    : getDefaultIconName(type || PagePropertyType.Text);\n};\n\nconst nameToComponentName = (\n  iconName: PagePropertyIcon\n): LibIconComponentName => {\n  const capitalize = (s: string) => s.charAt(0).toUpperCase() + s.slice(1);\n  return `${capitalize(iconName)}Icon` as LibIconComponentName;\n};\n\nexport const nameToIcon = (\n  iconName: string,\n  type?: PagePropertyType\n): IconType => {\n  const Icon = icons[nameToComponentName(getSafeIconName(iconName, type))];\n  if (!Icon) {\n    throw new Error(`Icon ${iconName} not found`);\n  }\n  return Icon;\n};\n","import { createContext } from 'react';\n\nimport type { PagePropertiesManager } from './page-properties-manager';\n\n// @ts-expect-error this should always be set\nexport const managerContext = createContext<PagePropertiesManager>();\n","import \"../core/src/components/affine/page-properties/tags-inline-editor.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/affine/page-properties/tags-inline-editor.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACp1V246bMBB9z1fMS6VNt44gt+462i+pVpVjD+AWbMs2CWnVf68wEJOQrJo+EOLx+MyZM+Nh8X3ziutlknwTzDOClfGnN29rfIffMwCuS20pHJh9IoRlmVRITMk4FroUaEnYn+9mf2aLHigN54R0pmQnClmJzW4G4U2EtMi91Iq2wHWl2p2jFL6gkCbJp3aZM0MhXZpmDLq8DRp8tyYGONrW0v5OkCPYKoAZJoRUOYWkdfWWKZdpW9Hub8k8PpHVYmOaL8BZyfsFPPdaWCZkQ4w2Bi1hihfakgJlXvg5fAaSzucjBgHg/rngNYdnSLemCef0AW1W6iOFQgqBakx//YEW67tanNNNE9P0+gLsGf+ZW10rQW5Vumh5nGsMUEnVJ0lhfVWiTaAVIue2ZZ5OwwapK2ZzqSiQaNprK9BSUFphSL/2pVQYDZlWnjj5CymkQ46tKWOVLE8UpCrQSr+LHTuyTJMMJTbMovIXKVA66u3/7P/to/0fCvfSJRWbsrUMT6daE6VPks4Y24TVXo9ZfL3N4kftvMxOhGvlUXkKzjCOZI/+iBjYsFLmikiPlaPAUXm0U2JXJblQJ9gbNz/7HHvWmyTZ3VHUY+OJQ66VYPZ0Q9SXkM6QLmnivQAw2slOU4sl8/KA13otB72i1BH69d/qZfXxIXmG2Kv1dWgAXlvXamC0HAC6GxCmQ+36ezzi2A3nTPPaoRiN54fub8RjnZyGcelPYQKOYtFwCu74phc4HS/nmcc3bVC9f+C8vzEg4i4Pu/28XCaXIg7rSZXulGPS5sNWjCfG8dLtZbxhfVWVTfiO/AWYK54pMgcAAA==\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var inlineTagsContainer = '_59e4202';\nexport var searchInput = '_59e4205';\nexport var spacer = '_59e420b';\nexport var tagColorIcon = '_59e420d';\nexport var tagColorIconWrapper = '_59e420c';\nexport var tagEditIcon = '_59e420a';\nexport var tagSelectorItem = '_59e4209';\nexport var tagSelectorTagsScrollContainer = '_59e4208';\nexport var tagsEditorRoot = '_59e4201';\nexport var tagsEditorSelectedTags = '_59e4204';\nexport var tagsEditorTagsSelector = '_59e4206';\nexport var tagsEditorTagsSelectorHeader = '_59e4207';\nexport var tagsInlineEditor = '_59e4200';\nexport var tagsMenu = '_59e4203';","import type { MenuProps } from '@affine/component';\nimport { IconButton, Input, Menu, Scrollable } from '@affine/component';\nimport { useNavigateHelper } from '@affine/core/hooks/use-navigate-helper';\nimport { WorkspaceLegacyProperties } from '@affine/core/modules/properties';\nimport type { Tag } from '@affine/core/modules/tag';\nimport { DeleteTagConfirmModal, TagService } from '@affine/core/modules/tag';\nimport { useI18n } from '@affine/i18n';\nimport { DeleteIcon, MoreHorizontalIcon, TagsIcon } from '@blocksuite/icons/rc';\nimport { useLiveData, useService } from '@toeverything/infra';\nimport clsx from 'clsx';\nimport { clamp } from 'lodash-es';\nimport type { HTMLAttributes, PropsWithChildren } from 'react';\nimport { useCallback, useMemo, useReducer, useRef, useState } from 'react';\n\nimport { TagItem, TempTagItem } from '../../page-list';\nimport type { MenuItemOption } from './menu-items';\nimport { renderMenuItemOptions } from './menu-items';\nimport * as styles from './tags-inline-editor.css';\n\ninterface TagsEditorProps {\n  pageId: string;\n  readonly?: boolean;\n  focusedIndex?: number;\n}\n\ninterface InlineTagsListProps\n  extends Omit<HTMLAttributes<HTMLDivElement>, 'onChange'>,\n    Omit<TagsEditorProps, 'onOptionsChange'> {\n  onRemove?: () => void;\n}\n\nexport const InlineTagsList = ({\n  pageId,\n  readonly,\n  children,\n  focusedIndex,\n  onRemove,\n}: PropsWithChildren<InlineTagsListProps>) => {\n  const tagList = useService(TagService).tagList;\n  const tags = useLiveData(tagList.tags$);\n  const tagIds = useLiveData(tagList.tagIdsByPageId$(pageId));\n\n  return (\n    <div className={styles.inlineTagsContainer} data-testid=\"inline-tags-list\">\n      {tagIds.map((tagId, idx) => {\n        const tag = tags.find(t => t.id === tagId);\n        if (!tag) {\n          return null;\n        }\n        const onRemoved = readonly\n          ? undefined\n          : () => {\n              tag.untag(pageId);\n              onRemove?.();\n            };\n        return (\n          <TagItem\n            key={tagId}\n            idx={idx}\n            focused={focusedIndex === idx}\n            onRemoved={onRemoved}\n            mode=\"inline\"\n            tag={tag}\n          />\n        );\n      })}\n      {children}\n    </div>\n  );\n};\n\nexport const EditTagMenu = ({\n  tagId,\n  onTagDelete,\n  children,\n}: PropsWithChildren<{\n  tagId: string;\n  onTagDelete: (tagIds: string[]) => void;\n}>) => {\n  const t = useI18n();\n  const legacyProperties = useService(WorkspaceLegacyProperties);\n  const tagService = useService(TagService);\n  const tagList = tagService.tagList;\n  const tag = useLiveData(tagList.tagByTagId$(tagId));\n  const tagColor = useLiveData(tag?.color$);\n  const tagValue = useLiveData(tag?.value$);\n  const navigate = useNavigateHelper();\n\n  const menuProps = useMemo(() => {\n    const options: MenuItemOption[] = [];\n    const updateTagName = (name: string) => {\n      if (name.trim() === '') {\n        return;\n      }\n      tag?.rename(name);\n    };\n    options.push(\n      <Input\n        defaultValue={tagValue}\n        onBlur={e => {\n          updateTagName(e.currentTarget.value);\n        }}\n        onKeyDown={e => {\n          if (e.key === 'Enter') {\n            e.stopPropagation();\n            e.preventDefault();\n            updateTagName(e.currentTarget.value);\n          }\n        }}\n        placeholder={t['Untitled']()}\n      />\n    );\n\n    options.push('-');\n\n    options.push({\n      text: t['Delete'](),\n      icon: <DeleteIcon />,\n      type: 'danger',\n      onClick() {\n        onTagDelete([tag?.id || '']);\n      },\n    });\n\n    options.push({\n      text: t['com.affine.page-properties.tags.open-tags-page'](),\n      icon: <TagsIcon />,\n      onClick() {\n        navigate.jumpToTag(legacyProperties.workspaceId, tag?.id || '');\n      },\n    });\n\n    options.push('-');\n\n    options.push(\n      tagService.tagColors.map(([name, color], i) => {\n        return {\n          text: name,\n          icon: (\n            <div key={i} className={styles.tagColorIconWrapper}>\n              <div\n                className={styles.tagColorIcon}\n                style={{\n                  backgroundColor: color,\n                }}\n              />\n            </div>\n          ),\n          checked: tagColor === color,\n          onClick() {\n            tag?.changeColor(color);\n          },\n        };\n      })\n    );\n    const items = renderMenuItemOptions(options);\n\n    return {\n      contentOptions: {\n        onClick(e) {\n          e.stopPropagation();\n        },\n      },\n      items,\n    } satisfies Partial<MenuProps>;\n  }, [\n    legacyProperties.workspaceId,\n    navigate,\n    onTagDelete,\n    t,\n    tag,\n    tagColor,\n    tagService.tagColors,\n    tagValue,\n  ]);\n\n  return <Menu {...menuProps}>{children}</Menu>;\n};\n\ntype TagOption = Tag | { readonly create: true; readonly value: string };\nconst isCreateNewTag = (\n  tagOption: TagOption\n): tagOption is { readonly create: true; readonly value: string } => {\n  return 'create' in tagOption;\n};\n\nexport const TagsEditor = ({ pageId, readonly }: TagsEditorProps) => {\n  const t = useI18n();\n  const tagService = useService(TagService);\n  const tagList = tagService.tagList;\n  const tags = useLiveData(tagList.tags$);\n  const tagIds = useLiveData(tagList.tagIdsByPageId$(pageId));\n  const [inputValue, setInputValue] = useState('');\n  const filteredTags = useLiveData(\n    inputValue ? tagList.filterTagsByName$(inputValue) : tagList.tags$\n  );\n  const [open, setOpen] = useState(false);\n  const [selectedTagIds, setSelectedTagIds] = useState<string[]>([]);\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  const exactMatch = filteredTags.find(tag => tag.value$.value === inputValue);\n  const showCreateTag = !exactMatch && inputValue.trim();\n\n  // tag option candidates to show in the tag dropdown\n  const tagOptions: TagOption[] = useMemo(() => {\n    if (showCreateTag) {\n      return [{ create: true, value: inputValue } as const, ...filteredTags];\n    } else {\n      return filteredTags;\n    }\n  }, [filteredTags, inputValue, showCreateTag]);\n\n  const [focusedIndex, setFocusedIndex] = useState<number>(-1);\n  const [focusedInlineIndex, setFocusedInlineIndex] = useState<number>(\n    tagIds.length\n  );\n\n  // -1: no focus\n  const safeFocusedIndex = clamp(focusedIndex, -1, tagOptions.length - 1);\n  // inline tags focus index can go beyond the length of tagIds\n  // using -1 and tagIds.length to make keyboard navigation easier\n  const safeInlineFocusedIndex = clamp(focusedInlineIndex, -1, tagIds.length);\n\n  const scrollContainerRef = useRef<HTMLDivElement>(null);\n\n  const handleCloseModal = useCallback(\n    (open: boolean) => {\n      setOpen(open);\n      setSelectedTagIds([]);\n    },\n    [setOpen]\n  );\n\n  const onTagDelete = useCallback(\n    (tagIds: string[]) => {\n      setOpen(true);\n      setSelectedTagIds(tagIds);\n    },\n    [setOpen, setSelectedTagIds]\n  );\n\n  const onInputChange = useCallback(\n    (e: React.ChangeEvent<HTMLInputElement>) => {\n      setInputValue(e.target.value);\n    },\n    []\n  );\n\n  const onToggleTag = useCallback(\n    (id: string) => {\n      const tagEntity = tagList.tags$.value.find(o => o.id === id);\n      if (!tagEntity) {\n        return;\n      }\n      if (!tagIds.includes(id)) {\n        tagEntity.tag(pageId);\n      } else {\n        tagEntity.untag(pageId);\n      }\n    },\n    [pageId, tagIds, tagList.tags$.value]\n  );\n\n  const focusInput = useCallback(() => {\n    inputRef.current?.focus();\n  }, []);\n\n  const [nextColor, rotateNextColor] = useReducer(\n    color => {\n      const idx = tagService.tagColors.findIndex(c => c[1] === color);\n      return tagService.tagColors[(idx + 1) % tagService.tagColors.length][1];\n    },\n    tagService.tagColors[\n      Math.floor(Math.random() * tagService.tagColors.length)\n    ][1]\n  );\n\n  const onCreateTag = useCallback(\n    (name: string) => {\n      rotateNextColor();\n      const newTag = tagList.createTag(name.trim(), nextColor);\n      return newTag.id;\n    },\n    [nextColor, tagList]\n  );\n\n  const onSelectTagOption = useCallback(\n    (tagOption: TagOption) => {\n      const id = isCreateNewTag(tagOption)\n        ? onCreateTag(tagOption.value)\n        : tagOption.id;\n      onToggleTag(id);\n      setInputValue('');\n      focusInput();\n      setFocusedIndex(-1);\n      setFocusedInlineIndex(tagIds.length + 1);\n    },\n    [onCreateTag, onToggleTag, focusInput, tagIds.length]\n  );\n\n  const onInputKeyDown = useCallback(\n    (e: React.KeyboardEvent<HTMLInputElement>) => {\n      if (e.key === 'Enter') {\n        if (safeFocusedIndex >= 0) {\n          onSelectTagOption(tagOptions[safeFocusedIndex]);\n        }\n      } else if (e.key === 'Backspace' && inputValue === '' && tagIds.length) {\n        const tagToRemove =\n          safeInlineFocusedIndex < 0 || safeInlineFocusedIndex >= tagIds.length\n            ? tagIds.length - 1\n            : safeInlineFocusedIndex;\n        tags.find(item => item.id === tagIds.at(tagToRemove))?.untag(pageId);\n      } else if (e.key === 'ArrowUp' || e.key === 'ArrowDown') {\n        e.preventDefault();\n        const newFocusedIndex = clamp(\n          safeFocusedIndex + (e.key === 'ArrowUp' ? -1 : 1),\n          0,\n          tagOptions.length - 1\n        );\n        scrollContainerRef.current\n          ?.querySelector(\n            `.${styles.tagSelectorItem}:nth-child(${newFocusedIndex + 1})`\n          )\n          ?.scrollIntoView({ block: 'nearest' });\n        setFocusedIndex(newFocusedIndex);\n        // reset inline focus\n        setFocusedInlineIndex(tagIds.length + 1);\n      } else if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {\n        const newItemToFocus =\n          e.key === 'ArrowLeft'\n            ? safeInlineFocusedIndex - 1\n            : safeInlineFocusedIndex + 1;\n\n        e.preventDefault();\n        setFocusedInlineIndex(newItemToFocus);\n        // reset tag list focus\n        setFocusedIndex(-1);\n      }\n    },\n    [\n      inputValue,\n      tagIds,\n      safeFocusedIndex,\n      onSelectTagOption,\n      tagOptions,\n      safeInlineFocusedIndex,\n      tags,\n      pageId,\n    ]\n  );\n\n  return (\n    <div data-testid=\"tags-editor-popup\" className={styles.tagsEditorRoot}>\n      <div className={styles.tagsEditorSelectedTags}>\n        <InlineTagsList\n          pageId={pageId}\n          readonly={readonly}\n          focusedIndex={safeInlineFocusedIndex}\n          onRemove={focusInput}\n        >\n          <input\n            ref={inputRef}\n            value={inputValue}\n            onChange={onInputChange}\n            onKeyDown={onInputKeyDown}\n            autoFocus\n            className={styles.searchInput}\n            placeholder=\"Type here ...\"\n          />\n        </InlineTagsList>\n      </div>\n      <div className={styles.tagsEditorTagsSelector}>\n        <div className={styles.tagsEditorTagsSelectorHeader}>\n          {t['com.affine.page-properties.tags.selector-header-title']()}\n        </div>\n        <Scrollable.Root>\n          <Scrollable.Viewport\n            ref={scrollContainerRef}\n            className={styles.tagSelectorTagsScrollContainer}\n          >\n            {tagOptions.map((tag, idx) => {\n              const commonProps = {\n                focused: safeFocusedIndex === idx,\n                onClick: () => onSelectTagOption(tag),\n                onMouseEnter: () => setFocusedIndex(idx),\n                ['data-testid']: 'tag-selector-item',\n                ['data-focused']: safeFocusedIndex === idx,\n                className: styles.tagSelectorItem,\n              };\n              if (isCreateNewTag(tag)) {\n                return (\n                  <div key={tag.value + '.' + idx} {...commonProps}>\n                    {t['Create']()}{' '}\n                    <TempTagItem value={inputValue} color={nextColor} />\n                  </div>\n                );\n              } else {\n                return (\n                  <div\n                    key={tag.id}\n                    {...commonProps}\n                    data-tag-id={tag.id}\n                    data-tag-value={tag.value$.value}\n                  >\n                    <TagItem maxWidth=\"100%\" tag={tag} mode=\"inline\" />\n                    <div className={styles.spacer} />\n                    <EditTagMenu tagId={tag.id} onTagDelete={onTagDelete}>\n                      <IconButton className={styles.tagEditIcon}>\n                        <MoreHorizontalIcon />\n                      </IconButton>\n                    </EditTagMenu>\n                  </div>\n                );\n              }\n            })}\n          </Scrollable.Viewport>\n          <Scrollable.Scrollbar style={{ transform: 'translateX(6px)' }} />\n        </Scrollable.Root>\n      </div>\n      <DeleteTagConfirmModal\n        open={open}\n        onOpenChange={handleCloseModal}\n        selectedTagIds={selectedTagIds}\n      />\n    </div>\n  );\n};\n\ninterface TagsInlineEditorProps extends TagsEditorProps {\n  placeholder?: string;\n  className?: string;\n}\n\n// this tags value renderer right now only renders the legacy tags for now\nexport const TagsInlineEditor = ({\n  pageId,\n  readonly,\n  placeholder,\n  className,\n}: TagsInlineEditorProps) => {\n  const tagList = useService(TagService).tagList;\n  const tagIds = useLiveData(tagList.tagIdsByPageId$(pageId));\n  const empty = !tagIds || tagIds.length === 0;\n  return (\n    <Menu\n      contentOptions={{\n        side: 'bottom',\n        align: 'start',\n        sideOffset: 0,\n        avoidCollisions: false,\n        className: styles.tagsMenu,\n        onClick(e) {\n          e.stopPropagation();\n        },\n      }}\n      items={<TagsEditor pageId={pageId} readonly={readonly} />}\n    >\n      <div\n        className={clsx(styles.tagsInlineEditor, className)}\n        data-empty={empty}\n        data-readonly={readonly}\n      >\n        {empty ? placeholder : <InlineTagsList pageId={pageId} readonly />}\n      </div>\n    </Menu>\n  );\n};\n","import { Checkbox, DatePicker, Menu } from '@affine/component';\nimport type {\n  PageInfoCustomProperty,\n  PageInfoCustomPropertyMeta,\n  PagePropertyType,\n} from '@affine/core/modules/properties/services/schema';\nimport { i18nTime, useI18n } from '@affine/i18n';\nimport { DocService, useService } from '@toeverything/infra';\nimport { noop } from 'lodash-es';\nimport type { ChangeEventHandler } from 'react';\nimport { useCallback, useContext, useEffect, useRef, useState } from 'react';\n\nimport { managerContext } from './common';\nimport * as styles from './styles.css';\nimport { TagsInlineEditor } from './tags-inline-editor';\n\ninterface PropertyRowValueProps {\n  property: PageInfoCustomProperty;\n  meta: PageInfoCustomPropertyMeta;\n}\n\nexport const DateValue = ({ property }: PropertyRowValueProps) => {\n  const displayValue = property.value\n    ? i18nTime(property.value, { absolute: { accuracy: 'day' } })\n    : undefined;\n  const manager = useContext(managerContext);\n\n  const handleClick = useCallback((e: React.MouseEvent) => {\n    e.stopPropagation();\n    // show edit popup\n  }, []);\n\n  const handleChange = useCallback(\n    (e: string) => {\n      manager.updateCustomProperty(property.id, {\n        value: e,\n      });\n    },\n    [manager, property.id]\n  );\n\n  const t = useI18n();\n\n  return (\n    <Menu items={<DatePicker value={property.value} onChange={handleChange} />}>\n      <div\n        onClick={handleClick}\n        className={styles.propertyRowValueCell}\n        data-empty={!property.value}\n      >\n        {displayValue ??\n          t['com.affine.page-properties.property-value-placeholder']()}\n      </div>\n    </Menu>\n  );\n};\n\nexport const CheckboxValue = ({ property }: PropertyRowValueProps) => {\n  const manager = useContext(managerContext);\n  const handleClick = useCallback(\n    (e: React.MouseEvent) => {\n      e.stopPropagation();\n      manager.updateCustomProperty(property.id, {\n        value: !property.value,\n      });\n    },\n    [manager, property.id, property.value]\n  );\n  return (\n    <div\n      onClick={handleClick}\n      className={styles.propertyRowValueCell}\n      data-empty={!property.value}\n    >\n      <Checkbox\n        className={styles.checkboxProperty}\n        checked={!!property.value}\n        onChange={noop}\n      />\n    </div>\n  );\n};\n\nexport const TextValue = ({ property }: PropertyRowValueProps) => {\n  const manager = useContext(managerContext);\n  const [value, setValue] = useState<string>(property.value);\n  const handleClick = useCallback((e: React.MouseEvent) => {\n    e.stopPropagation();\n  }, []);\n  const ref = useRef<HTMLTextAreaElement>(null);\n  const handleBlur = useCallback(\n    (e: FocusEvent) => {\n      manager.updateCustomProperty(property.id, {\n        value: (e.currentTarget as HTMLTextAreaElement).value.trim(),\n      });\n    },\n    [manager, property.id]\n  );\n  // use native blur event to get event after unmount\n  // don't use useLayoutEffect here, cause the cleanup function will be called before unmount\n  useEffect(() => {\n    ref.current?.addEventListener('blur', handleBlur);\n    return () => {\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n      ref.current?.removeEventListener('blur', handleBlur);\n    };\n  }, [handleBlur]);\n  const handleOnChange: ChangeEventHandler<HTMLTextAreaElement> = useCallback(\n    e => {\n      setValue(e.target.value);\n    },\n    []\n  );\n  const t = useI18n();\n  useEffect(() => {\n    setValue(property.value);\n  }, [property.value]);\n\n  return (\n    <div onClick={handleClick} className={styles.propertyRowValueTextCell}>\n      <textarea\n        ref={ref}\n        className={styles.propertyRowValueTextarea}\n        value={value || ''}\n        onChange={handleOnChange}\n        onClick={handleClick}\n        data-empty={!value}\n        placeholder={t[\n          'com.affine.page-properties.property-value-placeholder'\n        ]()}\n      />\n      <div className={styles.propertyRowValueTextareaInvisible}>\n        {value}\n        {value?.endsWith('\\n') || !value ? <br /> : null}\n      </div>\n    </div>\n  );\n};\n\nexport const NumberValue = ({ property }: PropertyRowValueProps) => {\n  const manager = useContext(managerContext);\n  const [value, setValue] = useState(property.value);\n  const handleClick = useCallback((e: React.MouseEvent) => {\n    e.stopPropagation();\n  }, []);\n  const handleBlur = useCallback(\n    (e: React.ChangeEvent<HTMLInputElement>) => {\n      manager.updateCustomProperty(property.id, {\n        value: e.target.value.trim(),\n      });\n    },\n    [manager, property.id]\n  );\n  const handleOnChange: ChangeEventHandler<HTMLInputElement> = useCallback(\n    e => {\n      setValue(e.target.value);\n    },\n    []\n  );\n  const t = useI18n();\n  useEffect(() => {\n    setValue(property.value);\n  }, [property.value]);\n  return (\n    <input\n      className={styles.propertyRowValueNumberCell}\n      type={'number'}\n      value={value || ''}\n      onChange={handleOnChange}\n      onClick={handleClick}\n      onBlur={handleBlur}\n      data-empty={!value}\n      placeholder={t['com.affine.page-properties.property-value-placeholder']()}\n    />\n  );\n};\n\nexport const TagsValue = () => {\n  const doc = useService(DocService).doc;\n\n  const t = useI18n();\n\n  return (\n    <TagsInlineEditor\n      className={styles.propertyRowValueCell}\n      placeholder={t['com.affine.page-properties.property-value-placeholder']()}\n      pageId={doc.id}\n      readonly={doc.blockSuiteDoc.readonly}\n    />\n  );\n};\n\nexport const propertyValueRenderers: Record<\n  PagePropertyType,\n  typeof DateValue\n> = {\n  date: DateValue,\n  checkbox: CheckboxValue,\n  text: TextValue,\n  number: NumberValue,\n  // TODO(@Peng): fix following\n  tags: TagsValue,\n  progress: TextValue,\n};\n","import type { MenuProps } from '@affine/component';\nimport {\n  Button,\n  IconButton,\n  Menu,\n  MenuIcon,\n  MenuItem,\n  Tooltip,\n} from '@affine/component';\nimport { useCurrentWorkspacePropertiesAdapter } from '@affine/core/hooks/use-affine-adapter';\nimport { track } from '@affine/core/mixpanel';\nimport { DocLinksService } from '@affine/core/modules/doc-link';\nimport type {\n  PageInfoCustomProperty,\n  PageInfoCustomPropertyMeta,\n  PagePropertyType,\n} from '@affine/core/modules/properties/services/schema';\nimport { i18nTime, useI18n } from '@affine/i18n';\nimport { assertExists } from '@blocksuite/global/utils';\nimport {\n  ArrowDownSmallIcon,\n  DeleteIcon,\n  InvisibleIcon,\n  MoreHorizontalIcon,\n  PlusIcon,\n  TagsIcon,\n  ToggleExpandIcon,\n  ViewIcon,\n} from '@blocksuite/icons/rc';\nimport type { DragEndEvent, DraggableAttributes } from '@dnd-kit/core';\nimport {\n  DndContext,\n  PointerSensor,\n  useSensor,\n  useSensors,\n} from '@dnd-kit/core';\nimport {\n  restrictToParentElement,\n  restrictToVerticalAxis,\n} from '@dnd-kit/modifiers';\nimport { SortableContext, useSortable } from '@dnd-kit/sortable';\nimport * as Collapsible from '@radix-ui/react-collapsible';\nimport {\n  DocService,\n  useLiveData,\n  useServices,\n  WorkspaceService,\n} from '@toeverything/infra';\nimport clsx from 'clsx';\nimport { use } from 'foxact/use';\nimport { useDebouncedValue } from 'foxact/use-debounced-value';\nimport { atom, useAtomValue, useSetAtom } from 'jotai';\nimport type React from 'react';\nimport type {\n  CSSProperties,\n  MouseEvent,\n  MouseEventHandler,\n  PropsWithChildren,\n} from 'react';\nimport {\n  Suspense,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useState,\n} from 'react';\n\nimport { AffinePageReference } from '../reference-link';\nimport { managerContext } from './common';\nimport { ConfirmDeletePropertyModal } from './confirm-delete-property-modal';\nimport type { PagePropertyIcon } from './icons-mapping';\nimport { getDefaultIconName, nameToIcon } from './icons-mapping';\nimport type { MenuItemOption } from './menu-items';\nimport {\n  EditPropertyNameMenuItem,\n  PropertyTypeMenuItem,\n  renderMenuItemOptions,\n} from './menu-items';\nimport type { PagePropertiesMetaManager } from './page-properties-manager';\nimport {\n  newPropertyTypes,\n  PagePropertiesManager,\n} from './page-properties-manager';\nimport {\n  propertyValueRenderers,\n  TagsValue,\n} from './property-row-value-renderer';\nimport * as styles from './styles.css';\n\ntype PagePropertiesSettingsPopupProps = PropsWithChildren<{\n  className?: string;\n  style?: React.CSSProperties;\n}>;\n\nconst Divider = () => <div className={styles.tableHeaderDivider} />;\n\ntype PropertyVisibility = PageInfoCustomProperty['visibility'];\n\nconst editingPropertyAtom = atom<string | null>(null);\n\nconst modifiers = [restrictToParentElement, restrictToVerticalAxis];\n\ninterface SortablePropertiesProps {\n  children: (properties: PageInfoCustomProperty[]) => React.ReactNode;\n}\n\nexport const SortableProperties = ({ children }: SortablePropertiesProps) => {\n  const manager = useContext(managerContext);\n  const properties = useMemo(() => manager.sorter.getOrderedItems(), [manager]);\n  const editingItem = useAtomValue(editingPropertyAtom);\n  const draggable = !manager.readonly && !editingItem;\n  const sensors = useSensors(\n    useSensor(PointerSensor, {\n      activationConstraint: {\n        distance: 8,\n      },\n    })\n  );\n  // use localProperties since changes applied to upstream may be delayed\n  // if we use that one, there will be weird behavior after reordering\n  const [localProperties, setLocalProperties] = useState(properties);\n\n  useEffect(() => {\n    setLocalProperties(properties);\n  }, [properties]);\n\n  const onDragEnd = useCallback(\n    (event: DragEndEvent) => {\n      if (!draggable) {\n        return;\n      }\n      const { active, over } = event;\n      if (over) {\n        manager.sorter.move(active.id, over.id);\n      }\n      setLocalProperties(manager.sorter.getOrderedItems());\n    },\n    [manager, draggable]\n  );\n\n  const filteredProperties = useMemo(\n    () => localProperties.filter(p => manager.getCustomPropertyMeta(p.id)),\n    [localProperties, manager]\n  );\n\n  return (\n    <DndContext sensors={sensors} onDragEnd={onDragEnd} modifiers={modifiers}>\n      <SortableContext disabled={!draggable} items={properties}>\n        {children(filteredProperties)}\n      </SortableContext>\n    </DndContext>\n  );\n};\n\ntype SyntheticListenerMap = ReturnType<typeof useSortable>['listeners'];\n\nconst SortablePropertyRow = ({\n  property,\n  className,\n  children,\n  ...props\n}: {\n  property: PageInfoCustomProperty;\n  className?: string;\n  children?:\n    | React.ReactNode\n    | ((props: {\n        attributes: DraggableAttributes;\n        listeners?: SyntheticListenerMap;\n      }) => React.ReactNode);\n}) => {\n  const manager = useContext(managerContext);\n  const {\n    setNodeRef,\n    attributes,\n    listeners,\n    transform,\n    transition,\n    active,\n    isDragging,\n    isSorting,\n  } = useSortable({\n    id: property.id,\n  });\n  const style: CSSProperties = useMemo(\n    () => ({\n      transform: transform\n        ? `translate3d(${transform.x}px, ${transform.y}px, 0)`\n        : undefined,\n      transition: isSorting ? transition : undefined,\n      pointerEvents: manager.readonly ? 'none' : undefined,\n    }),\n    [isSorting, manager.readonly, transform, transition]\n  );\n\n  return (\n    <div\n      style={style}\n      ref={setNodeRef}\n      className={clsx(styles.propertyRow, className)}\n      data-property={property.id}\n      data-draggable={!manager.readonly}\n      data-dragging={isDragging}\n      data-other-dragging={active ? active.id !== property.id : false}\n      {...props}\n      {...attributes}\n      {...listeners}\n    >\n      {typeof children === 'function'\n        ? children({ attributes, listeners })\n        : children}\n    </div>\n  );\n};\n\nconst visibilities: PropertyVisibility[] = ['visible', 'hide', 'hide-if-empty'];\nconst rotateVisibility = (\n  visibility: PropertyVisibility\n): PropertyVisibility => {\n  const index = visibilities.indexOf(visibility);\n  return visibilities[(index + 1) % visibilities.length];\n};\n\nconst visibilityMenuText = (visibility: PropertyVisibility = 'visible') => {\n  switch (visibility) {\n    case 'hide':\n      return 'com.affine.page-properties.property.hide-in-view';\n    case 'hide-if-empty':\n      return 'com.affine.page-properties.property.hide-in-view-when-empty';\n    case 'visible':\n      return 'com.affine.page-properties.property.show-in-view';\n    default:\n      throw new Error(`unknown visibility: ${visibility}`);\n  }\n};\n\nconst visibilitySelectorText = (visibility: PropertyVisibility = 'visible') => {\n  switch (visibility) {\n    case 'hide':\n      return 'com.affine.page-properties.property.always-hide';\n    case 'hide-if-empty':\n      return 'com.affine.page-properties.property.hide-when-empty';\n    case 'visible':\n      return 'com.affine.page-properties.property.always-show';\n    default:\n      throw new Error(`unknown visibility: ${visibility}`);\n  }\n};\n\nconst VisibilityModeSelector = ({\n  property,\n}: {\n  property: PageInfoCustomProperty;\n}) => {\n  const manager = useContext(managerContext);\n  const t = useI18n();\n  const meta = manager.getCustomPropertyMeta(property.id);\n  const visibility = property.visibility || 'visible';\n\n  const menuItems = useMemo(() => {\n    const options: MenuItemOption[] = [];\n    options.push(\n      visibilities.map(v => {\n        const text = visibilityMenuText(v);\n        return {\n          text: t[text](),\n          selected: visibility === v,\n          onClick: () => {\n            manager.updateCustomProperty(property.id, {\n              visibility: v,\n            });\n          },\n        };\n      })\n    );\n    return renderMenuItemOptions(options);\n  }, [manager, property.id, t, visibility]);\n\n  if (!meta) {\n    return null;\n  }\n\n  const required = meta.required;\n\n  return (\n    <Menu\n      items={menuItems}\n      rootOptions={{\n        open: required ? false : undefined,\n      }}\n      contentOptions={{\n        onClick(e) {\n          e.stopPropagation();\n        },\n      }}\n    >\n      <div\n        role=\"button\"\n        data-required={required}\n        className={styles.selectorButton}\n      >\n        {required ? (\n          t['com.affine.page-properties.property.required']()\n        ) : (\n          <>\n            {t[visibilitySelectorText(visibility)]()}\n            <ArrowDownSmallIcon width={16} height={16} />\n          </>\n        )}\n      </div>\n    </Menu>\n  );\n};\n\nexport const PagePropertiesSettingsPopup = ({\n  children,\n}: PagePropertiesSettingsPopupProps) => {\n  const manager = useContext(managerContext);\n  const t = useI18n();\n\n  const menuItems = useMemo(() => {\n    const options: MenuItemOption[] = [];\n    options.push(\n      <div\n        role=\"heading\"\n        className={styles.menuHeader}\n        style={{ minWidth: 320 }}\n      >\n        {t['com.affine.page-properties.settings.title']()}\n      </div>\n    );\n    options.push('-');\n    options.push([\n      <SortableProperties key=\"sortable-settings\">\n        {properties =>\n          properties.map(property => {\n            const meta = manager.getCustomPropertyMeta(property.id);\n            assertExists(meta, 'meta should exist for property');\n            const Icon = nameToIcon(meta.icon, meta.type);\n            const name = meta.name;\n            return (\n              <SortablePropertyRow\n                key={meta.id}\n                property={property}\n                className={styles.propertySettingRow}\n                data-testid=\"page-properties-settings-menu-item\"\n              >\n                <MenuIcon>\n                  <Icon />\n                </MenuIcon>\n                <div\n                  data-testid=\"page-property-setting-row-name\"\n                  className={styles.propertyRowName}\n                >\n                  {name}\n                </div>\n                <VisibilityModeSelector property={property} />\n              </SortablePropertyRow>\n            );\n          })\n        }\n      </SortableProperties>,\n    ]);\n    return renderMenuItemOptions(options);\n  }, [manager, t]);\n\n  return (\n    <Menu\n      contentOptions={{\n        onClick(e) {\n          e.stopPropagation();\n        },\n      }}\n      items={menuItems}\n    >\n      {children}\n    </Menu>\n  );\n};\n\ntype PageBacklinksPopupProps = PropsWithChildren<{\n  backlinks: { docId: string; blockId: string; title: string }[];\n}>;\n\nexport const PageBacklinksPopup = ({\n  backlinks,\n  children,\n}: PageBacklinksPopupProps) => {\n  const manager = useContext(managerContext);\n\n  return (\n    <Menu\n      contentOptions={{\n        onClick(e) {\n          e.stopPropagation();\n        },\n      }}\n      items={\n        <div className={styles.backlinksList}>\n          {backlinks.map(link => (\n            <AffinePageReference\n              key={link.docId + ':' + link.blockId}\n              wrapper={MenuItem}\n              pageId={link.docId}\n              docCollection={manager.workspace.docCollection}\n            />\n          ))}\n        </div>\n      }\n    >\n      {children}\n    </Menu>\n  );\n};\n\ninterface PagePropertyRowNameProps {\n  property: PageInfoCustomProperty;\n  meta: PageInfoCustomPropertyMeta;\n  editing: boolean;\n  onFinishEditing: () => void;\n}\n\nexport const PagePropertyRowNameMenu = ({\n  editing,\n  meta,\n  property,\n  onFinishEditing,\n  children,\n}: PropsWithChildren<PagePropertyRowNameProps>) => {\n  const manager = useContext(managerContext);\n  const [localPropertyMeta, setLocalPropertyMeta] = useState(() => ({\n    ...meta,\n  }));\n  const [localProperty, setLocalProperty] = useState(() => ({ ...property }));\n  const nextVisibility = rotateVisibility(localProperty.visibility);\n\n  const [showDeleteModal, setShowDeleteModal] = useState(false);\n\n  useEffect(() => {\n    setLocalPropertyMeta(meta);\n  }, [meta]);\n\n  useEffect(() => {\n    setLocalProperty(property);\n  }, [property]);\n\n  const handleFinishEditing = useCallback(() => {\n    onFinishEditing();\n    manager.updateCustomPropertyMeta(meta.id, localPropertyMeta);\n    manager.updateCustomProperty(property.id, localProperty);\n  }, [\n    localProperty,\n    localPropertyMeta,\n    manager,\n    meta.id,\n    onFinishEditing,\n    property.id,\n  ]);\n  const t = useI18n();\n  const handleNameBlur = useCallback(\n    (v: string) => {\n      manager.updateCustomPropertyMeta(meta.id, {\n        name: v,\n      });\n    },\n    [manager, meta.id]\n  );\n  const handleNameChange: (name: string) => void = useCallback(name => {\n    setLocalPropertyMeta(prev => ({\n      ...prev,\n      name: name,\n    }));\n  }, []);\n  const toggleHide = useCallback(\n    (e: MouseEvent) => {\n      e.stopPropagation();\n      e.preventDefault();\n      setLocalProperty(prev => ({\n        ...prev,\n        visibility: nextVisibility,\n      }));\n    },\n    [nextVisibility]\n  );\n  const handleDelete = useCallback(() => {\n    manager.removeCustomProperty(property.id);\n  }, [manager, property.id]);\n\n  const handleIconChange = useCallback(\n    (icon: PagePropertyIcon) => {\n      setLocalPropertyMeta(prev => ({\n        ...prev,\n        icon,\n      }));\n      manager.updateCustomPropertyMeta(meta.id, {\n        icon: icon,\n      });\n    },\n    [manager, meta.id]\n  );\n\n  const menuItems = useMemo(() => {\n    const options: MenuItemOption[] = [];\n    options.push(\n      <EditPropertyNameMenuItem\n        property={localPropertyMeta}\n        onIconChange={handleIconChange}\n        onNameBlur={handleNameBlur}\n        onNameChange={handleNameChange}\n      />\n    );\n    options.push(<PropertyTypeMenuItem property={localPropertyMeta} />);\n    if (!localPropertyMeta.required) {\n      options.push('-');\n      options.push({\n        icon:\n          nextVisibility === 'hide' || nextVisibility === 'hide-if-empty' ? (\n            <InvisibleIcon />\n          ) : (\n            <ViewIcon />\n          ),\n        text: t[\n          visibilityMenuText(rotateVisibility(localProperty.visibility))\n        ](),\n        onClick: toggleHide,\n      });\n      options.push({\n        type: 'danger',\n        icon: <DeleteIcon />,\n        text: t['com.affine.page-properties.property.remove-property'](),\n        onClick: () => setShowDeleteModal(true),\n      });\n    }\n    return renderMenuItemOptions(options);\n  }, [\n    handleIconChange,\n    handleNameBlur,\n    handleNameChange,\n    localProperty.visibility,\n    localPropertyMeta,\n    nextVisibility,\n    t,\n    toggleHide,\n  ]);\n\n  return (\n    <>\n      <Menu\n        rootOptions={{\n          open: editing,\n        }}\n        contentOptions={{\n          onInteractOutside: handleFinishEditing,\n          onClick(e) {\n            e.stopPropagation();\n          },\n          onKeyDown(e) {\n            if (e.key === 'Escape') {\n              handleFinishEditing();\n            }\n          },\n        }}\n        items={menuItems}\n      >\n        {children}\n      </Menu>\n      <ConfirmDeletePropertyModal\n        onConfirm={() => {\n          setShowDeleteModal(false);\n          handleDelete();\n        }}\n        onCancel={() => setShowDeleteModal(false)}\n        show={showDeleteModal}\n        property={meta}\n      />\n    </>\n  );\n};\n\ninterface PagePropertiesTableHeaderProps {\n  className?: string;\n  style?: React.CSSProperties;\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\n// backlinks - #no                Updated yyyy-mm-dd\n// \n// Page Info ...\nexport const PagePropertiesTableHeader = ({\n  className,\n  style,\n  open,\n  onOpenChange,\n}: PagePropertiesTableHeaderProps) => {\n  const manager = useContext(managerContext);\n\n  const t = useI18n();\n  const { docLinksServices } = useServices({\n    DocLinksServices: DocLinksService,\n  });\n  const docBacklinks = docLinksServices.backlinks;\n  const backlinks = useLiveData(docBacklinks.backlinks$);\n\n  const { docService, workspaceService } = useServices({\n    DocService,\n    WorkspaceService,\n  });\n\n  const { syncing, retrying, serverClock } = useLiveData(\n    workspaceService.workspace.engine.doc.docState$(docService.doc.id)\n  );\n\n  const timestampElement = useMemo(() => {\n    const localizedCreateTime = manager.createDate\n      ? i18nTime(manager.createDate)\n      : null;\n\n    const createTimeElement = (\n      <div className={styles.tableHeaderTimestamp}>\n        {t['Created']()} {localizedCreateTime}\n      </div>\n    );\n\n    return serverClock ? (\n      <Tooltip\n        side=\"right\"\n        content={\n          <>\n            <div className={styles.tableHeaderTimestamp}>\n              {t['Updated']()} {i18nTime(serverClock)}\n            </div>\n            {manager.createDate && (\n              <div className={styles.tableHeaderTimestamp}>\n                {t['Created']()} {i18nTime(manager.createDate)}\n              </div>\n            )}\n          </>\n        }\n      >\n        <div className={styles.tableHeaderTimestamp}>\n          {!syncing && !retrying ? (\n            <>\n              {t['Updated']()}{' '}\n              {i18nTime(serverClock, {\n                relative: {\n                  max: [1, 'day'],\n                  accuracy: 'minute',\n                },\n                absolute: {\n                  accuracy: 'day',\n                },\n              })}\n            </>\n          ) : (\n            <>{t['com.affine.syncing']()}</>\n          )}\n        </div>\n      </Tooltip>\n    ) : manager.updatedDate ? (\n      <Tooltip side=\"right\" content={createTimeElement}>\n        <div className={styles.tableHeaderTimestamp}>\n          {t['Updated']()} {i18nTime(manager.updatedDate)}\n        </div>\n      </Tooltip>\n    ) : (\n      createTimeElement\n    );\n  }, [\n    manager.createDate,\n    manager.updatedDate,\n    retrying,\n    serverClock,\n    syncing,\n    t,\n  ]);\n\n  const dTimestampElement = useDebouncedValue(timestampElement, 500);\n\n  const handleCollapse = useCallback(() => {\n    track.doc.inlineDocInfo.$.toggle();\n    onOpenChange(!open);\n  }, [onOpenChange, open]);\n\n  const properties = manager.sorter.getOrderedItems();\n\n  return (\n    <div className={clsx(styles.tableHeader, className)} style={style}>\n      {/* TODO(@Peng): add click handler to backlinks */}\n      <div className={styles.tableHeaderInfoRow}>\n        {backlinks.length > 0 ? (\n          <PageBacklinksPopup backlinks={backlinks}>\n            <div className={styles.tableHeaderBacklinksHint}>\n              {t['com.affine.page-properties.backlinks']()}  {backlinks.length}\n            </div>\n          </PageBacklinksPopup>\n        ) : null}\n        {dTimestampElement}\n      </div>\n      <Divider />\n      <div className={styles.tableHeaderSecondaryRow}>\n        <div className={clsx(!open ? styles.pageInfoDimmed : null)}>\n          {t['com.affine.page-properties.page-info']()}\n        </div>\n        {properties.length === 0 || manager.readonly ? null : (\n          <PagePropertiesSettingsPopup>\n            <IconButton data-testid=\"page-info-show-more\" size=\"20\">\n              <MoreHorizontalIcon />\n            </IconButton>\n          </PagePropertiesSettingsPopup>\n        )}\n        <Collapsible.Trigger asChild role=\"button\" onClick={handleCollapse}>\n          <div\n            className={styles.tableHeaderCollapseButtonWrapper}\n            data-testid=\"page-info-collapse\"\n          >\n            <IconButton size=\"20\">\n              <ToggleExpandIcon\n                className={styles.collapsedIcon}\n                data-collapsed={!open}\n              />\n            </IconButton>\n          </div>\n        </Collapsible.Trigger>\n      </div>\n    </div>\n  );\n};\n\ninterface PagePropertyRowProps {\n  property: PageInfoCustomProperty;\n  style?: React.CSSProperties;\n  rowNameClassName?: string;\n}\n\nexport const PagePropertyRow = ({\n  property,\n  rowNameClassName,\n}: PagePropertyRowProps) => {\n  const manager = useContext(managerContext);\n  const meta = manager.getCustomPropertyMeta(property.id);\n\n  assertExists(meta, 'meta should exist for property');\n\n  const Icon = nameToIcon(meta.icon, meta.type);\n  const name = meta.name;\n  const ValueRenderer = propertyValueRenderers[meta.type];\n  const [editingMeta, setEditingMeta] = useState(false);\n  const setEditingItem = useSetAtom(editingPropertyAtom);\n  const handleEditMeta = useCallback(() => {\n    if (!manager.readonly) {\n      setEditingMeta(true);\n    }\n    setEditingItem(property.id);\n  }, [manager.readonly, property.id, setEditingItem]);\n  const handleFinishEditingMeta = useCallback(() => {\n    setEditingMeta(false);\n    setEditingItem(null);\n  }, [setEditingItem]);\n  return (\n    <SortablePropertyRow property={property} data-testid=\"page-property-row\">\n      {({ attributes, listeners }) => (\n        <>\n          <PagePropertyRowNameMenu\n            editing={editingMeta}\n            meta={meta}\n            property={property}\n            onFinishEditing={handleFinishEditingMeta}\n          >\n            <div\n              {...attributes}\n              {...listeners}\n              data-testid=\"page-property-row-name\"\n              className={clsx(\n                styles.sortablePropertyRowNameCell,\n                rowNameClassName\n              )}\n              onClick={handleEditMeta}\n            >\n              <div className={styles.propertyRowNameContainer}>\n                <div className={styles.propertyRowIconContainer}>\n                  <Icon />\n                </div>\n                <div className={styles.propertyRowName}>{name}</div>\n              </div>\n            </div>\n          </PagePropertyRowNameMenu>\n          <ValueRenderer meta={meta} property={property} />\n        </>\n      )}\n    </SortablePropertyRow>\n  );\n};\n\nexport const PageTagsRow = ({\n  rowNameClassName,\n}: {\n  rowNameClassName?: string;\n}) => {\n  const t = useI18n();\n  return (\n    <div\n      className={styles.tagsPropertyRow}\n      data-testid=\"page-property-row\"\n      data-property=\"tags\"\n    >\n      <div\n        className={clsx(styles.propertyRowNameCell, rowNameClassName)}\n        data-testid=\"page-property-row-name\"\n      >\n        <div className={styles.propertyRowNameContainer}>\n          <div className={styles.propertyRowIconContainer}>\n            <TagsIcon />\n          </div>\n          <div className={styles.propertyRowName}>{t['Tags']()}</div>\n        </div>\n      </div>\n      <TagsValue />\n    </div>\n  );\n};\n\ninterface PagePropertiesTableBodyProps {\n  className?: string;\n  style?: React.CSSProperties;\n}\n\n//  Tags     ( xxx) ( yyy)\n// # Number   123456\n// +  Add a property\nexport const PagePropertiesTableBody = ({\n  className,\n  style,\n}: PagePropertiesTableBodyProps) => {\n  const manager = useContext(managerContext);\n  return (\n    <Collapsible.Content\n      className={clsx(styles.tableBodyRoot, className)}\n      style={style}\n    >\n      <PageTagsRow />\n      <SortableProperties>\n        {properties =>\n          properties.length ? (\n            <div className={styles.tableBodySortable}>\n              {properties\n                .filter(\n                  property =>\n                    manager.isPropertyRequired(property.id) ||\n                    (property.visibility !== 'hide' &&\n                      !(\n                        property.visibility === 'hide-if-empty' &&\n                        !property.value\n                      ))\n                )\n                .map(property => (\n                  <PagePropertyRow key={property.id} property={property} />\n                ))}\n            </div>\n          ) : null\n        }\n      </SortableProperties>\n      {manager.readonly ? null : <PagePropertiesAddProperty />}\n      <Divider />\n    </Collapsible.Content>\n  );\n};\n\ninterface PagePropertiesCreatePropertyMenuItemsProps {\n  onCreated?: (e: React.MouseEvent, id: string) => void;\n  metaManager: PagePropertiesMetaManager;\n}\n\nconst findNextDefaultName = (name: string, allNames: string[]): string => {\n  const nameExists = allNames.includes(name);\n  if (nameExists) {\n    const match = name.match(/(\\d+)$/);\n    if (match) {\n      const num = parseInt(match[1], 10);\n      const nextName = name.replace(/(\\d+)$/, `${num + 1}`);\n      return findNextDefaultName(nextName, allNames);\n    } else {\n      return findNextDefaultName(`${name} 2`, allNames);\n    }\n  } else {\n    return name;\n  }\n};\n\nexport const PagePropertiesCreatePropertyMenuItems = ({\n  onCreated,\n  metaManager,\n}: PagePropertiesCreatePropertyMenuItemsProps) => {\n  const t = useI18n();\n  const onAddProperty = useCallback(\n    (\n      e: React.MouseEvent,\n      option: { type: PagePropertyType; name: string; icon: string }\n    ) => {\n      const schemaList = metaManager.getOrderedPropertiesSchema();\n      const nameExists = schemaList.some(meta => meta.name === option.name);\n      const allNames = schemaList.map(meta => meta.name);\n      const name = nameExists\n        ? findNextDefaultName(option.name, allNames)\n        : option.name;\n      const { id } = metaManager.addPropertyMeta({\n        name,\n        icon: option.icon,\n        type: option.type,\n      });\n      onCreated?.(e, id);\n    },\n    [metaManager, onCreated]\n  );\n\n  return useMemo(() => {\n    const options: MenuItemOption[] = [];\n    options.push(\n      <div role=\"heading\" className={styles.menuHeader}>\n        {t['com.affine.page-properties.create-property.menu.header']()}\n      </div>\n    );\n    options.push('-');\n    options.push(\n      newPropertyTypes.map(type => {\n        const iconName = getDefaultIconName(type);\n        const Icon = nameToIcon(iconName, type);\n        const name = t[`com.affine.page-properties.property.${type}`]();\n        return {\n          icon: <Icon />,\n          text: name,\n          onClick: (e: React.MouseEvent) => {\n            onAddProperty(e, {\n              icon: iconName,\n              name: name,\n              type: type,\n            });\n          },\n        };\n      })\n    );\n    return renderMenuItemOptions(options);\n  }, [onAddProperty, t]);\n};\n\ninterface PagePropertiesAddPropertyMenuItemsProps {\n  onCreateClicked: (e: React.MouseEvent) => void;\n}\n\nconst PagePropertiesAddPropertyMenuItems = ({\n  onCreateClicked,\n}: PagePropertiesAddPropertyMenuItemsProps) => {\n  const manager = useContext(managerContext);\n\n  const t = useI18n();\n  const metaList = manager.metaManager.getOrderedPropertiesSchema();\n  const nonRequiredMetaList = metaList.filter(meta => !meta.required);\n  const isChecked = useCallback(\n    (m: string) => {\n      return manager.hasCustomProperty(m);\n    },\n    [manager]\n  );\n\n  const onClickProperty = useCallback(\n    (e: React.MouseEvent, id: string) => {\n      e.stopPropagation();\n      e.preventDefault();\n      if (isChecked(id)) {\n        manager.removeCustomProperty(id);\n      } else {\n        manager.addCustomProperty(id);\n      }\n    },\n    [isChecked, manager]\n  );\n\n  const menuItems = useMemo(() => {\n    const options: MenuItemOption[] = [];\n    options.push(\n      <div role=\"heading\" className={styles.menuHeader}>\n        {t['com.affine.page-properties.add-property.menu.header']()}\n      </div>\n    );\n\n    if (nonRequiredMetaList.length > 0) {\n      options.push('-');\n      const nonRequiredMetaOptions: MenuItemOption = nonRequiredMetaList.map(\n        meta => {\n          const Icon = nameToIcon(meta.icon, meta.type);\n          const name = meta.name;\n          return {\n            icon: <Icon />,\n            text: name,\n            selected: isChecked(meta.id),\n            onClick: (e: React.MouseEvent) => onClickProperty(e, meta.id),\n          };\n        }\n      );\n      options.push(nonRequiredMetaOptions);\n    }\n    options.push('-');\n    options.push({\n      icon: <PlusIcon />,\n      text: t['com.affine.page-properties.add-property.menu.create'](),\n      onClick: onCreateClicked,\n    });\n\n    return renderMenuItemOptions(options);\n  }, [isChecked, nonRequiredMetaList, onClickProperty, onCreateClicked, t]);\n\n  return menuItems;\n};\n\nexport const PagePropertiesAddProperty = () => {\n  const t = useI18n();\n  const [adding, setAdding] = useState(true);\n  const manager = useContext(managerContext);\n  const toggleAdding: MouseEventHandler = useCallback(e => {\n    e.stopPropagation();\n    e.preventDefault();\n    setAdding(prev => !prev);\n  }, []);\n\n  const menuOptions = useMemo(() => {\n    const handleCreated = (e: React.MouseEvent, id: string) => {\n      toggleAdding(e);\n      manager.addCustomProperty(id);\n    };\n    const items = adding ? (\n      <PagePropertiesAddPropertyMenuItems onCreateClicked={toggleAdding} />\n    ) : (\n      <PagePropertiesCreatePropertyMenuItems\n        metaManager={manager.metaManager}\n        onCreated={handleCreated}\n      />\n    );\n\n    return {\n      contentOptions: {\n        onClick(e) {\n          e.stopPropagation();\n        },\n      },\n      rootOptions: {\n        onOpenChange: () => setAdding(true),\n      },\n      items,\n    } satisfies Partial<MenuProps>;\n  }, [adding, manager, toggleAdding]);\n\n  return (\n    <Menu {...menuOptions}>\n      <Button\n        variant=\"plain\"\n        prefix={<PlusIcon />}\n        className={styles.addPropertyButton}\n      >\n        {t['com.affine.page-properties.add-property']()}\n      </Button>\n    </Menu>\n  );\n};\n\nconst PagePropertiesTableInner = () => {\n  const manager = useContext(managerContext);\n  const [expanded, setExpanded] = useState(false);\n  use(manager.workspace.docCollection.doc.whenSynced);\n  return (\n    <div className={styles.root}>\n      <Collapsible.Root\n        open={expanded}\n        onOpenChange={setExpanded}\n        className={styles.rootCentered}\n      >\n        <PagePropertiesTableHeader open={expanded} onOpenChange={setExpanded} />\n        <PagePropertiesTableBody />\n      </Collapsible.Root>\n    </div>\n  );\n};\n\nexport const usePagePropertiesManager = (docId: string) => {\n  // the workspace properties adapter adapter is reactive,\n  // which means it's reference will change when any of the properties change\n  // also it will trigger a re-render of the component\n  const adapter = useCurrentWorkspacePropertiesAdapter();\n  const manager = useMemo(() => {\n    return new PagePropertiesManager(adapter, docId);\n  }, [adapter, docId]);\n  return manager;\n};\n\n// this is the main component that renders the page properties table at the top of the page below\n// the page title\nexport const PagePropertiesTable = ({ docId }: { docId: string }) => {\n  const manager = usePagePropertiesManager(docId);\n\n  // if the given page is not in the current workspace, then we don't render anything\n  // eg. when it is in history modal\n\n  if (!manager.page || manager.readonly) {\n    return null;\n  }\n\n  return (\n    <managerContext.Provider value={manager}>\n      <Suspense>\n        <PagePropertiesTableInner />\n      </Suspense>\n    </managerContext.Provider>\n  );\n};\n","import { useI18n } from '@affine/i18n';\nimport { useContext } from 'react';\n\nimport { AffinePageReference } from '../../reference-link';\nimport { managerContext } from '../common';\nimport * as styles from './back-links-row.css';\nexport const BackLinksRow = ({\n  references,\n  onClick,\n}: {\n  references: { docId: string; title: string }[];\n  onClick?: () => void;\n}) => {\n  const manager = useContext(managerContext);\n  const t = useI18n();\n  return (\n    <div>\n      <div className={styles.title}>\n        {t['com.affine.page-properties.backlinks']()}  {references.length}\n      </div>\n      {references.map(link => (\n        <AffinePageReference\n          key={link.docId}\n          pageId={link.docId}\n          wrapper={props => (\n            <div className={styles.wrapper} onClick={onClick} {...props} />\n          )}\n          docCollection={manager.workspace.docCollection}\n        />\n      ))}\n    </div>\n  );\n};\n","import \"../core/src/components/affine/page-properties/info-modal/back-links-row.css.ts.vanilla.css!=!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/affine/page-properties/info-modal/back-links-row.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xdnh2dmtoMCB7CiAgZm9udC1zaXplOiB2YXIoLS1hZmZpbmUtZm9udC1zbSk7CiAgZm9udC13ZWlnaHQ6IDUwMDsKICBjb2xvcjogdmFyKC0tYWZmaW5lLXRleHQtc2Vjb25kYXJ5LWNvbG9yKTsKICBwYWRkaW5nOiA2cHg7Cn0KLl8xdnh2dmtoMSB7CiAgd2lkdGg6IDEwMCU7CiAgYm9yZGVyLXJhZGl1czogNHB4OwogIGNvbG9yOiB2YXIoLS1hZmZpbmUtdGV4dC1wcmltYXJ5LWNvbG9yKTsKICBkaXNwbGF5OiBmbGV4OwogIGZsZXgtZGlyZWN0aW9uOiByb3c7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBnYXA6IDJweDsKICBwYWRkaW5nOiA2cHg7Cn0KLl8xdnh2dmtoMTpob3ZlciB7CiAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tYWZmaW5lLWhvdmVyLWNvbG9yKTsKfQouXzF2eHZ2a2gxIHN2ZyB7CiAgY29sb3I6IHZhcigtLWFmZmluZS1pY29uLXNlY29uZGFyeSk7CiAgZm9udC1zaXplOiAxNnB4OwogIHRyYW5zZm9ybTogbm9uZTsKfQouXzF2eHZ2a2gxIHNwYW4gewogIGZvbnQtc2l6ZTogdmFyKC0tYWZmaW5lLWZvbnQtc20pOwogIHdoaXRlLXNwYWNlOiBub3dyYXA7CiAgb3ZlcmZsb3c6IGhpZGRlbjsKICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsKICBib3JkZXItYm90dG9tOiBub25lOwp9\\\"}!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var title = '_1vxvvkh0';\nexport var wrapper = '_1vxvvkh1';","import { Menu } from '@affine/component';\nimport { TagService } from '@affine/core/modules/tag';\nimport { useI18n } from '@affine/i18n';\nimport { TagsIcon } from '@blocksuite/icons/rc';\nimport { useLiveData, useService } from '@toeverything/infra';\nimport clsx from 'clsx';\n\nimport { InlineTagsList, TagsEditor } from '../tags-inline-editor';\nimport * as styles from './tags-row.css';\n\nexport const TagsRow = ({\n  docId,\n  readonly,\n}: {\n  docId: string;\n  readonly: boolean;\n}) => {\n  const t = useI18n();\n  const tagList = useService(TagService).tagList;\n  const tagIds = useLiveData(tagList.tagIdsByPageId$(docId));\n  const empty = !tagIds || tagIds.length === 0;\n  return (\n    <div className={styles.rowCell} data-testid=\"info-modal-tags-row\">\n      <div className={styles.rowNameContainer}>\n        <div className={styles.icon}>\n          <TagsIcon />\n        </div>\n        <div className={styles.rowName}>{t['Tags']()}</div>\n      </div>\n      <Menu\n        contentOptions={{\n          side: 'bottom',\n          align: 'start',\n          sideOffset: 0,\n          avoidCollisions: false,\n          className: styles.tagsMenu,\n          onClick(e) {\n            e.stopPropagation();\n          },\n        }}\n        items={<TagsEditor pageId={docId} readonly={readonly} />}\n      >\n        <div\n          className={clsx(styles.tagsInlineEditor, styles.rowValueCell)}\n          data-empty={empty}\n          data-readonly={readonly}\n          data-testid=\"info-modal-tags-value\"\n        >\n          {empty ? (\n            t['com.affine.page-properties.property-value-placeholder']()\n          ) : (\n            <InlineTagsList pageId={docId} readonly />\n          )}\n        </div>\n      </Menu>\n    </div>\n  );\n};\n","import \"../core/src/components/affine/page-properties/info-modal/tags-row.css.ts.vanilla.css!=!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/affine/page-properties/info-modal/tags-row.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACqVV23LcIAx9z1cweYqbktndXJohky/p9IEF2abFiAp5L+303ztgx+t0N2kmebIRB52jIxlfbWnpf9qF+H0mRI2BZXK/QInlXdw9nAlh0CMpsdF0IaWuaxdAOoNBJjAYrKZ9lWHWpej1XonaQzmnvWuCdAxdUsJAYKAc/t4ndvVeGgwMgQ9bf86uBiXLouQoX35K6wgMOwxKEG5foWl0VGKsIGprXWim9dZZbnOBi7yeeFeDA5mmIdwqscxg3ADVPi9bZy2EHGPYsTxsgPcuJpdK7tYxyBS1ASUCbknHh+e+PjNyiHfVS0YXpsloWSDVTPP1aa9eMGVuhLiPB1tn9f5f6UR+8/5GJdbEU59unvXh9m1pDfq+K+3oNDUuSMaoxGoxlDXG1siM3b8Md+8XXjCT+ojJjVjwmt0GcnSNZIEkaev6NHK/bQR8DrTgmpaVWK2Gg30Ckgk8GM4jFQqH6SnlaYnoXuvuIEWJZdyJhN5ZwaRDipog8KtDF8l185Eb7ClDcvBR1Wj6JDcuubWH4ir2nKt4UjrDtvmLKZi1Nj8awj5YeYq/AI9nfWT7UAYVvTbQorejlFOnZ5gTOb5azVpCF3n/eM7Uw/m3D2Ui0BaD3z/mXEOqsakSNhA4HVn5ZQA9tXtRrqTc1hqpU8Or1wwX8vrqNu4+C6O9GRficlSYp3MnI8YIJHUwLdI4eZX4JOSyqmZXZUnw8rmCqsRl+WdUp2/NSf393MBDzW+27y+nDoIksAYAAA==\\\"}!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var container = 'wr1lqd5';\nexport var icon = 'wr1lqd0';\nexport var rowCell = 'wr1lqd4';\nexport var rowName = 'wr1lqd2';\nexport var rowNameContainer = 'wr1lqd1';\nexport var rowValueCell = 'wr1lqd6';\nexport var tagsInlineEditor = 'wr1lqd8';\nexport var tagsMenu = 'wr1lqd7';\nexport var time = 'wr1lqd3';","import { i18nTime, useI18n } from '@affine/i18n';\nimport { DateTimeIcon, HistoryIcon } from '@blocksuite/icons/rc';\nimport { useLiveData, useService, WorkspaceService } from '@toeverything/infra';\nimport type { ConfigType } from 'dayjs';\nimport { useDebouncedValue } from 'foxact/use-debounced-value';\nimport { type ReactNode, useContext, useMemo } from 'react';\n\nimport { managerContext } from '../common';\nimport * as styles from './time-row.css';\n\nconst RowComponent = ({\n  name,\n  icon,\n  time,\n}: {\n  name: string;\n  icon: ReactNode;\n  time?: string | null;\n}) => {\n  return (\n    <div className={styles.rowCell}>\n      <div className={styles.rowNameContainer}>\n        <div className={styles.icon}>{icon}</div>\n        <span className={styles.rowName}>{name}</span>\n      </div>\n      <div className={styles.time}>{time ? time : 'unknown'}</div>\n    </div>\n  );\n};\n\nexport const TimeRow = ({ docId }: { docId: string }) => {\n  const t = useI18n();\n  const manager = useContext(managerContext);\n  const workspaceService = useService(WorkspaceService);\n  const { syncing, retrying, serverClock } = useLiveData(\n    workspaceService.workspace.engine.doc.docState$(docId)\n  );\n\n  const timestampElement = useMemo(() => {\n    const formatI18nTime = (time: ConfigType) =>\n      i18nTime(time, {\n        relative: {\n          max: [1, 'day'],\n          accuracy: 'minute',\n        },\n        absolute: {\n          accuracy: 'day',\n        },\n      });\n    const localizedCreateTime = manager.createDate\n      ? formatI18nTime(manager.createDate)\n      : null;\n\n    return (\n      <>\n        <RowComponent\n          icon={<DateTimeIcon />}\n          name={t['Created']()}\n          time={\n            manager.createDate\n              ? formatI18nTime(manager.createDate)\n              : localizedCreateTime\n          }\n        />\n        {serverClock ? (\n          <RowComponent\n            icon={<HistoryIcon />}\n            name={t[!syncing && !retrying ? 'Updated' : 'com.affine.syncing']()}\n            time={!syncing && !retrying ? formatI18nTime(serverClock) : null}\n          />\n        ) : manager.updatedDate ? (\n          <RowComponent\n            icon={<HistoryIcon />}\n            name={t['Updated']()}\n            time={formatI18nTime(manager.updatedDate)}\n          />\n        ) : null}\n      </>\n    );\n  }, [\n    manager.createDate,\n    manager.updatedDate,\n    retrying,\n    serverClock,\n    syncing,\n    t,\n  ]);\n\n  const dTimestampElement = useDebouncedValue(timestampElement, 500);\n\n  return <div className={styles.container}>{dTimestampElement}</div>;\n};\n","import \"../core/src/components/affine/page-properties/info-modal/time-row.css.ts.vanilla.css!=!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/affine/page-properties/info-modal/time-row.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xcG5xcmQ1MCB7CiAgZm9udC1zaXplOiAxNnB4OwogIGNvbG9yOiB2YXIoLS1hZmZpbmUtaWNvbi1zZWNvbmRhcnkpOwogIGRpc3BsYXk6IGZsZXg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKfQouXzFwbnFyZDUxIHsKICBkaXNwbGF5OiBmbGV4OwogIGZsZXgtZGlyZWN0aW9uOiByb3c7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBnYXA6IDZweDsKICBwYWRkaW5nOiA2cHg7CiAgd2lkdGg6IDE2MHB4Owp9Ci5fMXBucXJkNTIgewogIGZsZXgtZ3JvdzogMTsKICBvdmVyZmxvdzogaGlkZGVuOwogIHRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzOwogIHdoaXRlLXNwYWNlOiBub3dyYXA7CiAgZm9udC1zaXplOiB2YXIoLS1hZmZpbmUtZm9udC1zbSk7CiAgY29sb3I6IHZhcigtLWFmZmluZS10ZXh0LXNlY29uZGFyeS1jb2xvcik7Cn0KLl8xcG5xcmQ1MyB7CiAgZGlzcGxheTogZmxleDsKICBhbGlnbi1pdGVtczogY2VudGVyOwogIHBhZGRpbmc6IDZweCA4cHg7CiAgZmxleC1ncm93OiAxOwogIGZvbnQtc2l6ZTogdmFyKC0tYWZmaW5lLWZvbnQtc20pOwp9Ci5fMXBucXJkNTQgewogIGRpc3BsYXk6IGZsZXg7CiAgZmxleC1kaXJlY3Rpb246IHJvdzsKICBhbGlnbi1pdGVtczogY2VudGVyOwogIGdhcDogNHB4Owp9Ci5fMXBucXJkNTUgewogIGRpc3BsYXk6IGZsZXg7CiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICBtYXJnaW4tdG9wOiAyMHB4OwogIG1hcmdpbi1ib3R0b206IDRweDsKfQ==\\\"}!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var container = '_1pnqrd55';\nexport var icon = '_1pnqrd50';\nexport var rowCell = '_1pnqrd54';\nexport var rowName = '_1pnqrd52';\nexport var rowNameContainer = '_1pnqrd51';\nexport var time = '_1pnqrd53';","import {\n  Divider,\n  type InlineEditHandle,\n  Modal,\n  Scrollable,\n} from '@affine/component';\nimport { DocsSearchService } from '@affine/core/modules/docs-search';\nimport {\n  LiveData,\n  useLiveData,\n  useServices,\n  WorkspaceService,\n} from '@toeverything/infra';\nimport { Suspense, useCallback, useContext, useMemo, useRef } from 'react';\n\nimport { BlocksuiteHeaderTitle } from '../../../blocksuite/block-suite-header/title';\nimport { managerContext } from '../common';\nimport {\n  PagePropertiesAddProperty,\n  PagePropertyRow,\n  SortableProperties,\n  usePagePropertiesManager,\n} from '../table';\nimport { BackLinksRow } from './back-links-row';\nimport * as styles from './info-modal.css';\nimport { TagsRow } from './tags-row';\nimport { TimeRow } from './time-row';\n\nexport const InfoModal = ({\n  open,\n  onOpenChange,\n  docId,\n}: {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  docId: string;\n}) => {\n  const { docsSearchService, workspaceService } = useServices({\n    DocsSearchService,\n    WorkspaceService,\n  });\n  const titleInputHandleRef = useRef<InlineEditHandle>(null);\n  const manager = usePagePropertiesManager(docId);\n  const handleClose = useCallback(() => {\n    onOpenChange(false);\n  }, [onOpenChange]);\n\n  const references = useLiveData(\n    useMemo(\n      () => LiveData.from(docsSearchService.watchRefsFrom(docId), null),\n      [docId, docsSearchService]\n    )\n  );\n\n  if (!manager.page || manager.readonly) {\n    return null;\n  }\n\n  return (\n    <Modal\n      contentOptions={{\n        className: styles.container,\n      }}\n      open={open}\n      onOpenChange={onOpenChange}\n      withoutCloseButton\n    >\n      <Scrollable.Root>\n        <Scrollable.Viewport\n          className={styles.viewport}\n          data-testid=\"info-modal\"\n        >\n          <div className={styles.titleContainer} data-testid=\"info-modal-title\">\n            <BlocksuiteHeaderTitle\n              className={styles.titleStyle}\n              inputHandleRef={titleInputHandleRef}\n              pageId={docId}\n              docCollection={workspaceService.workspace.docCollection}\n            />\n          </div>\n          <managerContext.Provider value={manager}>\n            <Suspense>\n              <InfoTable\n                docId={docId}\n                onClose={handleClose}\n                references={references}\n                readonly={manager.readonly}\n              />\n            </Suspense>\n          </managerContext.Provider>\n        </Scrollable.Viewport>\n        <Scrollable.Scrollbar className={styles.scrollBar} />\n      </Scrollable.Root>\n    </Modal>\n  );\n};\n\nconst InfoTable = ({\n  onClose,\n  references,\n  docId,\n  readonly,\n}: {\n  docId: string;\n  onClose: () => void;\n  readonly: boolean;\n  references:\n    | {\n        docId: string;\n        title: string;\n      }[]\n    | null;\n}) => {\n  const manager = useContext(managerContext);\n\n  return (\n    <div>\n      <TimeRow docId={docId} />\n      <Divider size=\"thinner\" />\n      {references && references.length > 0 ? (\n        <>\n          <BackLinksRow references={references} onClick={onClose} />\n          <Divider size=\"thinner\" />\n        </>\n      ) : null}\n      <TagsRow docId={docId} readonly={readonly} />\n      <SortableProperties>\n        {properties =>\n          properties.length ? (\n            <div>\n              {properties\n                .filter(\n                  property =>\n                    manager.isPropertyRequired(property.id) ||\n                    (property.visibility !== 'hide' &&\n                      !(\n                        property.visibility === 'hide-if-empty' &&\n                        !property.value\n                      ))\n                )\n                .map(property => (\n                  <PagePropertyRow\n                    key={property.id}\n                    property={property}\n                    rowNameClassName={styles.rowNameContainer}\n                  />\n                ))}\n            </div>\n          ) : null\n        }\n      </SortableProperties>\n      {manager.readonly ? null : <PagePropertiesAddProperty />}\n    </div>\n  );\n};\n","import \"../core/src/components/affine/page-properties/info-modal/info-modal.css.ts.vanilla.css!=!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/affine/page-properties/info-modal/info-modal.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xMWZxenlkMCB7CiAgbWF4LXdpZHRoOiA0ODBweDsKICBtaW4td2lkdGg6IDM2MHB4OwogIHBhZGRpbmc6IDIwcHggMDsKICBhbGlnbi1zZWxmOiBzdGFydDsKICBtYXJnaW4tdG9wOiAxMjBweDsKfQouXzExZnF6eWQxIHsKICBkaXNwbGF5OiBmbGV4OwogIHdpZHRoOiAxMDAlOwogIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47Cn0KLl8xMWZxenlkMiB7CiAgZm9udC1zaXplOiB2YXIoLS1hZmZpbmUtZm9udC1oLTYpOwogIGZvbnQtd2VpZ2h0OiA2MDA7Cn0KLl8xMWZxenlkMyB7CiAgZGlzcGxheTogZmxleDsKICBmbGV4LWRpcmVjdGlvbjogcm93OwogIGdhcDogNnB4OwogIHBhZGRpbmc6IDZweDsKICB3aWR0aDogMTYwcHg7Cn0KLl8xMWZxenlkNCB7CiAgbWF4LWhlaWdodDogY2FsYygxMDB2aCAtIDIyMHB4KTsKICBwYWRkaW5nOiAwIDI0cHg7Cn0KLl8xMWZxenlkNSB7CiAgd2lkdGg6IDZweDsKICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoLTRweCk7Cn0KLl8xMWZxenlkNiB7CiAgd2lkdGg6IDA7CiAgaGVpZ2h0OiAwOwogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKfQ==\\\"}!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var container = '_11fqzyd0';\nexport var hiddenInput = '_11fqzyd6';\nexport var rowNameContainer = '_11fqzyd3';\nexport var scrollBar = '_11fqzyd5';\nexport var titleContainer = '_11fqzyd1';\nexport var titleStyle = '_11fqzyd2';\nexport var viewport = '_11fqzyd4';","import { Menu, Scrollable } from '@affine/component';\nimport { useI18n } from '@affine/i18n';\nimport { chunk } from 'lodash-es';\nimport { useEffect, useRef } from 'react';\n\nimport type { PagePropertyIcon } from './icons-mapping';\nimport { iconNames, nameToIcon } from './icons-mapping';\nimport * as styles from './icons-selector.css';\n\nconst iconsPerRow = 6;\n\nconst iconRows = chunk(iconNames, iconsPerRow);\n\nexport const IconsSelectorPanel = ({\n  selected,\n  onSelectedChange,\n}: {\n  selected: PagePropertyIcon;\n  onSelectedChange: (icon: PagePropertyIcon) => void;\n}) => {\n  const ref = useRef<HTMLDivElement>(null);\n  useEffect(() => {\n    if (!ref.current) {\n      return;\n    }\n    const iconButton = ref.current.querySelector(\n      `[data-name=\"${selected}\"]`\n    ) as HTMLDivElement;\n    if (!iconButton) {\n      return;\n    }\n    iconButton.scrollIntoView({ block: 'center' });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  const t = useI18n();\n  return (\n    <Scrollable.Root>\n      <div role=\"heading\" className={styles.menuHeader}>\n        {t['com.affine.page-properties.icons']()}\n      </div>\n      <Scrollable.Viewport className={styles.iconsContainerScrollable}>\n        <div className={styles.iconsContainer} ref={ref}>\n          {iconRows.map((iconRow, index) => {\n            return (\n              <div key={index} className={styles.iconsRow}>\n                {iconRow.map(iconName => {\n                  const Icon = nameToIcon(iconName);\n                  return (\n                    <div\n                      onClick={() => onSelectedChange(iconName)}\n                      key={iconName}\n                      className={styles.iconButton}\n                      data-name={iconName}\n                      data-active={selected === iconName}\n                    >\n                      <Icon key={iconName} />\n                    </div>\n                  );\n                })}\n              </div>\n            );\n          })}\n        </div>\n        <Scrollable.Scrollbar className={styles.iconsContainerScroller} />\n      </Scrollable.Viewport>\n    </Scrollable.Root>\n  );\n};\n\nexport const IconsSelectorButton = ({\n  selected,\n  onSelectedChange,\n}: {\n  selected: PagePropertyIcon;\n  onSelectedChange: (icon: PagePropertyIcon) => void;\n}) => {\n  const Icon = nameToIcon(selected);\n  return (\n    <Menu\n      items={\n        <IconsSelectorPanel\n          selected={selected}\n          onSelectedChange={onSelectedChange}\n        />\n      }\n    >\n      <div className={styles.iconSelectorButton}>\n        <Icon />\n      </div>\n    </Menu>\n  );\n};\n","import \"../core/src/components/affine/page-properties/icons-selector.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/affine/page-properties/icons-selector.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACq2U0W6rMAyG73kKX24XqShrpyrV3uNIR9OUJQG8QRIloU037d2PCFAogrNd7Apimz/2Z+PNyzacQ3lSKXwmAAKdqdiFQl7JcEwgPolAK7lHrShwXTW1aj0FMxQyE47JV7IZVLY/U7H63JpZhYUi6GXtKHCpvLStmetKWwonZu8IYXmOShLkWpHouI+CWnni8EPOwjp7PcacJRalp7BP09ZmmBCoCgopPJpwLeMwKyNbLmMl37fGecwvhGvlpfJT1yTPLO0ufNVWSEssE9g4CrvOekbhSwrZoTuWfdrDmTfWtUyMxkHaW6YcdjxfGX8vrG6U6BhBusncbUW01CdpY13z6BnDGHhlPdX4K5hnhHGPJ/nkbSOfo96SiLFYM3tZknmIH/23gyXZ36+z+oW+9LgfslvcwznOqystqncK6ZgJha0J4HSF4jbrPtFxQEfGs/om8J3kWokppYVGT8H9vIcTt5fW40ordlGrZoGMBNIVyGubYCK3j3JxMHNta9q9VszLP3c7E27vfvyNVTH+vd9MVHCrO2GJn5fBL/bnukAOJsC2H5caFRl+4LTnFxUmKBpjpOXMyWPy9Q8duEt2dQUAAA==\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var iconButton = '_1xwxhvn2';\nexport var iconSelectorButton = '_1xwxhvn3';\nexport var iconsContainer = '_1xwxhvn0';\nexport var iconsContainerScrollable = '_1xwxhvn4';\nexport var iconsContainerScroller = '_1xwxhvn5';\nexport var iconsRow = '_1xwxhvn1';\nexport var menuHeader = '_1xwxhvn6';","import type { MenuItemProps } from '@affine/component';\nimport {\n  Input,\n  MenuIcon,\n  MenuItem,\n  MenuSeparator,\n  Scrollable,\n} from '@affine/component';\nimport type { PageInfoCustomPropertyMeta } from '@affine/core/modules/properties/services/schema';\nimport { useI18n } from '@affine/i18n';\nimport type { KeyboardEventHandler, MouseEventHandler } from 'react';\nimport { cloneElement, isValidElement, useCallback } from 'react';\n\nimport type { PagePropertyIcon } from './icons-mapping';\nimport {\n  getDefaultIconName,\n  getSafeIconName,\n  nameToIcon,\n} from './icons-mapping';\nimport { IconsSelectorButton } from './icons-selector';\nimport * as styles from './styles.css';\nexport type MenuItemOption =\n  | React.ReactElement\n  | '-'\n  | {\n      text: string;\n      onClick: MouseEventHandler;\n      key?: string;\n      icon?: React.ReactElement;\n      selected?: boolean;\n      checked?: boolean;\n      type?: MenuItemProps['type'];\n    }\n  | MenuItemOption[];\n\nconst isElementOption = (e: MenuItemOption): e is React.ReactElement => {\n  return isValidElement(e);\n};\n\nexport const renderMenuItemOptions = (options: MenuItemOption[]) => {\n  return options.map((option, index) => {\n    if (option === '-') {\n      return <MenuSeparator key={index} />;\n    } else if (isElementOption(option)) {\n      return cloneElement(option, { key: index });\n    } else if (Array.isArray(option)) {\n      // this is an area that needs scrollbar\n      return (\n        <Scrollable.Root key={index} className={styles.menuItemListScrollable}>\n          <Scrollable.Viewport className={styles.menuItemList}>\n            {renderMenuItemOptions(option)}\n            <Scrollable.Scrollbar className={styles.menuItemListScrollbar} />\n          </Scrollable.Viewport>\n        </Scrollable.Root>\n      );\n    } else {\n      const { text, icon, onClick, type, key, checked, selected } = option;\n      return (\n        <MenuItem\n          key={key ?? index}\n          type={type}\n          selected={selected}\n          checked={checked}\n          preFix={icon ? <MenuIcon>{icon}</MenuIcon> : null}\n          onClick={onClick}\n        >\n          {text}\n        </MenuItem>\n      );\n    }\n  });\n};\n\nexport const EditPropertyNameMenuItem = ({\n  property,\n  onNameBlur: onBlur,\n  onNameChange,\n  onIconChange,\n}: {\n  onNameBlur: (e: string) => void;\n  onNameChange: (e: string) => void;\n  onIconChange: (icon: PagePropertyIcon) => void;\n  property: PageInfoCustomPropertyMeta;\n}) => {\n  const iconName = getSafeIconName(property.icon, property.type);\n  const onKeyDown: KeyboardEventHandler<HTMLInputElement> = useCallback(\n    e => {\n      if (e.key !== 'Escape') {\n        e.stopPropagation();\n      }\n      if (e.key === 'Enter') {\n        e.preventDefault();\n        onBlur(e.currentTarget.value);\n      }\n    },\n    [onBlur]\n  );\n  const handleBlur = useCallback(\n    (e: FocusEvent & { currentTarget: HTMLInputElement }) => {\n      onBlur(e.currentTarget.value);\n    },\n    [onBlur]\n  );\n\n  const t = useI18n();\n  return (\n    <div className={styles.propertyRowNamePopupRow}>\n      <IconsSelectorButton\n        selected={iconName}\n        onSelectedChange={onIconChange}\n      />\n      <Input\n        defaultValue={property.name}\n        onBlur={handleBlur}\n        onChange={onNameChange}\n        placeholder={t['unnamed']()}\n        onKeyDown={onKeyDown}\n      />\n    </div>\n  );\n};\n\nexport const PropertyTypeMenuItem = ({\n  property,\n}: {\n  property: PageInfoCustomPropertyMeta;\n}) => {\n  const Icon = nameToIcon(getDefaultIconName(property.type), property.type);\n  const t = useI18n();\n  return (\n    <div className={styles.propertyRowTypeItem}>\n      {t['com.affine.page-properties.create-property.menu.header']()}\n      <div className={styles.propertyTypeName}>\n        <Icon />\n        {t[`com.affine.page-properties.property.${property.type}`]()}\n      </div>\n    </div>\n  );\n};\n","/* eslint-disable @typescript-eslint/no-non-null-assertion */\nimport type { WorkspacePropertiesAdapter } from '@affine/core/modules/properties';\nimport type {\n  PageInfoCustomProperty,\n  PageInfoCustomPropertyMeta,\n} from '@affine/core/modules/properties/services/schema';\nimport { PagePropertyType } from '@affine/core/modules/properties/services/schema';\nimport { createFractionalIndexingSortableHelper } from '@affine/core/utils';\nimport { DebugLogger } from '@affine/debug';\nimport { nanoid } from 'nanoid';\n\nimport { getDefaultIconName } from './icons-mapping';\n\nconst logger = new DebugLogger('PagePropertiesManager');\n\nfunction validatePropertyValue(type: PagePropertyType, value: any) {\n  switch (type) {\n    case PagePropertyType.Text:\n      return typeof value === 'string';\n    case PagePropertyType.Number:\n      return typeof value === 'number' || !isNaN(+value);\n    case PagePropertyType.Checkbox:\n      return typeof value === 'boolean';\n    case PagePropertyType.Date:\n      return value.match(/^\\d{4}-\\d{2}-\\d{2}$/);\n    case PagePropertyType.Tags:\n      return Array.isArray(value) && value.every(v => typeof v === 'string');\n    default:\n      return false;\n  }\n}\n\nexport const newPropertyTypes: PagePropertyType[] = [\n  PagePropertyType.Text,\n  PagePropertyType.Number,\n  PagePropertyType.Checkbox,\n  PagePropertyType.Date,\n  // TODO(@Peng): add more\n];\n\nexport class PagePropertiesMetaManager {\n  constructor(private readonly adapter: WorkspacePropertiesAdapter) {}\n\n  get propertiesSchema() {\n    return this.adapter.schema?.pageProperties ?? {};\n  }\n\n  get systemPropertiesSchema() {\n    return this.adapter.schema?.pageProperties.system ?? {};\n  }\n\n  get customPropertiesSchema() {\n    return this.adapter.schema?.pageProperties.custom ?? {};\n  }\n\n  getOrderedPropertiesSchema() {\n    return Object.values(this.customPropertiesSchema).sort(\n      (a, b) => a.order - b.order\n    );\n  }\n\n  checkPropertyExists(id: string) {\n    return !!this.customPropertiesSchema[id];\n  }\n\n  validatePropertyValue(id: string, value?: any) {\n    if (!value) {\n      // value is optional in all cases?\n      return true;\n    }\n    const type = this.customPropertiesSchema[id]?.type;\n    if (!type) {\n      logger.warn(`property ${id} not found`);\n      return false;\n    }\n    return validatePropertyValue(type, value);\n  }\n\n  addPropertyMeta(schema: {\n    name: string;\n    type: PagePropertyType;\n    icon?: string;\n  }) {\n    const id = nanoid();\n    const { type, icon } = schema;\n    const newOrder =\n      Math.max(\n        0,\n        ...Object.values(this.customPropertiesSchema).map(p => p.order)\n      ) + 1;\n    const property = {\n      ...schema,\n      id,\n      source: 'custom',\n      type,\n      order: newOrder,\n      icon: icon ?? getDefaultIconName(type),\n    } as const;\n    this.customPropertiesSchema[id] = property;\n    return property;\n  }\n\n  updatePropertyMeta(id: string, opt: Partial<PageInfoCustomPropertyMeta>) {\n    if (!this.checkPropertyExists(id)) {\n      logger.warn(`property ${id} not found`);\n      return;\n    }\n    Object.assign(this.customPropertiesSchema[id], opt);\n  }\n\n  isPropertyRequired(id: string) {\n    return this.customPropertiesSchema[id]?.required;\n  }\n\n  removePropertyMeta(id: string) {\n    // should warn if the property is in use\n    delete this.customPropertiesSchema[id];\n  }\n\n  // returns page schema properties -> related page\n  getPropertyStatistics() {\n    const mapping = new Map<string, Set<string>>();\n    for (const page of this.adapter.workspace.docCollection.docs.values()) {\n      const properties = this.adapter.getPageProperties(page.id);\n      if (properties) {\n        for (const id of Object.keys(properties.custom)) {\n          if (!mapping.has(id)) mapping.set(id, new Set());\n          mapping.get(id)?.add(page.id);\n        }\n      }\n    }\n    return mapping;\n  }\n\n  getPropertyRelatedPages(id: string) {\n    return this.getPropertyStatistics().get(id);\n  }\n}\n\nexport class PagePropertiesManager {\n  public readonly metaManager: PagePropertiesMetaManager;\n  constructor(\n    private readonly adapter: WorkspacePropertiesAdapter,\n    public readonly pageId: string\n  ) {\n    this.metaManager = new PagePropertiesMetaManager(this.adapter);\n    this.ensureRequiredProperties();\n  }\n\n  readonly sorter = createFractionalIndexingSortableHelper<\n    PageInfoCustomProperty,\n    string | number\n  >(this);\n\n  // prevent infinite loop\n  private ensuring = false;\n  ensureRequiredProperties() {\n    this.adapter.ensurePageProperties(this.pageId);\n    if (this.ensuring) return;\n    this.ensuring = true;\n    this.transact(() => {\n      this.metaManager.getOrderedPropertiesSchema().forEach(property => {\n        if (property.required && !this.hasCustomProperty(property.id)) {\n          this.addCustomProperty(property.id);\n        }\n      });\n    });\n    this.ensuring = false;\n  }\n\n  getItems() {\n    return Object.values(this.getCustomProperties());\n  }\n\n  getItemOrder(item: PageInfoCustomProperty): string {\n    return item.order;\n  }\n\n  setItemOrder(item: PageInfoCustomProperty, order: string) {\n    item.order = order;\n  }\n\n  getItemId(item: PageInfoCustomProperty) {\n    return item.id;\n  }\n\n  get workspace() {\n    return this.adapter.workspace;\n  }\n\n  get page() {\n    return this.adapter.workspace.docCollection.getDoc(this.pageId);\n  }\n\n  get intrinsicMeta() {\n    return this.page?.meta;\n  }\n\n  get updatedDate() {\n    return this.intrinsicMeta?.updatedDate;\n  }\n\n  get createDate() {\n    return this.intrinsicMeta?.createDate;\n  }\n\n  get properties() {\n    return this.adapter.getPageProperties(this.pageId);\n  }\n\n  get readonly() {\n    return !!this.page?.readonly;\n  }\n\n  /**\n   * get custom properties (filter out properties that are not in schema)\n   */\n  getCustomProperties(): Record<string, PageInfoCustomProperty> {\n    return this.properties\n      ? Object.fromEntries(\n          Object.entries(this.properties.custom).filter(([id]) =>\n            this.metaManager.checkPropertyExists(id)\n          )\n        )\n      : {};\n  }\n\n  getCustomPropertyMeta(id: string): PageInfoCustomPropertyMeta | undefined {\n    return this.metaManager.customPropertiesSchema[id];\n  }\n\n  getCustomProperty(id: string) {\n    return this.properties?.custom[id];\n  }\n\n  addCustomProperty(id: string, value?: any) {\n    this.ensureRequiredProperties();\n    if (!this.metaManager.checkPropertyExists(id)) {\n      logger.warn(`property ${id} not found`);\n      return;\n    }\n\n    if (!this.metaManager.validatePropertyValue(id, value)) {\n      logger.warn(`property ${id} value ${value} is invalid`);\n      return;\n    }\n\n    const newOrder = this.sorter.getNewItemOrder();\n    if (this.properties!.custom[id]) {\n      logger.warn(`custom property ${id} already exists`);\n    }\n\n    this.properties!.custom[id] = {\n      id,\n      value,\n      order: newOrder,\n      visibility: 'visible',\n    };\n  }\n\n  hasCustomProperty(id: string) {\n    return !!this.properties?.custom[id];\n  }\n\n  removeCustomProperty(id: string) {\n    this.ensureRequiredProperties();\n    delete this.properties!.custom[id];\n  }\n\n  updateCustomProperty(id: string, opt: Partial<PageInfoCustomProperty>) {\n    this.ensureRequiredProperties();\n    if (!this.properties?.custom[id]) {\n      logger.warn(`custom property ${id} not found`);\n      return;\n    }\n    if (\n      opt.value !== undefined &&\n      !this.metaManager.validatePropertyValue(id, opt.value)\n    ) {\n      logger.warn(`property ${id} value ${opt.value} is invalid`);\n      return;\n    }\n    Object.assign(this.properties.custom[id], opt);\n  }\n\n  get updateCustomPropertyMeta() {\n    return this.metaManager.updatePropertyMeta.bind(this.metaManager);\n  }\n\n  get isPropertyRequired() {\n    return this.metaManager.isPropertyRequired.bind(this.metaManager);\n  }\n\n  transact = this.adapter.transact;\n}\n","import \"../core/src/components/affine/reference-link/styles.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/affine/reference-link/styles.css.ts.vanilla.css\\\",\\\"source\\\":\\\"LmZsMTl6MjAgewogIHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7CiAgZm9udC1zaXplOiAxLjFlbTsKICB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgycHgsIC0xcHgpOwp9Ci5mbDE5ejIxIHsKICB0ZXh0LWRlY29yYXRpb246IG5vbmU7CiAgY29sb3I6IGluaGVyaXQ7CiAgd29yZC1icmVhazogYnJlYWstYWxsOwp9\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var pageReferenceIcon = 'fl19z20';\nexport var pageReferenceLink = 'fl19z21';","import { useDocMetaHelper } from '@affine/core/hooks/use-block-suite-page-meta';\nimport { useJournalHelper } from '@affine/core/hooks/use-journal';\nimport {\n  PeekViewService,\n  useInsidePeekView,\n} from '@affine/core/modules/peek-view';\nimport { WorkbenchLink } from '@affine/core/modules/workbench';\nimport { useI18n } from '@affine/i18n';\nimport {\n  DeleteIcon,\n  LinkedEdgelessIcon,\n  LinkedPageIcon,\n  TodayIcon,\n} from '@blocksuite/icons/rc';\nimport type { DocCollection } from '@blocksuite/store';\nimport {\n  type DocMode,\n  DocsService,\n  LiveData,\n  useLiveData,\n  useService,\n} from '@toeverything/infra';\nimport { type PropsWithChildren, useCallback, useRef } from 'react';\n\nimport * as styles from './styles.css';\n\nexport interface PageReferenceRendererOptions {\n  docMode: DocMode | null;\n  pageId: string;\n  docCollection: DocCollection;\n  pageMetaHelper: ReturnType<typeof useDocMetaHelper>;\n  journalHelper: ReturnType<typeof useJournalHelper>;\n  t: ReturnType<typeof useI18n>;\n}\n// use a function to be rendered in the lit renderer\nexport function pageReferenceRenderer({\n  docMode,\n  pageId,\n  pageMetaHelper,\n  journalHelper,\n  t,\n}: PageReferenceRendererOptions) {\n  const { isPageJournal, getLocalizedJournalDateString } = journalHelper;\n  const referencedPage = pageMetaHelper.getDocMeta(pageId);\n  let title =\n    referencedPage?.title ?? t['com.affine.editor.reference-not-found']();\n\n  let icon = !referencedPage ? (\n    <DeleteIcon className={styles.pageReferenceIcon} />\n  ) : docMode === 'page' || docMode === null ? (\n    <LinkedPageIcon className={styles.pageReferenceIcon} />\n  ) : (\n    <LinkedEdgelessIcon className={styles.pageReferenceIcon} />\n  );\n\n  const isJournal = isPageJournal(pageId);\n  const localizedJournalDate = getLocalizedJournalDateString(pageId);\n  if (isJournal && localizedJournalDate) {\n    title = localizedJournalDate;\n    icon = <TodayIcon className={styles.pageReferenceIcon} />;\n  }\n\n  return (\n    <>\n      {icon}\n      <span className=\"affine-reference-title\">\n        {title ? title : t['Untitled']()}\n      </span>\n    </>\n  );\n}\n\nexport function AffinePageReference({\n  pageId,\n  docCollection,\n  wrapper: Wrapper,\n}: {\n  docCollection: DocCollection;\n  pageId: string;\n  wrapper?: React.ComponentType<PropsWithChildren>;\n}) {\n  const pageMetaHelper = useDocMetaHelper(docCollection);\n  const journalHelper = useJournalHelper(docCollection);\n  const t = useI18n();\n\n  const docsService = useService(DocsService);\n  const mode$ = LiveData.from(docsService.list.observeMode(pageId), undefined);\n  const docMode = useLiveData(mode$) ?? null;\n  const el = pageReferenceRenderer({\n    docMode,\n    pageId,\n    pageMetaHelper,\n    journalHelper,\n    docCollection,\n    t,\n  });\n\n  const ref = useRef<HTMLAnchorElement>(null);\n\n  const peekView = useService(PeekViewService).peekView;\n  const isInPeekView = useInsidePeekView();\n\n  const onClick = useCallback(\n    (e: React.MouseEvent) => {\n      if (e.shiftKey && ref.current) {\n        e.preventDefault();\n        e.stopPropagation();\n        peekView.open(ref.current).catch(console.error);\n      }\n      if (isInPeekView) {\n        peekView.close();\n      }\n      return;\n    },\n    [isInPeekView, peekView]\n  );\n\n  return (\n    <WorkbenchLink\n      ref={ref}\n      to={`/${pageId}`}\n      onClick={onClick}\n      className={styles.pageReferenceLink}\n    >\n      {Wrapper ? <Wrapper>{el}</Wrapper> : el}\n    </WorkbenchLink>\n  );\n}\n","import type { ConfirmModalProps } from '@affine/component/ui/modal';\nimport { ConfirmModal } from '@affine/component/ui/modal';\nimport { useI18n } from '@affine/i18n';\nimport { useMemo } from 'react';\n\ntype SignOutConfirmModalI18NKeys =\n  | 'title'\n  | 'description'\n  | 'cancel'\n  | 'confirm';\n\nexport const SignOutModal = ({ ...props }: ConfirmModalProps) => {\n  const { title, description, cancelText, confirmText } = props;\n  const t = useI18n();\n\n  const defaultTexts = useMemo(() => {\n    const getDefaultText = (key: SignOutConfirmModalI18NKeys) => {\n      return t[`com.affine.auth.sign-out.confirm-modal.${key}`]();\n    };\n    return {\n      title: getDefaultText('title'),\n      description: getDefaultText('description'),\n      cancelText: getDefaultText('cancel'),\n      children: getDefaultText('confirm'),\n    };\n  }, [t]);\n\n  return (\n    <ConfirmModal\n      title={title ?? defaultTexts.title}\n      description={description ?? defaultTexts.description}\n      cancelText={cancelText ?? defaultTexts.cancelText}\n      confirmText={confirmText ?? defaultTexts.children}\n      confirmButtonOptions={{\n        variant: 'error',\n        ['data-testid' as string]: 'confirm-sign-out-button',\n      }}\n      contentOptions={{\n        ['data-testid' as string]: 'confirm-sign-out-modal',\n      }}\n      {...props}\n    />\n  );\n};\n","import { atom } from 'jotai';\nimport { atomWithStorage } from 'jotai/utils';\n\nexport const APP_SIDEBAR_OPEN = 'app-sidebar-open';\nexport const isMobile = window.innerWidth < 768 && !environment.isDesktop;\n\nexport const appSidebarOpenAtom = atomWithStorage(APP_SIDEBAR_OPEN, !isMobile);\nexport const appSidebarFloatingAtom = atom(isMobile);\n\nexport const appSidebarResizingAtom = atom(false);\nexport const appSidebarWidthAtom = atomWithStorage(\n  'app-sidebar-width',\n  248 /* px */\n);\n","import \"../core/src/components/app-sidebar/index.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/app-sidebar/index.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACpVUS27bMBDd+xSDAAWSBQ3Jjo2CRoDeo+iCFkfyxBRJkGNbbuG7F6SkWKmaANmJn/eZeRwtu1e/qVcF/FkAeKU12UbsHbNrJXz33W5xWyyHOz+1YiUOKoq9CxrDC4cT/srIfkMEag4soVhufAfRGdJwVuFRCFXXZHHAicoZF57m1BRFbZxiss3LQyJ/GNhVdWyCO1ndQ+U/rPdjH6hV4TpXKDPRhTQfJKxXqTCAA/Z+x3VtsBPxEMgeJRQT9CqjNUVv1FXme+m+MtRYQYxtlFChZQxpu3Lm1FrRKD9SvxGt+z67SEzOSghoFNMZd3dzZVF8m5ob1zP17FZTwKrn6mUnYs9ZLF2TUEAB6sRuyrwZyh5il1D4DsptvzmTez1Fpjq11jJalhC9qlDskS+I9pN2iAvuj8RCeS8CNtmrDqqZON1MnJZQzpxWylSPqREgsuunLzUEILhLH8fzuzS2WZaDsmMezquK+ArLchMTcFjn15Byo1SUwDNajhKss7h7l2dNHeq0xc4PIIM1D5/hfaLjmOWz+yP++HW3Tiszf9vbfnqcRzuOzefz9FZV+b+qxuaPw5y+fwuyOqWzTro/WtSkwAeynAmX07/IJJmxQRMCkTVvd9D2I9BtcfsLIP2FEJ4EAAA=\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var floatingMaxWidth = 768;\nexport var navBodyStyle = 'xjp5f25';\nexport var navHeaderButton = 'xjp5f21';\nexport var navHeaderNavigationButtons = 'xjp5f22';\nexport var navHeaderStyle = 'xjp5f24';\nexport var navStyle = 'xjp5f23';\nexport var navWrapperStyle = 'xjp5f20';\nexport var sidebarFloatMaskStyle = 'xjp5f26';","import { useAtomValue } from 'jotai';\n\nimport { navHeaderStyle } from '../index.css';\nimport { appSidebarOpenAtom } from '../index.jotai';\nimport { SidebarSwitch } from './sidebar-switch';\n\nexport const SidebarHeader = () => {\n  const open = useAtomValue(appSidebarOpenAtom);\n\n  return (\n    <div className={navHeaderStyle} data-open={open}>\n      <SidebarSwitch show={open} />\n    </div>\n  );\n};\n\nexport * from './sidebar-switch';\n","import { IconButton } from '@affine/component';\nimport { useI18n } from '@affine/i18n';\nimport { PlusIcon } from '@blocksuite/icons/rc';\nimport clsx from 'clsx';\nimport type React from 'react';\nimport type { MouseEventHandler } from 'react';\n\nimport * as styles from './index.css';\n\ninterface AddPageButtonProps {\n  onClick?: MouseEventHandler;\n  className?: string;\n  style?: React.CSSProperties;\n}\n\nconst sideBottom = { side: 'bottom' as const };\nexport function AddPageButton({\n  onClick,\n  className,\n  style,\n}: AddPageButtonProps) {\n  const t = useI18n();\n\n  return (\n    <IconButton\n      tooltip={t['New Page']()}\n      tooltipOptions={sideBottom}\n      data-testid=\"sidebar-new-page-button\"\n      style={style}\n      className={clsx([styles.root, className])}\n      onClick={onClick}\n      onAuxClick={onClick}\n    >\n      <PlusIcon />\n    </IconButton>\n  );\n}\n","import \"../core/src/components/app-sidebar/add-page-button/index.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/app-sidebar/add-page-button/index.css.ts.vanilla.css\\\",\\\"source\\\":\\\"LmFnaWxidzAgewogIHdpZHRoOiAzMnB4OwogIGhlaWdodDogMzJweDsKICBib3JkZXItcmFkaXVzOiA4cHg7CiAgYm94LXNoYWRvdzogMHB4IDFweCAycHggMHB4IHJnYmEoMCwgMCwgMCwgMC4xNSk7CiAgYm9yZGVyLXdpZHRoOiAxcHg7CiAgYm9yZGVyLWNvbG9yOiB2YXIoLS1hZmZpbmUtbGF5ZXItYm9yZGVyKTsKICBiYWNrZ3JvdW5kOiB2YXIoLS1hZmZpbmUtYnV0dG9uLXNpZGVyYmFyUHJpbWFyeS1iYWNrZ3JvdW5kKTsKfQ==\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var root = 'agilbw0';","import { Tooltip } from '@affine/component';\nimport { useCatchEventCallback } from '@affine/core/hooks/use-catch-event-hook';\nimport { popupWindow } from '@affine/core/utils';\nimport { Unreachable } from '@affine/env/constant';\nimport { useI18n } from '@affine/i18n';\nimport { CloseIcon, NewIcon, ResetIcon } from '@blocksuite/icons/rc';\nimport clsx from 'clsx';\nimport { useCallback, useMemo } from 'react';\n\nimport * as styles from './index.css';\n\nexport interface AddPageButtonProps {\n  onQuitAndInstall: () => void;\n  onDownloadUpdate: () => void;\n  onDismissChangelog: () => void;\n  onOpenChangelog: () => void;\n  changelogUnread: boolean;\n  updateReady: boolean;\n  updateAvailable: {\n    version: string;\n    allowAutoUpdate: boolean;\n  } | null;\n  autoDownload: boolean;\n  downloadProgress: number | null;\n  appQuitting: boolean;\n  className?: string;\n  style?: React.CSSProperties;\n}\n\ninterface ButtonContentProps {\n  updateReady: boolean;\n  updateAvailable: {\n    version: string;\n    allowAutoUpdate: boolean;\n  } | null;\n  autoDownload: boolean;\n  downloadProgress: number | null;\n  appQuitting: boolean;\n  changelogUnread: boolean;\n  onDismissChangelog: () => void;\n}\n\nfunction DownloadUpdate({ updateAvailable }: ButtonContentProps) {\n  const t = useI18n();\n  return (\n    <div className={styles.installLabel}>\n      <span className={styles.ellipsisTextOverflow}>\n        {t['com.affine.appUpdater.downloadUpdate']()}\n      </span>\n      <span className={styles.versionLabel}>{updateAvailable?.version}</span>\n    </div>\n  );\n}\n\nfunction UpdateReady({ updateAvailable, appQuitting }: ButtonContentProps) {\n  const t = useI18n();\n  return (\n    <div className={styles.updateAvailableWrapper}>\n      <div className={styles.installLabelNormal}>\n        <span className={styles.ellipsisTextOverflow}>\n          {t['com.affine.appUpdater.updateAvailable']()}\n        </span>\n        <span className={styles.versionLabel}>{updateAvailable?.version}</span>\n      </div>\n\n      <div className={styles.installLabelHover}>\n        <ResetIcon className={styles.icon} />\n        <span className={styles.ellipsisTextOverflow}>\n          {t[appQuitting ? 'Loading' : 'com.affine.appUpdater.installUpdate']()}\n        </span>\n      </div>\n    </div>\n  );\n}\n\nfunction DownloadingUpdate({\n  updateAvailable,\n  downloadProgress,\n}: ButtonContentProps) {\n  const t = useI18n();\n  return (\n    <div className={clsx([styles.updateAvailableWrapper])}>\n      <div className={clsx([styles.installLabelNormal])}>\n        <span className={styles.ellipsisTextOverflow}>\n          {t['com.affine.appUpdater.downloading']()}\n        </span>\n        <span className={styles.versionLabel}>{updateAvailable?.version}</span>\n      </div>\n\n      <div className={styles.progress}>\n        <div\n          className={styles.progressInner}\n          style={{ width: `${downloadProgress}%` }}\n        />\n      </div>\n    </div>\n  );\n}\n\nfunction OpenDownloadPage({ updateAvailable }: ButtonContentProps) {\n  const t = useI18n();\n  return (\n    <>\n      <div className={styles.installLabelNormal}>\n        <span className={styles.ellipsisTextOverflow}>\n          {t['com.affine.appUpdater.updateAvailable']()}\n        </span>\n        <span className={styles.versionLabel}>{updateAvailable?.version}</span>\n      </div>\n\n      <div className={styles.installLabelHover}>\n        <span className={styles.ellipsisTextOverflow}>\n          {t['com.affine.appUpdater.openDownloadPage']()}\n        </span>\n      </div>\n    </>\n  );\n}\n\nfunction WhatsNew({ onDismissChangelog }: ButtonContentProps) {\n  const t = useI18n();\n  const onClickClose = useCatchEventCallback(() => {\n    onDismissChangelog();\n  }, [onDismissChangelog]);\n  return (\n    <>\n      <div className={clsx([styles.whatsNewLabel])}>\n        <NewIcon className={styles.icon} />\n        <span className={styles.ellipsisTextOverflow}>\n          {t['com.affine.appUpdater.whatsNew']()}\n        </span>\n      </div>\n      <div className={styles.closeIcon} onClick={onClickClose}>\n        <CloseIcon />\n      </div>\n    </>\n  );\n}\n\nconst getButtonContentRenderer = (props: ButtonContentProps) => {\n  if (props.updateReady) {\n    return UpdateReady;\n  } else if (props.updateAvailable?.allowAutoUpdate) {\n    if (props.autoDownload && props.updateAvailable.allowAutoUpdate) {\n      return DownloadingUpdate;\n    } else {\n      return DownloadUpdate;\n    }\n  } else if (props.updateAvailable && !props.updateAvailable?.allowAutoUpdate) {\n    return OpenDownloadPage;\n  } else if (props.changelogUnread) {\n    return WhatsNew;\n  }\n  return null;\n};\n\nexport function AppUpdaterButton({\n  updateReady,\n  changelogUnread,\n  onDismissChangelog,\n  onDownloadUpdate,\n  onQuitAndInstall,\n  onOpenChangelog,\n  updateAvailable,\n  autoDownload,\n  downloadProgress,\n  appQuitting,\n  className,\n  style,\n}: AddPageButtonProps) {\n  const handleClick = useCallback(() => {\n    if (updateReady) {\n      onQuitAndInstall();\n    } else if (updateAvailable) {\n      if (updateAvailable.allowAutoUpdate) {\n        if (autoDownload) {\n          // wait for download to finish\n        } else {\n          onDownloadUpdate();\n        }\n      } else {\n        popupWindow(\n          `https://github.com/toeverything/AFFiNE/releases/tag/v${updateAvailable.version}`\n        );\n      }\n    } else if (changelogUnread) {\n      onOpenChangelog();\n    } else {\n      throw new Unreachable();\n    }\n  }, [\n    updateReady,\n    updateAvailable,\n    changelogUnread,\n    onQuitAndInstall,\n    autoDownload,\n    onDownloadUpdate,\n    onOpenChangelog,\n  ]);\n\n  const contentProps = useMemo(\n    () => ({\n      updateReady,\n      updateAvailable,\n      changelogUnread,\n      autoDownload,\n      downloadProgress,\n      appQuitting,\n      onDismissChangelog,\n    }),\n    [\n      updateReady,\n      updateAvailable,\n      changelogUnread,\n      autoDownload,\n      downloadProgress,\n      appQuitting,\n      onDismissChangelog,\n    ]\n  );\n\n  const ContentComponent = getButtonContentRenderer(contentProps);\n\n  const wrapWithTooltip = (\n    node: React.ReactElement,\n    tooltip?: React.ReactElement | string\n  ) => {\n    if (!tooltip) {\n      return node;\n    }\n\n    return (\n      <Tooltip content={tooltip} side=\"top\">\n        {node}\n      </Tooltip>\n    );\n  };\n\n  const disabled = useMemo(() => {\n    if (appQuitting) {\n      return true;\n    }\n\n    if (updateAvailable?.allowAutoUpdate) {\n      return !updateReady && autoDownload;\n    }\n\n    return false;\n  }, [\n    appQuitting,\n    autoDownload,\n    updateAvailable?.allowAutoUpdate,\n    updateReady,\n  ]);\n\n  if (!updateAvailable && !changelogUnread) {\n    return null;\n  }\n\n  return wrapWithTooltip(\n    <button\n      style={style}\n      className={clsx([styles.root, className])}\n      data-has-update={!!updateAvailable}\n      data-updating={appQuitting}\n      data-disabled={disabled}\n      onClick={handleClick}\n    >\n      {ContentComponent ? <ContentComponent {...contentProps} /> : null}\n      <div className={styles.particles} aria-hidden=\"true\"></div>\n      <span className={styles.halo} aria-hidden=\"true\"></span>\n    </button>,\n    updateAvailable?.version\n  );\n}\n","import { ToggleCollapseIcon } from '@blocksuite/icons/rc';\nimport clsx from 'clsx';\nimport { type ForwardedRef, forwardRef, type PropsWithChildren } from 'react';\n\nimport * as styles from './index.css';\n\nexport type CategoryDividerProps = PropsWithChildren<\n  {\n    label: string;\n    className?: string;\n    collapsed?: boolean;\n    setCollapsed?: (collapsed: boolean) => void;\n  } & {\n    [key: `data-${string}`]: unknown;\n  }\n>;\n\nexport const CategoryDivider = forwardRef(\n  (\n    {\n      label,\n      children,\n      className,\n      collapsed,\n      setCollapsed,\n      ...otherProps\n    }: CategoryDividerProps,\n    ref: ForwardedRef<HTMLDivElement>\n  ) => {\n    const collapsible = collapsed !== undefined;\n\n    return (\n      <div\n        className={clsx([styles.root, className])}\n        ref={ref}\n        onClick={() => setCollapsed?.(!collapsed)}\n        data-collapsed={collapsed}\n        data-collapsible={collapsible}\n        {...otherProps}\n      >\n        <div className={styles.label}>\n          {label}\n          {collapsible ? (\n            <ToggleCollapseIcon\n              width={16}\n              height={16}\n              data-testid=\"category-divider-collapse-button\"\n              className={styles.collapseIcon}\n            />\n          ) : null}\n        </div>\n        <div className={styles.actions} onClick={e => e.stopPropagation()}>\n          {children}\n        </div>\n      </div>\n    );\n  }\n);\n\nCategoryDivider.displayName = 'CategoryDivider';\n","import \"../core/src/components/app-sidebar/category-divider/index.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/app-sidebar/category-divider/index.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACpVS0W4TMRB8z1esKiHlHhw5oUjgE9/AM0IIbey9i8G1rfVekgP139H50rSBhtI3azQz3tmd1bf1yDSI1vBrAeB8yQFHA12gY7sA6DEbeJ/rO2W0XkYDul3cL1YPynVVdimKKv4nGdgjL5XCrvORVMWPpZkMduT7nRjY6Nnw4J3sDFgMdrnW+k0lDYVYFQpkxUBMkdrn5sLg+6i80F0xYCkK8QR/H4r4blQ2RaEoBkpGS2pLciCKEyOjcz72BvRDrG1iR6wYnR+KgdsJfRrvi0NBZVMImIvfBvp4IzzQzdea2w5cEhvIyc9D/JfU7NKeuBps0f7oOQ3RTcTJ6mJ/AUdi9YRUlZ/2xAHH5lXfmR2W5ZmtZ7C5MoQwxpKRKcrlJ6fRz8CmGpy7sb5gv5139EwuoaMoIRaPPNbD16YcThV5p/WEhYn6Z22mDqie06E28VppN/l1RRFkaV846G2No9SUc7ZXig180I769kpQb1O8DFpX2yW+O205oNDn5SwamwY4CQqdAG4eNV58iuZRD3q1Kf+oALlzVf+KwAbmqe9/Ax5vzT0DBAAA\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var actions = '_1yreut02 _1yreut00';\nexport var collapseIcon = '_1yreut04';\nexport var label = '_1yreut03';\nexport var root = '_1yreut01';","import { WorkbenchLink } from '@affine/core/modules/workbench';\nimport { ArrowDownSmallIcon } from '@blocksuite/icons/rc';\nimport clsx from 'clsx';\nimport React from 'react';\nimport type { To } from 'react-router-dom';\n\nimport * as styles from './index.css';\n\nexport interface MenuItemProps extends React.HTMLAttributes<HTMLDivElement> {\n  icon?: React.ReactElement;\n  active?: boolean;\n  disabled?: boolean;\n  // true, false, undefined. undefined means no collapse\n  collapsed?: boolean;\n  // if onCollapsedChange is given, but collapsed is undefined, then we will render the collapse button as disabled\n  onCollapsedChange?: (collapsed: boolean) => void;\n  postfix?: React.ReactElement;\n}\n\nexport interface MenuLinkItemProps extends MenuItemProps {\n  to: To;\n  linkComponent?: React.ComponentType<{ to: To; className?: string }>;\n}\n\nconst stopPropagation: React.MouseEventHandler = e => {\n  e.stopPropagation();\n};\n\nexport const MenuItem = React.forwardRef<HTMLDivElement, MenuItemProps>(\n  (\n    {\n      onClick,\n      icon,\n      active,\n      children,\n      disabled,\n      collapsed,\n      onCollapsedChange,\n      postfix,\n      ...props\n    },\n    ref\n  ) => {\n    const collapsible = onCollapsedChange !== undefined;\n    return (\n      <div\n        ref={ref}\n        {...props}\n        onClick={onClick}\n        className={clsx([styles.root, props.className])}\n        data-active={active}\n        data-disabled={disabled}\n        data-collapsible={collapsible}\n      >\n        {icon && (\n          <div className={styles.iconsContainer} data-collapsible={collapsible}>\n            {collapsible && (\n              <div\n                data-disabled={collapsed === undefined ? true : undefined}\n                onClick={e => {\n                  e.stopPropagation();\n                  e.preventDefault(); // for links\n                  onCollapsedChange?.(!collapsed);\n                }}\n                data-testid=\"fav-collapsed-button\"\n                className={styles.collapsedIconContainer}\n              >\n                <ArrowDownSmallIcon\n                  className={styles.collapsedIcon}\n                  data-collapsed={collapsed !== false}\n                />\n              </div>\n            )}\n            {React.cloneElement(icon, {\n              className: clsx([styles.icon, icon.props.className]),\n            })}\n          </div>\n        )}\n\n        <div className={styles.content}>{children}</div>\n        {postfix ? (\n          <div className={styles.postfix} onClick={stopPropagation}>\n            {postfix}\n          </div>\n        ) : null}\n      </div>\n    );\n  }\n);\nMenuItem.displayName = 'MenuItem';\n\nexport const MenuLinkItem = React.forwardRef<HTMLDivElement, MenuLinkItemProps>(\n  ({ to, linkComponent: LinkComponent = WorkbenchLink, ...props }, ref) => {\n    return (\n      <LinkComponent to={to} className={styles.linkItemRoot}>\n        {/* The <a> element rendered by Link does not generate display box due to `display: contents` style */}\n        {/* Thus ref is passed to MenuItem instead of Link */}\n        <MenuItem ref={ref} {...props}></MenuItem>\n      </LinkComponent>\n    );\n  }\n);\nMenuLinkItem.displayName = 'MenuLinkItem';\n","import \"../core/src/components/app-sidebar/menu-item/index.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/app-sidebar/menu-item/index.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACqVV7W7bMAz8n6cQCgxIsCmw069Mxd5jwFAMjEXbXBXJk+g02bB3Hyzbie0ZbYf+syWKRx2Pp/X3dKuL8ud9In4vhMiccV4JsiV64ofFn8W6D0hjgKZQGTg1IYYsytzg8WEhBBgqrCTGfVAiQ8vom+Wd8xq99KCpDkrcVDGY8cgynlDCYM4PM8hCPJPmUok0ST40v3uyskQqSlbiOmkT1QG9DGgwYyWssxgz1T40qSpHfRkVaE22UCIR6aY9mjvLMtAvVOIAfikl5Hm8UFzfryIk+IKsZFedS69cICZnlfBogOmAY5JU6Q7oI1U7yJ4K72qrJxAxRMYLr8anv2lgkJA1eb9csa/x6vF9uTQF2BnUo2w9QxpzqM2Q/lHu2KaAmbMa/OkMInpmJR7QcuiZ/xc8c8ZAFWhnxrfp2iGb3l+Y7RZ92+K4+krKHEzAq0dFYTnH3CfRdmMVQTs5ZWCyZaMp8VFsq2O8D3uwIXd+r9pPA4xfl7LfHpe7SWbrbXU1KDhROfnA0uWSTxWKySANtZVMjm5iRFN6btyzEiVpjfY8OZcNNIaqQCGOS0mMMlSQYdORZw9V1LnBoxLpKP91zD8keihs2AVnao6z5CrIiE9KJG/reyf/CdKPOjDlp2ZScxUrkmj1GJUsMYEZgaZzoGDMCPNmaFwj/VLmrKw87cGfVpOZ30w5vx2KJL1rSen9pv8/u98rttdfOHOW0fILjti5UZRdx8RZjSJZb8KcNw7LHo3FZM4HuvaOgXEpPycai9VcilmnuPR/ff0mBdy+ywDvxm/M/7IclRUY/PD92Gw7w4+bpSf7FOU8hH3ZrrpEN1NLur+QPNs6gRBQkpWuHjft/v1N28bYy3D/BfMGMR/IBwAA\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var collapsedIcon = '_18dghq77';\nexport var collapsedIconContainer = '_18dghq75';\nexport var content = '_18dghq72';\nexport var icon = '_18dghq74';\nexport var iconsContainer = '_18dghq76';\nexport var linkItemRoot = '_18dghq70';\nexport var postfix = '_18dghq73';\nexport var root = '_18dghq71';\nexport var spacer = '_18dghq78';","import { assignInlineVars } from '@vanilla-extract/dynamic';\nimport { useTheme } from 'next-themes';\nimport React, { useEffect, useRef } from 'react';\n\nimport * as styles from './index.css';\n\nfunction useMouseOffset() {\n  const [offset, setOffset] = React.useState<{ x: number; y: number }>();\n  const [outside, setOutside] = React.useState(true);\n  const ref = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (ref.current && ref.current.parentElement) {\n      const el = ref.current.parentElement;\n\n      // debounce?\n      const onMouseMove = (e: MouseEvent) => {\n        const bound = el.getBoundingClientRect();\n        setOffset({ x: e.clientX - bound.x, y: e.clientY - bound.y });\n        setOutside(false);\n      };\n\n      const onMouseLeave = () => {\n        setOutside(true);\n      };\n      el.addEventListener('mousemove', onMouseMove);\n      el.addEventListener('mouseleave', onMouseLeave);\n      return () => {\n        el.removeEventListener('mousemove', onMouseMove);\n        el.removeEventListener('mouseleave', onMouseLeave);\n      };\n    }\n    return;\n  }, []);\n\n  return [offset, outside, ref] as const;\n}\n\nexport function Spotlight() {\n  const [offset, outside, ref] = useMouseOffset();\n  const { theme } = useTheme();\n  const isDark = theme === 'dark';\n  const offsetVars = assignInlineVars({\n    [styles.spotlightX]: (offset?.x ?? 0) + 'px',\n    [styles.spotlightY]: (offset?.y ?? 0) + 'px',\n    [styles.spotlightOpacity]: outside ? '0' : isDark ? '.1' : '0.07',\n  });\n\n  return <div style={offsetVars} ref={ref} className={styles.spotlight} />;\n}\n","import \"../core/src/components/app-sidebar/spolight/index.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/app-sidebar/spolight/index.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xOTI5cTJwNCB7CiAgLS1fMTkyOXEycDA6IDBweDsKICAtLV8xOTI5cTJwMTogMHB4OwogIC0tXzE5MjlxMnAyOiAwOwogIC0tXzE5MjlxMnAzOiA2NHB4OwogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICBiYWNrZ3JvdW5kOiByYWRpYWwtZ3JhZGllbnQodmFyKC0tXzE5MjlxMnAzKSBjaXJjbGUgYXQgdmFyKC0tXzE5MjlxMnAwKSB2YXIoLS1fMTkyOXEycDEpLCB2YXIoLS1hZmZpbmUtdGV4dC1wcmltYXJ5LWNvbG9yKSwgdHJhbnNwYXJlbnQpOwogIGluc2V0OiAwcHg7CiAgcG9pbnRlci1ldmVudHM6IG5vbmU7CiAgd2lsbC1jaGFuZ2U6IGJhY2tncm91bmQsIG9wYWNpdHk7CiAgb3BhY2l0eTogdmFyKC0tXzE5MjlxMnAyKTsKICB6LWluZGV4OiAxOwogIHRyYW5zaXRpb246IGFsbCAwLjJzOwogIGJvcmRlci1yYWRpdXM6IGluaGVyaXQ7Cn0=\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var spotlight = '_1929q2p4';\nexport var spotlightOpacity = 'var(--_1929q2p2)';\nexport var spotlightSize = 'var(--_1929q2p3)';\nexport var spotlightX = 'var(--_1929q2p0)';\nexport var spotlightY = 'var(--_1929q2p1)';","import { useI18n } from '@affine/i18n';\nimport { SearchIcon } from '@blocksuite/icons/rc';\nimport clsx from 'clsx';\nimport type { HTMLAttributes } from 'react';\n\nimport { Spotlight } from '../spolight';\nimport * as styles from './index.css';\n\ninterface QuickSearchInputProps extends HTMLAttributes<HTMLDivElement> {\n  onClick?: () => void;\n}\n\n// Although it is called an input, it is actually a button.\nexport function QuickSearchInput({ onClick, ...props }: QuickSearchInputProps) {\n  const t = useI18n();\n  const isMac = environment.isBrowser && environment.isMacOs;\n\n  return (\n    <div\n      {...props}\n      className={clsx([props.className, styles.root])}\n      onClick={onClick}\n    >\n      <SearchIcon className={styles.icon} />\n      {t['Quick search']()}\n      <div className={styles.spacer} />\n      <div className={styles.shortcutHint}>\n        {isMac ? '  + K' : ' Ctrl + K'}\n      </div>\n      <Spotlight />\n    </div>\n  );\n}\n","import \"../core/src/components/app-sidebar/quick-search-input/index.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/app-sidebar/quick-search-input/index.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xMmo4cTB2MCB7CiAgZGlzcGxheTogaW5saW5lLWZsZXg7CiAgYmFja2dyb3VuZDogdmFyKC0tYWZmaW5lLWJ1dHRvbi1zaWRlcmJhclByaW1hcnktYmFja2dyb3VuZCk7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBib3JkZXItcmFkaXVzOiA4cHg7CiAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYWZmaW5lLWxheWVyLWJvcmRlcik7CiAgZm9udC1zaXplOiB2YXIoLS1hZmZpbmUtZm9udC1zbSk7CiAgd2lkdGg6IDEwMCU7CiAgaGVpZ2h0OiAzNnB4OwogIHVzZXItc2VsZWN0OiBub25lOwogIGN1cnNvcjogcG9pbnRlcjsKICBwYWRkaW5nOiAwIDEycHg7CiAgbWFyZ2luOiAyMHB4IDA7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIHdoaXRlLXNwYWNlOiBub3dyYXA7Cn0KLl8xMmo4cTB2MSB7CiAgbWFyZ2luLXJpZ2h0OiA4cHg7CiAgY29sb3I6IHZhcigtLWFmZmluZS1pY29uLXByaW1hcnkpOwogIGZvbnQtc2l6ZTogMjBweDsKfQouXzEyajhxMHYyIHsKICBmbGV4OiAxOwp9Ci5fMTJqOHEwdjMgewogIGNvbG9yOiB2YXIoLS1hZmZpbmUtdGV4dC10ZXJ0aWFyeSk7CiAgZm9udC1zaXplOiB2YXIoLS1hZmZpbmUtZm9udC1iYXNlKTsKfQ==\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var icon = '_12j8q0v1';\nexport var root = '_12j8q0v0';\nexport var shortcutHint = '_12j8q0v3';\nexport var spacer = '_12j8q0v2';","import { useHasScrollTop } from '@affine/component';\nimport * as ScrollArea from '@radix-ui/react-scroll-area';\nimport clsx from 'clsx';\nimport { type PropsWithChildren } from 'react';\n\nimport * as styles from './index.css';\n\nexport function SidebarContainer({ children }: PropsWithChildren) {\n  return <div className={clsx([styles.baseContainer])}>{children}</div>;\n}\n\nexport function SidebarScrollableContainer({ children }: PropsWithChildren) {\n  const [setContainer, hasScrollTop] = useHasScrollTop();\n  return (\n    <ScrollArea.Root className={styles.scrollableContainerRoot}>\n      <div\n        data-has-scroll-top={hasScrollTop}\n        className={styles.scrollTopBorder}\n      />\n      <ScrollArea.Viewport\n        className={clsx([styles.scrollableViewport])}\n        ref={setContainer}\n      >\n        <div className={clsx([styles.scrollableContainer])}>{children}</div>\n      </ScrollArea.Viewport>\n      <ScrollArea.Scrollbar\n        forceMount\n        orientation=\"vertical\"\n        className={styles.scrollbar}\n      >\n        <ScrollArea.Thumb className={styles.scrollbarThumb} />\n      </ScrollArea.Scrollbar>\n    </ScrollArea.Root>\n  );\n}\n","import \"../core/src/components/app-sidebar/sidebar-containers/index.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/app-sidebar/sidebar-containers/index.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACpVT247bIBB9z1dMLa20kUpk56aKaPsjVR/GgG0aDAhwLq323yuD46A0XbUvNjMwZ87MnFkNw+Zn9aOEXwsAi5xL3VLY2gtUe3s5LAC49FbhlUKjRHSMf9Ioc6bAjBp6DdqcHdrD4n2xSnBVhCPEM2eUqtGRs+Sho1CVdsagUEEFOAQzesxJuBGUXCl0knOhM7x1ome8DNJoClh7o4YgxsBgLIVyPCnRBDrzdrLtMrMTk53M4FDf0IxFJsMVVhsPq7WPbJJrAq6RHVtnBs0pnNC9EoJNI7UgtUJ2JFW5zLl+4xiQdOin8kkw9q0IbhDF91jHDF5lYZt4NbMsy5cxc4+ulZrEGrcj8+z9V+DyFKN6vNwbnALnqdXKsCN8kr01LqAOGcT2acpZBKW9wJePNMClEyy1MAlhvGnR0hQ259nFPP+BMXjhiBdKsEBBGz3NeWAdwenxzXtnC+vEdWpEmtODAJeHJwXn4/iLMKqdz+tJE/YBg3grklgfR1tm7/cP6nVCYZAn8Q/S2pSRcm0cF4445HLwkxLuK/NkYfaU1qIxTsTUzOggdKBQFIeP92iXWpI2aTJiRxrjepqOCoN4Jbvy5TOM32XW9FtL/5Cx1DeBbifyo+v2LPnefwPhuKMojAQAAA==\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var baseContainer = 'uu3z1j0';\nexport var scrollTopBorder = 'uu3z1j2';\nexport var scrollableContainer = 'uu3z1j4 uu3z1j0';\nexport var scrollableContainerRoot = 'uu3z1j1';\nexport var scrollableViewport = 'uu3z1j3';\nexport var scrollbar = 'uu3z1j5';\nexport var scrollbarThumb = 'uu3z1j6';","import { Skeleton } from '@affine/component';\nimport { ResizePanel } from '@affine/component/resize-panel';\nimport { useServiceOptional, WorkspaceService } from '@toeverything/infra';\nimport { useAtom, useAtomValue } from 'jotai';\nimport { debounce } from 'lodash-es';\nimport type { PropsWithChildren, ReactElement } from 'react';\nimport { useEffect } from 'react';\n\nimport { WorkspaceSelector } from '../workspace-selector';\nimport { fallbackHeaderStyle, fallbackStyle } from './fallback.css';\nimport {\n  floatingMaxWidth,\n  navBodyStyle,\n  navHeaderStyle,\n  navStyle,\n  navWrapperStyle,\n  sidebarFloatMaskStyle,\n} from './index.css';\nimport {\n  APP_SIDEBAR_OPEN,\n  appSidebarFloatingAtom,\n  appSidebarOpenAtom,\n  appSidebarResizingAtom,\n  appSidebarWidthAtom,\n} from './index.jotai';\nimport { SidebarHeader } from './sidebar-header';\n\nexport type AppSidebarProps = PropsWithChildren<{\n  clientBorder?: boolean;\n  translucentUI?: boolean;\n}>;\n\nexport type History = {\n  stack: string[];\n  current: number;\n};\n\nconst MAX_WIDTH = 480;\nconst MIN_WIDTH = 248;\n\nexport function AppSidebar({\n  children,\n  clientBorder,\n}: AppSidebarProps): ReactElement {\n  const [open, setOpen] = useAtom(appSidebarOpenAtom);\n  const [width, setWidth] = useAtom(appSidebarWidthAtom);\n  const [floating, setFloating] = useAtom(appSidebarFloatingAtom);\n  const [resizing, setResizing] = useAtom(appSidebarResizingAtom);\n\n  useEffect(() => {\n    // do not float app sidebar on desktop\n    if (environment.isDesktop) {\n      return;\n    }\n\n    function onResize() {\n      const isFloatingMaxWidth = window.matchMedia(\n        `(max-width: ${floatingMaxWidth}px)`\n      ).matches;\n      const isOverflowWidth = window.matchMedia(\n        `(max-width: ${width / 0.4}px)`\n      ).matches;\n      const isFloating = isFloatingMaxWidth || isOverflowWidth;\n      if (\n        open === undefined &&\n        localStorage.getItem(APP_SIDEBAR_OPEN) === null\n      ) {\n        // give the initial value,\n        // so that the sidebar can be closed on mobile by default\n        setOpen(!isFloating);\n      }\n      setFloating(isFloating);\n    }\n\n    const dOnResize = debounce(onResize, 50);\n    window.addEventListener('resize', dOnResize);\n    return () => {\n      window.removeEventListener('resize', dOnResize);\n    };\n  }, [open, setFloating, setOpen, width]);\n\n  const hasRightBorder = !environment.isDesktop && !clientBorder;\n  const isMacosDesktop = environment.isDesktop && environment.isMacOs;\n  return (\n    <>\n      <ResizePanel\n        floating={floating}\n        open={open}\n        resizing={resizing}\n        maxWidth={MAX_WIDTH}\n        minWidth={MIN_WIDTH}\n        width={width}\n        resizeHandlePos=\"right\"\n        onOpen={setOpen}\n        onResizing={setResizing}\n        onWidthChange={setWidth}\n        className={navWrapperStyle}\n        resizeHandleOffset={clientBorder ? 8 : 0}\n        resizeHandleVerticalPadding={clientBorder ? 16 : 0}\n        data-transparent\n        data-open={open}\n        data-has-border={hasRightBorder}\n        data-testid=\"app-sidebar-wrapper\"\n        data-is-macos-electron={isMacosDesktop}\n      >\n        <nav className={navStyle} data-testid=\"app-sidebar\">\n          {!environment.isDesktop && <SidebarHeader />}\n          <div className={navBodyStyle} data-testid=\"sliderBar-inner\">\n            {children}\n          </div>\n        </nav>\n      </ResizePanel>\n      <div\n        data-testid=\"app-sidebar-float-mask\"\n        data-open={open}\n        data-is-floating={floating}\n        className={sidebarFloatMaskStyle}\n        onClick={() => setOpen(false)}\n      />\n    </>\n  );\n}\n\nexport const AppSidebarFallback = (): ReactElement | null => {\n  const width = useAtomValue(appSidebarWidthAtom);\n\n  const currentWorkspace = useServiceOptional(WorkspaceService);\n  return (\n    <div\n      style={{ width }}\n      className={navWrapperStyle}\n      data-has-border\n      data-open=\"true\"\n    >\n      <nav className={navStyle}>\n        <div className={navHeaderStyle} data-open=\"true\" />\n        <div className={navBodyStyle}>\n          <div className={fallbackStyle}>\n            <div className={fallbackHeaderStyle}>\n              {currentWorkspace ? (\n                <WorkspaceSelector />\n              ) : (\n                <>\n                  <Skeleton variant=\"circular\" width={40} height={40} />\n                  <Skeleton variant=\"rectangular\" width={150} height={40} />\n                </>\n              )}\n            </div>\n          </div>\n        </div>\n      </nav>\n    </div>\n  );\n};\n\nexport * from './add-page-button';\nexport * from './app-download-button';\nexport * from './app-updater-button';\nexport * from './category-divider';\nexport * from './index.css';\nexport * from './menu-item';\nexport * from './quick-search-input';\nexport * from './sidebar-containers';\nexport * from './sidebar-header';\nexport { appSidebarFloatingAtom, appSidebarOpenAtom, appSidebarResizingAtom };\n","import \"../core/src/components/app-sidebar/fallback.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/app-sidebar/fallback.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xdmppaDB5MCB7CiAgbWFyZ2luOiA0cHggMTZweDsKICBoZWlnaHQ6IDEwMCU7Cn0KLl8xdmppaDB5MSB7CiAgd2lkdGg6IDEwMCU7CiAgZGlzcGxheTogZmxleDsKICBhbGlnbi1pdGVtczogY2VudGVyOwogIGZsZXgtZGlyZWN0aW9uOiByb3c7CiAgZ2FwOiA4cHg7Cn0=\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var fallbackHeaderStyle = '_1vjih0y1';\nexport var fallbackStyle = '_1vjih0y0';","import { IconButton } from '@affine/component';\nimport { useI18n } from '@affine/i18n';\nimport { SidebarIcon } from '@blocksuite/icons/rc';\nimport { useAtom } from 'jotai';\n\nimport { appSidebarOpenAtom } from '../index.jotai';\nimport * as styles from './sidebar-switch.css';\n\nexport const SidebarSwitch = ({\n  show,\n  className,\n}: {\n  show: boolean;\n  className?: string;\n}) => {\n  const [open, setOpen] = useAtom(appSidebarOpenAtom);\n  const t = useI18n();\n  const tooltipContent = open\n    ? t['com.affine.sidebarSwitch.collapse']()\n    : t['com.affine.sidebarSwitch.expand']();\n\n  return (\n    <div\n      data-show={show}\n      className={styles.sidebarSwitchClip}\n      data-testid={`app-sidebar-arrow-button-${open ? 'collapse' : 'expand'}`}\n    >\n      <IconButton\n        tooltip={tooltipContent}\n        tooltipShortcut={['$mod', '/']}\n        tooltipOptions={{ side: open ? 'bottom' : 'right' }}\n        className={className}\n        size=\"24\"\n        style={{\n          zIndex: 1,\n        }}\n        onClick={() => setOpen(open => !open)}\n      >\n        <SidebarIcon />\n      </IconButton>\n    </div>\n  );\n};\n","import \"../core/src/components/app-sidebar/sidebar-header/sidebar-switch.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/app-sidebar/sidebar-header/sidebar-switch.css.ts.vanilla.css\\\",\\\"source\\\":\\\"LmxvMHdrazAgewogIGZsZXgtc2hyaW5rOiAwOwogIG92ZXJmbG93OiBoaWRkZW47CiAgdHJhbnNpdGlvbjogbWF4LXdpZHRoIDAuMnMgZWFzZS1pbi1vdXQsIG1hcmdpbiAwLjNzIGVhc2UtaW4tb3V0LCBvcGFjaXR5IDAuM3MgZWFzZTsKfQoubG8wd2trMFtkYXRhLXNob3c9dHJ1ZV0gewogIG9wYWNpdHk6IDE7CiAgbWF4LXdpZHRoOiA2MHB4Owp9Ci5sbzB3a2swW2RhdGEtc2hvdz1mYWxzZV0gewogIG9wYWNpdHk6IDA7CiAgbWF4LXdpZHRoOiAwOwp9\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var sidebarSwitchClip = 'lo0wkk0';","import type { BlockSpec } from '@blocksuite/block-std';\nimport { SpecProvider } from '@blocksuite/blocks';\nimport { AIChatBlockSpec, EdgelessAIChatBlockSpec } from '@blocksuite/presets';\n\nconst CustomSpecs: BlockSpec[] = [AIChatBlockSpec, EdgelessAIChatBlockSpec];\n\nfunction patchPreviewSpec(id: string, specs: BlockSpec[]) {\n  const specProvider = SpecProvider.getInstance();\n  specProvider.extendSpec(id, specs);\n}\n\n// Patch edgeless preview spec for blocksuite surface-ref and embed-synced-doc\npatchPreviewSpec('edgeless:preview', CustomSpecs);\n","import {\n  type ElementOrFactory,\n  Input,\n  notify,\n  toast,\n  type ToastOptions,\n  toReactNode,\n  type useConfirmModal,\n} from '@affine/component';\nimport { track } from '@affine/core/mixpanel';\nimport { DocsSearchService } from '@affine/core/modules/docs-search';\nimport { resolveLinkToDoc } from '@affine/core/modules/navigation';\nimport type { PeekViewService } from '@affine/core/modules/peek-view';\nimport type { ActivePeekView } from '@affine/core/modules/peek-view/entities/peek-view';\nimport {\n  CreationQuickSearchSession,\n  DocsQuickSearchSession,\n  type QuickSearchItem,\n  QuickSearchService,\n  RecentDocsQuickSearchSession,\n} from '@affine/core/modules/quicksearch';\nimport { DebugLogger } from '@affine/debug';\nimport type { BlockSpec, WidgetComponent } from '@blocksuite/block-std';\nimport {\n  type AffineReference,\n  AffineSlashMenuWidget,\n  EdgelessRootBlockComponent,\n  EmbedLinkedDocBlockComponent,\n  type ParagraphBlockService,\n  type RootService,\n} from '@blocksuite/blocks';\nimport { LinkIcon } from '@blocksuite/icons/rc';\nimport { AIChatBlockSchema } from '@blocksuite/presets';\nimport type { BlockSnapshot } from '@blocksuite/store';\nimport {\n  type DocMode,\n  type DocService,\n  DocsService,\n  type FrameworkProvider,\n} from '@toeverything/infra';\nimport { type TemplateResult } from 'lit';\nimport { customElement } from 'lit/decorators.js';\nimport { literal } from 'lit/static-html.js';\n\nexport type ReferenceReactRenderer = (\n  reference: AffineReference\n) => React.ReactElement;\n\nconst logger = new DebugLogger('affine::spec-patchers');\n\nfunction patchSpecService<Spec extends BlockSpec>(\n  spec: Spec,\n  onMounted: (\n    service: Spec extends BlockSpec<any, infer BlockService>\n      ? BlockService\n      : never\n  ) => (() => void) | void,\n  onWidgetConnected?: (component: WidgetComponent) => void\n) {\n  const oldSetup = spec.setup;\n  spec.setup = (slots, disposableGroup) => {\n    oldSetup?.(slots, disposableGroup);\n    disposableGroup.add(\n      slots.mounted.on(({ service }) => {\n        const disposable = onMounted(service as any);\n        if (disposable) {\n          disposableGroup.add(disposable);\n        }\n      })\n    );\n\n    onWidgetConnected &&\n      disposableGroup.add(\n        slots.widgetConnected.on(({ component }) => {\n          onWidgetConnected(component);\n        })\n      );\n  };\n  return spec;\n}\n\n/**\n * Patch the block specs with custom renderers.\n */\nexport function patchReferenceRenderer(\n  specs: BlockSpec[],\n  reactToLit: (element: ElementOrFactory) => TemplateResult,\n  reactRenderer: ReferenceReactRenderer\n) {\n  const litRenderer = (reference: AffineReference) => {\n    const node = reactRenderer(reference);\n    return reactToLit(node);\n  };\n\n  return specs.map(spec => {\n    if (\n      ['affine:paragraph', 'affine:list', 'affine:database'].includes(\n        spec.schema.model.flavour\n      )\n    ) {\n      spec = patchSpecService(\n        spec as BlockSpec<string, ParagraphBlockService>,\n        service => {\n          service.referenceNodeConfig.setCustomContent(litRenderer);\n          return () => {\n            service.referenceNodeConfig.setCustomContent(null);\n          };\n        }\n      );\n    }\n\n    return spec;\n  });\n}\n\nexport function patchNotificationService(\n  specs: BlockSpec[],\n  { closeConfirmModal, openConfirmModal }: ReturnType<typeof useConfirmModal>\n) {\n  const rootSpec = specs.find(\n    spec => spec.schema.model.flavour === 'affine:page'\n  ) as BlockSpec<string, RootService>;\n\n  if (!rootSpec) {\n    return specs;\n  }\n\n  patchSpecService(rootSpec, service => {\n    service.notificationService = {\n      confirm: async ({ title, message, confirmText, cancelText, abort }) => {\n        return new Promise<boolean>(resolve => {\n          openConfirmModal({\n            title: toReactNode(title),\n            description: toReactNode(message),\n            confirmText,\n            confirmButtonOptions: {\n              variant: 'primary',\n            },\n            cancelText,\n            onConfirm: () => {\n              resolve(true);\n            },\n            onCancel: () => {\n              resolve(false);\n            },\n          });\n          abort?.addEventListener('abort', () => {\n            resolve(false);\n            closeConfirmModal();\n          });\n        });\n      },\n      prompt: async ({\n        title,\n        message,\n        confirmText,\n        placeholder,\n        cancelText,\n        autofill,\n        abort,\n      }) => {\n        return new Promise<string | null>(resolve => {\n          let value = autofill || '';\n          const description = (\n            <div>\n              <span style={{ marginBottom: 12 }}>{toReactNode(message)}</span>\n              <Input\n                placeholder={placeholder}\n                defaultValue={value}\n                onChange={e => (value = e)}\n                ref={input => input?.select()}\n              />\n            </div>\n          );\n          openConfirmModal({\n            title: toReactNode(title),\n            description: description,\n            confirmText: confirmText ?? 'Confirm',\n            confirmButtonOptions: {\n              variant: 'primary',\n            },\n            cancelText: cancelText ?? 'Cancel',\n            onConfirm: () => {\n              resolve(value);\n            },\n            onCancel: () => {\n              resolve(null);\n            },\n          });\n          abort?.addEventListener('abort', () => {\n            resolve(null);\n            closeConfirmModal();\n          });\n        });\n      },\n      toast: (message: string, options: ToastOptions) => {\n        return toast(message, options);\n      },\n      notify: notification => {\n        const accentToNotify = {\n          error: notify.error,\n          success: notify.success,\n          warning: notify.warning,\n          info: notify,\n        };\n\n        const fn = accentToNotify[notification.accent || 'info'];\n        if (!fn) {\n          throw new Error('Invalid notification accent');\n        }\n\n        const toastId = fn(\n          {\n            title: toReactNode(notification.title),\n            message: toReactNode(notification.message),\n            action: notification.action?.onClick\n              ? {\n                  label: toReactNode(notification.action?.label),\n                  onClick: notification.action.onClick,\n                }\n              : undefined,\n            onDismiss: notification.onClose,\n          },\n          {\n            duration: notification.duration || 0,\n            onDismiss: notification.onClose,\n            onAutoClose: notification.onClose,\n          }\n        );\n\n        notification.abort?.addEventListener('abort', () => {\n          notify.dismiss(toastId);\n        });\n      },\n    };\n  });\n  return specs;\n}\n\nexport function patchPeekViewService(\n  specs: BlockSpec[],\n  service: PeekViewService\n) {\n  const rootSpec = specs.find(\n    spec => spec.schema.model.flavour === 'affine:page'\n  ) as BlockSpec<string, RootService>;\n\n  if (!rootSpec) {\n    return specs;\n  }\n\n  patchSpecService(rootSpec, pageService => {\n    pageService.peekViewService = {\n      peek: (target: ActivePeekView['target'], template?: TemplateResult) => {\n        logger.debug('center peek', target, template);\n        return service.peekView.open(target, template);\n      },\n    };\n  });\n\n  return specs;\n}\n\nexport function patchDocModeService(\n  specs: BlockSpec[],\n  docService: DocService,\n  docsService: DocsService\n) {\n  const rootSpec = specs.find(\n    spec => spec.schema.model.flavour === 'affine:page'\n  ) as BlockSpec<string, RootService>;\n\n  if (!rootSpec) {\n    return specs;\n  }\n\n  patchSpecService(rootSpec, pageService => {\n    const DEFAULT_MODE = 'page';\n    pageService.docModeService = {\n      setMode: (mode: DocMode, id?: string) => {\n        if (id) {\n          docsService.list.setMode(id, mode);\n        } else {\n          docService.doc.setMode(mode);\n        }\n      },\n      getMode: (id?: string) => {\n        const mode = id\n          ? docsService.list.getMode(id)\n          : docService.doc.getMode();\n        return mode || DEFAULT_MODE;\n      },\n      toggleMode: (id?: string) => {\n        const mode = id\n          ? docsService.list.toggleMode(id)\n          : docService.doc.toggleMode();\n        return mode || DEFAULT_MODE;\n      },\n      onModeChange: (handler: (mode: DocMode) => void, id?: string) => {\n        // eslint-disable-next-line rxjs/finnish\n        const mode$ = id\n          ? docsService.list.observeMode(id)\n          : docService.doc.observeMode();\n        const sub = mode$.subscribe(m => handler(m || DEFAULT_MODE));\n        return {\n          dispose: sub.unsubscribe,\n        };\n      },\n    };\n  });\n\n  return specs;\n}\n\nexport function patchQuickSearchService(\n  specs: BlockSpec[],\n  framework: FrameworkProvider\n) {\n  const rootSpec = specs.find(\n    spec => spec.schema.model.flavour === 'affine:page'\n  ) as BlockSpec<string, RootService>;\n\n  if (!rootSpec) {\n    return specs;\n  }\n\n  patchSpecService(\n    rootSpec,\n    pageService => {\n      pageService.quickSearchService = {\n        async searchDoc(options) {\n          let searchResult:\n            | { docId: string; isNewDoc?: boolean }\n            | { userInput: string }\n            | null = null;\n          if (options.skipSelection) {\n            const query = options.userInput;\n            if (!query) {\n              logger.error('No user input provided');\n            } else {\n              const resolvedDoc = resolveLinkToDoc(query);\n              if (resolvedDoc) {\n                searchResult = {\n                  docId: resolvedDoc.docId,\n                };\n              } else if (\n                query.startsWith('http://') ||\n                query.startsWith('https://')\n              ) {\n                searchResult = {\n                  userInput: query,\n                };\n              } else {\n                const searchedDoc = (\n                  await framework.get(DocsSearchService).search(query)\n                ).at(0);\n                if (searchedDoc) {\n                  searchResult = {\n                    docId: searchedDoc.docId,\n                  };\n                }\n              }\n            }\n          } else {\n            searchResult = await new Promise(resolve =>\n              framework.get(QuickSearchService).quickSearch.show(\n                [\n                  framework.get(RecentDocsQuickSearchSession),\n                  framework.get(DocsQuickSearchSession),\n                  framework.get(CreationQuickSearchSession),\n                  (query: string) => {\n                    if (\n                      (query.startsWith('http://') ||\n                        query.startsWith('https://')) &&\n                      resolveLinkToDoc(query) === null\n                    ) {\n                      return [\n                        {\n                          id: 'link',\n                          source: 'link',\n                          icon: LinkIcon,\n                          label: {\n                            key: 'com.affine.cmdk.affine.insert-link',\n                          },\n                          payload: { url: query },\n                        } as QuickSearchItem<'link', { url: string }>,\n                      ];\n                    }\n                    return [];\n                  },\n                ],\n                result => {\n                  if (result === null) {\n                    resolve(null);\n                    return;\n                  }\n                  if (\n                    result.source === 'docs' ||\n                    result.source === 'recent-doc'\n                  ) {\n                    resolve({\n                      docId: result.payload.docId,\n                    });\n                  } else if (result.source === 'link') {\n                    resolve({\n                      userInput: result.payload.url,\n                    });\n                  } else if (result.source === 'creation') {\n                    const docsService = framework.get(DocsService);\n                    const mode =\n                      result.id === 'creation:create-edgeless'\n                        ? 'edgeless'\n                        : 'page';\n                    const newDoc = docsService.createDoc({\n                      mode,\n                      title: result.payload.title,\n                    });\n                    resolve({\n                      docId: newDoc.id,\n                      isNewDoc: true,\n                    });\n                  }\n                },\n                {\n                  defaultQuery: options.userInput,\n                  label: {\n                    key: 'com.affine.cmdk.insert-links',\n                  },\n                  placeholder: {\n                    key: 'com.affine.cmdk.docs.placeholder',\n                  },\n                }\n              )\n            );\n          }\n\n          return searchResult;\n        },\n      };\n    },\n    (component: WidgetComponent) => {\n      if (component instanceof AffineSlashMenuWidget) {\n        component.config.items.forEach(item => {\n          if (\n            'action' in item &&\n            (item.name === 'Linked Doc' || item.name === 'Link')\n          ) {\n            const oldAction = item.action;\n            item.action = async ({ model, rootComponent }) => {\n              const { host, service, std } = rootComponent;\n              const { quickSearchService } = service;\n\n              if (!quickSearchService)\n                return oldAction({ model, rootComponent });\n\n              const result = await quickSearchService.searchDoc({});\n              if (result === null) return;\n\n              if ('docId' in result) {\n                const linkedDoc = std.collection.getDoc(result.docId);\n                if (!linkedDoc) return;\n\n                host.doc.addSiblingBlocks(model, [\n                  {\n                    flavour: 'affine:embed-linked-doc',\n                    pageId: linkedDoc.id,\n                  },\n                ]);\n                if (result.isNewDoc) {\n                  track.doc.editor.slashMenu.createDoc({ control: 'linkDoc' });\n                  track.doc.editor.slashMenu.linkDoc({ control: 'createDoc' });\n                }\n                track.doc.editor.slashMenu.linkDoc({ control: 'linkDoc' });\n              } else if ('userInput' in result) {\n                const embedOptions = service.getEmbedBlockOptions(\n                  result.userInput\n                );\n                if (!embedOptions) return;\n\n                host.doc.addSiblingBlocks(model, [\n                  {\n                    flavour: embedOptions.flavour,\n                    url: result.userInput,\n                  },\n                ]);\n              }\n            };\n          }\n        });\n      }\n    }\n  );\n\n  return specs;\n}\n\nexport function patchEdgelessClipboard(specs: BlockSpec[]) {\n  const rootSpec = specs.find(\n    spec => spec.schema.model.flavour === 'affine:page'\n  ) as BlockSpec<string, RootService>;\n\n  if (!rootSpec) {\n    return specs;\n  }\n\n  const oldSetup = rootSpec.setup;\n  rootSpec.setup = (slots, disposableGroup) => {\n    oldSetup?.(slots, disposableGroup);\n    disposableGroup.add(\n      slots.viewConnected.on(view => {\n        const component = view.component;\n        if (component instanceof EdgelessRootBlockComponent) {\n          const AIChatBlockFlavour = AIChatBlockSchema.model.flavour;\n          const createFunc = (blocks: BlockSnapshot[]) => {\n            const blockIds = blocks.map(({ props }) => {\n              const {\n                xywh,\n                scale,\n                messages,\n                sessionId,\n                rootDocId,\n                rootWorkspaceId,\n              } = props;\n              const blockId = component.service.addBlock(\n                AIChatBlockFlavour,\n                {\n                  xywh,\n                  scale,\n                  messages,\n                  sessionId,\n                  rootDocId,\n                  rootWorkspaceId,\n                },\n                component.surface.model.id\n              );\n              return blockId;\n            });\n            return blockIds;\n          };\n          component.clipboardController.registerBlock(\n            AIChatBlockFlavour,\n            createFunc\n          );\n        }\n      })\n    );\n  };\n\n  return specs;\n}\n\n@customElement('affine-linked-doc-ref-block')\n// @ts-expect-error ignore private warning for overriding _load\nexport class LinkedDocBlockComponent extends EmbedLinkedDocBlockComponent {\n  override async _load() {\n    this.isBannerEmpty = true;\n  }\n}\n\nexport function patchForSharedPage(specs: BlockSpec[]) {\n  return specs.map(spec => {\n    const linkedDocNames = [\n      'affine:embed-linked-doc',\n      'affine:embed-synced-doc',\n    ];\n\n    if (linkedDocNames.includes(spec.schema.model.flavour)) {\n      spec = {\n        ...spec,\n        view: {\n          component: literal`affine-linked-doc-ref-block`,\n          widgets: {},\n        },\n      };\n    }\n    return spec;\n  });\n}\n","import \"../core/src/components/blocksuite/block-suite-editor/bi-directional-link-panel.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/blocksuite/block-suite-editor/bi-directional-link-panel.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACo1U0Y7aMBB8z1fsS6VDqlHCAUXhKvVPKifehG2D7bMdElrx71Ucw5mQ6njMeL0zOzvx8meWmtPuvUjhbwLQkXCHHLI0/bJPAI68ZwE6cfPCGK8qkshQkFNmPFqMhaYmyRqsXA68dSoCDdWHCNVcCJJ1qJ1ra0kgC2VfYbVexNdCt6fvVUo6ZukPTu54vOAWF/vkkiyvNmTehgOOLNlW9/tHWwRZ3fBzDlWD/vxXax1VZ1Yq6VC6HEqUDs1wxBuqJSOHR/sBR4QrT1jw8ndtVCvFRGahjEDDStUo4+e5SkuXmxltUeNX3/hzqVbzElmBrkOUzyhe+8bevy6I2aTpxOssqGuGIa6aV+sR9NNMBnXYO6YNHbk538aNWDdxPjdhL7fGu/E7uGW4oNbmcIfmkOkerGpIfGLxxzLYnNLuQA59odfs7Yo3HruwmnMhyJpz8GlnAMrW2KFWK3pY0dabFf6/QjmnjtcwR1XffNV/KS2WSop70usMr3ODjWBEsJt7U6YtHhI6mz+AmuscQoD8CphPbg5SdYbrgfjHEGpOEg2cCDutjIMXTw9v32G7TnW/8JKW96/e7XXJIb2F9JJc/gFnHnxuHQUAAA==\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var container = '_10rv8qb0';\nexport var divider = '_10rv8qb2';\nexport var dividerContainer = '_10rv8qb1';\nexport var link = '_10rv8qb8';\nexport var linksContainer = '_10rv8qb6';\nexport var linksTitles = '_10rv8qb7';\nexport var showButton = '_10rv8qb5';\nexport var title = '_10rv8qb4';\nexport var titleLine = '_10rv8qb3';","import { DocLinksService } from '@affine/core/modules/doc-link';\nimport {\n  useLiveData,\n  useServices,\n  WorkspaceService,\n} from '@toeverything/infra';\nimport { useCallback, useState } from 'react';\n\nimport { AffinePageReference } from '../../affine/reference-link';\nimport * as styles from './bi-directional-link-panel.css';\n\nexport const BiDirectionalLinkPanel = () => {\n  const [show, setShow] = useState(false);\n  const { docLinksService, workspaceService } = useServices({\n    DocLinksService,\n    WorkspaceService,\n  });\n\n  const links = useLiveData(docLinksService.links.links$);\n  const backlinks = useLiveData(docLinksService.backlinks.backlinks$);\n\n  const handleClickShow = useCallback(() => {\n    setShow(!show);\n  }, [show]);\n\n  return (\n    <div className={styles.container}>\n      {!show && (\n        <div className={styles.dividerContainer}>\n          <div className={styles.divider}></div>\n        </div>\n      )}\n\n      <div className={styles.titleLine}>\n        <div className={styles.title}>Bi-Directional Links</div>\n        <div className={styles.showButton} onClick={handleClickShow}>\n          {show ? 'Hide' : 'Show'}\n        </div>\n      </div>\n\n      {show && (\n        <>\n          <div className={styles.dividerContainer}>\n            <div className={styles.divider}></div>\n          </div>\n          <div className={styles.linksContainer}>\n            <div className={styles.linksTitles}>\n              Backlinks  {backlinks.length}\n            </div>\n            {backlinks.map(link => (\n              <div key={link.docId} className={styles.link}>\n                <AffinePageReference\n                  key={link.docId}\n                  pageId={link.docId}\n                  docCollection={workspaceService.workspace.docCollection}\n                />\n              </div>\n            ))}\n          </div>\n          <div className={styles.linksContainer}>\n            <div className={styles.linksTitles}>\n              Outgoing links  {links.length}\n            </div>\n            {links.map(link => (\n              <div key={link.docId} className={styles.link}>\n                <AffinePageReference\n                  pageId={link.docId}\n                  docCollection={workspaceService.workspace.docCollection}\n                />\n              </div>\n            ))}\n          </div>\n        </>\n      )}\n    </div>\n  );\n};\n","import { useJournalInfoHelper } from '@affine/core/hooks/use-journal';\nimport { useI18n } from '@affine/i18n';\nimport type { Doc } from '@blocksuite/store';\n\nimport * as styles from './styles.css';\n\nexport const BlocksuiteEditorJournalDocTitle = ({ page }: { page: Doc }) => {\n  const { localizedJournalDate, isTodayJournal, journalDate } =\n    useJournalInfoHelper(page.collection, page.id);\n  const t = useI18n();\n\n  // TODO(catsjuice): i18n\n  const day = journalDate?.format('dddd') ?? null;\n\n  return (\n    <span className=\"doc-title-container\">\n      <span>{localizedJournalDate}</span>\n      {isTodayJournal ? (\n        <span className={styles.titleTodayTag}>{t['com.affine.today']()}</span>\n      ) : (\n        <span className={styles.titleDayTag}>{day}</span>\n      )}\n    </span>\n  );\n};\n","import \"../core/src/components/blocksuite/block-suite-editor/styles.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/blocksuite/block-suite-editor/styles.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll82YXozbGcwIHsKICBkaXNwbGF5OiBibG9jazsKICBiYWNrZ3JvdW5kOiB2YXIoLS1hZmZpbmUtYmFja2dyb3VuZC1wcmltYXJ5LWNvbG9yKTsKICBvdmVyZmxvdy14OiBjbGlwOwp9Ci5fNmF6M2xnMSB7CiAgZGlzcGxheTogZmxleDsKICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogIHBhZGRpbmctYm90dG9tOiAxMDBweDsKfQouXzZhejNsZzIgewogIGRpc3BsYXk6IGJsb2NrOwp9Ci5fNmF6M2xnMjpoYXMoYWZmaW5lLWFpLXBhbmVsLXdpZGdldFtkYXRhLXN0YXRlPSdnZW5lcmF0aW5nJ10pIHsKICBwYWRkaW5nLWJvdHRvbTogOTgwcHg7Cn0KLl82YXozbGcyOmhhcyhhZmZpbmUtYWktcGFuZWwtd2lkZ2V0W2RhdGEtc3RhdGU9J2ZpbmlzaGVkJ10pIHsKICBwYWRkaW5nLWJvdHRvbTogOTgwcHg7Cn0KLl82YXozbGcyOmhhcyhhZmZpbmUtYWktcGFuZWwtd2lkZ2V0W2RhdGEtc3RhdGU9J2Vycm9yJ10pIHsKICBwYWRkaW5nLWJvdHRvbTogOTgwcHg7Cn0KLl82YXozbGczIHsKICBkaXNwbGF5OiBibG9jazsKICB3aWR0aDogMTAwJTsKICBtYXJnaW46IDAgYXV0bzsKICBwYWRkaW5nLXRvcDogNTBweDsKICBwYWRkaW5nLWJvdHRvbTogNTBweDsKICBjdXJzb3I6IHRleHQ7CiAgZmxleC1ncm93OiAxOwp9Ci5fNmF6M2xnNCB7CiAgZm9udC1zaXplOiB2YXIoLS1hZmZpbmUtZm9udC1oLTQpOwogIGZvbnQtd2VpZ2h0OiA2MDA7CiAgcGFkZGluZzogMCA0cHg7CiAgYm9yZGVyLXJhZGl1czogNHB4OwogIG1hcmdpbi1sZWZ0OiA0cHg7Cn0KLl82YXozbGc1IHsKICBjb2xvcjogdmFyKC0tYWZmaW5lLXRleHQtc2Vjb25kYXJ5LWNvbG9yKTsKfQouXzZhejNsZzYgewogIGNvbG9yOiB2YXIoLS1hZmZpbmUtYnJhbmQtY29sb3IpOwp9Ci5fNmF6M2xnNyB7CiAgdmVydGljYWwtYWxpZ246IG1pZGRsZTsKICBmb250LXNpemU6IDEuMWVtOwogIHRyYW5zZm9ybTogdHJhbnNsYXRlKDJweCwgLTFweCk7Cn0=\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var affineDocViewport = '_6az3lg1';\nexport var docContainer = '_6az3lg2';\nexport var docEditorGap = '_6az3lg3';\nexport var docEditorRoot = '_6az3lg0';\nexport var pageReferenceIcon = '_6az3lg7';\nexport var titleDayTag = '_6az3lg5 _6az3lg4';\nexport var titleTodayTag = '_6az3lg6 _6az3lg4';","import type { BlockSpec } from '@blocksuite/block-std';\nimport {\n  AttachmentBlockService,\n  AttachmentBlockSpec,\n} from '@blocksuite/blocks';\nimport bytes from 'bytes';\n\nclass CustomAttachmentBlockService extends AttachmentBlockService {\n  override mounted(): void {\n    // blocksuite default max file size is 10MB, we override it to 2GB\n    // but the real place to limit blob size is CloudQuotaModal / LocalQuotaModal\n    this.maxFileSize = bytes.parse('2GB');\n    super.mounted();\n  }\n}\n\nexport const CustomAttachmentBlockSpec: BlockSpec = {\n  ...AttachmentBlockSpec,\n  service: CustomAttachmentBlockService,\n};\n","import {\n  AICodeBlockSpec,\n  AIImageBlockSpec,\n  AIParagraphBlockSpec,\n} from '@affine/core/blocksuite/presets/ai';\nimport type { BlockSpec } from '@blocksuite/block-std';\nimport {\n  BookmarkBlockSpec,\n  DatabaseBlockSpec,\n  DataViewBlockSpec,\n  DividerBlockSpec,\n  EmbedFigmaBlockSpec,\n  EmbedGithubBlockSpec,\n  EmbedHtmlBlockSpec,\n  EmbedLinkedDocBlockSpec,\n  EmbedLoomBlockSpec,\n  EmbedSyncedDocBlockSpec,\n  EmbedYoutubeBlockSpec,\n  ListBlockSpec,\n  NoteBlockSpec,\n} from '@blocksuite/blocks';\nimport { AIChatBlockSpec, EdgelessAIChatBlockSpec } from '@blocksuite/presets';\n\nimport { CustomAttachmentBlockSpec } from './custom/attachment-block';\n\nexport const CommonBlockSpecs: BlockSpec[] = [\n  ListBlockSpec,\n  NoteBlockSpec,\n  DatabaseBlockSpec,\n  DataViewBlockSpec,\n  DividerBlockSpec,\n  BookmarkBlockSpec,\n  EmbedFigmaBlockSpec,\n  EmbedGithubBlockSpec,\n  EmbedYoutubeBlockSpec,\n  EmbedLoomBlockSpec,\n  EmbedHtmlBlockSpec,\n  EmbedSyncedDocBlockSpec,\n  EmbedLinkedDocBlockSpec,\n  // special\n  CustomAttachmentBlockSpec,\n  AICodeBlockSpec,\n  AIImageBlockSpec,\n  AIParagraphBlockSpec,\n  AIChatBlockSpec,\n  EdgelessAIChatBlockSpec,\n];\n","import { track } from '@affine/core/mixpanel';\nimport { WorkspacePropertiesAdapter } from '@affine/core/modules/properties';\nimport { I18n, i18nTime } from '@affine/i18n';\nimport type { EditorHost } from '@blocksuite/block-std';\nimport type { AffineInlineEditor } from '@blocksuite/blocks';\nimport { LinkedWidgetUtils } from '@blocksuite/blocks';\nimport {\n  LinkedEdgelessIcon,\n  LinkedPageIcon,\n  TodayIcon,\n} from '@blocksuite/icons/lit';\nimport type { DocMeta } from '@blocksuite/store';\nimport {\n  DocsService,\n  type FrameworkProvider,\n  WorkspaceService,\n} from '@toeverything/infra';\n\nexport function createLinkedWidgetConfig(framework: FrameworkProvider) {\n  return {\n    getMenus: (\n      query: string,\n      abort: () => void,\n      editorHost: EditorHost,\n      inlineEditor: AffineInlineEditor\n    ) => {\n      const currentWorkspace = framework.get(WorkspaceService).workspace;\n      const rawMetas = currentWorkspace.docCollection.meta.docMetas;\n      const adapter = framework.get(WorkspacePropertiesAdapter);\n      const isJournal = (d: DocMeta) =>\n        !!adapter.getJournalPageDateString(d.id);\n\n      const docMetas = rawMetas\n        .filter(meta => {\n          if (isJournal(meta) && !meta.updatedDate) {\n            return false;\n          }\n          return !meta.trash;\n        })\n        .map(meta => {\n          if (isJournal(meta)) {\n            const date = adapter.getJournalPageDateString(meta.id);\n            if (date) {\n              const title = i18nTime(date, { absolute: { accuracy: 'day' } });\n              return { ...meta, title };\n            }\n          }\n          if (!meta.title) {\n            const title = I18n['Untitled']();\n            return { ...meta, title };\n          }\n          return meta;\n        })\n        .filter(({ title }) => isFuzzyMatch(title, query));\n\n      // TODO need i18n if BlockSuite supported\n      const MAX_DOCS = 6;\n      const docsService = framework.get(DocsService);\n      const isEdgeless = (d: DocMeta) =>\n        docsService.list.getMode(d.id) === 'edgeless';\n      return Promise.resolve([\n        {\n          name: 'Link to Doc',\n          items: docMetas.map(doc => ({\n            key: doc.id,\n            name: doc.title,\n            icon: isJournal(doc)\n              ? TodayIcon()\n              : isEdgeless(doc)\n                ? LinkedEdgelessIcon()\n                : LinkedPageIcon(),\n            action: () => {\n              abort();\n              LinkedWidgetUtils.insertLinkedNode({\n                inlineEditor,\n                docId: doc.id,\n              });\n              track.doc.editor.atMenu.linkDoc();\n            },\n          })),\n          maxDisplay: MAX_DOCS,\n          overflowText: `${docMetas.length - MAX_DOCS} more docs`,\n        },\n        LinkedWidgetUtils.createNewDocMenuGroup(\n          query,\n          abort,\n          editorHost,\n          inlineEditor\n        ),\n      ]);\n    },\n  };\n}\n\n/**\n * Checks if the name is a fuzzy match of the query.\n *\n * @example\n * ```ts\n * const name = 'John Smith';\n * const query = 'js';\n * const isMatch = isFuzzyMatch(name, query);\n * // isMatch: true\n * ```\n */\nfunction isFuzzyMatch(name: string, query: string) {\n  const pureName = name\n    .trim()\n    .toLowerCase()\n    .split('')\n    .filter(char => char !== ' ')\n    .join('');\n\n  const regex = new RegExp(\n    query\n      .split('')\n      .filter(char => char !== ' ')\n      .map(item => `${escapeRegExp(item)}.*`)\n      .join(''),\n    'i'\n  );\n  return regex.test(pureName);\n}\n\nfunction escapeRegExp(input: string) {\n  // escape regex characters in the input string to prevent regex format errors\n  return input.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n}\n","import {\n  AIEdgelessRootBlockSpec,\n  AIPageRootBlockSpec,\n} from '@affine/core/blocksuite/presets/ai';\nimport { mixpanel } from '@affine/core/mixpanel';\nimport type {\n  EdgelessRootBlockSpecType,\n  PageRootBlockSpecType,\n  RootService,\n  TelemetryEventMap,\n} from '@blocksuite/blocks';\nimport {\n  AffineCanvasTextFonts,\n  EdgelessRootService,\n  PageRootService,\n} from '@blocksuite/blocks';\nimport { type FrameworkProvider } from '@toeverything/infra';\n\nimport { createLinkedWidgetConfig } from './linked-widget';\n\nfunction customLoadFonts(service: RootService): void {\n  if (runtimeConfig.isSelfHosted) {\n    const fonts = AffineCanvasTextFonts.map(font => ({\n      ...font,\n      // self-hosted fonts are served from /assets\n      url: '/assets/' + new URL(font.url).pathname.split('/').pop(),\n    }));\n    service.fontLoader.load(fonts);\n  } else {\n    service.fontLoader.load(AffineCanvasTextFonts);\n  }\n}\n\nfunction withAffineRootService(Service: typeof RootService) {\n  return class extends Service {\n    override loadFonts(): void {\n      customLoadFonts(this);\n    }\n\n    override telemetryService = {\n      track: <T extends keyof TelemetryEventMap>(\n        eventName: T,\n        props: TelemetryEventMap[T]\n      ) => {\n        mixpanel.track(eventName as string, props as Record<string, unknown>);\n      },\n    };\n  };\n}\n\nexport function createPageRootBlockSpec(\n  framework: FrameworkProvider\n): PageRootBlockSpecType {\n  return {\n    ...AIPageRootBlockSpec,\n    service: withAffineRootService(PageRootService),\n    config: {\n      linkedWidget: createLinkedWidgetConfig(framework),\n    },\n  };\n}\n\nexport function createEdgelessRootBlockSpec(\n  framework: FrameworkProvider\n): EdgelessRootBlockSpecType {\n  return {\n    ...AIEdgelessRootBlockSpec,\n    service: withAffineRootService(EdgelessRootService),\n    config: {\n      linkedWidget: createLinkedWidgetConfig(framework),\n    },\n  };\n}\n","import {\n  createReactComponentFromLit,\n  useConfirmModal,\n  useLitPortalFactory,\n} from '@affine/component';\nimport { useJournalInfoHelper } from '@affine/core/hooks/use-journal';\nimport { PeekViewService } from '@affine/core/modules/peek-view';\nimport { WorkbenchService } from '@affine/core/modules/workbench';\nimport type { DocMode } from '@blocksuite/blocks';\nimport {\n  DocMetaTags,\n  DocTitle,\n  EdgelessEditor,\n  PageEditor,\n} from '@blocksuite/presets';\nimport type { Doc } from '@blocksuite/store';\nimport {\n  DocService,\n  DocsService,\n  useFramework,\n  useLiveData,\n  useService,\n} from '@toeverything/infra';\nimport React, {\n  forwardRef,\n  Fragment,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\n\nimport { PagePropertiesTable } from '../../affine/page-properties';\nimport { AffinePageReference } from '../../affine/reference-link';\nimport { BiDirectionalLinkPanel } from './bi-directional-link-panel';\nimport { BlocksuiteEditorJournalDocTitle } from './journal-doc-title';\nimport {\n  patchDocModeService,\n  patchEdgelessClipboard,\n  patchForSharedPage,\n  patchNotificationService,\n  patchPeekViewService,\n  patchQuickSearchService,\n  patchReferenceRenderer,\n  type ReferenceReactRenderer,\n} from './specs/custom/spec-patchers';\nimport { createEdgelessModeSpecs } from './specs/edgeless';\nimport { createPageModeSpecs } from './specs/page';\nimport * as styles from './styles.css';\n\nconst adapted = {\n  DocEditor: createReactComponentFromLit({\n    react: React,\n    elementClass: PageEditor,\n  }),\n  DocTitle: createReactComponentFromLit({\n    react: React,\n    elementClass: DocTitle,\n  }),\n  PageMetaTags: createReactComponentFromLit({\n    react: React,\n    elementClass: DocMetaTags,\n  }),\n  EdgelessEditor: createReactComponentFromLit({\n    react: React,\n    elementClass: EdgelessEditor,\n  }),\n};\n\ninterface BlocksuiteEditorProps {\n  page: Doc;\n  shared?: boolean;\n}\n\nconst usePatchSpecs = (page: Doc, shared: boolean, mode: DocMode) => {\n  const [reactToLit, portals] = useLitPortalFactory();\n  const peekViewService = useService(PeekViewService);\n  const docService = useService(DocService);\n  const docsService = useService(DocsService);\n  const framework = useFramework();\n  const referenceRenderer: ReferenceReactRenderer = useMemo(() => {\n    return function customReference(reference) {\n      const pageId = reference.delta.attributes?.reference?.pageId;\n      if (!pageId) return <span />;\n      return (\n        <AffinePageReference docCollection={page.collection} pageId={pageId} />\n      );\n    };\n  }, [page.collection]);\n\n  const specs = useMemo(() => {\n    return mode === 'edgeless'\n      ? createEdgelessModeSpecs(framework)\n      : createPageModeSpecs(framework);\n  }, [mode, framework]);\n\n  const confirmModal = useConfirmModal();\n  const patchedSpecs = useMemo(() => {\n    let patched = patchReferenceRenderer(specs, reactToLit, referenceRenderer);\n    patched = patchNotificationService(\n      patchReferenceRenderer(patched, reactToLit, referenceRenderer),\n      confirmModal\n    );\n    patched = patchPeekViewService(patched, peekViewService);\n    patched = patchEdgelessClipboard(patched);\n    if (!page.readonly) {\n      patched = patchQuickSearchService(patched, framework);\n    }\n    if (shared) {\n      patched = patchForSharedPage(patched);\n    }\n    patched = patchDocModeService(patched, docService, docsService);\n    return patched;\n  }, [\n    confirmModal,\n    docService,\n    docsService,\n    framework,\n    page.readonly,\n    peekViewService,\n    reactToLit,\n    referenceRenderer,\n    shared,\n    specs,\n  ]);\n\n  return [\n    patchedSpecs,\n    useMemo(\n      () => (\n        <>\n          {portals.map(p => (\n            <Fragment key={p.id}>{p.portal}</Fragment>\n          ))}\n        </>\n      ),\n      [portals]\n    ),\n  ] as const;\n};\n\nexport const BlocksuiteDocEditor = forwardRef<\n  PageEditor,\n  BlocksuiteEditorProps\n>(function BlocksuiteDocEditor({ page, shared }, ref) {\n  const titleRef = useRef<DocTitle>(null);\n  const docRef = useRef<PageEditor | null>(null);\n  const [docPage, setDocPage] =\n    useState<HTMLElementTagNameMap['affine-page-root']>();\n  const { isJournal } = useJournalInfoHelper(page.collection, page.id);\n\n  const workbench = useService(WorkbenchService).workbench;\n  const activeView = useLiveData(workbench.activeView$);\n  const hash = useLiveData(activeView.location$).hash;\n\n  const onDocRef = useCallback(\n    (el: PageEditor) => {\n      docRef.current = el;\n      if (ref) {\n        if (typeof ref === 'function') {\n          ref(el);\n        } else {\n          ref.current = el;\n        }\n      }\n    },\n    [ref]\n  );\n\n  useEffect(() => {\n    // auto focus the title\n    setTimeout(() => {\n      const docPage = docRef.current?.querySelector('affine-page-root');\n      if (docPage) {\n        setDocPage(docPage);\n      }\n      if (titleRef.current && !hash) {\n        const richText = titleRef.current.querySelector('rich-text');\n        richText?.inlineEditor?.focusEnd();\n      } else {\n        docPage?.focusFirstParagraph();\n      }\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const [specs, portals] = usePatchSpecs(page, !!shared, 'page');\n\n  return (\n    <>\n      <div className={styles.affineDocViewport} style={{ height: '100%' }}>\n        {!isJournal ? (\n          <adapted.DocTitle doc={page} ref={titleRef} />\n        ) : (\n          <BlocksuiteEditorJournalDocTitle page={page} />\n        )}\n        <PagePropertiesTable docId={page.id} />\n        <adapted.DocEditor\n          className={styles.docContainer}\n          ref={onDocRef}\n          doc={page}\n          specs={specs}\n          hasViewport={false}\n        />\n        {docPage && !page.readonly ? (\n          <div\n            className={styles.docEditorGap}\n            onClick={() => {\n              docPage.std.spec.getService('affine:page').appendParagraph();\n            }}\n          ></div>\n        ) : null}\n        {!page.readonly ? <BiDirectionalLinkPanel /> : null}\n      </div>\n      {portals}\n    </>\n  );\n});\nexport const BlocksuiteEdgelessEditor = forwardRef<\n  EdgelessEditor,\n  BlocksuiteEditorProps\n>(function BlocksuiteEdgelessEditor({ page, shared }, ref) {\n  const [specs, portals] = usePatchSpecs(page, !!shared, 'edgeless');\n  const editorRef = useRef<EdgelessEditor | null>(null);\n\n  const onDocRef = useCallback(\n    (el: EdgelessEditor) => {\n      editorRef.current = el;\n      if (ref) {\n        if (typeof ref === 'function') {\n          ref(el);\n        } else {\n          ref.current = el;\n        }\n      }\n    },\n    [ref]\n  );\n\n  useEffect(() => {\n    if (editorRef.current) {\n      editorRef.current.updateComplete\n        .then(() => {\n          // make sure editor can get keyboard events on showing up\n          editorRef.current?.querySelector('affine-edgeless-root')?.click();\n        })\n        .catch(console.error);\n    }\n  }, []);\n\n  return (\n    <>\n      <adapted.EdgelessEditor ref={onDocRef} doc={page} specs={specs} />\n      {portals}\n    </>\n  );\n});\n","import type { BlockSpec } from '@blocksuite/block-std';\nimport {\n  EdgelessNoteBlockSpec,\n  EdgelessSurfaceBlockSpec,\n  EdgelessSurfaceRefBlockSpec,\n  EdgelessTextBlockSpec,\n  FrameBlockSpec,\n} from '@blocksuite/blocks';\nimport type { FrameworkProvider } from '@toeverything/infra';\n\nimport { CommonBlockSpecs } from './common';\nimport { createEdgelessRootBlockSpec } from './custom/root-block';\n\nexport function createEdgelessModeSpecs(\n  framework: FrameworkProvider\n): BlockSpec[] {\n  return [\n    ...CommonBlockSpecs,\n    EdgelessSurfaceBlockSpec,\n    EdgelessSurfaceRefBlockSpec,\n    FrameBlockSpec,\n    EdgelessTextBlockSpec,\n    EdgelessNoteBlockSpec,\n    // special\n    createEdgelessRootBlockSpec(framework),\n  ];\n}\n","import type { BlockSpec } from '@blocksuite/block-std';\nimport {\n  PageSurfaceBlockSpec,\n  PageSurfaceRefBlockSpec,\n} from '@blocksuite/blocks';\nimport { type FrameworkProvider } from '@toeverything/infra';\n\nimport { CommonBlockSpecs } from './common';\nimport { createPageRootBlockSpec } from './custom/root-block';\n\nexport function createPageModeSpecs(framework: FrameworkProvider): BlockSpec[] {\n  return [\n    ...CommonBlockSpecs,\n    PageSurfaceBlockSpec,\n    PageSurfaceRefBlockSpec,\n    // special\n    createPageRootBlockSpec(framework),\n  ];\n}\n","import type { BlockComponent } from '@blocksuite/block-std';\nimport type {\n  AffineEditorContainer,\n  EdgelessEditor,\n  PageEditor,\n} from '@blocksuite/presets';\nimport type { Doc } from '@blocksuite/store';\nimport { Slot } from '@blocksuite/store';\nimport { type DocMode } from '@toeverything/infra';\nimport clsx from 'clsx';\nimport type React from 'react';\nimport type { RefObject } from 'react';\nimport {\n  forwardRef,\n  useEffect,\n  useLayoutEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\n\nimport { BlocksuiteDocEditor, BlocksuiteEdgelessEditor } from './lit-adaper';\nimport * as styles from './styles.css';\n\n// copy forwardSlot from blocksuite, but it seems we need to dispose the pipe\n// after the component is unmounted right?\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction forwardSlot<T extends Record<string, Slot<any>>>(\n  from: T,\n  to: Partial<T>\n) {\n  Object.entries(from).forEach(([key, slot]) => {\n    const target = to[key];\n    if (target) {\n      slot.pipe(target);\n    }\n  });\n}\n\ninterface BlocksuiteEditorContainerProps {\n  page: Doc;\n  mode: DocMode;\n  shared?: boolean;\n  className?: string;\n  style?: React.CSSProperties;\n  defaultSelectedBlockId?: string;\n}\n\n// mimic the interface of the webcomponent and expose slots & host\ntype BlocksuiteEditorContainerRef = Pick<\n  (typeof AffineEditorContainer)['prototype'],\n  'mode' | 'doc' | 'slots' | 'host'\n> &\n  HTMLDivElement;\n\nfunction findBlockElementById(container: HTMLElement, blockId: string) {\n  const element = container.querySelector(\n    `[data-block-id=\"${blockId}\"]`\n  ) as BlockComponent | null;\n  return element;\n}\n\n// a workaround for returning the webcomponent for the given block id\n// by iterating over the children of the rendered dom tree\nconst useBlockElementById = (\n  containerRef: RefObject<HTMLElement | null>,\n  blockId: string | undefined,\n  timeout = 1000\n) => {\n  const [blockElement, setBlockElement] = useState<BlockComponent | null>(null);\n  useEffect(() => {\n    if (!blockId) {\n      return;\n    }\n    let canceled = false;\n    const start = Date.now();\n    function run() {\n      if (canceled || !containerRef.current || !blockId) {\n        return;\n      }\n      const element = findBlockElementById(containerRef.current, blockId);\n      if (element) {\n        setBlockElement(element);\n      } else if (Date.now() - start < timeout) {\n        setTimeout(run, 100);\n      }\n    }\n    run();\n    return () => {\n      canceled = true;\n    };\n  }, [blockId, containerRef, timeout]);\n  return blockElement;\n};\n\nexport const BlocksuiteEditorContainer = forwardRef<\n  AffineEditorContainer,\n  BlocksuiteEditorContainerProps\n>(function AffineEditorContainer(\n  { page, mode, className, style, defaultSelectedBlockId, shared },\n  ref\n) {\n  const scrolledRef = useRef(false);\n  const hashChangedRef = useRef(false);\n  const rootRef = useRef<HTMLDivElement>(null);\n  const docRef = useRef<PageEditor>(null);\n  const edgelessRef = useRef<EdgelessEditor>(null);\n\n  const slots: BlocksuiteEditorContainerRef['slots'] = useMemo(() => {\n    return {\n      docLinkClicked: new Slot(),\n      editorModeSwitched: new Slot(),\n      docUpdated: new Slot(),\n      tagClicked: new Slot(),\n    };\n  }, []);\n\n  // forward the slot to the webcomponent\n  useLayoutEffect(() => {\n    requestAnimationFrame(() => {\n      const docPage = rootRef.current?.querySelector('affine-page-root');\n      const edgelessPage = rootRef.current?.querySelector(\n        'affine-edgeless-root'\n      );\n      if (docPage) {\n        forwardSlot(docPage.slots, slots);\n      }\n\n      if (edgelessPage) {\n        forwardSlot(edgelessPage.slots, slots);\n      }\n    });\n  }, [page, slots]);\n\n  useLayoutEffect(() => {\n    slots.docUpdated.emit({ newDocId: page.id });\n  }, [page, slots.docUpdated]);\n\n  useLayoutEffect(() => {\n    slots.editorModeSwitched.emit(mode);\n  }, [mode, slots.editorModeSwitched]);\n\n  /**\n   * mimic an AffineEditorContainer using proxy\n   */\n  const affineEditorContainerProxy = useMemo(() => {\n    const api = {\n      slots,\n      get page() {\n        return page;\n      },\n      get doc() {\n        return page;\n      },\n      get host() {\n        return mode === 'page'\n          ? docRef.current?.host\n          : edgelessRef.current?.host;\n      },\n      get model() {\n        return page.root as any;\n      },\n      get updateComplete() {\n        return mode === 'page'\n          ? docRef.current?.updateComplete\n          : edgelessRef.current?.updateComplete;\n      },\n      get mode() {\n        return mode;\n      },\n    };\n\n    const proxy = new Proxy(api, {\n      has(_, prop) {\n        return (\n          Reflect.has(api, prop) ||\n          (rootRef.current ? Reflect.has(rootRef.current, prop) : false)\n        );\n      },\n      get(_, prop) {\n        if (Reflect.has(api, prop)) {\n          return api[prop as keyof typeof api];\n        }\n        if (rootRef.current && Reflect.has(rootRef.current, prop)) {\n          const maybeFn = Reflect.get(rootRef.current, prop);\n          if (typeof maybeFn === 'function') {\n            return maybeFn.bind(rootRef.current);\n          } else {\n            return maybeFn;\n          }\n        }\n        return undefined;\n      },\n    }) as unknown as AffineEditorContainer;\n\n    return proxy;\n  }, [mode, page, slots]);\n\n  useEffect(() => {\n    if (ref) {\n      if (typeof ref === 'function') {\n        ref(affineEditorContainerProxy);\n      } else {\n        ref.current = affineEditorContainerProxy;\n      }\n    }\n  }, [affineEditorContainerProxy, ref]);\n\n  const blockElement = useBlockElementById(rootRef, defaultSelectedBlockId);\n\n  useEffect(() => {\n    let canceled = false;\n    const handleScrollToBlock = (blockElement: BlockComponent) => {\n      if (!mode || !blockElement) {\n        return;\n      }\n      blockElement.scrollIntoView({\n        behavior: 'instant',\n        block: 'center',\n      });\n      const selectManager = affineEditorContainerProxy.host?.selection;\n      if (!blockElement.path.length || !selectManager) {\n        return;\n      }\n      const newSelection = selectManager.create('block', {\n        blockId: blockElement.blockId,\n      });\n      selectManager.set([newSelection]);\n    };\n    affineEditorContainerProxy.updateComplete\n      .then(() => {\n        if (\n          blockElement &&\n          !scrolledRef.current &&\n          !canceled &&\n          !hashChangedRef.current\n        ) {\n          handleScrollToBlock(blockElement);\n          scrolledRef.current = true;\n        }\n      })\n      .catch(console.error);\n    return () => {\n      canceled = true;\n    };\n  }, [blockElement, affineEditorContainerProxy, mode]);\n\n  return (\n    <div\n      data-testid={`editor-${page.id}`}\n      className={clsx(\n        `editor-wrapper ${mode}-mode`,\n        styles.docEditorRoot,\n        className\n      )}\n      data-affine-editor-container\n      style={style}\n      ref={rootRef}\n    >\n      {mode === 'page' ? (\n        <BlocksuiteDocEditor shared={shared} page={page} ref={docRef} />\n      ) : (\n        <BlocksuiteEdgelessEditor\n          shared={shared}\n          page={page}\n          ref={edgelessRef}\n        />\n      )}\n    </div>\n  );\n});\n","import { EditorLoading } from '@affine/component/page-detail-skeleton';\nimport { assertExists } from '@blocksuite/global/utils';\nimport type { AffineEditorContainer } from '@blocksuite/presets';\nimport type { Doc } from '@blocksuite/store';\nimport { use } from 'foxact/use';\nimport type { CSSProperties, ReactElement } from 'react';\nimport {\n  forwardRef,\n  memo,\n  Suspense,\n  useCallback,\n  useEffect,\n  useRef,\n} from 'react';\n\nimport { BlocksuiteEditorContainer } from './blocksuite-editor-container';\nimport { NoPageRootError } from './no-page-error';\n\nexport type ErrorBoundaryProps = {\n  onReset?: () => void;\n};\n\nexport type EditorProps = {\n  page: Doc;\n  mode: 'page' | 'edgeless';\n  shared?: boolean;\n  defaultSelectedBlockId?: string;\n  // on Editor instance instantiated\n  onLoadEditor?: (editor: AffineEditorContainer) => () => void;\n  style?: CSSProperties;\n  className?: string;\n};\n\nfunction usePageRoot(page: Doc) {\n  if (!page.ready) {\n    page.load();\n  }\n\n  if (!page.root) {\n    use(\n      new Promise<void>((resolve, reject) => {\n        const disposable = page.slots.rootAdded.once(() => {\n          resolve();\n        });\n        window.setTimeout(() => {\n          disposable.dispose();\n          reject(new NoPageRootError(page));\n        }, 20 * 1000);\n      })\n    );\n  }\n\n  return page.root;\n}\n\nconst BlockSuiteEditorImpl = forwardRef<AffineEditorContainer, EditorProps>(\n  function BlockSuiteEditorImpl(\n    {\n      mode,\n      page,\n      className,\n      defaultSelectedBlockId,\n      onLoadEditor,\n      shared,\n      style,\n    },\n    ref\n  ) {\n    usePageRoot(page);\n    assertExists(page, 'page should not be null');\n    const editorDisposeRef = useRef<() => void>(() => {});\n    const editorRef = useRef<AffineEditorContainer | null>(null);\n\n    const onRefChange = useCallback(\n      (editor: AffineEditorContainer | null) => {\n        editorRef.current = editor;\n        if (ref) {\n          if (typeof ref === 'function') {\n            ref(editor);\n          } else {\n            ref.current = editor;\n          }\n        }\n        if (editor && onLoadEditor) {\n          editorDisposeRef.current = onLoadEditor(editor);\n        }\n      },\n      [onLoadEditor, ref]\n    );\n\n    useEffect(() => {\n      const disposable = page.slots.blockUpdated.once(() => {\n        page.collection.setDocMeta(page.id, {\n          updatedDate: Date.now(),\n        });\n      });\n      return () => {\n        disposable.dispose();\n      };\n    }, [page]);\n\n    useEffect(() => {\n      return () => {\n        editorDisposeRef.current();\n      };\n    }, []);\n\n    return (\n      <BlocksuiteEditorContainer\n        mode={mode}\n        page={page}\n        shared={shared}\n        ref={onRefChange}\n        className={className}\n        style={style}\n        defaultSelectedBlockId={defaultSelectedBlockId}\n      />\n    );\n  }\n);\n\nexport const BlockSuiteEditor = memo(\n  forwardRef<AffineEditorContainer, EditorProps>(\n    function BlockSuiteEditor(props, ref): ReactElement {\n      return (\n        <Suspense fallback={<EditorLoading />}>\n          <BlockSuiteEditorImpl key={props.page.id} ref={ref} {...props} />\n        </Suspense>\n      );\n    }\n  )\n);\n\nBlockSuiteEditor.displayName = 'BlockSuiteEditor';\n","export enum AIOnboardingType {\n  GENERAL = 'dismissAiOnboarding',\n  EDGELESS = 'dismissAiOnboardingEdgeless',\n  LOCAL = 'dismissAiOnboardingLocal',\n}\n","import { AIOnboardingType } from './type';\n\nfunction createStorageEvent(key: string, newValue: string) {\n  const event = new StorageEvent('storage', {\n    key,\n    newValue,\n    oldValue: localStorage.getItem(key),\n    storageArea: localStorage,\n  });\n  window.dispatchEvent(event);\n}\n\nconst setItem = function (key: string, value: string) {\n  const oldValue = localStorage.getItem(key);\n  localStorage.setItem.call(localStorage, key, value);\n  if (oldValue !== value) createStorageEvent(key, value);\n};\n\n/**\n * Show/Hide AI onboarding manually\n */\nexport const toggleGeneralAIOnboarding = (show = true) => {\n  setItem(AIOnboardingType.GENERAL, show ? 'false' : 'true');\n};\n\n/**\n * Show/Hide local AI toast manually\n */\nexport const toggleLocalAIOnboarding = (show = true) => {\n  setItem(AIOnboardingType.LOCAL, show ? 'false' : 'true');\n};\n\n/**\n * Show/Hide edgeless AI toast manually\n */\nexport const toggleEdgelessAIOnboarding = (show = true) => {\n  setItem(AIOnboardingType.EDGELESS, show ? 'false' : 'true');\n};\n","import { showAILoginRequiredAtom } from '@affine/core/components/affine/auth/ai-login-required';\nimport {\n  cleanupCopilotSessionMutation,\n  createCopilotMessageMutation,\n  createCopilotSessionMutation,\n  fetcher as defaultFetcher,\n  forkCopilotSessionMutation,\n  getBaseUrl,\n  getCopilotHistoriesQuery,\n  getCopilotHistoryIdsQuery,\n  getCopilotSessionsQuery,\n  GraphQLError,\n  type GraphQLQuery,\n  type QueryOptions,\n  type RequestOptions,\n  UserFriendlyError,\n} from '@affine/graphql';\nimport {\n  GeneralNetworkError,\n  PaymentRequiredError,\n  UnauthorizedError,\n} from '@blocksuite/blocks';\nimport { getCurrentStore } from '@toeverything/infra';\n\ntype OptionsField<T extends GraphQLQuery> =\n  RequestOptions<T>['variables'] extends { options: infer U } ? U : never;\n\nfunction codeToError(error: UserFriendlyError) {\n  switch (error.status) {\n    case 401:\n      return new UnauthorizedError();\n    case 402:\n      return new PaymentRequiredError();\n    default:\n      return new GeneralNetworkError(\n        error.code\n          ? `${error.code}: ${error.message}\\nIdentify: ${error.name}`\n          : undefined\n      );\n  }\n}\n\nexport function resolveError(err: any) {\n  const standardError =\n    err instanceof GraphQLError\n      ? new UserFriendlyError(err.extensions)\n      : UserFriendlyError.fromAnyError(err);\n\n  return codeToError(standardError);\n}\n\nexport function handleError(src: any) {\n  const err = resolveError(src);\n  if (err instanceof UnauthorizedError) {\n    getCurrentStore().set(showAILoginRequiredAtom, true);\n  }\n  return err;\n}\n\nconst fetcher = async <Query extends GraphQLQuery>(\n  options: QueryOptions<Query>\n) => {\n  try {\n    return await defaultFetcher<Query>(options);\n  } catch (err) {\n    throw handleError(err);\n  }\n};\n\nexport class CopilotClient {\n  readonly backendUrl = getBaseUrl();\n\n  async createSession(\n    options: OptionsField<typeof createCopilotSessionMutation>\n  ) {\n    const res = await fetcher({\n      query: createCopilotSessionMutation,\n      variables: {\n        options,\n      },\n    });\n    return res.createCopilotSession;\n  }\n\n  async forkSession(options: OptionsField<typeof forkCopilotSessionMutation>) {\n    const res = await fetcher({\n      query: forkCopilotSessionMutation,\n      variables: {\n        options,\n      },\n    });\n    return res.forkCopilotSession;\n  }\n\n  async createMessage(\n    options: OptionsField<typeof createCopilotMessageMutation>\n  ) {\n    const res = await fetcher({\n      query: createCopilotMessageMutation,\n      variables: {\n        options,\n      },\n    });\n    return res.createCopilotMessage;\n  }\n\n  async getSessions(workspaceId: string) {\n    const res = await fetcher({\n      query: getCopilotSessionsQuery,\n      variables: {\n        workspaceId,\n      },\n    });\n    return res.currentUser?.copilot;\n  }\n\n  async getHistories(\n    workspaceId: string,\n    docId?: string,\n    options?: RequestOptions<\n      typeof getCopilotHistoriesQuery\n    >['variables']['options']\n  ) {\n    const res = await fetcher({\n      query: getCopilotHistoriesQuery,\n      variables: {\n        workspaceId,\n        docId,\n        options,\n      },\n    });\n\n    return res.currentUser?.copilot?.histories;\n  }\n\n  async getHistoryIds(\n    workspaceId: string,\n    docId?: string,\n    options?: RequestOptions<\n      typeof getCopilotHistoriesQuery\n    >['variables']['options']\n  ) {\n    const res = await fetcher({\n      query: getCopilotHistoryIdsQuery,\n      variables: {\n        workspaceId,\n        docId,\n        options,\n      },\n    });\n\n    return res.currentUser?.copilot?.histories;\n  }\n\n  async cleanupSessions(input: {\n    workspaceId: string;\n    docId: string;\n    sessionIds: string[];\n  }) {\n    const res = await fetcher({\n      query: cleanupCopilotSessionMutation,\n      variables: {\n        input,\n      },\n    });\n    return res.cleanupCopilotSession;\n  }\n\n  async chatText({\n    sessionId,\n    messageId,\n    signal,\n  }: {\n    sessionId: string;\n    messageId?: string;\n    signal?: AbortSignal;\n  }) {\n    const url = new URL(`${this.backendUrl}/api/copilot/chat/${sessionId}`);\n    if (messageId) {\n      url.searchParams.set('messageId', messageId);\n    }\n    const response = await fetch(url.toString(), { signal });\n    return response.text();\n  }\n\n  // Text or image to text\n  chatTextStream(\n    {\n      sessionId,\n      messageId,\n    }: {\n      sessionId: string;\n      messageId?: string;\n    },\n    endpoint = 'stream'\n  ) {\n    const url = new URL(\n      `${this.backendUrl}/api/copilot/chat/${sessionId}/${endpoint}`\n    );\n    if (messageId) url.searchParams.set('messageId', messageId);\n    return new EventSource(url.toString());\n  }\n\n  // Text or image to images\n  imagesStream(\n    sessionId: string,\n    messageId?: string,\n    seed?: string,\n    endpoint = 'images'\n  ) {\n    const url = new URL(\n      `${this.backendUrl}/api/copilot/chat/${sessionId}/${endpoint}`\n    );\n    if (messageId) {\n      url.searchParams.set('messageId', messageId);\n    }\n    if (seed) {\n      url.searchParams.set('seed', seed);\n    }\n    return new EventSource(url);\n  }\n}\n","import { handleError } from './copilot-client';\n\nexport function delay(ms: number) {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nexport type AffineTextEvent = {\n  type: 'attachment' | 'message';\n  data: string;\n};\n\ntype AffineTextStream = AsyncIterable<AffineTextEvent>;\n\ntype toTextStreamOptions = {\n  timeout?: number;\n  signal?: AbortSignal;\n};\n\n// todo(@Peng): may need to extend the error type\nconst safeParseError = (data: string): { status: number } => {\n  try {\n    return JSON.parse(data);\n  } catch {\n    return {\n      status: 500,\n    };\n  }\n};\n\nexport function toTextStream(\n  eventSource: EventSource,\n  { timeout, signal }: toTextStreamOptions = {}\n): AffineTextStream {\n  return {\n    [Symbol.asyncIterator]: async function* () {\n      const messageQueue: AffineTextEvent[] = [];\n      let resolveMessagePromise: () => void;\n      let rejectMessagePromise: (err: Error) => void;\n\n      function resetMessagePromise() {\n        if (resolveMessagePromise) {\n          resolveMessagePromise();\n        }\n        return new Promise<void>((resolve, reject) => {\n          resolveMessagePromise = resolve;\n          rejectMessagePromise = reject;\n        });\n      }\n      let messagePromise = resetMessagePromise();\n\n      function messageListener(event: MessageEvent) {\n        messageQueue.push({\n          type: event.type as 'attachment' | 'message',\n          data: event.data as string,\n        });\n        messagePromise = resetMessagePromise();\n      }\n\n      eventSource.addEventListener('message', messageListener);\n      eventSource.addEventListener('attachment', messageListener);\n\n      eventSource.addEventListener('error', event => {\n        const errorMessage = (event as unknown as { data: string }).data;\n        // if there is data in Error event, it means the server sent an error message\n        // otherwise, the stream is finished successfully\n        if (event.type === 'error' && errorMessage) {\n          // try to parse the error message as a JSON object\n          const error = safeParseError(errorMessage);\n          rejectMessagePromise(handleError(error));\n        } else {\n          resolveMessagePromise();\n        }\n        eventSource.close();\n      });\n\n      try {\n        while (\n          eventSource.readyState !== EventSource.CLOSED &&\n          !signal?.aborted\n        ) {\n          if (messageQueue.length === 0) {\n            // Wait for the next message or timeout\n            await (timeout\n              ? Promise.race([\n                  messagePromise,\n                  delay(timeout).then(() => {\n                    if (!signal?.aborted) {\n                      throw new Error('Timeout');\n                    }\n                  }),\n                ])\n              : messagePromise);\n          } else if (messageQueue.length > 0) {\n            const top = messageQueue.shift();\n            if (top) {\n              yield top;\n            }\n          }\n        }\n      } finally {\n        eventSource.close();\n      }\n    },\n  };\n}\n","import { AIProvider } from '@affine/core/blocksuite/presets/ai';\nimport type { ForkChatSessionInput } from '@affine/graphql';\nimport { assertExists } from '@blocksuite/global/utils';\nimport { partition } from 'lodash-es';\n\nimport { CopilotClient } from './copilot-client';\nimport { delay, toTextStream } from './event-source';\nimport type { PromptKey } from './prompt';\n\nconst TIMEOUT = 50000;\n\nconst client = new CopilotClient();\n\nexport type TextToTextOptions = {\n  docId: string;\n  workspaceId: string;\n  promptName?: PromptKey;\n  sessionId?: string | Promise<string>;\n  content?: string;\n  attachments?: (string | Blob | File)[];\n  params?: Record<string, string>;\n  timeout?: number;\n  stream?: boolean;\n  signal?: AbortSignal;\n  retry?: boolean;\n  workflow?: boolean;\n  isRootSession?: boolean;\n  postfix?: (text: string) => string;\n};\n\nexport type ToImageOptions = TextToTextOptions & {\n  seed?: string;\n};\n\nexport function createChatSession({\n  workspaceId,\n  docId,\n}: {\n  workspaceId: string;\n  docId: string;\n}) {\n  return client.createSession({\n    workspaceId,\n    docId,\n    promptName: 'chat:gpt4',\n  });\n}\n\nexport function forkCopilotSession(forkChatSessionInput: ForkChatSessionInput) {\n  return client.forkSession(forkChatSessionInput);\n}\n\nasync function resizeImage(blob: Blob | File): Promise<Blob | null> {\n  let src = '';\n  try {\n    src = URL.createObjectURL(blob);\n    const img = new Image();\n    img.src = src;\n    await new Promise(resolve => {\n      img.onload = resolve;\n    });\n\n    const canvas = document.createElement('canvas');\n    // keep aspect ratio\n    const scale = Math.min(1024 / img.width, 1024 / img.height);\n    canvas.width = Math.floor(img.width * scale);\n    canvas.height = Math.floor(img.height * scale);\n\n    const ctx = canvas.getContext('2d');\n    if (ctx) {\n      ctx.imageSmoothingQuality = 'high';\n      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n      return new Promise(resolve =>\n        canvas.toBlob(blob => resolve(blob), 'image/jpeg', 0.8)\n      );\n    }\n  } catch (e) {\n    console.error(e);\n  } finally {\n    if (src) URL.revokeObjectURL(src);\n  }\n  return null;\n}\n\nasync function createSessionMessage({\n  docId,\n  workspaceId,\n  promptName,\n  content,\n  sessionId: providedSessionId,\n  attachments,\n  params,\n  retry = false,\n}: TextToTextOptions) {\n  if (!promptName && !providedSessionId) {\n    throw new Error('promptName or sessionId is required');\n  }\n  const hasAttachments = attachments && attachments.length > 0;\n  const sessionId = await (providedSessionId ??\n    client.createSession({\n      workspaceId,\n      docId,\n      promptName: promptName as string,\n    }));\n\n  const options: Parameters<CopilotClient['createMessage']>[0] = {\n    sessionId,\n    content,\n    params,\n  };\n\n  if (hasAttachments) {\n    const [stringAttachments, blobs] = partition(\n      attachments,\n      attachment => typeof attachment === 'string'\n    ) as [string[], (Blob | File)[]];\n    options.attachments = stringAttachments;\n    options.blobs = (\n      await Promise.all(\n        blobs.map(resizeImage).map(async blob => {\n          const file = await blob;\n          if (!file) return null;\n          return new File([file], sessionId, {\n            type: file.type,\n          });\n        })\n      )\n    ).filter(Boolean) as File[];\n  }\n  if (retry)\n    return {\n      sessionId,\n    };\n\n  const messageId = await client.createMessage(options);\n  return {\n    messageId,\n    sessionId,\n  };\n}\n\nexport function textToText({\n  docId,\n  workspaceId,\n  promptName,\n  content,\n  attachments,\n  params,\n  sessionId,\n  stream,\n  signal,\n  timeout = TIMEOUT,\n  retry = false,\n  workflow = false,\n  isRootSession = false,\n  postfix,\n}: TextToTextOptions) {\n  let _sessionId: string;\n  let _messageId: string | undefined;\n\n  if (stream) {\n    return {\n      [Symbol.asyncIterator]: async function* () {\n        if (retry) {\n          const retrySessionId =\n            (await sessionId) ?? AIProvider.LAST_ACTION_SESSIONID;\n          assertExists(retrySessionId, 'retry sessionId is required');\n          _sessionId = retrySessionId;\n          _messageId = undefined;\n        } else {\n          const message = await createSessionMessage({\n            docId,\n            workspaceId,\n            promptName,\n            content,\n            attachments,\n            params,\n            sessionId,\n            retry,\n          });\n          _sessionId = message.sessionId;\n          _messageId = message.messageId;\n        }\n\n        const eventSource = client.chatTextStream(\n          {\n            sessionId: _sessionId,\n            messageId: _messageId,\n          },\n          workflow ? 'workflow' : undefined\n        );\n        AIProvider.LAST_ACTION_SESSIONID = _sessionId;\n        if (isRootSession) {\n          AIProvider.LAST_ROOT_SESSION_ID = _sessionId;\n        }\n\n        if (signal) {\n          if (signal.aborted) {\n            eventSource.close();\n            return;\n          }\n          signal.onabort = () => {\n            eventSource.close();\n          };\n        }\n        if (postfix) {\n          const messages: string[] = [];\n          for await (const event of toTextStream(eventSource, {\n            timeout,\n            signal,\n          })) {\n            if (event.type === 'message') {\n              messages.push(event.data);\n            }\n          }\n          yield postfix(messages.join(''));\n        } else {\n          for await (const event of toTextStream(eventSource, {\n            timeout,\n            signal,\n          })) {\n            if (event.type === 'message') {\n              yield event.data;\n            }\n          }\n        }\n      },\n    };\n  } else {\n    return Promise.race([\n      timeout\n        ? delay(timeout).then(() => {\n            throw new Error('Timeout');\n          })\n        : null,\n      (async function () {\n        if (retry) {\n          const retrySessionId =\n            (await sessionId) ?? AIProvider.LAST_ACTION_SESSIONID;\n          assertExists(retrySessionId, 'retry sessionId is required');\n          _sessionId = retrySessionId;\n          _messageId = undefined;\n        } else {\n          const message = await createSessionMessage({\n            docId,\n            workspaceId,\n            promptName,\n            content,\n            attachments,\n            params,\n            sessionId,\n          });\n          _sessionId = message.sessionId;\n          _messageId = message.messageId;\n        }\n\n        AIProvider.LAST_ACTION_SESSIONID = _sessionId;\n        if (isRootSession) {\n          AIProvider.LAST_ROOT_SESSION_ID = _sessionId;\n        }\n\n        return client.chatText({\n          sessionId: _sessionId,\n          messageId: _messageId,\n        });\n      })(),\n    ]);\n  }\n}\n\nexport const listHistories = client.getHistories;\n\nexport const listHistoryIds = client.getHistoryIds;\n\n// Only one image is currently being processed\nexport function toImage({\n  docId,\n  workspaceId,\n  promptName,\n  content,\n  attachments,\n  params,\n  seed,\n  sessionId,\n  signal,\n  timeout = TIMEOUT,\n  retry = false,\n  workflow = false,\n}: ToImageOptions) {\n  let _sessionId: string;\n  let _messageId: string | undefined;\n  return {\n    [Symbol.asyncIterator]: async function* () {\n      if (retry) {\n        const retrySessionId =\n          (await sessionId) ?? AIProvider.LAST_ACTION_SESSIONID;\n        assertExists(retrySessionId, 'retry sessionId is required');\n        _sessionId = retrySessionId;\n        _messageId = undefined;\n      } else {\n        const { messageId, sessionId } = await createSessionMessage({\n          docId,\n          workspaceId,\n          promptName,\n          content,\n          attachments,\n          params,\n        });\n        _sessionId = sessionId;\n        _messageId = messageId;\n      }\n\n      const eventSource = client.imagesStream(\n        _sessionId,\n        _messageId,\n        seed,\n        workflow ? 'workflow' : undefined\n      );\n      AIProvider.LAST_ACTION_SESSIONID = _sessionId;\n\n      for await (const event of toTextStream(eventSource, {\n        timeout,\n        signal,\n      })) {\n        if (event.type === 'attachment') {\n          yield event.data;\n        }\n      }\n    },\n  };\n}\n\nexport function cleanupSessions({\n  workspaceId,\n  docId,\n  sessionIds,\n}: {\n  workspaceId: string;\n  docId: string;\n  sessionIds: string[];\n}) {\n  return client.cleanupSessions({ workspaceId, docId, sessionIds });\n}\n","import { AIProvider } from '@affine/core/blocksuite/presets/ai';\nimport { mixpanel, track } from '@affine/core/mixpanel';\nimport type { EditorHost } from '@blocksuite/block-std';\nimport type { BlockModel } from '@blocksuite/store';\nimport { lowerCase, omit } from 'lodash-es';\n\ntype ElementModel = BlockSuite.SurfaceElementModel;\n\ntype AIActionEventName =\n  | 'AI action invoked'\n  | 'AI action aborted'\n  | 'AI result discarded'\n  | 'AI result accepted';\n\ntype AIActionEventProperties = {\n  page: 'doc' | 'edgeless';\n  segment:\n    | 'AI action panel'\n    | 'right side bar'\n    | 'inline chat panel'\n    | 'AI result panel'\n    | 'AI chat block';\n  module:\n    | 'exit confirmation'\n    | 'AI action panel'\n    | 'AI chat panel'\n    | 'inline chat panel'\n    | 'AI result panel'\n    | 'AI chat block';\n  control:\n    | 'stop button'\n    | 'format toolbar'\n    | 'AI chat send button'\n    | 'Block action bar'\n    | 'paywall'\n    | 'policy wall'\n    | 'server error'\n    | 'login required'\n    | 'insert'\n    | 'replace'\n    | 'use as caption'\n    | 'discard'\n    | 'retry'\n    | 'add note'\n    | 'add page'\n    | 'continue in chat';\n  type:\n    | 'doc' // synced doc\n    | 'note' // note shape\n    | 'text'\n    | 'image'\n    | 'draw object'\n    | 'chatbox text'\n    | 'other';\n  category: string;\n  other: Record<string, unknown>;\n  docId: string;\n  workspaceId: string;\n};\n\ntype BlocksuiteActionEvent = Parameters<\n  Parameters<typeof AIProvider.slots.actions.on>[0]\n>[0];\n\nconst trackAction = ({\n  eventName,\n  properties,\n}: {\n  eventName: AIActionEventName;\n  properties: AIActionEventProperties;\n}) => {\n  mixpanel.track(eventName, properties);\n};\n\nconst inferPageMode = (host: EditorHost) => {\n  return host.querySelector('affine-page-root') ? 'doc' : 'edgeless';\n};\n\nconst defaultActionOptions = [\n  'stream',\n  'input',\n  'content',\n  'stream',\n  'attachments',\n  'signal',\n  'docId',\n  'workspaceId',\n  'host',\n  'models',\n  'control',\n  'where',\n  'seed',\n];\n\nfunction isElementModel(\n  model: BlockModel | ElementModel\n): model is ElementModel {\n  return !isBlockModel(model);\n}\n\nfunction isBlockModel(model: BlockModel | ElementModel): model is BlockModel {\n  return 'flavour' in model;\n}\n\nfunction inferObjectType(event: BlocksuiteActionEvent) {\n  const models: (BlockModel | ElementModel)[] | undefined =\n    event.options.models;\n  if (!models) {\n    if (event.action === 'chat') {\n      return 'chatbox text';\n    } else if (event.options.attachments?.length) {\n      return 'image';\n    } else {\n      return 'text';\n    }\n  } else if (models.every(isElementModel)) {\n    return 'draw object';\n  } else if (models.every(isBlockModel)) {\n    const flavour = models[0].flavour;\n    if (flavour === 'affine:note') {\n      return 'note';\n    } else if (\n      ['affine:paragraph', 'affine:list', 'affine:code'].includes(flavour)\n    ) {\n      return 'text';\n    } else if (flavour === 'affine:image') {\n      return 'image';\n    }\n  }\n  return 'other';\n}\n\nfunction inferSegment(\n  event: BlocksuiteActionEvent\n): AIActionEventProperties['segment'] {\n  if (event.options.where === 'inline-chat-panel') {\n    return 'inline chat panel';\n  } else if (event.event.startsWith('result:')) {\n    return 'AI result panel';\n  } else if (event.options.where === 'chat-panel') {\n    return 'right side bar';\n  } else if (event.options.where === 'ai-chat-block') {\n    return 'AI chat block';\n  } else {\n    return 'AI action panel';\n  }\n}\n\nfunction inferModule(\n  event: BlocksuiteActionEvent\n): AIActionEventProperties['module'] {\n  if (event.options.where === 'chat-panel') {\n    return 'AI chat panel';\n  } else if (event.event === 'result:discard') {\n    return 'exit confirmation';\n  } else if (event.event.startsWith('result:')) {\n    return 'AI result panel';\n  } else if (event.options.where === 'inline-chat-panel') {\n    return 'inline chat panel';\n  } else if (event.options.where === 'ai-chat-block') {\n    return 'AI chat block';\n  } else {\n    return 'AI action panel';\n  }\n}\n\nfunction inferEventName(\n  event: BlocksuiteActionEvent\n): AIActionEventName | null {\n  if (['result:discard', 'result:retry'].includes(event.event)) {\n    return 'AI result discarded';\n  } else if (event.event.startsWith('result:')) {\n    return 'AI result accepted';\n  } else if (event.event.startsWith('aborted:')) {\n    return 'AI action aborted';\n  } else if (event.event === 'started') {\n    return 'AI action invoked';\n  }\n  return null;\n}\n\nfunction inferControl(\n  event: BlocksuiteActionEvent\n): AIActionEventProperties['control'] {\n  if (event.event === 'aborted:stop') {\n    return 'stop button';\n  } else if (event.event === 'aborted:paywall') {\n    return 'paywall';\n  } else if (event.event === 'aborted:server-error') {\n    return 'server error';\n  } else if (event.event === 'aborted:login-required') {\n    return 'login required';\n  } else if (event.options.control === 'chat-send') {\n    return 'AI chat send button';\n  } else if (event.options.control === 'block-action-bar') {\n    return 'Block action bar';\n  } else if (event.event === 'result:add-note') {\n    return 'add note';\n  } else if (event.event === 'result:add-page') {\n    return 'add page';\n  } else if (event.event === 'result:continue-in-chat') {\n    return 'continue in chat';\n  } else if (event.event === 'result:insert') {\n    return 'insert';\n  } else if (event.event === 'result:replace') {\n    return 'replace';\n  } else if (event.event === 'result:use-as-caption') {\n    return 'use as caption';\n  } else if (event.event === 'result:discard') {\n    return 'discard';\n  } else if (event.event === 'result:retry') {\n    return 'retry';\n  } else {\n    return 'format toolbar';\n  }\n}\n\nconst toTrackedOptions = (\n  event: BlocksuiteActionEvent\n): {\n  eventName: AIActionEventName;\n  properties: AIActionEventProperties;\n} | null => {\n  const eventName = inferEventName(event);\n\n  if (!eventName) return null;\n\n  const pageMode = inferPageMode(event.options.host);\n  const otherProperties = omit(event.options, defaultActionOptions);\n  const type = inferObjectType(event);\n  const segment = inferSegment(event);\n  const module = inferModule(event);\n  const control = inferControl(event);\n  const category = lowerCase(event.action);\n\n  return {\n    eventName,\n    properties: {\n      page: pageMode,\n      segment,\n      category,\n      module,\n      control,\n      type,\n      other: otherProperties,\n      docId: event.options.docId,\n      workspaceId: event.options.workspaceId,\n    },\n  };\n};\n\nexport function setupTracker() {\n  AIProvider.slots.requestUpgradePlan.on(() => {\n    track.$.paywall.aiAction.viewPlans();\n  });\n\n  AIProvider.slots.requestLogin.on(() => {\n    track.$.$.auth.signIn({\n      control: 'aiAction',\n    });\n  });\n\n  AIProvider.slots.actions.on(event => {\n    const properties = toTrackedOptions(event);\n    if (properties) {\n      trackAction(properties);\n    }\n  });\n}\n","import { notify } from '@affine/component';\nimport { authAtom, openSettingModalAtom } from '@affine/core/atoms';\nimport { AIProvider } from '@affine/core/blocksuite/presets/ai';\nimport { toggleGeneralAIOnboarding } from '@affine/core/components/affine/ai-onboarding/apis';\nimport { track } from '@affine/core/mixpanel';\nimport {\n  getBaseUrl,\n  type getCopilotHistoriesQuery,\n  type RequestOptions,\n} from '@affine/graphql';\nimport { Trans } from '@affine/i18n';\nimport { UnauthorizedError } from '@blocksuite/blocks';\nimport { assertExists } from '@blocksuite/global/utils';\nimport { getCurrentStore } from '@toeverything/infra';\nimport { z } from 'zod';\n\nimport type { PromptKey } from './prompt';\nimport {\n  cleanupSessions,\n  createChatSession,\n  forkCopilotSession,\n  listHistories,\n  textToText,\n  toImage,\n} from './request';\nimport { setupTracker } from './tracker';\n\nconst filterStyleToPromptName = new Map(\n  Object.entries({\n    'Clay style': 'workflow:image-clay',\n    'Pixel style': 'workflow:image-pixel',\n    'Sketch style': 'workflow:image-sketch',\n    'Anime style': 'workflow:image-anime',\n  })\n);\n\nconst processTypeToPromptName = new Map(\n  Object.entries({\n    Clearer: 'debug:action:fal-upscaler',\n    'Remove background': 'debug:action:fal-remove-bg',\n    'Convert to sticker': 'debug:action:fal-face-to-sticker',\n  })\n);\n\nfunction setupAIProvider() {\n  // a single workspace should have only a single chat session\n  // user-id:workspace-id:doc-id -> chat session id\n  const chatSessions = new Map<string, Promise<string>>();\n\n  async function getChatSessionId(workspaceId: string, docId: string) {\n    const userId = (await AIProvider.userInfo)?.id;\n\n    if (!userId) {\n      throw new UnauthorizedError();\n    }\n\n    const storeKey = `${userId}:${workspaceId}:${docId}`;\n    if (!chatSessions.has(storeKey)) {\n      chatSessions.set(\n        storeKey,\n        createChatSession({\n          workspaceId,\n          docId,\n        })\n      );\n    }\n    try {\n      const sessionId = await chatSessions.get(storeKey);\n      assertExists(sessionId);\n      return sessionId;\n    } catch (err) {\n      // do not cache the error\n      chatSessions.delete(storeKey);\n      throw err;\n    }\n  }\n\n  //#region actions\n  AIProvider.provide('chat', options => {\n    const sessionId =\n      options.sessionId ?? getChatSessionId(options.workspaceId, options.docId);\n    return textToText({\n      ...options,\n      content: options.input,\n      sessionId,\n    });\n  });\n\n  AIProvider.provide('summary', options => {\n    return textToText({\n      ...options,\n      content: options.input,\n      promptName: 'Summary',\n    });\n  });\n\n  AIProvider.provide('translate', options => {\n    return textToText({\n      ...options,\n      promptName: 'Translate to',\n      content: options.input,\n      params: {\n        language: options.lang,\n      },\n    });\n  });\n\n  AIProvider.provide('changeTone', options => {\n    return textToText({\n      ...options,\n      params: {\n        tone: options.tone.toLowerCase(),\n      },\n      content: options.input,\n      promptName: 'Change tone to',\n    });\n  });\n\n  AIProvider.provide('improveWriting', options => {\n    return textToText({\n      ...options,\n      content: options.input,\n      promptName: 'Improve writing for it',\n    });\n  });\n\n  AIProvider.provide('improveGrammar', options => {\n    return textToText({\n      ...options,\n      content: options.input,\n      promptName: 'Improve grammar for it',\n    });\n  });\n\n  AIProvider.provide('fixSpelling', options => {\n    return textToText({\n      ...options,\n      content: options.input,\n      promptName: 'Fix spelling for it',\n    });\n  });\n\n  AIProvider.provide('createHeadings', options => {\n    return textToText({\n      ...options,\n      content: options.input,\n      promptName: 'Create headings',\n    });\n  });\n\n  AIProvider.provide('makeLonger', options => {\n    return textToText({\n      ...options,\n      content: options.input,\n      promptName: 'Make it longer',\n    });\n  });\n\n  AIProvider.provide('makeShorter', options => {\n    return textToText({\n      ...options,\n      content: options.input,\n      promptName: 'Make it shorter',\n    });\n  });\n\n  AIProvider.provide('checkCodeErrors', options => {\n    return textToText({\n      ...options,\n      content: options.input,\n      promptName: 'Check code error',\n    });\n  });\n\n  AIProvider.provide('explainCode', options => {\n    return textToText({\n      ...options,\n      content: options.input,\n      promptName: 'Explain this code',\n    });\n  });\n\n  AIProvider.provide('writeArticle', options => {\n    return textToText({\n      ...options,\n      content: options.input,\n      promptName: 'Write an article about this',\n    });\n  });\n\n  AIProvider.provide('writeTwitterPost', options => {\n    return textToText({\n      ...options,\n      content: options.input,\n      promptName: 'Write a twitter about this',\n    });\n  });\n\n  AIProvider.provide('writePoem', options => {\n    return textToText({\n      ...options,\n      content: options.input,\n      promptName: 'Write a poem about this',\n    });\n  });\n\n  AIProvider.provide('writeOutline', options => {\n    return textToText({\n      ...options,\n      content: options.input,\n      promptName: 'Write outline',\n    });\n  });\n\n  AIProvider.provide('writeBlogPost', options => {\n    return textToText({\n      ...options,\n      content: options.input,\n      promptName: 'Write a blog post about this',\n    });\n  });\n\n  AIProvider.provide('brainstorm', options => {\n    return textToText({\n      ...options,\n      content: options.input,\n      promptName: 'Brainstorm ideas about this',\n    });\n  });\n\n  AIProvider.provide('findActions', options => {\n    return textToText({\n      ...options,\n      content: options.input,\n      promptName: 'Find action items from it',\n    });\n  });\n\n  AIProvider.provide('brainstormMindmap', options => {\n    return textToText({\n      ...options,\n      content: options.input,\n      promptName: 'workflow:brainstorm',\n      workflow: true,\n    });\n  });\n\n  AIProvider.provide('expandMindmap', options => {\n    assertExists(options.input, 'expandMindmap action requires input');\n    return textToText({\n      ...options,\n      params: {\n        mindmap: options.mindmap,\n        node: options.input,\n      },\n      content: options.input,\n      promptName: 'Expand mind map',\n    });\n  });\n\n  AIProvider.provide('explain', options => {\n    return textToText({\n      ...options,\n      content: options.input,\n      promptName: 'Explain this',\n    });\n  });\n\n  AIProvider.provide('explainImage', options => {\n    return textToText({\n      ...options,\n      content: options.input,\n      promptName: 'Explain this image',\n    });\n  });\n\n  AIProvider.provide('makeItReal', options => {\n    let promptName: PromptKey = 'Make it real';\n    let content = options.content || '';\n\n    // wireframes\n    if (options.attachments?.length) {\n      content = `Here are the latest wireframes. Could you make a new website based on these wireframes and notes and send back just the html file?\nHere are our design notes:\\n ${content}.`;\n    } else {\n      // notes\n      promptName = 'Make it real with text';\n      content = `Here are the latest notes: \\n ${content}.\nCould you make a new website based on these notes and send back just the html file?`;\n    }\n\n    return textToText({\n      ...options,\n      content,\n      promptName,\n    });\n  });\n\n  AIProvider.provide('createSlides', options => {\n    const SlideSchema = z.object({\n      page: z.number(),\n      type: z.enum(['name', 'title', 'content']),\n      content: z.string(),\n    });\n    type Slide = z.infer<typeof SlideSchema>;\n    const parseJson = (json: string) => {\n      try {\n        return SlideSchema.parse(JSON.parse(json));\n      } catch {\n        return null;\n      }\n    };\n    // TODO(@darkskygit): move this to backend's workflow after workflow support custom code action\n    const postfix = (text: string): string => {\n      const slides = text\n        .split('\\n')\n        .map(parseJson)\n        .filter((v): v is Slide => !!v);\n      return slides\n        .map(slide => {\n          if (slide.type === 'name') {\n            return `- ${slide.content}`;\n          } else if (slide.type === 'title') {\n            return `  - ${slide.content}`;\n          } else if (slide.content.includes('\\n')) {\n            return slide.content\n              .split('\\n')\n              .map(c => `    - ${c}`)\n              .join('\\n');\n          } else {\n            return `    - ${slide.content}`;\n          }\n        })\n        .join('\\n');\n    };\n    return textToText({\n      ...options,\n      content: options.input,\n      promptName: 'workflow:presentation',\n      workflow: true,\n      postfix,\n    });\n  });\n\n  AIProvider.provide('createImage', options => {\n    // test to image\n    let promptName: PromptKey = 'debug:action:dalle3';\n    // image to image\n    if (options.attachments?.length) {\n      promptName = 'debug:action:fal-sd15';\n    }\n    return toImage({\n      ...options,\n      promptName,\n    });\n  });\n\n  AIProvider.provide('filterImage', options => {\n    // test to image\n    const promptName = filterStyleToPromptName.get(options.style as string);\n    return toImage({\n      ...options,\n      timeout: 120000,\n      promptName: promptName as PromptKey,\n      workflow: !!promptName?.startsWith('workflow:'),\n    });\n  });\n\n  AIProvider.provide('processImage', options => {\n    // test to image\n    const promptName = processTypeToPromptName.get(\n      options.type as string\n    ) as PromptKey;\n    return toImage({\n      ...options,\n      timeout: 120000,\n      promptName,\n    });\n  });\n\n  AIProvider.provide('generateCaption', options => {\n    return textToText({\n      ...options,\n      content: options.input,\n      promptName: 'Generate a caption',\n    });\n  });\n\n  AIProvider.provide('continueWriting', options => {\n    return textToText({\n      ...options,\n      content: options.input,\n      promptName: 'Continue writing',\n    });\n  });\n  //#endregion\n\n  AIProvider.provide('histories', {\n    actions: async (\n      workspaceId: string,\n      docId?: string\n    ): Promise<BlockSuitePresets.AIHistory[]> => {\n      // @ts-expect-error - 'action' is missing in server impl\n      return (\n        (await listHistories(workspaceId, docId, {\n          action: true,\n        })) ?? []\n      );\n    },\n    chats: async (\n      workspaceId: string,\n      docId?: string,\n      options?: RequestOptions<\n        typeof getCopilotHistoriesQuery\n      >['variables']['options']\n    ): Promise<BlockSuitePresets.AIHistory[]> => {\n      // @ts-expect-error - 'action' is missing in server impl\n      return (await listHistories(workspaceId, docId, options)) ?? [];\n    },\n    cleanup: async (\n      workspaceId: string,\n      docId: string,\n      sessionIds: string[]\n    ) => {\n      await cleanupSessions({ workspaceId, docId, sessionIds });\n    },\n    ids: async (\n      workspaceId: string,\n      docId?: string,\n      options?: RequestOptions<\n        typeof getCopilotHistoriesQuery\n      >['variables']['options']\n    ): Promise<BlockSuitePresets.AIHistoryIds[]> => {\n      // @ts-expect-error - 'role' is missing type in server impl\n      return await listHistories(workspaceId, docId, options);\n    },\n  });\n\n  AIProvider.provide('photoEngine', {\n    async searchImages(options): Promise<string[]> {\n      const url = new URL(getBaseUrl() + '/api/copilot/unsplash/photos');\n      url.searchParams.set('query', options.query);\n      const result: {\n        results: {\n          urls: {\n            regular: string;\n          };\n        }[];\n      } = await fetch(url.toString()).then(res => res.json());\n      return result.results.map(r => {\n        const url = new URL(r.urls.regular);\n        url.searchParams.set('fit', 'crop');\n        url.searchParams.set('crop', 'edges');\n        url.searchParams.set('dpr', (window.devicePixelRatio ?? 2).toString());\n        url.searchParams.set('w', `${options.width}`);\n        url.searchParams.set('h', `${options.height}`);\n        return url.toString();\n      });\n    },\n  });\n\n  AIProvider.provide('onboarding', toggleGeneralAIOnboarding);\n\n  AIProvider.provide('forkChat', options => {\n    return forkCopilotSession(options);\n  });\n\n  AIProvider.slots.requestUpgradePlan.on(() => {\n    getCurrentStore().set(openSettingModalAtom, {\n      activeTab: 'billing',\n      open: true,\n    });\n    track.$.paywall.aiAction.viewPlans();\n  });\n\n  AIProvider.slots.requestLogin.on(() => {\n    getCurrentStore().set(authAtom, s => ({\n      ...s,\n      openModal: true,\n    }));\n  });\n\n  AIProvider.slots.requestRunInEdgeless.on(() => {\n    notify.warning({\n      title: (\n        <Trans i18nKey=\"com.affine.ai.action.edgeless-only.dialog-title\" />\n      ),\n    });\n  });\n\n  setupTracker();\n}\n\nsetupAIProvider();\n","import type { Doc } from '@blocksuite/store';\nimport type { Map as YMap } from 'yjs';\n\n/**\n * TODO(@eyhn): Define error to unexpected state together in the future.\n */\nexport class NoPageRootError extends Error {\n  constructor(public page: Doc) {\n    super('Page root not found when render editor!');\n\n    // Log info to let sentry collect more message\n    const hasExpectSpace = Array.from(page.rootDoc.spaces.values()).some(\n      doc => page.spaceDoc.guid === doc.guid\n    );\n    const blocks = page.spaceDoc.getMap('blocks') as YMap<YMap<any>>;\n    const havePageBlock = Array.from(blocks.values()).some(\n      block => block.get('sys:flavour') === 'affine:page'\n    );\n    console.info(\n      'NoPageRootError current data: %s',\n      JSON.stringify({\n        expectPageId: page.id,\n        expectGuid: page.spaceDoc.guid,\n        hasExpectSpace,\n        blockSize: blocks.size,\n        havePageBlock,\n      })\n    );\n  }\n}\n","import type { InlineEditProps } from '@affine/component';\nimport { InlineEdit } from '@affine/component';\nimport {\n  useBlockSuiteDocMeta,\n  useDocMetaHelper,\n} from '@affine/core/hooks/use-block-suite-page-meta';\nimport type { DocCollection } from '@affine/core/shared';\nimport clsx from 'clsx';\nimport type { HTMLAttributes } from 'react';\nimport { useCallback } from 'react';\n\nimport * as styles from './style.css';\n\nexport interface BlockSuiteHeaderTitleProps {\n  docCollection: DocCollection;\n  pageId: string;\n  /** if set, title cannot be edited */\n  isPublic?: boolean;\n  inputHandleRef?: InlineEditProps['handleRef'];\n  className?: string;\n  onEditSave?: () => void;\n}\n\nconst inputAttrs = {\n  'data-testid': 'title-content',\n} as HTMLAttributes<HTMLInputElement>;\nexport const BlocksuiteHeaderTitle = (props: BlockSuiteHeaderTitleProps) => {\n  const { docCollection, pageId, isPublic, inputHandleRef, onEditSave } = props;\n  const currentPage = docCollection.getDoc(pageId);\n  const pageMeta = useBlockSuiteDocMeta(docCollection).find(\n    meta => meta.id === currentPage?.id\n  );\n  const title = pageMeta?.title;\n  const { setDocTitle } = useDocMetaHelper(docCollection);\n\n  const onChange = useCallback(\n    (v: string) => {\n      onEditSave?.();\n      setDocTitle(currentPage?.id || '', v);\n    },\n    [currentPage?.id, onEditSave, setDocTitle]\n  );\n\n  return (\n    <InlineEdit\n      className={clsx(styles.title, props.className)}\n      autoSelect\n      value={title}\n      onChange={onChange}\n      editable={!isPublic}\n      exitible={true}\n      placeholder=\"Untitled\"\n      data-testid=\"title-edit-button\"\n      handleRef={inputHandleRef}\n      inputAttrs={inputAttrs}\n    />\n  );\n};\n","import \"../core/src/components/blocksuite/block-suite-header/title/style.css.ts.vanilla.css!=!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/blocksuite/block-suite-header/title/style.css.ts.vanilla.css\\\",\\\"source\\\":\\\"LnVqYzc5ZzAgewogIGZvbnQtd2VpZ2h0OiA1MDA7CiAgY29sb3I6IHZhcigtLWFmZmluZS10ZXh0LXByaW1hcnktY29sb3IpOwp9Ci51amM3OWcwW2RhdGEtZWRpdGluZz0idHJ1ZSJdIHsKICAtd2Via2l0LWFwcC1yZWdpb246IG5vLWRyYWc7Cn0=\\\"}!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var title = 'ujc79g0';","import { toast } from '@affine/component';\nimport { useDocCollectionHelper } from '@affine/core/hooks/use-block-suite-workspace-helper';\nimport { WorkbenchService } from '@affine/core/modules/workbench';\nimport { DocsService, initEmptyPage, useService } from '@toeverything/infra';\nimport { useCallback, useMemo } from 'react';\n\nimport type { DocCollection } from '../../../shared';\n\nexport const usePageHelper = (docCollection: DocCollection) => {\n  const workbench = useService(WorkbenchService).workbench;\n  const { createDoc } = useDocCollectionHelper(docCollection);\n  const docRecordList = useService(DocsService).list;\n\n  const isPreferredEdgeless = useCallback(\n    (pageId: string) =>\n      docRecordList.doc$(pageId).value?.mode$.value === 'edgeless',\n    [docRecordList]\n  );\n\n  const createPageAndOpen = useCallback(\n    (mode?: 'page' | 'edgeless', open?: boolean | 'new-tab') => {\n      const page = createDoc();\n      initEmptyPage(page);\n      docRecordList.doc$(page.id).value?.setMode(mode || 'page');\n      if (open !== false)\n        workbench.openDoc(page.id, {\n          at: open === 'new-tab' ? 'new-tab' : 'active',\n        });\n      return page;\n    },\n    [createDoc, docRecordList, workbench]\n  );\n\n  const createEdgelessAndOpen = useCallback(\n    (open?: boolean | 'new-tab') => {\n      return createPageAndOpen('edgeless', open);\n    },\n    [createPageAndOpen]\n  );\n\n  const importFileAndOpen = useMemo(\n    () => async () => {\n      const { showImportModal } = await import('@blocksuite/blocks');\n      const { promise, resolve, reject } =\n        Promise.withResolvers<\n          Parameters<\n            NonNullable<Parameters<typeof showImportModal>[0]['onSuccess']>\n          >[1]\n        >();\n      const onSuccess = (\n        pageIds: string[],\n        options: { isWorkspaceFile: boolean; importedCount: number }\n      ) => {\n        resolve(options);\n        toast(\n          `Successfully imported ${options.importedCount} Page${\n            options.importedCount > 1 ? 's' : ''\n          }.`\n        );\n        if (options.isWorkspaceFile) {\n          workbench.openAll();\n          return;\n        }\n\n        if (pageIds.length === 0) {\n          return;\n        }\n        const pageId = pageIds[0];\n        workbench.openDoc(pageId);\n      };\n      showImportModal({\n        collection: docCollection,\n        onSuccess,\n        onFail: message => {\n          reject(new Error(message));\n        },\n      });\n      return await promise;\n    },\n    [docCollection, workbench]\n  );\n\n  return useMemo(() => {\n    return {\n      isPreferredEdgeless,\n      createPage: (open?: boolean | 'new-tab') =>\n        createPageAndOpen('page', open),\n      createEdgeless: createEdgelessAndOpen,\n      importFile: importFileAndOpen,\n    };\n  }, [\n    isPreferredEdgeless,\n    createEdgelessAndOpen,\n    createPageAndOpen,\n    importFileAndOpen,\n  ]);\n};\n","import type { AffineEditorContainer } from '@blocksuite/presets';\nimport { OutlineViewer } from '@blocksuite/presets';\nimport { useCallback, useRef } from 'react';\n\nimport * as styles from './outline-viewer.css';\n\nexport const EditorOutlineViewer = ({\n  editor,\n  show,\n  openOutlinePanel,\n}: {\n  editor: AffineEditorContainer | null;\n  show: boolean;\n  openOutlinePanel: () => void;\n}) => {\n  const outlineViewerRef = useRef<OutlineViewer | null>(null);\n\n  const onRefChange = useCallback((container: HTMLDivElement | null) => {\n    if (container) {\n      if (outlineViewerRef.current === null) {\n        console.error('outline viewer should be initialized');\n        return;\n      }\n\n      container.append(outlineViewerRef.current);\n    }\n  }, []);\n\n  if (!editor || !show) return;\n\n  if (!outlineViewerRef.current) {\n    outlineViewerRef.current = new OutlineViewer();\n  }\n  if (outlineViewerRef.current.editor !== editor) {\n    outlineViewerRef.current.editor = editor;\n  }\n  if (outlineViewerRef.current.toggleOutlinePanel !== openOutlinePanel) {\n    outlineViewerRef.current.toggleOutlinePanel = openOutlinePanel;\n  }\n\n  return <div className={styles.root} ref={onRefChange} />;\n};\n","import \"../core/src/components/blocksuite/outline-viewer/outline-viewer.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/blocksuite/outline-viewer/outline-viewer.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll81Z2liMXowIHsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgdG9wOiAyMDRweDsKICByaWdodDogMjJweDsKICBtYXgtaGVpZ2h0OiBjYWxjKDEwMCUgLSAyMDRweCAtIDc2cHgpOwogIGRpc3BsYXk6IGZsZXg7Cn0KQGNvbnRhaW5lciAod2lkdGggPD0gNjQwcHgpIHsKICAuXzVnaWIxejAgewogICAgZGlzcGxheTogbm9uZTsKICB9Cn0=\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var root = '_5gib1z0';","import \"../core/src/components/page-list/collections/collection-list-item.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/page-list/collections/collection-list-item.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACsVWbWvbMBD+nl8hCoUGquK8rlPY/scYYyjS2dYqS0aSm3Sj/31IshPZcZplK+xbfLmX5557fOeH7zMuqtkeMvRrghAXtpb0haBcwn4zQYhpqQ1Bz9TcYUzzXCjADvYO10ZU1Lzg4DD1riWIonQErZZ1CPUpsC2NUE8EZd6yE9yVBM2y7NY/UikKhYWDyhJknQHHSm93hiornNCKoC1lT4XRjeKxEsoe5vYe6Zoy4V7Ckw/Rz2ByqXcElYJzUAF6Y6zHziGnjXQRgJSYlVQVQLocm8nr5OHAAil9qsDFsPSAheB4aD/N8ZVTRzGTgj3RrYRPzjTwLaTsINVaKAemFzYLHh2Jy1UkcasNB4MN5aKxnrpoPplTj0sGMXvaw3n0OBdSAp/Gcn5klHsme/4VqKb9JzhWdI/bcS7WLahKqM42j7akvXlor9bdYA1I6sQzxGSmEApLyB1B+DFm65jo1KIbJ4UCgpRWIaqmnAtVtGGPsV7knhtaFAn3RxRkC7k2EKehlQPlCLq52fSw0a3VsnGhitM1QasIIQgz16Yi8aekDr7c4VV2GziJQFKlL/uttI+pvuNfZ1R9QYG1pAxKLXmiwxPFzGPNNvUBXvIeRAj36ftwkcUgn5TLw7SG9WZn8yVGoYqTGiHtEfbD6m8TjcFctDA7uY6BPr7Q6DMiuTDWYVYKyaOSe+qbrQdyDzGSjoaYiOFxELJInQjK0Oq6d72gdbcgkqzL8b1+Jsfpzs61ctiKnzAQX7CXeNHffavxaiEtFwZYVD3TsqnUCY5Y3VHjNn0mIr29rcOoZHd+NyCM1st6P+3qhOkhtCuFA2xrysLK2Blae3NjwWALEpjrNkkCfx1FN3JM3qTBVtODz65V2DrL3oCRAA3X9FgSpBS1FfZIjgWZJ/cxgfvhLNyzZ9sC04r3D/ebve3tHzL7D308XqfRy4ocJ0AwrdK2B1pPAH18P0Atf1cNJFH+4Bh2p7b3JZUAp/8X+Mj68BYvkVQqw/6SBrZXNfCjsU7kHkF7yUM5UPzCfNn7VYmrDIflux7/8H39DY+5qINlCwAA\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var actionsCellWrapper = '_1dim1xeb';\nexport var dateCell = '_1dim1xea';\nexport var dndCell = '_1dim1xe2';\nexport var dragPageItemOverlay = '_1dim1xe1';\nexport var iconCell = '_1dim1xe8';\nexport var operationsCell = '_1dim1xec';\nexport var root = '_1dim1xe0';\nexport var selectionCell = '_1dim1xe4';\nexport var tagsCell = '_1dim1xe9';\nexport var titleCell = '_1dim1xe5';\nexport var titleCellMain = '_1dim1xe6';\nexport var titleCellPreview = '_1dim1xe7';\nexport var titleIconsWrapper = '_1dim1xe3';","import { Checkbox, useDraggable } from '@affine/component';\nimport { WorkbenchLink } from '@affine/core/modules/workbench';\nimport type { AffineDNDData } from '@affine/core/types/dnd';\nimport { stopPropagation } from '@affine/core/utils';\nimport { useI18n } from '@affine/i18n';\nimport type { ForwardedRef, PropsWithChildren } from 'react';\nimport { forwardRef, useCallback, useMemo } from 'react';\n\nimport { selectionStateAtom, useAtom } from '../scoped-atoms';\nimport type { CollectionListItemProps, PageListItemProps } from '../types';\nimport { ColWrapper } from '../utils';\nimport * as styles from './collection-list-item.css';\n\nconst ListTitleCell = ({\n  title,\n  preview,\n}: Pick<PageListItemProps, 'title' | 'preview'>) => {\n  const t = useI18n();\n  return (\n    <div data-testid=\"page-list-item-title\" className={styles.titleCell}>\n      <div\n        data-testid=\"page-list-item-title-text\"\n        className={styles.titleCellMain}\n      >\n        {title || t['Untitled']()}\n      </div>\n      {preview ? (\n        <div\n          data-testid=\"page-list-item-preview-text\"\n          className={styles.titleCellPreview}\n        >\n          {preview}\n        </div>\n      ) : null}\n    </div>\n  );\n};\n\nconst ListIconCell = ({ icon }: Pick<PageListItemProps, 'icon'>) => {\n  return (\n    <div data-testid=\"page-list-item-icon\" className={styles.iconCell}>\n      {icon}\n    </div>\n  );\n};\n\nconst CollectionSelectionCell = ({\n  selectable,\n  onSelectedChange,\n  selected,\n}: Pick<\n  CollectionListItemProps,\n  'selectable' | 'onSelectedChange' | 'selected'\n>) => {\n  const onSelectionChange = useCallback(\n    (_event: React.ChangeEvent<HTMLInputElement>) => {\n      return onSelectedChange?.();\n    },\n    [onSelectedChange]\n  );\n  if (!selectable) {\n    return null;\n  }\n  return (\n    <div className={styles.selectionCell}>\n      <Checkbox\n        onClick={stopPropagation}\n        checked={!!selected}\n        onChange={onSelectionChange}\n      />\n    </div>\n  );\n};\n\nconst CollectionListOperationsCell = ({\n  operations,\n}: Pick<CollectionListItemProps, 'operations'>) => {\n  return operations ? (\n    <div onClick={stopPropagation} className={styles.operationsCell}>\n      {operations}\n    </div>\n  ) : null;\n};\n\nexport const CollectionListItem = (props: CollectionListItemProps) => {\n  const collectionTitleElement = useMemo(() => {\n    return (\n      <div className={styles.dragPageItemOverlay}>\n        <div className={styles.titleIconsWrapper}>\n          <CollectionSelectionCell\n            onSelectedChange={props.onSelectedChange}\n            selectable={props.selectable}\n            selected={props.selected}\n          />\n          <ListIconCell icon={props.icon} />\n        </div>\n        <ListTitleCell title={props.title} />\n      </div>\n    );\n  }, [\n    props.icon,\n    props.onSelectedChange,\n    props.selectable,\n    props.selected,\n    props.title,\n  ]);\n\n  const { dragRef, dragging, CustomDragPreview } = useDraggable<AffineDNDData>(\n    () => ({\n      data: {\n        entity: {\n          type: 'collection',\n          id: props.collectionId,\n        },\n        from: {\n          at: 'all-collections:list',\n        },\n      },\n      canDrag: props.draggable,\n    }),\n    [props.collectionId, props.draggable]\n  );\n\n  return (\n    <>\n      <CollectionListItemWrapper\n        onClick={props.onClick}\n        to={props.to}\n        collectionId={props.collectionId}\n        draggable={props.draggable}\n        isDragging={dragging}\n        ref={dragRef}\n      >\n        <ColWrapper flex={9}>\n          <ColWrapper className={styles.dndCell} flex={8}>\n            <div className={styles.titleIconsWrapper}>\n              <CollectionSelectionCell\n                onSelectedChange={props.onSelectedChange}\n                selectable={props.selectable}\n                selected={props.selected}\n              />\n              <ListIconCell icon={props.icon} />\n            </div>\n            <ListTitleCell title={props.title} />\n          </ColWrapper>\n          <ColWrapper\n            flex={4}\n            alignment=\"end\"\n            style={{ overflow: 'visible' }}\n          ></ColWrapper>\n        </ColWrapper>\n        {props.operations ? (\n          <ColWrapper\n            className={styles.actionsCellWrapper}\n            flex={3}\n            alignment=\"end\"\n          >\n            <CollectionListOperationsCell operations={props.operations} />\n          </ColWrapper>\n        ) : null}\n      </CollectionListItemWrapper>\n      <CustomDragPreview position=\"pointer-outside\">\n        {collectionTitleElement}\n      </CustomDragPreview>\n    </>\n  );\n};\n\ntype collectionListWrapperProps = PropsWithChildren<\n  Pick<\n    CollectionListItemProps,\n    'to' | 'collectionId' | 'onClick' | 'draggable'\n  > & {\n    isDragging: boolean;\n  }\n>;\n\nconst CollectionListItemWrapper = forwardRef(\n  (\n    {\n      to,\n      isDragging,\n      collectionId,\n      onClick,\n      children,\n      draggable,\n    }: collectionListWrapperProps,\n    ref: ForwardedRef<HTMLAnchorElement & HTMLDivElement>\n  ) => {\n    const [selectionState, setSelectionActive] = useAtom(selectionStateAtom);\n    const handleClick = useCallback(\n      (e: React.MouseEvent) => {\n        if (!selectionState.selectable) {\n          return;\n        }\n        if (e.shiftKey) {\n          stopPropagation(e);\n          setSelectionActive(true);\n          onClick?.();\n          return;\n        }\n        if (selectionState.selectionActive) {\n          return onClick?.();\n        }\n      },\n      [\n        onClick,\n        selectionState.selectable,\n        selectionState.selectionActive,\n        setSelectionActive,\n      ]\n    );\n\n    const commonProps = useMemo(\n      () => ({\n        'data-testid': 'collection-list-item',\n        'data-collection-id': collectionId,\n        'data-draggable': draggable,\n        className: styles.root,\n        'data-clickable': !!onClick || !!to,\n        'data-dragging': isDragging,\n        onClick: handleClick,\n      }),\n      [collectionId, draggable, isDragging, onClick, to, handleClick]\n    );\n\n    if (to) {\n      return (\n        <WorkbenchLink {...commonProps} to={to} ref={ref}>\n          {children}\n        </WorkbenchLink>\n      );\n    } else {\n      return (\n        <div {...commonProps} ref={ref}>\n          {children}\n        </div>\n      );\n    }\n  }\n);\n\nCollectionListItemWrapper.displayName = 'CollectionListItemWrapper';\n","import { Button } from '@affine/component';\nimport { useI18n } from '@affine/i18n';\nimport type { ReactElement } from 'react';\n\nimport * as styles from './collection-list-header.css';\n\nexport const CollectionListHeader = ({\n  node,\n  onCreate,\n}: {\n  node: ReactElement | null;\n  onCreate: () => void;\n}) => {\n  const t = useI18n();\n\n  return (\n    <>\n      <div className={styles.collectionListHeader}>\n        <div className={styles.collectionListHeaderTitle}>\n          {t['com.affine.collections.header']()}\n        </div>\n        <Button\n          className={styles.newCollectionButton}\n          onClick={onCreate}\n          data-testid=\"all-collection-new-button\"\n        >\n          {t['com.affine.collections.empty.new-collection-button']()}\n        </Button>\n      </div>\n      {node}\n    </>\n  );\n};\n","import \"../core/src/components/page-list/collections/collection-list-header.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/page-list/collections/collection-list-header.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xOGdlYnZmMCB7CiAgaGVpZ2h0OiAxMDBweDsKICBhbGlnbi1pdGVtczogY2VudGVyOwogIHBhZGRpbmc6IDQ4cHggMTZweCAyMHB4IDI0cHg7CiAgb3ZlcmZsb3c6IGhpZGRlbjsKICBkaXNwbGF5OiBmbGV4OwogIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsKICBiYWNrZ3JvdW5kOiB2YXIoLS1hZmZpbmUtYmFja2dyb3VuZC1wcmltYXJ5LWNvbG9yKTsKfQouXzE4Z2VidmYxIHsKICBmb250LXNpemU6IHZhcigtLWFmZmluZS1mb250LWgtNSk7CiAgZm9udC13ZWlnaHQ6IDUwMDsKICBjb2xvcjogdmFyKC0tYWZmaW5lLXRleHQtc2Vjb25kYXJ5LWNvbG9yKTsKICBkaXNwbGF5OiBmbGV4OwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgZ2FwOiA4cHg7CiAgdXNlci1zZWxlY3Q6IG5vbmU7Cn0KLl8xOGdlYnZmMiB7CiAgcGFkZGluZzogNnB4IDEwcHg7CiAgYm9yZGVyLXJhZGl1czogOHB4OwogIGJhY2tncm91bmQ6IHZhcigtLWFmZmluZS1iYWNrZ3JvdW5kLXByaW1hcnktY29sb3IpOwogIGZvbnQtc2l6ZTogdmFyKC0tYWZmaW5lLWZvbnQteHMpOwogIGZvbnQtd2VpZ2h0OiA1MDA7CiAgaGVpZ2h0OiAyOHB4Owp9\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var collectionListHeader = '_18gebvf0';\nexport var collectionListHeaderTitle = '_18gebvf1';\nexport var newCollectionButton = '_18gebvf2';","import { toast } from '@affine/component';\nimport { CollectionService } from '@affine/core/modules/collection';\nimport { CompatibleFavoriteItemsAdapter } from '@affine/core/modules/properties';\nimport { useI18n } from '@affine/i18n';\nimport { useLiveData, useService, WorkspaceService } from '@toeverything/infra';\nimport { useCallback, useMemo, useState } from 'react';\n\nimport { FavoriteTag } from '../components/favorite-tag';\nimport { collectionHeaderColsDef } from '../header-col-def';\nimport { CollectionListItemRenderer } from '../page-group';\nimport { ListTableHeader } from '../page-header';\nimport type { BaseSelectorDialogProps } from '../selector';\nimport { SelectorLayout } from '../selector/selector-layout';\nimport type { CollectionMeta, ListItem } from '../types';\nimport { VirtualizedList } from '../virtualized-list';\n\nconst FavoriteOperation = ({ collection }: { collection: ListItem }) => {\n  const t = useI18n();\n  const favAdapter = useService(CompatibleFavoriteItemsAdapter);\n  const isFavorite = useLiveData(\n    favAdapter.isFavorite$(collection.id, 'collection')\n  );\n\n  const onToggleFavoriteCollection = useCallback(() => {\n    favAdapter.toggle(collection.id, 'collection');\n    toast(\n      isFavorite\n        ? t['com.affine.toastMessage.removedFavorites']()\n        : t['com.affine.toastMessage.addedFavorites']()\n    );\n  }, [collection.id, favAdapter, isFavorite, t]);\n\n  return (\n    <FavoriteTag\n      style={{ marginRight: 8 }}\n      onClick={onToggleFavoriteCollection}\n      active={isFavorite}\n    />\n  );\n};\n\nexport const SelectCollection = ({\n  init = [],\n  onCancel,\n  onConfirm,\n}: BaseSelectorDialogProps<string[]>) => {\n  const t = useI18n();\n  const collectionService = useService(CollectionService);\n  const workspace = useService(WorkspaceService).workspace;\n\n  const collections = useLiveData(collectionService.collections$);\n  const [selection, setSelection] = useState(init);\n  const [keyword, setKeyword] = useState('');\n\n  const collectionMetas = useMemo(() => {\n    const collectionsList: CollectionMeta[] = collections\n      .map(collection => {\n        return {\n          ...collection,\n          title: collection.name,\n        };\n      })\n      .filter(meta => {\n        const reg = new RegExp(keyword, 'i');\n        return reg.test(meta.title);\n      });\n    return collectionsList;\n  }, [collections, keyword]);\n\n  const collectionItemRenderer = useCallback((item: ListItem) => {\n    return <CollectionListItemRenderer {...item} />;\n  }, []);\n\n  const collectionHeaderRenderer = useCallback(() => {\n    return <ListTableHeader headerCols={collectionHeaderColsDef} />;\n  }, []);\n\n  const collectionOperationRenderer = useCallback((item: ListItem) => {\n    return <FavoriteOperation collection={item} />;\n  }, []);\n\n  return (\n    <SelectorLayout\n      searchPlaceholder={t[\n        'com.affine.selector-collection.search.placeholder'\n      ]()}\n      selectedCount={selection.length}\n      onSearch={setKeyword}\n      onClear={() => setSelection([])}\n      onCancel={() => onCancel?.()}\n      onConfirm={() => onConfirm?.(selection)}\n    >\n      <VirtualizedList\n        selectable={true}\n        draggable={false}\n        selectedIds={selection}\n        onSelectedIdsChange={setSelection}\n        items={collectionMetas}\n        itemRenderer={collectionItemRenderer}\n        rowAsLink\n        docCollection={workspace.docCollection}\n        operationsRenderer={collectionOperationRenderer}\n        headerRenderer={collectionHeaderRenderer}\n      />\n    </SelectorLayout>\n  );\n};\n","import { useDeleteCollectionInfo } from '@affine/core/hooks/affine/use-delete-collection-info';\nimport type { Collection, DeleteCollectionInfo } from '@affine/env/filter';\nimport { Trans } from '@affine/i18n';\nimport { useService, WorkspaceService } from '@toeverything/infra';\nimport type { ReactElement } from 'react';\nimport { useCallback, useMemo, useRef, useState } from 'react';\n\nimport { CollectionService } from '../../../modules/collection';\nimport { ListFloatingToolbar } from '../components/list-floating-toolbar';\nimport { collectionHeaderColsDef } from '../header-col-def';\nimport { CollectionOperationCell } from '../operation-cell';\nimport { CollectionListItemRenderer } from '../page-group';\nimport { ListTableHeader } from '../page-header';\nimport type { CollectionMeta, ItemListHandle, ListItem } from '../types';\nimport { VirtualizedList } from '../virtualized-list';\nimport { CollectionListHeader } from './collection-list-header';\n\nconst useCollectionOperationsRenderer = ({\n  info,\n  service,\n}: {\n  info: DeleteCollectionInfo;\n  service: CollectionService;\n}) => {\n  const collectionOperationsRenderer = useCallback(\n    (collection: Collection) => {\n      return (\n        <CollectionOperationCell\n          info={info}\n          collection={collection}\n          service={service}\n        />\n      );\n    },\n    [info, service]\n  );\n\n  return collectionOperationsRenderer;\n};\n\nexport const VirtualizedCollectionList = ({\n  collections,\n  collectionMetas,\n  setHideHeaderCreateNewCollection,\n  node,\n  handleCreateCollection,\n}: {\n  collections: Collection[];\n  collectionMetas: CollectionMeta[];\n  node: ReactElement | null;\n  handleCreateCollection: () => void;\n  setHideHeaderCreateNewCollection: (hide: boolean) => void;\n}) => {\n  const listRef = useRef<ItemListHandle>(null);\n  const [showFloatingToolbar, setShowFloatingToolbar] = useState(false);\n  const [selectedCollectionIds, setSelectedCollectionIds] = useState<string[]>(\n    []\n  );\n  const collectionService = useService(CollectionService);\n  const currentWorkspace = useService(WorkspaceService).workspace;\n  const info = useDeleteCollectionInfo();\n\n  const collectionOperations = useCollectionOperationsRenderer({\n    info,\n    service: collectionService,\n  });\n\n  const filteredSelectedCollectionIds = useMemo(() => {\n    const ids = collections.map(collection => collection.id);\n    return selectedCollectionIds.filter(id => ids.includes(id));\n  }, [collections, selectedCollectionIds]);\n\n  const hideFloatingToolbar = useCallback(() => {\n    listRef.current?.toggleSelectable();\n  }, []);\n\n  const collectionOperationRenderer = useCallback(\n    (item: ListItem) => {\n      const collection = item as CollectionMeta;\n      return collectionOperations(collection);\n    },\n    [collectionOperations]\n  );\n\n  const collectionHeaderRenderer = useCallback(() => {\n    return <ListTableHeader headerCols={collectionHeaderColsDef} />;\n  }, []);\n\n  const collectionItemRenderer = useCallback((item: ListItem) => {\n    return <CollectionListItemRenderer {...item} />;\n  }, []);\n\n  const handleDelete = useCallback(() => {\n    if (selectedCollectionIds.length === 0) {\n      return;\n    }\n    collectionService.deleteCollection(info, ...selectedCollectionIds);\n    hideFloatingToolbar();\n  }, [collectionService, hideFloatingToolbar, info, selectedCollectionIds]);\n\n  return (\n    <>\n      <VirtualizedList\n        ref={listRef}\n        selectable=\"toggle\"\n        draggable\n        atTopThreshold={80}\n        atTopStateChange={setHideHeaderCreateNewCollection}\n        onSelectionActiveChange={setShowFloatingToolbar}\n        heading={\n          <CollectionListHeader node={node} onCreate={handleCreateCollection} />\n        }\n        selectedIds={filteredSelectedCollectionIds}\n        onSelectedIdsChange={setSelectedCollectionIds}\n        items={collectionMetas}\n        itemRenderer={collectionItemRenderer}\n        rowAsLink\n        docCollection={currentWorkspace.docCollection}\n        operationsRenderer={collectionOperationRenderer}\n        headerRenderer={collectionHeaderRenderer}\n      />\n      <ListFloatingToolbar\n        open={showFloatingToolbar}\n        content={\n          <Trans\n            i18nKey=\"com.affine.collection.toolbar.selected\"\n            count={selectedCollectionIds.length}\n          >\n            <div style={{ color: 'var(--affine-text-secondary-color)' }}>\n              {{ count: selectedCollectionIds.length } as any}\n            </div>\n            selected\n          </Trans>\n        }\n        onClose={hideFloatingToolbar}\n        onDelete={handleDelete}\n      />\n    </>\n  );\n};\n","import type { IconButtonProps } from '@affine/component';\nimport { IconButton } from '@affine/component';\nimport { useI18n } from '@affine/i18n';\nimport { FavoritedIcon, FavoriteIcon } from '@blocksuite/icons/rc';\nimport { cssVar } from '@toeverything/theme';\nimport Lottie from 'lottie-react';\nimport { forwardRef, useCallback, useState } from 'react';\n\nimport favoritedAnimation from './favorited-animation/data.json';\n\nexport const FavoriteTag = forwardRef<\n  HTMLButtonElement,\n  {\n    active: boolean;\n  } & Omit<IconButtonProps, 'children'>\n>(({ active, onClick, ...props }, ref) => {\n  const [playAnimation, setPlayAnimation] = useState(false);\n  const t = useI18n();\n  const handleClick = useCallback(\n    (e: React.MouseEvent<HTMLButtonElement>) => {\n      e.stopPropagation();\n      e.preventDefault();\n      onClick?.(e);\n      setPlayAnimation(!active);\n    },\n    [active, onClick]\n  );\n  return (\n    <IconButton\n      tooltip={active ? t['Favorited']() : t['Favorite']()}\n      tooltipOptions={{ side: 'top' }}\n      ref={ref}\n      onClick={handleClick}\n      size=\"20\"\n      {...props}\n    >\n      {active ? (\n        playAnimation ? (\n          <Lottie\n            loop={false}\n            animationData={favoritedAnimation}\n            onComplete={() => setPlayAnimation(false)}\n            style={{ width: '20px', height: '20px' }}\n          />\n        ) : (\n          <FavoritedIcon\n            color={cssVar('primaryColor')}\n            data-testid=\"favorited-icon\"\n          />\n        )\n      ) : (\n        <FavoriteIcon />\n      )}\n    </IconButton>\n  );\n});\nFavoriteTag.displayName = 'FavoriteTag';\n","import * as Popover from '@radix-ui/react-popover';\nimport * as Toolbar from '@radix-ui/react-toolbar';\nimport clsx from 'clsx';\nimport type {\n  CSSProperties,\n  HTMLAttributes,\n  MouseEventHandler,\n  PropsWithChildren,\n  ReactNode,\n} from 'react';\n\nimport * as styles from './floating-toolbar.css';\n\ninterface FloatingToolbarProps {\n  className?: string;\n  style?: CSSProperties;\n  open?: boolean;\n}\n\ninterface FloatingToolbarButtonProps extends HTMLAttributes<HTMLButtonElement> {\n  icon: ReactNode;\n  onClick: MouseEventHandler;\n  type?: 'danger' | 'default';\n  label?: ReactNode;\n}\n\ninterface FloatingToolbarItemProps {}\n\nexport function FloatingToolbar({\n  children,\n  style,\n  className,\n  open,\n}: PropsWithChildren<FloatingToolbarProps>) {\n  return (\n    <Popover.Root open={open}>\n      {/* Having Anchor here to let Popover to calculate the position of the place it is being used */}\n      <Popover.Anchor className={className} style={style} />\n      <Popover.Portal>\n        {/* always pop up on top for now */}\n        <Popover.Content side=\"top\" className={styles.popoverContent}>\n          <Toolbar.Root\n            data-testid=\"floating-toolbar\"\n            className={clsx(styles.root)}\n          >\n            {children}\n          </Toolbar.Root>\n        </Popover.Content>\n      </Popover.Portal>\n    </Popover.Root>\n  );\n}\n\n// freestyle item that allows user to do anything\nexport function FloatingToolbarItem({\n  children,\n}: PropsWithChildren<FloatingToolbarItemProps>) {\n  return <div className={styles.item}>{children}</div>;\n}\n\n// a typical button that has icon and label\nexport function FloatingToolbarButton({\n  icon,\n  type,\n  onClick,\n  className,\n  style,\n  label,\n  ...props\n}: FloatingToolbarButtonProps) {\n  return (\n    <Toolbar.Button\n      onClick={onClick}\n      className={clsx(\n        styles.button,\n        type === 'danger' && styles.danger,\n        className\n      )}\n      style={style}\n      {...props}\n    >\n      <div className={styles.buttonIcon}>{icon}</div>\n      {label}\n    </Toolbar.Button>\n  );\n}\n\nexport function FloatingToolbarSeparator() {\n  return <Toolbar.Separator className={styles.separator} />;\n}\n\nFloatingToolbar.Item = FloatingToolbarItem;\nFloatingToolbar.Separator = FloatingToolbarSeparator;\nFloatingToolbar.Button = FloatingToolbarButton;\n","import \"../core/src/components/page-list/components/floating-toolbar.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/page-list/components/floating-toolbar.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACp1T24rbMBB9z1cMC4XkQUH2XqtS2N8opZRZa2wPa0uupNxa8u/FsrOOvXHZ9Mlo5uicM0fj51c65A5r8vAz2drwS0r4swCQn+IHwDaYcTgokF/iOTg0PreuVuAzrGgp15/vV125wkDflqls9qsWfFwAJPI9UzLDlIxoZM9xXDy/85jMeLyO+bK7/5nzuFj3ztJIp9k3FR4U5BXtWwhWXBjBgWqvICMTyLXlF+s0OeFQ88YrSGQT0Q1qzaZQcNedO5iCpNmDtxVr2KJbCoF5zoZEz5LZyrpVh98LX6K2OzVG1mQ2fScCC2zeRGo2Ysc6lApq3IvMmkAmtJ2+mnM4r75g9lo4uzF6IjI0ROO4Rnd4szbkdBtz2nFViaxEU5AaEj+9xQj/XWNA4QMG+npjGzI3PyIFGq4xsDVqWGC5Tj0QehJshN2EeaKssp70LFXyT6q7foaYTtKlWBIXZVCQnp5uLiXNWz5/tYH2/qoVivcVsCnJcZg+6snObTrZLAkPbWVQfYiqk4V8mmBUabfkOuTcYBFyYazHeG1q96z/EfKz3SLn7PnS98wj+BgzaD1dFXFuTRCef5OCtP9DL4lxZs2lufu5xtofcPsXgGUqkZsFAAA=\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var button = '_1votq06 _1votq05';\nexport var buttonIcon = '_1votq08';\nexport var danger = '_1votq07';\nexport var item = '_1votq05';\nexport var popoverContent = '_1votq03';\nexport var root = '_1votq02';\nexport var separator = '_1votq04';","import {\n  CloseIcon,\n  DeleteIcon,\n  DeletePermanentlyIcon,\n  ResetIcon,\n} from '@blocksuite/icons/rc';\nimport type { ReactNode } from 'react';\n\nimport { FloatingToolbar } from './floating-toolbar';\nimport * as styles from './list-floating-toolbar.css';\n\nexport const ListFloatingToolbar = ({\n  content,\n  onClose,\n  open,\n  onDelete,\n  onRestore,\n}: {\n  open: boolean;\n  content: ReactNode;\n  onClose: () => void;\n  onDelete?: () => void;\n  onRestore?: () => void;\n}) => {\n  return (\n    <FloatingToolbar className={styles.floatingToolbar} open={open}>\n      <FloatingToolbar.Item>{content}</FloatingToolbar.Item>\n      <FloatingToolbar.Button onClick={onClose} icon={<CloseIcon />} />\n      <FloatingToolbar.Separator />\n      {!!onRestore && (\n        <FloatingToolbar.Button\n          onClick={onRestore}\n          icon={<ResetIcon />}\n          data-testid=\"list-toolbar-restore\"\n        />\n      )}\n      {!!onDelete && (\n        <FloatingToolbar.Button\n          onClick={onDelete}\n          icon={onRestore ? <DeletePermanentlyIcon /> : <DeleteIcon />}\n          type=\"danger\"\n          data-testid=\"list-toolbar-delete\"\n        />\n      )}\n    </FloatingToolbar>\n  );\n};\n","import \"../core/src/components/page-list/components/list-floating-toolbar.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/page-list/components/list-floating-toolbar.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xcWZhcGFtMCB7CiAgcG9zaXRpb246IGFic29sdXRlOwogIGJvdHRvbTogMjZweDsKICB3aWR0aDogMTAwJTsKICB6LWluZGV4OiAxOwp9\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var floatingToolbar = '_1qfapam0';","import \"../core/src/components/page-list/docs/page-list-item.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/page-list/docs/page-list-item.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACr1W247bIBB9z1eglVbaSEvkXJsStf9RVVVFYGzTxWABTrKt9t8rg51gx0madtU3ezzMnDlzmPHk+3Sh+DTdJejXCCEubCnpK0GphMNmhBDTUhuCdtQ8YUzTVCjADg4Ol0YU1Lxi7zCuXXMQWe4IWi5Kf7QOgW1uhHohKKkte8FdTtA0SR7rVypFprBwUFiCrDPgWF7bnaHKCie0ImhL2UtmdKV4yISSycw+I11SJtyrf6uP6B2YVOo9QbngHJSHXhlbY+eQ0kq6AEBKzHKqMiBtjM3obTQ5skDyOpTnop+6x4J3PJYfx/jKqaOYScFe6FbCJ2cq+OZDtpBKLZQD0zk29R4tiYtlIHGrDQeDDeWisgStg/WsTR0qGYTgcQmXweNUSAl8HLLVHaO8JrLjX4Cqmi/esaAH3HRzvkoCqEKo1jYLtqi6ma+u1G1fDUjqxA5CMJMJhSWkjiDclNgS0YpFV04KBQQprfypknIuVNYcW4d8gXpuaJZF1J9QkC2k2kBohlYOlCPo4WHTwUa3VsvK+SxOlwQtAwSvy1SbgoRHSR18ecLL5NFzEoDEQl90S2leY3mHTxdEfUOApaQMci15JMMzwcxCzib0EV50DQKE5/g63GTRyyfm8titfr7pxXiRUajsLIcPe4I9Wf5toCGY8wZmK9ch0Kf7jD4jkgpjHWa5kDwouaO+6aond39G0sEjJmBY947MYyeCErS8765ntKxvSy/qYnisX4hxPrJTrRy24if0xOftOZ53R99yOJsPy4UBFlTPtKwKdYYjZHfUuE2XiUBvZ+owKtlTPRsQRqtFeRi3eXz3ENrnwgG2JWV+ZOwNLWtzZcFgCxKYaydJBH8VRDewS67SYIvx0WffKGyVJFdgRED9Mj2lBClFaYU9kWNBptF6jOB+uAj34ta2wLTi3b19tbaD/UNm/6GO9X0ava3IYQIE0youu6f1CNDH9wPU8HdXQyLl95Zhu2o7P1IRcPr/gJ///w0Mj9pSCyQWynl11y/l9q6aflTWibSG1Sx3jwEUv9Fy9n5ZwnTDfh6vhn+F334DRtyk13cLAAA=\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var actionsCellWrapper = '_14nd1fvb';\nexport var dateCell = '_14nd1fva';\nexport var dndCell = '_14nd1fv2';\nexport var dragPageItemOverlay = '_14nd1fv1';\nexport var iconCell = '_14nd1fv8';\nexport var operationsCell = '_14nd1fvc';\nexport var root = '_14nd1fv0';\nexport var selectionCell = '_14nd1fv4';\nexport var tagsCell = '_14nd1fv9';\nexport var titleCell = '_14nd1fv5';\nexport var titleCellMain = '_14nd1fv6';\nexport var titleCellPreview = '_14nd1fv7';\nexport var titleIconsWrapper = '_14nd1fv3';","import { Checkbox, Tooltip, useDraggable } from '@affine/component';\nimport { TagService } from '@affine/core/modules/tag';\nimport type { AffineDNDData } from '@affine/core/types/dnd';\nimport { stopPropagation } from '@affine/core/utils';\nimport { i18nTime } from '@affine/i18n';\nimport { useLiveData, useService } from '@toeverything/infra';\nimport type { ForwardedRef, PropsWithChildren } from 'react';\nimport { forwardRef, useCallback, useEffect, useMemo } from 'react';\n\nimport { WorkbenchLink } from '../../../modules/workbench/view/workbench-link';\nimport {\n  anchorIndexAtom,\n  rangeIdsAtom,\n  selectionStateAtom,\n  useAtom,\n} from '../scoped-atoms';\nimport type { PageListItemProps } from '../types';\nimport { useAllDocDisplayProperties } from '../use-all-doc-display-properties';\nimport { ColWrapper } from '../utils';\nimport * as styles from './page-list-item.css';\nimport { PageTags } from './page-tags';\n\nconst ListTitleCell = ({\n  title,\n  preview,\n}: Pick<PageListItemProps, 'title' | 'preview'>) => {\n  const [displayProperties] = useAllDocDisplayProperties();\n  return (\n    <div data-testid=\"page-list-item-title\" className={styles.titleCell}>\n      <div\n        data-testid=\"page-list-item-title-text\"\n        className={styles.titleCellMain}\n      >\n        {title}\n      </div>\n      {preview && displayProperties.displayProperties.bodyNotes ? (\n        <div\n          data-testid=\"page-list-item-preview-text\"\n          className={styles.titleCellPreview}\n        >\n          {preview}\n        </div>\n      ) : null}\n    </div>\n  );\n};\n\nconst ListIconCell = ({ icon }: Pick<PageListItemProps, 'icon'>) => {\n  return (\n    <div data-testid=\"page-list-item-icon\" className={styles.iconCell}>\n      {icon}\n    </div>\n  );\n};\n\nconst PageSelectionCell = ({\n  selectable,\n  onSelectedChange,\n  selected,\n}: Pick<PageListItemProps, 'selectable' | 'onSelectedChange' | 'selected'>) => {\n  const onSelectionChange = useCallback(\n    (_event: React.ChangeEvent<HTMLInputElement>) => {\n      return onSelectedChange?.();\n    },\n    [onSelectedChange]\n  );\n  if (!selectable) {\n    return null;\n  }\n  return (\n    <div className={styles.selectionCell}>\n      <Checkbox\n        onClick={stopPropagation}\n        checked={!!selected}\n        onChange={onSelectionChange}\n      />\n    </div>\n  );\n};\n\nexport const PageTagsCell = ({ pageId }: Pick<PageListItemProps, 'pageId'>) => {\n  const tagList = useService(TagService).tagList;\n  const tags = useLiveData(tagList.tagsByPageId$(pageId));\n\n  return (\n    <div data-testid=\"page-list-item-tags\" className={styles.tagsCell}>\n      <PageTags\n        tags={tags}\n        hoverExpandDirection=\"left\"\n        widthOnHover=\"300%\"\n        maxItems={5}\n      />\n    </div>\n  );\n};\n\nconst PageCreateDateCell = ({\n  createDate,\n}: Pick<PageListItemProps, 'createDate'>) => {\n  return (\n    <Tooltip content={i18nTime(createDate)}>\n      <div\n        data-testid=\"page-list-item-date\"\n        data-date-raw={createDate}\n        className={styles.dateCell}\n      >\n        {i18nTime(createDate, {\n          relative: true,\n        })}\n      </div>\n    </Tooltip>\n  );\n};\n\nconst PageUpdatedDateCell = ({\n  updatedDate,\n}: Pick<PageListItemProps, 'updatedDate'>) => {\n  return (\n    <Tooltip content={updatedDate ? i18nTime(updatedDate) : undefined}>\n      <div\n        data-testid=\"page-list-item-date\"\n        data-date-raw={updatedDate}\n        className={styles.dateCell}\n      >\n        {updatedDate\n          ? i18nTime(updatedDate, {\n              relative: true,\n            })\n          : '-'}\n      </div>\n    </Tooltip>\n  );\n};\n\nconst PageListOperationsCell = ({\n  operations,\n}: Pick<PageListItemProps, 'operations'>) => {\n  return operations ? (\n    <div onClick={stopPropagation} className={styles.operationsCell}>\n      {operations}\n    </div>\n  ) : null;\n};\n\nexport const PageListItem = (props: PageListItemProps) => {\n  const [displayProperties] = useAllDocDisplayProperties();\n  const pageTitleElement = useMemo(() => {\n    return (\n      <div className={styles.dragPageItemOverlay}>\n        <div className={styles.titleIconsWrapper}>\n          <PageSelectionCell\n            onSelectedChange={props.onSelectedChange}\n            selectable={props.selectable}\n            selected={props.selected}\n          />\n          <ListIconCell icon={props.icon} />\n        </div>\n        <ListTitleCell title={props.title} preview={props.preview} />\n      </div>\n    );\n  }, [\n    props.icon,\n    props.onSelectedChange,\n    props.preview,\n    props.selectable,\n    props.selected,\n    props.title,\n  ]);\n\n  const { dragRef, CustomDragPreview, dragging } = useDraggable<AffineDNDData>(\n    () => ({\n      canDrag: props.draggable,\n      data: {\n        entity: {\n          type: 'doc',\n          id: props.pageId,\n        },\n        from: {\n          at: 'all-docs:list',\n        },\n      },\n    }),\n    [props.draggable, props.pageId]\n  );\n\n  return (\n    <>\n      <PageListItemWrapper\n        onClick={props.onClick}\n        to={props.to}\n        pageId={props.pageId}\n        draggable={props.draggable}\n        isDragging={dragging}\n        ref={dragRef}\n        pageIds={props.pageIds || []}\n      >\n        <ColWrapper flex={9}>\n          <ColWrapper className={styles.dndCell} flex={8}>\n            <div className={styles.titleIconsWrapper}>\n              <PageSelectionCell\n                onSelectedChange={props.onSelectedChange}\n                selectable={props.selectable}\n                selected={props.selected}\n              />\n              <ListIconCell icon={props.icon} />\n            </div>\n            <ListTitleCell title={props.title} preview={props.preview} />\n          </ColWrapper>\n          <ColWrapper\n            flex={4}\n            alignment=\"end\"\n            style={{ overflow: 'visible' }}\n            hidden={!displayProperties.displayProperties.tags}\n          >\n            <PageTagsCell pageId={props.pageId} />\n          </ColWrapper>\n        </ColWrapper>\n        <ColWrapper\n          flex={1}\n          alignment=\"end\"\n          hideInSmallContainer\n          hidden={!displayProperties.displayProperties.createDate}\n        >\n          <PageCreateDateCell createDate={props.createDate} />\n        </ColWrapper>\n        <ColWrapper\n          flex={1}\n          alignment=\"end\"\n          hideInSmallContainer\n          hidden={!displayProperties.displayProperties.updatedDate}\n        >\n          <PageUpdatedDateCell updatedDate={props.updatedDate} />\n        </ColWrapper>\n        {props.operations ? (\n          <ColWrapper\n            className={styles.actionsCellWrapper}\n            flex={1}\n            alignment=\"end\"\n          >\n            <PageListOperationsCell operations={props.operations} />\n          </ColWrapper>\n        ) : null}\n      </PageListItemWrapper>\n      <CustomDragPreview position=\"pointer-outside\">\n        {pageTitleElement}\n      </CustomDragPreview>\n    </>\n  );\n};\n\ntype PageListWrapperProps = PropsWithChildren<\n  Pick<PageListItemProps, 'to' | 'pageId' | 'onClick' | 'draggable'> & {\n    isDragging: boolean;\n    pageIds: string[];\n  }\n>;\n\nconst PageListItemWrapper = forwardRef(\n  (\n    {\n      to,\n      isDragging,\n      pageId,\n      pageIds,\n      onClick,\n      children,\n      draggable,\n    }: PageListWrapperProps,\n    ref: ForwardedRef<HTMLAnchorElement & HTMLDivElement>\n  ) => {\n    const [selectionState, setSelectionActive] = useAtom(selectionStateAtom);\n    const [anchorIndex, setAnchorIndex] = useAtom(anchorIndexAtom);\n    const [rangeIds, setRangeIds] = useAtom(rangeIdsAtom);\n\n    const handleShiftClick = useCallback(\n      (currentIndex: number) => {\n        if (anchorIndex === undefined) {\n          setAnchorIndex(currentIndex);\n          onClick?.();\n          return;\n        }\n\n        const lowerIndex = Math.min(anchorIndex, currentIndex);\n        const upperIndex = Math.max(anchorIndex, currentIndex);\n        const newRangeIds = pageIds.slice(lowerIndex, upperIndex + 1);\n\n        const currentSelected = selectionState.selectedIds || [];\n\n        // Set operations\n        const setRange = new Set(rangeIds);\n        const newSelected = new Set(\n          currentSelected.filter(id => !setRange.has(id)).concat(newRangeIds)\n        );\n\n        selectionState.onSelectedIdsChange?.([...newSelected]);\n        setRangeIds(newRangeIds);\n      },\n      [\n        anchorIndex,\n        onClick,\n        pageIds,\n        selectionState,\n        setAnchorIndex,\n        rangeIds,\n        setRangeIds,\n      ]\n    );\n\n    const handleClick = useCallback(\n      (e: React.MouseEvent) => {\n        if (!selectionState.selectable) {\n          return;\n        }\n        e.stopPropagation();\n        const currentIndex = pageIds.indexOf(pageId);\n\n        if (e.shiftKey) {\n          e.preventDefault();\n          if (!selectionState.selectionActive) {\n            setSelectionActive(true);\n            setAnchorIndex(currentIndex);\n            onClick?.();\n          } else {\n            handleShiftClick(currentIndex);\n          }\n        } else {\n          setAnchorIndex(undefined);\n          setRangeIds([]);\n          onClick?.();\n          return;\n        }\n      },\n      [\n        handleShiftClick,\n        onClick,\n        pageId,\n        pageIds,\n        selectionState.selectable,\n        selectionState.selectionActive,\n        setAnchorIndex,\n        setRangeIds,\n        setSelectionActive,\n      ]\n    );\n\n    const commonProps = useMemo(\n      () => ({\n        'data-testid': 'page-list-item',\n        'data-page-id': pageId,\n        'data-draggable': draggable,\n        className: styles.root,\n        'data-clickable': !!onClick || !!to,\n        'data-dragging': isDragging,\n        onClick: onClick ? handleClick : undefined,\n      }),\n      [pageId, draggable, onClick, to, isDragging, handleClick]\n    );\n\n    useEffect(() => {\n      if (selectionState.selectionActive) {\n        // listen for shift key up\n        const handleKeyUp = (e: KeyboardEvent) => {\n          if (e.key === 'Shift') {\n            setAnchorIndex(undefined);\n            setRangeIds([]);\n          }\n        };\n        window.addEventListener('keyup', handleKeyUp);\n        return () => {\n          window.removeEventListener('keyup', handleKeyUp);\n        };\n      }\n      return;\n    }, [\n      selectionState.selectionActive,\n      setAnchorIndex,\n      setRangeIds,\n      setSelectionActive,\n    ]);\n\n    if (to) {\n      return (\n        <WorkbenchLink ref={ref} {...commonProps} to={to}>\n          {children}\n        </WorkbenchLink>\n      );\n    } else {\n      return (\n        <div ref={ref} {...commonProps}>\n          {children}\n        </div>\n      );\n    }\n  }\n);\nPageListItemWrapper.displayName = 'PageListItemWrapper';\n","import \"../core/src/components/page-list/docs/page-tags.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/page-list/docs/page-tags.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACqVVwW7bMAy95yt0KdAAVeA46ZYq2JcMOygWHbNVJE+im2TF/n2QZDu2m7YIdgkc0iQfH/noxfPvNYJfsrcZY7X1SGiNYA60JHyF7YyxIyqqBFtm2V34WwHuK7r8P6DhnW2V16ft7O9skbLmMatCX2t5FqzUcAoRUuPecCQ4eMEKMARuELSKQfYVXKntkZ8Eq1ApMNsPAU4R7WUt2GaEZB2TBgD86II7/G47k0IHRcpbWN0czDuU8TVP0lFfYD0q8Hi91ZSOXxB90P2wNbnzVjd0tbWDPPHJPMhJ04dqzbJF7lm2WHkG0gNHw21DA6RLUQVy2Qj4IO+rdPecJ2c2HwR+m+zIECfZWrAsPGkoqX10CXt2rRFbywLp3Hqv9RDsO1m87J1tjBJMowHp+N5JhWDo/ilTsH9IobV0YIhldw8tfFmWaIDHTnlhtXW8RK1Bzdk6u5t/TEdqske3HLz5Pbq6RvI8jfPdyIMeWiqzT+b93HjC8swLawgMCeZrWQDfAR0hLPulrNDSEy8q1CrN6lIgjK1NMIjY3CC7r4EwVkul0OwFy7odjoyKMdcEJ+K1w4N050T5PI7QOtXNYBIxdA1HsvmpJEle2qLxoH6Qa+BXbOmTXNPCfbKnpHxriHv8A4KhqcAhDbCFjWp82M36nWjXydS+2UlvZPR01iCYtxrVdGnH/faOKzwNlZ23NE9FEynuLqNgoDXWHqNSjhUS8Dg6wYxN560nQU5JGOFK9sN8NOt1fWLL/D0hLbRboVyaWWWjw7n7GlrFH+fTe3I5Q56weDmPpIhGx+C4+H2lIlZqOZ4wvBlNtFuIx0R7Ov6VQ/MSq/cZ1ehTNfxQ3U5P48MqgYaCgtnAoA78n6Avrn7BJvuV39I+Y0XjfFBgbXHy8Yb2mr59poPBVQ5K/Qe26VgDgwgAAA==\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var hoverMaxWidth = 'var(--jq4ies0)';\nexport var innerBackdrop = 'jq4ies6';\nexport var innerContainer = 'jq4ies5';\nexport var root = 'jq4ies1';\nexport var showMoreTag = 'jq4iesb';\nexport var tag = 'jq4ies7';\nexport var tagIndicator = 'jq4iesc';\nexport var tagInline = 'jq4ies9 jq4ies8';\nexport var tagInnerWrapper = 'jq4ies8';\nexport var tagLabel = 'jq4iesd';\nexport var tagListItem = 'jq4iesa jq4ies7';\nexport var tagRemove = 'jq4iese';\nexport var tagsContainer = 'jq4ies2';\nexport var tagsListContainer = 'jq4ies4 jq4ies2';\nexport var tagsScrollContainer = 'jq4ies3 jq4ies2';","import { Menu } from '@affine/component';\nimport { useCatchEventCallback } from '@affine/core/hooks/use-catch-event-hook';\nimport type { Tag } from '@affine/core/modules/tag';\nimport { stopPropagation } from '@affine/core/utils';\nimport { CloseIcon, MoreHorizontalIcon } from '@blocksuite/icons/rc';\nimport { LiveData, useLiveData } from '@toeverything/infra';\nimport { assignInlineVars } from '@vanilla-extract/dynamic';\nimport clsx from 'clsx';\nimport { useMemo } from 'react';\n\nimport * as styles from './page-tags.css';\n\nexport interface PageTagsProps {\n  tags: Tag[];\n  maxItems?: number; // max number to show. if not specified, show all. if specified, show the first n items and add a \"...\" tag\n  widthOnHover?: number | string; // max width on hover\n  hoverExpandDirection?: 'left' | 'right'; // expansion direction on hover\n}\n\ninterface TagItemProps {\n  tag?: Tag;\n  idx?: number;\n  maxWidth?: number | string;\n  mode: 'inline' | 'list-item';\n  focused?: boolean;\n  onRemoved?: () => void;\n  style?: React.CSSProperties;\n}\n\nexport const TempTagItem = ({\n  value,\n  color,\n  maxWidth = '100%',\n}: {\n  value: string;\n  color: string;\n  maxWidth?: number | string;\n}) => {\n  return (\n    <div className={styles.tag} title={value}>\n      <div style={{ maxWidth: maxWidth }} className={styles.tagInline}>\n        <div\n          className={styles.tagIndicator}\n          style={{\n            backgroundColor: color,\n          }}\n        />\n        <div className={styles.tagLabel}>{value}</div>\n      </div>\n    </div>\n  );\n};\n\nexport const TagItem = ({\n  tag,\n  idx,\n  mode,\n  focused,\n  onRemoved,\n  style,\n  maxWidth,\n}: TagItemProps) => {\n  const value = useLiveData(tag?.value$);\n  const color = useLiveData(tag?.color$);\n  const handleRemove = useCatchEventCallback(() => {\n    onRemoved?.();\n  }, [onRemoved]);\n  return (\n    <div\n      data-testid=\"page-tag\"\n      className={styles.tag}\n      data-idx={idx}\n      data-tag-id={tag?.id}\n      data-tag-value={value}\n      title={value}\n      style={style}\n    >\n      <div\n        style={{ maxWidth: maxWidth }}\n        data-focused={focused}\n        className={mode === 'inline' ? styles.tagInline : styles.tagListItem}\n      >\n        <div\n          className={styles.tagIndicator}\n          style={{\n            backgroundColor: color,\n          }}\n        />\n        <div className={styles.tagLabel}>{value}</div>\n        {onRemoved ? (\n          <div\n            data-testid=\"remove-tag-button\"\n            className={styles.tagRemove}\n            onClick={handleRemove}\n          >\n            <CloseIcon />\n          </div>\n        ) : null}\n      </div>\n    </div>\n  );\n};\n\nconst TagItemNormal = ({\n  tags,\n  maxItems,\n}: {\n  tags: Tag[];\n  maxItems?: number;\n}) => {\n  const nTags = useMemo(() => {\n    return maxItems ? tags.slice(0, maxItems) : tags;\n  }, [maxItems, tags]);\n\n  const tagsOrdered = useLiveData(\n    useMemo(() => {\n      return LiveData.computed(get =>\n        [...nTags].sort((a, b) => get(a.value$).length - get(b.value$).length)\n      );\n    }, [nTags])\n  );\n\n  return useMemo(\n    () =>\n      tagsOrdered.map((tag, idx) => (\n        <TagItem key={tag.id} tag={tag} idx={idx} mode=\"inline\" />\n      )),\n    [tagsOrdered]\n  );\n};\n\nexport const PageTags = ({\n  tags,\n  widthOnHover,\n  maxItems,\n  hoverExpandDirection,\n}: PageTagsProps) => {\n  const sanitizedWidthOnHover = widthOnHover\n    ? typeof widthOnHover === 'string'\n      ? widthOnHover\n      : `${widthOnHover}px`\n    : 'auto';\n\n  const tagsInPopover = useMemo(() => {\n    const lastTags = tags.slice(maxItems);\n    return (\n      <div className={styles.tagsListContainer}>\n        {lastTags.map((tag, idx) => (\n          <TagItem key={tag.id} tag={tag} idx={idx} mode=\"list-item\" />\n        ))}\n      </div>\n    );\n  }, [maxItems, tags]);\n\n  return (\n    <div\n      data-testid=\"page-tags\"\n      className={styles.root}\n      style={assignInlineVars({\n        [styles.hoverMaxWidth]: sanitizedWidthOnHover,\n      })}\n    >\n      <div\n        style={{\n          right: hoverExpandDirection === 'left' ? 0 : 'auto',\n          left: hoverExpandDirection === 'right' ? 0 : 'auto',\n        }}\n        className={clsx(styles.innerContainer)}\n      >\n        <div className={styles.innerBackdrop} />\n        <div className={styles.tagsScrollContainer}>\n          <TagItemNormal tags={tags} maxItems={maxItems} />\n        </div>\n        {maxItems && tags.length > maxItems ? (\n          <Menu\n            items={tagsInPopover}\n            contentOptions={{\n              onClick: stopPropagation,\n            }}\n          >\n            <div className={styles.showMoreTag}>\n              <MoreHorizontalIcon />\n            </div>\n          </Menu>\n        ) : null}\n      </div>\n    </div>\n  );\n};\n","import { Tooltip } from '@affine/component';\nimport { useI18n } from '@affine/i18n';\n\nimport { ellipsisTextStyle } from './index.css';\ntype FilterTagProps = {\n  name: string;\n};\n\nconst useFilterTag = ({ name }: FilterTagProps) => {\n  const t = useI18n();\n  switch (name) {\n    case 'Created':\n      return t['Created']();\n    case 'Updated':\n      return t['Updated']();\n    case 'Tags':\n      return t['Tags']();\n    case 'Is Favourited':\n      return t['com.affine.filter.is-favourited']();\n    case 'Is Public':\n      return t['com.affine.filter.is-public']();\n    case 'after':\n      return t['com.affine.filter.after']();\n    case 'before':\n      return t['com.affine.filter.before']();\n    case 'last':\n      return t['com.affine.filter.last']();\n    case 'is':\n      return t['com.affine.filter.is']();\n    case 'is not empty':\n      return t['com.affine.filter.is not empty']();\n    case 'is empty':\n      return t['com.affine.filter.is empty']();\n    case 'contains all':\n      return t['com.affine.filter.contains all']();\n    case 'contains one of':\n      return t['com.affine.filter.contains one of']();\n    case 'does not contains all':\n      return t['com.affine.filter.does not contains all']();\n    case 'does not contains one of':\n      return t['com.affine.filter.does not contains one of']();\n    case 'true':\n      return t['com.affine.filter.true']();\n    case 'false':\n      return t['com.affine.filter.false']();\n    default:\n      return name;\n  }\n};\n\nexport const FilterTag = ({ name }: FilterTagProps) => {\n  const tag = useFilterTag({ name });\n\n  return (\n    <Tooltip content={tag}>\n      <span className={ellipsisTextStyle} data-testid={`filler-tag-${tag}`}>\n        {tag}\n      </span>\n    </Tooltip>\n  );\n};\n","import type { Filter, Literal, Ref, VariableMap } from '@affine/env/filter';\n\nimport { filterMatcher } from './vars';\n\nconst evalRef = (ref: Ref, variableMap: VariableMap) => {\n  return variableMap[ref.name];\n};\nconst evalLiteral = (lit?: Literal) => {\n  return lit?.value;\n};\nconst evalFilter = (filter: Filter, variableMap: VariableMap): boolean => {\n  const impl = filterMatcher.findData(v => v.name === filter.funcName)?.impl;\n  if (!impl) {\n    throw new Error('No function implementation found');\n  }\n  const leftValue = evalRef(filter.left, variableMap);\n  const args = filter.args.map(evalLiteral);\n  return impl(leftValue, ...args);\n};\nexport const evalFilterList = (\n  filterList: Filter[],\n  variableMap: VariableMap\n) => {\n  return filterList.every(filter => evalFilter(filter, variableMap));\n};\n","import type { PopoverProps } from '@affine/component';\nimport { DatePicker, Popover } from '@affine/component';\nimport { useI18n } from '@affine/i18n';\nimport dayjs from 'dayjs';\nimport { useCallback, useState } from 'react';\n\nimport { datePickerTriggerInput } from './date-select.css';\n\nconst datePickerPopperContentOptions: PopoverProps['contentOptions'] = {\n  style: { padding: 20, marginTop: 10 },\n};\n\nexport const DateSelect = ({\n  value,\n  onChange,\n}: {\n  value: number;\n  onChange: (value: number) => void;\n}) => {\n  const t = useI18n();\n  const [open, setOpen] = useState(false);\n\n  const onDateChange = useCallback(\n    (e: string) => {\n      setOpen(false);\n      onChange(dayjs(e, 'YYYY-MM-DD').valueOf());\n    },\n    [onChange]\n  );\n\n  return (\n    <Popover\n      open={open}\n      onOpenChange={setOpen}\n      contentOptions={datePickerPopperContentOptions}\n      content={\n        <DatePicker\n          weekDays={t['com.affine.calendar-date-picker.week-days']()}\n          monthNames={t['com.affine.calendar-date-picker.month-names']()}\n          todayLabel={t['com.affine.calendar-date-picker.today']()}\n          value={dayjs(value as number).format('YYYY-MM-DD')}\n          onChange={onDateChange}\n        />\n      }\n    >\n      <input\n        value={dayjs(value as number).format('MMM DD')}\n        className={datePickerTriggerInput}\n      />\n    </Popover>\n  );\n};\n","import \"../core/src/components/page-list/filter/date-select.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/page-list/filter/date-select.css.ts.vanilla.css\\\",\\\"source\\\":\\\"LndobDd2ajAgewogIGZvbnQtc2l6ZTogdmFyKC0tYWZmaW5lLWZvbnQteHMpOwogIHdpZHRoOiA1MHB4OwogIGZvbnQtd2VpZ2h0OiA2MDA7CiAgZGlzcGxheTogZmxleDsKICBhbGlnbi1pdGVtczogY2VudGVyOwogIGp1c3RpZnktY29udGVudDogY2VudGVyOwogIGhlaWdodDogMjJweDsKICB0ZXh0LWFsaWduOiBjZW50ZXI7Cn0KLndobDd2ajA6aG92ZXIgewogIGJhY2tncm91bmQ6IHZhcigtLWFmZmluZS1ob3Zlci1jb2xvcik7CiAgYm9yZGVyLXJhZGl1czogNHB4Owp9\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var datePickerTriggerInput = 'whl7vj0';","import \"../core/src/components/page-list/filter/multi-select.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/page-list/filter/multi-select.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACq2Tz26DMAzG730KH7dDKqB/VKUPM6XEgLWQREko7aa++5QUKGu7w6SeUGzn888fzvIjF2bXHw8ZfC8AKqMD8/SFHPLCnvYLgNIo4zgchXtjTFQVaWQBT4FZR61wZ5YK3mPpwTiJjjkhqfMcdlcBK6QkXXNY2ROsB9HO+ahqDemALobMEV2lTM+hISlR7xeXxXKi403MJ8aDKD9rZzot2TO2VDhBzTTydPuxDUAa55ZApch68jHVNxSQeStK5KBN74SN4VacWE8yNBxWmyzONG+0xNaGc2r3p3seS6Pl3L+ZQpHuSvJWiTOHSmFyLX6ZJIdlIKN5FO/aNEEtLB+9nfzOxkikbZDqJnAoinvcVWrGmC+dUeog3DjZ+q5w/ZxKKKo1o4Ct51Di+D/nqzRwTAzb6/luXzY32oGgWGdDjPQYy7PsYc5pV+/Xak7/ghXavHCFon0c8l/62385/Az98VG2wtWkmcIqDE/y8gNm6vns9QMAAA==\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var content = '_1ao8wvb0';\nexport var done = '_1ao8wvb6';\nexport var optionLabel = '_1ao8wvb5';\nexport var optionList = '_1ao8wvb2';\nexport var scrollbar = '_1ao8wvb3';\nexport var selectOption = '_1ao8wvb4';\nexport var text = '_1ao8wvb1';","import { Menu, MenuItem, Scrollable, Tooltip } from '@affine/component';\nimport { useI18n } from '@affine/i18n';\nimport clsx from 'clsx';\nimport type { MouseEvent } from 'react';\nimport { useMemo } from 'react';\n\nimport * as styles from './multi-select.css';\n\nexport const MultiSelect = ({\n  value,\n  onChange,\n  options,\n}: {\n  value: string[];\n  onChange: (value: string[]) => void;\n  options: {\n    label: string;\n    value: string;\n  }[];\n}) => {\n  const t = useI18n();\n  const optionMap = useMemo(\n    () => Object.fromEntries(options.map(v => [v.value, v])),\n    [options]\n  );\n\n  const content = useMemo(\n    () => value.map(id => optionMap[id]?.label).join(', '),\n    [optionMap, value]\n  );\n\n  const items = useMemo(() => {\n    return (\n      <Scrollable.Root>\n        <Scrollable.Viewport\n          data-testid=\"multi-select\"\n          className={styles.optionList}\n        >\n          {options.length === 0 ? (\n            <MenuItem checked={true}>\n              {t['com.affine.filter.empty-tag']()}\n            </MenuItem>\n          ) : (\n            options.map(option => {\n              const selected = value.includes(option.value);\n              const click = (e: MouseEvent<HTMLDivElement>) => {\n                e.stopPropagation();\n                e.preventDefault();\n                if (selected) {\n                  onChange(value.filter(v => v !== option.value));\n                } else {\n                  onChange([...value, option.value]);\n                }\n              };\n              return (\n                <MenuItem\n                  data-testid={`multi-select-${option.label}`}\n                  checked={selected}\n                  onClick={click}\n                  key={option.value}\n                >\n                  {option.label}\n                </MenuItem>\n              );\n            })\n          )}\n        </Scrollable.Viewport>\n        <Scrollable.Scrollbar className={styles.scrollbar} />\n      </Scrollable.Root>\n    );\n  }, [onChange, options, t, value]);\n\n  return (\n    <Menu items={items}>\n      <div className={styles.content}>\n        <Tooltip\n          content={\n            content.length ? content : t['com.affine.filter.empty-tag']()\n          }\n        >\n          {value.length ? (\n            <div className={styles.text}>{content}</div>\n          ) : (\n            <div className={clsx(styles.text, 'empty')}>\n              {t['com.affine.filter.empty-tag']()}\n            </div>\n          )}\n        </Tooltip>\n      </div>\n    </Menu>\n  );\n};\n","import { Input, Menu, MenuItem } from '@affine/component';\nimport type { LiteralValue, Tag } from '@affine/env/filter';\nimport type { ReactNode } from 'react';\n\nimport { DateSelect } from './date-select';\nimport { FilterTag } from './filter-tag-translation';\nimport { inputStyle } from './index.css';\nimport { tBoolean, tDate, tDateRange, tTag } from './logical/custom-type';\nimport { Matcher } from './logical/matcher';\nimport type { TType } from './logical/typesystem';\nimport { tArray, typesystem } from './logical/typesystem';\nimport { MultiSelect } from './multi-select';\n\nexport const literalMatcher = new Matcher<{\n  render: (props: {\n    type: TType;\n    value: LiteralValue;\n    onChange: (lit: LiteralValue) => void;\n  }) => ReactNode;\n}>((type, target) => {\n  return typesystem.isSubtype(type, target);\n});\n\nliteralMatcher.register(tDateRange.create(), {\n  render: ({ value, onChange }) => (\n    <Menu\n      items={\n        <div>\n          <Input\n            type=\"number\"\n            // Handle the input change and update the value accordingly\n            onChange={i => (i ? onChange(parseInt(i)) : onChange(0))}\n          />\n          {[1, 2, 3, 7, 14, 30].map(i => (\n            <MenuItem\n              key={i}\n              onClick={() => {\n                // Handle the menu item click and update the value accordingly\n                onChange(i);\n              }}\n            >\n              {i} {i > 1 ? 'days' : 'day'}\n            </MenuItem>\n          ))}\n        </div>\n      }\n    >\n      <div>\n        <span>{value.toString()}</span> {(value as number) > 1 ? 'days' : 'day'}\n      </div>\n    </Menu>\n  ),\n});\n\nliteralMatcher.register(tBoolean.create(), {\n  render: ({ value, onChange }) => (\n    <div\n      className={inputStyle}\n      style={{ cursor: 'pointer' }}\n      onClick={() => {\n        onChange(!value);\n      }}\n    >\n      <FilterTag name={value?.toString()} />\n    </div>\n  ),\n});\nliteralMatcher.register(tDate.create(), {\n  render: ({ value, onChange }) => (\n    <DateSelect value={value as number} onChange={onChange} />\n  ),\n});\nconst getTagsOfArrayTag = (type: TType): Tag[] => {\n  if (type.type === 'array') {\n    if (tTag.is(type.ele)) {\n      return type.ele.data?.tags ?? [];\n    }\n    return [];\n  } else {\n    return [];\n  }\n};\nliteralMatcher.register(tArray(tTag.create()), {\n  render: ({ type, value, onChange }) => {\n    return (\n      <MultiSelect\n        value={(value ?? []) as string[]}\n        onChange={value => onChange(value)}\n        options={getTagsOfArrayTag(type).map(v => ({\n          label: v.value,\n          value: v.id,\n        }))}\n      ></MultiSelect>\n    );\n  },\n});\n","import { Menu, MenuItem, Tooltip } from '@affine/component';\nimport type { Filter, Literal, PropertiesMeta } from '@affine/env/filter';\nimport clsx from 'clsx';\nimport type { ReactNode } from 'react';\nimport { useMemo } from 'react';\n\nimport { FilterTag } from './filter-tag-translation';\nimport * as styles from './index.css';\nimport { literalMatcher } from './literal-matcher';\nimport { tBoolean } from './logical/custom-type';\nimport type { TFunction, TType } from './logical/typesystem';\nimport { typesystem } from './logical/typesystem';\nimport { variableDefineMap } from './shared-types';\nimport { filterMatcher, VariableSelect, vars } from './vars';\n\nexport const Condition = ({\n  value,\n  onChange,\n  propertiesMeta,\n}: {\n  value: Filter;\n  onChange: (filter: Filter) => void;\n  propertiesMeta: PropertiesMeta;\n}) => {\n  const data = useMemo(() => {\n    const data = filterMatcher.find(v => v.data.name === value.funcName);\n    if (!data) {\n      return;\n    }\n    const instance = typesystem.instance(\n      {},\n      [variableDefineMap[value.left.name].type(propertiesMeta)],\n      tBoolean.create(),\n      data.type\n    );\n    return {\n      render: data.data.render,\n      type: instance,\n    };\n  }, [propertiesMeta, value.funcName, value.left.name]);\n  if (!data) {\n    return null;\n  }\n  const render =\n    data.render ??\n    (({ ast }) => {\n      const args = renderArgs(value, onChange, data.type);\n      return (\n        <div className={styles.filterContainerStyle}>\n          <Menu\n            items={\n              <VariableSelect\n                propertiesMeta={propertiesMeta}\n                selected={[]}\n                onSelect={onChange}\n              />\n            }\n          >\n            <div\n              data-testid=\"variable-name\"\n              className={clsx(styles.filterTypeStyle, styles.ellipsisTextStyle)}\n            >\n              <Tooltip content={ast.left.name}>\n                <div className={styles.filterTypeIconStyle}>\n                  {variableDefineMap[ast.left.name].icon}\n                </div>\n              </Tooltip>\n              <FilterTag name={ast.left.name} />\n            </div>\n          </Menu>\n          <Menu\n            items={\n              <FunctionSelect\n                propertiesMeta={propertiesMeta}\n                value={value}\n                onChange={onChange}\n              />\n            }\n          >\n            <div\n              className={clsx(styles.switchStyle, styles.ellipsisTextStyle)}\n              data-testid=\"filter-name\"\n            >\n              <FilterTag name={ast.funcName} />\n            </div>\n          </Menu>\n          {args}\n        </div>\n      );\n    });\n  return <>{render({ ast: value })}</>;\n};\n\nconst FunctionSelect = ({\n  value,\n  onChange,\n  propertiesMeta,\n}: {\n  value: Filter;\n  onChange: (value: Filter) => void;\n  propertiesMeta: PropertiesMeta;\n}) => {\n  const list = useMemo(() => {\n    const type = vars.find(v => v.name === value.left.name)?.type;\n    if (!type) {\n      return [];\n    }\n    return filterMatcher.allMatchedData(type(propertiesMeta));\n  }, [propertiesMeta, value.left.name]);\n  return (\n    <div data-testid=\"filter-name-select\">\n      {list.map(v => (\n        <MenuItem\n          onClick={() => {\n            onChange({\n              ...value,\n              funcName: v.name,\n              args: v.defaultArgs().map(v => ({ type: 'literal', value: v })),\n            });\n          }}\n          key={v.name}\n        >\n          <FilterTag name={v.name} />\n        </MenuItem>\n      ))}\n    </div>\n  );\n};\n\nexport const Arg = ({\n  type,\n  value,\n  onChange,\n}: {\n  type: TType;\n  value: Literal;\n  onChange: (lit: Literal) => void;\n}) => {\n  const data = useMemo(() => literalMatcher.match(type), [type]);\n  if (!data) {\n    return null;\n  }\n  return (\n    <div\n      data-testid=\"filter-arg\"\n      className={clsx(styles.argStyle, styles.ellipsisTextStyle)}\n    >\n      {data.render({\n        type,\n        value: value?.value,\n        onChange: v => onChange({ type: 'literal', value: v }),\n      })}\n    </div>\n  );\n};\nexport const renderArgs = (\n  filter: Filter,\n  onChange: (value: Filter) => void,\n  type: TFunction\n): ReactNode => {\n  const rest = type.args.slice(1);\n  return rest.map((argType, i) => {\n    const value = filter.args[i];\n    return (\n      <Arg\n        key={i}\n        type={argType}\n        value={value}\n        onChange={value => {\n          const args = type.args.map((_, index) =>\n            i === index ? value : filter.args[index]\n          );\n          onChange({\n            ...filter,\n            args,\n          });\n        }}\n      ></Arg>\n    );\n  });\n};\n","import { Button, IconButton, Menu } from '@affine/component';\nimport type { Filter, PropertiesMeta } from '@affine/env/filter';\nimport { useI18n } from '@affine/i18n';\nimport { CloseIcon, PlusIcon } from '@blocksuite/icons/rc';\n\nimport { Condition } from './condition';\nimport * as styles from './index.css';\nimport { CreateFilterMenu } from './vars';\n\nexport const FilterList = ({\n  value,\n  onChange,\n  propertiesMeta,\n}: {\n  value: Filter[];\n  onChange: (value: Filter[]) => void;\n  propertiesMeta: PropertiesMeta;\n}) => {\n  const t = useI18n();\n  return (\n    <div\n      style={{\n        display: 'flex',\n        flexWrap: 'wrap',\n        gap: 10,\n        alignItems: 'center',\n      }}\n    >\n      {value.map((filter, i) => {\n        return (\n          <div className={styles.filterItemStyle} key={i}>\n            <Condition\n              propertiesMeta={propertiesMeta}\n              value={filter}\n              onChange={filter => {\n                onChange(\n                  value.map((old, oldIndex) => (oldIndex === i ? filter : old))\n                );\n              }}\n            />\n            <div\n              className={styles.filterItemCloseStyle}\n              onClick={() => {\n                onChange(value.filter((_, index) => i !== index));\n              }}\n            >\n              <CloseIcon />\n            </div>\n          </div>\n        );\n      })}\n      <Menu\n        items={\n          <CreateFilterMenu\n            value={value}\n            onChange={onChange}\n            propertiesMeta={propertiesMeta}\n          />\n        }\n      >\n        {value.length === 0 ? (\n          <Button suffix={<PlusIcon />}>\n            {t['com.affine.filterList.button.add']()}\n          </Button>\n        ) : (\n          <IconButton size=\"16\">\n            <PlusIcon />\n          </IconButton>\n        )}\n      </Menu>\n    </div>\n  );\n};\n","import type { Tag } from '@affine/env/filter';\n\nimport { DataHelper, typesystem } from './typesystem';\n\nexport const tNumber = typesystem.defineData(\n  DataHelper.create<{ value: number }>('Number')\n);\nexport const tString = typesystem.defineData(\n  DataHelper.create<{ value: string }>('String')\n);\nexport const tBoolean = typesystem.defineData(\n  DataHelper.create<{ value: boolean }>('Boolean')\n);\nexport const tDate = typesystem.defineData(\n  DataHelper.create<{ value: number }>('Date')\n);\n\nexport const tTag = typesystem.defineData<{ tags: Tag[] }>({\n  name: 'Tag',\n  supers: [],\n});\n\nexport const tDateRange = typesystem.defineData(\n  DataHelper.create<{ value: number }>('DateRange')\n);\n","import type { TType } from './typesystem';\nimport { typesystem } from './typesystem';\n\ntype MatcherData<Data, Type extends TType = TType> = { type: Type; data: Data };\n\nexport class Matcher<Data, Type extends TType = TType> {\n  private readonly list: MatcherData<Data, Type>[] = [];\n\n  constructor(\n    private readonly _match?: (type: Type, target: TType) => boolean\n  ) {}\n\n  register(type: Type, data: Data) {\n    this.list.push({ type, data });\n  }\n\n  match(type: TType) {\n    const match = this._match ?? typesystem.isSubtype.bind(typesystem);\n    for (const t of this.list) {\n      if (match(t.type, type)) {\n        return t.data;\n      }\n    }\n    return;\n  }\n\n  allMatched(type: TType): MatcherData<Data>[] {\n    const match = this._match ?? typesystem.isSubtype.bind(typesystem);\n    const result: MatcherData<Data>[] = [];\n    for (const t of this.list) {\n      if (match(t.type, type)) {\n        result.push(t);\n      }\n    }\n    return result;\n  }\n\n  allMatchedData(type: TType): Data[] {\n    return this.allMatched(type).map(v => v.data);\n  }\n\n  findData(f: (data: Data) => boolean): Data | undefined {\n    return this.list.find(data => f(data.data))?.data;\n  }\n\n  find(\n    f: (data: MatcherData<Data, Type>) => boolean\n  ): MatcherData<Data, Type> | undefined {\n    return this.list.find(f);\n  }\n\n  all(): MatcherData<Data, Type>[] {\n    return this.list;\n  }\n}\n","/**\n * This file will be moved to a separate package soon.\n */\n\nexport interface TUnion {\n  type: 'union';\n  title: 'union';\n  list: TType[];\n}\n\nexport const tUnion = (list: TType[]): TUnion => ({\n  type: 'union',\n  title: 'union',\n  list,\n});\n\n// TODO treat as data type\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nexport interface TArray<Ele extends TType = TType> {\n  type: 'array';\n  ele: Ele;\n  title: 'array';\n}\n\nexport const tArray = <const T extends TType>(ele: T): TArray<T> => {\n  return {\n    type: 'array',\n    title: 'array',\n    ele,\n  };\n};\nexport type TTypeVar = {\n  type: 'typeVar';\n  title: 'typeVar';\n  name: string;\n  bound: TType;\n};\nexport const tTypeVar = (name: string, bound: TType): TTypeVar => {\n  return {\n    type: 'typeVar',\n    title: 'typeVar',\n    name,\n    bound,\n  };\n};\nexport type TTypeRef = {\n  type: 'typeRef';\n  title: 'typeRef';\n  name: string;\n};\nexport const tTypeRef = (name: string): TTypeRef => {\n  return {\n    type: 'typeRef',\n    title: 'typeRef',\n    name,\n  };\n};\n\nexport type TFunction = {\n  type: 'function';\n  title: 'function';\n  typeVars: TTypeVar[];\n  args: TType[];\n  rt: TType;\n};\n\nexport const tFunction = (fn: {\n  typeVars?: TTypeVar[];\n  args: TType[];\n  rt: TType;\n}): TFunction => {\n  return {\n    type: 'function',\n    title: 'function',\n    typeVars: fn.typeVars ?? [],\n    args: fn.args,\n    rt: fn.rt,\n  };\n};\n\nexport type TType = TDataType | TArray | TUnion | TTypeRef | TFunction;\n\nexport type DataTypeShape = Record<string, unknown>;\nexport type TDataType<Data extends DataTypeShape = Record<string, unknown>> = {\n  type: 'data';\n  name: string;\n  data?: Data;\n};\nexport type ValueOfData<T extends DataDefine> =\n  T extends DataDefine<infer R> ? R : never;\n\nexport class DataDefine<Data extends DataTypeShape = Record<string, unknown>> {\n  constructor(\n    private readonly config: DataDefineConfig<Data>,\n    private readonly dataMap: Map<string, DataDefine>\n  ) {}\n\n  create(data?: Data): TDataType<Data> {\n    return {\n      type: 'data',\n      name: this.config.name,\n      data,\n    };\n  }\n\n  is(data: TType): data is TDataType<Data> {\n    if (data.type !== 'data') {\n      return false;\n    }\n    return data.name === this.config.name;\n  }\n\n  private isByName(name: string): boolean {\n    return name === this.config.name;\n  }\n\n  isSubOf(superType: TDataType): boolean {\n    if (this.is(superType)) {\n      return true;\n    }\n    return this.config.supers.some(sup => sup.isSubOf(superType));\n  }\n\n  private isSubOfByName(superType: string): boolean {\n    if (this.isByName(superType)) {\n      return true;\n    }\n    return this.config.supers.some(sup => sup.isSubOfByName(superType));\n  }\n\n  isSuperOf(subType: TDataType): boolean {\n    const dataDefine = this.dataMap.get(subType.name);\n    if (!dataDefine) {\n      throw new Error('bug');\n    }\n    return dataDefine.isSubOfByName(this.config.name);\n  }\n}\n\n// type DataTypeVar = {};\n\n// TODO support generic data type\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\ninterface DataDefineConfig<T extends DataTypeShape> {\n  name: string;\n  supers: DataDefine[];\n  _phantom?: T;\n}\n\ninterface DataHelper<T extends DataTypeShape> {\n  create<V = Record<string, unknown>>(name: string): DataDefineConfig<T & V>;\n\n  extends<V extends DataTypeShape>(\n    dataDefine: DataDefine<V>\n  ): DataHelper<T & V>;\n}\n\nconst createDataHelper = <T extends DataTypeShape = Record<string, unknown>>(\n  ...supers: DataDefine[]\n): DataHelper<T> => {\n  return {\n    create(name: string) {\n      return {\n        name,\n        supers,\n      };\n    },\n    extends(dataDefine) {\n      return createDataHelper(...supers, dataDefine);\n    },\n  };\n};\nexport const DataHelper = createDataHelper();\n\nexport class Typesystem {\n  dataMap = new Map<string, DataDefine<any>>();\n\n  defineData<T extends DataTypeShape>(\n    config: DataDefineConfig<T>\n  ): DataDefine<T> {\n    const result = new DataDefine(config, this.dataMap);\n    this.dataMap.set(config.name, result);\n    return result;\n  }\n\n  isDataType(t: TType): t is TDataType {\n    return t.type === 'data';\n  }\n\n  isSubtype(\n    superType: TType,\n    sub: TType,\n    context?: Record<string, TType>\n  ): boolean {\n    if (superType.type === 'typeRef') {\n      // TODO both are ref\n      if (context && sub.type !== 'typeRef') {\n        context[superType.name] = sub;\n      }\n      // TODO bound\n      return true;\n    }\n    if (sub.type === 'typeRef') {\n      // TODO both are ref\n      if (context) {\n        context[sub.name] = superType;\n      }\n      return true;\n    }\n    if (tUnknown.is(superType)) {\n      return true;\n    }\n    if (superType.type === 'union') {\n      return superType.list.some(type => this.isSubtype(type, sub, context));\n    }\n    if (sub.type === 'union') {\n      return sub.list.every(type => this.isSubtype(superType, type, context));\n    }\n\n    if (this.isDataType(sub)) {\n      const dataDefine = this.dataMap.get(sub.name);\n      if (!dataDefine) {\n        throw new Error('bug');\n      }\n      if (!this.isDataType(superType)) {\n        return false;\n      }\n      return dataDefine.isSubOf(superType);\n    }\n\n    if (superType.type === 'array' || sub.type === 'array') {\n      if (superType.type !== 'array' || sub.type !== 'array') {\n        return false;\n      }\n      return this.isSubtype(superType.ele, sub.ele, context);\n    }\n    return false;\n  }\n\n  subst(context: Record<string, TType>, template: TFunction): TFunction {\n    const subst = (type: TType): TType => {\n      if (this.isDataType(type)) {\n        return type;\n      }\n      switch (type.type) {\n        case 'typeRef':\n          return { ...context[type.name] };\n        case 'union':\n          return tUnion(type.list.map(type => subst(type)));\n        case 'array':\n          return tArray(subst(type.ele));\n        case 'function':\n          throw new Error('TODO');\n      }\n    };\n    const result = tFunction({\n      args: template.args.map(type => subst(type)),\n      rt: subst(template.rt),\n    });\n    return result;\n  }\n\n  instance(\n    context: Record<string, TType>,\n    realArgs: TType[],\n    realRt: TType,\n    template: TFunction\n  ): TFunction {\n    const ctx = { ...context };\n    template.args.forEach((arg, i) => {\n      const realArg = realArgs[i];\n      if (realArg) {\n        this.isSubtype(arg, realArg, ctx);\n      }\n    });\n    this.isSubtype(realRt, template.rt);\n    return this.subst(ctx, template);\n  }\n}\n\nexport const typesystem = new Typesystem();\nexport const tUnknown = typesystem.defineData(DataHelper.create('Unknown'));\n","import type {\n  Literal,\n  LiteralValue,\n  PropertiesMeta,\n  VariableMap,\n} from '@affine/env/filter';\nimport {\n  CloudWorkspaceIcon,\n  CreatedIcon,\n  FavoriteIcon,\n  TagsIcon,\n  UpdatedIcon,\n} from '@blocksuite/icons/rc';\nimport type { ReactElement } from 'react';\n\nimport { tBoolean, tDate, tTag } from './logical/custom-type';\nimport type { TType } from './logical/typesystem';\nimport { tArray } from './logical/typesystem';\n\nexport const toLiteral = (value: LiteralValue): Literal => ({\n  type: 'literal',\n  value,\n});\n\nexport type FilterVariable = {\n  name: keyof VariableMap;\n  type: (propertiesMeta: PropertiesMeta) => TType;\n  icon: ReactElement;\n};\n\nexport const variableDefineMap = {\n  Created: {\n    type: () => tDate.create(),\n    icon: <CreatedIcon />,\n  },\n  Updated: {\n    type: () => tDate.create(),\n    icon: <UpdatedIcon />,\n  },\n  'Is Favourited': {\n    type: () => tBoolean.create(),\n    icon: <FavoriteIcon />,\n  },\n  Tags: {\n    type: meta => tArray(tTag.create({ tags: meta.tags?.options ?? [] })),\n    icon: <TagsIcon />,\n  },\n  'Is Public': {\n    type: () => tBoolean.create(),\n    icon: <CloudWorkspaceIcon />,\n  },\n  // Imported: {\n  //   type: tBoolean.create(),\n  // },\n  // 'Daily Note': {\n  //   type: tBoolean.create(),\n  // },\n} satisfies Record<string, Omit<FilterVariable, 'name'>>;\n\nexport type InternalVariableMap = {\n  [K in keyof typeof variableDefineMap]: LiteralValue;\n};\n\ndeclare module '@affine/env/filter' {\n  // eslint-disable-next-line @typescript-eslint/no-empty-interface\n  interface VariableMap extends InternalVariableMap {}\n}\n","import { MenuIcon, MenuItem, MenuSeparator } from '@affine/component';\nimport type {\n  Filter,\n  LiteralValue,\n  PropertiesMeta,\n  VariableMap,\n} from '@affine/env/filter';\nimport { useI18n } from '@affine/i18n';\nimport dayjs from 'dayjs';\nimport type { ReactNode } from 'react';\n\nimport { FilterTag } from './filter-tag-translation';\nimport * as styles from './index.css';\nimport { tBoolean, tDate, tDateRange, tTag } from './logical/custom-type';\nimport { Matcher } from './logical/matcher';\nimport type { TFunction } from './logical/typesystem';\nimport {\n  tArray,\n  tFunction,\n  tTypeRef,\n  tTypeVar,\n  typesystem,\n} from './logical/typesystem';\nimport type { FilterVariable } from './shared-types';\nimport { variableDefineMap } from './shared-types';\n\nexport const vars: FilterVariable[] = Object.entries(variableDefineMap).map(\n  ([key, value]) => ({\n    name: key as keyof VariableMap,\n    type: value.type,\n    icon: value.icon,\n  })\n);\n\nexport const createDefaultFilter = (\n  variable: FilterVariable,\n  propertiesMeta: PropertiesMeta\n): Filter => {\n  const data = filterMatcher.match(variable.type(propertiesMeta));\n  if (!data) {\n    throw new Error('No matching function found');\n  }\n  return {\n    type: 'filter',\n    left: {\n      type: 'ref',\n      name: variable.name,\n    },\n    funcName: data.name,\n    args: data.defaultArgs().map(value => ({\n      type: 'literal',\n      value,\n    })),\n  };\n};\n\nexport const CreateFilterMenu = ({\n  value,\n  onChange,\n  propertiesMeta,\n}: {\n  value: Filter[];\n  onChange: (value: Filter[]) => void;\n  propertiesMeta: PropertiesMeta;\n}) => {\n  return (\n    <VariableSelect\n      propertiesMeta={propertiesMeta}\n      selected={value}\n      onSelect={filter => {\n        onChange([...value, filter]);\n      }}\n    />\n  );\n};\nexport const VariableSelect = ({\n  onSelect,\n  propertiesMeta,\n}: {\n  selected: Filter[];\n  onSelect: (value: Filter) => void;\n  propertiesMeta: PropertiesMeta;\n}) => {\n  const t = useI18n();\n  return (\n    <div data-testid=\"variable-select\">\n      <div className={styles.variableSelectTitleStyle}>\n        {t['com.affine.filter']()}\n      </div>\n      <MenuSeparator />\n      {vars\n        // .filter(v => !selected.find(filter => filter.left.name === v.name))\n        .map(v => (\n          <MenuItem\n            preFix={<MenuIcon>{variableDefineMap[v.name].icon}</MenuIcon>}\n            key={v.name}\n            onClick={() => {\n              onSelect(createDefaultFilter(v, propertiesMeta));\n            }}\n            className={styles.menuItemStyle}\n          >\n            <div\n              data-testid=\"variable-select-item\"\n              className={styles.menuItemTextStyle}\n            >\n              <FilterTag name={v.name} />\n            </div>\n          </MenuItem>\n        ))}\n    </div>\n  );\n};\n\nexport type FilterMatcherDataType = {\n  name: string;\n  defaultArgs: () => LiteralValue[];\n  render?: (props: { ast: Filter }) => ReactNode;\n  impl: (...args: (LiteralValue | undefined)[]) => boolean;\n};\nexport const filterMatcher = new Matcher<FilterMatcherDataType, TFunction>(\n  (type, target) => {\n    const staticType = typesystem.subst(\n      Object.fromEntries(type.typeVars?.map(v => [v.name, v.bound]) ?? []),\n      type\n    );\n    const firstArg = staticType.args[0];\n    return firstArg && typesystem.isSubtype(firstArg, target);\n  }\n);\n\nfilterMatcher.register(\n  tFunction({\n    args: [tBoolean.create(), tBoolean.create()],\n    rt: tBoolean.create(),\n  }),\n  {\n    name: 'is',\n    defaultArgs: () => [true],\n    impl: (value, target) => {\n      return value === target;\n    },\n  }\n);\n\nfilterMatcher.register(\n  tFunction({\n    args: [tDate.create(), tDate.create()],\n    rt: tBoolean.create(),\n  }),\n  {\n    name: 'after',\n    defaultArgs: () => {\n      return [dayjs().subtract(1, 'day').endOf('day').valueOf()];\n    },\n    impl: (date, target) => {\n      if (typeof date !== 'number' || typeof target !== 'number') {\n        throw new Error('argument type error');\n      }\n      return dayjs(date).isAfter(dayjs(target).endOf('day'));\n    },\n  }\n);\n\nfilterMatcher.register(\n  tFunction({\n    args: [tDate.create(), tDateRange.create()],\n    rt: tBoolean.create(),\n  }),\n  {\n    name: 'last',\n    defaultArgs: () => [30], // Default to the last 30 days\n    impl: (date, n) => {\n      if (typeof date !== 'number' || typeof n !== 'number') {\n        throw new Error('Argument type error: date and n must be numbers');\n      }\n      const startDate = dayjs().subtract(n, 'day').startOf('day').valueOf();\n      return date > startDate;\n    },\n  }\n);\n\nfilterMatcher.register(\n  tFunction({\n    args: [tDate.create(), tDate.create()],\n    rt: tBoolean.create(),\n  }),\n  {\n    name: 'before',\n    defaultArgs: () => [dayjs().endOf('day').valueOf()],\n    impl: (date, target) => {\n      if (typeof date !== 'number' || typeof target !== 'number') {\n        throw new Error('argument type error');\n      }\n      return dayjs(date).isBefore(dayjs(target).startOf('day'));\n    },\n  }\n);\nconst safeArray = (arr: unknown): LiteralValue[] => {\n  return Array.isArray(arr) ? arr : [];\n};\nfilterMatcher.register(\n  tFunction({\n    args: [tArray(tTag.create())],\n    rt: tBoolean.create(),\n  }),\n  {\n    name: 'is not empty',\n    defaultArgs: () => [],\n    impl: tags => {\n      const safeTags = safeArray(tags);\n      return safeTags.length > 0;\n    },\n  }\n);\n\nfilterMatcher.register(\n  tFunction({\n    args: [tArray(tTag.create())],\n    rt: tBoolean.create(),\n  }),\n  {\n    name: 'is empty',\n    defaultArgs: () => [],\n    impl: tags => {\n      const safeTags = safeArray(tags);\n      return safeTags.length === 0;\n    },\n  }\n);\n\nfilterMatcher.register(\n  tFunction({\n    typeVars: [tTypeVar('T', tTag.create())],\n    args: [tArray(tTypeRef('T')), tArray(tTypeRef('T'))],\n    rt: tBoolean.create(),\n  }),\n  {\n    name: 'contains all',\n    defaultArgs: () => [],\n    impl: (tags, target) => {\n      if (!Array.isArray(target)) {\n        return true;\n      }\n      const safeTags = safeArray(tags);\n      return target.every(id => safeTags.includes(id));\n    },\n  }\n);\n\nfilterMatcher.register(\n  tFunction({\n    typeVars: [tTypeVar('T', tTag.create())],\n    args: [tArray(tTypeRef('T')), tArray(tTypeRef('T'))],\n    rt: tBoolean.create(),\n  }),\n  {\n    name: 'contains one of',\n    defaultArgs: () => [],\n    impl: (tags, target) => {\n      if (!Array.isArray(target)) {\n        return true;\n      }\n      const safeTags = safeArray(tags);\n      return target.some(id => safeTags.includes(id));\n    },\n  }\n);\n\nfilterMatcher.register(\n  tFunction({\n    typeVars: [tTypeVar('T', tTag.create())],\n    args: [tArray(tTypeRef('T')), tArray(tTypeRef('T'))],\n    rt: tBoolean.create(),\n  }),\n  {\n    name: 'does not contains all',\n    defaultArgs: () => [],\n    impl: (tags, target) => {\n      if (!Array.isArray(target)) {\n        return true;\n      }\n      const safeTags = safeArray(tags);\n      return !target.every(id => safeTags.includes(id));\n    },\n  }\n);\n\nfilterMatcher.register(\n  tFunction({\n    typeVars: [tTypeVar('T', tTag.create())],\n    args: [tArray(tTypeRef('T')), tArray(tTypeRef('T'))],\n    rt: tBoolean.create(),\n  }),\n  {\n    name: 'does not contains one of',\n    defaultArgs: () => [],\n    impl: (tags, target) => {\n      if (!Array.isArray(target)) {\n        return true;\n      }\n      const safeTags = safeArray(tags);\n      return !target.some(id => safeTags.includes(id));\n    },\n  }\n);\n","import { Trans } from '@affine/i18n';\nimport { useMemo } from 'react';\n\nimport { ListHeaderTitleCell } from './page-header';\nimport type { HeaderColDef } from './types';\nimport { useAllDocDisplayProperties } from './use-all-doc-display-properties';\nexport const usePageHeaderColsDef = (): HeaderColDef[] => {\n  const [displayProperties] = useAllDocDisplayProperties();\n\n  return useMemo(\n    () => [\n      {\n        key: 'title',\n        content: <ListHeaderTitleCell />,\n        flex: 6,\n        alignment: 'start',\n        sortable: true,\n      },\n      {\n        key: 'tags',\n        content: <Trans i18nKey=\"Tags\" />,\n        flex: 3,\n        alignment: 'end',\n        hidden: !displayProperties.displayProperties.tags,\n      },\n      {\n        key: 'createDate',\n        content: <Trans i18nKey=\"Created\" />,\n        flex: 1,\n        sortable: true,\n        alignment: 'end',\n        hideInSmallContainer: true,\n        hidden: !displayProperties.displayProperties.createDate,\n      },\n      {\n        key: 'updatedDate',\n        content: <Trans i18nKey=\"Updated\" />,\n        flex: 1,\n        sortable: true,\n        alignment: 'end',\n        hideInSmallContainer: true,\n        hidden: !displayProperties.displayProperties.updatedDate,\n      },\n      {\n        key: 'actions',\n        content: '',\n        flex: 1,\n        alignment: 'end',\n      },\n    ],\n    [displayProperties]\n  );\n};\n\nexport const collectionHeaderColsDef: HeaderColDef[] = [\n  {\n    key: 'title',\n    content: <ListHeaderTitleCell />,\n    flex: 9,\n    alignment: 'start',\n    sortable: true,\n  },\n];\n\nexport const tagHeaderColsDef: HeaderColDef[] = [\n  {\n    key: 'title',\n    content: <ListHeaderTitleCell />,\n    flex: 8,\n    alignment: 'start',\n    sortable: true,\n  },\n  {\n    key: 'actions',\n    content: '',\n    flex: 1,\n    alignment: 'end',\n  },\n];\n","import \"../component/src/components/card/block-card/styles.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/components/card/block-card/styles.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xYWtzemtsMCB7CiAgZGlzcGxheTogZmxleDsKICBnYXA6IDEycHg7CiAgcGFkZGluZzogOHB4IDEycHg7CiAgY29sb3I6IHZhcigtLWFmZmluZS10ZXh0LXByaW1hcnktY29sb3IpOwogIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWFmZmluZS13aGl0ZS04MCk7CiAgYm9yZGVyLXJhZGl1czogOHB4OwogIHVzZXItc2VsZWN0OiBub25lOwogIGN1cnNvcjogcG9pbnRlcjsKICB0ZXh0LWFsaWduOiBzdGFydDsKICBib3gtc2hhZG93OiB2YXIoLS1hZmZpbmUtc2hhZG93LTEpOwp9Ci5fMWFrc3prbDA6aG92ZXIgewogIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWFmZmluZS1ob3Zlci1jb2xvcik7Cn0KLl8xYWtzemtsMFthcmlhLWRpc2FibGVkXSB7CiAgY29sb3I6IHZhcigtLWFmZmluZS10ZXh0LWRpc2FibGUtY29sb3IpOwp9Ci5fMWFrc3prbDBbYXJpYS1kaXNhYmxlZF06aG92ZXIgewogIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWFmZmluZS13aGl0ZS04MCk7CiAgY3Vyc29yOiBub3QtYWxsb3dlZDsKfQouXzFha3N6a2wxIHsKICBkaXNwbGF5OiBmbGV4OwogIGp1c3RpZnktY29udGVudDogY2VudGVyOwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7Cn0KLl8xYWtzemtsMiB7CiAgZGlzcGxheTogZmxleDsKICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogIGZsZXg6IDE7Cn0KLl8xYWtzemtsMyB7CiAgY29sb3I6IHZhcigtLWFmZmluZS10ZXh0LXNlY29uZGFyeS1jb2xvcik7CiAgZm9udC1zaXplOiB2YXIoLS1hZmZpbmUtZm9udC14cyk7Cn0=\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var blockCard = '_1akszkl0';\nexport var blockCardAround = '_1akszkl1';\nexport var blockCardContent = '_1akszkl2';\nexport var blockCardDesc = '_1akszkl3';","import type { HTMLAttributes, ReactNode } from 'react';\nimport { forwardRef } from 'react';\n\nimport * as styles from './styles.css';\n\nexport const BlockCard = forwardRef<\n  HTMLDivElement,\n  {\n    left?: ReactNode;\n    title: string;\n    desc?: string;\n    right?: ReactNode;\n    disabled?: boolean;\n  } & HTMLAttributes<HTMLDivElement>\n>(({ left, title, desc, right, disabled, onClick, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      className={styles.blockCard}\n      role=\"button\"\n      aria-disabled={disabled}\n      onClick={disabled ? undefined : onClick}\n      {...props}\n    >\n      {left && <div className={styles.blockCardAround}>{left}</div>}\n      <div className={styles.blockCardContent}>\n        <div>{title}</div>\n        <div className={styles.blockCardDesc}>{desc}</div>\n      </div>\n      {right && <div className={styles.blockCardAround}>{right}</div>}\n    </div>\n  );\n});\nBlockCard.displayName = 'BlockCard';\n","import { DropdownButton, Menu } from '@affine/component';\nimport { BlockCard } from '@affine/component/card/block-card';\nimport { track } from '@affine/core/mixpanel';\nimport { useI18n } from '@affine/i18n';\nimport { EdgelessIcon, ImportIcon, PageIcon } from '@blocksuite/icons/rc';\nimport type { MouseEvent, PropsWithChildren } from 'react';\nimport { useCallback, useState } from 'react';\n\nimport { menuContent } from './new-page-button.css';\n\ntype NewPageButtonProps = {\n  createNewPage: (e?: MouseEvent) => void;\n  createNewEdgeless: (e?: MouseEvent) => void;\n  importFile?: () => void;\n  size?: 'small' | 'default';\n};\n\nexport const CreateNewPagePopup = ({\n  createNewPage,\n  createNewEdgeless,\n  importFile,\n}: NewPageButtonProps) => {\n  const t = useI18n();\n  return (\n    <div\n      style={{\n        display: 'flex',\n        flexDirection: 'column',\n        gap: '8px',\n        padding: '8px',\n      }}\n    >\n      <BlockCard\n        title={t['com.affine.new.page-mode']()}\n        desc={t['com.affine.write_with_a_blank_page']()}\n        right={<PageIcon width={20} height={20} />}\n        onClick={createNewPage}\n        onAuxClick={createNewPage}\n        data-testid=\"new-page-button-in-all-page\"\n      />\n      <BlockCard\n        title={t['com.affine.new_edgeless']()}\n        desc={t['com.affine.draw_with_a_blank_whiteboard']()}\n        right={<EdgelessIcon width={20} height={20} />}\n        onClick={createNewEdgeless}\n        onAuxClick={createNewEdgeless}\n        data-testid=\"new-edgeless-button-in-all-page\"\n      />\n      {importFile ? (\n        <BlockCard\n          title={t['com.affine.new_import']()}\n          desc={t['com.affine.import_file']()}\n          right={<ImportIcon width={20} height={20} />}\n          onClick={importFile}\n          data-testid=\"import-button-in-all-page\"\n        />\n      ) : null}\n      {/* TODO Import */}\n    </div>\n  );\n};\n\nexport const NewPageButton = ({\n  createNewPage,\n  createNewEdgeless,\n  importFile,\n  size,\n  children,\n}: PropsWithChildren<NewPageButtonProps>) => {\n  const [open, setOpen] = useState(false);\n\n  const handleCreateNewPage: NewPageButtonProps['createNewPage'] = useCallback(\n    e => {\n      createNewPage(e);\n      setOpen(false);\n      track.allDocs.header.actions.createDoc();\n    },\n    [createNewPage]\n  );\n\n  const handleCreateNewEdgeless: NewPageButtonProps['createNewEdgeless'] =\n    useCallback(\n      e => {\n        createNewEdgeless(e);\n        setOpen(false);\n        track.allDocs.header.actions.createDoc({\n          mode: 'edgeless',\n        });\n      },\n      [createNewEdgeless]\n    );\n\n  const handleImportFile = useCallback(() => {\n    importFile?.();\n    setOpen(false);\n  }, [importFile]);\n\n  return (\n    <Menu\n      items={\n        <CreateNewPagePopup\n          createNewPage={handleCreateNewPage}\n          createNewEdgeless={handleCreateNewEdgeless}\n          importFile={importFile ? handleImportFile : undefined}\n        />\n      }\n      rootOptions={{\n        open,\n      }}\n      contentOptions={{\n        className: menuContent,\n        align: 'end',\n        hideWhenDetached: true,\n        onInteractOutside: useCallback(() => {\n          setOpen(false);\n        }, []),\n      }}\n    >\n      <DropdownButton\n        size={size}\n        onClick={handleCreateNewPage}\n        onAuxClick={handleCreateNewPage}\n        onClickDropDown={useCallback(() => setOpen(open => !open), [])}\n      >\n        {children}\n      </DropdownButton>\n    </Menu>\n  );\n};\n","import \"../core/src/components/page-list/components/new-page-button.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/page-list/components/new-page-button.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xbnI3MGNkMCB7CiAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tYWZmaW5lLWJhY2tncm91bmQtb3ZlcmxheS1wYW5lbC1jb2xvcik7Cn0=\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var menuContent = '_1nr70cd0';","import {\n  Button,\n  Menu,\n  MenuItem,\n  MenuSeparator,\n  MenuSub,\n} from '@affine/component';\nimport { useI18n } from '@affine/i18n';\nimport { ArrowDownSmallIcon, DoneIcon } from '@blocksuite/icons/rc';\nimport { useCallback, useMemo } from 'react';\n\nimport type { PageDisplayProperties, PageGroupByType } from '../types';\nimport { useAllDocDisplayProperties } from '../use-all-doc-display-properties';\nimport * as styles from './page-display-menu.css';\n\ntype GroupOption = {\n  value: PageGroupByType;\n  label: string;\n};\n\nexport const PageDisplayMenu = () => {\n  const t = useI18n();\n  const [workspaceProperties, setProperties] = useAllDocDisplayProperties();\n  const handleSelect = useCallback(\n    (value: PageGroupByType) => {\n      setProperties('groupBy', value);\n    },\n    [setProperties]\n  );\n  const handleSetDocDisplayProperties = useCallback(\n    (key: keyof PageDisplayProperties) => {\n      setProperties('displayProperties', {\n        ...workspaceProperties.displayProperties,\n        [key]: !workspaceProperties.displayProperties[key],\n      });\n    },\n    [setProperties, workspaceProperties.displayProperties]\n  );\n  const propertyOptions: Array<{\n    key: keyof PageDisplayProperties;\n    onClick: () => void;\n    label: string;\n  }> = useMemo(() => {\n    return [\n      {\n        key: 'bodyNotes',\n        onClick: () => handleSetDocDisplayProperties('bodyNotes'),\n        label: t['com.affine.page.display.display-properties.body-notes'](),\n      },\n      {\n        key: 'tags',\n        onClick: () => handleSetDocDisplayProperties('tags'),\n        label: t['Tags'](),\n      },\n      {\n        key: 'createDate',\n        onClick: () => handleSetDocDisplayProperties('createDate'),\n        label: t['Created'](),\n      },\n      {\n        key: 'updatedDate',\n        onClick: () => handleSetDocDisplayProperties('updatedDate'),\n        label: t['Updated'](),\n      },\n    ];\n  }, [handleSetDocDisplayProperties, t]);\n\n  const items = useMemo(() => {\n    const groupOptions: GroupOption[] = [\n      {\n        value: 'createDate',\n        label: t['Created'](),\n      },\n      {\n        value: 'updatedDate',\n        label: t['Updated'](),\n      },\n      {\n        value: 'tag',\n        label: t['com.affine.page.display.grouping.group-by-tag'](),\n      },\n      {\n        value: 'favourites',\n        label: t['com.affine.page.display.grouping.group-by-favourites'](),\n      },\n      {\n        value: 'none',\n        label: t['com.affine.page.display.grouping.no-grouping'](),\n      },\n    ];\n\n    const subItems = groupOptions.map(option => (\n      <MenuItem\n        key={option.value}\n        onSelect={() => handleSelect(option.value)}\n        data-active={workspaceProperties.groupBy === option.value}\n        endFix={\n          workspaceProperties.groupBy === option.value ? (\n            <DoneIcon fontSize={'20px'} />\n          ) : null\n        }\n        className={styles.subMenuItem}\n        data-testid={`group-by-${option.value}`}\n      >\n        <span>{option.label}</span>\n      </MenuItem>\n    ));\n\n    const currentGroupType = groupOptions.find(\n      option => option.value === workspaceProperties.groupBy\n    )?.label;\n\n    return (\n      <>\n        <MenuSub\n          subContentOptions={{\n            alignOffset: -8,\n            sideOffset: 12,\n          }}\n          triggerOptions={{ className: styles.subMenuTrigger }}\n          items={subItems}\n        >\n          <div\n            className={styles.subMenuTriggerContent}\n            data-testid=\"page-display-grouping-menuItem\"\n          >\n            <span>{t['com.affine.page.display.grouping']()}</span>\n            <span className={styles.currentGroupType}>{currentGroupType}</span>\n          </div>\n        </MenuSub>\n        <MenuSeparator />\n        <div className={styles.listOption}>\n          {t['com.affine.page.display.list-option']()}\n        </div>\n        <div className={styles.properties}>\n          {t['com.affine.page.display.display-properties']()}\n        </div>\n        <div className={styles.propertiesWrapper}>\n          {propertyOptions.map(option => (\n            <Button\n              key={option.label}\n              className={styles.propertyButton}\n              onClick={option.onClick}\n              data-active={!!workspaceProperties.displayProperties[option.key]}\n              data-testid={`property-${option.key}`}\n            >\n              {option.label}\n            </Button>\n          ))}\n        </div>\n      </>\n    );\n  }, [\n    handleSelect,\n    propertyOptions,\n    t,\n    workspaceProperties.displayProperties,\n    workspaceProperties.groupBy,\n  ]);\n  return (\n    <Menu\n      items={items}\n      contentOptions={{\n        className: styles.menu,\n\n        align: 'end',\n      }}\n    >\n      <Button\n        suffix={<ArrowDownSmallIcon />}\n        className={styles.headerDisplayButton}\n        data-testid=\"page-display-menu-button\"\n      >\n        {t['com.affine.page.display']()}\n      </Button>\n    </Menu>\n  );\n};\n","import \"../core/src/components/page-list/components/page-display-menu.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/page-list/components/page-display-menu.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACq2T0U7CMBSG73mKhiu5OGRMQCjxSYwx3Xo2qlvbtAc2NL67aYcwdEZJvFrSnX7/f875O31a6DYv2oS9jRirlYZGSdpylqaJbTej99H0WDHrKoQrlYYKC+JstgwljEGD2YsiENaCw1IZzZk2IJ0o+4Q0EqyQUukSnCq3xNnqUuU21hRGE3j1ipzthbsBEEWhNEI8b/0kiBYVttA4YYNW+F5gHqQgASIntcf7Mbkdjh8jOjeVcV+w1qlauAPEf5M+Zx7vSOVtJQ48agZtUalSgyKsPWc5akIXjp93nlQROJpQE2feihwhQ2oQdagog91VN7XYTIPdGBZJsvlT42dvi/OoPinzjjLUI2FL4DE3Wg63uuxvh7O5bdks7Zxuj/i07/y39Qx0d4WvU9IyQ2Tq6Kfv9u4/3Z6xq+F997LWJS3Ya09PJUk6pf52B6ydZdY/RjGOQyovsgoHlrS+KtcR9i3cH+OPLX3zAwAA\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var currentGroupType = '_5nxcfx5';\nexport var headerDisplayButton = '_5nxcfx1';\nexport var listOption = '_5nxcfx6';\nexport var menu = '_5nxcfx0';\nexport var properties = '_5nxcfx7';\nexport var propertiesWrapper = '_5nxcfx8';\nexport var propertyButton = '_5nxcfx9';\nexport var subMenuItem = '_5nxcfx3';\nexport var subMenuTrigger = '_5nxcfx2';\nexport var subMenuTriggerContent = '_5nxcfx4';","import type { Filter } from '@affine/env/filter';\n\nexport const createTagFilter = (id: string): Filter => {\n  return {\n    type: 'filter',\n    left: { type: 'ref', name: 'Tags' },\n    funcName: 'contains all',\n    args: [{ type: 'literal', value: [id] }],\n  };\n};\n","import \"../core/src/components/page-list/docs/page-list-header.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/page-list/docs/page-list-header.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACq1W226jMBB9z1f4ZaXtgyOgSZo6X+PgAaYFG9km0F3tv69sCDgJuVV9iZTBPp45c+bYy0zuW1hH5O+CkAIwLywjcRTV3W5BCC8xlxQtVIaRFKQF7cI1FwJlzshqW3ck3tQdSSL3s+q3qQPorFQtIwUKAdLFBJq65F+MZCX4RR+NsZh90VRJC9IyYmqeAt2DbaHfsufpZ65VIwUjB65/U8qzDCXQ6QOtNVZcO5RS6Zfd4t9i2VcU+4oyJS01+AfOEHy8oOuX3XFRO9S+jiIX83hnmyx0lhpIlRThkTO1XeEt5zUj256jI9fJ8L8xoKmBElLLiFQSgloSX8tcSpgqOZcIytKXeSufEf71Kryv+CrFK7/v0eLv93uUVVx3R5oezupOrzvj1+yVFqCp5gIb44Q+ntJUkvr+DBruV/a5GFWiOJNgDzSd/h2xElLxjrYobMHIa3RoXchXN00QlCXWBo371BZogXrenEZazesTKSV96r714ywvN29Q+SIbbRyXtcIzAax9I4c8zvS5DekYiVtHvzzlJXTUFBrlJyNRgLjxiHM+8Gx5I+Tbo0MQ6CD2jIwQ229AJNEJxPu85j0RAjWkFpVkg6B2E6tx1DM2anx7Ass97PgxCnYm75trrjpu389nFfqNz9BRGipnPNBZeDzIp0I5qmeV3LgIxuPT3mvdCbl2Ccan4+zuhqiXu85RMkKn0HHOessjRDXW6XcK3BxrU039yniFpfe+AjTawD2CSDCNw0eruTQ11yDtHZZTxuqSp1CoUoC+qqVgzaVnimf14xxi7MbxXp6S5I1VATyczB3twsmrlcEeXUPJLR7gHD854k/CGZGzxxLXqn3o4TC8G0KneU3OD3+s+Re+duFWqyfvkqloVjgufemXyjkB8gvnEA5o0IL45h2bLQUavi/hZiaNNGBDLs5kkf+4wRc/b/B4w8TiWz4087a4sKiP+8/B4Ynw1Gvwom//AbBkVwRQCwAA\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var arrowDownSmallIcon = 'fnbwe57';\nexport var buttonText = 'fnbwe5j';\nexport var docListHeader = 'fnbwe50';\nexport var docListHeaderTitle = 'fnbwe51';\nexport var rightButtonGroup = 'fnbwe5i';\nexport var searchIcon = 'fnbwe58';\nexport var searchInput = 'fnbwe5c';\nexport var tagIcon = 'fnbwe5g';\nexport var tagIndicator = 'fnbwe55';\nexport var tagLabel = 'fnbwe56';\nexport var tagSelectorItem = 'fnbwe5f';\nexport var tagSelectorItemText = 'fnbwe5h';\nexport var tagSelectorTagsScrollContainer = 'fnbwe5e';\nexport var tagSticky = 'fnbwe54';\nexport var tagsEditorRoot = 'fnbwe59';\nexport var tagsEditorSelectedTags = 'fnbwe5b';\nexport var tagsEditorTagsSelector = 'fnbwe5d';\nexport var tagsMenu = 'fnbwe5a';\nexport var titleCollectionName = 'fnbwe53';\nexport var titleIcon = 'fnbwe52';","import type { MouseEvent, PropsWithChildren } from 'react';\n\nimport { NewPageButton } from '../components/new-page-button';\nimport * as styles from './page-list-new-page-button.css';\n\nexport const PageListNewPageButton = ({\n  className,\n  children,\n  size,\n  testId,\n  onCreatePage,\n  onCreateEdgeless,\n  onImportFile,\n}: PropsWithChildren<{\n  className?: string;\n  size?: 'small' | 'default';\n  testId?: string;\n  onCreatePage: (e?: MouseEvent) => void;\n  onCreateEdgeless: (e?: MouseEvent) => void;\n  onImportFile?: (e?: MouseEvent) => void;\n}>) => {\n  return (\n    <div className={className} data-testid={testId}>\n      <NewPageButton\n        size={size}\n        importFile={onImportFile}\n        createNewEdgeless={onCreateEdgeless}\n        createNewPage={onCreatePage}\n      >\n        <div className={styles.newPageButtonLabel}>{children}</div>\n      </NewPageButton>\n    </div>\n  );\n};\n","import \"../core/src/components/page-list/docs/page-list-new-page-button.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/page-list/docs/page-list-new-page-button.css.ts.vanilla.css\\\",\\\"source\\\":\\\"LmU1eXJpdjAgewogIGRpc3BsYXk6IGZsZXg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKfQ==\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var newPageButtonLabel = 'e5yriv0';","import {\n  Button,\n  Divider,\n  Menu,\n  Scrollable,\n  useConfirmModal,\n} from '@affine/component';\nimport { useAsyncCallback } from '@affine/core/hooks/affine-async-hooks';\nimport { useNavigateHelper } from '@affine/core/hooks/use-navigate-helper';\nimport { track } from '@affine/core/mixpanel';\nimport type { Tag } from '@affine/core/modules/tag';\nimport { TagService } from '@affine/core/modules/tag';\nimport { isNewTabTrigger } from '@affine/core/utils';\nimport type { Collection } from '@affine/env/filter';\nimport { useI18n } from '@affine/i18n';\nimport {\n  ArrowDownSmallIcon,\n  SearchIcon,\n  ViewLayersIcon,\n} from '@blocksuite/icons/rc';\nimport type { Doc as BlockSuiteDoc } from '@blocksuite/store';\nimport { useLiveData, useService, WorkspaceService } from '@toeverything/infra';\nimport clsx from 'clsx';\nimport { nanoid } from 'nanoid';\nimport { useCallback, useMemo, useState } from 'react';\nimport { Link } from 'react-router-dom';\n\nimport { CollectionService } from '../../../modules/collection';\nimport { usePageHelper } from '../../blocksuite/block-suite-page-list/utils';\nimport { createTagFilter } from '../filter/utils';\nimport { createEmptyCollection } from '../use-collection-manager';\nimport {\n  useEditCollection,\n  useEditCollectionName,\n} from '../view/use-edit-collection';\nimport * as styles from './page-list-header.css';\nimport { PageListNewPageButton } from './page-list-new-page-button';\n\nexport const PageListHeader = () => {\n  const t = useI18n();\n  const workspace = useService(WorkspaceService).workspace;\n  const { importFile, createEdgeless, createPage } = usePageHelper(\n    workspace.docCollection\n  );\n\n  const title = useMemo(() => {\n    return t['com.affine.all-pages.header']();\n  }, [t]);\n\n  const onImportFile = useAsyncCallback(async () => {\n    const options = await importFile();\n    if (options.isWorkspaceFile) {\n      track.allDocs.header.actions.createWorkspace({\n        control: 'import',\n      });\n    } else {\n      track.allDocs.header.actions.createDoc({\n        control: 'import',\n      });\n    }\n  }, [importFile]);\n\n  return (\n    <div className={styles.docListHeader}>\n      <div className={styles.docListHeaderTitle}>{title}</div>\n      <PageListNewPageButton\n        size=\"small\"\n        testId=\"new-page-button-trigger\"\n        onCreateEdgeless={e =>\n          createEdgeless(isNewTabTrigger(e) ? 'new-tab' : true)\n        }\n        onCreatePage={e => createPage(isNewTabTrigger(e) ? 'new-tab' : true)}\n        onImportFile={onImportFile}\n      >\n        <div className={styles.buttonText}>{t['New Page']()}</div>\n      </PageListNewPageButton>\n    </div>\n  );\n};\nexport const CollectionPageListHeader = ({\n  collection,\n  workspaceId,\n}: {\n  collection: Collection;\n  workspaceId: string;\n}) => {\n  const t = useI18n();\n  const { jumpToCollections } = useNavigateHelper();\n\n  const handleJumpToCollections = useCallback(() => {\n    jumpToCollections(workspaceId);\n  }, [jumpToCollections, workspaceId]);\n\n  const collectionService = useService(CollectionService);\n  const { node, open } = useEditCollection();\n\n  const handleEdit = useAsyncCallback(async () => {\n    const ret = await open({ ...collection }, 'page');\n    collectionService.updateCollection(collection.id, () => ret);\n  }, [collection, collectionService, open]);\n\n  const workspace = useService(WorkspaceService).workspace;\n  const { createEdgeless, createPage } = usePageHelper(workspace.docCollection);\n  const { openConfirmModal } = useConfirmModal();\n\n  const createAndAddDocument = useCallback(\n    (createDocumentFn: () => BlockSuiteDoc) => {\n      const newDoc = createDocumentFn();\n      collectionService.addPageToCollection(collection.id, newDoc.id);\n    },\n    [collection.id, collectionService]\n  );\n\n  const onConfirmAddDocument = useCallback(\n    (createDocumentFn: () => BlockSuiteDoc) => {\n      openConfirmModal({\n        title: t['com.affine.collection.add-doc.confirm.title'](),\n        description: t['com.affine.collection.add-doc.confirm.description'](),\n        cancelText: t['Cancel'](),\n        confirmText: t['Confirm'](),\n        confirmButtonOptions: {\n          variant: 'primary',\n        },\n        onConfirm: () => createAndAddDocument(createDocumentFn),\n      });\n    },\n    [openConfirmModal, t, createAndAddDocument]\n  );\n\n  const onCreateEdgeless = useCallback(\n    () => onConfirmAddDocument(createEdgeless),\n    [createEdgeless, onConfirmAddDocument]\n  );\n  const onCreatePage = useCallback(\n    () => onConfirmAddDocument(createPage),\n    [createPage, onConfirmAddDocument]\n  );\n\n  return (\n    <>\n      {node}\n      <div className={styles.docListHeader}>\n        <div className={styles.docListHeaderTitle}>\n          <div style={{ cursor: 'pointer' }} onClick={handleJumpToCollections}>\n            {t['com.affine.collections.header']()} /\n          </div>\n          <div className={styles.titleIcon}>\n            <ViewLayersIcon />\n          </div>\n          <div className={styles.titleCollectionName}>{collection.name}</div>\n        </div>\n        <div className={styles.rightButtonGroup}>\n          <Button onClick={handleEdit}>{t['Edit']()}</Button>\n          <PageListNewPageButton\n            size=\"small\"\n            testId=\"new-page-button-trigger\"\n            onCreateEdgeless={onCreateEdgeless}\n            onCreatePage={onCreatePage}\n          >\n            <div className={styles.buttonText}>{t['New Page']()}</div>\n          </PageListNewPageButton>\n        </div>\n      </div>\n    </>\n  );\n};\n\nexport const TagPageListHeader = ({\n  tag,\n  workspaceId,\n}: {\n  tag: Tag;\n  workspaceId: string;\n}) => {\n  const tagColor = useLiveData(tag.color$);\n  const tagTitle = useLiveData(tag.value$);\n\n  const t = useI18n();\n  const { jumpToTags, jumpToCollection } = useNavigateHelper();\n  const collectionService = useService(CollectionService);\n  const [openMenu, setOpenMenu] = useState(false);\n  const { open, node } = useEditCollectionName({\n    title: t['com.affine.editCollection.saveCollection'](),\n    showTips: true,\n  });\n\n  const handleJumpToTags = useCallback(() => {\n    jumpToTags(workspaceId);\n  }, [jumpToTags, workspaceId]);\n\n  const saveToCollection = useCallback(\n    (collection: Collection) => {\n      collectionService.addCollection({\n        ...collection,\n        filterList: [createTagFilter(tag.id)],\n      });\n      jumpToCollection(workspaceId, collection.id);\n    },\n    [collectionService, tag.id, jumpToCollection, workspaceId]\n  );\n  const handleClick = useCallback(() => {\n    open('')\n      .then(name => {\n        return saveToCollection(createEmptyCollection(nanoid(), { name }));\n      })\n      .catch(err => {\n        console.error(err);\n      });\n  }, [open, saveToCollection]);\n\n  return (\n    <>\n      {node}\n      <div className={styles.docListHeader}>\n        <div className={styles.docListHeaderTitle}>\n          <div\n            style={{ cursor: 'pointer', lineHeight: '1.4em' }}\n            onClick={handleJumpToTags}\n          >\n            {t['Tags']()} /\n          </div>\n          <Menu\n            rootOptions={{\n              open: openMenu,\n              onOpenChange: setOpenMenu,\n            }}\n            contentOptions={{\n              side: 'bottom',\n              align: 'start',\n              sideOffset: 18,\n              avoidCollisions: false,\n              className: styles.tagsMenu,\n            }}\n            items={<SwitchTag onClick={setOpenMenu} />}\n          >\n            <div className={styles.tagSticky}>\n              <div\n                className={styles.tagIndicator}\n                style={{\n                  backgroundColor: tagColor,\n                }}\n              />\n              <div className={styles.tagLabel}>{tagTitle}</div>\n              <ArrowDownSmallIcon className={styles.arrowDownSmallIcon} />\n            </div>\n          </Menu>\n        </div>\n        <Button onClick={handleClick}>\n          {t['com.affine.editCollection.saveCollection']()}\n        </Button>\n      </div>\n    </>\n  );\n};\n\ninterface SwitchTagProps {\n  onClick: (open: boolean) => void;\n}\n\nexport const SwitchTag = ({ onClick }: SwitchTagProps) => {\n  const t = useI18n();\n  const [inputValue, setInputValue] = useState('');\n  const tagList = useService(TagService).tagList;\n  const filteredTags = useLiveData(\n    inputValue ? tagList.filterTagsByName$(inputValue) : tagList.tags$\n  );\n\n  const onInputChange = useCallback(\n    (e: React.ChangeEvent<HTMLInputElement>) => {\n      setInputValue(e.target.value);\n    },\n    []\n  );\n\n  const handleClick = useCallback(() => {\n    setInputValue('');\n    onClick(false);\n  }, [onClick]);\n\n  return (\n    <div className={styles.tagsEditorRoot}>\n      <div className={styles.tagsEditorSelectedTags}>\n        <SearchIcon className={styles.searchIcon} />\n        <input\n          value={inputValue}\n          onChange={onInputChange}\n          autoFocus\n          className={styles.searchInput}\n          placeholder={t['com.affine.search-tags.placeholder']()}\n        />\n      </div>\n      <Divider />\n      <div className={styles.tagsEditorTagsSelector}>\n        <Scrollable.Root>\n          <Scrollable.Viewport\n            className={styles.tagSelectorTagsScrollContainer}\n          >\n            {filteredTags.map(tag => {\n              return <TagLink key={tag.id} tag={tag} onClick={handleClick} />;\n            })}\n            {filteredTags.length === 0 ? (\n              <div className={clsx(styles.tagSelectorItem, 'disable')}>\n                {t['Find 0 result']()}\n              </div>\n            ) : null}\n          </Scrollable.Viewport>\n          <Scrollable.Scrollbar style={{ transform: 'translateX(6px)' }} />\n        </Scrollable.Root>\n      </div>\n    </div>\n  );\n};\n\nconst TagLink = ({ tag, onClick }: { tag: Tag; onClick: () => void }) => {\n  const tagColor = useLiveData(tag.color$);\n  const tagTitle = useLiveData(tag.value$);\n  return (\n    <Link\n      key={tag.id}\n      className={styles.tagSelectorItem}\n      data-tag-id={tag.id}\n      data-tag-value={tagTitle}\n      to={`/tag/${tag.id}`}\n      onClick={onClick}\n    >\n      <div className={styles.tagIcon} style={{ background: tagColor }} />\n      <div className={styles.tagSelectorItemText}>{tagTitle}</div>\n    </Link>\n  );\n};\n","import { CompatibleFavoriteItemsAdapter } from '@affine/core/modules/properties';\nimport type { Tag } from '@affine/core/modules/tag';\nimport { TagService } from '@affine/core/modules/tag';\nimport { useI18n } from '@affine/i18n';\nimport { FavoritedIcon, FavoriteIcon } from '@blocksuite/icons/rc';\nimport type { DocMeta } from '@blocksuite/store';\nimport { LiveData, useLiveData, useService } from '@toeverything/infra';\nimport { type ReactNode, useMemo } from 'react';\n\nimport * as styles from './group-definitions.css';\nimport type { DateKey, ItemGroupDefinition, ListItem } from './types';\nimport { useAllDocDisplayProperties } from './use-all-doc-display-properties';\nimport { betweenDaysAgo, withinDaysAgo } from './utils';\n\nconst GroupLabel = ({\n  label,\n  count,\n  icon,\n  id,\n}: {\n  id: string;\n  label: ReactNode;\n  count: number;\n  icon?: ReactNode;\n}) => (\n  <div className={styles.groupLabelWrapper}>\n    {icon}\n    <div\n      className={styles.groupLabel}\n      data-testid={`group-label-${id}-${count}`}\n    >\n      {label}\n    </div>\n    <div className={styles.pageCount}>{`  ${count}`}</div>\n  </div>\n);\n\n// TODO(@JimmFly): optimize date matchers\nexport const useDateGroupDefinitions = <T extends ListItem>(\n  key: DateKey\n): ItemGroupDefinition<T>[] => {\n  const t = useI18n();\n  return useMemo(\n    () => [\n      {\n        id: 'today',\n        label: count => (\n          <GroupLabel\n            id=\"today\"\n            label={t['com.affine.today']()}\n            count={count}\n          />\n        ),\n        match: item =>\n          withinDaysAgo(new Date(item[key] ?? item.createDate ?? ''), 1),\n      },\n      {\n        id: 'yesterday',\n        label: count => (\n          <GroupLabel\n            id=\"yesterday\"\n            label={t['com.affine.yesterday']()}\n            count={count}\n          />\n        ),\n        match: item =>\n          betweenDaysAgo(new Date(item[key] ?? item.createDate ?? ''), 1, 2),\n      },\n      {\n        id: 'last7Days',\n        label: count => (\n          <GroupLabel\n            id=\"last7Days\"\n            label={t['com.affine.last7Days']()}\n            count={count}\n          />\n        ),\n        match: item =>\n          betweenDaysAgo(new Date(item[key] ?? item.createDate ?? ''), 2, 7),\n      },\n      {\n        id: 'last30Days',\n        label: count => (\n          <GroupLabel\n            id=\"last30Days\"\n            label={t['com.affine.last30Days']()}\n            count={count}\n          />\n        ),\n        match: item =>\n          betweenDaysAgo(new Date(item[key] ?? item.createDate ?? ''), 7, 30),\n      },\n      {\n        id: 'moreThan30Days',\n        label: count => (\n          <GroupLabel\n            id=\"moreThan30Days\"\n            label={t['com.affine.moreThan30Days']()}\n            count={count}\n          />\n        ),\n        match: item =>\n          !withinDaysAgo(new Date(item[key] ?? item.createDate ?? ''), 30),\n      },\n    ],\n    [key, t]\n  );\n};\n\nconst GroupTagLabel = ({ tag, count }: { tag: Tag; count: number }) => {\n  const tagValue = useLiveData(tag.value$);\n  const tagColor = useLiveData(tag.color$);\n  return (\n    <GroupLabel\n      id={tag.id}\n      label={tagValue}\n      count={count}\n      icon={\n        <div\n          className={styles.tagIcon}\n          style={{\n            backgroundColor: tagColor,\n          }}\n        ></div>\n      }\n    ></GroupLabel>\n  );\n};\nexport const useTagGroupDefinitions = (): ItemGroupDefinition<ListItem>[] => {\n  const tagList = useService(TagService).tagList;\n  const sortedTagsLiveData$ = useMemo(\n    () =>\n      LiveData.computed(get =>\n        get(tagList.tags$)\n          .slice()\n          .sort((a, b) => get(a.value$).localeCompare(get(b.value$)))\n      ),\n    [tagList.tags$]\n  );\n  const tags = useLiveData(sortedTagsLiveData$);\n\n  const t = useI18n();\n\n  const untagged = useMemo(\n    () => ({\n      id: 'Untagged',\n      label: (count: number) => (\n        <GroupLabel\n          id=\"Untagged\"\n          label={t['com.affine.page.display.grouping.group-by-tag.untagged']()}\n          count={count}\n        />\n      ),\n      match: (item: ListItem) =>\n        (item as DocMeta).tags ? !(item as DocMeta).tags.length : false,\n    }),\n    [t]\n  );\n\n  return useMemo(() => {\n    return tags\n      .map(tag => ({\n        id: tag.id,\n        label: (count: number) => {\n          return <GroupTagLabel tag={tag} count={count} />;\n        },\n        match: (item: ListItem) => (item as DocMeta).tags?.includes(tag.id),\n      }))\n      .concat(untagged);\n  }, [tags, untagged]);\n};\n\nexport const useFavoriteGroupDefinitions = <\n  T extends ListItem,\n>(): ItemGroupDefinition<T>[] => {\n  const t = useI18n();\n  const favAdapter = useService(CompatibleFavoriteItemsAdapter);\n  const favourites = useLiveData(favAdapter.favorites$);\n  return useMemo(\n    () => [\n      {\n        id: 'favourited',\n        label: count => (\n          <GroupLabel\n            id=\"favourited\"\n            label={t['com.affine.page.group-header.favourited']()}\n            count={count}\n            icon={<FavoritedIcon className={styles.favouritedIcon} />}\n          />\n        ),\n        match: item => favourites.some(fav => fav.id === item.id),\n      },\n      {\n        id: 'notFavourited',\n        label: count => (\n          <GroupLabel\n            id=\"notFavourited\"\n            label={t['com.affine.page.group-header.not-favourited']()}\n            count={count}\n            icon={<FavoriteIcon className={styles.notFavouritedIcon} />}\n          />\n        ),\n        match: item => !favourites.some(fav => fav.id === item.id),\n      },\n    ],\n    [t, favourites]\n  );\n};\n\nexport const usePageItemGroupDefinitions = () => {\n  const [workspaceProperties] = useAllDocDisplayProperties();\n  const tagGroupDefinitions = useTagGroupDefinitions();\n  const createDateGroupDefinitions = useDateGroupDefinitions('createDate');\n  const updatedDateGroupDefinitions = useDateGroupDefinitions('updatedDate');\n  const favouriteGroupDefinitions = useFavoriteGroupDefinitions();\n\n  return useMemo(() => {\n    const itemGroupDefinitions = {\n      createDate: createDateGroupDefinitions,\n      updatedDate: updatedDateGroupDefinitions,\n      tag: tagGroupDefinitions,\n      favourites: favouriteGroupDefinitions,\n      none: undefined,\n\n      // add more here later\n      // todo(@JimmFly): some page group definitions maybe dynamic\n    };\n    return itemGroupDefinitions[workspaceProperties.groupBy];\n  }, [\n    createDateGroupDefinitions,\n    favouriteGroupDefinitions,\n    tagGroupDefinitions,\n    updatedDateGroupDefinitions,\n    workspaceProperties.groupBy,\n  ]);\n};\n","import \"../core/src/components/page-list/group-definitions.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/page-list/group-definitions.css.ts.vanilla.css\\\",\\\"source\\\":\\\"LncyamlmZTAgewogIGRpc3BsYXk6IGZsZXg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBnYXA6IDRweDsKfQoudzJqaWZlMSB7CiAgd2lkdGg6IDhweDsKICBoZWlnaHQ6IDhweDsKICBib3JkZXItcmFkaXVzOiA1MCU7CiAgbWFyZ2luLWxlZnQ6IDRweDsKICBtYXJnaW4tcmlnaHQ6IDZweDsKfQoudzJqaWZlMiB7CiAgZm9udC1zaXplOiB2YXIoLS1hZmZpbmUtZm9udC1zbSk7CiAgbGluZS1oZWlnaHQ6IDEuNWVtOwogIGNvbG9yOiB2YXIoLS1hZmZpbmUtdGV4dC1wcmltYXJ5LWNvbG9yKTsKfQoudzJqaWZlMyB7CiAgZm9udC1zaXplOiB2YXIoLS1hZmZpbmUtZm9udC1iYXNlKTsKICBsaW5lLWhlaWdodDogMS42ZW07CiAgY29sb3I6IHZhcigtLWFmZmluZS10ZXh0LXNlY29uZGFyeS1jb2xvcik7CiAgbWFyZ2luLXJpZ2h0OiAxMnB4Owp9Ci53MmppZmU0IHsKICBjb2xvcjogdmFyKC0tYWZmaW5lLXByaW1hcnktY29sb3IpOwogIG1hcmdpbi1yaWdodDogNnB4OwogIGZvbnQtc2l6ZTogMTZweDsKfQoudzJqaWZlNSB7CiAgY29sb3I6IHZhcigtLWFmZmluZS1pY29uLWNvbG9yKTsKICBtYXJnaW4tcmlnaHQ6IDZweDsKICBmb250LXNpemU6IDE2cHg7Cn0=\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var favouritedIcon = 'w2jife4';\nexport var groupLabel = 'w2jife2';\nexport var groupLabelWrapper = 'w2jife0';\nexport var notFavouritedIcon = 'w2jife5';\nexport var pageCount = 'w2jife3';\nexport var tagIcon = 'w2jife1';","import { CompatibleFavoriteItemsAdapter } from '@affine/core/modules/properties';\nimport { ShareDocsService } from '@affine/core/modules/share-doc';\nimport type { Collection, Filter } from '@affine/env/filter';\nimport { PublicPageMode } from '@affine/graphql';\nimport type { DocMeta } from '@blocksuite/store';\nimport { useLiveData, useService } from '@toeverything/infra';\nimport { useCallback, useEffect, useMemo } from 'react';\n\nimport { filterPage, filterPageByRules } from './use-collection-manager';\n\nexport const useFilteredPageMetas = (\n  pageMetas: DocMeta[],\n  options: {\n    trash?: boolean;\n    filters?: Filter[];\n    collection?: Collection;\n  } = {}\n) => {\n  const shareDocsService = useService(ShareDocsService);\n  const shareDocs = useLiveData(shareDocsService.shareDocs?.list$);\n\n  const getPublicMode = useCallback(\n    (id: string) => {\n      const mode = shareDocs?.find(shareDoc => shareDoc.id === id)?.mode;\n      return mode\n        ? mode === PublicPageMode.Edgeless\n          ? ('edgeless' as const)\n          : ('page' as const)\n        : undefined;\n    },\n    [shareDocs]\n  );\n\n  useEffect(() => {\n    // TODO(@eyhn): loading & error UI\n    shareDocsService.shareDocs?.revalidate();\n  }, [shareDocsService]);\n\n  const favAdapter = useService(CompatibleFavoriteItemsAdapter);\n  const favoriteItems = useLiveData(favAdapter.favorites$);\n\n  const filteredPageMetas = useMemo(\n    () =>\n      pageMetas.filter(pageMeta => {\n        if (options.trash) {\n          if (!pageMeta.trash) {\n            return false;\n          }\n        } else if (pageMeta.trash) {\n          return false;\n        }\n        const pageData = {\n          meta: pageMeta,\n          favorite: favoriteItems.some(fav => fav.id === pageMeta.id),\n          publicMode: getPublicMode(pageMeta.id),\n        };\n        if (\n          options.filters &&\n          !filterPageByRules(options.filters, [], pageData)\n        ) {\n          return false;\n        }\n\n        if (options.collection && !filterPage(options.collection, pageData)) {\n          return false;\n        }\n\n        return true;\n      }),\n    [\n      pageMetas,\n      options.trash,\n      options.filters,\n      options.collection,\n      favoriteItems,\n      getPublicMode,\n    ]\n  );\n\n  return filteredPageMetas;\n};\n","import { toast } from '@affine/component';\nimport { useTrashModalHelper } from '@affine/core/hooks/affine/use-trash-modal-helper';\nimport { useBlockSuiteDocMeta } from '@affine/core/hooks/use-block-suite-page-meta';\nimport { CollectionService } from '@affine/core/modules/collection';\nimport type { Tag } from '@affine/core/modules/tag';\nimport type { Collection, Filter } from '@affine/env/filter';\nimport { Trans, useI18n } from '@affine/i18n';\nimport type { DocMeta } from '@blocksuite/store';\nimport { useService, WorkspaceService } from '@toeverything/infra';\nimport { useCallback, useMemo, useRef, useState } from 'react';\n\nimport { usePageHelper } from '../../blocksuite/block-suite-page-list/utils';\nimport { ListFloatingToolbar } from '../components/list-floating-toolbar';\nimport { usePageItemGroupDefinitions } from '../group-definitions';\nimport { usePageHeaderColsDef } from '../header-col-def';\nimport { PageOperationCell } from '../operation-cell';\nimport { PageListItemRenderer } from '../page-group';\nimport { ListTableHeader } from '../page-header';\nimport type { ItemListHandle, ListItem } from '../types';\nimport { useFilteredPageMetas } from '../use-filtered-page-metas';\nimport { VirtualizedList } from '../virtualized-list';\nimport {\n  CollectionPageListHeader,\n  PageListHeader,\n  TagPageListHeader,\n} from './page-list-header';\n\nconst usePageOperationsRenderer = () => {\n  const t = useI18n();\n  const collectionService = useService(CollectionService);\n  const removeFromAllowList = useCallback(\n    (id: string) => {\n      collectionService.deletePagesFromCollections([id]);\n      toast(t['com.affine.collection.removePage.success']());\n    },\n    [collectionService, t]\n  );\n  const pageOperationsRenderer = useCallback(\n    (page: DocMeta, isInAllowList?: boolean) => {\n      return (\n        <PageOperationCell\n          page={page}\n          isInAllowList={isInAllowList}\n          onRemoveFromAllowList={() => removeFromAllowList(page.id)}\n        />\n      );\n    },\n    [removeFromAllowList]\n  );\n  return pageOperationsRenderer;\n};\n\nexport const VirtualizedPageList = ({\n  tag,\n  collection,\n  filters,\n  listItem,\n  setHideHeaderCreateNewPage,\n}: {\n  tag?: Tag;\n  collection?: Collection;\n  filters?: Filter[];\n  listItem?: DocMeta[];\n  setHideHeaderCreateNewPage?: (hide: boolean) => void;\n}) => {\n  const listRef = useRef<ItemListHandle>(null);\n  const [showFloatingToolbar, setShowFloatingToolbar] = useState(false);\n  const [selectedPageIds, setSelectedPageIds] = useState<string[]>([]);\n  const currentWorkspace = useService(WorkspaceService).workspace;\n  const pageMetas = useBlockSuiteDocMeta(currentWorkspace.docCollection);\n  const pageOperations = usePageOperationsRenderer();\n  const { isPreferredEdgeless } = usePageHelper(currentWorkspace.docCollection);\n  const pageHeaderColsDef = usePageHeaderColsDef();\n\n  const filteredPageMetas = useFilteredPageMetas(pageMetas, {\n    filters,\n    collection,\n  });\n  const pageMetasToRender = useMemo(() => {\n    if (listItem) {\n      return listItem;\n    }\n    return filteredPageMetas;\n  }, [filteredPageMetas, listItem]);\n\n  const filteredSelectedPageIds = useMemo(() => {\n    const ids = pageMetasToRender.map(page => page.id);\n    return selectedPageIds.filter(id => ids.includes(id));\n  }, [pageMetasToRender, selectedPageIds]);\n\n  const hideFloatingToolbar = useCallback(() => {\n    listRef.current?.toggleSelectable();\n  }, []);\n\n  const pageOperationRenderer = useCallback(\n    (item: ListItem) => {\n      const page = item as DocMeta;\n      const isInAllowList = collection?.allowList?.includes(page.id);\n      return pageOperations(page, isInAllowList);\n    },\n    [collection, pageOperations]\n  );\n\n  const pageHeaderRenderer = useCallback(() => {\n    return <ListTableHeader headerCols={pageHeaderColsDef} />;\n  }, [pageHeaderColsDef]);\n\n  const pageItemRenderer = useCallback((item: ListItem) => {\n    return <PageListItemRenderer {...item} />;\n  }, []);\n\n  const heading = useMemo(() => {\n    if (tag) {\n      return <TagPageListHeader workspaceId={currentWorkspace.id} tag={tag} />;\n    }\n    if (collection) {\n      return (\n        <CollectionPageListHeader\n          workspaceId={currentWorkspace.id}\n          collection={collection}\n        />\n      );\n    }\n    return <PageListHeader />;\n  }, [collection, currentWorkspace.id, tag]);\n\n  const { setTrashModal } = useTrashModalHelper(currentWorkspace.docCollection);\n\n  const handleMultiDelete = useCallback(() => {\n    if (filteredSelectedPageIds.length === 0) {\n      return;\n    }\n    const pageNameMapping = Object.fromEntries(\n      pageMetas.map(meta => [meta.id, meta.title])\n    );\n\n    const pageNames = filteredSelectedPageIds.map(\n      id => pageNameMapping[id] ?? ''\n    );\n    setTrashModal({\n      open: true,\n      pageIds: filteredSelectedPageIds,\n      pageTitles: pageNames,\n    });\n    hideFloatingToolbar();\n  }, [filteredSelectedPageIds, hideFloatingToolbar, pageMetas, setTrashModal]);\n\n  const group = usePageItemGroupDefinitions();\n\n  return (\n    <>\n      <VirtualizedList\n        ref={listRef}\n        selectable=\"toggle\"\n        draggable\n        atTopThreshold={80}\n        atTopStateChange={setHideHeaderCreateNewPage}\n        onSelectionActiveChange={setShowFloatingToolbar}\n        heading={heading}\n        groupBy={group}\n        selectedIds={filteredSelectedPageIds}\n        onSelectedIdsChange={setSelectedPageIds}\n        items={pageMetasToRender}\n        rowAsLink\n        isPreferredEdgeless={isPreferredEdgeless}\n        docCollection={currentWorkspace.docCollection}\n        operationsRenderer={pageOperationRenderer}\n        itemRenderer={pageItemRenderer}\n        headerRenderer={pageHeaderRenderer}\n      />\n      <ListFloatingToolbar\n        open={showFloatingToolbar}\n        onDelete={handleMultiDelete}\n        onClose={hideFloatingToolbar}\n        content={\n          <Trans\n            i18nKey=\"com.affine.page.toolbar.selected\"\n            count={filteredSelectedPageIds.length}\n          >\n            <div style={{ color: 'var(--affine-text-secondary-color)' }}>\n              {{ count: filteredSelectedPageIds.length } as any}\n            </div>\n            selected\n          </Trans>\n        }\n      />\n    </>\n  );\n};\n","import { toast, useConfirmModal } from '@affine/component';\nimport { useBlockSuiteMetaHelper } from '@affine/core/hooks/affine/use-block-suite-meta-helper';\nimport { useBlockSuiteDocMeta } from '@affine/core/hooks/use-block-suite-page-meta';\nimport { Trans, useI18n } from '@affine/i18n';\nimport type { DocMeta } from '@blocksuite/store';\nimport { useService, WorkspaceService } from '@toeverything/infra';\nimport { useCallback, useMemo, useRef, useState } from 'react';\n\nimport { usePageHelper } from '../blocksuite/block-suite-page-list/utils';\nimport { ListFloatingToolbar } from './components/list-floating-toolbar';\nimport { usePageHeaderColsDef } from './header-col-def';\nimport { TrashOperationCell } from './operation-cell';\nimport { PageListItemRenderer } from './page-group';\nimport { ListTableHeader } from './page-header';\nimport type { ItemListHandle, ListItem } from './types';\nimport { useFilteredPageMetas } from './use-filtered-page-metas';\nimport { VirtualizedList } from './virtualized-list';\n\nexport const VirtualizedTrashList = () => {\n  const currentWorkspace = useService(WorkspaceService).workspace;\n  const docCollection = currentWorkspace.docCollection;\n  const { restoreFromTrash, permanentlyDeletePage } =\n    useBlockSuiteMetaHelper(docCollection);\n  const pageMetas = useBlockSuiteDocMeta(docCollection);\n  const filteredPageMetas = useFilteredPageMetas(pageMetas, {\n    trash: true,\n  });\n\n  const { isPreferredEdgeless } = usePageHelper(docCollection);\n\n  const listRef = useRef<ItemListHandle>(null);\n  const [showFloatingToolbar, setShowFloatingToolbar] = useState(false);\n  const [selectedPageIds, setSelectedPageIds] = useState<string[]>([]);\n\n  const { openConfirmModal } = useConfirmModal();\n  const t = useI18n();\n  const pageHeaderColsDef = usePageHeaderColsDef();\n\n  const filteredSelectedPageIds = useMemo(() => {\n    const ids = filteredPageMetas.map(page => page.id);\n    return selectedPageIds.filter(id => ids.includes(id));\n  }, [filteredPageMetas, selectedPageIds]);\n\n  const hideFloatingToolbar = useCallback(() => {\n    listRef.current?.toggleSelectable();\n  }, []);\n\n  const handleMultiDelete = useCallback(() => {\n    filteredSelectedPageIds.forEach(pageId => {\n      permanentlyDeletePage(pageId);\n    });\n    hideFloatingToolbar();\n    toast(t['com.affine.toastMessage.permanentlyDeleted']());\n  }, [filteredSelectedPageIds, hideFloatingToolbar, permanentlyDeletePage, t]);\n\n  const handleMultiRestore = useCallback(() => {\n    filteredSelectedPageIds.forEach(pageId => {\n      restoreFromTrash(pageId);\n    });\n    hideFloatingToolbar();\n    toast(\n      t['com.affine.toastMessage.restored']({\n        title: filteredSelectedPageIds.length > 1 ? 'docs' : 'doc',\n      })\n    );\n  }, [filteredSelectedPageIds, hideFloatingToolbar, restoreFromTrash, t]);\n\n  const onConfirmPermanentlyDelete = useCallback(() => {\n    if (filteredSelectedPageIds.length === 0) {\n      return;\n    }\n    openConfirmModal({\n      title: `${t['com.affine.trashOperation.deletePermanently']()}?`,\n      description: t['com.affine.trashOperation.deleteDescription'](),\n      cancelText: t['Cancel'](),\n      confirmText: t['com.affine.trashOperation.delete'](),\n      confirmButtonOptions: {\n        variant: 'error',\n      },\n      onConfirm: handleMultiDelete,\n    });\n  }, [filteredSelectedPageIds.length, handleMultiDelete, openConfirmModal, t]);\n\n  const pageOperationsRenderer = useCallback(\n    (item: ListItem) => {\n      const page = item as DocMeta;\n      const onRestorePage = () => {\n        restoreFromTrash(page.id);\n        toast(\n          t['com.affine.toastMessage.restored']({\n            title: page.title || 'Untitled',\n          })\n        );\n      };\n      const onPermanentlyDeletePage = () => {\n        permanentlyDeletePage(page.id);\n        toast(t['com.affine.toastMessage.permanentlyDeleted']());\n      };\n\n      return (\n        <TrashOperationCell\n          onPermanentlyDeletePage={onPermanentlyDeletePage}\n          onRestorePage={onRestorePage}\n        />\n      );\n    },\n\n    [permanentlyDeletePage, restoreFromTrash, t]\n  );\n  const pageItemRenderer = useCallback((item: ListItem) => {\n    return <PageListItemRenderer {...item} />;\n  }, []);\n  const pageHeaderRenderer = useCallback(() => {\n    return <ListTableHeader headerCols={pageHeaderColsDef} />;\n  }, [pageHeaderColsDef]);\n\n  return (\n    <>\n      <VirtualizedList\n        ref={listRef}\n        selectable=\"toggle\"\n        items={filteredPageMetas}\n        rowAsLink\n        isPreferredEdgeless={isPreferredEdgeless}\n        onSelectionActiveChange={setShowFloatingToolbar}\n        docCollection={currentWorkspace.docCollection}\n        operationsRenderer={pageOperationsRenderer}\n        itemRenderer={pageItemRenderer}\n        headerRenderer={pageHeaderRenderer}\n        selectedIds={filteredSelectedPageIds}\n        onSelectedIdsChange={setSelectedPageIds}\n      />\n      <ListFloatingToolbar\n        open={showFloatingToolbar}\n        onDelete={onConfirmPermanentlyDelete}\n        onClose={hideFloatingToolbar}\n        onRestore={handleMultiRestore}\n        content={\n          <Trans\n            i18nKey=\"com.affine.page.toolbar.selected\"\n            count={filteredSelectedPageIds.length}\n          >\n            <div style={{ color: 'var(--affine-text-secondary-color)' }}>\n              {{ count: filteredSelectedPageIds.length } as any}\n            </div>\n            selected\n          </Trans>\n        }\n      />\n    </>\n  );\n};\n","import { Scrollable, useHasScrollTop } from '@affine/component';\nimport clsx from 'clsx';\nimport type { ForwardedRef, PropsWithChildren } from 'react';\nimport {\n  forwardRef,\n  memo,\n  useCallback,\n  useEffect,\n  useImperativeHandle,\n} from 'react';\n\nimport { usePageHeaderColsDef } from './header-col-def';\nimport * as styles from './list.css';\nimport { ItemGroup } from './page-group';\nimport { ListTableHeader } from './page-header';\nimport {\n  groupsAtom,\n  listPropsAtom,\n  ListProvider,\n  selectionStateAtom,\n  useAtom,\n  useAtomValue,\n  useSetAtom,\n} from './scoped-atoms';\nimport type { ItemListHandle, ListItem, ListProps } from './types';\n\n/**\n * Given a list of pages, render a list of pages\n */\nexport const List = forwardRef<ItemListHandle, ListProps<ListItem>>(\n  function List(props, ref) {\n    return (\n      // push pageListProps to the atom so that downstream components can consume it\n      // this makes sure pageListPropsAtom is always populated\n      <ListProvider initialValues={[[listPropsAtom, props]]}>\n        <ListInnerWrapper {...props} handleRef={ref}>\n          <ListInner {...props} />\n        </ListInnerWrapper>\n      </ListProvider>\n    );\n  }\n);\n\n// when pressing ESC or double clicking outside of the page list, close the selection mode\n// TODO(@Peng): use jotai-effect instead but it seems it does not work with jotai-scope?\nconst useItemSelectionStateEffect = () => {\n  const [selectionState, setSelectionActive] = useAtom(selectionStateAtom);\n  useEffect(() => {\n    if (\n      selectionState.selectionActive &&\n      selectionState.selectable === 'toggle'\n    ) {\n      const startTime = Date.now();\n      const dblClickHandler = (e: MouseEvent) => {\n        if (Date.now() - startTime < 200) {\n          return;\n        }\n        const target = e.target as HTMLElement;\n        // skip if event target is inside of a button or input\n        // or within a toolbar (like page list floating toolbar)\n        if (\n          target.tagName === 'BUTTON' ||\n          target.tagName === 'INPUT' ||\n          (e.target as HTMLElement).closest('button, input, [role=\"toolbar\"]')\n        ) {\n          return;\n        }\n        setSelectionActive(false);\n        selectionState.onSelectedIdsChange?.([]);\n      };\n\n      const escHandler = (e: KeyboardEvent) => {\n        if (Date.now() - startTime < 200) {\n          return;\n        }\n        if (e.key === 'Escape') {\n          setSelectionActive(false);\n          selectionState.onSelectedIdsChange?.([]);\n        }\n      };\n\n      document.addEventListener('dblclick', dblClickHandler);\n      document.addEventListener('keydown', escHandler);\n\n      return () => {\n        document.removeEventListener('dblclick', dblClickHandler);\n        document.removeEventListener('keydown', escHandler);\n      };\n    }\n    return;\n  }, [\n    selectionState,\n    selectionState.selectable,\n    selectionState.selectionActive,\n    setSelectionActive,\n  ]);\n};\n\nexport const ListInnerWrapper = memo(\n  ({\n    handleRef,\n    children,\n    onSelectionActiveChange,\n    ...props\n  }: PropsWithChildren<\n    ListProps<ListItem> & { handleRef: ForwardedRef<ItemListHandle> }\n  >) => {\n    const setListPropsAtom = useSetAtom(listPropsAtom);\n    const [selectionState, setListSelectionState] = useAtom(selectionStateAtom);\n    useItemSelectionStateEffect();\n\n    useEffect(() => {\n      setListPropsAtom(props);\n    }, [props, setListPropsAtom]);\n\n    useEffect(() => {\n      onSelectionActiveChange?.(!!selectionState.selectionActive);\n    }, [onSelectionActiveChange, selectionState.selectionActive]);\n\n    useImperativeHandle(handleRef, () => {\n      return {\n        toggleSelectable: () => {\n          setListSelectionState(false);\n        },\n      };\n    }, [setListSelectionState]);\n    return children;\n  }\n);\n\nListInnerWrapper.displayName = 'ListInnerWrapper';\n\nconst ListInner = (props: ListProps<ListItem>) => {\n  const groups = useAtomValue(groupsAtom);\n  const pageHeaderColsDef = usePageHeaderColsDef();\n  const hideHeader = props.hideHeader;\n  return (\n    <div className={clsx(props.className, styles.root)}>\n      {!hideHeader ? <ListTableHeader headerCols={pageHeaderColsDef} /> : null}\n      <div className={styles.groupsContainer}>\n        {groups.map(group => (\n          <ItemGroup key={group.id} {...group} />\n        ))}\n      </div>\n    </div>\n  );\n};\n\ninterface ListScrollContainerProps {\n  className?: string;\n  style?: React.CSSProperties;\n}\n\nexport const ListScrollContainer = forwardRef<\n  HTMLDivElement,\n  PropsWithChildren<ListScrollContainerProps>\n>(({ className, children, style }, ref) => {\n  const [setContainer, hasScrollTop] = useHasScrollTop();\n\n  const setNodeRef = useCallback(\n    (r: HTMLDivElement) => {\n      if (ref) {\n        if (typeof ref === 'function') {\n          ref(r);\n        } else {\n          ref.current = r;\n        }\n      }\n      return setContainer(r);\n    },\n    [ref, setContainer]\n  );\n\n  return (\n    <Scrollable.Root\n      style={style}\n      data-has-scroll-top={hasScrollTop}\n      className={clsx(styles.pageListScrollContainer, className)}\n    >\n      <Scrollable.Viewport ref={setNodeRef}>{children}</Scrollable.Viewport>\n      <Scrollable.Scrollbar />\n    </Scrollable.Root>\n  );\n});\n\nListScrollContainer.displayName = 'ListScrollContainer';\n","import {\n  IconButton,\n  Menu,\n  MenuIcon,\n  MenuItem,\n  toast,\n  useConfirmModal,\n} from '@affine/component';\nimport { useAppSettingHelper } from '@affine/core/hooks/affine/use-app-setting-helper';\nimport { useBlockSuiteMetaHelper } from '@affine/core/hooks/affine/use-block-suite-meta-helper';\nimport { useTrashModalHelper } from '@affine/core/hooks/affine/use-trash-modal-helper';\nimport { useCatchEventCallback } from '@affine/core/hooks/use-catch-event-hook';\nimport { track } from '@affine/core/mixpanel';\nimport { FavoriteService } from '@affine/core/modules/favorite';\nimport { CompatibleFavoriteItemsAdapter } from '@affine/core/modules/properties';\nimport { WorkbenchService } from '@affine/core/modules/workbench';\nimport type { Collection, DeleteCollectionInfo } from '@affine/env/filter';\nimport { useI18n } from '@affine/i18n';\nimport {\n  DeleteIcon,\n  DeletePermanentlyIcon,\n  DuplicateIcon,\n  EditIcon,\n  FavoritedIcon,\n  FavoriteIcon,\n  FilterIcon,\n  FilterMinusIcon,\n  InformationIcon,\n  MoreVerticalIcon,\n  OpenInNewIcon,\n  PlusIcon,\n  ResetIcon,\n  SplitViewIcon,\n} from '@blocksuite/icons/rc';\nimport type { DocMeta } from '@blocksuite/store';\nimport {\n  useLiveData,\n  useService,\n  useServices,\n  WorkspaceService,\n} from '@toeverything/infra';\nimport { useCallback, useState } from 'react';\n\nimport type { CollectionService } from '../../modules/collection';\nimport { InfoModal } from '../affine/page-properties';\nimport { usePageHelper } from '../blocksuite/block-suite-page-list/utils';\nimport { FavoriteTag } from './components/favorite-tag';\nimport * as styles from './list.css';\nimport { DisablePublicSharing, MoveToTrash } from './operation-menu-items';\nimport { CreateOrEditTag } from './tags/create-tag';\nimport type { TagMeta } from './types';\nimport { ColWrapper } from './utils';\nimport { useEditCollection, useEditCollectionName } from './view';\n\nconst tooltipSideTop = { side: 'top' as const };\nconst tooltipSideTopAlignEnd = { side: 'top' as const, align: 'end' as const };\n\nexport interface PageOperationCellProps {\n  page: DocMeta;\n  isInAllowList?: boolean;\n  onRemoveFromAllowList?: () => void;\n}\n\nexport const PageOperationCell = ({\n  isInAllowList,\n  page,\n  onRemoveFromAllowList,\n}: PageOperationCellProps) => {\n  const t = useI18n();\n  const currentWorkspace = useService(WorkspaceService).workspace;\n  const { appSettings } = useAppSettingHelper();\n  const { setTrashModal } = useTrashModalHelper(currentWorkspace.docCollection);\n  const [openDisableShared, setOpenDisableShared] = useState(false);\n  const favAdapter = useService(CompatibleFavoriteItemsAdapter);\n  const favourite = useLiveData(favAdapter.isFavorite$(page.id, 'doc'));\n  const workbench = useService(WorkbenchService).workbench;\n  const { duplicate } = useBlockSuiteMetaHelper(currentWorkspace.docCollection);\n  const blocksuiteDoc = currentWorkspace.docCollection.getDoc(page.id);\n\n  const [openInfoModal, setOpenInfoModal] = useState(false);\n  const onOpenInfoModal = useCallback(() => {\n    track.$.docInfoPanel.$.open();\n    setOpenInfoModal(true);\n  }, []);\n\n  const onDisablePublicSharing = useCallback(() => {\n    toast('Successfully disabled', {\n      portal: document.body,\n    });\n  }, []);\n\n  const onRemoveToTrash = useCallback(() => {\n    track.allDocs.list.docMenu.deleteDoc();\n\n    setTrashModal({\n      open: true,\n      pageIds: [page.id],\n      pageTitles: [page.title],\n    });\n  }, [page.id, page.title, setTrashModal]);\n\n  const onOpenInSplitView = useCallback(() => {\n    track.allDocs.list.docMenu.openInSplitView();\n\n    workbench.openDoc(page.id, { at: 'tail' });\n  }, [page.id, workbench]);\n\n  const onOpenInNewTab = useCallback(() => {\n    workbench.openDoc(page.id, { at: 'new-tab' });\n  }, [page.id, workbench]);\n\n  const onToggleFavoritePage = useCallback(() => {\n    const status = favAdapter.isFavorite(page.id, 'doc');\n    favAdapter.toggle(page.id, 'doc');\n    toast(\n      status\n        ? t['com.affine.toastMessage.removedFavorites']()\n        : t['com.affine.toastMessage.addedFavorites']()\n    );\n  }, [page.id, favAdapter, t]);\n\n  const onToggleFavoritePageOption = useCallback(() => {\n    track.allDocs.list.docMenu.toggleFavorite();\n\n    onToggleFavoritePage();\n  }, [onToggleFavoritePage]);\n\n  const onDuplicate = useCallback(() => {\n    duplicate(page.id, false);\n    track.allDocs.list.docMenu.createDoc({\n      control: 'duplicate',\n    });\n  }, [duplicate, page.id]);\n\n  const handleRemoveFromAllowList = useCallback(() => {\n    if (onRemoveFromAllowList) {\n      onRemoveFromAllowList();\n      track.collection.docList.docMenu.removeOrganizeItem({ type: 'doc' });\n    }\n  }, [onRemoveFromAllowList]);\n\n  const OperationMenu = (\n    <>\n      {page.isPublic && (\n        <DisablePublicSharing\n          data-testid=\"disable-public-sharing\"\n          onSelect={() => {\n            setOpenDisableShared(true);\n          }}\n        />\n      )}\n      {isInAllowList && (\n        <MenuItem\n          onClick={handleRemoveFromAllowList}\n          preFix={\n            <MenuIcon>\n              <FilterMinusIcon />\n            </MenuIcon>\n          }\n        >\n          {t['Remove special filter']()}\n        </MenuItem>\n      )}\n      <MenuItem\n        onClick={onToggleFavoritePageOption}\n        preFix={\n          <MenuIcon>\n            {favourite ? (\n              <FavoritedIcon style={{ color: 'var(--affine-primary-color)' }} />\n            ) : (\n              <FavoriteIcon />\n            )}\n          </MenuIcon>\n        }\n      >\n        {favourite\n          ? t['com.affine.favoritePageOperation.remove']()\n          : t['com.affine.favoritePageOperation.add']()}\n      </MenuItem>\n      {runtimeConfig.enableInfoModal ? (\n        <MenuItem\n          onClick={onOpenInfoModal}\n          preFix={\n            <MenuIcon>\n              <InformationIcon />\n            </MenuIcon>\n          }\n        >\n          {t['com.affine.page-properties.page-info.view']()}\n        </MenuItem>\n      ) : null}\n\n      <MenuItem\n        onClick={onOpenInNewTab}\n        preFix={\n          <MenuIcon>\n            <OpenInNewIcon />\n          </MenuIcon>\n        }\n      >\n        {t['com.affine.workbench.tab.page-menu-open']()}\n      </MenuItem>\n\n      {environment.isDesktop && appSettings.enableMultiView ? (\n        <MenuItem\n          onClick={onOpenInSplitView}\n          preFix={\n            <MenuIcon>\n              <SplitViewIcon />\n            </MenuIcon>\n          }\n        >\n          {t['com.affine.workbench.split-view.page-menu-open']()}\n        </MenuItem>\n      ) : null}\n\n      <MenuItem\n        preFix={\n          <MenuIcon>\n            <DuplicateIcon />\n          </MenuIcon>\n        }\n        onSelect={onDuplicate}\n      >\n        {t['com.affine.header.option.duplicate']()}\n      </MenuItem>\n\n      <MoveToTrash data-testid=\"move-to-trash\" onSelect={onRemoveToTrash} />\n    </>\n  );\n  return (\n    <>\n      <ColWrapper\n        hideInSmallContainer\n        data-testid=\"page-list-item-favorite\"\n        data-favorite={favourite ? true : undefined}\n        className={styles.favoriteCell}\n      >\n        <FavoriteTag onClick={onToggleFavoritePage} active={favourite} />\n      </ColWrapper>\n      <ColWrapper alignment=\"start\">\n        <Menu\n          items={OperationMenu}\n          contentOptions={{\n            align: 'end',\n          }}\n        >\n          <IconButton data-testid=\"page-list-operation-button\" size=\"20\">\n            <MoreVerticalIcon />\n          </IconButton>\n        </Menu>\n      </ColWrapper>\n      {blocksuiteDoc ? (\n        <InfoModal\n          open={openInfoModal}\n          onOpenChange={setOpenInfoModal}\n          docId={blocksuiteDoc.id}\n        />\n      ) : null}\n      <DisablePublicSharing.DisablePublicSharingModal\n        onConfirm={onDisablePublicSharing}\n        open={openDisableShared}\n        onOpenChange={setOpenDisableShared}\n      />\n    </>\n  );\n};\n\nexport interface TrashOperationCellProps {\n  onPermanentlyDeletePage: () => void;\n  onRestorePage: () => void;\n}\n\nexport const TrashOperationCell = ({\n  onPermanentlyDeletePage,\n  onRestorePage,\n}: TrashOperationCellProps) => {\n  const t = useI18n();\n  const { openConfirmModal } = useConfirmModal();\n\n  const onConfirmPermanentlyDelete = useCatchEventCallback(\n    e => {\n      e.preventDefault();\n      openConfirmModal({\n        title: `${t['com.affine.trashOperation.deletePermanently']()}?`,\n        description: t['com.affine.trashOperation.deleteDescription'](),\n        cancelText: t['Cancel'](),\n        confirmText: t['com.affine.trashOperation.delete'](),\n        confirmButtonOptions: {\n          variant: 'error',\n        },\n        onConfirm: onPermanentlyDeletePage,\n      });\n    },\n    [onPermanentlyDeletePage, openConfirmModal, t]\n  );\n\n  const handleRestorePage = useCatchEventCallback(\n    e => {\n      e.preventDefault();\n      onRestorePage();\n    },\n    [onRestorePage]\n  );\n\n  return (\n    <ColWrapper flex={1}>\n      <IconButton\n        tooltip={t['com.affine.trashOperation.restoreIt']()}\n        tooltipOptions={tooltipSideTop}\n        data-testid=\"restore-page-button\"\n        style={{ marginRight: '12px' }}\n        onClick={handleRestorePage}\n        size=\"20\"\n      >\n        <ResetIcon />\n      </IconButton>\n      <IconButton\n        tooltip={t['com.affine.trashOperation.deletePermanently']()}\n        tooltipOptions={tooltipSideTopAlignEnd}\n        data-testid=\"delete-page-button\"\n        onClick={onConfirmPermanentlyDelete}\n        className={styles.deleteButton}\n        iconClassName={styles.deleteIcon}\n        size=\"20\"\n      >\n        <DeletePermanentlyIcon />\n      </IconButton>\n    </ColWrapper>\n  );\n};\n\nexport interface CollectionOperationCellProps {\n  collection: Collection;\n  info: DeleteCollectionInfo;\n  service: CollectionService;\n}\n\nexport const CollectionOperationCell = ({\n  collection,\n  service,\n  info,\n}: CollectionOperationCellProps) => {\n  const t = useI18n();\n\n  const favAdapter = useService(CompatibleFavoriteItemsAdapter);\n  const docCollection = useService(WorkspaceService).workspace.docCollection;\n  const { createPage } = usePageHelper(docCollection);\n  const { openConfirmModal } = useConfirmModal();\n  const favourite = useLiveData(\n    favAdapter.isFavorite$(collection.id, 'collection')\n  );\n\n  const { open: openEditCollectionModal, node: editModal } =\n    useEditCollection();\n\n  const { open: openEditCollectionNameModal, node: editNameModal } =\n    useEditCollectionName({\n      title: t['com.affine.editCollection.renameCollection'](),\n    });\n\n  const handleEditName = useCallback(() => {\n    // use openRenameModal if it is in the sidebar collection list\n    openEditCollectionNameModal(collection.name)\n      .then(name => {\n        return service.updateCollection(collection.id, collection => ({\n          ...collection,\n          name,\n        }));\n      })\n      .catch(err => {\n        console.error(err);\n      });\n  }, [collection.id, collection.name, openEditCollectionNameModal, service]);\n\n  const handleEdit = useCallback(() => {\n    openEditCollectionModal(collection)\n      .then(collection => {\n        return service.updateCollection(collection.id, () => collection);\n      })\n      .catch(err => {\n        console.error(err);\n      });\n  }, [openEditCollectionModal, collection, service]);\n\n  const handleDelete = useCallback(() => {\n    return service.deleteCollection(info, collection.id);\n  }, [service, info, collection]);\n\n  const onToggleFavoriteCollection = useCallback(() => {\n    const status = favAdapter.isFavorite(collection.id, 'collection');\n    favAdapter.toggle(collection.id, 'collection');\n    toast(\n      status\n        ? t['com.affine.toastMessage.removedFavorites']()\n        : t['com.affine.toastMessage.addedFavorites']()\n    );\n  }, [favAdapter, collection.id, t]);\n\n  const createAndAddDocument = useCallback(() => {\n    const newDoc = createPage();\n    service.addPageToCollection(collection.id, newDoc.id);\n  }, [collection.id, createPage, service]);\n\n  const onConfirmAddDocToCollection = useCallback(() => {\n    openConfirmModal({\n      title: t['com.affine.collection.add-doc.confirm.title'](),\n      description: t['com.affine.collection.add-doc.confirm.description'](),\n      cancelText: t['Cancel'](),\n      confirmText: t['Confirm'](),\n      confirmButtonOptions: {\n        variant: 'primary',\n      },\n      onConfirm: createAndAddDocument,\n    });\n  }, [createAndAddDocument, openConfirmModal, t]);\n\n  return (\n    <>\n      {editModal}\n      {editNameModal}\n      <ColWrapper\n        hideInSmallContainer\n        data-testid=\"page-list-item-favorite\"\n        data-favorite={favourite ? true : undefined}\n        className={styles.favoriteCell}\n      >\n        <FavoriteTag onClick={onToggleFavoriteCollection} active={favourite} />\n      </ColWrapper>\n      <IconButton\n        onClick={handleEditName}\n        tooltip={t['com.affine.collection.menu.rename']()}\n        tooltipOptions={tooltipSideTop}\n      >\n        <EditIcon />\n      </IconButton>\n      <IconButton\n        onClick={handleEdit}\n        tooltip={t['com.affine.collection.menu.edit']()}\n        tooltipOptions={tooltipSideTop}\n      >\n        <FilterIcon />\n      </IconButton>\n      <ColWrapper alignment=\"start\">\n        <Menu\n          items={\n            <>\n              <MenuItem\n                onClick={onToggleFavoriteCollection}\n                preFix={\n                  <MenuIcon>\n                    {favourite ? (\n                      <FavoritedIcon\n                        style={{ color: 'var(--affine-primary-color)' }}\n                      />\n                    ) : (\n                      <FavoriteIcon />\n                    )}\n                  </MenuIcon>\n                }\n              >\n                {favourite\n                  ? t['com.affine.favoritePageOperation.remove']()\n                  : t['com.affine.favoritePageOperation.add']()}\n              </MenuItem>\n              <MenuItem\n                onClick={onConfirmAddDocToCollection}\n                preFix={\n                  <MenuIcon>\n                    <PlusIcon />\n                  </MenuIcon>\n                }\n              >\n                {t['New Page']()}\n              </MenuItem>\n              <MenuItem\n                onClick={handleDelete}\n                preFix={\n                  <MenuIcon>\n                    <DeleteIcon />\n                  </MenuIcon>\n                }\n                type=\"danger\"\n                data-testid=\"delete-collection\"\n              >\n                {t['Delete']()}\n              </MenuItem>\n            </>\n          }\n          contentOptions={{\n            align: 'end',\n          }}\n        >\n          <IconButton data-testid=\"collection-item-operation-button\">\n            <MoreVerticalIcon />\n          </IconButton>\n        </Menu>\n      </ColWrapper>\n    </>\n  );\n};\n\ninterface TagOperationCellProps {\n  tag: TagMeta;\n  onTagDelete: (tagId: string[]) => void;\n}\n\nexport const TagOperationCell = ({\n  tag,\n  onTagDelete,\n}: TagOperationCellProps) => {\n  const t = useI18n();\n  const [open, setOpen] = useState(false);\n  const { favoriteService } = useServices({\n    FavoriteService,\n  });\n  const favourite = useLiveData(\n    favoriteService.favoriteList.isFavorite$('tag', tag.id)\n  );\n\n  const handleDelete = useCallback(() => {\n    onTagDelete([tag.id]);\n  }, [onTagDelete, tag.id]);\n\n  const onToggleFavoriteCollection = useCallback(() => {\n    favoriteService.favoriteList.toggle('tag', tag.id);\n  }, [favoriteService, tag.id]);\n  return (\n    <>\n      <ColWrapper\n        hideInSmallContainer\n        data-testid=\"page-list-item-favorite\"\n        data-favorite={favourite ? true : undefined}\n        className={styles.favoriteCell}\n      >\n        <FavoriteTag onClick={onToggleFavoriteCollection} active={favourite} />\n      </ColWrapper>\n\n      <div className={styles.editTagWrapper} data-show={open}>\n        <div style={{ width: '100%' }}>\n          <CreateOrEditTag open={open} onOpenChange={setOpen} tagMeta={tag} />\n        </div>\n      </div>\n\n      <IconButton\n        tooltip={t['Rename']()}\n        tooltipOptions={tooltipSideTop}\n        onClick={() => setOpen(true)}\n      >\n        <EditIcon />\n      </IconButton>\n\n      <ColWrapper alignment=\"start\">\n        <Menu\n          items={\n            <MenuItem\n              preFix={\n                <MenuIcon>\n                  <DeleteIcon />\n                </MenuIcon>\n              }\n              type=\"danger\"\n              onSelect={handleDelete}\n              data-testid=\"delete-tag\"\n            >\n              {t['Delete']()}\n            </MenuItem>\n          }\n          contentOptions={{\n            align: 'end',\n          }}\n        >\n          <IconButton data-testid=\"tag-item-operation-button\">\n            <MoreVerticalIcon />\n          </IconButton>\n        </Menu>\n      </ColWrapper>\n    </>\n  );\n};\n","import type { MenuItemProps } from '@affine/component';\nimport { MenuIcon, MenuItem } from '@affine/component';\nimport { PublicLinkDisableModal } from '@affine/component/disable-public-link';\nimport { useI18n } from '@affine/i18n';\nimport { ShareIcon } from '@blocksuite/icons/rc';\n\nexport const DisablePublicSharing = (props: MenuItemProps) => {\n  const t = useI18n();\n  return (\n    <MenuItem\n      type=\"danger\"\n      preFix={\n        <MenuIcon>\n          <ShareIcon />\n        </MenuIcon>\n      }\n      {...props}\n    >\n      {t['Disable Public Sharing']()}\n    </MenuItem>\n  );\n};\n\nDisablePublicSharing.DisablePublicSharingModal = PublicLinkDisableModal;\n","import \"../core/src/components/page-list/operation-menu-items/index.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/page-list/operation-menu-items/index.css.ts.vanilla.css\\\",\\\"source\\\":\\\"LnF1amJ0eTAgewogIHBhZGRpbmc6IDRweCAxMnB4Owp9Ci5xdWpidHkwOmhvdmVyIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1hZmZpbmUtYmFja2dyb3VuZC1lcnJvci1jb2xvcik7CiAgY29sb3I6IHZhcigtLWFmZmluZS1lcnJvci1jb2xvcik7Cn0KLnF1amJ0eTA6aG92ZXIgc3ZnIHsKICBjb2xvcjogdmFyKC0tYWZmaW5lLWVycm9yLWNvbG9yKTsKfQoucXVqYnR5MSB7CiAgdHJhbnNpdGlvbjogYWxsIDAuM3M7Cn0=\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var moveToTrashStyle = 'qujbty0';\nexport var transitionStyle = 'qujbty1';","import { MenuIcon, MenuItem, MenuSub } from '@affine/component';\nimport { track } from '@affine/core/mixpanel';\nimport { useI18n } from '@affine/i18n';\nimport {\n  ExportIcon,\n  ExportToHtmlIcon,\n  ExportToMarkdownIcon,\n  ExportToPdfIcon,\n  ExportToPngIcon,\n} from '@blocksuite/icons/rc';\nimport type { ReactNode } from 'react';\nimport { useCallback, useMemo } from 'react';\n\nimport { transitionStyle } from './index.css';\n\ninterface ExportMenuItemProps<T> {\n  onSelect: () => void;\n  className?: string;\n  type: T;\n  icon: ReactNode;\n  label: string;\n}\n\ninterface ExportProps {\n  exportHandler: (type: 'pdf' | 'html' | 'png' | 'markdown') => Promise<void>;\n  pageMode?: 'page' | 'edgeless';\n  className?: string;\n}\n\nexport function ExportMenuItem<T>({\n  onSelect,\n  className,\n  type,\n  icon,\n  label,\n}: ExportMenuItemProps<T>) {\n  return (\n    <MenuItem\n      className={className}\n      data-testid={`export-to-${type}`}\n      onSelect={onSelect}\n      block\n      preFix={<MenuIcon>{icon}</MenuIcon>}\n    >\n      {label}\n    </MenuItem>\n  );\n}\n\nexport const ExportMenuItems = ({\n  exportHandler,\n  className = transitionStyle,\n  pageMode = 'page',\n}: ExportProps) => {\n  const t = useI18n();\n  const itemMap = useMemo(\n    () => [\n      {\n        component: ExportMenuItem,\n        props: {\n          onSelect: () => exportHandler('pdf'),\n          className: className,\n          type: 'pdf',\n          icon: <ExportToPdfIcon />,\n          label: t['Export to PDF'](),\n        },\n      },\n      {\n        component: ExportMenuItem,\n        props: {\n          onSelect: () => exportHandler('html'),\n          className: className,\n          type: 'html',\n          icon: <ExportToHtmlIcon />,\n          label: t['Export to HTML'](),\n        },\n      },\n      {\n        component: ExportMenuItem,\n        props: {\n          onSelect: () => exportHandler('png'),\n          className: className,\n          type: 'png',\n          icon: <ExportToPngIcon />,\n          label: t['Export to PNG'](),\n        },\n      },\n      {\n        component: ExportMenuItem,\n        props: {\n          onSelect: () => exportHandler('markdown'),\n          className: className,\n          type: 'markdown',\n          icon: <ExportToMarkdownIcon />,\n          label: t['Export to Markdown'](),\n        },\n      },\n    ],\n    [className, exportHandler, t]\n  );\n  const items = itemMap.map(({ component: Component, props }) =>\n    pageMode === 'edgeless' &&\n    (props.type === 'pdf' || props.type === 'png') ? null : (\n      <Component key={props.label} {...props} />\n    )\n  );\n  return items;\n};\n\nexport const Export = ({ exportHandler, className, pageMode }: ExportProps) => {\n  const t = useI18n();\n  const items = (\n    <ExportMenuItems\n      exportHandler={exportHandler}\n      className={className}\n      pageMode={pageMode}\n    />\n  );\n  const handleExportMenuOpenChange = useCallback((open: boolean) => {\n    if (open) {\n      track.$.header.docOptions.export();\n    }\n  }, []);\n\n  return (\n    <MenuSub\n      items={items}\n      triggerOptions={{\n        className: transitionStyle,\n        preFix: (\n          <MenuIcon>\n            <ExportIcon />\n          </MenuIcon>\n        ),\n        ['data-testid' as string]: 'export-menu',\n      }}\n      subOptions={{\n        onOpenChange: handleExportMenuOpenChange,\n      }}\n    >\n      {t.Export()}\n    </MenuSub>\n  );\n};\n","import type { ConfirmModalProps, MenuItemProps } from '@affine/component';\nimport { ConfirmModal, MenuIcon, MenuItem } from '@affine/component';\nimport { useI18n } from '@affine/i18n';\nimport { DeleteIcon } from '@blocksuite/icons/rc';\n\nexport const MoveToTrash = (props: MenuItemProps) => {\n  const t = useI18n();\n\n  return (\n    <MenuItem\n      preFix={\n        <MenuIcon>\n          <DeleteIcon />\n        </MenuIcon>\n      }\n      type=\"danger\"\n      {...props}\n    >\n      {t['com.affine.moveToTrash.title']()}\n    </MenuItem>\n  );\n};\n\nconst MoveToTrashConfirm = ({\n  titles,\n  ...confirmModalProps\n}: {\n  titles: string[];\n} & ConfirmModalProps) => {\n  const t = useI18n();\n  const multiple = titles.length > 1;\n  const title = multiple\n    ? t['com.affine.moveToTrash.confirmModal.title.multiple']({\n        number: titles.length.toString(),\n      })\n    : t['com.affine.moveToTrash.confirmModal.title']();\n  const description = multiple\n    ? t['com.affine.moveToTrash.confirmModal.description.multiple']({\n        number: titles.length.toString(),\n      })\n    : t['com.affine.moveToTrash.confirmModal.description']({\n        title: titles[0] || t['Untitled'](),\n      });\n  return (\n    <ConfirmModal\n      title={title}\n      description={description}\n      cancelText={t['com.affine.confirmModal.button.cancel']()}\n      confirmText={t.Delete()}\n      confirmButtonOptions={{\n        ['data-testid' as string]: 'confirm-delete-page',\n        variant: 'error',\n      }}\n      {...confirmModalProps}\n    />\n  );\n};\n\nMoveToTrash.ConfirmModal = MoveToTrashConfirm;\n","import type { Doc } from '@blocksuite/store';\nimport type { Atom } from 'jotai';\nimport { atom } from 'jotai';\n\nconst MAX_PREVIEW_LENGTH = 150;\nconst MAX_SEARCH_BLOCK_COUNT = 30;\n\nconst weakMap = new WeakMap<Doc, Atom<string>>();\n\nexport const getPagePreviewText = (page: Doc) => {\n  const pageRoot = page.root;\n  if (!pageRoot) {\n    return '';\n  }\n  const preview: string[] = [];\n  // DFS\n  const queue = [pageRoot];\n  let previewLenNeeded = MAX_PREVIEW_LENGTH;\n  let count = MAX_SEARCH_BLOCK_COUNT;\n  while (queue.length && previewLenNeeded > 0 && count-- > 0) {\n    const block = queue.shift();\n    if (!block) {\n      console.error('Unexpected empty block');\n      break;\n    }\n    if (block.flavour === 'affine:surface') {\n      // The surface block is a special block that contains canvas data,\n      // it should not be included in the preview.\n      continue;\n    }\n    if (block.children) {\n      queue.unshift(...block.children);\n    }\n    if (block.role !== 'content') {\n      continue;\n    }\n    if (block.text) {\n      // Text block e.g. paragraph/heading/list/code\n      const text = block.text.toString();\n      if (!text.length) {\n        continue;\n      }\n      previewLenNeeded -= text.length;\n      preview.push(text);\n    } else {\n      // Other block e.g. image/attachment/bookmark\n      const type = block.flavour.split('affine:')[1] ?? null;\n      if (type) {\n        previewLenNeeded -= type.length + 2;\n        preview.push(`[${type}]`);\n      }\n    }\n  }\n  return preview.join(' ').slice(0, MAX_PREVIEW_LENGTH);\n};\n\nconst emptyAtom = atom<string>('');\n\nexport function useBlockSuitePagePreview(page: Doc | null): Atom<string> {\n  if (page === null) {\n    return emptyAtom;\n  } else if (weakMap.has(page)) {\n    return weakMap.get(page) as Atom<string>;\n  } else {\n    const baseAtom = atom<string>('');\n    baseAtom.onMount = set => {\n      const disposables = [\n        page.slots.ready.on(() => {\n          set(getPagePreviewText(page));\n        }),\n        page.slots.blockUpdated.on(() => {\n          set(getPagePreviewText(page));\n        }),\n      ];\n      set(getPagePreviewText(page));\n      return () => {\n        disposables.forEach(disposable => disposable.dispose());\n      };\n    };\n    weakMap.set(page, baseAtom);\n    return baseAtom;\n  }\n}\n","import { DebugLogger } from '@affine/debug';\nimport { DisposableGroup } from '@blocksuite/global/utils';\nimport type { Doc, DocCollection } from '@blocksuite/store';\nimport { useEffect, useState } from 'react';\n\nconst logger = new DebugLogger('useBlockSuiteWorkspacePage');\n\nexport function useDocCollectionPage(\n  docCollection: DocCollection,\n  pageId: string | null\n): Doc | null {\n  const [page, setPage] = useState(\n    pageId ? docCollection.getDoc(pageId) : null\n  );\n\n  useEffect(() => {\n    const group = new DisposableGroup();\n    group.add(\n      docCollection.slots.docAdded.on(id => {\n        if (pageId === id) {\n          setPage(docCollection.getDoc(id));\n        }\n      })\n    );\n    group.add(\n      docCollection.slots.docRemoved.on(id => {\n        if (pageId === id) {\n          setPage(null);\n        }\n      })\n    );\n    return () => {\n      group.dispose();\n    };\n  }, [docCollection, pageId]);\n\n  useEffect(() => {\n    if (page && !page.loaded) {\n      try {\n        page.load();\n      } catch (err) {\n        logger.error('Failed to load page', err);\n      }\n    }\n  }, [page]);\n\n  useEffect(() => {\n    if (page?.id !== pageId) {\n      setPage(pageId ? docCollection.getDoc(pageId) : null);\n    }\n  }, [docCollection, page?.id, pageId]);\n\n  return page;\n}\n","import type { DocCollection } from '@blocksuite/store';\nimport { useAtomValue } from 'jotai';\nimport { Suspense } from 'react';\n\nimport { useBlockSuitePagePreview } from './use-block-suite-page-preview';\nimport { useDocCollectionPage } from './use-block-suite-workspace-page';\n\ninterface PagePreviewInnerProps {\n  docCollection: DocCollection;\n  pageId: string;\n}\n\nconst PagePreviewInner = ({\n  docCollection: workspace,\n  pageId,\n}: PagePreviewInnerProps) => {\n  const page = useDocCollectionPage(workspace, pageId);\n  const previewAtom = useBlockSuitePagePreview(page);\n  const preview = useAtomValue(previewAtom);\n  return preview ? preview : null;\n};\n\ninterface PagePreviewProps {\n  docCollection: DocCollection;\n  pageId: string;\n}\n\nexport const PagePreview = ({ docCollection, pageId }: PagePreviewProps) => {\n  return (\n    <Suspense>\n      <PagePreviewInner docCollection={docCollection} pageId={pageId} />\n    </Suspense>\n  );\n};\n","import \"../core/src/components/page-list/page-group.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/page-list/page-group.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACqVU227bMAx9z1cIAQY0wBQ4SZslHgr0P4ZhkCXa4SJLhiRnyYb8+2DJqe8p2j75QuqI5/CQL0e4pIblYMmvTSme9scV+TcjJPriH4TognF0l5hE3/33ATA7uJhExbn6cZ0RsoqG2atu9omZB0oNE3imXEvJCouJBMq1cqAcDXmLgHidvQyqWk9U9Zl7xiuf4nmdLetaIn9EoC0ku8QkleBTqicVaIA71ComXMsyV1UkY0VMthVQA7LxIPoEJpX6T0wOKASoTsYPwRyj1jEHz3NdgJr/9IeYwpyFO157Fi03lgCzQFFRXbppIC61BTEJtb4L9fgh6o9d6k/jIExipig6yG1MOCgHpvpdMCFQZb4TZLUtzv5lG9py69J6F74Txo+Z0aUSNy+wNEUFtAnQwmDOzKXyhzbeCqUFQy1I4C4mSivoVBsfqi75mifhfUpApClKCWLRxtj60xVR79gm8M0HeGmsNjEpNAbWTcIunNTKUYt/oXdt+J97Ev7yXtzB2VELXCvRZtzA7z8PL9CyMGJ9cDbe5+6kTXT9d2kdppfb4LZDA7XeIHC2i45V6olOtBFg/K4obe3RttvIruta9k4fLMZM1JWmvcWa3KQbi3oEb/WPNQS5Vi1fO8OUxTCS/j3VJifRcj0530lYFfXqBPE8T5m0UG+LV4yYGF1tk4d9JCC7yzT5SqbBnSlv2ONa8Hetijum6XV7HTScFqilMKoDGOzIxO8xGapEhzLVCPXwTEgRLTfek8HoFE6gnB1uKP4BZ/4HPzxSW/gHAAA=\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var collapsedIcon = '_3ud59kb';\nexport var collapsedIconContainer = '_3ud59kc';\nexport var collapsibleContent = '_3ud59k3';\nexport var collapsibleContentInner = '_3ud59k4';\nexport var header = '_3ud59k5';\nexport var headerCollapseIcon = '_3ud59k7';\nexport var headerCount = '_3ud59k9';\nexport var headerLabel = '_3ud59k8';\nexport var root = '_3ud59k0';\nexport var selectAllButton = '_3ud59ka';\nexport var spacer = '_3ud59k6';","import { useJournalInfoHelper } from '@affine/core/hooks/use-journal';\nimport type { Tag } from '@affine/env/filter';\nimport { useI18n } from '@affine/i18n';\nimport { assertExists } from '@blocksuite/global/utils';\nimport {\n  EdgelessIcon,\n  PageIcon,\n  TodayIcon,\n  ToggleCollapseIcon,\n  ViewLayersIcon,\n} from '@blocksuite/icons/rc';\nimport type { DocCollection, DocMeta } from '@blocksuite/store';\nimport * as Collapsible from '@radix-ui/react-collapsible';\nimport { DocsService, useLiveData, useService } from '@toeverything/infra';\nimport clsx from 'clsx';\nimport { selectAtom } from 'jotai/utils';\nimport type { MouseEventHandler } from 'react';\nimport { useCallback, useMemo, useState } from 'react';\n\nimport { CollectionListItem } from './collections/collection-list-item';\nimport { PageListItem } from './docs/page-list-item';\nimport { PagePreview } from './page-content-preview';\nimport * as styles from './page-group.css';\nimport {\n  groupCollapseStateAtom,\n  groupsAtom,\n  listPropsAtom,\n  selectionStateAtom,\n  useAtom,\n  useAtomValue,\n} from './scoped-atoms';\nimport { TagListItem } from './tags/tag-list-item';\nimport type {\n  CollectionListItemProps,\n  CollectionMeta,\n  ItemGroupProps,\n  ListItem,\n  ListProps,\n  PageListItemProps,\n  TagListItemProps,\n  TagMeta,\n} from './types';\nimport { shallowEqual } from './utils';\n\nexport const ItemGroupHeader = <T extends ListItem>({\n  id,\n  items,\n  label,\n}: ItemGroupProps<T>) => {\n  const [collapseState, setCollapseState] = useAtom(groupCollapseStateAtom);\n  const collapsed = collapseState[id];\n  const onExpandedClicked: MouseEventHandler = useCallback(\n    e => {\n      e.stopPropagation();\n      e.preventDefault();\n      setCollapseState(v => ({ ...v, [id]: !v[id] }));\n    },\n    [id, setCollapseState]\n  );\n\n  const [selectionState, setSelectionActive] = useAtom(selectionStateAtom);\n  const selectedItems = useMemo(() => {\n    const selectedIds = selectionState.selectedIds ?? [];\n    return items.filter(item => selectedIds.includes(item.id));\n  }, [items, selectionState.selectedIds]);\n\n  const allSelected = selectedItems.length === items.length;\n\n  const onSelectAll = useCallback(() => {\n    // also enable selection active\n    setSelectionActive(true);\n\n    const nonCurrentGroupIds =\n      selectionState.selectedIds?.filter(\n        id => !items.map(item => item.id).includes(id)\n      ) ?? [];\n\n    const newSelectedPageIds = allSelected\n      ? nonCurrentGroupIds\n      : [...nonCurrentGroupIds, ...items.map(item => item.id)];\n\n    selectionState.onSelectedIdsChange?.(newSelectedPageIds);\n  }, [setSelectionActive, selectionState, allSelected, items]);\n\n  const t = useI18n();\n\n  return label ? (\n    <div\n      data-testid=\"page-list-group-header\"\n      className={styles.header}\n      data-group-id={id}\n      data-group-items-count={items.length}\n      data-group-selected-items-count={selectedItems.length}\n    >\n      <div\n        role=\"button\"\n        onClick={onExpandedClicked}\n        data-testid=\"page-list-group-header-collapsed-button\"\n        className={styles.collapsedIconContainer}\n      >\n        <ToggleCollapseIcon\n          className={styles.collapsedIcon}\n          data-collapsed={!!collapsed}\n        />\n      </div>\n      <div className={styles.headerLabel}>{label}</div>\n      {selectionState.selectionActive ? (\n        <div className={styles.headerCount}>\n          {selectedItems.length}/{items.length}\n        </div>\n      ) : null}\n      <div className={styles.spacer} />\n      <button className={styles.selectAllButton} onClick={onSelectAll}>\n        {t[\n          allSelected\n            ? 'com.affine.page.group-header.clear'\n            : 'com.affine.page.group-header.select-all'\n        ]()}\n      </button>\n    </div>\n  ) : null;\n};\n\nexport const ItemGroup = <T extends ListItem>({\n  id,\n  items,\n  label,\n}: ItemGroupProps<T>) => {\n  const [collapsed, setCollapsed] = useState(false);\n  const onExpandedClicked: MouseEventHandler = useCallback(e => {\n    e.stopPropagation();\n    e.preventDefault();\n    setCollapsed(v => !v);\n  }, []);\n  const selectionState = useAtomValue(selectionStateAtom);\n  const selectedItems = useMemo(() => {\n    const selectedIds = selectionState.selectedIds ?? [];\n    return items.filter(item => selectedIds.includes(item.id));\n  }, [items, selectionState.selectedIds]);\n  const onSelectAll = useCallback(() => {\n    const nonCurrentGroupIds =\n      selectionState.selectedIds?.filter(\n        id => !items.map(item => item.id).includes(id)\n      ) ?? [];\n\n    selectionState.onSelectedIdsChange?.([\n      ...nonCurrentGroupIds,\n      ...items.map(item => item.id),\n    ]);\n  }, [items, selectionState]);\n  const t = useI18n();\n  return (\n    <Collapsible.Root\n      data-testid=\"page-list-group\"\n      data-group-id={id}\n      open={!collapsed}\n      className={clsx(styles.root)}\n    >\n      {label ? (\n        <div data-testid=\"page-list-group-header\" className={styles.header}>\n          <Collapsible.Trigger\n            role=\"button\"\n            onClick={onExpandedClicked}\n            data-testid=\"page-list-group-header-collapsed-button\"\n            className={styles.collapsedIconContainer}\n          >\n            <ToggleCollapseIcon\n              className={styles.collapsedIcon}\n              data-collapsed={collapsed !== false}\n            />\n          </Collapsible.Trigger>\n          <div className={styles.headerLabel}>{label}</div>\n          {selectionState.selectionActive ? (\n            <div className={styles.headerCount}>\n              {selectedItems.length}/{items.length}\n            </div>\n          ) : null}\n          <div className={styles.spacer} />\n          {selectionState.selectionActive ? (\n            <button className={styles.selectAllButton} onClick={onSelectAll}>\n              {t['com.affine.page.group-header.select-all']()}\n            </button>\n          ) : null}\n        </div>\n      ) : null}\n      <Collapsible.Content\n        className={styles.collapsibleContent}\n        data-state={!collapsed ? 'open' : 'closed'}\n      >\n        <div className={styles.collapsibleContentInner}>\n          {items.map(item => (\n            <PageListItemRenderer key={item.id} {...item} />\n          ))}\n        </div>\n      </Collapsible.Content>\n    </Collapsible.Root>\n  );\n};\n\n// TODO(@Peng): optimize how to render page meta list item\nconst requiredPropNames = [\n  'docCollection',\n  'rowAsLink',\n  'isPreferredEdgeless',\n  'operationsRenderer',\n  'selectedIds',\n  'onSelectedIdsChange',\n  'draggable',\n] as const;\n\ntype RequiredProps<T> = Pick<\n  ListProps<T>,\n  (typeof requiredPropNames)[number]\n> & {\n  selectable: boolean;\n};\n\nconst listsPropsAtom = selectAtom(\n  listPropsAtom,\n  props => {\n    return Object.fromEntries(\n      requiredPropNames.map(name => [name, props?.[name]])\n    ) as RequiredProps<ListItem>;\n  },\n  shallowEqual\n);\n\nexport const PageListItemRenderer = (item: ListItem) => {\n  const props = useAtomValue(listsPropsAtom);\n  const { selectionActive } = useAtomValue(selectionStateAtom);\n  const groups = useAtomValue(groupsAtom);\n  const pageItems = groups.flatMap(group => group.items).map(item => item.id);\n\n  const page = item as DocMeta;\n  return (\n    <PageListItem\n      {...pageMetaToListItemProp(\n        page,\n        {\n          ...props,\n\n          selectable: !!selectionActive,\n        },\n        pageItems\n      )}\n    />\n  );\n};\n\nexport const CollectionListItemRenderer = (item: ListItem) => {\n  const props = useAtomValue(listsPropsAtom);\n  const { selectionActive } = useAtomValue(selectionStateAtom);\n  const collection = item as CollectionMeta;\n  return (\n    <CollectionListItem\n      {...collectionMetaToListItemProp(collection, {\n        ...props,\n        selectable: !!selectionActive,\n      })}\n    />\n  );\n};\n\nexport const TagListItemRenderer = (item: ListItem) => {\n  const props = useAtomValue(listsPropsAtom);\n  const { selectionActive } = useAtomValue(selectionStateAtom);\n  const tag = item as TagMeta;\n  return (\n    <TagListItem\n      {...tagMetaToListItemProp(tag, {\n        ...props,\n        selectable: !!selectionActive,\n      })}\n    />\n  );\n};\n\nfunction tagIdToTagOption(\n  tagId: string,\n  docCollection: DocCollection\n): Tag | undefined {\n  return docCollection.meta.properties.tags?.options.find(\n    opt => opt.id === tagId\n  );\n}\n\nconst PageTitle = ({ id }: { id: string }) => {\n  const doc = useLiveData(useService(DocsService).list.doc$(id));\n  const title = useLiveData(doc?.title$);\n  const t = useI18n();\n  return title || t['Untitled']();\n};\n\nconst UnifiedPageIcon = ({\n  id,\n  docCollection,\n  isPreferredEdgeless,\n}: {\n  id: string;\n  docCollection: DocCollection;\n  isPreferredEdgeless?: (id: string) => boolean;\n}) => {\n  const isEdgeless = isPreferredEdgeless ? isPreferredEdgeless(id) : false;\n  const { isJournal } = useJournalInfoHelper(docCollection, id);\n  if (isJournal) {\n    return <TodayIcon />;\n  }\n  return isEdgeless ? <EdgelessIcon /> : <PageIcon />;\n};\n\nfunction pageMetaToListItemProp(\n  item: DocMeta,\n  props: RequiredProps<DocMeta>,\n  pageIds?: string[]\n): PageListItemProps {\n  const toggleSelection = props.onSelectedIdsChange\n    ? () => {\n        assertExists(props.selectedIds);\n        const prevSelected = props.selectedIds.includes(item.id);\n        const shouldAdd = !prevSelected;\n        const shouldRemove = prevSelected;\n\n        if (shouldAdd) {\n          props.onSelectedIdsChange?.([...props.selectedIds, item.id]);\n        } else if (shouldRemove) {\n          props.onSelectedIdsChange?.(\n            props.selectedIds.filter(id => id !== item.id)\n          );\n        }\n      }\n    : undefined;\n  const itemProps: PageListItemProps = {\n    pageId: item.id,\n    pageIds,\n    title: <PageTitle id={item.id} />,\n    preview: (\n      <PagePreview docCollection={props.docCollection} pageId={item.id} />\n    ),\n    createDate: new Date(item.createDate),\n    updatedDate: item.updatedDate ? new Date(item.updatedDate) : undefined,\n    to: props.rowAsLink && !props.selectable ? `/${item.id}` : undefined,\n    onClick: toggleSelection,\n    icon: (\n      <UnifiedPageIcon\n        id={item.id}\n        docCollection={props.docCollection}\n        isPreferredEdgeless={props.isPreferredEdgeless}\n      />\n    ),\n    tags:\n      item.tags\n        ?.map(id => tagIdToTagOption(id, props.docCollection))\n        .filter((v): v is Tag => v != null) ?? [],\n    operations: props.operationsRenderer?.(item),\n    selectable: props.selectable,\n    selected: props.selectedIds?.includes(item.id),\n    onSelectedChange: toggleSelection,\n    draggable: props.draggable,\n    isPublicPage: !!item.isPublic,\n  };\n  return itemProps;\n}\n\nfunction collectionMetaToListItemProp(\n  item: CollectionMeta,\n  props: RequiredProps<CollectionMeta>\n): CollectionListItemProps {\n  const toggleSelection = props.onSelectedIdsChange\n    ? () => {\n        assertExists(props.selectedIds);\n        const prevSelected = props.selectedIds.includes(item.id);\n        const shouldAdd = !prevSelected;\n        const shouldRemove = prevSelected;\n\n        if (shouldAdd) {\n          props.onSelectedIdsChange?.([...props.selectedIds, item.id]);\n        } else if (shouldRemove) {\n          props.onSelectedIdsChange?.(\n            props.selectedIds.filter(id => id !== item.id)\n          );\n        }\n      }\n    : undefined;\n  const itemProps: CollectionListItemProps = {\n    collectionId: item.id,\n    title: item.title,\n    to:\n      props.rowAsLink && !props.selectable\n        ? `/collection/${item.id}`\n        : undefined,\n    onClick: toggleSelection,\n    icon: <ViewLayersIcon />,\n    operations: props.operationsRenderer?.(item),\n    selectable: props.selectable,\n    selected: props.selectedIds?.includes(item.id),\n    onSelectedChange: toggleSelection,\n    draggable: props.draggable,\n  };\n  return itemProps;\n}\nfunction tagMetaToListItemProp(\n  item: TagMeta,\n  props: RequiredProps<TagMeta>\n): TagListItemProps {\n  const toggleSelection = props.onSelectedIdsChange\n    ? () => {\n        assertExists(props.selectedIds);\n        const prevSelected = props.selectedIds.includes(item.id);\n        const shouldAdd = !prevSelected;\n        const shouldRemove = prevSelected;\n\n        if (shouldAdd) {\n          props.onSelectedIdsChange?.([...props.selectedIds, item.id]);\n        } else if (shouldRemove) {\n          props.onSelectedIdsChange?.(\n            props.selectedIds.filter(id => id !== item.id)\n          );\n        }\n      }\n    : undefined;\n  const itemProps: TagListItemProps = {\n    tagId: item.id,\n    title: item.title,\n    to: props.rowAsLink && !props.selectable ? `/tag/${item.id}` : undefined,\n    onClick: toggleSelection,\n    color: item.color,\n    pageCount: item.pageCount,\n    operations: props.operationsRenderer?.(item),\n    selectable: props.selectable,\n    selected: props.selectedIds?.includes(item.id),\n    onSelectedChange: toggleSelection,\n    draggable: props.draggable,\n  };\n  return itemProps;\n}\n","import { SortDownIcon, SortUpIcon } from '@blocksuite/icons/rc';\nimport { useCallback } from 'react';\n\nimport type { ColWrapperProps, ListItem } from '../types';\nimport { ColWrapper } from '../utils';\nimport * as styles from './list-header-cell.css';\n\ntype HeaderCellProps = ColWrapperProps & {\n  sortKey: keyof ListItem;\n  sortable?: boolean;\n  order?: 'asc' | 'desc';\n  sorting?: boolean;\n  onSort?: (sortable?: boolean, sortKey?: keyof ListItem) => void;\n};\n\nexport const ListHeaderCell = ({\n  sortKey,\n  sortable,\n  order,\n  sorting,\n  onSort,\n  alignment,\n  flex,\n  style,\n  hidden,\n  hideInSmallContainer,\n  children,\n}: HeaderCellProps) => {\n  const handleClick = useCallback(() => {\n    if (sortable) {\n      onSort?.(sortable, sortKey);\n    }\n  }, [sortable, sortKey, onSort]);\n\n  return (\n    <ColWrapper\n      flex={flex}\n      alignment={alignment}\n      onClick={handleClick}\n      className={styles.headerCell}\n      data-sortable={sortable ? true : undefined}\n      data-sorting={sorting ? true : undefined}\n      hidden={hidden}\n      style={style}\n      role=\"columnheader\"\n      hideInSmallContainer={hideInSmallContainer}\n    >\n      {children}\n      {sorting ? (\n        <div className={styles.headerCellSortIcon}>\n          {order === 'asc' ? <SortUpIcon /> : <SortDownIcon />}\n        </div>\n      ) : null}\n    </ColWrapper>\n  );\n};\n","import \"../core/src/components/page-list/components/list-header-cell.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/page-list/components/list-header-cell.css.ts.vanilla.css\\\",\\\"source\\\":\\\"LmhhNDVpMjAgewogIHBhZGRpbmc6IDAgOHB4OwogIHVzZXItc2VsZWN0OiBub25lOwogIGZvbnQtc2l6ZTogdmFyKC0tYWZmaW5lLWZvbnQteHMpOwogIGNvbG9yOiB2YXIoLS1hZmZpbmUtdGV4dC1zZWNvbmRhcnktY29sb3IpOwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgY29sdW1uLWdhcDogNHB4OwogIHBvc2l0aW9uOiByZWxhdGl2ZTsKICB3aGl0ZS1zcGFjZTogbm93cmFwOwp9Ci5oYTQ1aTIwW2RhdGEtc29ydGluZ10sIC5oYTQ1aTIwOmhvdmVyIHsKICBjb2xvcjogdmFyKC0tYWZmaW5lLXRleHQtcHJpbWFyeS1jb2xvcik7Cn0KLmhhNDVpMjBbZGF0YS1zb3J0YWJsZV0gewogIGN1cnNvcjogcG9pbnRlcjsKfQouaGE0NWkyMDpub3QoOmxhc3QtY2hpbGQpIHsKICBib3JkZXItcmlnaHQ6IDFweCBzb2xpZCB2YXIoLS1hZmZpbmUtaG92ZXItY29sb3ItZmlsbGVkKTsKfQouaGE0NWkyMSB7CiAgZGlzcGxheTogaW5saW5lLWZsZXg7CiAgZm9udC1zaXplOiAxNHB4OwogIGNvbG9yOiB2YXIoLS1hZmZpbmUtaWNvbi1jb2xvcik7Cn0=\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var headerCell = 'ha45i20';\nexport var headerCellSortIcon = 'ha45i21';","import type { CheckboxProps } from '@affine/component';\nimport { Checkbox } from '@affine/component';\nimport { useCatchEventCallback } from '@affine/core/hooks/use-catch-event-hook';\nimport { useI18n } from '@affine/i18n';\nimport { MultiSelectIcon } from '@blocksuite/icons/rc';\nimport clsx from 'clsx';\nimport { selectAtom } from 'jotai/utils';\nimport type { MouseEventHandler } from 'react';\nimport { useCallback } from 'react';\n\nimport { ListHeaderCell } from './components/list-header-cell';\nimport * as styles from './page-header.css';\nimport {\n  itemsAtom,\n  listHandlersAtom,\n  listPropsAtom,\n  selectionStateAtom,\n  sorterAtom,\n  useAtom,\n  useAtomValue,\n} from './scoped-atoms';\nimport type { HeaderColDef, ListItem } from './types';\n\n// the checkbox on the header has three states:\n// when list selectable = true, the checkbox will be presented\n// when internal selection state is not enabled, it is a clickable <ListIcon /> that enables the selection state\n// when internal selection state is enabled, it is a checkbox that reflects the selection state\nconst ListHeaderCheckbox = () => {\n  const [selectionState, setSelectionState] = useAtom(selectionStateAtom);\n  const items = useAtomValue(itemsAtom);\n  const onActivateSelection: MouseEventHandler = useCatchEventCallback(() => {\n    setSelectionState(true);\n  }, [setSelectionState]);\n  const handlers = useAtomValue(listHandlersAtom);\n  const onChange: NonNullable<CheckboxProps['onChange']> =\n    useCatchEventCallback(\n      (_e, checked) => {\n        handlers.onSelectedIdsChange?.(\n          checked ? (items ?? []).map(i => i.id) : []\n        );\n      },\n      [handlers, items]\n    );\n\n  if (!selectionState.selectable) {\n    return null;\n  }\n\n  return (\n    <div\n      data-testid=\"page-list-header-selection-checkbox\"\n      className={styles.headerTitleSelectionIconWrapper}\n      onClick={onActivateSelection}\n    >\n      {!selectionState.selectionActive ? (\n        <MultiSelectIcon />\n      ) : (\n        <Checkbox\n          checked={selectionState.selectedIds?.length === items?.length}\n          indeterminate={\n            selectionState.selectedIds &&\n            selectionState.selectedIds.length > 0 &&\n            selectionState.selectedIds.length < (items?.length ?? 0)\n          }\n          onChange={onChange}\n        />\n      )}\n    </div>\n  );\n};\n\nexport const ListHeaderTitleCell = () => {\n  const t = useI18n();\n  return (\n    <div className={styles.headerTitleCell}>\n      <ListHeaderCheckbox />\n      {t['Title']()}\n    </div>\n  );\n};\n\nconst hideHeaderAtom = selectAtom(listPropsAtom, props => props?.hideHeader);\n\n// the table header for page list\nexport const ListTableHeader = ({\n  headerCols,\n}: {\n  headerCols: HeaderColDef[];\n}) => {\n  const [sorter, setSorter] = useAtom(sorterAtom);\n  const hideHeader = useAtomValue(hideHeaderAtom);\n  const selectionState = useAtomValue(selectionStateAtom);\n  const onSort = useCallback(\n    (sortable?: boolean, sortKey?: keyof ListItem) => {\n      if (sortable && sortKey) {\n        setSorter({\n          newSortKey: sortKey,\n        });\n      }\n    },\n    [setSorter]\n  );\n\n  if (hideHeader) {\n    return false;\n  }\n\n  return (\n    <div\n      className={clsx(styles.tableHeader)}\n      data-selectable={selectionState.selectable}\n      data-selection-active={selectionState.selectionActive}\n    >\n      {headerCols.map(col => {\n        const isTagHidden = col.key === 'tags' && col.hidden;\n        return (\n          <ListHeaderCell\n            flex={col.flex}\n            alignment={col.alignment}\n            key={col.key}\n            sortKey={col.key as keyof ListItem}\n            sortable={col.sortable}\n            sorting={sorter.key === col.key}\n            order={sorter.order}\n            hidden={isTagHidden ? false : col.hidden}\n            onSort={onSort}\n            style={{\n              overflow: 'visible',\n              visibility: isTagHidden ? 'hidden' : 'visible',\n            }}\n            hideInSmallContainer={col.hideInSmallContainer}\n          >\n            {col.content}\n          </ListHeaderCell>\n        );\n      })}\n    </div>\n  );\n};\n","import \"../core/src/components/page-list/page-header.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/page-list/page-header.css.ts.vanilla.css\\\",\\\"source\\\":\\\"LmV1dWRxajAgewogIGRpc3BsYXk6IGZsZXg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBnYXA6IDhweDsKfQouZXV1ZHFqMSB7CiAgZGlzcGxheTogZmxleDsKICBhbGlnbi1pdGVtczogY2VudGVyOwogIHBhZGRpbmc6IDEwcHggNnB4IDEwcHggMTZweDsKICBwb3NpdGlvbjogc3RpY2t5OwogIG92ZXJmbG93OiBoaWRkZW47CiAgei1pbmRleDogMTsKICB0b3A6IDA7CiAgbGVmdDogMDsKICBiYWNrZ3JvdW5kOiB2YXIoLS1hZmZpbmUtYmFja2dyb3VuZC1wcmltYXJ5LWNvbG9yKTsKICB0cmFuc2l0aW9uOiBib3gtc2hhZG93IDAuMnMgZWFzZS1pbi1vdXQ7CiAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC0wLjVweCk7Cn0KW2RhdGEtaGFzLXNjcm9sbC10b3A9dHJ1ZV0gLmV1dWRxajEgewogIGJveC1zaGFkb3c6IDAgMC41cHggdmFyKC0tYWZmaW5lLWJvcmRlci1jb2xvcik7Cn0KLmV1dWRxajIgewogIGRpc3BsYXk6IGZsZXg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBqdXN0aWZ5LWNvbnRlbnQ6IGZsZXgtc3RhcnQ7CiAgZm9udC1zaXplOiAxNnB4Owp9Ci5ldXVkcWoxW2RhdGEtc2VsZWN0YWJsZT10b2dnbGVdIC5ldXVkcWoyIHsKICB3aWR0aDogMzJweDsKfQouZXV1ZHFqMVtkYXRhLXNlbGVjdGlvbi1hY3RpdmU9dHJ1ZV0gLmV1dWRxajIgewogIHdpZHRoOiAyNHB4Owp9\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var headerTitleCell = 'euudqj0';\nexport var headerTitleSelectionIconWrapper = 'euudqj2';\nexport var tableHeader = 'euudqj1';","import { DEFAULT_SORT_KEY } from '@affine/env/constant';\nimport { atom } from 'jotai';\nimport { selectAtom } from 'jotai/utils';\nimport { createIsolation } from 'jotai-scope';\n\nimport { itemsToItemGroups } from './items-to-item-group';\nimport type {\n  ListItem,\n  ListProps,\n  MetaRecord,\n  VirtualizedListProps,\n} from './types';\nimport { shallowEqual } from './utils';\n\n// for ease of use in the component tree\n// note: must use selectAtom to access this atom for efficiency\nexport const listPropsAtom = atom<\n  ListProps<ListItem> & Partial<VirtualizedListProps<ListItem>>\n>();\n\n// whether or not the table is in selection mode (showing selection checkbox & selection floating bar)\nconst selectionActiveAtom = atom(false);\n\nexport const anchorIndexAtom = atom<number | undefined>(undefined);\n\nexport const rangeIdsAtom = atom<string[]>([]);\n\nexport const selectionStateAtom = atom(\n  get => {\n    const baseAtom = selectAtom(\n      listPropsAtom,\n      props => {\n        const { selectable, selectedIds, onSelectedIdsChange } = props ?? {};\n        return {\n          selectable,\n          selectedIds,\n          onSelectedIdsChange,\n        };\n      },\n      shallowEqual\n    );\n    const baseState = get(baseAtom);\n    const selectionActive =\n      baseState.selectable === 'toggle'\n        ? get(selectionActiveAtom)\n        : baseState.selectable;\n    return {\n      ...baseState,\n      selectionActive,\n    };\n  },\n  (_get, set, active: boolean) => {\n    set(selectionActiveAtom, active);\n  }\n);\n\n// id -> isCollapsed\n// maybe reset on page on unmount?\nexport const groupCollapseStateAtom = atom<Record<string, boolean>>({});\n\n// get handlers from pageListPropsAtom\nexport const listHandlersAtom = selectAtom(\n  listPropsAtom,\n  props => {\n    const { onSelectedIdsChange } = props ?? {};\n    return {\n      onSelectedIdsChange,\n    };\n  },\n  shallowEqual\n);\n\nexport const itemsAtom = selectAtom(\n  listPropsAtom,\n  props => props?.items,\n  shallowEqual\n);\n\nexport const showOperationsAtom = selectAtom(\n  listPropsAtom,\n  props => !!props?.operationsRenderer\n);\n\ntype SortingContext<KeyType extends string | number | symbol> = {\n  key: KeyType;\n  order: 'asc' | 'desc';\n  fallbackKey?: KeyType;\n};\n\ntype SorterConfig<T> = {\n  key?: keyof T;\n  order: 'asc' | 'desc';\n  sortingFn: (ctx: SortingContext<keyof T>, a: T, b: T) => number;\n};\n\nconst defaultSortingFn: SorterConfig<MetaRecord<ListItem>>['sortingFn'] = (\n  ctx,\n  a,\n  b\n) => {\n  const val = (obj: MetaRecord<ListItem>) => {\n    let v = obj[ctx.key];\n    if (v === undefined && ctx.fallbackKey) {\n      v = obj[ctx.fallbackKey];\n    }\n    return v;\n  };\n  const valA = val(a);\n  const valB = val(b);\n  const revert = ctx.order === 'desc';\n  const revertSymbol = revert ? -1 : 1;\n  if (typeof valA === 'string' && typeof valB === 'string') {\n    return valA.localeCompare(valB) * revertSymbol;\n  }\n  if (typeof valA === 'number' && typeof valB === 'number') {\n    return (valA - valB) * revertSymbol;\n  }\n  if (valA instanceof Date && valB instanceof Date) {\n    return (valA.getTime() - valB.getTime()) * revertSymbol;\n  }\n  if (!valA) {\n    return -1 * revertSymbol;\n  }\n  if (!valB) {\n    return 1 * revertSymbol;\n  }\n\n  if (Array.isArray(valA) && Array.isArray(valB)) {\n    return (valA.length - valB.length) * revertSymbol;\n  }\n  console.warn(\n    'Unsupported sorting type! Please use custom sorting function.',\n    valA,\n    valB\n  );\n  return 0;\n};\n\nconst validKeys: Array<keyof MetaRecord<ListItem>> = [\n  'id',\n  'title',\n  'createDate',\n  'updatedDate',\n];\n\nconst sorterStateAtom = atom<SorterConfig<MetaRecord<ListItem>>>({\n  key: DEFAULT_SORT_KEY,\n  order: 'desc',\n  sortingFn: defaultSortingFn,\n});\n\nexport const sorterAtom = atom(\n  get => {\n    let items = get(itemsAtom);\n    const sorterState = get(sorterStateAtom);\n    const sortCtx: SortingContext<keyof MetaRecord<ListItem>> | null =\n      sorterState.key\n        ? {\n            key: sorterState.key,\n            order: sorterState.order,\n          }\n        : null;\n    if (sortCtx) {\n      if (sorterState.key === 'updatedDate') {\n        sortCtx.fallbackKey = 'createDate';\n      }\n      const compareFn = (a: MetaRecord<ListItem>, b: MetaRecord<ListItem>) =>\n        sorterState.sortingFn(sortCtx, a, b);\n      items = items ? [...items].sort(compareFn) : [];\n    }\n    return {\n      items,\n      ...sortCtx,\n    };\n  },\n  (_get, set, { newSortKey }: { newSortKey: keyof MetaRecord<ListItem> }) => {\n    set(sorterStateAtom, sorterState => {\n      if (validKeys.includes(newSortKey)) {\n        return {\n          ...sorterState,\n          key: newSortKey,\n          order: sorterState.order === 'asc' ? 'desc' : 'asc',\n          sortingFn: sorterState.sortingFn,\n        };\n      }\n      return sorterState;\n    });\n  }\n);\n\nexport const groupsAtom = atom(get => {\n  const groupBy = get(selectAtom(listPropsAtom, props => props?.groupBy));\n  const sorter = get(sorterAtom);\n\n  return itemsToItemGroups<ListItem>(sorter.items ?? [], groupBy);\n});\n\nexport const {\n  Provider: ListProvider,\n  useAtom,\n  useAtomValue,\n  useSetAtom,\n} = createIsolation();\n","import type { ItemGroupDefinition, ItemGroupProps, ListItem } from './types';\n\nexport function itemsToItemGroups<T extends ListItem>(\n  items: T[],\n  groupDefs?: ItemGroupDefinition<T>[] | false\n): ItemGroupProps<T>[] {\n  if (!groupDefs) {\n    return [\n      {\n        id: 'all',\n        items: items,\n        allItems: items,\n      },\n    ];\n  }\n\n  // assume pages are already sorted, we will use the page order to determine the group order\n  let groups: ItemGroupProps<T>[] = groupDefs.map(groupDef => ({\n    id: groupDef.id,\n    label: undefined, // Will be set later\n    items: [],\n    allItems: items,\n  }));\n\n  for (const item of items) {\n    // for a single page, there could be multiple groups that it belongs to\n    const matchedGroups = groupDefs.filter(def => def.match(item));\n    for (const groupDef of matchedGroups) {\n      const group = groups.find(g => g.id === groupDef.id);\n      if (group) {\n        group.items.push(item);\n      }\n    }\n  }\n\n  // Now that all items have been added to groups, we can get the correct label for each group\n  groups = groups\n    .map(group => {\n      const groupDef = groupDefs.find(def => def.id === group.id);\n      if (groupDef) {\n        if (typeof groupDef.label === 'function') {\n          group.label = groupDef.label(group.items.length);\n        } else {\n          group.label = groupDef.label;\n        }\n      }\n      return group;\n    })\n    .filter(group => group.items.length > 0);\n\n  return groups;\n}\n","import \"../core/src/components/page-list/selector/selector-layout.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/page-list/selector/selector-layout.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACqWSwU7DMBBE7/2KvSDRgyunJFDcj0FusmkXObZxtjQF8e/IboOSJhwQl0Raj5/HM169ZMVb0eWFhM8FQEWtN/qsoDbYbReQ/qKigCWTswpKZ46NjSsHpP2BFWRS3m0XX4tVT8oSaedChUHsHLNrFGS+g9YZquBdh3shdF2TRWH0OYmidhmpDVnRkx9z343I60Q+UcWH/txbHwDuyIYsKrDOYhx4XVVk9wrW0nfDT8ID1M6yaOkDL4o4ioAfGyPd6TrMpUxCZMYgWq/LdISQq/WN6YdkuofJPlQF2UiWD1Nj5/8T2eTO1+moE2GwZhF0RcdWAdkDBuKpKkTwnGzyVF6PLVN9FqWzjJYVxFRQ7JBPiOnJaEN7K4ixaRWUaBnDKINi/g3ObgPY6xjSZlLiKK0079rltFU502oRWx0Yevy7oaeb+p8SonTGhRtrPlCjQ8zLuNjkYNMmbfopMffd9aIDzfO8t2TicrmBWP8K/AYdTrQDAQQAAA==\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var actionButton = '_15q5x45a';\nexport var clearButton = '_15q5x458';\nexport var content = '_15q5x453';\nexport var footer = '_15q5x454';\nexport var footerAction = '_15q5x459';\nexport var footerInfo = '_15q5x455';\nexport var header = '_15q5x451';\nexport var root = '_15q5x450';\nexport var search = '_15q5x452';\nexport var selectedCount = '_15q5x456';\nexport var selectedNum = '_15q5x457';","import { Button } from '@affine/component';\nimport { useI18n } from '@affine/i18n';\nimport { type PropsWithChildren, type ReactNode, useCallback } from 'react';\n\nimport * as styles from './selector-layout.css';\n\nexport interface SelectorContentProps extends PropsWithChildren {\n  searchPlaceholder?: string;\n  selectedCount?: number;\n\n  onSearch?: (value: string) => void;\n  onClear?: () => void;\n  onCancel?: () => void;\n  onConfirm?: () => void;\n\n  actions?: ReactNode;\n}\n\n/**\n * Provides a unified layout for doc/collection/tag selector\n * - Header (Search input)\n * - Content\n * - Footer (Selected count + Actions)\n */\nexport const SelectorLayout = ({\n  children,\n  searchPlaceholder,\n  selectedCount,\n\n  onSearch,\n  onClear,\n  onCancel,\n  onConfirm,\n\n  actions,\n}: SelectorContentProps) => {\n  const t = useI18n();\n\n  const onSearchChange = useCallback(\n    (e: React.ChangeEvent<HTMLInputElement>) => {\n      onSearch?.(e.target.value);\n    },\n    [onSearch]\n  );\n\n  return (\n    <div className={styles.root}>\n      <header className={styles.header}>\n        <input\n          className={styles.search}\n          placeholder={searchPlaceholder}\n          onChange={onSearchChange}\n        />\n      </header>\n\n      <main className={styles.content}>{children}</main>\n\n      <footer className={styles.footer}>\n        <div className={styles.footerInfo}>\n          <div className={styles.selectedCount}>\n            <span>{t['com.affine.selectPage.selected']()}</span>\n            <span className={styles.selectedNum}>{selectedCount ?? 0}</span>\n          </div>\n          <Button\n            variant=\"plain\"\n            className={styles.clearButton}\n            onClick={onClear}\n          >\n            {t['com.affine.editCollection.pages.clear']()}\n          </Button>\n        </div>\n\n        <div className={styles.footerAction}>\n          {actions ?? (\n            <>\n              <Button onClick={onCancel} className={styles.actionButton}>\n                {t['Cancel']()}\n              </Button>\n              <Button\n                onClick={onConfirm}\n                className={styles.actionButton}\n                variant=\"primary\"\n              >\n                {t['Confirm']()}\n              </Button>\n            </>\n          )}\n        </div>\n      </footer>\n    </div>\n  );\n};\n","import { Button, Input, Menu, toast } from '@affine/component';\nimport { TagService } from '@affine/core/modules/tag';\nimport { useI18n } from '@affine/i18n';\nimport { useLiveData, useService } from '@toeverything/infra';\nimport clsx from 'clsx';\nimport { useCallback, useEffect, useMemo, useState } from 'react';\n\nimport type { TagMeta } from '../types';\nimport * as styles from './create-tag.css';\n\nconst TagIcon = ({ color, large }: { color: string; large?: boolean }) => (\n  <div\n    className={clsx(styles.tagColorIcon, {\n      ['large']: large,\n    })}\n    style={{ backgroundColor: color }}\n  />\n);\n\nexport const CreateOrEditTag = ({\n  open,\n  onOpenChange,\n  tagMeta,\n}: {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  tagMeta?: TagMeta;\n}) => {\n  const tagService = useService(TagService);\n  const tagList = tagService.tagList;\n  const tagOptions = useLiveData(tagList.tagMetas$);\n  const tag = useLiveData(tagList.tagByTagId$(tagMeta?.id));\n  const t = useI18n();\n  const [menuOpen, setMenuOpen] = useState(false);\n\n  const [tagName, setTagName] = useState(tagMeta?.title || '');\n  const handleChangeName = useCallback((value: string) => {\n    setTagName(value);\n  }, []);\n\n  const [tagIcon, setTagIcon] = useState(\n    tagMeta?.color || tagService.randomTagColor()\n  );\n\n  const handleChangeIcon = useCallback((value: string) => {\n    setTagIcon(value);\n  }, []);\n\n  const tags = useMemo(() => {\n    return tagService.tagColors.map(([name, color]) => {\n      return {\n        name: name,\n        color: color,\n        onClick: () => {\n          handleChangeIcon(color);\n          setMenuOpen(false);\n        },\n      };\n    });\n  }, [handleChangeIcon, tagService.tagColors]);\n\n  const items = useMemo(() => {\n    const tagItems = tags.map(item => {\n      return (\n        <div\n          key={item.color}\n          onClick={item.onClick}\n          className={clsx(styles.tagItem, {\n            ['active']: item.color === tagIcon,\n          })}\n        >\n          <TagIcon color={item.color} large={true} />\n        </div>\n      );\n    });\n    return <div className={styles.tagItemsWrapper}>{tagItems}</div>;\n  }, [tagIcon, tags]);\n\n  const onClose = useCallback(() => {\n    if (!tagMeta) {\n      handleChangeIcon(tagService.randomTagColor());\n      setTagName('');\n    }\n    onOpenChange(false);\n  }, [handleChangeIcon, onOpenChange, tagMeta, tagService]);\n\n  const onConfirm = useCallback(() => {\n    if (!tagName?.trim()) return;\n    if (\n      tagOptions.some(\n        tag => tag.title === tagName.trim() && tag.id !== tagMeta?.id\n      )\n    ) {\n      return toast(t['com.affine.tags.create-tag.toast.exist']());\n    }\n    if (!tagMeta) {\n      tagList.createTag(tagName.trim(), tagIcon);\n      toast(t['com.affine.tags.create-tag.toast.success']());\n      onClose();\n      return;\n    }\n    tag?.rename(tagName.trim());\n    tag?.changeColor(tagIcon);\n\n    toast(t['com.affine.tags.edit-tag.toast.success']());\n    onClose();\n    return;\n  }, [onClose, t, tag, tagIcon, tagMeta, tagName, tagOptions, tagList]);\n\n  useEffect(() => {\n    if (!open) return;\n    if (menuOpen) return;\n\n    const handleEscape = (event: KeyboardEvent) => {\n      if (event.key === 'Escape') {\n        onClose();\n      }\n    };\n\n    document.addEventListener('keydown', handleEscape);\n\n    return () => {\n      document.removeEventListener('keydown', handleEscape);\n    };\n  }, [open, onOpenChange, menuOpen, onClose]);\n\n  useEffect(() => {\n    setTagName(tagMeta?.title || '');\n    setTagIcon(tagMeta?.color || tagService.randomTagColor());\n  }, [tagMeta?.color, tagMeta?.title, tagService]);\n\n  if (!open) {\n    return null;\n  }\n\n  return (\n    <div\n      className={styles.createTagWrapper}\n      data-show={open}\n      data-testid=\"edit-tag-modal\"\n    >\n      <Menu\n        rootOptions={{\n          open: menuOpen,\n          onOpenChange: setMenuOpen,\n        }}\n        items={items}\n      >\n        <Button className={styles.menuBtn}>\n          <TagIcon color={tagIcon} />\n        </Button>\n      </Menu>\n\n      <Input\n        placeholder={t['com.affine.tags.create-tag.placeholder']()}\n        inputStyle={{ fontSize: 'var(--affine-font-xs)' }}\n        onEnter={onConfirm}\n        value={tagName}\n        onChange={handleChangeName}\n        autoFocus\n        data-testid=\"edit-tag-input\"\n      />\n      <Button className={styles.cancelBtn} onClick={onClose}>\n        {t['Cancel']()}\n      </Button>\n      <Button\n        variant=\"primary\"\n        onClick={onConfirm}\n        disabled={!tagName}\n        data-testid=\"save-tag\"\n      >\n        {tagMeta ? t['Save']() : t['Create']()}\n      </Button>\n    </div>\n  );\n};\n","import \"../core/src/components/page-list/tags/create-tag.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/page-list/tags/create-tag.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xZ2FrdHIwMCB7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBwYWRkaW5nOiA4cHg7CiAgYm9yZGVyLXJhZGl1czogOHB4OwogIG1hcmdpbjogMCAxNnB4OwogIGRpc3BsYXk6IGZsZXg7CiAgZm9udC1zaXplOiB2YXIoLS1hZmZpbmUtZm9udC14cyk7CiAgYmFja2dyb3VuZDogdmFyKC0tYWZmaW5lLWJhY2tncm91bmQtc2Vjb25kYXJ5LWNvbG9yKTsKfQouXzFnYWt0cjAwW2RhdGEtc2hvdz0iZmFsc2UiXSB7CiAgZGlzcGxheTogbm9uZTsKICBwb2ludGVyLWV2ZW50czogbm9uZTsKfQouXzFnYWt0cjAxIHsKICB3aWR0aDogOHB4OwogIGhlaWdodDogOHB4OwogIGJvcmRlci1yYWRpdXM6IDUwJTsKfQouXzFnYWt0cjAxLmxhcmdlIHsKICB3aWR0aDogMTZweDsKICBoZWlnaHQ6IDE2cHg7Cn0KLl8xZ2FrdHIwMiB7CiAgZGlzcGxheTogZmxleDsKICBhbGlnbi1pdGVtczogY2VudGVyOwogIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsKICBnYXA6IDRweDsKfQouXzFnYWt0cjAzIHsKICBkaXNwbGF5OiBpbmxpbmUtZmxleDsKICBhbGlnbi1pdGVtczogY2VudGVyOwogIGp1c3RpZnktY29udGVudDogY2VudGVyOwogIGJvcmRlci1yYWRpdXM6IDUwJTsKICBwYWRkaW5nOiAycHg7CiAgY3Vyc29yOiBwb2ludGVyOwogIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWFmZmluZS1iYWNrZ3JvdW5kLW92ZXJsYXktcGFuZWwtY29sb3IpOwp9Ci5fMWdha3RyMDM6aG92ZXIgewogIGJveC1zaGFkb3c6IDAgMCAwIDFweCB2YXIoLS1hZmZpbmUtcHJpbWFyeS1jb2xvcik7Cn0KLl8xZ2FrdHIwMy5hY3RpdmUgewogIGJveC1zaGFkb3c6IDAgMCAwIDFweCB2YXIoLS1hZmZpbmUtcHJpbWFyeS1jb2xvcik7Cn0KLl8xZ2FrdHIwNCB7CiAgbWFyZ2luLWxlZnQ6IDIwcHg7CiAgbWFyZ2luLXJpZ2h0OiA4cHg7Cn0KLl8xZ2FrdHIwNSB7CiAgcGFkZGluZzogMHB4IDEwcHg7CiAgbWFyZ2luLXJpZ2h0OiA0cHg7Cn0=\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var cancelBtn = '_1gaktr04';\nexport var createTagWrapper = '_1gaktr00';\nexport var menuBtn = '_1gaktr05';\nexport var tagColorIcon = '_1gaktr01';\nexport var tagItem = '_1gaktr03';\nexport var tagItemsWrapper = '_1gaktr02';","import { toast } from '@affine/component';\nimport { FavoriteService } from '@affine/core/modules/favorite';\nimport { TagService } from '@affine/core/modules/tag';\nimport { useI18n } from '@affine/i18n';\nimport { useLiveData, useService, WorkspaceService } from '@toeverything/infra';\nimport { useCallback, useMemo, useState } from 'react';\n\nimport { FavoriteTag } from '../components/favorite-tag';\nimport { tagHeaderColsDef } from '../header-col-def';\nimport { TagListItemRenderer } from '../page-group';\nimport { ListTableHeader } from '../page-header';\nimport type { BaseSelectorDialogProps } from '../selector';\nimport { SelectorLayout } from '../selector/selector-layout';\nimport type { ListItem, TagMeta } from '../types';\nimport { VirtualizedList } from '../virtualized-list';\n\nconst FavoriteOperation = ({ tag }: { tag: ListItem }) => {\n  const t = useI18n();\n  const favoriteService = useService(FavoriteService);\n  const isFavorite = useLiveData(\n    favoriteService.favoriteList.isFavorite$('tag', tag.id)\n  );\n\n  const onToggleFavoriteCollection = useCallback(() => {\n    favoriteService.favoriteList.toggle('tag', tag.id);\n    toast(\n      isFavorite\n        ? t['com.affine.toastMessage.removedFavorites']()\n        : t['com.affine.toastMessage.addedFavorites']()\n    );\n  }, [favoriteService.favoriteList, tag.id, isFavorite, t]);\n\n  return (\n    <FavoriteTag\n      style={{ marginRight: 8 }}\n      onClick={onToggleFavoriteCollection}\n      active={isFavorite}\n    />\n  );\n};\n\nexport const SelectTag = ({\n  init = [],\n  onConfirm,\n  onCancel,\n}: BaseSelectorDialogProps<string[]>) => {\n  const t = useI18n();\n\n  const workspace = useService(WorkspaceService).workspace;\n  const tagList = useService(TagService).tagList;\n\n  const [selection, setSelection] = useState(init);\n  const [keyword, setKeyword] = useState('');\n  const tagMetas: TagMeta[] = useLiveData(tagList.tagMetas$);\n\n  const filteredTagMetas = useMemo(() => {\n    return tagMetas.filter(tag => {\n      const reg = new RegExp(keyword, 'i');\n      return reg.test(tag.title);\n    });\n  }, [keyword, tagMetas]);\n\n  const tagItemRenderer = useCallback((item: ListItem) => {\n    return <TagListItemRenderer {...item} />;\n  }, []);\n\n  const tagOperationRenderer = useCallback((item: ListItem) => {\n    return <FavoriteOperation tag={item} />;\n  }, []);\n\n  const tagHeaderRenderer = useCallback(() => {\n    return <ListTableHeader headerCols={tagHeaderColsDef} />;\n  }, []);\n\n  return (\n    <SelectorLayout\n      searchPlaceholder={t['com.affine.selector-tag.search.placeholder']()}\n      selectedCount={selection.length}\n      onSearch={setKeyword}\n      onConfirm={() => onConfirm?.(selection)}\n      onCancel={onCancel}\n      onClear={() => setSelection([])}\n    >\n      <VirtualizedList\n        selectable={true}\n        draggable={false}\n        selectedIds={selection}\n        onSelectedIdsChange={setSelection}\n        items={filteredTagMetas}\n        docCollection={workspace.docCollection}\n        itemRenderer={tagItemRenderer}\n        operationsRenderer={tagOperationRenderer}\n        headerRenderer={tagHeaderRenderer}\n      />\n    </SelectorLayout>\n  );\n};\n","import { Button } from '@affine/component';\nimport { useI18n } from '@affine/i18n';\n\nimport * as styles from './tag-list-header.css';\n\nexport const TagListHeader = ({ onOpen }: { onOpen: () => void }) => {\n  const t = useI18n();\n  return (\n    <div className={styles.tagListHeader}>\n      <div className={styles.tagListHeaderTitle}>{t['Tags']()}</div>\n      <Button\n        className={styles.newTagButton}\n        onClick={onOpen}\n        data-testid=\"all-tags-new-button\"\n      >\n        {t['com.affine.tags.empty.new-tag-button']()}\n      </Button>\n    </div>\n  );\n};\n","import \"../core/src/components/page-list/tags/tag-list-header.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/page-list/tags/tag-list-header.css.ts.vanilla.css\\\",\\\"source\\\":\\\"LmpyeXM0dzAgewogIGhlaWdodDogMTAwcHg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBwYWRkaW5nOiA0OHB4IDE2cHggMjBweCAyNHB4OwogIG92ZXJmbG93OiBoaWRkZW47CiAgZGlzcGxheTogZmxleDsKICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47CiAgYmFja2dyb3VuZDogdmFyKC0tYWZmaW5lLWJhY2tncm91bmQtcHJpbWFyeS1jb2xvcik7Cn0KLmpyeXM0dzEgewogIGZvbnQtc2l6ZTogdmFyKC0tYWZmaW5lLWZvbnQtaC01KTsKICBmb250LXdlaWdodDogNTAwOwogIGNvbG9yOiB2YXIoLS1hZmZpbmUtdGV4dC1zZWNvbmRhcnktY29sb3IpOwogIGRpc3BsYXk6IGZsZXg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBnYXA6IDhweDsKICB1c2VyLXNlbGVjdDogbm9uZTsKfQouanJ5czR3MiB7CiAgcGFkZGluZzogNnB4IDEwcHg7CiAgYm9yZGVyLXJhZGl1czogOHB4OwogIGJhY2tncm91bmQ6IHZhcigtLWFmZmluZS1iYWNrZ3JvdW5kLXByaW1hcnktY29sb3IpOwogIGZvbnQtc2l6ZTogdmFyKC0tYWZmaW5lLWZvbnQteHMpOwogIGZvbnQtd2VpZ2h0OiA1MDA7CiAgaGVpZ2h0OiAyOHB4Owp9\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var newTagButton = 'jrys4w2';\nexport var tagListHeader = 'jrys4w0';\nexport var tagListHeaderTitle = 'jrys4w1';","import type { Tag } from '@affine/core/modules/tag';\nimport { Trans } from '@affine/i18n';\nimport { useService, WorkspaceService } from '@toeverything/infra';\nimport { useCallback, useMemo, useRef, useState } from 'react';\n\nimport { ListFloatingToolbar } from '../components/list-floating-toolbar';\nimport { tagHeaderColsDef } from '../header-col-def';\nimport { TagOperationCell } from '../operation-cell';\nimport { TagListItemRenderer } from '../page-group';\nimport { ListTableHeader } from '../page-header';\nimport type { ItemListHandle, ListItem, TagMeta } from '../types';\nimport { VirtualizedList } from '../virtualized-list';\nimport { CreateOrEditTag } from './create-tag';\nimport { TagListHeader } from './tag-list-header';\n\nexport const VirtualizedTagList = ({\n  tags,\n  tagMetas,\n  onTagDelete,\n}: {\n  tags: Tag[];\n  tagMetas: TagMeta[];\n  onTagDelete: (tagIds: string[]) => void;\n}) => {\n  const listRef = useRef<ItemListHandle>(null);\n  const [showFloatingToolbar, setShowFloatingToolbar] = useState(false);\n  const [showCreateTagInput, setShowCreateTagInput] = useState(false);\n  const [selectedTagIds, setSelectedTagIds] = useState<string[]>([]);\n  const currentWorkspace = useService(WorkspaceService).workspace;\n\n  const tagOperations = useCallback(\n    (tag: TagMeta) => {\n      return <TagOperationCell tag={tag} onTagDelete={onTagDelete} />;\n    },\n    [onTagDelete]\n  );\n\n  const filteredSelectedTagIds = useMemo(() => {\n    const ids = tags.map(tag => tag.id);\n    return selectedTagIds.filter(id => ids.includes(id));\n  }, [selectedTagIds, tags]);\n\n  const hideFloatingToolbar = useCallback(() => {\n    listRef.current?.toggleSelectable();\n  }, []);\n\n  const tagOperationRenderer = useCallback(\n    (item: ListItem) => {\n      const tag = item as TagMeta;\n      return tagOperations(tag);\n    },\n    [tagOperations]\n  );\n\n  const tagHeaderRenderer = useCallback(() => {\n    return (\n      <>\n        <ListTableHeader headerCols={tagHeaderColsDef} />\n        <CreateOrEditTag\n          open={showCreateTagInput}\n          onOpenChange={setShowCreateTagInput}\n        />\n      </>\n    );\n  }, [showCreateTagInput]);\n\n  const tagItemRenderer = useCallback((item: ListItem) => {\n    return <TagListItemRenderer {...item} />;\n  }, []);\n\n  const handleDelete = useCallback(() => {\n    if (selectedTagIds.length === 0) {\n      return;\n    }\n    onTagDelete(selectedTagIds);\n    hideFloatingToolbar();\n    return;\n  }, [hideFloatingToolbar, onTagDelete, selectedTagIds]);\n\n  const onOpenCreate = useCallback(() => {\n    setShowCreateTagInput(true);\n  }, [setShowCreateTagInput]);\n\n  return (\n    <>\n      <VirtualizedList\n        ref={listRef}\n        selectable=\"toggle\"\n        draggable={true}\n        atTopThreshold={80}\n        onSelectionActiveChange={setShowFloatingToolbar}\n        heading={<TagListHeader onOpen={onOpenCreate} />}\n        selectedIds={filteredSelectedTagIds}\n        onSelectedIdsChange={setSelectedTagIds}\n        items={tagMetas}\n        itemRenderer={tagItemRenderer}\n        rowAsLink\n        docCollection={currentWorkspace.docCollection}\n        operationsRenderer={tagOperationRenderer}\n        headerRenderer={tagHeaderRenderer}\n      />\n      <ListFloatingToolbar\n        open={showFloatingToolbar}\n        content={\n          <Trans\n            i18nKey=\"com.affine.tag.toolbar.selected\"\n            count={selectedTagIds.length}\n          >\n            <div style={{ color: 'var(--affine-text-secondary-color)' }}>\n              {{ count: selectedTagIds.length } as any}\n            </div>\n            selected\n          </Trans>\n        }\n        onClose={hideFloatingToolbar}\n        onDelete={handleDelete}\n      />\n    </>\n  );\n};\n","import \"../core/src/components/page-list/tags/tag-list-item.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/page-list/tags/tag-list-item.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACsVWbW/bIBD+nl+BKlVqpBI5r0uJtv8xTdNE4GyzYLAAN+mm/ffJYCfYsZu1qrRv8eW4e+65hztmP+Zb6Q5PIkG/JwhxYUtJXwhKJZx2E4SYltoQ9EzNA8Y0TYUC7ODkcGlEQc0L9g7T2jUHkeWOoPWq9EfrENjmRqgDQUltOQrucoLmSXJff1IpMoWFg8ISZJ0Bx/La7gxVVjihFUF7yg6Z0ZXiIRNKZgv7iHRJmXAv/qs+op/BpFIfCcoF56A89MrYGjuHlFbSBQBSYpZTlQFpY+wmfyazMwskr0N5Lvqpeyx4x3P5cYxvnDqKmRTsQPcSPjtTwXcfsoVUaqEcmM6xufdoSVytA4l7bTgYbCgXla2pC+arPnW4ZBCixzWMo8epkBL4NKSrW0Z5zWTHvwBVNf94x4KecNPO5aYBVQjV2hbBFpW38OWVum2sAUmdeIYQzGRCYQmpIwhvQ7SWiVYtunJSKCBIaeVPlZRzobLm2DbkC9xzQ7Ms4v6Cguwh1QZCN7RyoBxBd3e7Dja6t1pWzmdxuiRoHSB4YabaFCT8lNTB1we8Tu49JwFIrPRVt5TmM9Z3+GtE1TcUWErKINeSRzq8Uswi5GxCn+FF9yBAeIzvw00WvXxiLs/d6uebj8aLjEJlVzl82Avs2fq9gYZgLhuYrVyHQF8uNPqCSCqMdZjlQvKg5I765pue3P0ZSQePmIBh2zuyjJ0IWr/tpme0bMdDFHM1PNVHYlxP7FQrh634BT3peXuOl93Jt/6HbCGHo8bt4mqThsLOZGFUsof6/iOMNqvyNG1B+g4hdMyFA2xLyvxYOBpa1ubKgsEWJDDXTosI5CYIa2BhvFqsLaZnn2Ojok2SvALDr8lLHpBSlFbYCyMWZBrT39PHqtfLT6PAR5e0BaYV767pV6vcUwvTYSl8TJVRPdu3afO2EoeJEEyruPxeYRGgp48DdLKjeEYbE92F3gpsF2zn/RQBp/8X+MDYqC21QmKl9OuLCti/qYCflXUirRE0+9unA8Vv9Jd9XBamZVUo7IfuZvi5GyUO47/dNb1HQfv9blwDVwvihD0xbQcfls0L56qIvz+nlA4gDAAA\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var actionsCellWrapper = '_18ltk9ib';\nexport var dateCell = '_18ltk9ia';\nexport var dndCell = '_18ltk9i2';\nexport var dragPageItemOverlay = '_18ltk9i1';\nexport var iconCell = '_18ltk9i8';\nexport var operationsCell = '_18ltk9ic';\nexport var root = '_18ltk9i0';\nexport var selectionCell = '_18ltk9i4';\nexport var tagIndicator = '_18ltk9ie';\nexport var tagIndicatorWrapper = '_18ltk9id';\nexport var tagsCell = '_18ltk9i9';\nexport var titleCell = '_18ltk9i5';\nexport var titleCellMain = '_18ltk9i6';\nexport var titleCellPreview = '_18ltk9i7';\nexport var titleIconsWrapper = '_18ltk9i3';","import { Checkbox, useDraggable } from '@affine/component';\nimport { WorkbenchLink } from '@affine/core/modules/workbench';\nimport type { AffineDNDData } from '@affine/core/types/dnd';\nimport { stopPropagation } from '@affine/core/utils';\nimport { useI18n } from '@affine/i18n';\nimport type { ForwardedRef, PropsWithChildren } from 'react';\nimport { forwardRef, useCallback, useMemo } from 'react';\n\nimport { selectionStateAtom, useAtom } from '../scoped-atoms';\nimport type { TagListItemProps } from '../types';\nimport { ColWrapper } from '../utils';\nimport * as styles from './tag-list-item.css';\n\nconst TagListTitleCell = ({\n  title,\n  pageCount,\n}: Pick<TagListItemProps, 'title' | 'pageCount'>) => {\n  const t = useI18n();\n  return (\n    <div data-testid=\"tag-list-item-title\" className={styles.titleCell}>\n      <div\n        data-testid=\"tag-list-item-title-text\"\n        className={styles.titleCellMain}\n      >\n        {title || t['Untitled']()}\n      </div>\n      <div\n        data-testid=\"page-list-item-preview-text\"\n        className={styles.titleCellPreview}\n      >\n        {`  ${t['com.affine.tags.count']({ count: pageCount || 0 })}`}\n      </div>\n    </div>\n  );\n};\n\nconst ListIconCell = ({ color }: Pick<TagListItemProps, 'color'>) => {\n  return (\n    <div className={styles.tagIndicatorWrapper}>\n      <div\n        className={styles.tagIndicator}\n        style={{\n          backgroundColor: color,\n        }}\n      />\n    </div>\n  );\n};\n\nconst TagSelectionCell = ({\n  selectable,\n  onSelectedChange,\n  selected,\n}: Pick<TagListItemProps, 'selectable' | 'onSelectedChange' | 'selected'>) => {\n  const onSelectionChange = useCallback(\n    (_event: React.ChangeEvent<HTMLInputElement>) => {\n      return onSelectedChange?.();\n    },\n    [onSelectedChange]\n  );\n  if (!selectable) {\n    return null;\n  }\n  return (\n    <div className={styles.selectionCell}>\n      <Checkbox\n        onClick={stopPropagation}\n        checked={!!selected}\n        onChange={onSelectionChange}\n      />\n    </div>\n  );\n};\n\nconst TagListOperationsCell = ({\n  operations,\n}: Pick<TagListItemProps, 'operations'>) => {\n  return operations ? (\n    <div onClick={stopPropagation} className={styles.operationsCell}>\n      {operations}\n    </div>\n  ) : null;\n};\n\nexport const TagListItem = (props: TagListItemProps) => {\n  const { dragRef, CustomDragPreview, dragging } = useDraggable<AffineDNDData>(\n    () => ({\n      canDrag: props.draggable,\n      data: {\n        entity: {\n          type: 'tag',\n          id: props.tagId,\n        },\n        from: {\n          at: 'all-tags:list',\n        },\n      },\n    }),\n    [props.draggable, props.tagId]\n  );\n\n  return (\n    <>\n      <TagListItemWrapper\n        onClick={props.onClick}\n        to={props.to}\n        tagId={props.tagId}\n        draggable={props.draggable}\n        isDragging={dragging}\n        ref={dragRef}\n      >\n        <ColWrapper flex={9}>\n          <ColWrapper className={styles.dndCell} flex={8}>\n            <div className={styles.titleIconsWrapper}>\n              <TagSelectionCell\n                onSelectedChange={props.onSelectedChange}\n                selectable={props.selectable}\n                selected={props.selected}\n              />\n              <ListIconCell color={props.color} />\n            </div>\n            <TagListTitleCell title={props.title} pageCount={props.pageCount} />\n          </ColWrapper>\n          <ColWrapper\n            flex={4}\n            alignment=\"end\"\n            style={{ overflow: 'visible' }}\n          ></ColWrapper>\n        </ColWrapper>\n        {props.operations ? (\n          <ColWrapper\n            className={styles.actionsCellWrapper}\n            flex={2}\n            alignment=\"end\"\n          >\n            <TagListOperationsCell operations={props.operations} />\n          </ColWrapper>\n        ) : null}\n      </TagListItemWrapper>\n      <CustomDragPreview position=\"pointer-outside\">\n        <div className={styles.dragPageItemOverlay}>\n          <div className={styles.titleIconsWrapper}>\n            <TagSelectionCell\n              onSelectedChange={props.onSelectedChange}\n              selectable={props.selectable}\n              selected={props.selected}\n            />\n            <ListIconCell color={props.color} />\n          </div>\n          <TagListTitleCell title={props.title} pageCount={props.pageCount} />\n        </div>\n      </CustomDragPreview>\n    </>\n  );\n};\n\ntype TagListWrapperProps = PropsWithChildren<\n  Pick<TagListItemProps, 'to' | 'tagId' | 'onClick' | 'draggable'> & {\n    isDragging: boolean;\n  }\n>;\n\nconst TagListItemWrapper = forwardRef(\n  (\n    {\n      to,\n      isDragging,\n      tagId,\n      onClick,\n      children,\n      draggable,\n    }: TagListWrapperProps,\n    ref: ForwardedRef<HTMLAnchorElement & HTMLDivElement>\n  ) => {\n    const [selectionState, setSelectionActive] = useAtom(selectionStateAtom);\n    const handleClick = useCallback(\n      (e: React.MouseEvent) => {\n        if (!selectionState.selectable) {\n          return;\n        }\n        if (e.shiftKey) {\n          stopPropagation(e);\n          setSelectionActive(true);\n          onClick?.();\n          return;\n        }\n        if (selectionState.selectionActive) {\n          return onClick?.();\n        }\n      },\n      [\n        onClick,\n        selectionState.selectable,\n        selectionState.selectionActive,\n        setSelectionActive,\n      ]\n    );\n\n    const commonProps = useMemo(\n      () => ({\n        'data-testid': 'tag-list-item',\n        'data-tag-id': tagId,\n        'data-draggable': draggable,\n        className: styles.root,\n        'data-clickable': !!onClick || !!to,\n        'data-dragging': isDragging,\n        onClick: handleClick,\n      }),\n      [tagId, draggable, isDragging, onClick, to, handleClick]\n    );\n\n    if (to) {\n      return (\n        <WorkbenchLink {...commonProps} to={to} ref={ref}>\n          {children}\n        </WorkbenchLink>\n      );\n    } else {\n      return (\n        <div {...commonProps} ref={ref}>\n          {children}\n        </div>\n      );\n    }\n  }\n);\nTagListItemWrapper.displayName = 'TagListItemWrapper';\n","import { useService, WorkspaceService } from '@toeverything/infra';\nimport { useAtom } from 'jotai';\nimport { atomWithStorage } from 'jotai/utils';\nimport { useCallback } from 'react';\n\nimport type {\n  DisplayProperties,\n  PageDisplayProperties,\n  PageGroupByType,\n} from './types';\n\nexport const displayPropertiesAtom = atomWithStorage<{\n  [workspaceId: string]: DisplayProperties;\n}>('allDocDisplayProperties', {});\n\nconst defaultProps: DisplayProperties = {\n  groupBy: 'updatedDate',\n  displayProperties: {\n    bodyNotes: true,\n    tags: true,\n    createDate: true,\n    updatedDate: true,\n  },\n};\n\nexport const useAllDocDisplayProperties = (): [\n  DisplayProperties,\n  (\n    key: keyof DisplayProperties,\n    value: PageGroupByType | PageDisplayProperties\n  ) => void,\n] => {\n  const workspace = useService(WorkspaceService).workspace;\n  const [properties, setProperties] = useAtom(displayPropertiesAtom);\n\n  const workspaceProperties = properties[workspace.id] || defaultProps;\n\n  const onChange = useCallback(\n    (\n      key: keyof DisplayProperties,\n      value: PageGroupByType | PageDisplayProperties\n    ) => {\n      setProperties(prev => ({\n        ...prev,\n        [workspace.id]: {\n          ...(prev[workspace.id] || defaultProps),\n          [key]: value,\n        },\n      }));\n    },\n    [setProperties, workspace.id]\n  );\n\n  return [workspaceProperties, onChange];\n};\n","import type { Collection, Filter, VariableMap } from '@affine/env/filter';\nimport type { DocMeta } from '@blocksuite/store';\n\nimport { evalFilterList } from './filter';\n\nexport const createEmptyCollection = (\n  id: string,\n  data?: Partial<Omit<Collection, 'id'>>\n): Collection => {\n  return {\n    id,\n    name: '',\n    filterList: [],\n    allowList: [],\n    ...data,\n  };\n};\n\nexport const filterByFilterList = (filterList: Filter[], varMap: VariableMap) =>\n  evalFilterList(filterList, varMap);\n\nexport type PageDataForFilter = {\n  meta: DocMeta;\n  favorite: boolean;\n  publicMode: undefined | 'page' | 'edgeless';\n};\n\nexport const filterPage = (collection: Collection, page: PageDataForFilter) => {\n  if (collection.filterList.length === 0) {\n    return collection.allowList.includes(page.meta.id);\n  }\n  return filterPageByRules(collection.filterList, collection.allowList, page);\n};\nexport const filterPageByRules = (\n  rules: Filter[],\n  allowList: string[],\n  { meta, publicMode, favorite }: PageDataForFilter\n) => {\n  if (allowList?.includes(meta.id)) {\n    return true;\n  }\n  return filterByFilterList(rules, {\n    'Is Favourited': !!favorite,\n    'Is Public': !!publicMode,\n    Created: meta.createDate,\n    Updated: meta.updatedDate ?? meta.createDate,\n    Tags: meta.tags,\n  });\n};\n","import clsx from 'clsx';\nimport { forwardRef } from 'react';\n\nimport * as styles from './list.css';\nimport type { ColWrapperProps } from './types';\n\nexport const ColWrapper = forwardRef<HTMLDivElement, ColWrapperProps>(\n  function ColWrapper(\n    {\n      flex,\n      alignment,\n      hideInSmallContainer,\n      hidden,\n      className,\n      style,\n      children,\n      ...rest\n    }: ColWrapperProps,\n    ref\n  ) {\n    return (\n      <div\n        {...rest}\n        ref={ref}\n        data-testid=\"page-list-flex-wrapper\"\n        style={{\n          ...style,\n          flexGrow: flex,\n          flexBasis: flex ? `${(flex / 12) * 100}%` : 'auto',\n          justifyContent: alignment,\n        }}\n        data-hide-item={hideInSmallContainer ? true : undefined}\n        className={clsx(className, styles.colWrapper, {\n          [styles.hidden]: hidden,\n          [styles.hideInSmallContainer]: hideInSmallContainer,\n        })}\n      >\n        {children}\n      </div>\n    );\n  }\n);\n\nexport const withinDaysAgo = (date: Date, days: number): boolean => {\n  const startDate = new Date();\n  const day = startDate.getDate();\n  const month = startDate.getMonth();\n  const year = startDate.getFullYear();\n  return new Date(year, month, day - days + 1) <= date;\n};\n\nexport const betweenDaysAgo = (\n  date: Date,\n  days0: number,\n  days1: number\n): boolean => {\n  return !withinDaysAgo(date, days0) && withinDaysAgo(date, days1);\n};\n\n// credit: https://github.com/facebook/fbjs/blob/main/packages/fbjs/src/core/shallowEqual.js\nexport function shallowEqual(objA: any, objB: any) {\n  if (Object.is(objA, objB)) {\n    return true;\n  }\n\n  if (\n    typeof objA !== 'object' ||\n    objA === null ||\n    typeof objB !== 'object' ||\n    objB === null\n  ) {\n    return false;\n  }\n\n  const keysA = Object.keys(objA);\n  const keysB = Object.keys(objB);\n\n  if (keysA.length !== keysB.length) {\n    return false;\n  }\n\n  // Test for A's keys different from B.\n  for (const key of keysA) {\n    if (\n      !Object.prototype.hasOwnProperty.call(objB, key) ||\n      !Object.is(objA[key], objB[key])\n    ) {\n      return false;\n    }\n  }\n\n  return true;\n}\n","import type React from 'react';\n\nexport const AffineShapeIcon = (props: React.SVGProps<SVGSVGElement>) => (\n  <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    viewBox=\"0 0 800 695\"\n    fill=\"none\"\n    width={200}\n    {...props}\n  >\n    <rect\n      x=\"206.896\"\n      y=\"154.635\"\n      width=\"386.207\"\n      height=\"386.207\"\n      stroke=\"currentColor\"\n      strokeWidth=\"3\"\n    />\n    <path\n      d=\"M207.336 347.738L400 155.074L592.664 347.738L400 540.402L207.336 347.738Z\"\n      stroke=\"currentColor\"\n      strokeWidth=\"3\"\n    />\n    <path\n      d=\"M398.421 153.574C430.649 134.691 468.171 123.866 508.222 123.866C628.347 123.866 725.729 221.247 725.729 341.372C725.729 430.974 671.549 507.921 594.163 541.241\"\n      stroke=\"currentColor\"\n      strokeWidth=\"3\"\n    />\n    <path\n      d=\"M593.501 346.677C612.385 378.905 623.21 416.427 623.21 456.478C623.21 576.603 525.829 673.984 405.703 673.984C316.101 673.984 239.154 619.805 205.835 542.419\"\n      stroke=\"currentColor\"\n      strokeWidth=\"3\"\n    />\n    <path\n      d=\"M401.578 541.24C369.35 560.123 331.828 570.948 291.777 570.948C171.651 570.948 74.2704 473.567 74.2704 353.441C74.2704 263.84 128.45 186.892 205.835 153.573\"\n      stroke=\"currentColor\"\n      strokeWidth=\"3\"\n    />\n    <path\n      d=\"M205.834 349.315C186.951 317.088 176.126 279.565 176.126 239.515C176.126 119.389 273.507 22.0086 393.633 22.0086C483.235 22.0085 560.182 76.188 593.501 153.573\"\n      stroke=\"currentColor\"\n      strokeWidth=\"3\"\n    />\n    <path\n      d=\"M205.835 153.574L594.164 541.903\"\n      stroke=\"currentColor\"\n      strokeWidth=\"3\"\n    />\n    <path\n      d=\"M594.164 153.574L205.835 541.903\"\n      stroke=\"currentColor\"\n      strokeWidth=\"3\"\n    />\n    <path d=\"M399.999 153.574V541.903\" stroke=\"currentColor\" strokeWidth=\"3\" />\n    <path\n      d=\"M594.164 347.738L205.835 347.738\"\n      stroke=\"currentColor\"\n      strokeWidth=\"3\"\n    />\n    <ellipse\n      cx=\"593.102\"\n      cy=\"154.635\"\n      rx=\"15.9151\"\n      ry=\"15.9151\"\n      fill=\"currentColor\"\n    />\n    <ellipse\n      cx=\"593.102\"\n      cy=\"540.842\"\n      rx=\"15.9151\"\n      ry=\"15.9151\"\n      fill=\"currentColor\"\n    />\n    <ellipse\n      cx=\"593.102\"\n      cy=\"347.738\"\n      rx=\"15.9151\"\n      ry=\"15.9151\"\n      fill=\"currentColor\"\n    />\n    <ellipse\n      cx=\"206.896\"\n      cy=\"154.635\"\n      rx=\"15.9151\"\n      ry=\"15.9151\"\n      fill=\"currentColor\"\n    />\n    <ellipse\n      cx=\"206.896\"\n      cy=\"540.842\"\n      rx=\"15.9151\"\n      ry=\"15.9151\"\n      fill=\"currentColor\"\n    />\n    <ellipse\n      cx=\"206.896\"\n      cy=\"347.738\"\n      rx=\"15.9151\"\n      ry=\"15.9151\"\n      fill=\"currentColor\"\n    />\n    <ellipse\n      cx=\"400\"\n      cy=\"154.635\"\n      rx=\"15.9151\"\n      ry=\"15.9151\"\n      transform=\"rotate(-90 400 154.635)\"\n      fill=\"currentColor\"\n    />\n    <ellipse\n      cx=\"400\"\n      cy=\"345.616\"\n      rx=\"15.9151\"\n      ry=\"15.9151\"\n      transform=\"rotate(-90 400 345.616)\"\n      fill=\"currentColor\"\n    />\n    <ellipse\n      cx=\"400\"\n      cy=\"540.842\"\n      rx=\"15.9151\"\n      ry=\"15.9151\"\n      transform=\"rotate(-90 400 540.842)\"\n      fill=\"currentColor\"\n    />\n  </svg>\n);\n","import { Button, Input, Modal } from '@affine/component';\nimport { useCatchEventCallback } from '@affine/core/hooks/use-catch-event-hook';\nimport { useI18n } from '@affine/i18n';\nimport type { KeyboardEvent } from 'react';\nimport { useCallback, useMemo, useState } from 'react';\n\nimport * as styles from './create-collection.css';\n\nexport interface CreateCollectionModalProps {\n  title?: string;\n  onConfirmText?: string;\n  init: string;\n  onConfirm: (title: string) => void;\n  open: boolean;\n  showTips?: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\nexport const CreateCollectionModal = ({\n  init,\n  onConfirm,\n  open,\n  showTips,\n  onOpenChange,\n  title,\n}: CreateCollectionModalProps) => {\n  const t = useI18n();\n  const onConfirmTitle = useCallback(\n    (title: string) => {\n      onConfirm(title);\n      onOpenChange(false);\n    },\n    [onConfirm, onOpenChange]\n  );\n  const onCancel = useCallback(() => {\n    onOpenChange(false);\n  }, [onOpenChange]);\n\n  return (\n    <Modal open={open} title={title} onOpenChange={onOpenChange} width={480}>\n      {init != null ? (\n        <CreateCollection\n          showTips={showTips}\n          onConfirmText={t['com.affine.editCollection.save']()}\n          init={init}\n          onConfirm={onConfirmTitle}\n          onCancel={onCancel}\n        />\n      ) : null}\n    </Modal>\n  );\n};\n\nexport interface CreateCollectionProps {\n  onConfirmText?: string;\n  init: string;\n  showTips?: boolean;\n  onCancel: () => void;\n  onConfirm: (title: string) => void;\n}\n\nexport const CreateCollection = ({\n  onConfirmText,\n  init,\n  showTips,\n  onCancel,\n  onConfirm,\n}: CreateCollectionProps) => {\n  const t = useI18n();\n  const [value, onChange] = useState(init);\n  const isNameEmpty = useMemo(() => value.trim().length === 0, [value]);\n  const save = useCallback(() => {\n    if (isNameEmpty) {\n      return;\n    }\n    onConfirm(value);\n  }, [onConfirm, value, isNameEmpty]);\n  const onKeyDown = useCatchEventCallback(\n    (e: KeyboardEvent<HTMLInputElement>) => {\n      if (e.key === 'Escape') {\n        if (isNameEmpty) {\n          return;\n        } else {\n          e.currentTarget.blur();\n        }\n      }\n    },\n    [isNameEmpty]\n  );\n  return (\n    <div data-testid=\"edit-collection-modal\">\n      <div className={styles.content}>\n        <div className={styles.label}>\n          {t['com.affine.editCollectionName.name']()}\n        </div>\n        <Input\n          autoFocus\n          value={value}\n          data-testid=\"input-collection-title\"\n          placeholder={t['com.affine.editCollectionName.name.placeholder']()}\n          onChange={useCallback((value: string) => onChange(value), [onChange])}\n          onEnter={save}\n          onKeyDown={onKeyDown}\n        ></Input>\n        {showTips ? (\n          <div className={styles.createTips}>\n            {t['com.affine.editCollectionName.createTips']()}\n          </div>\n        ) : null}\n      </div>\n      <div className={styles.footer}>\n        <Button size=\"large\" onClick={onCancel}>\n          {t['com.affine.editCollection.button.cancel']()}\n        </Button>\n        <Button\n          size=\"large\"\n          data-testid=\"save-collection\"\n          variant=\"primary\"\n          disabled={isNameEmpty}\n          onClick={save}\n        >\n          {onConfirmText ?? t['com.affine.editCollection.button.create']()}\n        </Button>\n      </div>\n    </div>\n  );\n};\n","import \"../core/src/components/page-list/view/create-collection.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/page-list/view/create-collection.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xeWxpdXl4MCB7CiAgZGlzcGxheTogZmxleDsKICBqdXN0aWZ5LWNvbnRlbnQ6IGZsZXgtZW5kOwogIHBhZGRpbmctdG9wOiAyMHB4OwogIGdhcDogMjBweDsKfQouXzF5bGl1eXgxIHsKICBjb2xvcjogdmFyKC0tYWZmaW5lLXRleHQtc2Vjb25kYXJ5LWNvbG9yKTsKICBmb250LXNpemU6IDEycHg7CiAgbGluZS1oZWlnaHQ6IDIwcHg7Cn0KLl8xeWxpdXl4MiB7CiAgY29sb3I6IHZhcigtLWFmZmluZS10ZXh0LXNlY29uZGFyeS1jb2xvcik7CiAgZm9udC1zaXplOiAxNHB4OwogIGxpbmUtaGVpZ2h0OiAyMnB4Owp9Ci5fMXlsaXV5eDMgewogIGRpc3BsYXk6IGZsZXg7CiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICBnYXA6IDhweDsKICBwYWRkaW5nOiAxMnB4IDBweCAyMHB4OwogIG1hcmdpbi1ib3R0b206IDhweDsKfQ==\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var content = '_1yliuyx3';\nexport var createTips = '_1yliuyx1';\nexport var footer = '_1yliuyx0';\nexport var label = '_1yliuyx2';","import { toast } from '@affine/component';\nimport type { AllPageListConfig } from '@affine/core/components/page-list';\nimport { FavoriteTag } from '@affine/core/components/page-list';\nimport { useBlockSuiteDocMeta } from '@affine/core/hooks/use-block-suite-page-meta';\nimport { CompatibleFavoriteItemsAdapter } from '@affine/core/modules/properties';\nimport { ShareDocsService } from '@affine/core/modules/share-doc';\nimport { PublicPageMode } from '@affine/graphql';\nimport { useI18n } from '@affine/i18n';\nimport type { DocMeta } from '@blocksuite/store';\nimport { useLiveData, useService, WorkspaceService } from '@toeverything/infra';\nimport { useCallback, useEffect, useMemo } from 'react';\n\nimport { usePageHelper } from '../../components/blocksuite/block-suite-page-list/utils';\n\n/**\n * @deprecated very poor performance\n */\nexport const useAllPageListConfig = () => {\n  const currentWorkspace = useService(WorkspaceService).workspace;\n  const shareDocService = useService(ShareDocsService);\n  const shareDocs = useLiveData(shareDocService.shareDocs?.list$);\n\n  useEffect(() => {\n    // TODO(@eyhn): loading & error UI\n    shareDocService.shareDocs?.revalidate();\n  }, [shareDocService]);\n\n  const workspace = currentWorkspace.docCollection;\n  const pageMetas = useBlockSuiteDocMeta(workspace);\n  const { isPreferredEdgeless } = usePageHelper(workspace);\n  const pageMap = useMemo(\n    () => Object.fromEntries(pageMetas.map(page => [page.id, page])),\n    [pageMetas]\n  );\n  const favAdapter = useService(CompatibleFavoriteItemsAdapter);\n  const t = useI18n();\n  const favoriteItems = useLiveData(favAdapter.favorites$);\n\n  const isActive = useCallback(\n    (page: DocMeta) => {\n      return favoriteItems.some(fav => fav.id === page.id);\n    },\n    [favoriteItems]\n  );\n  const onToggleFavoritePage = useCallback(\n    (page: DocMeta) => {\n      const status = isActive(page);\n      favAdapter.toggle(page.id, 'doc');\n      toast(\n        status\n          ? t['com.affine.toastMessage.removedFavorites']()\n          : t['com.affine.toastMessage.addedFavorites']()\n      );\n    },\n    [favAdapter, isActive, t]\n  );\n\n  return useMemo<AllPageListConfig>(() => {\n    return {\n      allPages: pageMetas,\n      isEdgeless: isPreferredEdgeless,\n      getPublicMode(id) {\n        const mode = shareDocs?.find(shareDoc => shareDoc.id === id)?.mode;\n        if (mode === PublicPageMode.Edgeless) {\n          return 'edgeless';\n        } else if (mode === PublicPageMode.Page) {\n          return 'page';\n        } else {\n          return undefined;\n        }\n      },\n      docCollection: currentWorkspace.docCollection,\n      getPage: id => pageMap[id],\n      favoriteRender: page => {\n        return (\n          <FavoriteTag\n            style={{ marginRight: 8 }}\n            onClick={() => onToggleFavoritePage(page)}\n            active={isActive(page)}\n          />\n        );\n      },\n    };\n  }, [\n    pageMetas,\n    isPreferredEdgeless,\n    currentWorkspace.docCollection,\n    shareDocs,\n    pageMap,\n    isActive,\n    onToggleFavoritePage,\n  ]);\n};\n","import { Button, IconButton, Tooltip } from '@affine/component';\nimport { CompatibleFavoriteItemsAdapter } from '@affine/core/modules/properties';\nimport type { Collection } from '@affine/env/filter';\nimport { Trans, useI18n } from '@affine/i18n';\nimport {\n  CloseIcon,\n  EdgelessIcon,\n  PageIcon,\n  ToggleCollapseIcon,\n} from '@blocksuite/icons/rc';\nimport type { DocMeta } from '@blocksuite/store';\nimport { useLiveData, useService } from '@toeverything/infra';\nimport { cssVar } from '@toeverything/theme';\nimport clsx from 'clsx';\nimport type { ReactNode } from 'react';\nimport { useCallback, useMemo, useState } from 'react';\n\nimport { FilterList } from '../../filter';\nimport { List, ListScrollContainer } from '../../list';\nimport type { ListItem } from '../../types';\nimport { filterPageByRules } from '../../use-collection-manager';\nimport { AffineShapeIcon } from '../affine-shape';\nimport type { AllPageListConfig } from './edit-collection';\nimport * as styles from './edit-collection.css';\n\nexport const RulesMode = ({\n  collection,\n  updateCollection,\n  reset,\n  buttons,\n  switchMode,\n  allPageListConfig,\n}: {\n  collection: Collection;\n  updateCollection: (collection: Collection) => void;\n  reset: () => void;\n  buttons: ReactNode;\n  switchMode: ReactNode;\n  allPageListConfig: AllPageListConfig;\n}) => {\n  const t = useI18n();\n  const [showPreview, setShowPreview] = useState(true);\n  const allowListPages: DocMeta[] = [];\n  const rulesPages: DocMeta[] = [];\n  const favAdapter = useService(CompatibleFavoriteItemsAdapter);\n  const favorites = useLiveData(favAdapter.favorites$);\n  allPageListConfig.allPages.forEach(meta => {\n    if (meta.trash) {\n      return;\n    }\n    const pageData = {\n      meta,\n      publicMode: allPageListConfig.getPublicMode(meta.id),\n      favorite: favorites.some(f => f.id === meta.id),\n    };\n    if (\n      collection.filterList.length &&\n      filterPageByRules(collection.filterList, [], pageData)\n    ) {\n      rulesPages.push(meta);\n    }\n    if (collection.allowList.includes(meta.id)) {\n      allowListPages.push(meta);\n    }\n  });\n  const [expandInclude, setExpandInclude] = useState(\n    collection.allowList.length > 0\n  );\n  const operationsRenderer = useCallback(\n    (item: ListItem) => {\n      const page = item as DocMeta;\n      return allPageListConfig.favoriteRender(page);\n    },\n    [allPageListConfig]\n  );\n\n  const tips = useMemo(\n    () => (\n      <Trans\n        i18nKey=\"com.affine.editCollection.rules.tips\"\n        values={{\n          highlight: t['com.affine.editCollection.rules.tips.highlight'](),\n        }}\n        components={{\n          2: <span className={styles.rulesTitleHighlight} />,\n        }}\n      />\n    ),\n    [t]\n  );\n\n  return (\n    <>\n      {/*prevents modal autofocus to the first input*/}\n      <input\n        type=\"text\"\n        style={{ width: 0, height: 0 }}\n        onFocus={e => requestAnimationFrame(() => e.target.blur())}\n      />\n      <Tooltip content={tips}>\n        <div className={clsx(styles.rulesTitle, styles.ellipsis)}>{tips}</div>\n      </Tooltip>\n\n      <div className={styles.rulesContainer}>\n        <div className={styles.rulesContainerLeft}>\n          <div className={styles.rulesContainerLeftTab}>{switchMode}</div>\n          <div className={styles.rulesContainerLeftContent}>\n            <div\n              style={{\n                flex: 1,\n                display: 'flex',\n                flexDirection: 'column',\n                gap: 8,\n                overflowY: 'auto',\n              }}\n            >\n              <FilterList\n                propertiesMeta={allPageListConfig.docCollection.meta.properties}\n                value={collection.filterList}\n                onChange={useCallback(\n                  filterList => updateCollection({ ...collection, filterList }),\n                  [collection, updateCollection]\n                )}\n              />\n              <div className={styles.rulesContainerLeftContentInclude}>\n                {collection.allowList.length > 0 ? (\n                  <div className={styles.includeTitle}>\n                    <IconButton\n                      onClick={() => setExpandInclude(!expandInclude)}\n                      iconStyle={{\n                        transform: expandInclude ? 'rotate(90deg)' : undefined,\n                      }}\n                      icon={<ToggleCollapseIcon />}\n                    />\n                    <div style={{ color: cssVar('textSecondaryColor') }}>\n                      {t['com.affine.editCollection.rules.include.title']()}\n                    </div>\n                  </div>\n                ) : null}\n                <div\n                  style={{\n                    display: expandInclude ? 'flex' : 'none',\n                    flexWrap: 'wrap',\n                    gap: '8px 16px',\n                  }}\n                >\n                  {collection.allowList.map(id => {\n                    const page = allPageListConfig.allPages.find(\n                      v => v.id === id\n                    );\n                    return (\n                      <div className={styles.includeItem} key={id}>\n                        <div className={styles.includeItemContent}>\n                          <div\n                            style={{\n                              display: 'flex',\n                              gap: 6,\n                              alignItems: 'center',\n                            }}\n                          >\n                            {allPageListConfig.isEdgeless(id) ? (\n                              <EdgelessIcon style={{ width: 16, height: 16 }} />\n                            ) : (\n                              <PageIcon style={{ width: 16, height: 16 }} />\n                            )}\n                            {t[\n                              'com.affine.editCollection.rules.include.page'\n                            ]()}\n                          </div>\n                          <div className={styles.includeItemContentIs}>\n                            {t['com.affine.editCollection.rules.include.is']()}\n                          </div>\n                          <div\n                            className={clsx(\n                              styles.includeItemTitle,\n                              styles.ellipsis\n                            )}\n                          >\n                            {page?.title || t['Untitled']()}\n                          </div>\n                        </div>\n                        <IconButton\n                          size=\"14\"\n                          icon={<CloseIcon />}\n                          onClick={() => {\n                            updateCollection({\n                              ...collection,\n                              allowList: collection.allowList.filter(\n                                v => v !== id\n                              ),\n                            });\n                          }}\n                        />\n                      </div>\n                    );\n                  })}\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n        <ListScrollContainer\n          className={styles.rulesContainerRight}\n          style={{\n            display: showPreview ? 'flex' : 'none',\n          }}\n        >\n          {rulesPages.length > 0 ? (\n            <List\n              hideHeader\n              className={styles.resultPages}\n              items={rulesPages}\n              docCollection={allPageListConfig.docCollection}\n              isPreferredEdgeless={allPageListConfig.isEdgeless}\n              operationsRenderer={operationsRenderer}\n            ></List>\n          ) : (\n            <RulesEmpty\n              noRules={collection.filterList.length === 0}\n              fullHeight={allowListPages.length === 0}\n            />\n          )}\n          {allowListPages.length > 0 ? (\n            <div>\n              <div className={styles.includeListTitle}>\n                {t['com.affine.editCollection.rules.include.title']()}\n              </div>\n              <List\n                hideHeader\n                className={styles.resultPages}\n                items={allowListPages}\n                docCollection={allPageListConfig.docCollection}\n                isPreferredEdgeless={allPageListConfig.isEdgeless}\n                operationsRenderer={operationsRenderer}\n              ></List>\n            </div>\n          ) : null}\n        </ListScrollContainer>\n      </div>\n      <div className={styles.rulesBottom}>\n        <div className={styles.bottomLeft}>\n          <Button\n            onClick={() => {\n              setShowPreview(!showPreview);\n            }}\n          >\n            {t['com.affine.editCollection.rules.preview']()}\n          </Button>\n          <Button variant=\"plain\" onClick={reset}>\n            {t['com.affine.editCollection.rules.reset']()}\n          </Button>\n          <div className={styles.previewCountTips}>\n            <Trans\n              i18nKey=\"com.affine.editCollection.rules.countTips\"\n              values={{\n                selectedCount: allowListPages.length,\n                filteredCount: rulesPages.length,\n              }}\n            >\n              Selected\n              <span className={styles.previewCountTipsHighlight}>count</span>,\n              filtered\n              <span className={styles.previewCountTipsHighlight}>count</span>\n            </Trans>\n          </div>\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 20 }}>\n          {buttons}\n        </div>\n      </div>\n    </>\n  );\n};\nconst RulesEmpty = ({\n  noRules,\n  fullHeight,\n}: {\n  noRules: boolean;\n  fullHeight: boolean;\n}) => {\n  const t = useI18n();\n  return (\n    <div\n      style={{\n        height: fullHeight ? '100%' : '70%',\n        display: 'flex',\n        flexDirection: 'column',\n        alignItems: 'center',\n        justifyContent: 'center',\n        gap: 18,\n        padding: '48px 0',\n      }}\n    >\n      <AffineShapeIcon />\n      <strong style={{ fontSize: 20, lineHeight: '28px' }}>\n        {noRules\n          ? t['com.affine.editCollection.rules.empty.noRules']()\n          : t['com.affine.editCollection.rules.empty.noResults']()}\n      </strong>\n      <div\n        style={{\n          width: '389px',\n          textAlign: 'center',\n          fontSize: 15,\n          lineHeight: '24px',\n        }}\n      >\n        {noRules ? (\n          <Trans i18nKey=\"com.affine.editCollection.rules.empty.noRules.tips\">\n            Please <strong>add rules</strong> to save this collection or switch\n            to <strong>Pages</strong>, use manual selection mode\n          </Trans>\n        ) : (\n          t['com.affine.editCollection.rules.empty.noResults.tips']()\n        )}\n      </div>\n    </div>\n  );\n};\n","import { Button, Modal, RadioGroup } from '@affine/component';\nimport { useAllPageListConfig } from '@affine/core/hooks/affine/use-all-page-list-config';\nimport type { Collection } from '@affine/env/filter';\nimport { useI18n } from '@affine/i18n';\nimport type { DocCollection, DocMeta } from '@blocksuite/store';\nimport type { DialogContentProps } from '@radix-ui/react-dialog';\nimport type { ReactNode } from 'react';\nimport { useCallback, useMemo, useState } from 'react';\n\nimport * as styles from './edit-collection.css';\nimport { RulesMode } from './rules-mode';\nimport { SelectPage } from './select-page';\n\nexport type EditCollectionMode = 'page' | 'rule';\n\nexport interface EditCollectionModalProps {\n  init?: Collection;\n  title?: string;\n  open: boolean;\n  mode?: EditCollectionMode;\n  onOpenChange: (open: boolean) => void;\n  onConfirm: (view: Collection) => void;\n}\n\nconst contentOptions: DialogContentProps = {\n  style: {\n    padding: 0,\n    maxWidth: 944,\n    backgroundColor: 'var(--affine-background-primary-color)',\n  },\n};\nexport const EditCollectionModal = ({\n  init,\n  onConfirm,\n  open,\n  onOpenChange,\n  title,\n  mode,\n}: EditCollectionModalProps) => {\n  const t = useI18n();\n  const onConfirmOnCollection = useCallback(\n    (view: Collection) => {\n      onConfirm(view);\n      onOpenChange(false);\n    },\n    [onConfirm, onOpenChange]\n  );\n  const onCancel = useCallback(() => {\n    onOpenChange(false);\n  }, [onOpenChange]);\n\n  if (!(open && init)) {\n    return null;\n  }\n\n  return (\n    <Modal\n      open={open}\n      onOpenChange={onOpenChange}\n      withoutCloseButton\n      width=\"calc(100% - 64px)\"\n      height=\"80%\"\n      contentOptions={contentOptions}\n      persistent\n    >\n      <EditCollection\n        title={title}\n        onConfirmText={t['com.affine.editCollection.save']()}\n        init={init}\n        mode={mode}\n        onCancel={onCancel}\n        onConfirm={onConfirmOnCollection}\n      />\n    </Modal>\n  );\n};\n\nexport interface EditCollectionProps {\n  title?: string;\n  onConfirmText?: string;\n  init: Collection;\n  mode?: EditCollectionMode;\n  onCancel: () => void;\n  onConfirm: (collection: Collection) => void;\n}\n\nexport const EditCollection = ({\n  init,\n  onConfirm,\n  onCancel,\n  onConfirmText,\n  mode: initMode,\n}: EditCollectionProps) => {\n  const t = useI18n();\n  const config = useAllPageListConfig();\n  const [value, onChange] = useState<Collection>(init);\n  const [mode, setMode] = useState<'page' | 'rule'>(\n    initMode ?? (init.filterList.length === 0 ? 'page' : 'rule')\n  );\n  const isNameEmpty = useMemo(() => value.name.trim().length === 0, [value]);\n  const onSaveCollection = useCallback(() => {\n    if (!isNameEmpty) {\n      onConfirm(value);\n    }\n  }, [value, isNameEmpty, onConfirm]);\n  const reset = useCallback(() => {\n    onChange({\n      ...value,\n      filterList: init.filterList,\n      allowList: init.allowList,\n    });\n  }, [init.allowList, init.filterList, value]);\n  const onIdsChange = useCallback(\n    (ids: string[]) => {\n      onChange({ ...value, allowList: ids });\n    },\n    [value]\n  );\n  const buttons = useMemo(\n    () => (\n      <>\n        <Button onClick={onCancel} className={styles.actionButton}>\n          {t['com.affine.editCollection.button.cancel']()}\n        </Button>\n        <Button\n          className={styles.actionButton}\n          data-testid=\"save-collection\"\n          variant=\"primary\"\n          disabled={isNameEmpty}\n          onClick={onSaveCollection}\n        >\n          {onConfirmText ?? t['com.affine.editCollection.button.create']()}\n        </Button>\n      </>\n    ),\n    [onCancel, t, isNameEmpty, onSaveCollection, onConfirmText]\n  );\n  const switchMode = useMemo(\n    () => (\n      <RadioGroup\n        key=\"mode-switcher\"\n        style={{ minWidth: 158 }}\n        value={mode}\n        onChange={setMode}\n        items={[\n          {\n            value: 'page',\n            label: t['com.affine.editCollection.pages'](),\n            testId: 'edit-collection-pages-button',\n          },\n          {\n            value: 'rule',\n            label: t['com.affine.editCollection.rules'](),\n            testId: 'edit-collection-rules-button',\n          },\n        ]}\n      />\n    ),\n    [mode, t]\n  );\n  return (\n    <div\n      onKeyDown={e => {\n        if (e.key === 'Escape') {\n          return;\n        }\n        e.stopPropagation();\n      }}\n      className={styles.collectionEditContainer}\n    >\n      {mode === 'page' ? (\n        <SelectPage\n          init={value.allowList}\n          onChange={onIdsChange}\n          header={switchMode}\n          buttons={buttons}\n        />\n      ) : (\n        <RulesMode\n          allPageListConfig={config}\n          collection={value}\n          switchMode={switchMode}\n          reset={reset}\n          updateCollection={onChange}\n          buttons={buttons}\n        />\n      )}\n    </div>\n  );\n};\n\nexport type AllPageListConfig = {\n  allPages: DocMeta[];\n  docCollection: DocCollection;\n  isEdgeless: (id: string) => boolean;\n  /**\n   * Return `undefined` if the page is not public\n   */\n  getPublicMode: (id: string) => undefined | 'page' | 'edgeless';\n  getPage: (id: string) => DocMeta | undefined;\n  favoriteRender: (page: DocMeta) => ReactNode;\n};\n","import type { Filter } from '@affine/env/filter';\nimport type { MouseEvent } from 'react';\nimport { useCallback, useState } from 'react';\n\nimport type { PageDataForFilter } from '../../use-collection-manager';\nimport { filterPageByRules } from '../../use-collection-manager';\n\nexport const useFilter = (list: PageDataForFilter[]) => {\n  const [filters, changeFilters] = useState<Filter[]>([]);\n  const [showFilter, setShowFilter] = useState(false);\n  const clickFilter = useCallback(\n    (e: MouseEvent) => {\n      if (showFilter || filters.length !== 0) {\n        e.stopPropagation();\n        e.preventDefault();\n        setShowFilter(!showFilter);\n      }\n    },\n    [filters.length, showFilter]\n  );\n  const onCreateFilter = useCallback(\n    (filter: Filter) => {\n      changeFilters([...filters, filter]);\n      setShowFilter(true);\n    },\n    [filters]\n  );\n  return {\n    showFilter,\n    filters,\n    updateFilters: changeFilters,\n    clickFilter,\n    createFilter: onCreateFilter,\n    filteredList: list\n      .filter(pageData => {\n        if (pageData.meta.trash) {\n          return false;\n        }\n        return filterPageByRules(filters, [], pageData);\n      })\n      .map(pageData => pageData.meta),\n  };\n};\n","import type { DocMeta } from '@blocksuite/store';\nimport { useState } from 'react';\n\nexport const useSearch = (list: DocMeta[]) => {\n  const [value, onChange] = useState('');\n  return {\n    searchText: value,\n    updateSearchText: onChange,\n    searchedList: value\n      ? list.filter(v => v.title.toLowerCase().includes(value.toLowerCase()))\n      : list,\n  };\n};\n","import { IconButton, Menu, toast } from '@affine/component';\nimport { useBlockSuiteDocMeta } from '@affine/core/hooks/use-block-suite-page-meta';\nimport { CompatibleFavoriteItemsAdapter } from '@affine/core/modules/properties';\nimport { ShareDocsService } from '@affine/core/modules/share-doc';\nimport { PublicPageMode } from '@affine/graphql';\nimport { Trans, useI18n } from '@affine/i18n';\nimport { FilterIcon } from '@blocksuite/icons/rc';\nimport type { DocMeta } from '@blocksuite/store';\nimport {\n  DocsService,\n  useLiveData,\n  useServices,\n  WorkspaceService,\n} from '@toeverything/infra';\nimport { type ReactNode, useCallback, useEffect, useState } from 'react';\n\nimport { FavoriteTag } from '../../components/favorite-tag';\nimport { FilterList } from '../../filter';\nimport { VariableSelect } from '../../filter/vars';\nimport { usePageHeaderColsDef } from '../../header-col-def';\nimport { PageListItemRenderer } from '../../page-group';\nimport { ListTableHeader } from '../../page-header';\nimport type { BaseSelectorDialogProps } from '../../selector';\nimport { SelectorLayout } from '../../selector/selector-layout';\nimport type { ListItem } from '../../types';\nimport { VirtualizedList } from '../../virtualized-list';\nimport { AffineShapeIcon } from '../affine-shape';\nimport * as styles from './edit-collection.css';\nimport { useFilter } from './use-filter';\nimport { useSearch } from './use-search';\n\nexport const SelectPage = ({\n  init = [],\n  onConfirm,\n  onCancel,\n  onChange: propsOnChange,\n  header,\n  buttons,\n}: {\n  onChange?: (values: string[]) => void;\n  confirmText?: ReactNode;\n  header?: ReactNode;\n  buttons?: ReactNode;\n} & BaseSelectorDialogProps<string[]>) => {\n  const t = useI18n();\n  const [value, setValue] = useState(init);\n  const onChange = useCallback(\n    (value: string[]) => {\n      propsOnChange?.(value);\n      setValue(value);\n    },\n    [propsOnChange]\n  );\n  const confirm = useCallback(() => {\n    onConfirm?.(value);\n  }, [value, onConfirm]);\n  const clearSelected = useCallback(() => {\n    onChange([]);\n  }, [onChange]);\n  const {\n    workspaceService,\n    compatibleFavoriteItemsAdapter,\n    shareDocsService,\n    docsService,\n  } = useServices({\n    DocsService,\n    ShareDocsService,\n    WorkspaceService,\n    CompatibleFavoriteItemsAdapter,\n  });\n  const shareDocs = useLiveData(shareDocsService.shareDocs?.list$);\n  const workspace = workspaceService.workspace;\n  const docCollection = workspace.docCollection;\n  const pageMetas = useBlockSuiteDocMeta(docCollection);\n  const favourites = useLiveData(compatibleFavoriteItemsAdapter.favorites$);\n\n  useEffect(() => {\n    shareDocsService.shareDocs?.revalidate();\n  }, [shareDocsService.shareDocs]);\n\n  const getPublicMode = useCallback(\n    (id: string) => {\n      const mode = shareDocs?.find(shareDoc => shareDoc.id === id)?.mode;\n      if (mode === PublicPageMode.Edgeless) {\n        return 'edgeless';\n      } else if (mode === PublicPageMode.Page) {\n        return 'page';\n      } else {\n        return undefined;\n      }\n    },\n    [shareDocs]\n  );\n\n  const isFavorite = useCallback(\n    (meta: DocMeta) => favourites.some(fav => fav.id === meta.id),\n    [favourites]\n  );\n\n  const isEdgeless = useCallback(\n    (id: string) => {\n      return docsService.list.doc$(id).value?.mode$.value === 'edgeless';\n    },\n    [docsService.list]\n  );\n\n  const onToggleFavoritePage = useCallback(\n    (page: DocMeta) => {\n      const status = isFavorite(page);\n      compatibleFavoriteItemsAdapter.toggle(page.id, 'doc');\n      toast(\n        status\n          ? t['com.affine.toastMessage.removedFavorites']()\n          : t['com.affine.toastMessage.addedFavorites']()\n      );\n    },\n    [compatibleFavoriteItemsAdapter, isFavorite, t]\n  );\n\n  const pageHeaderColsDef = usePageHeaderColsDef();\n  const {\n    clickFilter,\n    createFilter,\n    filters,\n    showFilter,\n    updateFilters,\n    filteredList,\n  } = useFilter(\n    pageMetas.map(meta => ({\n      meta,\n      publicMode: getPublicMode(meta.id),\n      favorite: isFavorite(meta),\n    }))\n  );\n  const { searchText, updateSearchText, searchedList } =\n    useSearch(filteredList);\n\n  const operationsRenderer = useCallback(\n    (item: ListItem) => {\n      const page = item as DocMeta;\n      return (\n        <FavoriteTag\n          style={{ marginRight: 8 }}\n          onClick={() => onToggleFavoritePage(page)}\n          active={isFavorite(page)}\n        />\n      );\n    },\n    [isFavorite, onToggleFavoritePage]\n  );\n\n  const pageHeaderRenderer = useCallback(() => {\n    return <ListTableHeader headerCols={pageHeaderColsDef} />;\n  }, [pageHeaderColsDef]);\n\n  const pageItemRenderer = useCallback((item: ListItem) => {\n    return <PageListItemRenderer {...item} />;\n  }, []);\n\n  return (\n    <SelectorLayout\n      searchPlaceholder={t['com.affine.editCollection.search.placeholder']()}\n      selectedCount={value.length}\n      onSearch={updateSearchText}\n      onClear={clearSelected}\n      onCancel={onCancel}\n      onConfirm={confirm}\n      actions={buttons}\n    >\n      <div className={styles.pagesTab}>\n        <div className={styles.pagesTabContent}>\n          {header ?? (\n            <div style={{ fontSize: 12, lineHeight: '20px', fontWeight: 600 }}>\n              {t['com.affine.selectPage.title']()}\n            </div>\n          )}\n          {!showFilter && filters.length === 0 ? (\n            <Menu\n              items={\n                <VariableSelect\n                  propertiesMeta={docCollection.meta.properties}\n                  selected={filters}\n                  onSelect={createFilter}\n                />\n              }\n            >\n              <IconButton icon={<FilterIcon />} onClick={clickFilter} />\n            </Menu>\n          ) : (\n            <IconButton icon={<FilterIcon />} onClick={clickFilter} />\n          )}\n        </div>\n        {showFilter ? (\n          <div style={{ padding: '12px 16px 16px' }}>\n            <FilterList\n              propertiesMeta={docCollection.meta.properties}\n              value={filters}\n              onChange={updateFilters}\n            />\n          </div>\n        ) : null}\n        {searchedList.length ? (\n          <VirtualizedList\n            className={styles.pageList}\n            items={searchedList}\n            docCollection={docCollection}\n            selectable\n            onSelectedIdsChange={onChange}\n            selectedIds={value}\n            isPreferredEdgeless={isEdgeless}\n            operationsRenderer={operationsRenderer}\n            itemRenderer={pageItemRenderer}\n            headerRenderer={pageHeaderRenderer}\n          />\n        ) : (\n          <EmptyList search={searchText} />\n        )}\n      </div>\n    </SelectorLayout>\n  );\n};\nexport const EmptyList = ({ search }: { search?: string }) => {\n  const t = useI18n();\n  return (\n    <div\n      style={{\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        flexDirection: 'column',\n        flex: 1,\n      }}\n    >\n      <AffineShapeIcon />\n      <div\n        style={{\n          margin: '18px 0',\n          fontSize: 20,\n          lineHeight: '28px',\n          fontWeight: 600,\n        }}\n      >\n        {t['com.affine.selectPage.empty']()}\n      </div>\n      {search ? (\n        <div\n          className={styles.ellipsis}\n          style={{ maxWidth: 300, fontSize: 15, lineHeight: '24px' }}\n        >\n          <Trans i18nKey=\"com.affine.selectPage.empty.tips\" values={{ search }}>\n            No page titles contain\n            <span\n              style={{ fontWeight: 600, color: 'var(--affine-primary-color)' }}\n            >\n              search\n            </span>\n          </Trans>\n        </div>\n      ) : null}\n    </div>\n  );\n};\n","import { Button, FlexWrapper, Menu } from '@affine/component';\nimport type { Filter, PropertiesMeta } from '@affine/env/filter';\nimport { useI18n } from '@affine/i18n';\nimport { FilterIcon } from '@blocksuite/icons/rc';\n\nimport { CreateFilterMenu } from '../filter/vars';\nimport * as styles from './collection-list.css';\n\nexport const AllPageListOperationsMenu = ({\n  propertiesMeta,\n  filterList,\n  onChangeFilterList,\n}: {\n  propertiesMeta: PropertiesMeta;\n  filterList: Filter[];\n  onChangeFilterList: (filterList: Filter[]) => void;\n}) => {\n  const t = useI18n();\n\n  return (\n    <FlexWrapper alignItems=\"center\">\n      <Menu\n        items={\n          <CreateFilterMenu\n            propertiesMeta={propertiesMeta}\n            value={filterList}\n            onChange={onChangeFilterList}\n          />\n        }\n      >\n        <Button\n          className={styles.filterMenuTrigger}\n          prefix={<FilterIcon />}\n          data-testid=\"create-first-filter\"\n        >\n          {t['com.affine.filter']()}\n        </Button>\n      </Menu>\n    </FlexWrapper>\n  );\n};\n","import \"../core/src/components/page-list/view/collection-list.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/page-list/view/collection-list.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xdDZtemN6MCB7CiAgbWFyZ2luLWxlZnQ6IDEycHg7CiAgbWFyZ2luLXRvcDogMTBweDsKICBmb250LXNpemU6IHZhcigtLWFmZmluZS1mb250LXhzKTsKICBjb2xvcjogdmFyKC0tYWZmaW5lLXRleHQtc2Vjb25kYXJ5LWNvbG9yKTsKfQouXzF0Nm16Y3oxIHsKICBtYXJnaW4tdG9wOiAycHg7CiAgbWFyZ2luLWJvdHRvbTogMnB4OwogIG1hcmdpbi1sZWZ0OiAxMnB4OwogIG1hcmdpbi1yaWdodDogOHB4OwogIGhlaWdodDogMXB4OwogIGJhY2tncm91bmQ6IHZhcigtLWFmZmluZS1ib3JkZXItY29sb3IpOwp9Ci5fMXQ2bXpjejMgewogIGJvcmRlci1yYWRpdXM6IDhweDsKICBkaXNwbGF5OiBmbGV4OwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgbWFyZ2luLWxlZnQ6IDZweDsKICB3aWR0aDogMjRweDsKICBoZWlnaHQ6IDI0cHg7CiAgb3BhY2l0eTogMDsKfQouXzF0Nm16Y3ozOmhvdmVyIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1hZmZpbmUtaG92ZXItY29sb3IpOwp9Ci5fMXQ2bXpjejI6aG92ZXIgLl8xdDZtemN6MyB7CiAgb3BhY2l0eTogMTsKfQouXzF0Nm16Y3o0IHsKICBwYWRkaW5nOiA2cHggOHB4Owp9Ci5fMXQ2bXpjejRbZGF0YS1pcy1oaWRkZW49InRydWUiXSB7CiAgZGlzcGxheTogbm9uZTsKfQ==\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var filterMenuTrigger = '_1t6mzcz4';\nexport var menuDividerStyle = '_1t6mzcz1';\nexport var menuTitleStyle = '_1t6mzcz0';\nexport var viewMenu = '_1t6mzcz2';\nexport var viewOption = '_1t6mzcz3';","import { Button } from '@affine/component';\nimport type { Collection } from '@affine/env/filter';\nimport { useI18n } from '@affine/i18n';\nimport { SaveIcon } from '@blocksuite/icons/rc';\nimport { nanoid } from 'nanoid';\nimport { useCallback } from 'react';\n\nimport { createEmptyCollection } from '../use-collection-manager';\nimport * as styles from './save-as-collection-button.css';\nimport { useEditCollectionName } from './use-edit-collection';\n\ninterface SaveAsCollectionButtonProps {\n  onConfirm: (collection: Collection) => void;\n}\n\nexport const SaveAsCollectionButton = ({\n  onConfirm,\n}: SaveAsCollectionButtonProps) => {\n  const t = useI18n();\n  const { open, node } = useEditCollectionName({\n    title: t['com.affine.editCollection.saveCollection'](),\n    showTips: true,\n  });\n  const handleClick = useCallback(() => {\n    open('')\n      .then(name => {\n        return onConfirm(createEmptyCollection(nanoid(), { name }));\n      })\n      .catch(err => {\n        console.error(err);\n      });\n  }, [open, onConfirm]);\n  return (\n    <>\n      <Button\n        onClick={handleClick}\n        data-testid=\"save-as-collection\"\n        prefix={<SaveIcon />}\n        className={styles.button}\n      >\n        {t['com.affine.editCollection.saveCollection']()}\n      </Button>\n      {node}\n    </>\n  );\n};\n","import \"../core/src/components/page-list/view/save-as-collection-button.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/page-list/view/save-as-collection-button.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xMnl5OWJ6MCB7CiAgcGFkZGluZzogNnB4IDEwcHg7CiAgYm9yZGVyLXJhZGl1czogOHB4OwogIGJhY2tncm91bmQ6IHZhcigtLWFmZmluZS1iYWNrZ3JvdW5kLXByaW1hcnktY29sb3IpOwogIGZvbnQtc2l6ZTogdmFyKC0tYWZmaW5lLWZvbnQteHMpOwogIGZvbnQtd2VpZ2h0OiA1MDA7CiAgaGVpZ2h0OiAyOHB4Owp9\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var button = '_12yy9bz0';","import type { Collection } from '@affine/env/filter';\nimport { useCallback, useState } from 'react';\n\nimport { CreateCollectionModal } from './create-collection';\nimport type { EditCollectionMode } from './edit-collection/edit-collection';\nimport { EditCollectionModal } from './edit-collection/edit-collection';\n\nexport const useEditCollection = () => {\n  const [data, setData] = useState<{\n    collection: Collection;\n    mode?: 'page' | 'rule';\n    onConfirm: (collection: Collection) => void;\n  }>();\n  const close = useCallback((open: boolean) => {\n    if (!open) {\n      setData(undefined);\n    }\n  }, []);\n\n  return {\n    node: (\n      <EditCollectionModal\n        init={data?.collection}\n        open={!!data}\n        mode={data?.mode}\n        onOpenChange={close}\n        onConfirm={data?.onConfirm ?? (() => {})}\n      />\n    ),\n    open: (\n      collection: Collection,\n      mode?: EditCollectionMode\n    ): Promise<Collection> =>\n      new Promise<Collection>(res => {\n        setData({\n          collection,\n          mode,\n          onConfirm: collection => {\n            res(collection);\n          },\n        });\n      }),\n  };\n};\n\nexport const useEditCollectionName = ({\n  title,\n  showTips,\n}: {\n  title: string;\n  showTips?: boolean;\n}) => {\n  const [data, setData] = useState<{\n    name: string;\n    onConfirm: (name: string) => void;\n  }>();\n  const close = useCallback((open: boolean) => {\n    if (!open) {\n      setData(undefined);\n    }\n  }, []);\n\n  return {\n    node: (\n      <CreateCollectionModal\n        showTips={showTips}\n        title={title}\n        init={data?.name ?? ''}\n        open={!!data}\n        onOpenChange={close}\n        onConfirm={data?.onConfirm ?? (() => {})}\n      />\n    ),\n    open: (name: string): Promise<string> =>\n      new Promise<string>(res => {\n        setData({\n          name,\n          onConfirm: collection => {\n            res(collection);\n          },\n        });\n      }),\n  };\n};\n","import { Scrollable } from '@affine/component';\nimport clsx from 'clsx';\nimport { selectAtom } from 'jotai/utils';\nimport type { HTMLAttributes, PropsWithChildren } from 'react';\nimport { forwardRef, useCallback, useMemo, useState } from 'react';\nimport { Virtuoso } from 'react-virtuoso';\n\nimport { ListInnerWrapper } from './list';\nimport * as styles from './list.css';\nimport { ItemGroupHeader } from './page-group';\nimport {\n  groupCollapseStateAtom,\n  groupsAtom,\n  listPropsAtom,\n  ListProvider,\n  useAtomValue,\n} from './scoped-atoms';\nimport type {\n  ItemGroupProps,\n  ItemListHandle,\n  ListItem,\n  VirtualizedListProps,\n} from './types';\n\n// we have three item types for rendering rows in Virtuoso\ntype VirtuosoItemType =\n  | 'sticky-header'\n  | 'group-header'\n  | 'item'\n  | 'item-spacer';\n\ninterface BaseVirtuosoItem {\n  type: VirtuosoItemType;\n}\n\ninterface VirtuosoItemStickyHeader<T> extends BaseVirtuosoItem {\n  type: 'sticky-header';\n  data?: T;\n}\n\ninterface VirtuosoItemItem<T> extends BaseVirtuosoItem {\n  type: 'item';\n  data: T;\n}\n\ninterface VirtuosoItemGroupHeader<T> extends BaseVirtuosoItem {\n  type: 'group-header';\n  data: ItemGroupProps<T>;\n}\n\ninterface VirtuosoPageItemSpacer extends BaseVirtuosoItem {\n  type: 'item-spacer';\n  data: {\n    height: number;\n  };\n}\n\ntype VirtuosoItem<T> =\n  | VirtuosoItemStickyHeader<T>\n  | VirtuosoItemItem<T>\n  | VirtuosoItemGroupHeader<T>\n  | VirtuosoPageItemSpacer;\n\n/**\n * Given a list of pages, render a list of pages\n * Similar to normal PageList, but uses react-virtuoso to render the list (virtual rendering)\n */\nexport const VirtualizedList = forwardRef<\n  ItemListHandle,\n  VirtualizedListProps<ListItem>\n>(function VirtualizedList(props, ref) {\n  return (\n    // push pageListProps to the atom so that downstream components can consume it\n    // this makes sure pageListPropsAtom is always populated\n    <ListProvider initialValues={[[listPropsAtom, props]]}>\n      <ListInnerWrapper {...props} handleRef={ref}>\n        <ListInner {...props} />\n      </ListInnerWrapper>\n    </ListProvider>\n  );\n});\n\nconst headingAtom = selectAtom(listPropsAtom, props => props?.heading);\n\nconst PageListHeading = () => {\n  const heading = useAtomValue(headingAtom);\n  return <div className={styles.heading}>{heading}</div>;\n};\n\nconst useVirtuosoItems = <T extends ListItem>() => {\n  const groups = useAtomValue(groupsAtom);\n  const groupCollapsedState = useAtomValue(groupCollapseStateAtom);\n\n  return useMemo(() => {\n    const items: VirtuosoItem<T>[] = [];\n\n    // 1.\n    // always put sticky header at the top\n    // the visibility of sticky header is inside of PageListTableHeader\n    items.push({\n      type: 'sticky-header',\n    });\n\n    // 2.\n    // iterate groups and add page items\n    for (const group of groups) {\n      // skip empty group header since it will cause issue in virtuoso (\"Zero-sized element\")\n      if (group.label) {\n        items.push({\n          type: 'group-header',\n          data: group as ItemGroupProps<T>,\n        });\n      }\n      // do not render items if the group is collapsed\n      if (!groupCollapsedState[group.id]) {\n        for (const item of group.items) {\n          items.push({\n            type: 'item',\n            data: item as T,\n          });\n          // add a spacer between items (4px), unless it's the last item\n          if (item !== group.items[group.items.length - 1]) {\n            items.push({\n              type: 'item-spacer',\n              data: {\n                height: 4,\n              },\n            });\n          }\n        }\n      }\n\n      // add a spacer between groups (16px)\n      items.push({\n        type: 'item-spacer',\n        data: {\n          height: 16,\n        },\n      });\n    }\n    return items;\n  }, [groupCollapsedState, groups]);\n};\n\nconst Scroller = forwardRef<\n  HTMLDivElement,\n  PropsWithChildren<HTMLAttributes<HTMLDivElement>>\n>(({ children, ...props }, ref) => {\n  return (\n    <Scrollable.Root>\n      <Scrollable.Viewport {...props} ref={ref}>\n        {children}\n      </Scrollable.Viewport>\n      <Scrollable.Scrollbar />\n    </Scrollable.Root>\n  );\n});\n\nScroller.displayName = 'Scroller';\n\nconst ListInner = ({\n  atTopStateChange,\n  atTopThreshold,\n  ...props\n}: VirtualizedListProps<ListItem>) => {\n  const virtuosoItems = useVirtuosoItems<ListItem>();\n  const [atTop, setAtTop] = useState(false);\n  const handleAtTopStateChange = useCallback(\n    (atTop: boolean) => {\n      setAtTop(atTop);\n      atTopStateChange?.(atTop);\n    },\n    [atTopStateChange]\n  );\n  const components = useMemo(() => {\n    return {\n      Header: props.heading ? PageListHeading : undefined,\n      Scroller: Scroller,\n    };\n  }, [props.heading]);\n  const itemContentRenderer = useCallback(\n    (_index: number, data: VirtuosoItem<ListItem>) => {\n      switch (data.type) {\n        case 'sticky-header':\n          return props.headerRenderer?.(data.data);\n        case 'group-header':\n          return <ItemGroupHeader {...data.data} />;\n        case 'item':\n          return props.itemRenderer?.(data.data);\n        case 'item-spacer':\n          return <div style={{ height: data.data.height }} />;\n      }\n    },\n    [props]\n  );\n  return (\n    <Virtuoso<VirtuosoItem<ListItem>>\n      data-has-scroll-top={!atTop}\n      atTopThreshold={atTopThreshold ?? 0}\n      atTopStateChange={handleAtTopStateChange}\n      components={components}\n      data={virtuosoItems}\n      data-testid=\"virtualized-page-list\"\n      data-total-count={props.items.length} // for testing, since we do not know the total count in test\n      topItemCount={1} // sticky header\n      totalCount={virtuosoItems.length}\n      itemContent={itemContentRenderer}\n      className={clsx(props.className, styles.root)}\n      // TODO(@Peng): set a reasonable overscan value to avoid blank space?\n      // overscan={100}\n    />\n  );\n};\n","import \"../core/src/components/pure/workspace-slider-bar/user-with-workspace-list/add-workspace/index.css.ts.vanilla.css!=!../../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/pure/workspace-slider-bar/user-with-workspace-list/add-workspace/index.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xNnoxaTcyMCB7CiAgZGlzcGxheTogZmxleDsKICBhbGlnbi1pdGVtczogY2VudGVyOwogIGp1c3RpZnktY29udGVudDogZmxleC1zdGFydDsKICBwYWRkaW5nOiA4cHggMTRweDsKICBnYXA6IDE0cHg7CiAgY3Vyc29yOiBwb2ludGVyOwogIGJvcmRlci1yYWRpdXM6IDhweDsKICB0cmFuc2l0aW9uOiBiYWNrZ3JvdW5kLWNvbG9yIDAuMnM7CiAgZm9udC1zaXplOiAyNHB4OwogIGNvbG9yOiB2YXIoLS1hZmZpbmUtaWNvbi1zZWNvbmRhcnkpOwp9Ci5fMTZ6MWk3MjEgewogIGZvbnQtc2l6ZTogdmFyKC0tYWZmaW5lLWZvbnQtc20pOwogIGxpbmUtaGVpZ2h0OiAyMnB4OwogIGNvbG9yOiB2YXIoLS1hZmZpbmUtdGV4dC1zZWNvbmRhcnktY29sb3IpOwogIGZvbnQtd2VpZ2h0OiA0MDA7CiAgd2hpdGUtc3BhY2U6IG5vd3JhcDsKICBvdmVyZmxvdzogaGlkZGVuOwogIHRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzOwp9\\\"}!../../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var ItemContainer = '_16z1i720';\nexport var ItemText = '_16z1i721';","import { MenuItem } from '@affine/component/ui/menu';\nimport { useI18n } from '@affine/i18n';\nimport { ImportIcon, PlusIcon } from '@blocksuite/icons/rc';\n\nimport * as styles from './index.css';\n\nexport const AddWorkspace = ({\n  onAddWorkspace,\n  onNewWorkspace,\n}: {\n  onAddWorkspace?: () => void;\n  onNewWorkspace?: () => void;\n}) => {\n  const t = useI18n();\n\n  return (\n    <div>\n      {environment.isDesktop ? (\n        <MenuItem\n          block={true}\n          preFix={<ImportIcon />}\n          onClick={onAddWorkspace}\n          data-testid=\"add-workspace\"\n          className={styles.ItemContainer}\n        >\n          <div className={styles.ItemText}>\n            {t['com.affine.workspace.local.import']()}\n          </div>\n        </MenuItem>\n      ) : null}\n      <MenuItem\n        block={true}\n        preFix={<PlusIcon />}\n        onClick={onNewWorkspace}\n        data-testid=\"new-workspace\"\n        className={styles.ItemContainer}\n      >\n        <div className={styles.ItemText}>\n          {runtimeConfig.allowLocalWorkspace\n            ? t['com.affine.workspaceList.addWorkspace.create']()\n            : t['com.affine.workspaceList.addWorkspace.create-cloud']()}\n        </div>\n      </MenuItem>\n    </div>\n  );\n};\n","import { UserPlanButton } from '../../../../affine/auth/user-plan-button';\nimport * as styles from './index.css';\n\nexport const UserAccountItem = ({\n  email,\n}: {\n  email: string;\n  onEventEnd?: () => void;\n}) => {\n  return (\n    <div className={styles.userAccountContainer}>\n      <div className={styles.leftContainer}>\n        <div className={styles.userEmail}>{email}</div>\n      </div>\n      <UserPlanButton />\n    </div>\n  );\n};\n","import \"../core/src/components/pure/workspace-slider-bar/user-with-workspace-list/user-account/index.css.ts.vanilla.css!=!../../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/pure/workspace-slider-bar/user-with-workspace-list/user-account/index.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Lmx1d3ZlZDAgewogIGRpc3BsYXk6IGZsZXg7CiAgcGFkZGluZzogNHB4IDRweCA0cHggMTJweDsKICBnYXA6IDhweDsKICBhbGlnbi1pdGVtczogY2VudGVyOwogIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsKICB3aWR0aDogMTAwJTsKfQoubHV3dmVkMSB7CiAgZm9udC1zaXplOiB2YXIoLS1hZmZpbmUtZm9udC1zbSk7CiAgZm9udC13ZWlnaHQ6IDQwMDsKICBsaW5lLWhlaWdodDogMjJweDsKICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsKICBvdmVyZmxvdzogaGlkZGVuOwogIHdoaXRlLXNwYWNlOiBub3dyYXA7Cn0KLmx1d3ZlZDIgewogIGRpc3BsYXk6IGZsZXg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBnYXA6IDhweDsKICB3aWR0aDogMTAwJTsKICBvdmVyZmxvdzogaGlkZGVuOwp9\\\"}!../../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var leftContainer = 'luwved2';\nexport var userAccountContainer = 'luwved0';\nexport var userEmail = 'luwved1';","import \"../component/src/components/card/workspace-card/styles.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/components/card/workspace-card/styles.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACp1UXW+bMBR9z6+wKk1aHxxBuk6Jq/2Sqg83+AJ3M7Zlm0A29b9PNoRAadpp4gUd369zzrW3PTXucMjYnw1jHclQC5Zn2ZenDWNF67xxgllDOqCLkAUpSVeC7W3P8p3tI3g0TqLjDiS1XrBvF7TnvgZpOsFIewwsS19uexYcaG/BoQ4xVJK3Cs6ClQpT7s/WByrPvDA6oA7DAfcBXIoHRZXmFLDxghV4GW6Ap5w2No146kaBjBbsCMWvyplWS7bd+UTJXM4cKgh0wsTdqEj9BO4r51CWpJEH7AP3WBgtwcXhlHH3iepUVLylVoEVo1Cvm+0otqjNCV2SfJ66aJZCph7X3GcJATgUcdAfd8G1ePcyVPpA70XlowMt15Xz+QpkcfYoumD5uw7dsGBlnLdQID9i6BD1JMhSj91HnUujA/f0G9/oM+DN/RTTIVV1EOwxSyVUEnHEduOmNtDzy5IfsgG76bR11Cx9jpaUKgpck5QDnxR6PUClyHpKm9XVFJAnBQTTpnNgZ6wfEut/E3ZKekxJ84UGpVi2zR88Q/BpdedCTgKMZN9j0ICrSHOFZRiz/tvt65FV0fdVxudPhTYaP7lTq3dpdbMWao16XCRY0N2vB1gswgDyfHXNF1GD0ftsfp2+p94n8nQkReE8V9xYKBKU3Z59nZ/+FS4K5E+b179IQp3swwUAAA==\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var actionButtons = 'ximr993';\nexport var card = 'ximr990';\nexport var settingButton = 'ximr995';\nexport var settingButtonWrapper = 'ximr994';\nexport var showOnCardHover = 'ximr996';\nexport var workspaceInfo = 'ximr991';\nexport var workspaceTitle = 'ximr992';","import { WorkspaceAvatar } from '@affine/component/workspace-avatar';\nimport { UNTITLED_WORKSPACE_NAME } from '@affine/env/constant';\nimport { WorkspaceFlavour } from '@affine/env/workspace';\nimport { CollaborationIcon, SettingsIcon } from '@blocksuite/icons/rc';\nimport type { WorkspaceMetadata } from '@toeverything/infra';\nimport { type MouseEvent, useCallback } from 'react';\n\nimport { Button } from '../../../ui/button';\nimport { Skeleton } from '../../../ui/skeleton';\nimport * as styles from './styles.css';\n\nexport interface WorkspaceTypeProps {\n  flavour: WorkspaceFlavour;\n  isOwner: boolean;\n}\n\nexport interface WorkspaceCardProps {\n  currentWorkspaceId?: string | null;\n  meta: WorkspaceMetadata;\n  onClick: (metadata: WorkspaceMetadata) => void;\n  onSettingClick: (metadata: WorkspaceMetadata) => void;\n  onEnableCloudClick?: (meta: WorkspaceMetadata) => void;\n  isOwner?: boolean;\n  openingId?: string | null;\n  enableCloudText?: string;\n  name?: string;\n}\n\nexport const WorkspaceCardSkeleton = () => {\n  return (\n    <div>\n      <div className={styles.card} data-testid=\"workspace-card\">\n        <Skeleton variant=\"circular\" width={28} height={28} />\n        <Skeleton\n          variant=\"rectangular\"\n          height={43}\n          width={220}\n          style={{ marginLeft: '12px' }}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport const WorkspaceCard = ({\n  onClick,\n  onSettingClick,\n  onEnableCloudClick,\n  openingId,\n  currentWorkspaceId,\n  meta,\n  isOwner = true,\n  enableCloudText = 'Enable Cloud',\n  name,\n}: WorkspaceCardProps) => {\n  const isLocal = meta.flavour === WorkspaceFlavour.LOCAL;\n  const displayName = name ?? UNTITLED_WORKSPACE_NAME;\n\n  const onEnableCloud = useCallback(\n    (e: MouseEvent) => {\n      e.stopPropagation();\n      onEnableCloudClick?.(meta);\n    },\n    [meta, onEnableCloudClick]\n  );\n  return (\n    <div\n      className={styles.card}\n      data-active={meta.id === currentWorkspaceId}\n      data-testid=\"workspace-card\"\n      onClick={useCallback(() => {\n        onClick(meta);\n      }, [onClick, meta])}\n    >\n      <WorkspaceAvatar\n        key={meta.id}\n        meta={meta}\n        rounded={3}\n        size={28}\n        name={name}\n        colorfulFallback\n      />\n      <div className={styles.workspaceInfo}>\n        <div className={styles.workspaceTitle}>{displayName}</div>\n\n        <div className={styles.actionButtons}>\n          {isLocal ? (\n            <Button\n              loading={!!openingId && openingId === meta.id}\n              disabled={!!openingId}\n              className={styles.showOnCardHover}\n              onClick={onEnableCloud}\n            >\n              {enableCloudText}\n            </Button>\n          ) : null}\n          {isOwner ? null : <CollaborationIcon />}\n          <div\n            className={styles.settingButton}\n            onClick={e => {\n              e.stopPropagation();\n              onSettingClick(meta);\n            }}\n          >\n            <SettingsIcon width={16} height={16} />\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n","import type { WorkspaceMetadata } from '@toeverything/infra';\nimport { Suspense } from 'react';\n\nimport {\n  WorkspaceCard,\n  WorkspaceCardSkeleton,\n} from '../../components/card/workspace-card';\nimport { workspaceItemStyle } from './index.css';\n\nexport interface WorkspaceListProps {\n  disabled?: boolean;\n  currentWorkspaceId?: string | null;\n  items: WorkspaceMetadata[];\n  openingId?: string | null;\n  onClick: (workspace: WorkspaceMetadata) => void;\n  onSettingClick: (workspace: WorkspaceMetadata) => void;\n  onEnableCloudClick?: (meta: WorkspaceMetadata) => void;\n  useIsWorkspaceOwner: (\n    workspaceMetadata: WorkspaceMetadata\n  ) => boolean | undefined;\n  useWorkspaceName: (\n    workspaceMetadata: WorkspaceMetadata\n  ) => string | undefined;\n}\n\ninterface SortableWorkspaceItemProps extends Omit<WorkspaceListProps, 'items'> {\n  item: WorkspaceMetadata;\n}\n\nconst SortableWorkspaceItem = ({\n  item,\n  openingId,\n  useIsWorkspaceOwner,\n  useWorkspaceName,\n  currentWorkspaceId,\n  onClick,\n  onSettingClick,\n  onEnableCloudClick,\n}: SortableWorkspaceItemProps) => {\n  const isOwner = useIsWorkspaceOwner?.(item);\n  const name = useWorkspaceName?.(item);\n  return (\n    <div className={workspaceItemStyle} data-testid=\"draggable-item\">\n      <WorkspaceCard\n        currentWorkspaceId={currentWorkspaceId}\n        meta={item}\n        onClick={onClick}\n        onSettingClick={onSettingClick}\n        onEnableCloudClick={onEnableCloudClick}\n        openingId={openingId}\n        isOwner={isOwner}\n        name={name}\n      />\n    </div>\n  );\n};\n\nexport const WorkspaceList = (props: WorkspaceListProps) => {\n  const workspaceList = props.items;\n\n  return workspaceList.map(item => (\n    <Suspense fallback={<WorkspaceCardSkeleton />} key={item.id}>\n      <SortableWorkspaceItem key={item.id} {...props} item={item} />\n    </Suspense>\n  ));\n};\n","import \"../component/src/components/workspace-list/index.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/components/workspace-list/index.css.ts.vanilla.css\\\",\\\"source\\\":\\\"QG1lZGlhIHNjcmVlbiBhbmQgKG1heC13aWR0aDogNzIwcHgpIHsKICAuXzFyNGFudHEwIHsKICAgIHdpZHRoOiAxMDAlOwogIH0KfQ==\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var workspaceItemStyle = '_1r4antq0';","import \"../core/src/components/pure/workspace-slider-bar/user-with-workspace-list/workspace-list/index.css.ts.vanilla.css!=!../../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/pure/workspace-slider-bar/user-with-workspace-list/workspace-list/index.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Lm42MTVtNTAgewogIGRpc3BsYXk6IGZsZXg7CiAgd2lkdGg6IDEwMCU7CiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICBtYXgtaGVpZ2h0OiBjYWxjKDEwMHZoIC0gMzAwcHgpOwp9Ci5uNjE1bTUxIHsKICBkaXNwbGF5OiBmbGV4OwogIHdpZHRoOiAxMDAlOwogIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgZ2FwOiAycHg7Cn0KLm42MTVtNTIgewogIGRpc3BsYXk6IGZsZXg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBnYXA6IDRweDsKICBwYWRkaW5nOiAwcHggMTJweDsKICBmb250LXdlaWdodDogNTAwOwogIGZvbnQtc2l6ZTogdmFyKC0tYWZmaW5lLWZvbnQteHMpOwogIGxpbmUtaGVpZ2h0OiAyMHB4OwogIGNvbG9yOiB2YXIoLS1hZmZpbmUtdGV4dC1zZWNvbmRhcnktY29sb3IpOwp9Ci5uNjE1bTUzIHsKICBjb2xvcjogdmFyKC0tYWZmaW5lLWljb24tc2Vjb25kYXJ5KTsKfQoubjYxNW01NCB7CiAgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKDhweCk7CiAgd2lkdGg6IDRweDsKfQ==\\\"}!../../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var scrollbar = 'n615m54';\nexport var workspaceListWrapper = 'n615m51';\nexport var workspaceListsWrapper = 'n615m50';\nexport var workspaceType = 'n615m52';\nexport var workspaceTypeIcon = 'n615m53';","import { ScrollableContainer } from '@affine/component';\nimport { Divider } from '@affine/component/ui/divider';\nimport { WorkspaceList } from '@affine/component/workspace-list';\nimport { useEnableCloud } from '@affine/core/hooks/affine/use-enable-cloud';\nimport {\n  useWorkspaceInfo,\n  useWorkspaceName,\n} from '@affine/core/hooks/use-workspace-info';\nimport { AuthService } from '@affine/core/modules/cloud';\nimport { WorkspaceFlavour } from '@affine/env/workspace';\nimport { useI18n } from '@affine/i18n';\nimport { CloudWorkspaceIcon, LocalWorkspaceIcon } from '@blocksuite/icons/rc';\nimport type { WorkspaceMetadata } from '@toeverything/infra';\nimport {\n  GlobalContextService,\n  useLiveData,\n  useService,\n  WorkspacesService,\n} from '@toeverything/infra';\nimport { useSetAtom } from 'jotai';\nimport { useCallback, useMemo } from 'react';\n\nimport {\n  openCreateWorkspaceModalAtom,\n  openSettingModalAtom,\n} from '../../../../../atoms';\nimport { WorkspaceSubPath } from '../../../../../shared';\nimport { useNavigateHelper } from '../.././../../../hooks/use-navigate-helper';\nimport * as styles from './index.css';\n\nfunction useIsWorkspaceOwner(meta: WorkspaceMetadata) {\n  const info = useWorkspaceInfo(meta);\n\n  return info?.isOwner;\n}\n\ninterface WorkspaceModalProps {\n  disabled?: boolean;\n  workspaces: WorkspaceMetadata[];\n  currentWorkspaceId?: string | null;\n  openingId?: string | null;\n  onClickWorkspace: (workspaceMetadata: WorkspaceMetadata) => void;\n  onClickWorkspaceSetting: (workspaceMetadata: WorkspaceMetadata) => void;\n  onClickEnableCloud?: (meta: WorkspaceMetadata) => void;\n  onNewWorkspace: () => void;\n  onAddWorkspace: () => void;\n}\n\nconst CloudWorkSpaceList = ({\n  disabled,\n  workspaces,\n  onClickWorkspace,\n  onClickWorkspaceSetting,\n  currentWorkspaceId,\n}: WorkspaceModalProps) => {\n  const t = useI18n();\n  if (workspaces.length === 0) {\n    return null;\n  }\n  return (\n    <div className={styles.workspaceListWrapper}>\n      <div className={styles.workspaceType}>\n        <CloudWorkspaceIcon\n          width={14}\n          height={14}\n          className={styles.workspaceTypeIcon}\n        />\n        {t['com.affine.workspaceList.workspaceListType.cloud']()}\n      </div>\n      <WorkspaceList\n        disabled={disabled}\n        items={workspaces}\n        currentWorkspaceId={currentWorkspaceId}\n        onClick={onClickWorkspace}\n        onSettingClick={onClickWorkspaceSetting}\n        useIsWorkspaceOwner={useIsWorkspaceOwner}\n        useWorkspaceName={useWorkspaceName}\n      />\n    </div>\n  );\n};\n\nconst LocalWorkspaces = ({\n  disabled,\n  workspaces,\n  onClickWorkspace,\n  onClickWorkspaceSetting,\n  onClickEnableCloud,\n  openingId,\n  currentWorkspaceId,\n}: WorkspaceModalProps) => {\n  const t = useI18n();\n  if (workspaces.length === 0) {\n    return null;\n  }\n  return (\n    <div className={styles.workspaceListWrapper}>\n      <div className={styles.workspaceType}>\n        <LocalWorkspaceIcon\n          width={14}\n          height={14}\n          className={styles.workspaceTypeIcon}\n        />\n        {t['com.affine.workspaceList.workspaceListType.local']()}\n      </div>\n      <WorkspaceList\n        openingId={openingId}\n        disabled={disabled}\n        items={workspaces}\n        currentWorkspaceId={currentWorkspaceId}\n        onClick={onClickWorkspace}\n        onSettingClick={onClickWorkspaceSetting}\n        onEnableCloudClick={onClickEnableCloud}\n        useIsWorkspaceOwner={useIsWorkspaceOwner}\n        useWorkspaceName={useWorkspaceName}\n      />\n    </div>\n  );\n};\n\nexport const AFFiNEWorkspaceList = ({\n  onEventEnd,\n}: {\n  onEventEnd?: () => void;\n}) => {\n  const workspacesService = useService(WorkspacesService);\n  const workspaces = useLiveData(workspacesService.list.workspaces$);\n  const currentWorkspaceId = useLiveData(\n    useService(GlobalContextService).globalContext.workspaceId.$\n  );\n\n  const setOpenCreateWorkspaceModal = useSetAtom(openCreateWorkspaceModalAtom);\n  const confirmEnableCloud = useEnableCloud();\n\n  const { jumpToSubPath } = useNavigateHelper();\n\n  const setOpenSettingModalAtom = useSetAtom(openSettingModalAtom);\n\n  const session = useService(AuthService).session;\n  const status = useLiveData(session.status$);\n\n  const isAuthenticated = status === 'authenticated';\n\n  const cloudWorkspaces = useMemo(\n    () =>\n      workspaces.filter(\n        ({ flavour }) => flavour === WorkspaceFlavour.AFFINE_CLOUD\n      ) as WorkspaceMetadata[],\n    [workspaces]\n  );\n\n  const localWorkspaces = useMemo(\n    () =>\n      workspaces.filter(\n        ({ flavour }) => flavour === WorkspaceFlavour.LOCAL\n      ) as WorkspaceMetadata[],\n    [workspaces]\n  );\n\n  const onClickWorkspaceSetting = useCallback(\n    (workspaceMetadata: WorkspaceMetadata) => {\n      setOpenSettingModalAtom({\n        open: true,\n        activeTab: 'workspace:preference',\n        workspaceMetadata,\n      });\n      onEventEnd?.();\n    },\n    [onEventEnd, setOpenSettingModalAtom]\n  );\n\n  const onClickEnableCloud = useCallback(\n    (meta: WorkspaceMetadata) => {\n      const { workspace, dispose } = workspacesService.open({ metadata: meta });\n      confirmEnableCloud(workspace, {\n        onFinished: () => {\n          dispose();\n        },\n      });\n    },\n    [confirmEnableCloud, workspacesService]\n  );\n\n  const onClickWorkspace = useCallback(\n    (workspaceMetadata: WorkspaceMetadata) => {\n      if (document.startViewTransition) {\n        document.startViewTransition(() => {\n          jumpToSubPath(workspaceMetadata.id, WorkspaceSubPath.ALL);\n          onEventEnd?.();\n          return new Promise(resolve =>\n            setTimeout(resolve, 150)\n          ); /* start transition after 150ms */\n        });\n      } else {\n        jumpToSubPath(workspaceMetadata.id, WorkspaceSubPath.ALL);\n        onEventEnd?.();\n      }\n    },\n    [jumpToSubPath, onEventEnd]\n  );\n\n  const onNewWorkspace = useCallback(() => {\n    setOpenCreateWorkspaceModal('new');\n    onEventEnd?.();\n  }, [onEventEnd, setOpenCreateWorkspaceModal]);\n\n  const onAddWorkspace = useCallback(() => {\n    setOpenCreateWorkspaceModal('add');\n    onEventEnd?.();\n  }, [onEventEnd, setOpenCreateWorkspaceModal]);\n\n  return (\n    <ScrollableContainer\n      className={styles.workspaceListsWrapper}\n      scrollBarClassName={styles.scrollbar}\n    >\n      {isAuthenticated ? (\n        <div>\n          <CloudWorkSpaceList\n            workspaces={cloudWorkspaces}\n            onClickWorkspace={onClickWorkspace}\n            onClickWorkspaceSetting={onClickWorkspaceSetting}\n            onNewWorkspace={onNewWorkspace}\n            onAddWorkspace={onAddWorkspace}\n            currentWorkspaceId={currentWorkspaceId}\n          />\n          {localWorkspaces.length > 0 && cloudWorkspaces.length > 0 ? (\n            <Divider size=\"thinner\" />\n          ) : null}\n        </div>\n      ) : null}\n      <LocalWorkspaces\n        workspaces={localWorkspaces}\n        onClickWorkspace={onClickWorkspace}\n        onClickWorkspaceSetting={onClickWorkspaceSetting}\n        onClickEnableCloud={onClickEnableCloud}\n        onNewWorkspace={onNewWorkspace}\n        onAddWorkspace={onAddWorkspace}\n        currentWorkspaceId={currentWorkspaceId}\n      />\n    </ScrollableContainer>\n  );\n};\n","import { Loading } from '@affine/component';\nimport { Divider } from '@affine/component/ui/divider';\nimport { MenuItem } from '@affine/component/ui/menu';\nimport { track } from '@affine/core/mixpanel';\nimport { AuthService } from '@affine/core/modules/cloud';\nimport { useI18n } from '@affine/i18n';\nimport { Logo1Icon } from '@blocksuite/icons/rc';\nimport {\n  useLiveData,\n  useService,\n  WorkspacesService,\n} from '@toeverything/infra';\nimport { useSetAtom } from 'jotai';\nimport { Suspense, useCallback } from 'react';\n\nimport { authAtom, openCreateWorkspaceModalAtom } from '../../../../atoms';\nimport { AddWorkspace } from './add-workspace';\nimport * as styles from './index.css';\nimport { UserAccountItem } from './user-account';\nimport { AFFiNEWorkspaceList } from './workspace-list';\n\nexport const SignInItem = () => {\n  const setOpen = useSetAtom(authAtom);\n\n  const t = useI18n();\n\n  const onClickSignIn = useCallback(() => {\n    track.$.navigationPanel.workspaceList.signIn();\n    setOpen(state => ({\n      ...state,\n      openModal: true,\n    }));\n  }, [setOpen]);\n\n  return (\n    <MenuItem\n      className={styles.menuItem}\n      onClick={onClickSignIn}\n      data-testid=\"cloud-signin-button\"\n    >\n      <div className={styles.signInWrapper}>\n        <div className={styles.iconContainer}>\n          <Logo1Icon />\n        </div>\n\n        <div className={styles.signInTextContainer}>\n          <div className={styles.signInTextPrimary}>\n            {t['com.affine.workspace.cloud.auth']()}\n          </div>\n          <div className={styles.signInTextSecondary}>\n            {t['com.affine.workspace.cloud.description']()}\n          </div>\n        </div>\n      </div>\n    </MenuItem>\n  );\n};\n\nconst UserWithWorkspaceListLoading = () => {\n  return (\n    <div className={styles.loadingWrapper}>\n      <Loading size={24} />\n    </div>\n  );\n};\n\ninterface UserWithWorkspaceListProps {\n  onEventEnd?: () => void;\n}\n\nconst UserWithWorkspaceListInner = ({\n  onEventEnd,\n}: UserWithWorkspaceListProps) => {\n  const session = useLiveData(useService(AuthService).session.session$);\n\n  const isAuthenticated = session.status === 'authenticated';\n\n  const setOpenCreateWorkspaceModal = useSetAtom(openCreateWorkspaceModalAtom);\n\n  const setOpenSignIn = useSetAtom(authAtom);\n\n  const openSignInModal = useCallback(() => {\n    setOpenSignIn(state => ({\n      ...state,\n      openModal: true,\n    }));\n  }, [setOpenSignIn]);\n\n  const onNewWorkspace = useCallback(() => {\n    if (!isAuthenticated && !runtimeConfig.allowLocalWorkspace) {\n      return openSignInModal();\n    }\n    track.$.navigationPanel.workspaceList.createWorkspace();\n    setOpenCreateWorkspaceModal('new');\n    onEventEnd?.();\n  }, [\n    isAuthenticated,\n    onEventEnd,\n    openSignInModal,\n    setOpenCreateWorkspaceModal,\n  ]);\n\n  track.$.navigationPanel.workspaceList.createWorkspace();\n  const onAddWorkspace = useCallback(() => {\n    track.$.navigationPanel.workspaceList.createWorkspace({\n      control: 'import',\n    });\n    setOpenCreateWorkspaceModal('add');\n    onEventEnd?.();\n  }, [onEventEnd, setOpenCreateWorkspaceModal]);\n\n  const workspaceManager = useService(WorkspacesService);\n  const workspaces = useLiveData(workspaceManager.list.workspaces$);\n\n  return (\n    <div className={styles.workspaceListWrapper}>\n      {isAuthenticated ? (\n        <UserAccountItem\n          email={session.session.account.email ?? 'Unknown User'}\n          onEventEnd={onEventEnd}\n        />\n      ) : (\n        <SignInItem />\n      )}\n      <Divider size=\"thinner\" />\n      <AFFiNEWorkspaceList onEventEnd={onEventEnd} />\n      {workspaces.length > 0 ? <Divider size=\"thinner\" /> : null}\n      <AddWorkspace\n        onAddWorkspace={onAddWorkspace}\n        onNewWorkspace={onNewWorkspace}\n      />\n    </div>\n  );\n};\n\nexport const UserWithWorkspaceList = (props: UserWithWorkspaceListProps) => {\n  return (\n    <Suspense fallback={<UserWithWorkspaceListLoading />}>\n      <UserWithWorkspaceListInner {...props} />\n    </Suspense>\n  );\n};\n","import \"../core/src/components/pure/workspace-slider-bar/user-with-workspace-list/index.css.ts.vanilla.css!=!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/pure/workspace-slider-bar/user-with-workspace-list/index.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACq1TTW/DIAy991f4Mmk9UCVZt1X011BwEm8UENAm3dT/PkH6uUVrJ+3AgWfz/OxnZr3EolsV8DkBUBScFjsOtcZ+OQHoSMWWQ1kUD+maYKbIo4xkDQdp9WZtlpP9ZDbQlHfRNMJxKCuXY0JTYxhFXAcOEk1En+C3TYhU75i0JqKJAxcLUfiYwivrFXrmhaJN4LBIXCcVVVZxKFothjpOKEWm4VC5HubDGWEqj7CQ7423G6M4bIV/ZEzUNRlkXUsRp8uxNgcqDqXrIVhN6volSWtYQGmNEn6XKaTV1vObaffO6ByqrYks0AdyqIqr4TyNW3TT2nl+d8F7JXrA19NT7Q6paSOHl6JImE5J7QGrDtbbLfpa245DS0qhSVjEPrJzALUmFyjkLUqTZ8EJiRyM7bxwF/qeb+vrw0998zF9xaBvzJ2s7+QOyynTf2/mJTfz65K/5pSj5PlhpN9+2g+b/7pJ+y/t8nuJIAQAAA==\\\"}!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var iconContainer = 'xce0wb2';\nexport var loadingWrapper = 'xce0wb7';\nexport var menuItem = 'xce0wb6';\nexport var signInTextContainer = 'xce0wb3';\nexport var signInTextPrimary = 'xce0wb4';\nexport var signInTextSecondary = 'xce0wb5';\nexport var signInWrapper = 'xce0wb1';\nexport var workspaceListWrapper = 'xce0wb0';","import { useLiveData, useService, WorkspaceService } from '@toeverything/infra';\nimport { useMemo } from 'react';\n\nexport function useDocEngineStatus() {\n  const workspace = useService(WorkspaceService).workspace;\n\n  const engineState = useLiveData(\n    workspace.engine.docEngineState$.throttleTime(100)\n  );\n  const progress =\n    (engineState.total - engineState.syncing) / engineState.total;\n\n  return useMemo(\n    () => ({\n      ...engineState,\n      progress,\n      syncing: engineState.syncing > 0 || engineState.retrying,\n    }),\n    [engineState, progress]\n  );\n}\n","import \"../core/src/components/pure/workspace-slider-bar/workspace-card/styles.css.ts.vanilla.css!=!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/pure/workspace-slider-bar/workspace-card/styles.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACrVVYW/aMBD9zq+wkCaBhJFDCatc9YdMUzUZ55Jc69iW7QTo1P8+xQmUQGCatH5KfHd+vvd8d17+Sl7LR+s9I78nhJSARRk4SZndP00IydBbJQ6c5AqiQSgsNMUAledEgg7gWnMhLCeP3R4rsgx1wQkjm86yNS4DR53IsPacrDurqYNCDZxoo6E17DALJScJY9/aZSX2tDelrM9HGmUcJ41wM0pFnqMGGmAfqHVYCXegMWD+NPmYLE/MeGkacJGfrJ1vAazBY+pbId8KZ2qdXeDGXWOAyUCq9aqn04DLldlxUmKWgR5sWcUtV2q2X5qhAxnQaN7Sqyt9pXMM80G40LqCE9rnxlW8+1UiwI8Zm5982IGd4ghbpp7IeouSbuEdwc2W63SxXCULtkjmhPkhvZ+ZCIIKGbCB52lwNUxfyAWV8SRoK8ZQrIcYfnG1kVDhWrGSce2u9f0H8V5rHzBvi0EH0OG8UM8FMlZIDIf/K89D5w4HC89TbVwl1PQlatAfxwm7h5cL5W8DQgM6+PuA6+jMjQ7U4ztcVHVnr2K1qFjmvc6rXucYsDvNAdbaag+OelAgw2e7jl1a7MVPByiF1qOP3V1iAOqtkLHld07YQdrpeIvEydKndmP43KW69yNU2QjVdUd1bMJslZBvNGXzi4R9Uwyqux93x2OO6zFIlEZTD9LoTLjDEHjzNUrcu/Sbc/WU4tgg3HyVAt//XsL37vXsBerfpAr1RdTHH8Ok2oD6BgAA\\\"}!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var container = '_1jh8pss0';\nexport var workspaceActiveStatus = '_1jh8pss6';\nexport var workspaceInfo = '_1jh8pss3';\nexport var workspaceInfoSlide = '_1jh8pss2';\nexport var workspaceInfoSlider = '_1jh8pss1';\nexport var workspaceInfoTooltip = '_1jh8pss7';\nexport var workspaceName = '_1jh8pss4';\nexport var workspaceStatus = '_1jh8pss5';","import { notify, Tooltip } from '@affine/component';\nimport { Loading } from '@affine/component/ui/loading';\nimport { WorkspaceAvatar } from '@affine/component/workspace-avatar';\nimport { openSettingModalAtom } from '@affine/core/atoms';\nimport { useDocEngineStatus } from '@affine/core/hooks/affine/use-doc-engine-status';\nimport { useWorkspaceInfo } from '@affine/core/hooks/use-workspace-info';\nimport { WorkspacePermissionService } from '@affine/core/modules/permissions';\nimport { UNTITLED_WORKSPACE_NAME } from '@affine/env/constant';\nimport { WorkspaceFlavour } from '@affine/env/workspace';\nimport { useI18n } from '@affine/i18n';\nimport {\n  CloudWorkspaceIcon,\n  InformationFillDuotoneIcon,\n  LocalWorkspaceIcon,\n  NoNetworkIcon,\n  UnsyncIcon,\n} from '@blocksuite/icons/rc';\nimport { useLiveData, useService, WorkspaceService } from '@toeverything/infra';\nimport { cssVar } from '@toeverything/theme';\nimport { useSetAtom } from 'jotai';\nimport { debounce } from 'lodash-es';\nimport type { HTMLAttributes } from 'react';\nimport { forwardRef, useCallback, useEffect, useMemo, useState } from 'react';\n\nimport { useSystemOnline } from '../../../../hooks/use-system-online';\nimport * as styles from './styles.css';\n\n// FIXME:\n// 2. Refactor the code to improve readability\nconst CloudWorkspaceStatus = () => {\n  return (\n    <>\n      <CloudWorkspaceIcon />\n      Cloud\n    </>\n  );\n};\n\nconst SyncingWorkspaceStatus = ({ progress }: { progress?: number }) => {\n  return (\n    <>\n      <Loading progress={progress} speed={progress ? 0 : undefined} />\n      Syncing...\n    </>\n  );\n};\n\nconst UnSyncWorkspaceStatus = () => {\n  return (\n    <>\n      <UnsyncIcon />\n      Wait for upload\n    </>\n  );\n};\n\nconst LocalWorkspaceStatus = () => {\n  return (\n    <>\n      {!environment.isDesktop ? (\n        <InformationFillDuotoneIcon style={{ color: cssVar('errorColor') }} />\n      ) : (\n        <LocalWorkspaceIcon />\n      )}\n      Local\n    </>\n  );\n};\n\nconst OfflineStatus = () => {\n  return (\n    <>\n      <NoNetworkIcon />\n      Offline\n    </>\n  );\n};\n\nconst useSyncEngineSyncProgress = () => {\n  const t = useI18n();\n  const isOnline = useSystemOnline();\n  const { syncing, progress, retrying, errorMessage } = useDocEngineStatus();\n  const [isOverCapacity, setIsOverCapacity] = useState(false);\n\n  const currentWorkspace = useService(WorkspaceService).workspace;\n  const permissionService = useService(WorkspacePermissionService);\n  const isOwner = useLiveData(permissionService.permission.isOwner$);\n  useEffect(() => {\n    // revalidate permission\n    permissionService.permission.revalidate();\n  }, [permissionService]);\n\n  const setSettingModalAtom = useSetAtom(openSettingModalAtom);\n  const jumpToPricePlan = useCallback(() => {\n    setSettingModalAtom({\n      open: true,\n      activeTab: 'plans',\n      scrollAnchor: 'cloudPricingPlan',\n    });\n  }, [setSettingModalAtom]);\n\n  // debounce sync engine status\n  useEffect(() => {\n    const disposableOverCapacity =\n      currentWorkspace.engine.blob.isStorageOverCapacity$.subscribe(\n        debounce((isStorageOverCapacity: boolean) => {\n          const isOver = isStorageOverCapacity;\n          if (!isOver) {\n            setIsOverCapacity(false);\n            return;\n          }\n          setIsOverCapacity(true);\n          if (isOwner) {\n            notify.warning({\n              title: t['com.affine.payment.storage-limit.title'](),\n              message:\n                t['com.affine.payment.storage-limit.description.owner'](),\n              action: {\n                label: t['com.affine.payment.storage-limit.view'](),\n                onClick: jumpToPricePlan,\n              },\n            });\n          } else {\n            notify.warning({\n              title: t['com.affine.payment.storage-limit.title'](),\n              message:\n                t['com.affine.payment.storage-limit.description.member'](),\n            });\n          }\n        })\n      );\n    return () => {\n      disposableOverCapacity?.unsubscribe();\n    };\n  }, [currentWorkspace, isOwner, jumpToPricePlan, t]);\n\n  const content = useMemo(() => {\n    // TODO(@eyhn): add i18n\n    if (currentWorkspace.flavour === WorkspaceFlavour.LOCAL) {\n      if (!environment.isDesktop) {\n        return 'This is a local demo workspace.';\n      }\n      return 'Saved locally';\n    }\n    if (!isOnline) {\n      return 'Disconnected, please check your network connection';\n    }\n    if (isOverCapacity) {\n      return 'Sync failed due to insufficient cloud storage space.';\n    }\n    if (retrying && errorMessage) {\n      return `${errorMessage}, reconnecting.`;\n    }\n    if (retrying) {\n      return 'Sync disconnected due to unexpected issues, reconnecting.';\n    }\n    if (syncing) {\n      return (\n        `Syncing with AFFiNE Cloud` +\n        (progress ? ` (${Math.floor(progress * 100)}%)` : '')\n      );\n    }\n\n    return 'Synced with AFFiNE Cloud';\n  }, [\n    currentWorkspace.flavour,\n    errorMessage,\n    isOnline,\n    isOverCapacity,\n    progress,\n    retrying,\n    syncing,\n  ]);\n\n  const CloudWorkspaceSyncStatus = useCallback(() => {\n    if (syncing) {\n      return SyncingWorkspaceStatus({\n        progress: progress ? Math.max(progress, 0.2) : undefined,\n      });\n    } else if (retrying) {\n      return UnSyncWorkspaceStatus();\n    } else {\n      return CloudWorkspaceStatus();\n    }\n  }, [progress, retrying, syncing]);\n\n  return {\n    message: content,\n    icon:\n      currentWorkspace.flavour === WorkspaceFlavour.AFFINE_CLOUD ? (\n        !isOnline ? (\n          <OfflineStatus />\n        ) : (\n          <CloudWorkspaceSyncStatus />\n        )\n      ) : (\n        <LocalWorkspaceStatus />\n      ),\n    active:\n      currentWorkspace.flavour === WorkspaceFlavour.AFFINE_CLOUD &&\n      ((syncing && progress !== undefined) || retrying) && // active if syncing or retrying\n      !isOverCapacity, // not active if isOffline or OverCapacity\n  };\n};\nconst usePauseAnimation = (timeToResume = 5000) => {\n  const [paused, setPaused] = useState(false);\n\n  const resume = useCallback(() => {\n    setPaused(false);\n  }, []);\n\n  const pause = useCallback(() => {\n    setPaused(true);\n    if (timeToResume > 0) {\n      setTimeout(resume, timeToResume);\n    }\n  }, [resume, timeToResume]);\n\n  return { paused, pause };\n};\n\nconst WorkspaceInfo = ({ name }: { name: string }) => {\n  const { message, active } = useSyncEngineSyncProgress();\n  const currentWorkspace = useService(WorkspaceService).workspace;\n  const isCloud = currentWorkspace.flavour === WorkspaceFlavour.AFFINE_CLOUD;\n  const { progress } = useDocEngineStatus();\n  const { paused, pause } = usePauseAnimation();\n\n  // to make sure that animation will play first time\n  const [delayActive, setDelayActive] = useState(false);\n  useEffect(() => {\n    if (paused) {\n      return;\n    }\n    const delayOpen = 0;\n    const delayClose = 200;\n    let timer: ReturnType<typeof setTimeout>;\n    if (active) {\n      timer = setTimeout(() => {\n        setDelayActive(active);\n      }, delayOpen);\n    } else {\n      timer = setTimeout(() => {\n        setDelayActive(active);\n        pause();\n      }, delayClose);\n    }\n    return () => clearTimeout(timer);\n  }, [active, pause, paused]);\n\n  return (\n    <div className={styles.workspaceInfoSlider} data-active={delayActive}>\n      <div className={styles.workspaceInfoSlide}>\n        <div className={styles.workspaceInfo} data-type=\"normal\">\n          <div className={styles.workspaceName} data-testid=\"workspace-name\">\n            {name}\n          </div>\n          <div className={styles.workspaceStatus}>\n            {isCloud ? <CloudWorkspaceStatus /> : <LocalWorkspaceStatus />}\n          </div>\n        </div>\n\n        {/* when syncing/offline/... */}\n        <div className={styles.workspaceInfo} data-type=\"events\">\n          <Tooltip\n            content={message}\n            options={{ className: styles.workspaceInfoTooltip }}\n          >\n            <div className={styles.workspaceActiveStatus}>\n              <SyncingWorkspaceStatus progress={progress} />\n            </div>\n          </Tooltip>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport const WorkspaceCard = forwardRef<\n  HTMLDivElement,\n  HTMLAttributes<HTMLDivElement>\n>(({ ...props }, ref) => {\n  const currentWorkspace = useService(WorkspaceService).workspace;\n\n  const information = useWorkspaceInfo(currentWorkspace.meta);\n\n  const name = information?.name ?? UNTITLED_WORKSPACE_NAME;\n\n  return (\n    <div\n      className={styles.container}\n      role=\"button\"\n      tabIndex={0}\n      data-testid=\"current-workspace\"\n      id=\"current-workspace\"\n      ref={ref}\n      {...props}\n    >\n      <WorkspaceAvatar\n        key={currentWorkspace.id}\n        meta={currentWorkspace.meta}\n        rounded={3}\n        data-testid=\"workspace-avatar\"\n        size={32}\n        name={name}\n        colorfulFallback\n      />\n      <WorkspaceInfo name={name} />\n    </div>\n  );\n});\n\nWorkspaceCard.displayName = 'WorkspaceCard';\n","import { Menu } from '@affine/component';\nimport { track } from '@affine/core/mixpanel';\nimport { useService, WorkspacesService } from '@toeverything/infra';\nimport { useAtom } from 'jotai';\nimport { useCallback, useEffect } from 'react';\n\nimport { openWorkspaceListModalAtom } from '../../atoms';\nimport { UserWithWorkspaceList } from '../pure/workspace-slider-bar/user-with-workspace-list';\nimport { WorkspaceCard } from '../pure/workspace-slider-bar/workspace-card';\n\nexport const WorkspaceSelector = () => {\n  const [isUserWorkspaceListOpened, setOpenUserWorkspaceList] = useAtom(\n    openWorkspaceListModalAtom\n  );\n  const closeUserWorkspaceList = useCallback(() => {\n    setOpenUserWorkspaceList(false);\n  }, [setOpenUserWorkspaceList]);\n  const openUserWorkspaceList = useCallback(() => {\n    track.$.navigationPanel.workspaceList.open();\n    setOpenUserWorkspaceList(true);\n  }, [setOpenUserWorkspaceList]);\n\n  const workspaceManager = useService(WorkspacesService);\n\n  // revalidate workspace list when open workspace list\n  useEffect(() => {\n    if (isUserWorkspaceListOpened) {\n      workspaceManager.list.revalidate();\n    }\n  }, [workspaceManager, isUserWorkspaceListOpened]);\n\n  return (\n    <Menu\n      rootOptions={{\n        open: isUserWorkspaceListOpened,\n      }}\n      items={<UserWithWorkspaceList onEventEnd={closeUserWorkspaceList} />}\n      contentOptions={{\n        // hide trigger\n        sideOffset: -58,\n        onInteractOutside: closeUserWorkspaceList,\n        onEscapeKeyDown: closeUserWorkspaceList,\n        style: {\n          width: '300px',\n        },\n      }}\n    >\n      <WorkspaceCard onClick={openUserWorkspaceList} />\n    </Menu>\n  );\n};\n","import \"../core/src/components/workspace/index.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/workspace/index.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#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\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var appStyle = 'b8t49x0';\nexport var mainContainerStyle = 'b8t49x1';\nexport var toolStyle = 'b8t49x2';","import { useAppSettingHelper } from '@affine/core/hooks/affine/use-app-setting-helper';\nimport {\n  DocsService,\n  GlobalContextService,\n  useLiveData,\n  useService,\n} from '@toeverything/infra';\nimport { clsx } from 'clsx';\nimport { useAtomValue } from 'jotai';\nimport type { HTMLAttributes, PropsWithChildren, ReactElement } from 'react';\nimport { forwardRef } from 'react';\n\nimport { appSidebarOpenAtom } from '../app-sidebar';\nimport { appStyle, mainContainerStyle, toolStyle } from './index.css';\n\nexport type WorkspaceRootProps = PropsWithChildren<{\n  resizing?: boolean;\n  useNoisyBackground?: boolean;\n  useBlurBackground?: boolean;\n}>;\n\nexport const AppContainer = ({\n  resizing,\n  useNoisyBackground,\n  useBlurBackground,\n  children,\n  ...rest\n}: WorkspaceRootProps) => {\n  const noisyBackground = useNoisyBackground && environment.isDesktop;\n  const blurBackground = environment.isDesktop && useBlurBackground;\n  return (\n    <div\n      {...rest}\n      className={clsx(appStyle, {\n        'noisy-background': noisyBackground,\n        'blur-background': blurBackground,\n      })}\n      data-noise-background={noisyBackground}\n      data-is-resizing={resizing}\n      data-blur-background={blurBackground}\n    >\n      {children}\n    </div>\n  );\n};\n\nexport interface MainContainerProps extends HTMLAttributes<HTMLDivElement> {}\n\nexport const MainContainer = forwardRef<\n  HTMLDivElement,\n  PropsWithChildren<MainContainerProps>\n>(function MainContainer({ className, children, ...props }, ref): ReactElement {\n  const appSideBarOpen = useAtomValue(appSidebarOpenAtom);\n  const { appSettings } = useAppSettingHelper();\n\n  return (\n    <div\n      {...props}\n      className={clsx(mainContainerStyle, className)}\n      data-is-desktop={environment.isDesktop}\n      data-transparent={false}\n      data-client-border={appSettings.clientBorder}\n      data-side-bar-open={appSideBarOpen}\n      data-testid=\"main-container\"\n      ref={ref}\n    >\n      <div className={mainContainerStyle}>{children}</div>\n    </div>\n  );\n});\n\nMainContainer.displayName = 'MainContainer';\n\nexport const ToolContainer = (\n  props: PropsWithChildren<{ className?: string }>\n): ReactElement => {\n  const docId = useLiveData(\n    useService(GlobalContextService).globalContext.docId.$\n  );\n  const docRecordList = useService(DocsService).list;\n  const doc = useLiveData(docId ? docRecordList.doc$(docId) : undefined);\n  const inTrash = useLiveData(doc?.meta$)?.trash;\n  return (\n    <div className={clsx(toolStyle, { trash: inTrash }, props.className)}>\n      {props.children}\n    </div>\n  );\n};\n","import React, { type DependencyList } from 'react';\n\nexport type AsyncErrorHandler = (error: Error) => void;\n\n/**\n * App should provide a global error handler for async callback in the root.\n */\nexport const AsyncCallbackContext = React.createContext<AsyncErrorHandler>(\n  e => {\n    console.error(e);\n  }\n);\n\n/**\n * Translate async function to sync function and handle error automatically.\n * Only accept void function, return data here is meaningless.\n */\nexport function useAsyncCallback<T extends any[]>(\n  callback: (...args: T) => Promise<void>,\n  deps: DependencyList\n): (...args: T) => void {\n  const handleAsyncError = React.useContext(AsyncCallbackContext);\n  return React.useCallback(\n    (...args: any) => {\n      callback(...args).catch(e => handleAsyncError(e));\n    },\n    [...deps] // eslint-disable-line react-hooks/exhaustive-deps\n  );\n}\n","import type { AppSetting } from '@toeverything/infra';\nimport { appSettingAtom } from '@toeverything/infra';\nimport { useAtom } from 'jotai';\nimport { useCallback, useMemo } from 'react';\n\nexport function useAppSettingHelper() {\n  const [appSettings, setAppSettings] = useAtom(appSettingAtom);\n\n  const updateSettings = useCallback(\n    <K extends keyof AppSetting>(key: K, value: AppSetting[K]) => {\n      setAppSettings(prevSettings => ({ ...prevSettings, [key]: value }));\n    },\n    [setAppSettings]\n  );\n\n  return useMemo(\n    () => ({\n      appSettings,\n      updateSettings,\n    }),\n    [appSettings, updateSettings]\n  );\n}\n","import { useAsyncCallback } from '@affine/core/hooks/affine-async-hooks';\nimport { useDocMetaHelper } from '@affine/core/hooks/use-block-suite-page-meta';\nimport { useDocCollectionHelper } from '@affine/core/hooks/use-block-suite-workspace-helper';\nimport { CollectionService } from '@affine/core/modules/collection';\nimport { DocsService, useService } from '@toeverything/infra';\nimport { useCallback } from 'react';\nimport { applyUpdate, encodeStateAsUpdate } from 'yjs';\n\nimport type { DocCollection } from '../../shared';\nimport { useNavigateHelper } from '../use-navigate-helper';\n\nexport function useBlockSuiteMetaHelper(docCollection: DocCollection) {\n  const { setDocMeta, getDocMeta, setDocReadonly, setDocTitle } =\n    useDocMetaHelper(docCollection);\n  const { createDoc } = useDocCollectionHelper(docCollection);\n  const { openPage } = useNavigateHelper();\n  const collectionService = useService(CollectionService);\n  const pageRecordList = useService(DocsService).list;\n\n  // TODO-Doma\n  // \"Remove\" may cause ambiguity here. Consider renaming as \"moveToTrash\".\n  const removeToTrash = useCallback(\n    (pageId: string) => {\n      setDocMeta(pageId, {\n        trash: true,\n        trashDate: Date.now(),\n      });\n      setDocReadonly(pageId, true);\n      collectionService.deletePagesFromCollections([pageId]);\n    },\n    [collectionService, setDocMeta, setDocReadonly]\n  );\n\n  const restoreFromTrash = useCallback(\n    (pageId: string) => {\n      setDocMeta(pageId, {\n        trash: false,\n        trashDate: undefined,\n      });\n      setDocReadonly(pageId, false);\n    },\n    [setDocMeta, setDocReadonly]\n  );\n\n  const permanentlyDeletePage = useCallback(\n    (pageId: string) => {\n      docCollection.removeDoc(pageId);\n    },\n    [docCollection]\n  );\n\n  /**\n   * see {@link useBlockSuiteWorkspacePageIsPublic}\n   */\n  const publicPage = useCallback(\n    (pageId: string) => {\n      setDocMeta(pageId, {\n        isPublic: true,\n      });\n    },\n    [setDocMeta]\n  );\n\n  /**\n   * see {@link useBlockSuiteWorkspacePageIsPublic}\n   */\n  const cancelPublicPage = useCallback(\n    (pageId: string) => {\n      setDocMeta(pageId, {\n        isPublic: false,\n      });\n    },\n    [setDocMeta]\n  );\n\n  const duplicate = useAsyncCallback(\n    async (pageId: string, openPageAfterDuplication: boolean = true) => {\n      const currentPageMode = pageRecordList.doc$(pageId).value?.mode$.value;\n      const currentPageMeta = getDocMeta(pageId);\n      const newPage = createDoc();\n      const currentPage = docCollection.getDoc(pageId);\n\n      newPage.load();\n      if (!currentPageMeta || !currentPage) {\n        return;\n      }\n\n      const update = encodeStateAsUpdate(currentPage.spaceDoc);\n      applyUpdate(newPage.spaceDoc, update);\n\n      setDocMeta(newPage.id, {\n        tags: currentPageMeta.tags,\n      });\n\n      const lastDigitRegex = /\\((\\d+)\\)$/;\n      const match = currentPageMeta.title.match(lastDigitRegex);\n      const newNumber = match ? parseInt(match[1], 10) + 1 : 1;\n\n      const newPageTitle =\n        currentPageMeta.title.replace(lastDigitRegex, '') + `(${newNumber})`;\n\n      pageRecordList.doc$(newPage.id).value?.setMode(currentPageMode || 'page');\n      setDocTitle(newPage.id, newPageTitle);\n      openPageAfterDuplication && openPage(docCollection.id, newPage.id);\n    },\n    [\n      docCollection,\n      createDoc,\n      getDocMeta,\n      openPage,\n      pageRecordList,\n      setDocMeta,\n      setDocTitle,\n    ]\n  );\n\n  return {\n    publicPage,\n    cancelPublicPage,\n\n    removeToTrash,\n    restoreFromTrash,\n    permanentlyDeletePage,\n\n    duplicate,\n  };\n}\n","import { AuthService } from '@affine/core/modules/cloud';\nimport type { DeleteCollectionInfo } from '@affine/env/filter';\nimport { useLiveData, useService } from '@toeverything/infra';\nimport { useMemo } from 'react';\n\nexport const useDeleteCollectionInfo = () => {\n  const authService = useService(AuthService);\n\n  const user = useLiveData(authService.session.account$);\n\n  return useMemo<DeleteCollectionInfo | null>(\n    () => (user ? { userName: user.label, userId: user.id } : null),\n    [user]\n  );\n};\n","import { notify, useConfirmModal } from '@affine/component';\nimport { authAtom } from '@affine/core/atoms';\nimport { AuthService } from '@affine/core/modules/cloud';\nimport { WorkspaceSubPath } from '@affine/core/shared';\nimport { useI18n } from '@affine/i18n';\nimport type { Workspace } from '@toeverything/infra';\nimport {\n  useLiveData,\n  useService,\n  WorkspacesService,\n} from '@toeverything/infra';\nimport { useSetAtom } from 'jotai';\nimport { useCallback } from 'react';\n\nimport { useNavigateHelper } from '../use-navigate-helper';\n\ninterface ConfirmEnableCloudOptions {\n  /**\n   * Fired when the workspace is successfully enabled\n   */\n  onSuccess?: () => void;\n  /**\n   * Fired when workspace is successfully enabled or user cancels the operation\n   */\n  onFinished?: () => void;\n  openPageId?: string;\n}\ntype ConfirmEnableArgs = [Workspace, ConfirmEnableCloudOptions | undefined];\n\nexport const useEnableCloud = () => {\n  const t = useI18n();\n  const authService = useService(AuthService);\n  const account = useLiveData(authService.session.account$);\n  const loginStatus = useLiveData(useService(AuthService).session.status$);\n  const setAuthAtom = useSetAtom(authAtom);\n  const { openConfirmModal, closeConfirmModal } = useConfirmModal();\n  const workspacesService = useService(WorkspacesService);\n  const { openPage } = useNavigateHelper();\n\n  const enableCloud = useCallback(\n    async (ws: Workspace | null, options?: ConfirmEnableCloudOptions) => {\n      try {\n        if (!ws) return;\n        if (!account) return;\n        const { id: newId } = await workspacesService.transformLocalToCloud(\n          ws,\n          account.id\n        );\n        openPage(newId, options?.openPageId || WorkspaceSubPath.ALL);\n        options?.onSuccess?.();\n      } catch (e) {\n        console.error(e);\n        notify.error({\n          title: t['com.affine.workspace.enable-cloud.failed'](),\n        });\n      }\n    },\n    [account, openPage, t, workspacesService]\n  );\n\n  const openSignIn = useCallback(() => {\n    setAuthAtom(prev => ({ ...prev, openModal: true }));\n  }, [setAuthAtom]);\n\n  const signInOrEnableCloud = useCallback(\n    async (...args: ConfirmEnableArgs) => {\n      // not logged in, open login modal\n      if (loginStatus === 'unauthenticated') {\n        openSignIn();\n      }\n\n      if (loginStatus === 'authenticated') {\n        await enableCloud(...args);\n      }\n    },\n    [enableCloud, loginStatus, openSignIn]\n  );\n\n  const confirmEnableCloud = useCallback(\n    (ws: Workspace, options?: ConfirmEnableCloudOptions) => {\n      const { onSuccess, onFinished } = options ?? {};\n\n      const closeOnSuccess = () => {\n        closeConfirmModal();\n        onSuccess?.();\n      };\n\n      openConfirmModal(\n        {\n          title: t['Enable AFFiNE Cloud'](),\n          description: t['Enable AFFiNE Cloud Description'](),\n          cancelText: t['com.affine.enableAffineCloudModal.button.cancel'](),\n          confirmText:\n            loginStatus === 'authenticated'\n              ? t['Enable']()\n              : t['Sign in and Enable'](),\n          confirmButtonOptions: {\n            variant: 'primary',\n            ['data-testid' as string]: 'confirm-enable-affine-cloud-button',\n          },\n          onConfirm: async () =>\n            await signInOrEnableCloud(ws, {\n              ...options,\n              onSuccess: closeOnSuccess,\n            }),\n          onOpenChange: open => {\n            if (!open) onFinished?.();\n          },\n        },\n        {\n          autoClose: false,\n        }\n      );\n    },\n    [closeConfirmModal, loginStatus, openConfirmModal, signInOrEnableCloud, t]\n  );\n\n  return confirmEnableCloud;\n};\n","import { atom } from 'jotai';\n\nexport type TrashModal = {\n  open: boolean;\n  pageIds: string[];\n  pageTitles: string[];\n};\n\nexport const trashModalAtom = atom<TrashModal>({\n  open: false,\n  pageIds: [],\n  pageTitles: [],\n});\n","import { toast } from '@affine/component';\nimport { useI18n } from '@affine/i18n';\nimport type { DocCollection } from '@blocksuite/store';\nimport { useAtom } from 'jotai';\nimport { useCallback } from 'react';\n\nimport { trashModalAtom } from '../../atoms/trash-modal';\nimport { useBlockSuiteMetaHelper } from './use-block-suite-meta-helper';\n\nexport function useTrashModalHelper(docCollection: DocCollection) {\n  const t = useI18n();\n  const [trashModal, setTrashModal] = useAtom(trashModalAtom);\n  const { pageIds } = trashModal;\n  const { removeToTrash } = useBlockSuiteMetaHelper(docCollection);\n\n  const handleOnConfirm = useCallback(() => {\n    pageIds.forEach(pageId => {\n      removeToTrash(pageId);\n    });\n    toast(t['com.affine.toastMessage.movedTrash']());\n    setTrashModal({ ...trashModal, open: false });\n  }, [pageIds, removeToTrash, setTrashModal, t, trashModal]);\n\n  return {\n    trashModal,\n    setTrashModal,\n    handleOnConfirm,\n  };\n}\n","import { useService } from '@toeverything/infra';\nimport { useDebouncedState } from 'foxact/use-debounced-state';\nimport { useEffect } from 'react';\n\nimport { WorkspacePropertiesAdapter } from '../modules/properties';\n\nfunction getProxy<T extends object>(obj: T) {\n  return new Proxy(obj, {});\n}\n\nconst useReactiveAdapter = (adapter: WorkspacePropertiesAdapter) => {\n  // hack: delay proxy creation to avoid unnecessary re-render + render in another component issue\n  const [proxy, setProxy] = useDebouncedState(adapter, 0);\n  useEffect(() => {\n    // TODO(@Peng): track which properties are used and then filter by property path change\n    // using Y.YEvent.path\n    function observe() {\n      setProxy(getProxy(adapter));\n    }\n    const disposables: (() => void)[] = [];\n    disposables.push(\n      adapter.workspace.docCollection.meta.docMetaUpdated.on(observe).dispose\n    );\n    adapter.properties.observeDeep(observe);\n    disposables.push(() => adapter.properties.unobserveDeep(observe));\n    return () => {\n      for (const dispose of disposables) {\n        dispose();\n      }\n    };\n  }, [adapter, setProxy]);\n\n  return proxy;\n};\n\nexport function useCurrentWorkspacePropertiesAdapter() {\n  const adapter = useService(WorkspacePropertiesAdapter);\n  return useReactiveAdapter(adapter);\n}\n","import type { UpdateMeta } from '@affine/electron-api';\nimport { apis, events } from '@affine/electron-api';\nimport { isBrowser } from '@affine/env/constant';\nimport { appSettingAtom } from '@toeverything/infra';\nimport { atom, useAtom, useAtomValue } from 'jotai';\nimport { atomWithObservable, atomWithStorage } from 'jotai/utils';\nimport { useCallback, useState } from 'react';\nimport { Observable } from 'rxjs';\n\nimport { track } from '../mixpanel';\nimport { popupWindow } from '../utils';\nimport { useAsyncCallback } from './affine-async-hooks';\n\nfunction rpcToObservable<\n  T,\n  H extends () => Promise<T>,\n  E extends (callback: (t: T) => void) => () => void,\n>(\n  initialValue: T | null,\n  {\n    event,\n    handler,\n    onSubscribe,\n  }: {\n    event?: E;\n    handler?: H;\n    onSubscribe?: () => void;\n  }\n): Observable<T | null> {\n  return new Observable<T | null>(subscriber => {\n    subscriber.next(initialValue);\n    onSubscribe?.();\n    if (!isBrowser || !environment.isDesktop || !event) {\n      subscriber.complete();\n      return;\n    }\n    handler?.()\n      .then(t => {\n        subscriber.next(t);\n      })\n      .catch(err => {\n        subscriber.error(err);\n      });\n    return event(t => {\n      subscriber.next(t);\n    });\n  });\n}\n\n// download complete, ready to install\nexport const updateReadyAtom = atomWithObservable(() => {\n  return rpcToObservable(null as UpdateMeta | null, {\n    event: events?.updater.onUpdateReady,\n  });\n});\n\n// update available, but not downloaded yet\nexport const updateAvailableAtom = atomWithObservable(() => {\n  return rpcToObservable(null as UpdateMeta | null, {\n    event: events?.updater.onUpdateAvailable,\n  });\n});\n\n// downloading new update\nexport const downloadProgressAtom = atomWithObservable(() => {\n  return rpcToObservable(null as number | null, {\n    event: events?.updater.onDownloadProgress,\n  });\n});\n\nexport const changelogCheckedAtom = atomWithStorage<Record<string, boolean>>(\n  'affine:client-changelog-checked',\n  {}\n);\n\nexport const checkingForUpdatesAtom = atom(false);\n\nexport const currentVersionAtom = atom(async () => {\n  if (!isBrowser) {\n    return null;\n  }\n  const currentVersion = await apis?.updater.currentVersion();\n  return currentVersion;\n});\n\nconst currentChangelogUnreadAtom = atom(\n  async get => {\n    if (!isBrowser) {\n      return false;\n    }\n    const mapping = get(changelogCheckedAtom);\n    const currentVersion = await get(currentVersionAtom);\n    if (currentVersion) {\n      return !mapping[currentVersion];\n    }\n    return false;\n  },\n  async (get, set, v: boolean) => {\n    const currentVersion = await get(currentVersionAtom);\n    if (currentVersion) {\n      set(changelogCheckedAtom, mapping => {\n        return {\n          ...mapping,\n          [currentVersion]: v,\n        };\n      });\n    }\n  }\n);\n\nexport const useAppUpdater = () => {\n  const [appQuitting, setAppQuitting] = useState(false);\n  const updateReady = useAtomValue(updateReadyAtom);\n  const [setting, setSetting] = useAtom(appSettingAtom);\n  const downloadProgress = useAtomValue(downloadProgressAtom);\n  const [changelogUnread, setChangelogUnread] = useAtom(\n    currentChangelogUnreadAtom\n  );\n\n  const [checkingForUpdates, setCheckingForUpdates] = useAtom(\n    checkingForUpdatesAtom\n  );\n\n  const quitAndInstall = useCallback(() => {\n    track.$.navigationPanel.bottomButtons.quitAndInstall();\n    if (updateReady) {\n      setAppQuitting(true);\n      apis?.updater.quitAndInstall().catch(err => {\n        // TODO(@Peng): add error toast here\n        console.error(err);\n      });\n    }\n  }, [updateReady]);\n\n  const checkForUpdates = useCallback(async () => {\n    track.$.settingsPanel.about.checkUpdates();\n    if (checkingForUpdates) {\n      return;\n    }\n    setCheckingForUpdates(true);\n    try {\n      const updateInfo = await apis?.updater.checkForUpdates();\n      return updateInfo?.version ?? false;\n    } catch (err) {\n      console.error('Error checking for updates:', err);\n      return null;\n    } finally {\n      setCheckingForUpdates(false);\n    }\n  }, [checkingForUpdates, setCheckingForUpdates]);\n\n  const downloadUpdate = useCallback(() => {\n    track.$.settingsPanel.about.downloadUpdate();\n    apis?.updater.downloadUpdate().catch(err => {\n      console.error('Error downloading update:', err);\n    });\n  }, []);\n\n  const toggleAutoDownload = useCallback(\n    (enable: boolean) => {\n      track.$.settingsPanel.about.changeAppSetting({\n        key: 'autoDownload',\n        value: enable,\n      });\n      setSetting({\n        autoDownloadUpdate: enable,\n      });\n    },\n    [setSetting]\n  );\n\n  const toggleAutoCheck = useCallback(\n    (enable: boolean) => {\n      track.$.settingsPanel.about.changeAppSetting({\n        key: 'autoCheckUpdates',\n        value: enable,\n      });\n      setSetting({\n        autoCheckUpdate: enable,\n      });\n    },\n    [setSetting]\n  );\n\n  const openChangelog = useAsyncCallback(async () => {\n    track.$.navigationPanel.bottomButtons.openChangelog();\n    popupWindow(runtimeConfig.changelogUrl);\n    await setChangelogUnread(true);\n  }, [setChangelogUnread]);\n\n  const dismissChangelog = useAsyncCallback(async () => {\n    track.$.navigationPanel.bottomButtons.dismissChangelog();\n    await setChangelogUnread(true);\n  }, [setChangelogUnread]);\n\n  return {\n    quitAndInstall,\n    checkForUpdates,\n    downloadUpdate,\n    toggleAutoDownload,\n    toggleAutoCheck,\n    appQuitting,\n    checkingForUpdates,\n    autoCheck: setting.autoCheckUpdate,\n    autoDownload: setting.autoDownloadUpdate,\n    changelogUnread,\n    openChangelog,\n    dismissChangelog,\n    updateReady,\n    updateAvailable: useAtomValue(updateAvailableAtom),\n    downloadProgress,\n    currentVersion: useAtomValue(currentVersionAtom),\n  };\n};\n","import type { DocCollection, DocMeta } from '@blocksuite/store';\nimport type { Atom } from 'jotai';\nimport { atom, useAtomValue } from 'jotai';\n\nconst weakMap = new WeakMap<DocCollection, Atom<DocMeta[]>>();\n\n// this hook is extracted from './use-block-suite-page-meta.ts' to avoid circular dependency\nexport function useAllBlockSuiteDocMeta(\n  docCollection: DocCollection\n): DocMeta[] {\n  if (!weakMap.has(docCollection)) {\n    const baseAtom = atom<DocMeta[]>([...docCollection.meta.docMetas]);\n    weakMap.set(docCollection, baseAtom);\n    baseAtom.onMount = set => {\n      set([...docCollection.meta.docMetas]);\n      const dispose = docCollection.meta.docMetaUpdated.on(() => {\n        set([...docCollection.meta.docMetas]);\n      });\n      return () => {\n        dispose.dispose();\n      };\n    };\n  }\n  return useAtomValue(weakMap.get(docCollection) as Atom<DocMeta[]>);\n}\n","import type { RootBlockModel } from '@blocksuite/blocks';\nimport { assertExists } from '@blocksuite/global/utils';\nimport type { DocCollection, DocMeta } from '@blocksuite/store';\nimport { useMemo } from 'react';\n\nimport { useAllBlockSuiteDocMeta } from './use-all-block-suite-page-meta';\nimport { useJournalHelper } from './use-journal';\n\n/**\n * Get pageMetas excluding journal pages without updatedDate\n * If you want to get all pageMetas, use `useAllBlockSuitePageMeta` instead\n * @returns\n */\nexport function useBlockSuiteDocMeta(docCollection: DocCollection) {\n  const pageMetas = useAllBlockSuiteDocMeta(docCollection);\n  const { isPageJournal } = useJournalHelper(docCollection);\n  return useMemo(\n    () =>\n      pageMetas.filter(\n        pageMeta => !isPageJournal(pageMeta.id) || !!pageMeta.updatedDate\n      ),\n    [isPageJournal, pageMetas]\n  );\n}\n\nexport function useDocMetaHelper(docCollection: DocCollection) {\n  return useMemo(\n    () => ({\n      setDocTitle: (docId: string, newTitle: string) => {\n        const page = docCollection.getDoc(docId);\n        assertExists(page);\n        const pageBlock = page\n          .getBlockByFlavour('affine:page')\n          .at(0) as RootBlockModel;\n        assertExists(pageBlock);\n        page.transact(() => {\n          pageBlock.title.delete(0, pageBlock.title.length);\n          pageBlock.title.insert(newTitle, 0);\n        });\n        docCollection.meta.setDocMeta(docId, { title: newTitle });\n      },\n      setDocReadonly: (docId: string, readonly: boolean) => {\n        const page = docCollection.getDoc(docId);\n        assertExists(page);\n        page.awarenessStore.setReadonly(page.blockCollection, readonly);\n      },\n      setDocMeta: (docId: string, docMeta: Partial<DocMeta>) => {\n        docCollection.meta.setDocMeta(docId, docMeta);\n      },\n      getDocMeta: (docId: string) => {\n        return docCollection.meta.getDocMeta(docId);\n      },\n    }),\n    [docCollection]\n  );\n}\n","import type { Doc, DocCollection } from '@blocksuite/store';\nimport { useMemo } from 'react';\n\nexport function useDocCollectionHelper(docCollection: DocCollection) {\n  return useMemo(\n    () => ({\n      createDoc: (pageId?: string): Doc => {\n        return docCollection.createDoc({ id: pageId });\n      },\n    }),\n    [docCollection]\n  );\n}\n","import { type DependencyList, type SyntheticEvent } from 'react';\n\nimport { useAsyncCallback } from './affine-async-hooks';\n\nexport const useCatchEventCallback = <\n  E extends SyntheticEvent,\n  Args extends any[],\n>(\n  cb: (e: E, ...args: Args) => void | Promise<void>,\n  deps: DependencyList\n) => {\n  return useAsyncCallback(\n    async (e: E, ...args: Args) => {\n      e.stopPropagation();\n      await cb(e, ...args);\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    deps\n  );\n};\n","import { i18nTime } from '@affine/i18n';\nimport { initEmptyPage, useService } from '@toeverything/infra';\nimport dayjs from 'dayjs';\nimport { useCallback, useMemo } from 'react';\n\nimport { WorkbenchService } from '../modules/workbench';\nimport type { DocCollection } from '../shared';\nimport { useCurrentWorkspacePropertiesAdapter } from './use-affine-adapter';\nimport { useDocCollectionHelper } from './use-block-suite-workspace-helper';\n\ntype MaybeDate = Date | string | number;\nexport const JOURNAL_DATE_FORMAT = 'YYYY-MM-DD';\n\nfunction isJournalString(j?: string | false) {\n  return j ? !!j?.match(/^\\d{4}-\\d{2}-\\d{2}$/) : false;\n}\n\nfunction toDayjs(j?: string | false) {\n  if (!j || !isJournalString(j)) return null;\n  const day = dayjs(j);\n  if (!day.isValid()) return null;\n  return day;\n}\n\nexport const useJournalHelper = (docCollection: DocCollection) => {\n  const bsWorkspaceHelper = useDocCollectionHelper(docCollection);\n  const adapter = useCurrentWorkspacePropertiesAdapter();\n\n  /**\n   * @internal\n   */\n  const _createJournal = useCallback(\n    (maybeDate: MaybeDate) => {\n      const day = dayjs(maybeDate);\n      const title = day.format(JOURNAL_DATE_FORMAT);\n      const page = bsWorkspaceHelper.createDoc();\n      // set created date to match the journal date\n      page.collection.setDocMeta(page.id, {\n        createDate: dayjs()\n          .set('year', day.year())\n          .set('month', day.month())\n          .set('date', day.date())\n          .toDate()\n          .getTime(),\n      });\n      initEmptyPage(page, title);\n      adapter.setJournalPageDateString(page.id, title);\n      return page;\n    },\n    [adapter, bsWorkspaceHelper]\n  );\n\n  const isPageJournal = useCallback(\n    (pageId: string) => {\n      return !!adapter.getJournalPageDateString(pageId);\n    },\n    [adapter]\n  );\n\n  /**\n   * query all journals by date\n   */\n  const getJournalsByDate = useCallback(\n    (maybeDate: MaybeDate) => {\n      const day = dayjs(maybeDate);\n      return Array.from(docCollection.docs.values()).filter(page => {\n        const pageId = page.id;\n        if (!isPageJournal(pageId)) return false;\n        if (page.meta?.trash) return false;\n        const journalDate = adapter.getJournalPageDateString(page.id);\n        if (!journalDate) return false;\n        return day.isSame(journalDate, 'day');\n      });\n    },\n    [adapter, isPageJournal, docCollection.docs]\n  );\n\n  /**\n   * get journal by date, create one if not exist\n   */\n  const getJournalByDate = useCallback(\n    (maybeDate: MaybeDate) => {\n      const pages = getJournalsByDate(maybeDate);\n      if (pages.length) return pages[0].getDoc();\n      return _createJournal(maybeDate);\n    },\n    [_createJournal, getJournalsByDate]\n  );\n\n  const isPageTodayJournal = useCallback(\n    (pageId: string) => {\n      const date = dayjs().format(JOURNAL_DATE_FORMAT);\n      const d = adapter.getJournalPageDateString(pageId);\n      return isPageJournal(pageId) && d === date;\n    },\n    [adapter, isPageJournal]\n  );\n\n  const getJournalDateString = useCallback(\n    (pageId: string) => {\n      return adapter.getJournalPageDateString(pageId);\n    },\n    [adapter]\n  );\n\n  const getLocalizedJournalDateString = useCallback(\n    (pageId: string) => {\n      const journalDateString = getJournalDateString(pageId);\n      if (!journalDateString) return null;\n      return i18nTime(journalDateString, { absolute: { accuracy: 'day' } });\n    },\n    [getJournalDateString]\n  );\n\n  const appendContentToToday = useCallback(\n    async (content: string) => {\n      if (!content) return;\n      const page = getJournalByDate(dayjs().format(JOURNAL_DATE_FORMAT));\n      if (!page) return;\n      const blockId = page.addBlock(\n        'affine:paragraph',\n        { text: new page.Text(content) },\n        page.getBlockByFlavour('affine:note')[0].id\n      );\n      return { page, blockId };\n    },\n    [getJournalByDate]\n  );\n\n  return useMemo(\n    () => ({\n      getJournalsByDate,\n      getJournalByDate,\n      getJournalDateString,\n      getLocalizedJournalDateString,\n      isPageJournal,\n      isPageTodayJournal,\n      appendContentToToday,\n    }),\n    [\n      getJournalsByDate,\n      getJournalByDate,\n      getJournalDateString,\n      getLocalizedJournalDateString,\n      isPageJournal,\n      isPageTodayJournal,\n      appendContentToToday,\n    ]\n  );\n};\n\n// split useJournalRouteHelper since it requires a <Route /> context, which may not work in lit\nexport const useJournalRouteHelper = (docCollection: DocCollection) => {\n  const { getJournalByDate } = useJournalHelper(docCollection);\n  const workbench = useService(WorkbenchService).workbench;\n  /**\n   * open journal by date, create one if not exist\n   */\n  const openJournal = useCallback(\n    (maybeDate: MaybeDate, newTab?: boolean) => {\n      const page = getJournalByDate(maybeDate);\n      workbench.openDoc(page.id, {\n        at: newTab ? 'new-tab' : 'active',\n      });\n      return page.id;\n    },\n    [getJournalByDate, workbench]\n  );\n\n  /**\n   * open today's journal\n   */\n  const openToday = useCallback(\n    (newTab?: boolean) => {\n      const date = dayjs().format(JOURNAL_DATE_FORMAT);\n      return openJournal(date, newTab);\n    },\n    [openJournal]\n  );\n\n  return useMemo(\n    () => ({\n      openJournal,\n      openToday,\n    }),\n    [openJournal, openToday]\n  );\n};\n\nexport const useJournalInfoHelper = (\n  docCollection: DocCollection,\n  pageId?: string | null\n) => {\n  const {\n    isPageJournal,\n    getJournalDateString,\n    getLocalizedJournalDateString,\n    isPageTodayJournal,\n  } = useJournalHelper(docCollection);\n\n  return useMemo(\n    () => ({\n      isJournal: pageId ? isPageJournal(pageId) : false,\n      journalDate: pageId ? toDayjs(getJournalDateString(pageId)) : null,\n      localizedJournalDate: pageId\n        ? getLocalizedJournalDateString(pageId)\n        : null,\n      isTodayJournal: pageId ? isPageTodayJournal(pageId) : false,\n    }),\n    [\n      getJournalDateString,\n      getLocalizedJournalDateString,\n      isPageJournal,\n      isPageTodayJournal,\n      pageId,\n    ]\n  );\n};\n","import type {\n  GraphQLQuery,\n  MutationOptions,\n  QueryResponse,\n  QueryVariables,\n  RecursiveMaybeFields,\n} from '@affine/graphql';\nimport { fetcher } from '@affine/graphql';\nimport type { GraphQLError } from 'graphql';\nimport { useMemo } from 'react';\nimport type { Key } from 'swr';\nimport { useSWRConfig } from 'swr';\nimport type {\n  SWRMutationConfiguration,\n  SWRMutationResponse,\n} from 'swr/mutation';\nimport useSWRMutation from 'swr/mutation';\n\n/**\n * A useSWRMutation wrapper for sending graphql mutations\n *\n * @example\n *\n * ```ts\n * import { someMutation } from '@affine/graphql'\n *\n * const { trigger } = useMutation({\n *  mutation: someMutation,\n * })\n *\n * trigger({ name: 'John Doe' })\n */\nexport function useMutation<Mutation extends GraphQLQuery, K extends Key = Key>(\n  options: Omit<MutationOptions<Mutation>, 'variables'>,\n  config?: Omit<\n    SWRMutationConfiguration<\n      QueryResponse<Mutation>,\n      GraphQLError,\n      K,\n      QueryVariables<Mutation>\n    >,\n    'fetcher'\n  >\n): SWRMutationResponse<\n  QueryResponse<Mutation>,\n  GraphQLError,\n  K,\n  QueryVariables<Mutation>\n>;\nexport function useMutation(\n  options: Omit<MutationOptions<GraphQLQuery>, 'variables'>,\n  config?: any\n) {\n  return useSWRMutation(\n    () => ['cloud', options.mutation.id],\n    (_: unknown[], { arg }: { arg: any }) =>\n      fetcher({ ...options, query: options.mutation, variables: arg }),\n    config\n  );\n}\n\n// use this to revalidate all queries that match the filter\nexport const useMutateQueryResource = () => {\n  const { mutate } = useSWRConfig();\n  const revalidateResource = useMemo(\n    () =>\n      <Q extends GraphQLQuery>(\n        query: Q,\n        varsFilter: (\n          vars: RecursiveMaybeFields<QueryVariables<Q>>\n        ) => boolean = _vars => true\n      ) => {\n        return mutate(key => {\n          const res =\n            Array.isArray(key) &&\n            key[0] === 'cloud' &&\n            key[1] === query.id &&\n            varsFilter(key[2]);\n          if (res) {\n            console.debug('revalidate resource', key);\n          }\n          return res;\n        });\n      },\n    [mutate]\n  );\n\n  return revalidateResource;\n};\n","import type { WorkspaceSubPath } from '@affine/core/shared';\nimport { useCallback, useContext, useMemo } from 'react';\nimport type { NavigateOptions, To } from 'react-router-dom';\n\nimport { NavigateContext, router } from '../router';\n\nexport enum RouteLogic {\n  REPLACE = 'replace',\n  PUSH = 'push',\n}\n\nfunction defaultNavigate(to: To, option?: { replace?: boolean }) {\n  setTimeout(() => {\n    router?.navigate(to, option).catch(err => {\n      console.error('Failed to navigate', err);\n    });\n  }, 100);\n}\n\n// TODO(@eyhn): add a name -> path helper in the results\n/**\n * @deprecated use `WorkbenchService` instead\n */\nexport function useNavigateHelper() {\n  const navigate = useContext(NavigateContext) ?? defaultNavigate;\n\n  const jumpToPage = useCallback(\n    (\n      workspaceId: string,\n      pageId: string,\n      logic: RouteLogic = RouteLogic.PUSH\n    ) => {\n      return navigate(`/workspace/${workspaceId}/${pageId}`, {\n        replace: logic === RouteLogic.REPLACE,\n      });\n    },\n    [navigate]\n  );\n  const jumpToPageBlock = useCallback(\n    (\n      workspaceId: string,\n      pageId: string,\n      blockId: string,\n      logic: RouteLogic = RouteLogic.PUSH\n    ) => {\n      return navigate(`/workspace/${workspaceId}/${pageId}#${blockId}`, {\n        replace: logic === RouteLogic.REPLACE,\n      });\n    },\n    [navigate]\n  );\n  const jumpToCollections = useCallback(\n    (workspaceId: string, logic: RouteLogic = RouteLogic.PUSH) => {\n      return navigate(`/workspace/${workspaceId}/collection`, {\n        replace: logic === RouteLogic.REPLACE,\n      });\n    },\n    [navigate]\n  );\n  const jumpToTags = useCallback(\n    (workspaceId: string, logic: RouteLogic = RouteLogic.PUSH) => {\n      return navigate(`/workspace/${workspaceId}/tag`, {\n        replace: logic === RouteLogic.REPLACE,\n      });\n    },\n    [navigate]\n  );\n  const jumpToTag = useCallback(\n    (\n      workspaceId: string,\n      tagId: string,\n      logic: RouteLogic = RouteLogic.PUSH\n    ) => {\n      return navigate(`/workspace/${workspaceId}/tag/${tagId}`, {\n        replace: logic === RouteLogic.REPLACE,\n      });\n    },\n    [navigate]\n  );\n  const jumpToCollection = useCallback(\n    (\n      workspaceId: string,\n      collectionId: string,\n      logic: RouteLogic = RouteLogic.PUSH\n    ) => {\n      return navigate(`/workspace/${workspaceId}/collection/${collectionId}`, {\n        replace: logic === RouteLogic.REPLACE,\n      });\n    },\n    [navigate]\n  );\n  const jumpToSubPath = useCallback(\n    (\n      workspaceId: string,\n      subPath: WorkspaceSubPath,\n      logic: RouteLogic = RouteLogic.PUSH\n    ) => {\n      return navigate(`/workspace/${workspaceId}/${subPath}`, {\n        replace: logic === RouteLogic.REPLACE,\n      });\n    },\n    [navigate]\n  );\n\n  const openPage = useCallback(\n    (workspaceId: string, pageId: string) => {\n      return jumpToPage(workspaceId, pageId);\n    },\n    [jumpToPage]\n  );\n\n  const jumpToIndex = useCallback(\n    (logic: RouteLogic = RouteLogic.PUSH, opt?: { search?: string }) => {\n      return navigate(\n        { pathname: '/', search: opt?.search },\n        {\n          replace: logic === RouteLogic.REPLACE,\n        }\n      );\n    },\n    [navigate]\n  );\n\n  const jumpTo404 = useCallback(\n    (logic: RouteLogic = RouteLogic.PUSH) => {\n      return navigate('/404', {\n        replace: logic === RouteLogic.REPLACE,\n      });\n    },\n    [navigate]\n  );\n  const jumpToExpired = useCallback(\n    (logic: RouteLogic = RouteLogic.PUSH) => {\n      return navigate('/expired', {\n        replace: logic === RouteLogic.REPLACE,\n      });\n    },\n    [navigate]\n  );\n  const jumpToSignIn = useCallback(\n    (\n      redirectUri?: string,\n      logic: RouteLogic = RouteLogic.PUSH,\n      otherOptions?: Omit<NavigateOptions, 'replace'>,\n      params?: Record<string, string>\n    ) => {\n      const searchParams = new URLSearchParams();\n\n      if (redirectUri) {\n        searchParams.set('redirect_uri', encodeURIComponent(redirectUri));\n      }\n\n      if (params) {\n        for (const key in params) searchParams.set(key, params[key]);\n      }\n\n      return navigate(\n        '/signIn' +\n          (searchParams.toString() ? '?' + searchParams.toString() : ''),\n        {\n          replace: logic === RouteLogic.REPLACE,\n          ...otherOptions,\n        }\n      );\n    },\n    [navigate]\n  );\n\n  const openInApp = useCallback(\n    (schema: string, path: string) => {\n      const encodedUrl = encodeURIComponent(`${schema}://${path}`);\n      return navigate(`/open-app/url?schema=${schema}&url=${encodedUrl}`);\n    },\n    [navigate]\n  );\n\n  return useMemo(\n    () => ({\n      jumpToPage,\n      jumpToPageBlock,\n      jumpToSubPath,\n      jumpToIndex,\n      jumpTo404,\n      openPage,\n      jumpToExpired,\n      jumpToSignIn,\n      jumpToCollection,\n      jumpToCollections,\n      jumpToTags,\n      jumpToTag,\n      openInApp,\n    }),\n    [\n      jumpToPage,\n      jumpToPageBlock,\n      jumpToSubPath,\n      jumpToIndex,\n      jumpTo404,\n      openPage,\n      jumpToExpired,\n      jumpToSignIn,\n      jumpToCollection,\n      jumpToCollections,\n      jumpToTags,\n      jumpToTag,\n      openInApp,\n    ]\n  );\n}\n","import { useCallback, useSyncExternalStore } from 'react';\n\nconst getOnLineStatus = () =>\n  typeof navigator !== 'undefined' && typeof navigator.onLine === 'boolean'\n    ? navigator.onLine\n    : true;\n\nexport function useSystemOnline(): boolean {\n  return useSyncExternalStore(\n    useCallback(onStoreChange => {\n      window.addEventListener('online', onStoreChange);\n      window.addEventListener('offline', onStoreChange);\n      return () => {\n        window.removeEventListener('online', onStoreChange);\n        window.removeEventListener('offline', onStoreChange);\n      };\n    }, []),\n    useCallback(() => getOnLineStatus(), []),\n    useCallback(() => true, [])\n  );\n}\n","import type { WorkspaceMetadata } from '@toeverything/infra';\nimport {\n  useLiveData,\n  useService,\n  WorkspacesService,\n} from '@toeverything/infra';\nimport { useEffect } from 'react';\n\nexport function useWorkspaceInfo(meta: WorkspaceMetadata) {\n  const workspacesService = useService(WorkspacesService);\n\n  const profile = workspacesService.getProfile(meta);\n\n  useEffect(() => {\n    profile.revalidate();\n  }, [meta, profile]);\n\n  return useLiveData(profile.profile$);\n}\n\nexport function useWorkspaceName(meta: WorkspaceMetadata) {\n  const information = useWorkspaceInfo(meta);\n\n  return information?.name;\n}\n","import { DebugLogger } from '@affine/debug';\n\nimport type { CallableEventsChain, EventsUnion } from './types';\n\nconst logger = new DebugLogger('mixpanel');\n\ninterface TrackFn {\n  (event: string, props: Record<string, any>): void;\n}\n\nconst levels = ['page', 'segment', 'module', 'event'] as const;\nexport function makeTracker(trackFn: TrackFn): CallableEventsChain {\n  function makeTrackerInner(level: number, info: Record<string, string>) {\n    const proxy = new Proxy({} as Record<string, any>, {\n      get(target, prop) {\n        if (\n          typeof prop !== 'string' ||\n          prop === '$$typeof' /* webpack hot-reload reads this prop */\n        ) {\n          return undefined;\n        }\n\n        if (levels[level] === 'event') {\n          return (arg: string | Record<string, any>) => {\n            trackFn(prop, {\n              ...info,\n              ...(typeof arg === 'string' ? { arg } : arg),\n            });\n          };\n        } else {\n          let levelProxy = target[prop];\n          if (levelProxy) {\n            return levelProxy;\n          }\n\n          levelProxy = makeTrackerInner(\n            level + 1,\n            prop === '$' ? { ...info } : { ...info, [levels[level]]: prop }\n          );\n          target[prop] = levelProxy;\n          return levelProxy;\n        }\n      },\n    });\n\n    return proxy;\n  }\n\n  return makeTrackerInner(0, {}) as CallableEventsChain;\n}\n\n/**\n * listen on clicking on all subtree elements and auto track events if defined\n *\n * @example\n *\n * ```html\n * <button\n *   data-event-chain='$.cmdk.settings.changeLanguage'\n *   data-event-arg='cn'\n *   <!-- or -->\n *   data-event-args-foo='bar'\n * />\n * ```\n */\nexport function enableAutoTrack(root: HTMLElement, trackFn: TrackFn) {\n  const listener = (e: Event) => {\n    const el = e.target as HTMLElement | null;\n    if (!el) {\n      return;\n    }\n    const dataset = el.dataset;\n\n    if (dataset['eventProps']) {\n      const args: Record<string, any> = {};\n      if (dataset['eventArg'] !== undefined) {\n        args['arg'] = dataset['event-arg'];\n      } else {\n        for (const argName of Object.keys(dataset)) {\n          if (argName.startsWith('eventArgs')) {\n            args[argName.slice(9).toLowerCase()] = dataset[argName];\n          }\n        }\n      }\n\n      const props = dataset['eventProps']\n        .split('.')\n        .map(name => (name === '$' ? undefined : name));\n      if (props.length !== levels.length) {\n        logger.error('Invalid event props on element', el);\n        return;\n      }\n\n      const event = props[3];\n\n      if (!event) {\n        logger.error('Invalid event props on element', el);\n        return;\n      }\n\n      trackFn(event, {\n        page: props[0] as any,\n        segment: props[1],\n        module: props[2],\n        ...args,\n      });\n    }\n  };\n\n  root.addEventListener('click', listener, {});\n  return () => {\n    root.removeEventListener('click', listener);\n  };\n}\n\ndeclare module 'react' {\n  //  we have to declare `T` but it's actually not used\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  interface HTMLAttributes<T> {\n    'data-event-props'?: EventsUnion;\n    'data-event-arg'?: string;\n    'data-event-args-control'?: string;\n  }\n}\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars, unused-imports/no-unused-imports\nimport { DebugLogger } from '@affine/debug';\nimport type { OverridedMixpanel } from 'mixpanel-browser';\nimport mixpanelBrowser from 'mixpanel-browser';\n\nconst logger = new DebugLogger('mixpanel');\n\ntype Middleware = (\n  name: string,\n  properties?: Record<string, unknown>\n) => Record<string, unknown>;\n\nfunction createMixpanel() {\n  let mixpanel;\n  if (process.env.MIXPANEL_TOKEN) {\n    mixpanelBrowser.init(process.env.MIXPANEL_TOKEN || '', {\n      track_pageview: true,\n      persistence: 'localStorage',\n      api_host: 'https://telemetry.affine.run',\n      ignore_dnt: true,\n    });\n    mixpanel = mixpanelBrowser;\n  } else {\n    mixpanel = new Proxy(\n      function () {} as unknown as OverridedMixpanel,\n      createProxyHandler()\n    );\n  }\n\n  const middlewares = new Set<Middleware>();\n\n  const wrapped = {\n    init() {\n      mixpanel.register({\n        appVersion: runtimeConfig.appVersion,\n        environment: runtimeConfig.appBuildType,\n        editorVersion: runtimeConfig.editorVersion,\n        isSelfHosted: Boolean(runtimeConfig.isSelfHosted),\n        isDesktop: environment.isDesktop,\n      });\n    },\n    reset() {\n      mixpanel.reset();\n      this.init();\n    },\n    track(event_name: string, properties?: Record<string, any>) {\n      const middlewareProperties = Array.from(middlewares).reduce(\n        (acc, middleware) => {\n          return middleware(event_name, acc);\n        },\n        properties as Record<string, unknown>\n      );\n      logger.debug('track', event_name, middlewareProperties);\n\n      mixpanel.track(event_name as string, middlewareProperties);\n    },\n    middleware(cb: Middleware): () => void {\n      middlewares.add(cb);\n      return () => {\n        middlewares.delete(cb);\n      };\n    },\n    opt_out_tracking() {\n      mixpanel.opt_out_tracking();\n    },\n    opt_in_tracking() {\n      mixpanel.opt_in_tracking();\n    },\n    has_opted_in_tracking() {\n      mixpanel.has_opted_in_tracking();\n    },\n    has_opted_out_tracking() {\n      mixpanel.has_opted_out_tracking();\n    },\n    identify(unique_id?: string) {\n      mixpanel.identify(unique_id);\n    },\n    get people() {\n      return mixpanel.people;\n    },\n    track_pageview(properties?: { location?: string }) {\n      logger.debug('track_pageview', properties);\n      mixpanel.track_pageview(properties);\n    },\n  };\n\n  return wrapped;\n}\n\nexport const mixpanel = createMixpanel();\nmixpanel.init();\n\nfunction createProxyHandler() {\n  const handler = {\n    get: () => {\n      return new Proxy(\n        function () {} as unknown as OverridedMixpanel,\n        createProxyHandler()\n      );\n    },\n    apply: () => {},\n  } as ProxyHandler<OverridedMixpanel>;\n  return handler;\n}\n","import { enableAutoTrack, makeTracker } from './auto';\nimport { mixpanel } from './mixpanel';\n\nexport const track = makeTracker((event, props) => {\n  mixpanel.track(event, props);\n});\n\nexport { enableAutoTrack, mixpanel };\n","import {\n  backoffRetry,\n  effect,\n  Entity,\n  fromPromise,\n  LiveData,\n  onComplete,\n  onStart,\n} from '@toeverything/infra';\nimport { EMPTY, exhaustMap, mergeMap } from 'rxjs';\n\nimport { validateAndReduceImage } from '../../../utils/reduce-image';\nimport type { AccountProfile, AuthStore } from '../stores/auth';\n\nexport interface AuthSessionInfo {\n  account: AuthAccountInfo;\n}\n\nexport interface AuthAccountInfo {\n  id: string;\n  label: string;\n  email?: string;\n  info?: AccountProfile | null;\n  avatar?: string | null;\n}\n\nexport interface AuthSessionUnauthenticated {\n  status: 'unauthenticated';\n}\n\nexport interface AuthSessionAuthenticated {\n  status: 'authenticated';\n  session: AuthSessionInfo;\n}\n\nexport class AuthSession extends Entity {\n  id = 'affine-cloud' as const;\n\n  session$: LiveData<AuthSessionUnauthenticated | AuthSessionAuthenticated> =\n    LiveData.from(this.store.watchCachedAuthSession(), null).map(session =>\n      session\n        ? {\n            status: 'authenticated',\n            session: session as AuthSessionInfo,\n          }\n        : {\n            status: 'unauthenticated',\n          }\n    );\n\n  status$ = this.session$.map(session => session.status);\n\n  account$ = this.session$.map(session =>\n    session.status === 'authenticated' ? session.session.account : null\n  );\n\n  waitForAuthenticated = (signal?: AbortSignal) =>\n    this.session$.waitFor(\n      session => session.status === 'authenticated',\n      signal\n    ) as Promise<AuthSessionAuthenticated>;\n\n  isRevalidating$ = new LiveData(false);\n\n  constructor(private readonly store: AuthStore) {\n    super();\n  }\n\n  revalidate = effect(\n    exhaustMap(() =>\n      fromPromise(this.getSession()).pipe(\n        backoffRetry({\n          count: Infinity,\n        }),\n        mergeMap(sessionInfo => {\n          this.store.setCachedAuthSession(sessionInfo);\n          return EMPTY;\n        }),\n        onStart(() => {\n          this.isRevalidating$.next(true);\n        }),\n        onComplete(() => {\n          this.isRevalidating$.next(false);\n        })\n      )\n    )\n  );\n\n  private async getSession(): Promise<AuthSessionInfo | null> {\n    const session = await this.store.fetchSession();\n\n    if (session?.user) {\n      const account = {\n        id: session.user.id,\n        email: session.user.email,\n        label: session.user.name,\n        avatar: session.user.avatarUrl,\n        info: session.user,\n      };\n      const result = {\n        account,\n      };\n      return result;\n    } else {\n      return null;\n    }\n  }\n\n  async waitForRevalidation(signal?: AbortSignal) {\n    this.revalidate();\n    await this.isRevalidating$.waitFor(\n      isRevalidating => !isRevalidating,\n      signal\n    );\n  }\n\n  async removeAvatar() {\n    await this.store.removeAvatar();\n    await this.waitForRevalidation();\n  }\n\n  async uploadAvatar(file: File) {\n    const reducedFile = await validateAndReduceImage(file);\n    await this.store.uploadAvatar(reducedFile);\n    await this.waitForRevalidation();\n  }\n\n  async updateLabel(label: string) {\n    await this.store.updateLabel(label);\n    console.log('updateLabel');\n    await this.waitForRevalidation();\n  }\n\n  override dispose(): void {\n    this.revalidate.unsubscribe();\n  }\n}\n","import { FeatureType } from '@affine/graphql';\nimport {\n  backoffRetry,\n  catchErrorInto,\n  effect,\n  Entity,\n  exhaustMapSwitchUntilChanged,\n  fromPromise,\n  LiveData,\n  onComplete,\n  onStart,\n} from '@toeverything/infra';\nimport { EMPTY, map, mergeMap } from 'rxjs';\n\nimport { isBackendError, isNetworkError } from '../error';\nimport type { AuthService } from '../services/auth';\nimport type { UserFeatureStore } from '../stores/user-feature';\n\nexport class UserFeature extends Entity {\n  // undefined means no user, null means loading\n  features$ = new LiveData<FeatureType[] | null | undefined>(null);\n  isEarlyAccess$ = this.features$.map(features =>\n    features === null\n      ? null\n      : features?.some(f => f === FeatureType.EarlyAccess)\n  );\n\n  isRevalidating$ = new LiveData(false);\n  error$ = new LiveData<any | null>(null);\n\n  constructor(\n    private readonly authService: AuthService,\n    private readonly store: UserFeatureStore\n  ) {\n    super();\n  }\n\n  revalidate = effect(\n    map(() => ({\n      accountId: this.authService.session.account$.value?.id,\n    })),\n    exhaustMapSwitchUntilChanged(\n      (a, b) => a.accountId === b.accountId,\n      ({ accountId }) => {\n        return fromPromise(async signal => {\n          if (!accountId) {\n            return; // no feature if no user\n          }\n\n          const { userId, features } = await this.store.getUserFeatures(signal);\n          if (userId !== accountId) {\n            // The user has changed, ignore the result\n            this.authService.session.revalidate();\n            await this.authService.session.waitForRevalidation();\n            return;\n          }\n          return {\n            userId: userId,\n            features: features,\n          };\n        }).pipe(\n          backoffRetry({\n            when: isNetworkError,\n            count: Infinity,\n          }),\n          backoffRetry({\n            when: isBackendError,\n          }),\n          mergeMap(data => {\n            if (data) {\n              this.features$.next(data.features);\n            } else {\n              this.features$.next(null);\n            }\n            return EMPTY;\n          }),\n          catchErrorInto(this.error$),\n          onStart(() => this.isRevalidating$.next(true)),\n          onComplete(() => this.isRevalidating$.next(false))\n        );\n      },\n      () => {\n        // Reset the state when the user is changed\n        this.reset();\n      }\n    )\n  );\n\n  reset() {\n    this.features$.next(null);\n    this.error$.next(null);\n    this.isRevalidating$.next(false);\n  }\n}\n","import type { QuotaQuery } from '@affine/graphql';\nimport {\n  backoffRetry,\n  catchErrorInto,\n  effect,\n  Entity,\n  exhaustMapSwitchUntilChanged,\n  fromPromise,\n  LiveData,\n  onComplete,\n  onStart,\n} from '@toeverything/infra';\nimport { cssVar } from '@toeverything/theme';\nimport bytes from 'bytes';\nimport { EMPTY, map, mergeMap } from 'rxjs';\n\nimport { isBackendError, isNetworkError } from '../error';\nimport type { AuthService } from '../services/auth';\nimport type { UserQuotaStore } from '../stores/user-quota';\n\nexport class UserQuota extends Entity {\n  quota$ = new LiveData<NonNullable<QuotaQuery['currentUser']>['quota']>(null);\n  /** Used storage in bytes */\n  used$ = new LiveData<number | null>(null);\n  /** Formatted used storage */\n  usedFormatted$ = this.used$.map(used =>\n    used !== null ? bytes.format(used) : null\n  );\n  /** Maximum storage limit in bytes */\n  max$ = this.quota$.map(quota => (quota ? quota.storageQuota : null));\n  /** Maximum storage limit formatted */\n  maxFormatted$ = this.max$.map(max => (max ? bytes.format(max) : null));\n\n  /** Percentage of storage used */\n  percent$ = LiveData.computed(get => {\n    const max = get(this.max$);\n    const used = get(this.used$);\n    if (max === null || used === null) {\n      return null;\n    }\n    return Math.min(\n      100,\n      Math.max(0.5, Number(((used / max) * 100).toFixed(4)))\n    );\n  });\n\n  color$ = this.percent$.map(percent =>\n    percent !== null\n      ? percent > 80\n        ? cssVar('errorColor')\n        : cssVar('processingColor')\n      : null\n  );\n\n  isRevalidating$ = new LiveData(false);\n  error$ = new LiveData<any | null>(null);\n\n  constructor(\n    private readonly authService: AuthService,\n    private readonly store: UserQuotaStore\n  ) {\n    super();\n  }\n\n  revalidate = effect(\n    map(() => ({\n      accountId: this.authService.session.account$.value?.id,\n    })),\n    exhaustMapSwitchUntilChanged(\n      (a, b) => a.accountId === b.accountId,\n      ({ accountId }) =>\n        fromPromise(async signal => {\n          if (!accountId) {\n            return; // no quota if no user\n          }\n          const { quota, used } = await this.store.fetchUserQuota(signal);\n\n          return { quota, used };\n        }).pipe(\n          backoffRetry({\n            when: isNetworkError,\n            count: Infinity,\n          }),\n          backoffRetry({\n            when: isBackendError,\n          }),\n          mergeMap(data => {\n            if (data) {\n              const { quota, used } = data;\n              this.quota$.next(quota);\n              this.used$.next(used);\n            } else {\n              this.quota$.next(null);\n              this.used$.next(null);\n            }\n            return EMPTY;\n          }),\n          catchErrorInto(this.error$),\n          onStart(() => this.isRevalidating$.next(true)),\n          onComplete(() => this.isRevalidating$.next(false))\n        ),\n      () => {\n        // Reset the state when the user is changed\n        this.reset();\n      }\n    )\n  );\n\n  reset() {\n    this.quota$.next(null);\n    this.used$.next(null);\n    this.error$.next(null);\n    this.isRevalidating$.next(false);\n  }\n\n  override dispose(): void {\n    this.revalidate.unsubscribe();\n  }\n}\n","export class NetworkError extends Error {\n  constructor(public readonly originError: Error) {\n    super(`Network error: ${originError.message}`);\n    this.stack = originError.stack;\n  }\n}\n\nexport function isNetworkError(error: Error): error is NetworkError {\n  return error instanceof NetworkError;\n}\n\nexport class BackendError extends Error {\n  constructor(public readonly originError: Error) {\n    super(`Server error: ${originError.message}`);\n    this.stack = originError.stack;\n  }\n}\n\nexport function isBackendError(error: Error): error is BackendError {\n  return error instanceof BackendError;\n}\n","import { ApplicationStarted, OnEvent, Service } from '@toeverything/infra';\n\nimport { ServerConfig } from '../entities/server-config';\n\n@OnEvent(ApplicationStarted, e => e.onApplicationStart)\nexport class ServerConfigService extends Service {\n  serverConfig = this.framework.createEntity(ServerConfig);\n\n  private onApplicationStart() {\n    this.serverConfig.revalidate();\n  }\n}\n","import { type CreateCheckoutSessionInput } from '@affine/graphql';\nimport { OnEvent, Service } from '@toeverything/infra';\n\nimport { Subscription } from '../entities/subscription';\nimport { SubscriptionPrices } from '../entities/subscription-prices';\nimport type { SubscriptionStore } from '../stores/subscription';\nimport { AccountChanged } from './auth';\n\n@OnEvent(AccountChanged, e => e.onAccountChanged)\nexport class SubscriptionService extends Service {\n  subscription = this.framework.createEntity(Subscription);\n  prices = this.framework.createEntity(SubscriptionPrices);\n\n  constructor(private readonly store: SubscriptionStore) {\n    super();\n  }\n\n  async createCheckoutSession(input: CreateCheckoutSessionInput) {\n    return await this.store.createCheckoutSession(input);\n  }\n\n  private onAccountChanged() {\n    this.subscription.revalidate();\n  }\n}\n","import { OnEvent, Service } from '@toeverything/infra';\n\nimport { UserCopilotQuota } from '../entities/user-copilot-quota';\nimport { AccountChanged } from './auth';\n\n@OnEvent(AccountChanged, e => e.onAccountChanged)\nexport class UserCopilotQuotaService extends Service {\n  copilotQuota = this.framework.createEntity(UserCopilotQuota);\n\n  private onAccountChanged() {\n    this.copilotQuota.revalidate();\n  }\n}\n","import { OnEvent, Service } from '@toeverything/infra';\nimport type { Socket } from 'socket.io-client';\nimport { Manager } from 'socket.io-client';\n\nimport { getAffineCloudBaseUrl } from '../services/fetch';\nimport { AccountChanged } from './auth';\n\n@OnEvent(AccountChanged, e => e.reconnect)\nexport class WebSocketService extends Service {\n  ioManager: Manager = new Manager(`${getAffineCloudBaseUrl()}/`, {\n    autoConnect: false,\n    transports: ['websocket'],\n    secure: location.protocol === 'https:',\n  });\n  sockets: Set<Socket> = new Set();\n\n  constructor() {\n    super();\n  }\n\n  newSocket(): Socket {\n    const socket = this.ioManager.socket('/');\n    this.sockets.add(socket);\n\n    return socket;\n  }\n\n  reconnect(): void {\n    for (const socket of this.sockets) {\n      socket.disconnect();\n    }\n\n    for (const socket of this.sockets) {\n      socket.connect();\n    }\n  }\n}\n","import {\n  gqlFetcherFactory,\n  type GraphQLQuery,\n  type QueryOptions,\n  type QueryResponse,\n  UserFriendlyError,\n} from '@affine/graphql';\nimport { fromPromise, Service } from '@toeverything/infra';\nimport type { Observable } from 'rxjs';\n\nimport { BackendError } from '../error';\nimport { AuthService } from './auth';\nimport type { FetchService } from './fetch';\n\nexport class GraphQLService extends Service {\n  constructor(private readonly fetcher: FetchService) {\n    super();\n  }\n\n  private readonly rawGql = gqlFetcherFactory('/graphql', this.fetcher.fetch);\n\n  rxGql = <Query extends GraphQLQuery>(\n    options: QueryOptions<Query>\n  ): Observable<QueryResponse<Query>> => {\n    return fromPromise(signal => {\n      return this.gql({\n        ...options,\n        context: {\n          signal,\n          ...options.context,\n        },\n      } as any);\n    });\n  };\n\n  gql = async <Query extends GraphQLQuery>(\n    options: QueryOptions<Query>\n  ): Promise<QueryResponse<Query>> => {\n    try {\n      return await this.rawGql(options);\n    } catch (err) {\n      const standardError = UserFriendlyError.fromAnyError(err);\n\n      if (standardError.status === 403) {\n        this.framework.get(AuthService).session.revalidate();\n      }\n\n      throw new BackendError(standardError);\n    }\n  };\n}\n","import type {\n  OauthProvidersQuery,\n  ServerConfigQuery,\n  ServerFeature,\n} from '@affine/graphql';\nimport {\n  backoffRetry,\n  effect,\n  Entity,\n  fromPromise,\n  LiveData,\n} from '@toeverything/infra';\nimport { EMPTY, exhaustMap, mergeMap } from 'rxjs';\n\nimport type { ServerConfigStore } from '../stores/server-config';\n\ntype LowercaseServerFeature = Lowercase<ServerFeature>;\ntype ServerFeatureRecord = {\n  [key in LowercaseServerFeature]: boolean;\n};\n\nexport type ServerConfigType = ServerConfigQuery['serverConfig'] &\n  OauthProvidersQuery['serverConfig'];\n\nexport class ServerConfig extends Entity {\n  readonly config$ = new LiveData<ServerConfigType | null>(null);\n\n  readonly features$ = this.config$.map(config => {\n    return config\n      ? Array.from(new Set(config.features)).reduce((acc, cur) => {\n          acc[cur.toLowerCase() as LowercaseServerFeature] = true;\n          return acc;\n        }, {} as ServerFeatureRecord)\n      : null;\n  });\n\n  readonly credentialsRequirement$ = this.config$.map(config => {\n    return config ? config.credentialsRequirement : null;\n  });\n\n  constructor(private readonly store: ServerConfigStore) {\n    super();\n  }\n\n  revalidate = effect(\n    exhaustMap(() => {\n      return fromPromise<ServerConfigType>(signal =>\n        this.store.fetchServerConfig(signal)\n      ).pipe(\n        backoffRetry({\n          count: Infinity,\n        }),\n        mergeMap(config => {\n          this.config$.next(config);\n          return EMPTY;\n        })\n      );\n    })\n  );\n\n  revalidateIfNeeded = () => {\n    if (!this.config$.value) {\n      this.revalidate();\n    }\n  };\n\n  override dispose(): void {\n    this.revalidate.unsubscribe();\n  }\n}\n","import { type SubscriptionQuery, SubscriptionRecurring } from '@affine/graphql';\nimport { SubscriptionPlan } from '@affine/graphql';\nimport {\n  backoffRetry,\n  catchErrorInto,\n  effect,\n  Entity,\n  exhaustMapSwitchUntilChanged,\n  fromPromise,\n  LiveData,\n  onComplete,\n  onStart,\n} from '@toeverything/infra';\nimport { EMPTY, map, mergeMap } from 'rxjs';\n\nimport { isBackendError, isNetworkError } from '../error';\nimport type { AuthService } from '../services/auth';\nimport type { ServerConfigService } from '../services/server-config';\nimport type { SubscriptionStore } from '../stores/subscription';\n\nexport type SubscriptionType = NonNullable<\n  SubscriptionQuery['currentUser']\n>['subscriptions'][number];\n\nexport class Subscription extends Entity {\n  // undefined means no user, null means loading\n  subscription$ = new LiveData<SubscriptionType[] | null | undefined>(null);\n  isRevalidating$ = new LiveData(false);\n  error$ = new LiveData<any | null>(null);\n\n  pro$ = this.subscription$.map(subscriptions =>\n    subscriptions\n      ? subscriptions.find(sub => sub.plan === SubscriptionPlan.Pro)\n      : null\n  );\n  ai$ = this.subscription$.map(subscriptions =>\n    subscriptions\n      ? subscriptions.find(sub => sub.plan === SubscriptionPlan.AI)\n      : null\n  );\n  isBeliever$ = this.pro$.map(\n    sub => sub?.recurring === SubscriptionRecurring.Lifetime\n  );\n\n  constructor(\n    private readonly authService: AuthService,\n    private readonly serverConfigService: ServerConfigService,\n    private readonly store: SubscriptionStore\n  ) {\n    super();\n  }\n\n  async resumeSubscription(idempotencyKey: string, plan?: SubscriptionPlan) {\n    await this.store.mutateResumeSubscription(idempotencyKey, plan);\n    await this.waitForRevalidation();\n  }\n\n  async cancelSubscription(idempotencyKey: string, plan?: SubscriptionPlan) {\n    await this.store.mutateCancelSubscription(idempotencyKey, plan);\n    await this.waitForRevalidation();\n  }\n\n  async setSubscriptionRecurring(\n    idempotencyKey: string,\n    recurring: SubscriptionRecurring,\n    plan?: SubscriptionPlan\n  ) {\n    await this.store.setSubscriptionRecurring(idempotencyKey, recurring, plan);\n    await this.waitForRevalidation();\n  }\n\n  async waitForRevalidation(signal?: AbortSignal) {\n    this.revalidate();\n    await this.isRevalidating$.waitFor(\n      isRevalidating => !isRevalidating,\n      signal\n    );\n  }\n\n  revalidate = effect(\n    map(() => ({\n      accountId: this.authService.session.account$.value?.id,\n    })),\n    exhaustMapSwitchUntilChanged(\n      (a, b) => a.accountId === b.accountId,\n      ({ accountId }) => {\n        return fromPromise(async signal => {\n          if (!accountId) {\n            return undefined; // no subscription if no user\n          }\n\n          const serverConfig =\n            await this.serverConfigService.serverConfig.features$.waitForNonNull(\n              signal\n            );\n\n          if (!serverConfig.payment) {\n            // No payment feature, no subscription\n            return {\n              userId: accountId,\n              subscriptions: [],\n            };\n          }\n          const { userId, subscriptions } =\n            await this.store.fetchSubscriptions(signal);\n          if (userId !== accountId) {\n            // The user has changed, ignore the result\n            this.authService.session.revalidate();\n            await this.authService.session.waitForRevalidation();\n            return null;\n          }\n          return {\n            userId: userId,\n            subscriptions: subscriptions,\n          };\n        }).pipe(\n          backoffRetry({\n            when: isNetworkError,\n            count: Infinity,\n          }),\n          backoffRetry({\n            when: isBackendError,\n          }),\n          mergeMap(data => {\n            if (data) {\n              this.store.setCachedSubscriptions(\n                data.userId,\n                data.subscriptions\n              );\n              this.subscription$.next(data.subscriptions);\n            } else {\n              this.subscription$.next(undefined);\n            }\n            return EMPTY;\n          }),\n          catchErrorInto(this.error$),\n          onStart(() => this.isRevalidating$.next(true)),\n          onComplete(() => this.isRevalidating$.next(false))\n        );\n      },\n      ({ accountId }) => {\n        this.reset();\n        if (!accountId) {\n          this.subscription$.next(null);\n        } else {\n          this.subscription$.next(this.store.getCachedSubscriptions(accountId));\n        }\n      }\n    )\n  );\n\n  reset() {\n    this.subscription$.next(null);\n    this.isRevalidating$.next(false);\n    this.error$.next(null);\n  }\n\n  override dispose(): void {\n    this.revalidate.unsubscribe();\n  }\n}\n","import type { PricesQuery } from '@affine/graphql';\nimport {\n  backoffRetry,\n  catchErrorInto,\n  effect,\n  Entity,\n  fromPromise,\n  LiveData,\n  mapInto,\n  onComplete,\n  onStart,\n} from '@toeverything/infra';\nimport { exhaustMap } from 'rxjs';\n\nimport { isBackendError, isNetworkError } from '../error';\nimport type { ServerConfigService } from '../services/server-config';\nimport type { SubscriptionStore } from '../stores/subscription';\n\nexport class SubscriptionPrices extends Entity {\n  prices$ = new LiveData<PricesQuery['prices'] | null>(null);\n  isRevalidating$ = new LiveData(false);\n  error$ = new LiveData<any | null>(null);\n\n  proPrice$ = this.prices$.map(prices =>\n    prices ? prices.find(price => price.plan === 'Pro') : null\n  );\n  aiPrice$ = this.prices$.map(prices =>\n    prices ? prices.find(price => price.plan === 'AI') : null\n  );\n\n  readableLifetimePrice$ = this.proPrice$.map(price =>\n    price?.lifetimeAmount\n      ? `$${(price.lifetimeAmount / 100).toFixed(2).replace(/\\.0+$/, '')}`\n      : ''\n  );\n\n  constructor(\n    private readonly serverConfigService: ServerConfigService,\n    private readonly store: SubscriptionStore\n  ) {\n    super();\n  }\n\n  revalidate = effect(\n    exhaustMap(() => {\n      return fromPromise(async signal => {\n        // ensure server config is loaded\n        this.serverConfigService.serverConfig.revalidateIfNeeded();\n\n        const serverConfig =\n          await this.serverConfigService.serverConfig.features$.waitForNonNull(\n            signal\n          );\n\n        if (!serverConfig.payment) {\n          // No payment feature, no subscription\n          return [];\n        }\n        return this.store.fetchSubscriptionPrices(signal);\n      }).pipe(\n        backoffRetry({\n          when: isNetworkError,\n          count: Infinity,\n        }),\n        backoffRetry({\n          when: isBackendError,\n        }),\n        mapInto(this.prices$),\n        catchErrorInto(this.error$),\n        onStart(() => this.isRevalidating$.next(true)),\n        onComplete(() => this.isRevalidating$.next(false))\n      );\n    })\n  );\n}\n","import {\n  backoffRetry,\n  catchErrorInto,\n  effect,\n  Entity,\n  exhaustMapSwitchUntilChanged,\n  fromPromise,\n  LiveData,\n  onComplete,\n  onStart,\n} from '@toeverything/infra';\nimport { EMPTY, map, mergeMap } from 'rxjs';\n\nimport { isBackendError, isNetworkError } from '../error';\nimport type { AuthService } from '../services/auth';\nimport type { ServerConfigService } from '../services/server-config';\nimport type { UserCopilotQuotaStore } from '../stores/user-copilot-quota';\n\nexport class UserCopilotQuota extends Entity {\n  copilotActionLimit$ = new LiveData<number | 'unlimited' | null>(null);\n  copilotActionUsed$ = new LiveData<number | null>(null);\n\n  isRevalidating$ = new LiveData(false);\n  error$ = new LiveData<any | null>(null);\n\n  constructor(\n    private readonly authService: AuthService,\n    private readonly store: UserCopilotQuotaStore,\n    private readonly serverConfigService: ServerConfigService\n  ) {\n    super();\n  }\n\n  revalidate = effect(\n    map(() => ({\n      accountId: this.authService.session.account$.value?.id,\n    })),\n    exhaustMapSwitchUntilChanged(\n      (a, b) => a.accountId === b.accountId,\n      ({ accountId }) =>\n        fromPromise(async signal => {\n          if (!accountId) {\n            return; // no quota if no user\n          }\n\n          const serverConfig =\n            await this.serverConfigService.serverConfig.features$.waitForNonNull(\n              signal\n            );\n\n          let aiQuota = null;\n\n          if (serverConfig.copilot) {\n            aiQuota = await this.store.fetchUserCopilotQuota(signal);\n          }\n\n          return aiQuota;\n        }).pipe(\n          backoffRetry({\n            when: isNetworkError,\n            count: Infinity,\n          }),\n          backoffRetry({\n            when: isBackendError,\n          }),\n          mergeMap(data => {\n            if (data) {\n              const { limit, used } = data;\n              this.copilotActionUsed$.next(used);\n              this.copilotActionLimit$.next(\n                limit === null ? 'unlimited' : limit\n              ); // fix me: unlimited status\n            } else {\n              this.copilotActionUsed$.next(null);\n              this.copilotActionLimit$.next(null);\n            }\n            return EMPTY;\n          }),\n          catchErrorInto(this.error$),\n          onStart(() => this.isRevalidating$.next(true)),\n          onComplete(() => this.isRevalidating$.next(false))\n        ),\n      () => {\n        // Reset the state when the user is changed\n        this.reset();\n      }\n    )\n  );\n\n  reset() {\n    this.copilotActionUsed$.next(null);\n    this.copilotActionLimit$.next(null);\n    this.error$.next(null);\n    this.isRevalidating$.next(false);\n  }\n\n  override dispose(): void {\n    this.revalidate.unsubscribe();\n  }\n}\n","import {\n  getUserQuery,\n  removeAvatarMutation,\n  updateUserProfileMutation,\n  uploadAvatarMutation,\n} from '@affine/graphql';\nimport type { GlobalStateService } from '@toeverything/infra';\nimport { Store } from '@toeverything/infra';\n\nimport type { AuthSessionInfo } from '../entities/session';\nimport type { FetchService } from '../services/fetch';\nimport type { GraphQLService } from '../services/graphql';\n\nexport interface AccountProfile {\n  id: string;\n  email: string;\n  name: string;\n  hasPassword: boolean;\n  avatarUrl: string | null;\n  emailVerified: string | null;\n}\n\nexport class AuthStore extends Store {\n  constructor(\n    private readonly fetchService: FetchService,\n    private readonly gqlService: GraphQLService,\n    private readonly globalStateService: GlobalStateService\n  ) {\n    super();\n  }\n\n  watchCachedAuthSession() {\n    return this.globalStateService.globalState.watch<AuthSessionInfo>(\n      'affine-cloud-auth'\n    );\n  }\n\n  setCachedAuthSession(session: AuthSessionInfo | null) {\n    this.globalStateService.globalState.set('affine-cloud-auth', session);\n  }\n\n  async fetchSession() {\n    const url = `/api/auth/session`;\n    const options: RequestInit = {\n      headers: {\n        'Content-Type': 'application/json',\n      },\n    };\n\n    const res = await this.fetchService.fetch(url, options);\n    const data = (await res.json()) as {\n      user?: AccountProfile | null;\n    };\n    if (!res.ok)\n      throw new Error('Get session fetch error: ' + JSON.stringify(data));\n    return data; // Return null if data empty\n  }\n\n  async uploadAvatar(file: File) {\n    await this.gqlService.gql({\n      query: uploadAvatarMutation,\n      variables: {\n        avatar: file,\n      },\n    });\n  }\n\n  async removeAvatar() {\n    await this.gqlService.gql({\n      query: removeAvatarMutation,\n    });\n  }\n\n  async updateLabel(label: string) {\n    await this.gqlService.gql({\n      query: updateUserProfileMutation,\n      variables: {\n        input: {\n          name: label,\n        },\n      },\n    });\n  }\n\n  async checkUserByEmail(email: string) {\n    const data = await this.gqlService.gql({\n      query: getUserQuery,\n      variables: {\n        email,\n      },\n    });\n    return {\n      isExist: !!data.user,\n      hasPassword: !!data.user?.hasPassword,\n    };\n  }\n}\n","import {\n  oauthProvidersQuery,\n  serverConfigQuery,\n  ServerFeature,\n} from '@affine/graphql';\nimport { Store } from '@toeverything/infra';\n\nimport type { ServerConfigType } from '../entities/server-config';\nimport type { GraphQLService } from '../services/graphql';\n\nexport class ServerConfigStore extends Store {\n  constructor(private readonly gqlService: GraphQLService) {\n    super();\n  }\n\n  async fetchServerConfig(\n    abortSignal?: AbortSignal\n  ): Promise<ServerConfigType> {\n    const serverConfigData = await this.gqlService.gql({\n      query: serverConfigQuery,\n      context: {\n        signal: abortSignal,\n      },\n    });\n    if (serverConfigData.serverConfig.features.includes(ServerFeature.OAuth)) {\n      const oauthProvidersData = await this.gqlService.gql({\n        query: oauthProvidersQuery,\n        context: {\n          signal: abortSignal,\n        },\n      });\n      return {\n        ...serverConfigData.serverConfig,\n        ...oauthProvidersData.serverConfig,\n      };\n    }\n    return { ...serverConfigData.serverConfig, oauthProviders: [] };\n  }\n}\n","import type {\n  CreateCheckoutSessionInput,\n  SubscriptionRecurring,\n} from '@affine/graphql';\nimport {\n  cancelSubscriptionMutation,\n  createCheckoutSessionMutation,\n  pricesQuery,\n  resumeSubscriptionMutation,\n  SubscriptionPlan,\n  subscriptionQuery,\n  updateSubscriptionMutation,\n} from '@affine/graphql';\nimport type { GlobalCacheService } from '@toeverything/infra';\nimport { Store } from '@toeverything/infra';\n\nimport type { SubscriptionType } from '../entities/subscription';\nimport { getAffineCloudBaseUrl } from '../services/fetch';\nimport type { GraphQLService } from '../services/graphql';\n\nconst SUBSCRIPTION_CACHE_KEY = 'subscription:';\n\nconst getDefaultSubscriptionSuccessCallbackLink = (\n  plan: SubscriptionPlan | null\n) => {\n  const path =\n    plan === SubscriptionPlan.AI ? '/ai-upgrade-success' : '/upgrade-success';\n  const urlString = getAffineCloudBaseUrl() + path;\n  const url = new URL(urlString);\n  if (environment.isDesktop) {\n    url.searchParams.set('schema', window.appInfo.schema);\n  }\n  return url.toString();\n};\n\nexport class SubscriptionStore extends Store {\n  constructor(\n    private readonly gqlService: GraphQLService,\n    private readonly globalCacheService: GlobalCacheService\n  ) {\n    super();\n  }\n\n  async fetchSubscriptions(abortSignal?: AbortSignal) {\n    const data = await this.gqlService.gql({\n      query: subscriptionQuery,\n      context: {\n        signal: abortSignal,\n      },\n    });\n\n    if (!data.currentUser) {\n      throw new Error('No logged in');\n    }\n\n    return {\n      userId: data.currentUser?.id,\n      subscriptions: data.currentUser?.subscriptions,\n    };\n  }\n\n  async mutateResumeSubscription(\n    idempotencyKey: string,\n    plan?: SubscriptionPlan,\n    abortSignal?: AbortSignal\n  ) {\n    const data = await this.gqlService.gql({\n      query: resumeSubscriptionMutation,\n      variables: {\n        idempotencyKey,\n        plan,\n      },\n      context: {\n        signal: abortSignal,\n      },\n    });\n    return data.resumeSubscription;\n  }\n\n  async mutateCancelSubscription(\n    idempotencyKey: string,\n    plan?: SubscriptionPlan,\n    abortSignal?: AbortSignal\n  ) {\n    const data = await this.gqlService.gql({\n      query: cancelSubscriptionMutation,\n      variables: {\n        idempotencyKey,\n        plan,\n      },\n      context: {\n        signal: abortSignal,\n      },\n    });\n    return data.cancelSubscription;\n  }\n\n  getCachedSubscriptions(userId: string) {\n    return this.globalCacheService.globalCache.get<SubscriptionType[]>(\n      SUBSCRIPTION_CACHE_KEY + userId\n    );\n  }\n\n  setCachedSubscriptions(userId: string, subscriptions: SubscriptionType[]) {\n    return this.globalCacheService.globalCache.set(\n      SUBSCRIPTION_CACHE_KEY + userId,\n      subscriptions\n    );\n  }\n\n  setSubscriptionRecurring(\n    idempotencyKey: string,\n    recurring: SubscriptionRecurring,\n    plan?: SubscriptionPlan\n  ) {\n    return this.gqlService.gql({\n      query: updateSubscriptionMutation,\n      variables: {\n        idempotencyKey,\n        plan,\n        recurring,\n      },\n    });\n  }\n\n  async createCheckoutSession(input: CreateCheckoutSessionInput) {\n    const data = await this.gqlService.gql({\n      query: createCheckoutSessionMutation,\n      variables: {\n        input: {\n          ...input,\n          successCallbackLink:\n            input.successCallbackLink ||\n            getDefaultSubscriptionSuccessCallbackLink(input.plan),\n        },\n      },\n    });\n    return data.createCheckoutSession;\n  }\n\n  async fetchSubscriptionPrices(abortSignal?: AbortSignal) {\n    const data = await this.gqlService.gql({\n      query: pricesQuery,\n      context: {\n        signal: abortSignal,\n      },\n    });\n\n    return data.prices;\n  }\n}\n","import { copilotQuotaQuery } from '@affine/graphql';\nimport { Store } from '@toeverything/infra';\n\nimport type { GraphQLService } from '../services/graphql';\n\nexport class UserCopilotQuotaStore extends Store {\n  constructor(private readonly graphqlService: GraphQLService) {\n    super();\n  }\n\n  async fetchUserCopilotQuota(abortSignal?: AbortSignal) {\n    const data = await this.graphqlService.gql({\n      query: copilotQuotaQuery,\n      context: {\n        signal: abortSignal,\n      },\n    });\n\n    if (!data.currentUser) {\n      throw new Error('No logged in');\n    }\n\n    return data.currentUser.copilot.quota;\n  }\n}\n","import { getUserFeaturesQuery } from '@affine/graphql';\nimport { Store } from '@toeverything/infra';\n\nimport type { GraphQLService } from '../services/graphql';\n\nexport class UserFeatureStore extends Store {\n  constructor(private readonly gqlService: GraphQLService) {\n    super();\n  }\n\n  async getUserFeatures(signal: AbortSignal) {\n    const data = await this.gqlService.gql({\n      query: getUserFeaturesQuery,\n      context: {\n        signal,\n      },\n    });\n    return {\n      userId: data.currentUser?.id,\n      features: data.currentUser?.features,\n    };\n  }\n}\n","import { quotaQuery } from '@affine/graphql';\nimport { Store } from '@toeverything/infra';\n\nimport type { GraphQLService } from '../services/graphql';\n\nexport class UserQuotaStore extends Store {\n  constructor(private readonly graphqlService: GraphQLService) {\n    super();\n  }\n\n  async fetchUserQuota(abortSignal?: AbortSignal) {\n    const data = await this.graphqlService.gql({\n      query: quotaQuery,\n      context: {\n        signal: abortSignal,\n      },\n    });\n\n    if (!data.currentUser) {\n      throw new Error('No logged in');\n    }\n\n    return {\n      userId: data.currentUser.id,\n      quota: data.currentUser.quota,\n      used: data.collectAllBlobSizes.size,\n    };\n  }\n}\n","export type { AuthAccountInfo } from './entities/session';\nexport {\n  BackendError,\n  isBackendError,\n  isNetworkError,\n  NetworkError,\n} from './error';\nexport { AccountChanged, AuthService } from './services/auth';\nexport { FetchService } from './services/fetch';\nexport { GraphQLService } from './services/graphql';\nexport { ServerConfigService } from './services/server-config';\nexport { SubscriptionService } from './services/subscription';\nexport { UserCopilotQuotaService } from './services/user-copilot-quota';\nexport { UserFeatureService } from './services/user-feature';\nexport { UserQuotaService } from './services/user-quota';\nexport { WebSocketService } from './services/websocket';\n\nimport {\n  type Framework,\n  GlobalCacheService,\n  GlobalStateService,\n} from '@toeverything/infra';\n\nimport { ServerConfig } from './entities/server-config';\nimport { AuthSession } from './entities/session';\nimport { Subscription } from './entities/subscription';\nimport { SubscriptionPrices } from './entities/subscription-prices';\nimport { UserCopilotQuota } from './entities/user-copilot-quota';\nimport { UserFeature } from './entities/user-feature';\nimport { UserQuota } from './entities/user-quota';\nimport { AuthService } from './services/auth';\nimport { FetchService } from './services/fetch';\nimport { GraphQLService } from './services/graphql';\nimport { ServerConfigService } from './services/server-config';\nimport { SubscriptionService } from './services/subscription';\nimport { UserCopilotQuotaService } from './services/user-copilot-quota';\nimport { UserFeatureService } from './services/user-feature';\nimport { UserQuotaService } from './services/user-quota';\nimport { WebSocketService } from './services/websocket';\nimport { AuthStore } from './stores/auth';\nimport { ServerConfigStore } from './stores/server-config';\nimport { SubscriptionStore } from './stores/subscription';\nimport { UserCopilotQuotaStore } from './stores/user-copilot-quota';\nimport { UserFeatureStore } from './stores/user-feature';\nimport { UserQuotaStore } from './stores/user-quota';\n\nexport function configureCloudModule(framework: Framework) {\n  framework\n    .service(FetchService)\n    .service(GraphQLService, [FetchService])\n    .service(WebSocketService)\n    .service(ServerConfigService)\n    .entity(ServerConfig, [ServerConfigStore])\n    .store(ServerConfigStore, [GraphQLService])\n    .service(AuthService, [FetchService, AuthStore])\n    .store(AuthStore, [FetchService, GraphQLService, GlobalStateService])\n    .entity(AuthSession, [AuthStore])\n    .service(SubscriptionService, [SubscriptionStore])\n    .store(SubscriptionStore, [GraphQLService, GlobalCacheService])\n    .entity(Subscription, [AuthService, ServerConfigService, SubscriptionStore])\n    .entity(SubscriptionPrices, [ServerConfigService, SubscriptionStore])\n    .service(UserQuotaService)\n    .store(UserQuotaStore, [GraphQLService])\n    .entity(UserQuota, [AuthService, UserQuotaStore])\n    .service(UserCopilotQuotaService)\n    .store(UserCopilotQuotaStore, [GraphQLService])\n    .entity(UserCopilotQuota, [\n      AuthService,\n      UserCopilotQuotaStore,\n      ServerConfigService,\n    ])\n    .service(UserFeatureService)\n    .entity(UserFeature, [AuthService, UserFeatureStore])\n    .store(UserFeatureStore, [GraphQLService]);\n}\n","import { AIProvider } from '@affine/core/blocksuite/presets/ai';\nimport { apis } from '@affine/electron-api';\nimport type { OAuthProviderType } from '@affine/graphql';\nimport {\n  ApplicationFocused,\n  ApplicationStarted,\n  createEvent,\n  OnEvent,\n  Service,\n} from '@toeverything/infra';\nimport { distinctUntilChanged, map, skip } from 'rxjs';\n\nimport { type AuthAccountInfo, AuthSession } from '../entities/session';\nimport type { AuthStore } from '../stores/auth';\nimport type { FetchService } from './fetch';\n\n// Emit when account changed\nexport const AccountChanged = createEvent<AuthAccountInfo | null>(\n  'AccountChanged'\n);\n\nexport const AccountLoggedIn = createEvent<AuthAccountInfo>('AccountLoggedIn');\n\nexport const AccountLoggedOut =\n  createEvent<AuthAccountInfo>('AccountLoggedOut');\n\nfunction toAIUserInfo(account: AuthAccountInfo | null) {\n  if (!account) return null;\n  return {\n    avatarUrl: account.avatar ?? '',\n    email: account.email ?? '',\n    id: account.id,\n    name: account.label,\n  };\n}\n\n@OnEvent(ApplicationStarted, e => e.onApplicationStart)\n@OnEvent(ApplicationFocused, e => e.onApplicationFocused)\nexport class AuthService extends Service {\n  session = this.framework.createEntity(AuthSession);\n\n  constructor(\n    private readonly fetchService: FetchService,\n    private readonly store: AuthStore\n  ) {\n    super();\n\n    AIProvider.provide('userInfo', () => {\n      return toAIUserInfo(this.session.account$.value);\n    });\n\n    this.session.account$\n      .pipe(\n        map(a => ({\n          id: a?.id,\n          account: a,\n        })),\n        distinctUntilChanged((a, b) => a.id === b.id), // only emit when the value changes\n        skip(1) // skip the initial value\n      )\n      .subscribe(({ account }) => {\n        if (account === null) {\n          this.eventBus.emit(AccountLoggedOut, account);\n        } else {\n          this.eventBus.emit(AccountLoggedIn, account);\n        }\n        this.eventBus.emit(AccountChanged, account);\n        AIProvider.slots.userInfo.emit(toAIUserInfo(account));\n      });\n  }\n\n  private onApplicationStart() {\n    this.session.revalidate();\n  }\n\n  private onApplicationFocused() {\n    this.session.revalidate();\n  }\n\n  async sendEmailMagicLink(\n    email: string,\n    verifyToken: string,\n    challenge?: string,\n    redirectUri?: string | null\n  ) {\n    const searchParams = new URLSearchParams();\n    if (challenge) {\n      searchParams.set('challenge', challenge);\n    }\n    searchParams.set('token', verifyToken);\n    const redirect = environment.isDesktop\n      ? this.buildRedirectUri('/open-app/signin-redirect')\n      : (redirectUri ?? location.href);\n    searchParams.set('redirect_uri', redirect.toString());\n\n    const res = await this.fetchService.fetch(\n      '/api/auth/sign-in?' + searchParams.toString(),\n      {\n        method: 'POST',\n        body: JSON.stringify({ email }),\n        headers: {\n          'content-type': 'application/json',\n        },\n      }\n    );\n    if (!res?.ok) {\n      throw new Error('Failed to send email');\n    }\n  }\n\n  async signInOauth(provider: OAuthProviderType, redirectUri?: string | null) {\n    if (environment.isDesktop) {\n      await apis?.ui.openExternal(\n        `${\n          runtimeConfig.serverUrlPrefix\n        }/desktop-signin?provider=${provider}&redirect_uri=${this.buildRedirectUri(\n          '/open-app/signin-redirect'\n        )}`\n      );\n    } else {\n      location.href = `${\n        runtimeConfig.serverUrlPrefix\n      }/oauth/login?provider=${provider}&redirect_uri=${encodeURIComponent(\n        redirectUri ?? location.pathname\n      )}`;\n    }\n\n    return;\n  }\n\n  async signInPassword(credential: { email: string; password: string }) {\n    const searchParams = new URLSearchParams();\n    const redirectUri = new URL(location.href);\n    if (environment.isDesktop) {\n      redirectUri.pathname = this.buildRedirectUri('/open-app/signin-redirect');\n    }\n    searchParams.set('redirect_uri', redirectUri.toString());\n\n    const res = await this.fetchService.fetch(\n      '/api/auth/sign-in?' + searchParams.toString(),\n      {\n        method: 'POST',\n        body: JSON.stringify(credential),\n        headers: {\n          'content-type': 'application/json',\n        },\n      }\n    );\n    if (!res.ok) {\n      throw new Error('Failed to sign in');\n    }\n    this.session.revalidate();\n  }\n\n  async signOut() {\n    await this.fetchService.fetch('/api/auth/sign-out');\n    this.store.setCachedAuthSession(null);\n    this.session.revalidate();\n  }\n\n  private buildRedirectUri(callbackUrl: string) {\n    const params: string[][] = [];\n    if (environment.isDesktop && window.appInfo.schema) {\n      params.push(['schema', window.appInfo.schema]);\n    }\n    const query =\n      params.length > 0\n        ? '?' +\n          params.map(([k, v]) => `${k}=${encodeURIComponent(v)}`).join('&')\n        : '';\n    return callbackUrl + query;\n  }\n\n  checkUserByEmail(email: string) {\n    return this.store.checkUserByEmail(email);\n  }\n}\n","import { DebugLogger } from '@affine/debug';\nimport { UserFriendlyError } from '@affine/graphql';\nimport { fromPromise, Service } from '@toeverything/infra';\n\nimport { BackendError, NetworkError } from '../error';\n\nexport function getAffineCloudBaseUrl(): string {\n  if (environment.isDesktop) {\n    return runtimeConfig.serverUrlPrefix;\n  }\n  const { protocol, hostname, port } = window.location;\n  return `${protocol}//${hostname}${port ? `:${port}` : ''}`;\n}\n\nconst logger = new DebugLogger('affine:fetch');\n\nexport type FetchInit = RequestInit & { timeout?: number };\n\nexport class FetchService extends Service {\n  rxFetch = (\n    input: string,\n    init?: RequestInit & {\n      // https://github.com/microsoft/TypeScript/issues/54472\n      priority?: 'auto' | 'low' | 'high';\n    } & {\n      traceEvent?: string;\n    }\n  ) => {\n    return fromPromise(signal => {\n      return this.fetch(input, { signal, ...init });\n    });\n  };\n\n  /**\n   * fetch with custom custom timeout and error handling.\n   */\n  fetch = async (input: string, init?: FetchInit): Promise<Response> => {\n    logger.debug('fetch', input);\n    const externalSignal = init?.signal;\n    if (externalSignal?.aborted) {\n      throw externalSignal.reason;\n    }\n    const abortController = new AbortController();\n    externalSignal?.addEventListener('abort', reason => {\n      abortController.abort(reason);\n    });\n\n    const timeout = init?.timeout ?? 15000;\n    const timeoutId = setTimeout(() => {\n      abortController.abort('timeout');\n    }, timeout);\n\n    const res = await fetch(new URL(input, getAffineCloudBaseUrl()), {\n      ...init,\n      signal: abortController.signal,\n    }).catch(err => {\n      logger.debug('network error', err);\n      throw new NetworkError(err);\n    });\n    clearTimeout(timeoutId);\n    if (res.status === 504) {\n      const error = new Error('Gateway Timeout');\n      logger.debug('network error', error);\n      throw new NetworkError(error);\n    }\n    if (!res.ok) {\n      logger.warn(\n        'backend error',\n        new Error(`${res.status} ${res.statusText}`)\n      );\n      let reason: string | any = '';\n      if (res.headers.get('Content-Type')?.includes('application/json')) {\n        try {\n          reason = await res.json();\n        } catch (err) {\n          // ignore\n        }\n      }\n      throw new BackendError(UserFriendlyError.fromAnyError(reason));\n    }\n    return res;\n  };\n}\n","import { OnEvent, Service } from '@toeverything/infra';\n\nimport { UserFeature } from '../entities/user-feature';\nimport { AccountChanged } from './auth';\n\n@OnEvent(AccountChanged, e => e.onAccountChanged)\nexport class UserFeatureService extends Service {\n  userFeature = this.framework.createEntity(UserFeature);\n\n  private onAccountChanged() {\n    this.userFeature.revalidate();\n  }\n}\n","import type { QuotaQuery } from '@affine/graphql';\nimport { createEvent, OnEvent, Service } from '@toeverything/infra';\n\nimport { UserQuota } from '../entities/user-quota';\nimport { AccountChanged } from './auth';\n\ntype UserQuotaInfo = NonNullable<QuotaQuery['currentUser']>['quota'];\n\nexport const UserQuotaChanged = createEvent<UserQuotaInfo>('UserQuotaChanged');\n\n@OnEvent(AccountChanged, e => e.onAccountChanged)\nexport class UserQuotaService extends Service {\n  constructor() {\n    super();\n\n    this.quota.quota$.distinctUntilChanged().subscribe(q => {\n      this.eventBus.emit(UserQuotaChanged, q);\n    });\n  }\n\n  quota = this.framework.createEntity(UserQuota);\n\n  private onAccountChanged() {\n    this.quota.revalidate();\n  }\n}\n","import type {\n  Collection,\n  DeleteCollectionInfo,\n  DeletedCollection,\n} from '@affine/env/filter';\nimport type { WorkspaceService } from '@toeverything/infra';\nimport { LiveData, Service } from '@toeverything/infra';\nimport { Observable } from 'rxjs';\nimport { Array as YArray } from 'yjs';\n\nconst SETTING_KEY = 'setting';\n\nconst COLLECTIONS_KEY = 'collections';\nconst COLLECTIONS_TRASH_KEY = 'collections_trash';\n\nexport class CollectionService extends Service {\n  constructor(private readonly workspaceService: WorkspaceService) {\n    super();\n  }\n\n  private get doc() {\n    return this.workspaceService.workspace.docCollection.doc;\n  }\n\n  private get setting() {\n    return this.workspaceService.workspace.docCollection.doc.getMap(\n      SETTING_KEY\n    );\n  }\n\n  private get collectionsYArray(): YArray<Collection> | undefined {\n    return this.setting.get(COLLECTIONS_KEY) as YArray<Collection>;\n  }\n\n  private get collectionsTrashYArray(): YArray<DeletedCollection> | undefined {\n    return this.setting.get(COLLECTIONS_TRASH_KEY) as YArray<DeletedCollection>;\n  }\n\n  readonly collections$ = LiveData.from(\n    new Observable<Collection[]>(subscriber => {\n      subscriber.next(this.collectionsYArray?.toArray() ?? []);\n      const fn = () => {\n        subscriber.next(this.collectionsYArray?.toArray() ?? []);\n      };\n      this.setting.observeDeep(fn);\n      return () => {\n        this.setting.unobserveDeep(fn);\n      };\n    }),\n    []\n  );\n\n  collection$(id: string) {\n    return this.collections$.map(collections => {\n      return collections.find(v => v.id === id);\n    });\n  }\n\n  readonly collectionsTrash$ = LiveData.from(\n    new Observable<DeletedCollection[]>(subscriber => {\n      subscriber.next(this.collectionsTrashYArray?.toArray() ?? []);\n      const fn = () => {\n        subscriber.next(this.collectionsTrashYArray?.toArray() ?? []);\n      };\n      this.setting.observeDeep(fn);\n      return () => {\n        this.setting.unobserveDeep(fn);\n      };\n    }),\n    []\n  );\n\n  addCollection(...collections: Collection[]) {\n    if (!this.setting.has(COLLECTIONS_KEY)) {\n      this.setting.set(COLLECTIONS_KEY, new YArray());\n    }\n    this.doc.transact(() => {\n      this.collectionsYArray?.insert(0, collections);\n    });\n  }\n\n  updateCollection(id: string, updater: (value: Collection) => Collection) {\n    if (this.collectionsYArray) {\n      updateFirstOfYArray(\n        this.collectionsYArray,\n        v => v.id === id,\n        v => {\n          return updater(v);\n        }\n      );\n    }\n  }\n\n  addPageToCollection(collectionId: string, pageId: string) {\n    this.updateCollection(collectionId, old => {\n      return {\n        ...old,\n        allowList: [pageId, ...(old.allowList ?? [])],\n      };\n    });\n  }\n\n  deletePageFromCollection(collectionId: string, pageId: string) {\n    this.updateCollection(collectionId, old => {\n      return {\n        ...old,\n        allowList: old.allowList?.filter(id => id !== pageId),\n      };\n    });\n  }\n\n  deleteCollection(info: DeleteCollectionInfo, ...ids: string[]) {\n    const collectionsYArray = this.collectionsYArray;\n    if (!collectionsYArray) {\n      return;\n    }\n    const set = new Set(ids);\n    this.workspaceService.workspace.docCollection.doc.transact(() => {\n      const indexList: number[] = [];\n      const list: Collection[] = [];\n      collectionsYArray.forEach((collection, i) => {\n        if (set.has(collection.id)) {\n          set.delete(collection.id);\n          indexList.unshift(i);\n          list.push(JSON.parse(JSON.stringify(collection)));\n        }\n      });\n      indexList.forEach(i => {\n        collectionsYArray.delete(i);\n      });\n      if (!this.collectionsTrashYArray) {\n        this.setting.set(COLLECTIONS_TRASH_KEY, new YArray());\n      }\n      const collectionsTrashYArray = this.collectionsTrashYArray;\n      if (!collectionsTrashYArray) {\n        return;\n      }\n      collectionsTrashYArray.insert(\n        0,\n        list.map(collection => ({\n          userId: info?.userId,\n          userName: info ? info.userName : 'Local User',\n          collection,\n        }))\n      );\n      if (collectionsTrashYArray.length > 10) {\n        collectionsTrashYArray.delete(10, collectionsTrashYArray.length - 10);\n      }\n    });\n  }\n\n  private deletePagesFromCollection(\n    collection: Collection,\n    idSet: Set<string>\n  ) {\n    const newAllowList = collection.allowList.filter(id => !idSet.has(id));\n    if (newAllowList.length !== collection.allowList.length) {\n      this.updateCollection(collection.id, old => {\n        return {\n          ...old,\n          allowList: newAllowList,\n        };\n      });\n    }\n  }\n\n  deletePagesFromCollections(ids: string[]) {\n    const idSet = new Set(ids);\n    this.doc.transact(() => {\n      this.collections$.value.forEach(collection => {\n        this.deletePagesFromCollection(collection, idSet);\n      });\n    });\n  }\n}\n\nconst updateFirstOfYArray = <T>(\n  array: YArray<T>,\n  p: (value: T) => boolean,\n  update: (value: T) => T\n) => {\n  array.doc?.transact(() => {\n    for (let i = 0; i < array.length; i++) {\n      const ele = array.get(i);\n      if (p(ele)) {\n        array.delete(i);\n        array.insert(i, [update(ele)]);\n        return;\n      }\n    }\n  });\n};\n","export { CollectionService } from './services/collection';\n\nimport {\n  type Framework,\n  WorkspaceScope,\n  WorkspaceService,\n} from '@toeverything/infra';\n\nimport { CollectionService } from './services/collection';\n\nexport function configureCollectionModule(framework: Framework) {\n  framework\n    .scope(WorkspaceScope)\n    .service(CollectionService, [WorkspaceService]);\n}\n","import type { DocService } from '@toeverything/infra';\nimport { Entity, LiveData } from '@toeverything/infra';\n\nimport type { DocsSearchService } from '../../docs-search';\n\ninterface Backlink {\n  docId: string;\n  blockId: string;\n  title: string;\n}\n\nexport class DocBacklinks extends Entity {\n  constructor(\n    private readonly docsSearchService: DocsSearchService,\n    private readonly docService: DocService\n  ) {\n    super();\n  }\n\n  backlinks$ = LiveData.from<Backlink[]>(\n    this.docsSearchService.watchRefsTo(this.docService.doc.id),\n    []\n  );\n}\n","import type { DocService } from '@toeverything/infra';\nimport { Entity, LiveData } from '@toeverything/infra';\n\nimport type { DocsSearchService } from '../../docs-search';\n\ninterface Link {\n  docId: string;\n  title: string;\n}\n\nexport class DocLinks extends Entity {\n  constructor(\n    private readonly docsSearchService: DocsSearchService,\n    private readonly docService: DocService\n  ) {\n    super();\n  }\n\n  links$ = LiveData.from<Link[]>(\n    this.docsSearchService.watchRefsFrom(this.docService.doc.id),\n    []\n  );\n}\n","import { Service } from '@toeverything/infra';\n\nimport { DocBacklinks } from '../entities/doc-backlinks';\nimport { DocLinks } from '../entities/doc-links';\n\nexport class DocLinksService extends Service {\n  backlinks = this.framework.createEntity(DocBacklinks);\n  links = this.framework.createEntity(DocLinks);\n}\n","import {\n  DocScope,\n  DocService,\n  type Framework,\n  WorkspaceScope,\n} from '@toeverything/infra';\n\nimport { DocsSearchService } from '../docs-search';\nimport { DocBacklinks } from './entities/doc-backlinks';\nimport { DocLinks } from './entities/doc-links';\nimport { DocLinksService } from './services/doc-links';\n\nexport { DocLinksService } from './services/doc-links';\n\nexport function configureDocLinksModule(framework: Framework) {\n  framework\n    .scope(WorkspaceScope)\n    .scope(DocScope)\n    .service(DocLinksService)\n    .entity(DocBacklinks, [DocsSearchService, DocService])\n    .entity(DocLinks, [DocsSearchService, DocService]);\n}\n","import {\n  fromPromise,\n  OnEvent,\n  Service,\n  WorkspaceEngineBeforeStart,\n} from '@toeverything/infra';\nimport { type Observable, switchMap } from 'rxjs';\n\nimport { DocsIndexer } from '../entities/docs-indexer';\n\n@OnEvent(WorkspaceEngineBeforeStart, s => s.handleWorkspaceEngineBeforeStart)\nexport class DocsSearchService extends Service {\n  readonly indexer = this.framework.createEntity(DocsIndexer);\n\n  handleWorkspaceEngineBeforeStart() {\n    this.indexer.setupListener();\n    this.indexer.startCrawling();\n  }\n\n  async search(query: string): Promise<\n    {\n      docId: string;\n      title: string;\n      score: number;\n      blockId?: string;\n      blockContent?: string;\n    }[]\n  > {\n    const { buckets } = await this.indexer.blockIndex.aggregate(\n      {\n        type: 'boolean',\n        occur: 'must',\n        queries: [\n          {\n            type: 'match',\n            field: 'content',\n            match: query,\n          },\n          {\n            type: 'boolean',\n            occur: 'should',\n            queries: [\n              {\n                type: 'all',\n              },\n              {\n                type: 'boost',\n                boost: 1.5,\n                query: {\n                  type: 'match',\n                  field: 'flavour',\n                  match: 'affine:page',\n                },\n              },\n            ],\n          },\n        ],\n      },\n      'docId',\n      {\n        pagination: {\n          limit: 50,\n          skip: 0,\n        },\n        hits: {\n          pagination: {\n            limit: 2,\n            skip: 0,\n          },\n          fields: ['blockId', 'flavour'],\n          highlights: [\n            {\n              field: 'content',\n              before: '<b>',\n              end: '</b>',\n            },\n          ],\n        },\n      }\n    );\n\n    const docData = await this.indexer.docIndex.getAll(\n      buckets.map(bucket => bucket.key)\n    );\n\n    const result = [];\n\n    for (const bucket of buckets) {\n      const firstMatchFlavour = bucket.hits.nodes[0]?.fields.flavour;\n      if (firstMatchFlavour === 'affine:page') {\n        // is title match\n        const blockContent = bucket.hits.nodes[1]?.highlights.content[0]; // try to get block content\n        result.push({\n          docId: bucket.key,\n          title: bucket.hits.nodes[0].highlights.content[0],\n          score: bucket.score,\n          blockContent,\n        });\n      } else {\n        const title =\n          docData.find(doc => doc.id === bucket.key)?.get('title') ?? '';\n        const matchedBlockId = bucket.hits.nodes[0]?.fields.blockId;\n        // is block match\n        result.push({\n          docId: bucket.key,\n          title: typeof title === 'string' ? title : title[0],\n          blockId:\n            typeof matchedBlockId === 'string'\n              ? matchedBlockId\n              : matchedBlockId[0],\n          score: bucket.score,\n          blockContent: bucket.hits.nodes[0]?.highlights.content[0],\n        });\n      }\n    }\n\n    return result;\n  }\n\n  search$(query: string): Observable<\n    {\n      docId: string;\n      title: string;\n      score: number;\n      blockId?: string;\n      blockContent?: string;\n    }[]\n  > {\n    return this.indexer.blockIndex\n      .aggregate$(\n        {\n          type: 'boolean',\n          occur: 'must',\n          queries: [\n            {\n              type: 'match',\n              field: 'content',\n              match: query,\n            },\n            {\n              type: 'boolean',\n              occur: 'should',\n              queries: [\n                {\n                  type: 'all',\n                },\n                {\n                  type: 'boost',\n                  boost: 1.5,\n                  query: {\n                    type: 'match',\n                    field: 'flavour',\n                    match: 'affine:page',\n                  },\n                },\n              ],\n            },\n          ],\n        },\n        'docId',\n        {\n          pagination: {\n            limit: 50,\n            skip: 0,\n          },\n          hits: {\n            pagination: {\n              limit: 2,\n              skip: 0,\n            },\n            fields: ['blockId', 'flavour'],\n            highlights: [\n              {\n                field: 'content',\n                before: '<b>',\n                end: '</b>',\n              },\n            ],\n          },\n        }\n      )\n      .pipe(\n        switchMap(({ buckets }) => {\n          return fromPromise(async () => {\n            const docData = await this.indexer.docIndex.getAll(\n              buckets.map(bucket => bucket.key)\n            );\n\n            const result = [];\n\n            for (const bucket of buckets) {\n              const firstMatchFlavour = bucket.hits.nodes[0]?.fields.flavour;\n              if (firstMatchFlavour === 'affine:page') {\n                // is title match\n                const blockContent =\n                  bucket.hits.nodes[1]?.highlights.content[0]; // try to get block content\n                result.push({\n                  docId: bucket.key,\n                  title: bucket.hits.nodes[0].highlights.content[0],\n                  score: bucket.score,\n                  blockContent,\n                });\n              } else {\n                const title =\n                  docData.find(doc => doc.id === bucket.key)?.get('title') ??\n                  '';\n                const matchedBlockId = bucket.hits.nodes[0]?.fields.blockId;\n                // is block match\n                result.push({\n                  docId: bucket.key,\n                  title: typeof title === 'string' ? title : title[0],\n                  blockId:\n                    typeof matchedBlockId === 'string'\n                      ? matchedBlockId\n                      : matchedBlockId[0],\n                  score: bucket.score,\n                  blockContent: bucket.hits.nodes[0]?.highlights.content[0],\n                });\n              }\n            }\n\n            return result;\n          });\n        })\n      );\n  }\n\n  async searchRefsFrom(docId: string): Promise<\n    {\n      docId: string;\n      title: string;\n    }[]\n  > {\n    const { nodes } = await this.indexer.blockIndex.search(\n      {\n        type: 'boolean',\n        occur: 'must',\n        queries: [\n          {\n            type: 'match',\n            field: 'docId',\n            match: docId,\n          },\n          {\n            type: 'exists',\n            field: 'ref',\n          },\n        ],\n      },\n      {\n        fields: ['ref'],\n        pagination: {\n          limit: 100,\n        },\n      }\n    );\n\n    const docIds = new Set(\n      nodes.flatMap(node => {\n        const refs = node.fields.ref;\n        return typeof refs === 'string' ? [refs] : refs;\n      })\n    );\n\n    const docData = await this.indexer.docIndex.getAll(Array.from(docIds));\n\n    return docData.map(doc => {\n      const title = doc.get('title');\n      return {\n        docId: doc.id,\n        title: title ? (typeof title === 'string' ? title : title[0]) : '',\n      };\n    });\n  }\n\n  watchRefsFrom(docId: string) {\n    return this.indexer.blockIndex\n      .search$(\n        {\n          type: 'boolean',\n          occur: 'must',\n          queries: [\n            {\n              type: 'match',\n              field: 'docId',\n              match: docId,\n            },\n            {\n              type: 'exists',\n              field: 'ref',\n            },\n          ],\n        },\n        {\n          fields: ['ref'],\n          pagination: {\n            limit: 100,\n          },\n        }\n      )\n      .pipe(\n        switchMap(({ nodes }) => {\n          return fromPromise(async () => {\n            const docIds = new Set(\n              nodes.flatMap(node => {\n                const refs = node.fields.ref;\n                return typeof refs === 'string' ? [refs] : refs;\n              })\n            );\n\n            const docData = await this.indexer.docIndex.getAll(\n              Array.from(docIds)\n            );\n\n            return docData.map(doc => {\n              const title = doc.get('title');\n              return {\n                docId: doc.id,\n                title: title\n                  ? typeof title === 'string'\n                    ? title\n                    : title[0]\n                  : '',\n              };\n            });\n          });\n        })\n      );\n  }\n\n  async searchRefsTo(docId: string): Promise<\n    {\n      docId: string;\n      blockId: string;\n      title: string;\n    }[]\n  > {\n    const { buckets } = await this.indexer.blockIndex.aggregate(\n      {\n        type: 'match',\n        field: 'ref',\n        match: docId,\n      },\n      'docId',\n      {\n        hits: {\n          fields: ['docId', 'blockId'],\n          pagination: {\n            limit: 1,\n          },\n        },\n        pagination: {\n          limit: 100,\n        },\n      }\n    );\n\n    const docData = await this.indexer.docIndex.getAll(\n      buckets.map(bucket => bucket.key)\n    );\n\n    return buckets.map(bucket => {\n      const title =\n        docData.find(doc => doc.id === bucket.key)?.get('title') ?? '';\n      const blockId = bucket.hits.nodes[0]?.fields.blockId ?? '';\n      return {\n        docId: bucket.key,\n        blockId: typeof blockId === 'string' ? blockId : blockId[0],\n        title: typeof title === 'string' ? title : title[0],\n      };\n    });\n  }\n\n  watchRefsTo(docId: string) {\n    return this.indexer.blockIndex\n      .aggregate$(\n        {\n          type: 'match',\n          field: 'ref',\n          match: docId,\n        },\n        'docId',\n        {\n          hits: {\n            fields: ['docId', 'blockId'],\n            pagination: {\n              limit: 1,\n            },\n          },\n          pagination: {\n            limit: 100,\n          },\n        }\n      )\n      .pipe(\n        switchMap(({ buckets }) => {\n          return fromPromise(async () => {\n            const docData = await this.indexer.docIndex.getAll(\n              buckets.map(bucket => bucket.key)\n            );\n\n            return buckets.map(bucket => {\n              const title =\n                docData.find(doc => doc.id === bucket.key)?.get('title') ?? '';\n              const blockId = bucket.hits.nodes[0]?.fields.blockId ?? '';\n              return {\n                docId: bucket.key,\n                blockId: typeof blockId === 'string' ? blockId : blockId[0],\n                title: typeof title === 'string' ? title : title[0],\n              };\n            });\n          });\n        })\n      );\n  }\n\n  async getDocTitle(docId: string) {\n    const doc = await this.indexer.docIndex.get(docId);\n    const title = doc?.get('title');\n    return typeof title === 'string' ? title : title?.[0];\n  }\n\n  override dispose(): void {\n    this.indexer.dispose();\n  }\n}\n","import {\n  asyncScheduler,\n  defer,\n  exhaustMap,\n  finalize,\n  type Observable,\n  type ObservableInput,\n  type OperatorFunction,\n  scheduled,\n  Subject,\n  throttle,\n} from 'rxjs';\n\n/**\n * Like exhaustMap, but also includes the trailing value emitted from the source observable while waiting for the preceding inner observable to complete\n *\n * Original code adapted from https://github.com/ReactiveX/rxjs/issues/5004\n * @param {function<T, K>(value: T, ?index: number): ObservableInput<K>} project - A function that, when applied to an item emitted by the\n * source Observable, returns a projected Observable.\n */\nexport function exhaustMapWithTrailing<T, R>(\n  project: (value: T, index: number) => ObservableInput<R>\n): OperatorFunction<T, R> {\n  return (source$): Observable<R> =>\n    defer(() => {\n      const release$ = new Subject<void>();\n      return source$.pipe(\n        throttle(() => release$, {\n          leading: true,\n          trailing: true,\n        }),\n        exhaustMap((value, index) =>\n          scheduled(project(value, index), asyncScheduler).pipe(\n            finalize(() => {\n              release$.next();\n            })\n          )\n        )\n      );\n    });\n}\n","import type { DBSchema, IDBPDatabase } from 'idb';\nimport { openDB } from 'idb';\nimport { merge, Observable, of, throttleTime } from 'rxjs';\n\nimport { fromPromise } from '../../../../livedata';\nimport { throwIfAborted } from '../../../../utils';\nimport { exhaustMapWithTrailing } from '../../../../utils/';\nimport type { Job, JobParams, JobQueue } from '../../';\n\ninterface IndexDB extends DBSchema {\n  jobs: {\n    key: number;\n    value: JobRecord;\n    indexes: {\n      batchKey: string;\n    };\n  };\n}\n\ninterface JobRecord {\n  batchKey: string;\n  startTime: number | null;\n  payload: any;\n}\n\nexport class IndexedDBJobQueue<J> implements JobQueue<J> {\n  database: IDBPDatabase<IndexDB> = null as any;\n  broadcast = new BroadcastChannel('idb-job-queue:' + this.databaseName);\n\n  constructor(private readonly databaseName: string = 'jobs') {}\n\n  async enqueue(jobs: JobParams[]): Promise<void> {\n    await this.ensureInitialized();\n    const trx = this.database.transaction(['jobs'], 'readwrite');\n\n    for (const job of jobs) {\n      await trx.objectStore('jobs').add({\n        batchKey: job.batchKey,\n        payload: job.payload,\n        startTime: null,\n      });\n    }\n\n    trx.commit();\n\n    // send broadcast to notify new jobs\n    this.broadcast.postMessage('new-jobs');\n  }\n\n  async accept(): Promise<Job[] | null> {\n    await this.ensureInitialized();\n    const jobs = [];\n    const trx = this.database.transaction(['jobs'], 'readwrite');\n\n    // if no priority jobs\n\n    if (jobs.length === 0) {\n      const batchKeys = trx.objectStore('jobs').index('batchKey').iterate();\n\n      let currentBatchKey: string = null as any;\n      let currentBatchJobs = [];\n      let skipCurrentBatch = false;\n\n      for await (const item of batchKeys) {\n        if (item.value.batchKey !== currentBatchKey) {\n          if (!skipCurrentBatch && currentBatchJobs.length > 0) {\n            break;\n          }\n\n          currentBatchKey = item.value.batchKey;\n          currentBatchJobs = [];\n          skipCurrentBatch = false;\n        }\n        if (skipCurrentBatch) {\n          continue;\n        }\n        if (this.isAcceptable(item.value)) {\n          currentBatchJobs.push({\n            id: item.primaryKey,\n            job: item.value,\n          });\n        } else {\n          skipCurrentBatch = true;\n        }\n      }\n\n      if (skipCurrentBatch === false && currentBatchJobs.length > 0) {\n        jobs.push(...currentBatchJobs);\n      }\n    }\n\n    for (const { id, job } of jobs) {\n      const startTime = Date.now();\n      await trx.objectStore('jobs').put({ ...job, startTime }, id);\n    }\n\n    if (jobs.length === 0) {\n      return null;\n    }\n\n    return jobs.map(({ id, job }) => ({\n      id: id.toString(),\n      batchKey: job.batchKey,\n      payload: job.payload,\n    }));\n  }\n\n  async waitForAccept(signal: AbortSignal): Promise<Job<J>[]> {\n    const broadcast = new BroadcastChannel(\n      'idb-job-queue:' + this.databaseName\n    );\n\n    try {\n      let deferred = Promise.withResolvers<void>();\n\n      broadcast.onmessage = () => {\n        deferred.resolve();\n      };\n\n      while (throwIfAborted(signal)) {\n        const jobs = await this.accept();\n        if (jobs !== null) {\n          return jobs;\n        }\n\n        await Promise.race([\n          deferred.promise,\n          new Promise(resolve => {\n            setTimeout(resolve, 5000);\n          }),\n          new Promise((_, reject) => {\n            // exit if manually stopped\n            if (signal?.aborted) {\n              reject(signal.reason);\n            }\n            signal?.addEventListener('abort', () => {\n              reject(signal.reason);\n            });\n          }),\n        ]);\n        deferred = Promise.withResolvers<void>();\n      }\n      return [];\n    } finally {\n      broadcast.close();\n    }\n  }\n\n  async complete(jobs: Job[]): Promise<void> {\n    await this.ensureInitialized();\n    const trx = this.database.transaction(['jobs'], 'readwrite');\n\n    for (const { id } of jobs) {\n      await trx\n        .objectStore('jobs')\n        .delete(typeof id === 'string' ? parseInt(id) : id);\n    }\n\n    trx.commit();\n    this.broadcast.postMessage('job-completed');\n  }\n\n  async return(jobs: Job[], retry: boolean = false): Promise<void> {\n    await this.ensureInitialized();\n    const trx = this.database.transaction(['jobs'], 'readwrite');\n\n    for (const { id } of jobs) {\n      if (retry) {\n        const nid = typeof id === 'string' ? parseInt(id) : id;\n        const job = await trx.objectStore('jobs').get(nid);\n        if (job) {\n          await trx.objectStore('jobs').put({ ...job, startTime: null }, nid);\n        }\n      } else {\n        await trx\n          .objectStore('jobs')\n          .delete(typeof id === 'string' ? parseInt(id) : id);\n      }\n    }\n\n    trx.commit();\n\n    this.broadcast.postMessage('job-completed');\n  }\n\n  async clear(): Promise<void> {\n    await this.ensureInitialized();\n    const trx = this.database.transaction(['jobs'], 'readwrite');\n    await trx.objectStore('jobs').clear();\n  }\n\n  private async ensureInitialized(): Promise<void> {\n    if (!this.database) {\n      await this.initialize();\n    }\n  }\n\n  private async initialize(): Promise<void> {\n    if (this.database) {\n      return;\n    }\n    this.database = await openDB(this.databaseName, 1, {\n      upgrade(database) {\n        const jobs = database.createObjectStore('jobs', {\n          autoIncrement: true,\n        });\n        jobs.createIndex('batchKey', 'batchKey');\n      },\n    });\n  }\n\n  TIMEOUT = 1000 * 30 /* 30 seconds */;\n\n  private isTimeout(job: JobRecord) {\n    return job.startTime !== null && job.startTime + this.TIMEOUT < Date.now();\n  }\n\n  private isAcceptable(job: JobRecord) {\n    return job.startTime === null || this.isTimeout(job);\n  }\n\n  get status$() {\n    return merge(\n      of(1),\n      new Observable(subscriber => {\n        const broadcast = new BroadcastChannel(\n          'idb-job-queue:' + this.databaseName\n        );\n\n        broadcast.onmessage = () => {\n          subscriber.next(1);\n        };\n        return () => {\n          broadcast.close();\n        };\n      })\n    ).pipe(\n      throttleTime(300, undefined, { leading: true, trailing: true }),\n      exhaustMapWithTrailing(() =>\n        fromPromise(async () => {\n          await this.ensureInitialized();\n          const trx = this.database.transaction(['jobs'], 'readonly');\n          const remaining = await trx.objectStore('jobs').count();\n          return { remaining };\n        })\n      )\n    );\n  }\n}\n","import { DebugLogger } from '@affine/debug';\n\nimport { MANUALLY_STOP, throwIfAborted } from '../../utils';\nimport type { Job, JobQueue } from './queue';\n\nconst logger = new DebugLogger('job-runner');\n\nexport class JobRunner<J> {\n  abort: AbortController | null = null;\n\n  constructor(\n    private readonly queue: JobQueue<J>,\n    private readonly worker: (\n      jobs: Job<J>[],\n      signal: AbortSignal\n    ) => Promise<void>,\n    private readonly interval: () => Promise<void> = async () => {}\n  ) {}\n\n  start() {\n    this.stop();\n    this.abort = new AbortController();\n    this.loop(this.abort.signal).catch(err => {\n      if (err === MANUALLY_STOP) {\n        return;\n      }\n      logger.error(err);\n    });\n  }\n\n  stop() {\n    this.abort?.abort(MANUALLY_STOP);\n    this.abort = null;\n  }\n\n  async loop(signal: AbortSignal) {\n    while (throwIfAborted(signal)) {\n      const jobs = await this.queue.waitForAccept(signal);\n\n      if (jobs !== null) {\n        try {\n          await this.worker(jobs, signal);\n          await this.queue.return(jobs);\n        } catch (err) {\n          if (err === MANUALLY_STOP) {\n            await this.queue.return(jobs, true);\n          } else {\n            // TODO: retry logic\n            await this.queue.return(jobs);\n          }\n          logger.error('Error processing jobs', err);\n        }\n      } else {\n        await new Promise(resolve => setTimeout(resolve, 1000));\n      }\n\n      await this.interval();\n    }\n  }\n}\n","/**\n * Parameters of the BM25+ scoring algorithm. Customizing these is almost never\n * necessary, and finetuning them requires an understanding of the BM25 scoring\n * model.\n *\n * Some information about BM25 (and BM25+) can be found at these links:\n *\n *   - https://en.wikipedia.org/wiki/Okapi_BM25\n *   - https://opensourceconnections.com/blog/2015/10/16/bm25-the-next-generation-of-lucene-relevation/\n */\nexport type BM25Params = {\n  /** Term frequency saturation point.\n   *\n   * Recommended values are between `1.2` and `2`. Higher values increase the\n   * difference in score between documents with higher and lower term\n   * frequencies. Setting this to `0` or a negative value is invalid. Defaults\n   * to `1.2`\n   */\n  k: number;\n\n  /**\n   * Length normalization impact.\n   *\n   * Recommended values are around `0.75`. Higher values increase the weight\n   * that field length has on scoring. Setting this to `0` (not recommended)\n   * means that the field length has no effect on scoring. Negative values are\n   * invalid. Defaults to `0.7`.\n   */\n  b: number;\n\n  /**\n   * BM25+ frequency normalization lower bound (usually called ).\n   *\n   * Recommended values are between `0.5` and `1`. Increasing this parameter\n   * increases the minimum relevance of one occurrence of a search term\n   * regardless of its (possibly very long) field length. Negative values are\n   * invalid. Defaults to `0.5`.\n   */\n  d: number;\n};\n\nconst defaultBM25params: BM25Params = { k: 1.2, b: 0.7, d: 0.5 };\n\nexport const bm25 = (\n  termFreq: number,\n  matchingCount: number,\n  totalCount: number,\n  fieldLength: number,\n  avgFieldLength: number,\n  bm25params: BM25Params = defaultBM25params\n): number => {\n  const { k, b, d } = bm25params;\n  const invDocFreq = Math.log(\n    1 + (totalCount - matchingCount + 0.5) / (matchingCount + 0.5)\n  );\n  return (\n    invDocFreq *\n    (d +\n      (termFreq * (k + 1)) /\n        (termFreq + k * (1 - b + b * (fieldLength / avgFieldLength))))\n  );\n};\n","export class Match {\n  scores = new Map<number, number>();\n  /**\n   * nid -> field -> index(multi value field) -> [start, end][]\n   */\n  highlighters = new Map<\n    number,\n    Map<string, Map<number, [number, number][]>>\n  >();\n\n  constructor() {}\n\n  size() {\n    return this.scores.size;\n  }\n\n  getScore(id: number) {\n    return this.scores.get(id) ?? 0;\n  }\n\n  addScore(id: number, score: number) {\n    const currentScore = this.scores.get(id) || 0;\n    this.scores.set(id, currentScore + score);\n  }\n\n  getHighlighters(id: number, field: string) {\n    return this.highlighters.get(id)?.get(field);\n  }\n\n  addHighlighter(\n    id: number,\n    field: string,\n    index: number,\n    newRanges: [number, number][]\n  ) {\n    const fields =\n      this.highlighters.get(id) ||\n      new Map<string, Map<number, [number, number][]>>();\n    const values = fields.get(field) || new Map<number, [number, number][]>();\n    const ranges = values.get(index) || [];\n    ranges.push(...newRanges);\n    values.set(index, ranges);\n    fields.set(field, values);\n    this.highlighters.set(id, fields);\n  }\n\n  and(other: Match) {\n    const newWeight = new Match();\n    for (const [id, score] of this.scores) {\n      if (other.scores.has(id)) {\n        newWeight.addScore(id, score + (other.scores.get(id) ?? 0));\n        newWeight.copyExtData(this, id);\n        newWeight.copyExtData(other, id);\n      }\n    }\n    return newWeight;\n  }\n\n  or(other: Match) {\n    const newWeight = new Match();\n    for (const [id, score] of this.scores) {\n      newWeight.addScore(id, score);\n      newWeight.copyExtData(this, id);\n    }\n    for (const [id, score] of other.scores) {\n      newWeight.addScore(id, score);\n      newWeight.copyExtData(other, id);\n    }\n    return newWeight;\n  }\n\n  exclude(other: Match) {\n    const newWeight = new Match();\n    for (const [id, score] of this.scores) {\n      if (!other.scores.has(id)) {\n        newWeight.addScore(id, score);\n        newWeight.copyExtData(this, id);\n      }\n    }\n    return newWeight;\n  }\n\n  boost(boost: number) {\n    const newWeight = new Match();\n    for (const [id, score] of this.scores) {\n      newWeight.addScore(id, score * boost);\n      newWeight.copyExtData(this, id);\n    }\n    return newWeight;\n  }\n\n  toArray() {\n    return Array.from(this.scores.entries())\n      .sort((a, b) => b[1] - a[1])\n      .map(e => e[0]);\n  }\n\n  filter(predicate: (id: number) => boolean) {\n    const newWeight = new Match();\n    for (const [id, score] of this.scores) {\n      if (predicate(id)) {\n        newWeight.addScore(id, score);\n        newWeight.copyExtData(this, id);\n      }\n    }\n    return newWeight;\n  }\n\n  async asyncFilter(predicate: (id: number) => Promise<boolean>) {\n    const newWeight = new Match();\n    for (const [id, score] of this.scores) {\n      if (await predicate(id)) {\n        newWeight.addScore(id, score);\n        newWeight.copyExtData(this, id);\n      }\n    }\n    return newWeight;\n  }\n\n  private copyExtData(from: Match, id: number) {\n    for (const [field, values] of from.highlighters.get(id) ?? []) {\n      for (const [index, ranges] of values) {\n        this.addHighlighter(id, field, index, ranges);\n      }\n    }\n  }\n}\n","import Graphemer from 'graphemer';\n\nexport interface Tokenizer {\n  tokenize(text: string): Token[];\n}\n\nexport interface Token {\n  term: string;\n  start: number;\n  end: number;\n}\n\nexport class SimpleTokenizer implements Tokenizer {\n  tokenize(text: string): Token[] {\n    const tokens: Token[] = [];\n    let start = 0;\n    let end = 0;\n    let inWord = false;\n    for (let i = 0; i < text.length; i++) {\n      const c = text[i];\n      if (c.match(/[\\n\\r\\p{Z}\\p{P}]/u)) {\n        if (inWord) {\n          end = i;\n          tokens.push({\n            term: text.substring(start, end).toLowerCase(),\n            start,\n            end,\n          });\n          inWord = false;\n        }\n      } else {\n        if (!inWord) {\n          start = i;\n          end = i;\n          inWord = true;\n        }\n      }\n    }\n    if (inWord) {\n      tokens.push({\n        term: text.substring(start).toLowerCase(),\n        start,\n        end: text.length,\n      });\n    }\n    return tokens;\n  }\n}\n\nexport class NGramTokenizer implements Tokenizer {\n  constructor(private readonly n: number) {}\n\n  tokenize(text: string): Token[] {\n    const splitted: Token[] = [];\n    for (let i = 0; i < text.length; ) {\n      const nextBreak = Graphemer.nextBreak(text, i);\n      const c = text.substring(i, nextBreak);\n\n      splitted.push({\n        term: c,\n        start: i,\n        end: nextBreak,\n      });\n\n      i = nextBreak;\n    }\n    const tokens: Token[] = [];\n    for (let i = 0; i < splitted.length - this.n + 1; i++) {\n      tokens.push(\n        splitted.slice(i, i + this.n).reduce(\n          (acc, t) => ({\n            term: acc.term + t.term,\n            start: Math.min(acc.start, t.start),\n            end: Math.max(acc.end, t.end),\n          }),\n          { term: '', start: Infinity, end: -Infinity }\n        )\n      );\n    }\n    return tokens;\n  }\n}\n\nexport class GeneralTokenizer implements Tokenizer {\n  constructor() {}\n\n  tokenizeWord(word: string, lang: string): Token[] {\n    if (lang === 'en') {\n      return [{ term: word.toLowerCase(), start: 0, end: word.length }];\n    } else if (lang === 'cjk') {\n      if (word.length < 3) {\n        return [{ term: word, start: 0, end: word.length }];\n      }\n      return new NGramTokenizer(2).tokenize(word);\n    } else if (lang === 'emoji') {\n      return new NGramTokenizer(1).tokenize(word);\n    } else if (lang === '-') {\n      return [];\n    }\n\n    throw new Error('Not implemented');\n  }\n\n  testLang(c: string): string {\n    if (c.match(/[\\p{Emoji}]/u)) {\n      return 'emoji';\n    } else if (c.match(/[\\p{sc=Han}\\p{scx=Hira}\\p{scx=Kana}\\p{sc=Hang}]/u)) {\n      return 'cjk';\n    } else if (c.match(/[\\n\\r\\p{Z}\\p{P}]/u)) {\n      return '-';\n    } else {\n      return 'en';\n    }\n  }\n\n  tokenize(text: string): Token[] {\n    const tokens: Token[] = [];\n    let start = 0;\n    let end = 0;\n    let lang: string | null = null;\n\n    for (let i = 0; i < text.length; ) {\n      const nextBreak = Graphemer.nextBreak(text, i);\n      const c = text.substring(i, nextBreak);\n\n      const l = this.testLang(c);\n      if (lang !== l) {\n        if (lang !== null) {\n          end = i;\n          tokens.push(\n            ...this.tokenizeWord(text.substring(start, end), lang).map(\n              token => ({\n                ...token,\n                start: token.start + start,\n                end: token.end + start,\n              })\n            )\n          );\n        }\n\n        start = i;\n        end = i;\n        lang = l;\n      }\n\n      i = nextBreak;\n    }\n    if (lang !== null) {\n      tokens.push(\n        ...this.tokenizeWord(text.substring(start, text.length), lang).map(\n          token => ({\n            ...token,\n            start: token.start + start,\n            end: token.end + start,\n          })\n        )\n      );\n    }\n\n    return tokens;\n  }\n}\n","import { bm25 } from './bm25';\nimport type {\n  DataStructROTransaction,\n  DataStructRWTransaction,\n} from './data-struct';\nimport { Match } from './match';\nimport { GeneralTokenizer, type Token } from './tokenizer';\n\nexport interface InvertedIndex {\n  fieldKey: string;\n\n  match(trx: DataStructROTransaction, term: string): Promise<Match>;\n\n  all(trx: DataStructROTransaction): Promise<Match>;\n\n  insert(\n    trx: DataStructRWTransaction,\n    id: number,\n    terms: string[]\n  ): Promise<void>;\n}\n\nexport class StringInvertedIndex implements InvertedIndex {\n  constructor(readonly fieldKey: string) {}\n\n  async match(trx: DataStructROTransaction, term: string): Promise<Match> {\n    const objs = await trx\n      .objectStore('invertedIndex')\n      .index('key')\n      .getAll(InvertedIndexKey.forString(this.fieldKey, term).buffer());\n    const match = new Match();\n    for (const obj of objs) {\n      match.addScore(obj.nid, 1);\n    }\n    return match;\n  }\n\n  async all(trx: DataStructROTransaction): Promise<Match> {\n    const objs = await trx\n      .objectStore('invertedIndex')\n      .index('key')\n      .getAll(\n        IDBKeyRange.bound(\n          InvertedIndexKey.forPrefix(this.fieldKey).buffer(),\n          InvertedIndexKey.forPrefix(this.fieldKey).add1().buffer()\n        )\n      );\n\n    const set = new Set<number>();\n    for (const obj of objs) {\n      set.add(obj.nid);\n    }\n\n    const match = new Match();\n    for (const nid of set) {\n      match.addScore(nid, 1);\n    }\n    return match;\n  }\n\n  async insert(trx: DataStructRWTransaction, id: number, terms: string[]) {\n    for (const term of terms) {\n      await trx.objectStore('invertedIndex').add({\n        key: InvertedIndexKey.forString(this.fieldKey, term).buffer(),\n        nid: id,\n      });\n    }\n  }\n}\n\nexport class IntegerInvertedIndex implements InvertedIndex {\n  constructor(readonly fieldKey: string) {}\n\n  async match(trx: DataStructROTransaction, term: string): Promise<Match> {\n    const objs = await trx\n      .objectStore('invertedIndex')\n      .index('key')\n      .getAll(InvertedIndexKey.forInt64(this.fieldKey, BigInt(term)).buffer());\n    const match = new Match();\n    for (const obj of objs) {\n      match.addScore(obj.nid, 1);\n    }\n    return match;\n  }\n\n  // eslint-disable-next-line sonarjs/no-identical-functions\n  async all(trx: DataStructROTransaction): Promise<Match> {\n    const objs = await trx\n      .objectStore('invertedIndex')\n      .index('key')\n      .getAll(\n        IDBKeyRange.bound(\n          InvertedIndexKey.forPrefix(this.fieldKey).buffer(),\n          InvertedIndexKey.forPrefix(this.fieldKey).add1().buffer()\n        )\n      );\n\n    const set = new Set<number>();\n    for (const obj of objs) {\n      set.add(obj.nid);\n    }\n\n    const match = new Match();\n    for (const nid of set) {\n      match.addScore(nid, 1);\n    }\n    return match;\n  }\n\n  async insert(trx: DataStructRWTransaction, id: number, terms: string[]) {\n    for (const term of terms) {\n      await trx.objectStore('invertedIndex').add({\n        key: InvertedIndexKey.forInt64(this.fieldKey, BigInt(term)).buffer(),\n        nid: id,\n      });\n    }\n  }\n}\n\nexport class BooleanInvertedIndex implements InvertedIndex {\n  constructor(readonly fieldKey: string) {}\n\n  // eslint-disable-next-line sonarjs/no-identical-functions\n  async all(trx: DataStructROTransaction): Promise<Match> {\n    const objs = await trx\n      .objectStore('invertedIndex')\n      .index('key')\n      .getAll(\n        IDBKeyRange.bound(\n          InvertedIndexKey.forPrefix(this.fieldKey).buffer(),\n          InvertedIndexKey.forPrefix(this.fieldKey).add1().buffer()\n        )\n      );\n\n    const set = new Set<number>();\n    for (const obj of objs) {\n      set.add(obj.nid);\n    }\n\n    const match = new Match();\n    for (const nid of set) {\n      match.addScore(nid, 1);\n    }\n    return match;\n  }\n\n  async match(trx: DataStructROTransaction, term: string): Promise<Match> {\n    const objs = await trx\n      .objectStore('invertedIndex')\n      .index('key')\n      .getAll(\n        InvertedIndexKey.forBoolean(this.fieldKey, term === 'true').buffer()\n      );\n    const match = new Match();\n    for (const obj of objs) {\n      match.addScore(obj.nid, 1);\n    }\n    return match;\n  }\n\n  async insert(trx: DataStructRWTransaction, id: number, terms: string[]) {\n    for (const term of terms) {\n      await trx.objectStore('invertedIndex').add({\n        key: InvertedIndexKey.forBoolean(\n          this.fieldKey,\n          term === 'true'\n        ).buffer(),\n        nid: id,\n      });\n    }\n  }\n}\n\nexport class FullTextInvertedIndex implements InvertedIndex {\n  constructor(readonly fieldKey: string) {}\n\n  async match(trx: DataStructROTransaction, term: string): Promise<Match> {\n    const queryTokens = new GeneralTokenizer().tokenize(term);\n    const matched = new Map<\n      number,\n      Map<\n        number, // index\n        {\n          score: number;\n          ranges: [number, number][];\n        }\n      >\n    >();\n    for (const token of queryTokens) {\n      const key = InvertedIndexKey.forString(this.fieldKey, token.term);\n      const objs = await trx\n        .objectStore('invertedIndex')\n        .index('key')\n        .getAll(\n          IDBKeyRange.bound(key.buffer(), key.add1().buffer(), false, true)\n        );\n      const submatched: {\n        nid: number;\n        score: number;\n        position: {\n          index: number;\n          ranges: [number, number][];\n        };\n      }[] = [];\n      for (const obj of objs) {\n        const key = InvertedIndexKey.fromBuffer(obj.key);\n        const originTokenTerm = key.asString();\n        const matchLength = token.term.length;\n        const position = obj.pos ?? {\n          i: 0,\n          l: 0,\n          rs: [],\n        };\n        const termFreq = position.rs.length;\n        const totalCount = objs.length;\n        const avgFieldLength =\n          (\n            await trx\n              .objectStore('kvMetadata')\n              .get(`full-text:avg-field-length:${this.fieldKey}`)\n          )?.value ?? 0;\n        const fieldLength = position.l;\n        const score =\n          bm25(termFreq, 1, totalCount, fieldLength, avgFieldLength) *\n          (matchLength / originTokenTerm.length);\n        const match = {\n          score,\n          positions: new Map(),\n        };\n        const ranges = match.positions.get(position.i) || [];\n        ranges.push(\n          ...position.rs.map(([start, _end]) => [start, start + matchLength])\n        );\n        match.positions.set(position.i, ranges);\n        submatched.push({\n          nid: obj.nid,\n          score,\n          position: {\n            index: position.i,\n            ranges: position.rs.map(([start, _end]) => [\n              start,\n              start + matchLength,\n            ]),\n          },\n        });\n      }\n\n      // normalize score\n      const maxScore = submatched.reduce((acc, s) => Math.max(acc, s.score), 0);\n      const minScore = submatched.reduce((acc, s) => Math.min(acc, s.score), 0);\n      for (const { nid, score, position } of submatched) {\n        const normalizedScore =\n          maxScore === minScore\n            ? score\n            : (score - minScore) / (maxScore - minScore);\n        const match =\n          matched.get(nid) ??\n          new Map<\n            number, // index\n            {\n              score: number;\n              ranges: [number, number][];\n            }\n          >();\n        const item = match.get(position.index) || {\n          score: 0,\n          ranges: [],\n        };\n        item.score += normalizedScore;\n        item.ranges.push(...position.ranges);\n        match.set(position.index, item);\n        matched.set(nid, match);\n      }\n    }\n    const match = new Match();\n    for (const [nid, items] of matched) {\n      if (items.size === 0) {\n        break;\n      }\n      let highestScore = -1;\n      let highestIndex = -1;\n      let highestRanges: [number, number][] = [];\n      for (const [index, { score, ranges }] of items) {\n        if (score > highestScore) {\n          highestScore = score;\n          highestIndex = index;\n          highestRanges = ranges;\n        }\n      }\n      match.addScore(nid, highestScore);\n      match.addHighlighter(nid, this.fieldKey, highestIndex, highestRanges);\n    }\n    return match;\n  }\n\n  // eslint-disable-next-line sonarjs/no-identical-functions\n  async all(trx: DataStructROTransaction): Promise<Match> {\n    const objs = await trx\n      .objectStore('invertedIndex')\n      .index('key')\n      .getAll(\n        IDBKeyRange.bound(\n          InvertedIndexKey.forPrefix(this.fieldKey).buffer(),\n          InvertedIndexKey.forPrefix(this.fieldKey).add1().buffer()\n        )\n      );\n\n    const set = new Set<number>();\n    for (const obj of objs) {\n      set.add(obj.nid);\n    }\n\n    const match = new Match();\n    for (const nid of set) {\n      match.addScore(nid, 1);\n    }\n    return match;\n  }\n\n  async insert(trx: DataStructRWTransaction, id: number, terms: string[]) {\n    for (let i = 0; i < terms.length; i++) {\n      const tokenMap = new Map<string, Token[]>();\n      const originString = terms[i];\n\n      const tokens = new GeneralTokenizer().tokenize(originString);\n\n      for (const token of tokens) {\n        const tokens = tokenMap.get(token.term) || [];\n        tokens.push(token);\n        tokenMap.set(token.term, tokens);\n      }\n\n      for (const [term, tokens] of tokenMap) {\n        await trx.objectStore('invertedIndex').add({\n          key: InvertedIndexKey.forString(this.fieldKey, term).buffer(),\n          nid: id,\n          pos: {\n            l: originString.length,\n            i: i,\n            rs: tokens.map(token => [token.start, token.end]),\n          },\n        });\n      }\n\n      const kvMetadataStore = trx.objectStore('kvMetadata');\n      // update avg-field-length\n      const totalCount =\n        (await kvMetadataStore.get(`full-text:field-count:${this.fieldKey}`))\n          ?.value ?? 0;\n      const avgFieldLength =\n        (\n          await kvMetadataStore.get(\n            `full-text:avg-field-length:${this.fieldKey}`\n          )\n        )?.value ?? 0;\n      await kvMetadataStore.put({\n        key: `full-text:field-count:${this.fieldKey}`,\n        value: totalCount + 1,\n      });\n      await kvMetadataStore.put({\n        key: `full-text:avg-field-length:${this.fieldKey}`,\n        value:\n          avgFieldLength +\n          (terms.reduce((acc, term) => acc + term.length, 0) - avgFieldLength) /\n            (totalCount + 1),\n      });\n    }\n  }\n}\n\nexport class InvertedIndexKey {\n  constructor(\n    readonly field: ArrayBuffer,\n    readonly value: ArrayBuffer,\n    readonly gap: ArrayBuffer = new Uint8Array([58])\n  ) {}\n\n  asString() {\n    return new TextDecoder().decode(this.value);\n  }\n\n  asInt64() {\n    return new DataView(this.value).getBigInt64(0, false); /* big-endian */\n  }\n\n  add1() {\n    if (this.value.byteLength > 0) {\n      const bytes = new Uint8Array(this.value.slice(0));\n      let carry = 1;\n      for (let i = bytes.length - 1; i >= 0 && carry > 0; i--) {\n        const sum = bytes[i] + carry;\n        bytes[i] = sum % 256;\n        carry = sum >> 8;\n      }\n      return new InvertedIndexKey(this.field, bytes);\n    } else {\n      return new InvertedIndexKey(\n        this.field,\n        new ArrayBuffer(0),\n        new Uint8Array([59])\n      );\n    }\n  }\n\n  static forPrefix(field: string) {\n    return new InvertedIndexKey(\n      new TextEncoder().encode(field),\n      new ArrayBuffer(0)\n    );\n  }\n\n  static forString(field: string, value: string) {\n    return new InvertedIndexKey(\n      new TextEncoder().encode(field),\n      new TextEncoder().encode(value)\n    );\n  }\n\n  static forBoolean(field: string, value: boolean) {\n    const bytes = new Uint8Array(1);\n    bytes.set([value ? 1 : 0]);\n    return new InvertedIndexKey(new TextEncoder().encode(field), bytes);\n  }\n\n  static forInt64(field: string, value: bigint) {\n    const bytes = new ArrayBuffer(8);\n    new DataView(bytes).setBigInt64(0, value, false); /* big-endian */\n    return new InvertedIndexKey(new TextEncoder().encode(field), bytes);\n  }\n\n  buffer() {\n    const tmp = new Uint8Array(\n      this.field.byteLength + (this.value?.byteLength ?? 0) + 1\n    );\n    tmp.set(new Uint8Array(this.field), 0);\n    tmp.set(new Uint8Array(this.gap), this.field.byteLength);\n    if (this.value.byteLength > 0) {\n      tmp.set(new Uint8Array(this.value), this.field.byteLength + 1);\n    }\n    return tmp.buffer;\n  }\n\n  static fromBuffer(buffer: ArrayBuffer) {\n    const array = new Uint8Array(buffer);\n    const fieldLength = array.indexOf(58);\n    const field = array.slice(0, fieldLength);\n    const value = array.slice(fieldLength + 1);\n    return new InvertedIndexKey(field, value);\n  }\n}\n","import {\n  type DBSchema,\n  type IDBPDatabase,\n  type IDBPTransaction,\n  openDB,\n  type StoreNames,\n} from 'idb';\n\nimport {\n  type AggregateOptions,\n  type AggregateResult,\n  Document,\n  type Query,\n  type Schema,\n  type SearchOptions,\n  type SearchResult,\n} from '../../';\nimport { highlighter } from './highlighter';\nimport {\n  BooleanInvertedIndex,\n  FullTextInvertedIndex,\n  IntegerInvertedIndex,\n  type InvertedIndex,\n  StringInvertedIndex,\n} from './inverted-index';\nimport { Match } from './match';\n\nexport interface IndexDB extends DBSchema {\n  kvMetadata: {\n    key: string;\n    value: {\n      key: string;\n      value: any;\n    };\n  };\n  records: {\n    key: number;\n    value: {\n      id: string;\n      data: Map<string, string[]>;\n    };\n    indexes: { id: string };\n  };\n  invertedIndex: {\n    key: number;\n    value: {\n      nid: number;\n      pos?: {\n        i: number /* index */;\n        l: number /* length */;\n        rs: [number, number][] /* ranges: [start, end] */;\n      };\n      key: ArrayBuffer;\n    };\n    indexes: { key: ArrayBuffer; nid: number };\n  };\n}\n\nexport type DataStructRWTransaction = IDBPTransaction<\n  IndexDB,\n  ArrayLike<StoreNames<IndexDB>>,\n  'readwrite'\n>;\n\nexport type DataStructROTransaction = IDBPTransaction<\n  IndexDB,\n  ArrayLike<StoreNames<IndexDB>>,\n  'readonly' | 'readwrite'\n>;\n\nexport class DataStruct {\n  private initializePromise: Promise<void> | null = null;\n  database: IDBPDatabase<IndexDB> = null as any;\n  invertedIndex = new Map<string, InvertedIndex>();\n\n  constructor(\n    readonly databaseName: string,\n    schema: Schema\n  ) {\n    for (const [key, type] of Object.entries(schema)) {\n      if (type === 'String') {\n        this.invertedIndex.set(key, new StringInvertedIndex(key));\n      } else if (type === 'Integer') {\n        this.invertedIndex.set(key, new IntegerInvertedIndex(key));\n      } else if (type === 'FullText') {\n        this.invertedIndex.set(key, new FullTextInvertedIndex(key));\n      } else if (type === 'Boolean') {\n        this.invertedIndex.set(key, new BooleanInvertedIndex(key));\n      } else {\n        throw new Error(`Field type '${type}' not supported`);\n      }\n    }\n  }\n\n  async insert(trx: DataStructRWTransaction, document: Document) {\n    const exists = await trx\n      .objectStore('records')\n      .index('id')\n      .get(document.id);\n\n    if (exists) {\n      throw new Error('Document already exists');\n    }\n\n    const nid = await trx.objectStore('records').add({\n      id: document.id,\n      data: new Map(document.fields as Map<string, string[]>),\n    });\n\n    for (const [key, values] of document.fields) {\n      const iidx = this.invertedIndex.get(key as string);\n      if (!iidx) {\n        throw new Error(\n          `Inverted index '${key.toString()}' not found, document not match schema`\n        );\n      }\n      await iidx.insert(trx, nid, values);\n    }\n  }\n\n  async delete(trx: DataStructRWTransaction, id: string) {\n    const nid = await trx.objectStore('records').index('id').getKey(id);\n\n    if (nid) {\n      await trx.objectStore('records').delete(nid);\n    }\n\n    const indexIds = await trx\n      .objectStore('invertedIndex')\n      .index('nid')\n      .getAllKeys(nid);\n    for (const indexId of indexIds) {\n      await trx.objectStore('invertedIndex').delete(indexId);\n    }\n  }\n\n  async batchWrite(\n    trx: DataStructRWTransaction,\n    deletes: string[],\n    inserts: Document[]\n  ) {\n    for (const del of deletes) {\n      await this.delete(trx, del);\n    }\n    for (const inst of inserts) {\n      await this.insert(trx, inst);\n    }\n  }\n\n  async matchAll(trx: DataStructROTransaction): Promise<Match> {\n    const allNids = await trx.objectStore('records').getAllKeys();\n    const match = new Match();\n\n    for (const nid of allNids) {\n      match.addScore(nid, 1);\n    }\n    return match;\n  }\n\n  private async queryRaw(\n    trx: DataStructROTransaction,\n    query: Query<any>\n  ): Promise<Match> {\n    if (query.type === 'match') {\n      const iidx = this.invertedIndex.get(query.field as string);\n      if (!iidx) {\n        throw new Error(`Field '${query.field as string}' not found`);\n      }\n      return await iidx.match(trx, query.match);\n    } else if (query.type === 'boolean') {\n      const weights = [];\n      for (const q of query.queries) {\n        weights.push(await this.queryRaw(trx, q));\n      }\n      if (query.occur === 'must') {\n        return weights.reduce((acc, w) => acc.and(w));\n      } else if (query.occur === 'must_not') {\n        const total = weights.reduce((acc, w) => acc.and(w));\n        return (await this.matchAll(trx)).exclude(total);\n      } else if (query.occur === 'should') {\n        return weights.reduce((acc, w) => acc.or(w));\n      }\n    } else if (query.type === 'all') {\n      return await this.matchAll(trx);\n    } else if (query.type === 'boost') {\n      return (await this.queryRaw(trx, query.query)).boost(query.boost);\n    } else if (query.type === 'exists') {\n      const iidx = this.invertedIndex.get(query.field as string);\n      if (!iidx) {\n        throw new Error(`Field '${query.field as string}' not found`);\n      }\n      return await iidx.all(trx);\n    }\n    throw new Error(`Query type '${query.type}' not supported`);\n  }\n\n  private async query(\n    trx: DataStructROTransaction,\n    query: Query<any>\n  ): Promise<Match> {\n    const match = await this.queryRaw(trx, query);\n    const filteredMatch = match.asyncFilter(async nid => {\n      const record = await trx.objectStore('records').getKey(nid);\n      return record !== undefined;\n    });\n    return filteredMatch;\n  }\n\n  async clear(trx: DataStructRWTransaction) {\n    await trx.objectStore('records').clear();\n    await trx.objectStore('invertedIndex').clear();\n    await trx.objectStore('kvMetadata').clear();\n  }\n\n  async search(\n    trx: DataStructROTransaction,\n    query: Query<any>,\n    options: SearchOptions<any>\n  ): Promise<SearchResult<any, any>> {\n    const pagination = {\n      skip: options.pagination?.skip ?? 0,\n      limit: options.pagination?.limit ?? 100,\n    };\n\n    const match = await this.query(trx, query);\n\n    const nids = match\n      .toArray()\n      .slice(pagination.skip, pagination.skip + pagination.limit);\n\n    const nodes = [];\n    for (const nid of nids) {\n      nodes.push(await this.resultNode(trx, match, nid, options));\n    }\n\n    return {\n      pagination: {\n        count: match.size(),\n        hasMore: match.size() > pagination.limit + pagination.skip,\n        limit: pagination.limit,\n        skip: pagination.skip,\n      },\n      nodes: nodes,\n    };\n  }\n\n  async aggregate(\n    trx: DataStructROTransaction,\n    query: Query<any>,\n    field: string,\n    options: AggregateOptions<any>\n  ): Promise<AggregateResult<any, any>> {\n    const pagination = {\n      skip: options.pagination?.skip ?? 0,\n      limit: options.pagination?.limit ?? 100,\n    };\n\n    const hitPagination = options.hits\n      ? {\n          skip: options.hits.pagination?.skip ?? 0,\n          limit: options.hits.pagination?.limit ?? 3,\n        }\n      : {\n          skip: 0,\n          limit: 0,\n        };\n\n    const match = await this.query(trx, query);\n\n    const nids = match.toArray();\n\n    const buckets: {\n      key: string;\n      nids: number[];\n      hits: SearchResult<any, any>['nodes'];\n    }[] = [];\n\n    for (const nid of nids) {\n      const values = (await trx.objectStore('records').get(nid))?.data.get(\n        field\n      );\n      for (const value of values ?? []) {\n        let bucket;\n        let bucketIndex = buckets.findIndex(b => b.key === value);\n        if (bucketIndex === -1) {\n          bucket = { key: value, nids: [], hits: [] };\n          buckets.push(bucket);\n          bucketIndex = buckets.length - 1;\n        } else {\n          bucket = buckets[bucketIndex];\n        }\n\n        if (\n          bucketIndex >= pagination.skip &&\n          bucketIndex < pagination.skip + pagination.limit\n        ) {\n          bucket.nids.push(nid);\n          if (\n            bucket.nids.length - 1 >= hitPagination.skip &&\n            bucket.nids.length - 1 < hitPagination.skip + hitPagination.limit\n          ) {\n            bucket.hits.push(\n              await this.resultNode(trx, match, nid, options.hits ?? {})\n            );\n          }\n        }\n      }\n    }\n\n    return {\n      buckets: buckets\n        .slice(pagination.skip, pagination.skip + pagination.limit)\n        .map(bucket => {\n          const result = {\n            key: bucket.key,\n            score: match.getScore(bucket.nids[0]),\n            count: bucket.nids.length,\n          } as AggregateResult<any, any>['buckets'][number];\n\n          if (options.hits) {\n            (result as any).hits = {\n              pagination: {\n                count: bucket.nids.length,\n                hasMore:\n                  bucket.nids.length > hitPagination.limit + hitPagination.skip,\n                limit: hitPagination.limit,\n                skip: hitPagination.skip,\n              },\n              nodes: bucket.hits,\n            } as SearchResult<any, any>;\n          }\n\n          return result;\n        }),\n      pagination: {\n        count: buckets.length,\n        hasMore: buckets.length > pagination.limit + pagination.skip,\n        limit: pagination.limit,\n        skip: pagination.skip,\n      },\n    };\n  }\n\n  async getAll(\n    trx: DataStructROTransaction,\n    ids: string[]\n  ): Promise<Document[]> {\n    const docs = [];\n    for (const id of ids) {\n      const record = await trx.objectStore('records').index('id').get(id);\n      if (record) {\n        docs.push(Document.from(record.id, record.data));\n      }\n    }\n\n    return docs;\n  }\n\n  async has(trx: DataStructROTransaction, id: string): Promise<boolean> {\n    const nid = await trx.objectStore('records').index('id').getKey(id);\n    return nid !== undefined;\n  }\n\n  async readonly() {\n    await this.ensureInitialized();\n    return this.database.transaction(\n      ['records', 'invertedIndex', 'kvMetadata'],\n      'readonly'\n    );\n  }\n\n  async readwrite() {\n    await this.ensureInitialized();\n    return this.database.transaction(\n      ['records', 'invertedIndex', 'kvMetadata'],\n      'readwrite'\n    );\n  }\n\n  private async ensureInitialized() {\n    if (this.database) {\n      return;\n    }\n    this.initializePromise ??= this.initialize();\n    await this.initializePromise;\n  }\n\n  private async initialize() {\n    this.database = await openDB<IndexDB>(this.databaseName, 1, {\n      upgrade(database) {\n        database.createObjectStore('kvMetadata', {\n          keyPath: 'key',\n        });\n        const recordsStore = database.createObjectStore('records', {\n          autoIncrement: true,\n        });\n        recordsStore.createIndex('id', 'id', {\n          unique: true,\n        });\n        const invertedIndexStore = database.createObjectStore('invertedIndex', {\n          autoIncrement: true,\n        });\n        invertedIndexStore.createIndex('key', 'key', { unique: false });\n        invertedIndexStore.createIndex('nid', 'nid', { unique: false });\n      },\n    });\n  }\n\n  private async resultNode(\n    trx: DataStructROTransaction,\n    match: Match,\n    nid: number,\n    options: SearchOptions<any>\n  ): Promise<SearchResult<any, any>['nodes'][number]> {\n    const record = await trx.objectStore('records').get(nid);\n    if (!record) {\n      throw new Error(`Record not found for nid ${nid}`);\n    }\n\n    const node = {\n      id: record.id,\n      score: match.getScore(nid),\n    } as any;\n\n    if (options.fields) {\n      const fields = {} as Record<string, string | string[]>;\n      for (const field of options.fields as string[]) {\n        fields[field] = record.data.get(field) ?? [''];\n        if (fields[field].length === 1) {\n          fields[field] = fields[field][0];\n        }\n      }\n      node.fields = fields;\n    }\n\n    if (options.highlights) {\n      const highlights = {} as Record<string, string[]>;\n      for (const { field, before, end } of options.highlights) {\n        const highlightValues = match.getHighlighters(nid, field);\n        if (highlightValues) {\n          const rawValues = record.data.get(field) ?? [];\n          highlights[field] = Array.from(highlightValues)\n            .map(([index, ranges]) => {\n              const raw = rawValues[index];\n\n              if (raw) {\n                return (\n                  highlighter(raw, before, end, ranges, {\n                    maxPrefix: 20,\n                    maxLength: 50,\n                  }) ?? ''\n                );\n              }\n\n              return '';\n            })\n            .filter(Boolean);\n        }\n      }\n      node.highlights = highlights;\n    }\n\n    return node;\n  }\n}\n","export function highlighter(\n  originText: string,\n  before: string,\n  after: string,\n  matches: [number, number][],\n  {\n    maxLength = 50,\n    maxPrefix = 20,\n  }: { maxLength?: number; maxPrefix?: number } = {}\n) {\n  const merged = mergeRanges(matches);\n\n  if (merged.length === 0) {\n    return null;\n  }\n\n  const firstMatch = merged[0][0];\n  const start = Math.max(\n    0,\n    Math.min(firstMatch - maxPrefix, originText.length - maxLength)\n  );\n  const end = Math.min(start + maxLength, originText.length);\n  const text = originText.substring(start, end);\n\n  let result = '';\n\n  let pointer = 0;\n  for (const match of merged) {\n    const matchStart = match[0] - start;\n    const matchEnd = match[1] - start;\n    if (matchStart >= text.length) {\n      break;\n    }\n    result += text.substring(pointer, matchStart);\n    pointer = matchStart;\n    const highlighted = text.substring(matchStart, matchEnd);\n\n    if (highlighted.length === 0) {\n      continue;\n    }\n\n    result += `${before}${highlighted}${after}`;\n    pointer = matchEnd;\n  }\n  result += text.substring(pointer);\n\n  if (start > 0) {\n    result = `...${result}`;\n  }\n\n  if (end < originText.length) {\n    result = `${result}...`;\n  }\n\n  return result;\n}\n\nfunction mergeRanges(intervals: [number, number][]) {\n  if (intervals.length === 0) return [];\n\n  intervals.sort((a, b) => a[0] - b[0]);\n\n  const merged = [intervals[0]];\n\n  for (let i = 1; i < intervals.length; i++) {\n    const last = merged[merged.length - 1];\n    const current = intervals[i];\n\n    if (current[0] <= last[1]) {\n      last[1] = Math.max(last[1], current[1]);\n    } else {\n      merged.push(current);\n    }\n  }\n\n  return merged;\n}\n","import type { Observable } from 'rxjs';\nimport { from, merge, of, Subject, throttleTime } from 'rxjs';\n\nimport { exhaustMapWithTrailing } from '../../../../utils/';\nimport {\n  type AggregateOptions,\n  type AggregateResult,\n  type Document,\n  type Index,\n  type IndexStorage,\n  type IndexWriter,\n  type Query,\n  type Schema,\n  type SearchOptions,\n  type SearchResult,\n} from '../../';\nimport { DataStruct, type DataStructRWTransaction } from './data-struct';\n\nexport class IndexedDBIndex<S extends Schema> implements Index<S> {\n  data: DataStruct = new DataStruct(this.databaseName, this.schema);\n  broadcast$ = new Subject();\n\n  constructor(\n    private readonly schema: S,\n    private readonly databaseName: string = 'indexer'\n  ) {\n    const channel = new BroadcastChannel(this.databaseName + ':indexer');\n    channel.onmessage = () => {\n      this.broadcast$.next(1);\n    };\n  }\n\n  async get(id: string): Promise<Document<S> | null> {\n    return (await this.getAll([id]))[0] ?? null;\n  }\n\n  async getAll(ids: string[]): Promise<Document<S>[]> {\n    const trx = await this.data.readonly();\n    return this.data.getAll(trx, ids);\n  }\n\n  async write(): Promise<IndexWriter<S>> {\n    return new IndexedDBIndexWriter(this.data, await this.data.readwrite());\n  }\n\n  async has(id: string): Promise<boolean> {\n    const trx = await this.data.readonly();\n    return this.data.has(trx, id);\n  }\n\n  async search(\n    query: Query<any>,\n    options: SearchOptions<any> = {}\n  ): Promise<SearchResult<any, SearchOptions<any>>> {\n    const trx = await this.data.readonly();\n    return this.data.search(trx, query, options);\n  }\n\n  search$(\n    query: Query<any>,\n    options: SearchOptions<any> = {}\n  ): Observable<SearchResult<any, SearchOptions<any>>> {\n    return merge(of(1), this.broadcast$).pipe(\n      throttleTime(500, undefined, { leading: true, trailing: true }),\n      exhaustMapWithTrailing(() => {\n        return from(\n          (async () => {\n            const trx = await this.data.readonly();\n            return this.data.search(trx, query, options);\n          })()\n        );\n      })\n    );\n  }\n\n  async aggregate(\n    query: Query<any>,\n    field: string,\n    options: AggregateOptions<any> = {}\n  ): Promise<AggregateResult<any, AggregateOptions<any>>> {\n    const trx = await this.data.readonly();\n    return this.data.aggregate(trx, query, field, options);\n  }\n\n  aggregate$(\n    query: Query<any>,\n    field: string,\n    options: AggregateOptions<any> = {}\n  ): Observable<AggregateResult<S, AggregateOptions<any>>> {\n    return merge(of(1), this.broadcast$).pipe(\n      throttleTime(500, undefined, { leading: true, trailing: true }),\n      exhaustMapWithTrailing(() => {\n        return from(\n          (async () => {\n            const trx = await this.data.readonly();\n            return this.data.aggregate(trx, query, field, options);\n          })()\n        );\n      })\n    );\n  }\n\n  async clear(): Promise<void> {\n    const trx = await this.data.readwrite();\n    return this.data.clear(trx);\n  }\n}\n\nexport class IndexedDBIndexWriter<S extends Schema> implements IndexWriter<S> {\n  inserts: Document[] = [];\n  deletes: string[] = [];\n  channel = new BroadcastChannel(this.data.databaseName + ':indexer');\n\n  constructor(\n    private readonly data: DataStruct,\n    private readonly trx: DataStructRWTransaction\n  ) {}\n\n  async get(id: string): Promise<Document<S> | null> {\n    return (await this.getAll([id]))[0] ?? null;\n  }\n\n  async getAll(ids: string[]): Promise<Document<S>[]> {\n    const trx = await this.data.readonly();\n    return this.data.getAll(trx, ids);\n  }\n\n  insert(document: Document): void {\n    this.inserts.push(document);\n  }\n  delete(id: string): void {\n    this.deletes.push(id);\n  }\n  put(document: Document): void {\n    this.delete(document.id);\n    this.insert(document);\n  }\n\n  async commit(): Promise<void> {\n    await this.data.batchWrite(this.trx, this.deletes, this.inserts);\n    this.channel.postMessage(1);\n  }\n\n  rollback(): void {}\n\n  has(id: string): Promise<boolean> {\n    return this.data.has(this.trx, id);\n  }\n\n  async search(\n    query: Query<any>,\n    options: SearchOptions<any> = {}\n  ): Promise<SearchResult<any, SearchOptions<any>>> {\n    return this.data.search(this.trx, query, options);\n  }\n\n  async aggregate(\n    query: Query<any>,\n    field: string,\n    options: AggregateOptions<any> = {}\n  ): Promise<AggregateResult<any, AggregateOptions<any>>> {\n    return this.data.aggregate(this.trx, query, field, options);\n  }\n}\n\nexport class IndexedDBIndexStorage implements IndexStorage {\n  constructor(private readonly databaseName: string) {}\n  getIndex<S extends Schema>(name: string, s: S): Index<S> {\n    return new IndexedDBIndex(s, this.databaseName + ':' + name);\n  }\n}\n","import { defineSchema } from '@toeverything/infra';\n\nexport const docIndexSchema = defineSchema({\n  title: 'FullText',\n});\n\nexport type DocIndexSchema = typeof docIndexSchema;\n\nexport const blockIndexSchema = defineSchema({\n  docId: 'String',\n  blockId: 'String',\n  content: 'FullText',\n  flavour: 'String',\n  ref: 'String',\n  blob: 'String',\n});\n\nexport type BlockIndexSchema = typeof blockIndexSchema;\n","import { DebugLogger } from '@affine/debug';\nimport { MANUALLY_STOP, throwIfAborted } from '@toeverything/infra';\n\nimport type {\n  WorkerIngoingMessage,\n  WorkerInput,\n  WorkerOutgoingMessage,\n  WorkerOutput,\n} from './types';\n\nconst logger = new DebugLogger('affine:indexer-worker');\n\nexport async function createWorker(abort: AbortSignal) {\n  let worker: Worker | null = null;\n  while (throwIfAborted(abort)) {\n    try {\n      worker = await new Promise<Worker>((resolve, reject) => {\n        // @TODO(@forehalo): need to make a general worker\n        const worker = new Worker(\n          /* webpackChunkName: \"worker\" */ new URL(\n            './in-worker.ts',\n            import.meta.url\n          )\n        );\n        worker.addEventListener('error', reject);\n        worker.addEventListener('message', event => {\n          if (event.data.type === 'init') {\n            resolve(worker);\n          }\n        });\n        worker.postMessage({ type: 'init', msgId: 0 } as WorkerIngoingMessage);\n        setTimeout(() => {\n          reject('timeout');\n        }, 1000 * 30 /* 30 sec */);\n      });\n    } catch (err) {\n      logger.debug(\n        `Indexer worker init failed, ${err}, will retry in 5 seconds.`\n      );\n      await new Promise(resolve => setTimeout(resolve, 5000));\n    }\n    if (worker) {\n      break;\n    }\n  }\n\n  if (!worker) {\n    // never reach here\n    throw new Error('Worker is not created');\n  }\n\n  const terminateAbort = new AbortController();\n\n  let msgId = 1;\n\n  return {\n    run: async (input: WorkerInput) => {\n      const dispose: (() => void)[] = [];\n      return new Promise<WorkerOutput>((resolve, reject) => {\n        const currentMsgId = msgId++;\n        const msgHandler = (event: MessageEvent<WorkerOutgoingMessage>) => {\n          if (event.data.msgId === currentMsgId) {\n            if (event.data.type === 'done') {\n              resolve(event.data.output);\n            } else if (event.data.type === 'failed') {\n              reject(new Error(event.data.error));\n            } else {\n              reject(new Error('Unknown message type'));\n            }\n          }\n        };\n        const abortHandler = (reason: any) => {\n          reject(reason);\n        };\n\n        worker.addEventListener('message', msgHandler);\n        dispose.push(() => {\n          worker?.removeEventListener('message', msgHandler);\n        });\n\n        terminateAbort.signal.addEventListener('abort', abortHandler);\n        dispose.push(() => {\n          terminateAbort.signal.removeEventListener('abort', abortHandler);\n        });\n\n        worker.postMessage({\n          type: 'run',\n          msgId: currentMsgId,\n          input,\n        } as WorkerIngoingMessage);\n      }).finally(() => {\n        for (const d of dispose) {\n          d();\n        }\n      });\n    },\n    dispose: () => {\n      worker.terminate();\n      terminateAbort.abort(MANUALLY_STOP);\n    },\n  };\n}\n\nexport type IndexerWorker = Awaited<ReturnType<typeof createWorker>>;\n","import { DebugLogger } from '@affine/debug';\nimport type { Job, JobQueue, WorkspaceService } from '@toeverything/infra';\nimport {\n  Entity,\n  IndexedDBIndexStorage,\n  IndexedDBJobQueue,\n  JobRunner,\n  LiveData,\n  WorkspaceDBService,\n} from '@toeverything/infra';\nimport { map } from 'rxjs';\n\nimport { blockIndexSchema, docIndexSchema } from '../schema';\nimport { createWorker, type IndexerWorker } from '../worker/out-worker';\n\nexport function isEmptyUpdate(binary: Uint8Array) {\n  return (\n    binary.byteLength === 0 ||\n    (binary.byteLength === 2 && binary[0] === 0 && binary[1] === 0)\n  );\n}\n\nconst logger = new DebugLogger('crawler');\n\ninterface IndexerJobPayload {\n  storageDocId: string;\n}\n\nexport class DocsIndexer extends Entity {\n  private readonly jobQueue: JobQueue<IndexerJobPayload> =\n    new IndexedDBJobQueue<IndexerJobPayload>(\n      'jq:' + this.workspaceService.workspace.id\n    );\n\n  private readonly runner = new JobRunner(\n    this.jobQueue,\n    (jobs, signal) => this.execJob(jobs, signal),\n    () =>\n      new Promise<void>(resolve =>\n        requestIdleCallback(() => resolve(), {\n          timeout: 200,\n        })\n      )\n  );\n\n  private readonly indexStorage = new IndexedDBIndexStorage(\n    'idx:' + this.workspaceService.workspace.id\n  );\n\n  readonly docIndex = this.indexStorage.getIndex('doc', docIndexSchema);\n\n  readonly blockIndex = this.indexStorage.getIndex('block', blockIndexSchema);\n\n  private readonly workspaceEngine = this.workspaceService.workspace.engine;\n\n  private readonly workspaceId = this.workspaceService.workspace.id;\n\n  private worker: IndexerWorker | null = null;\n\n  readonly status$ = LiveData.from<{ remaining?: number }>(\n    this.jobQueue.status$.pipe(\n      map(status => ({\n        remaining: status.remaining,\n      }))\n    ),\n    {}\n  );\n\n  constructor(private readonly workspaceService: WorkspaceService) {\n    super();\n  }\n\n  setupListener() {\n    this.workspaceEngine.doc.storage.eventBus.on(event => {\n      if (WorkspaceDBService.isDBDocId(event.docId)) {\n        // skip db doc\n        return;\n      }\n      if (event.clientId === this.workspaceEngine.doc.clientId) {\n        this.jobQueue\n          .enqueue([\n            {\n              batchKey: event.docId,\n              payload: { storageDocId: event.docId },\n            },\n          ])\n          .catch(err => {\n            console.error('Error enqueueing job', err);\n          });\n      }\n    });\n  }\n\n  async execJob(jobs: Job<IndexerJobPayload>[], signal: AbortSignal) {\n    if (jobs.length === 0) {\n      return;\n    }\n\n    // jobs should have the same storage docId, so we just pick the first one\n    const storageDocId = jobs[0].payload.storageDocId;\n\n    const worker = await this.ensureWorker(signal);\n\n    const startTime = performance.now();\n    logger.debug('Start crawling job for storageDocId:', storageDocId);\n\n    let workerOutput;\n\n    if (storageDocId === this.workspaceId) {\n      const rootDocBuffer =\n        await this.workspaceEngine.doc.storage.loadDocFromLocal(\n          this.workspaceId\n        );\n\n      if (!rootDocBuffer) {\n        return;\n      }\n\n      const allIndexedDocs = (\n        await this.docIndex.search(\n          {\n            type: 'all',\n          },\n          {\n            pagination: {\n              limit: Number.MAX_SAFE_INTEGER,\n              skip: 0,\n            },\n          }\n        )\n      ).nodes.map(n => n.id);\n\n      workerOutput = await worker.run({\n        type: 'rootDoc',\n        allIndexedDocs,\n        rootDocBuffer,\n      });\n    } else {\n      const rootDocBuffer =\n        await this.workspaceEngine.doc.storage.loadDocFromLocal(\n          this.workspaceId\n        );\n\n      const docBuffer =\n        (await this.workspaceEngine.doc.storage.loadDocFromLocal(\n          storageDocId\n        )) ?? new Uint8Array(0);\n\n      if (!rootDocBuffer) {\n        return;\n      }\n\n      workerOutput = await worker.run({\n        type: 'doc',\n        docBuffer,\n        storageDocId,\n        rootDocBuffer,\n      });\n    }\n\n    if (workerOutput.deletedDoc || workerOutput.addedDoc) {\n      if (workerOutput.deletedDoc) {\n        const docIndexWriter = await this.docIndex.write();\n        for (const docId of workerOutput.deletedDoc) {\n          docIndexWriter.delete(docId);\n        }\n        await docIndexWriter.commit();\n        const blockIndexWriter = await this.blockIndex.write();\n        for (const docId of workerOutput.deletedDoc) {\n          const oldBlocks = await blockIndexWriter.search(\n            {\n              type: 'match',\n              field: 'docId',\n              match: docId,\n            },\n            {\n              pagination: {\n                limit: Number.MAX_SAFE_INTEGER,\n              },\n            }\n          );\n          for (const block of oldBlocks.nodes) {\n            blockIndexWriter.delete(block.id);\n          }\n        }\n        await blockIndexWriter.commit();\n      }\n      if (workerOutput.addedDoc) {\n        const docIndexWriter = await this.docIndex.write();\n        for (const { doc } of workerOutput.addedDoc) {\n          docIndexWriter.put(doc);\n        }\n        await docIndexWriter.commit();\n        const blockIndexWriter = await this.blockIndex.write();\n        for (const { id, blocks } of workerOutput.addedDoc) {\n          // delete old blocks\n          const oldBlocks = await blockIndexWriter.search(\n            {\n              type: 'match',\n              field: 'docId',\n              match: id,\n            },\n            {\n              pagination: {\n                limit: Number.MAX_SAFE_INTEGER,\n              },\n            }\n          );\n          for (const block of oldBlocks.nodes) {\n            blockIndexWriter.delete(block.id);\n          }\n          for (const block of blocks) {\n            blockIndexWriter.insert(block);\n          }\n        }\n        await blockIndexWriter.commit();\n      }\n    }\n\n    if (workerOutput.reindexDoc) {\n      await this.jobQueue.enqueue(\n        workerOutput.reindexDoc.map(({ storageDocId }) => ({\n          batchKey: storageDocId,\n          payload: { storageDocId },\n        }))\n      );\n    }\n\n    const duration = performance.now() - startTime;\n    logger.debug(\n      'Finish crawling job for storageDocId:' +\n        storageDocId +\n        ' in ' +\n        duration +\n        'ms '\n    );\n  }\n\n  startCrawling() {\n    this.runner.start();\n    this.jobQueue\n      .enqueue([\n        {\n          batchKey: this.workspaceId,\n          payload: { storageDocId: this.workspaceId },\n        },\n      ])\n      .catch(err => {\n        console.error('Error enqueueing job', err);\n      });\n  }\n\n  async ensureWorker(signal: AbortSignal): Promise<IndexerWorker> {\n    if (!this.worker) {\n      this.worker = await createWorker(signal);\n    }\n    return this.worker;\n  }\n\n  override dispose(): void {\n    this.runner.stop();\n  }\n}\n","export { DocsSearchService } from './services/docs-search';\n\nimport {\n  type Framework,\n  WorkspaceScope,\n  WorkspaceService,\n} from '@toeverything/infra';\n\nimport { DocsIndexer } from './entities/docs-indexer';\nimport { DocsSearchService } from './services/docs-search';\n\nexport function configureDocsSearchModule(framework: Framework) {\n  framework\n    .scope(WorkspaceScope)\n    .service(DocsSearchService)\n    .entity(DocsIndexer, [WorkspaceService]);\n}\n","import type { GlobalCache } from '@toeverything/infra';\nimport { Entity, LiveData } from '@toeverything/infra';\nimport { map } from 'rxjs';\n\nimport type { CollapsibleSectionName } from '../types';\n\nconst DEFAULT_COLLAPSABLE_STATE: Record<CollapsibleSectionName, boolean> = {\n  favorites: false,\n  organize: false,\n  collections: true,\n  tags: true,\n  favoritesOld: true,\n  migrationFavorites: true,\n};\n\nexport class ExplorerSection extends Entity<{ name: CollapsibleSectionName }> {\n  name: CollapsibleSectionName = this.props.name;\n  key = `explorer.section.${this.name}`;\n  defaultValue = DEFAULT_COLLAPSABLE_STATE[this.name];\n\n  constructor(private readonly globalCache: GlobalCache) {\n    super();\n  }\n\n  collapsed$ = LiveData.from(\n    this.globalCache\n      .watch<boolean>(this.key)\n      .pipe(map(v => v ?? this.defaultValue)),\n    this.defaultValue\n  );\n\n  setCollapsed(collapsed: boolean) {\n    this.globalCache.set(this.key, collapsed);\n  }\n}\n","import { type DropTargetDropEvent, useDropTarget } from '@affine/component';\nimport type { AffineDNDData } from '@affine/core/types/dnd';\nimport { useI18n } from '@affine/i18n';\n\nimport { EmptyNodeChildren } from '../../layouts/empty-node-children';\n\nexport const Empty = ({\n  onDrop,\n}: {\n  onDrop: (data: DropTargetDropEvent<AffineDNDData>) => void;\n}) => {\n  const { dropTargetRef } = useDropTarget(\n    () => ({\n      onDrop,\n    }),\n    [onDrop]\n  );\n  const t = useI18n();\n  return (\n    <EmptyNodeChildren ref={dropTargetRef}>\n      {t['com.affine.collection.emptyCollection']()}\n    </EmptyNodeChildren>\n  );\n};\n","import {\n  IconButton,\n  MenuIcon,\n  MenuItem,\n  MenuSeparator,\n  useConfirmModal,\n} from '@affine/component';\nimport { useAppSettingHelper } from '@affine/core/hooks/affine/use-app-setting-helper';\nimport { useDeleteCollectionInfo } from '@affine/core/hooks/affine/use-delete-collection-info';\nimport { track } from '@affine/core/mixpanel';\nimport { CollectionService } from '@affine/core/modules/collection';\nimport { CompatibleFavoriteItemsAdapter } from '@affine/core/modules/properties';\nimport { WorkbenchService } from '@affine/core/modules/workbench';\nimport { useI18n } from '@affine/i18n';\nimport {\n  DeleteIcon,\n  FavoritedIcon,\n  FavoriteIcon,\n  FilterIcon,\n  OpenInNewIcon,\n  PlusIcon,\n  SplitViewIcon,\n} from '@blocksuite/icons/rc';\nimport { DocsService, useLiveData, useServices } from '@toeverything/infra';\nimport { useCallback, useMemo } from 'react';\n\nimport type { NodeOperation } from '../../tree/types';\n\nexport const useExplorerCollectionNodeOperations = (\n  collectionId: string,\n  onOpenCollapsed: () => void,\n  onOpenEdit: () => void\n): NodeOperation[] => {\n  const t = useI18n();\n  const { appSettings } = useAppSettingHelper();\n  const {\n    workbenchService,\n    docsService,\n    collectionService,\n    compatibleFavoriteItemsAdapter,\n  } = useServices({\n    DocsService,\n    WorkbenchService,\n    CollectionService,\n    CompatibleFavoriteItemsAdapter,\n  });\n  const deleteInfo = useDeleteCollectionInfo();\n\n  const favorite = useLiveData(\n    useMemo(\n      () =>\n        compatibleFavoriteItemsAdapter.isFavorite$(collectionId, 'collection'),\n      [collectionId, compatibleFavoriteItemsAdapter]\n    )\n  );\n  const { openConfirmModal } = useConfirmModal();\n\n  const createAndAddDocument = useCallback(() => {\n    const newDoc = docsService.createDoc();\n    collectionService.addPageToCollection(collectionId, newDoc.id);\n    track.$.navigationPanel.collections.createDoc();\n    track.$.navigationPanel.collections.addDocToCollection({\n      control: 'button',\n    });\n    workbenchService.workbench.openDoc(newDoc.id);\n    onOpenCollapsed();\n  }, [\n    collectionId,\n    collectionService,\n    docsService,\n    onOpenCollapsed,\n    workbenchService.workbench,\n  ]);\n\n  const handleToggleFavoriteCollection = useCallback(() => {\n    compatibleFavoriteItemsAdapter.toggle(collectionId, 'collection');\n    track.$.navigationPanel.organize.toggleFavorite({\n      type: 'collection',\n    });\n  }, [compatibleFavoriteItemsAdapter, collectionId]);\n\n  const handleAddDocToCollection = useCallback(() => {\n    openConfirmModal({\n      title: t['com.affine.collection.add-doc.confirm.title'](),\n      description: t['com.affine.collection.add-doc.confirm.description'](),\n      cancelText: t['Cancel'](),\n      confirmText: t['Confirm'](),\n      confirmButtonOptions: {\n        variant: 'primary',\n      },\n      onConfirm: createAndAddDocument,\n    });\n  }, [createAndAddDocument, openConfirmModal, t]);\n\n  const handleOpenInSplitView = useCallback(() => {\n    workbenchService.workbench.openCollection(collectionId, { at: 'beside' });\n    track.$.navigationPanel.organize.openInSplitView({\n      type: 'collection',\n    });\n  }, [collectionId, workbenchService.workbench]);\n\n  const handleOpenInNewTab = useCallback(() => {\n    workbenchService.workbench.openCollection(collectionId, { at: 'new-tab' });\n    track.$.navigationPanel.organize.openInNewTab({ type: 'collection' });\n  }, [collectionId, workbenchService.workbench]);\n\n  const handleDeleteCollection = useCallback(() => {\n    collectionService.deleteCollection(deleteInfo, collectionId);\n    track.$.navigationPanel.organize.deleteOrganizeItem({\n      type: 'collection',\n    });\n  }, [collectionId, collectionService, deleteInfo]);\n\n  const handleShowEdit = useCallback(() => {\n    onOpenEdit();\n  }, [onOpenEdit]);\n\n  return useMemo(\n    () => [\n      {\n        index: 0,\n        inline: true,\n        view: (\n          <IconButton\n            size=\"16\"\n            onClick={handleAddDocToCollection}\n            tooltip={t[\n              'com.affine.rootAppSidebar.explorer.collection-add-tooltip'\n            ]()}\n          >\n            <PlusIcon />\n          </IconButton>\n        ),\n      },\n      {\n        index: 99,\n        view: (\n          <MenuItem\n            preFix={\n              <MenuIcon>\n                <FilterIcon />\n              </MenuIcon>\n            }\n            onClick={handleShowEdit}\n          >\n            {t['com.affine.collection.menu.edit']()}\n          </MenuItem>\n        ),\n      },\n      {\n        index: 99,\n        view: (\n          <MenuItem\n            preFix={\n              <MenuIcon>\n                <PlusIcon />\n              </MenuIcon>\n            }\n            onClick={handleAddDocToCollection}\n          >\n            {t['New Page']()}\n          </MenuItem>\n        ),\n      },\n      {\n        index: 99,\n        view: (\n          <MenuItem\n            preFix={\n              <MenuIcon>\n                {favorite ? (\n                  <FavoritedIcon\n                    style={{ color: 'var(--affine-primary-color)' }}\n                  />\n                ) : (\n                  <FavoriteIcon />\n                )}\n              </MenuIcon>\n            }\n            onClick={handleToggleFavoriteCollection}\n          >\n            {favorite\n              ? t['com.affine.favoritePageOperation.remove']()\n              : t['com.affine.favoritePageOperation.add']()}\n          </MenuItem>\n        ),\n      },\n      {\n        index: 99,\n        view: (\n          <MenuItem\n            preFix={\n              <MenuIcon>\n                <OpenInNewIcon />\n              </MenuIcon>\n            }\n            onClick={handleOpenInNewTab}\n          >\n            {t['com.affine.workbench.tab.page-menu-open']()}\n          </MenuItem>\n        ),\n      },\n      ...(appSettings.enableMultiView\n        ? [\n            {\n              index: 99,\n              view: (\n                <MenuItem\n                  preFix={\n                    <MenuIcon>\n                      <SplitViewIcon />\n                    </MenuIcon>\n                  }\n                  onClick={handleOpenInSplitView}\n                >\n                  {t['com.affine.workbench.split-view.page-menu-open']()}\n                </MenuItem>\n              ),\n            },\n          ]\n        : []),\n      {\n        index: 9999,\n        view: <MenuSeparator key=\"menu-separator\" />,\n      },\n      {\n        index: 10000,\n        view: (\n          <MenuItem\n            type={'danger'}\n            preFix={\n              <MenuIcon>\n                <DeleteIcon />\n              </MenuIcon>\n            }\n            onClick={handleDeleteCollection}\n          >\n            {t['Delete']()}\n          </MenuItem>\n        ),\n      },\n    ],\n    [\n      appSettings.enableMultiView,\n      favorite,\n      handleAddDocToCollection,\n      handleDeleteCollection,\n      handleOpenInNewTab,\n      handleOpenInSplitView,\n      handleShowEdit,\n      handleToggleFavoriteCollection,\n      t,\n    ]\n  );\n};\n","import {\n  AnimatedCollectionsIcon,\n  type DropTargetDropEvent,\n  type DropTargetOptions,\n  MenuIcon,\n  MenuItem,\n  toast,\n} from '@affine/component';\nimport {\n  filterPage,\n  useEditCollection,\n} from '@affine/core/components/page-list';\nimport { track } from '@affine/core/mixpanel';\nimport { CollectionService } from '@affine/core/modules/collection';\nimport { CompatibleFavoriteItemsAdapter } from '@affine/core/modules/properties';\nimport { ShareDocsService } from '@affine/core/modules/share-doc';\nimport type { AffineDNDData } from '@affine/core/types/dnd';\nimport type { Collection } from '@affine/env/filter';\nimport { PublicPageMode } from '@affine/graphql';\nimport { useI18n } from '@affine/i18n';\nimport { FilterMinusIcon } from '@blocksuite/icons/rc';\nimport type { DocMeta } from '@blocksuite/store';\nimport {\n  DocsService,\n  GlobalContextService,\n  LiveData,\n  useLiveData,\n  useService,\n  useServices,\n} from '@toeverything/infra';\nimport { useCallback, useEffect, useMemo, useState } from 'react';\n\nimport { ExplorerTreeNode, type ExplorerTreeNodeDropEffect } from '../../tree';\nimport type { ExplorerTreeNodeIcon } from '../../tree/node';\nimport { ExplorerDocNode } from '../doc';\nimport type { GenericExplorerNode } from '../types';\nimport { Empty } from './empty';\nimport { useExplorerCollectionNodeOperations } from './operations';\n\nconst CollectionIcon: ExplorerTreeNodeIcon = ({\n  className,\n  draggedOver,\n  treeInstruction,\n}) => (\n  <AnimatedCollectionsIcon\n    className={className}\n    closed={!!draggedOver && treeInstruction?.type === 'make-child'}\n  />\n);\n\nexport const ExplorerCollectionNode = ({\n  collectionId,\n  onDrop,\n  location,\n  reorderable,\n  operations: additionalOperations,\n  canDrop,\n  dropEffect,\n}: {\n  collectionId: string;\n} & GenericExplorerNode) => {\n  const t = useI18n();\n  const { globalContextService } = useServices({\n    GlobalContextService,\n  });\n  const { open: openEditCollectionModal, node: editModal } =\n    useEditCollection();\n  const active =\n    useLiveData(globalContextService.globalContext.collectionId.$) ===\n    collectionId;\n  const [collapsed, setCollapsed] = useState(true);\n\n  const collectionService = useService(CollectionService);\n  const collection = useLiveData(collectionService.collection$(collectionId));\n\n  const dndData = useMemo(() => {\n    return {\n      draggable: {\n        entity: {\n          type: 'collection',\n          id: collectionId,\n        },\n        from: location,\n      },\n      dropTarget: {\n        at: 'explorer:doc',\n      },\n    } satisfies AffineDNDData;\n  }, [collectionId, location]);\n\n  const handleRename = useCallback(\n    (name: string) => {\n      if (collection && collection.name !== name) {\n        collectionService.updateCollection(collectionId, () => ({\n          ...collection,\n          name,\n        }));\n\n        track.$.navigationPanel.organize.renameOrganizeItem({\n          type: 'collection',\n        });\n        toast(t['com.affine.toastMessage.rename']());\n      }\n    },\n    [collection, collectionId, collectionService, t]\n  );\n\n  const handleAddDocToCollection = useCallback(\n    (docId: string) => {\n      if (!collection) {\n        return;\n      }\n      if (collection.allowList.includes(docId)) {\n        toast(t['com.affine.collection.addPage.alreadyExists']());\n      } else {\n        collectionService.addPageToCollection(collection.id, docId);\n      }\n    },\n    [collection, collectionService, t]\n  );\n\n  const handleDropOnCollection = useCallback(\n    (data: DropTargetDropEvent<AffineDNDData>) => {\n      if (collection && data.treeInstruction?.type === 'make-child') {\n        if (data.source.data.entity?.type === 'doc') {\n          handleAddDocToCollection(data.source.data.entity.id);\n          track.$.navigationPanel.organize.createOrganizeItem({\n            type: 'link',\n            target: 'doc',\n            control: 'drag',\n          });\n        }\n      } else {\n        onDrop?.(data);\n      }\n    },\n    [collection, onDrop, handleAddDocToCollection]\n  );\n\n  const handleDropEffectOnCollection = useCallback<ExplorerTreeNodeDropEffect>(\n    data => {\n      if (collection && data.treeInstruction?.type === 'make-child') {\n        if (data.source.data.entity?.type === 'doc') {\n          return 'link';\n        }\n      } else {\n        return dropEffect?.(data);\n      }\n      return;\n    },\n    [collection, dropEffect]\n  );\n\n  const handleDropOnPlaceholder = useCallback(\n    (data: DropTargetDropEvent<AffineDNDData>) => {\n      if (collection && data.source.data.entity?.type === 'doc') {\n        handleAddDocToCollection(data.source.data.entity.id);\n        track.$.navigationPanel.organize.createOrganizeItem({\n          type: 'collection',\n          control: 'drag',\n        });\n      }\n    },\n    [collection, handleAddDocToCollection]\n  );\n\n  const handleOpenCollapsed = useCallback(() => {\n    setCollapsed(false);\n  }, []);\n\n  const handleEditCollection = useCallback(() => {\n    if (!collection) {\n      return;\n    }\n    openEditCollectionModal(collection)\n      .then(collection => {\n        return collectionService.updateCollection(\n          collection.id,\n          () => collection\n        );\n      })\n      .catch(err => {\n        console.error(err);\n      });\n  }, [collection, collectionService, openEditCollectionModal]);\n\n  const collectionOperations = useExplorerCollectionNodeOperations(\n    collectionId,\n    handleOpenCollapsed,\n    handleEditCollection\n  );\n\n  const finalOperations = useMemo(() => {\n    if (additionalOperations) {\n      return [...additionalOperations, ...collectionOperations];\n    }\n    return collectionOperations;\n  }, [collectionOperations, additionalOperations]);\n\n  const handleCanDrop = useMemo<DropTargetOptions<AffineDNDData>['canDrop']>(\n    () => args => {\n      const entityType = args.source.data.entity?.type;\n      return args.treeInstruction?.type !== 'make-child'\n        ? ((typeof canDrop === 'function' ? canDrop(args) : canDrop) ?? true)\n        : entityType === 'doc';\n    },\n    [canDrop]\n  );\n\n  if (!collection) {\n    return null;\n  }\n\n  return (\n    <>\n      <ExplorerTreeNode\n        icon={CollectionIcon}\n        name={collection.name || t['Untitled']()}\n        dndData={dndData}\n        onDrop={handleDropOnCollection}\n        renameable\n        collapsed={collapsed}\n        setCollapsed={setCollapsed}\n        to={`/collection/${collection.id}`}\n        active={active}\n        canDrop={handleCanDrop}\n        reorderable={reorderable}\n        onRename={handleRename}\n        childrenPlaceholder={<Empty onDrop={handleDropOnPlaceholder} />}\n        operations={finalOperations}\n        dropEffect={handleDropEffectOnCollection}\n        data-testid={`explorer-collection-${collectionId}`}\n      >\n        <ExplorerCollectionNodeChildren collection={collection} />\n      </ExplorerTreeNode>\n      {editModal}\n    </>\n  );\n};\n\nconst ExplorerCollectionNodeChildren = ({\n  collection,\n}: {\n  collection: Collection;\n}) => {\n  const t = useI18n();\n  const {\n    docsService,\n    compatibleFavoriteItemsAdapter,\n    shareDocsService,\n    collectionService,\n  } = useServices({\n    DocsService,\n    CompatibleFavoriteItemsAdapter,\n    ShareDocsService,\n    CollectionService,\n  });\n\n  useEffect(() => {\n    // TODO(@eyhn): loading & error UI\n    shareDocsService.shareDocs?.revalidate();\n  }, [shareDocsService]);\n\n  const docMetas = useLiveData(\n    useMemo(\n      () =>\n        LiveData.computed(get => {\n          return get(docsService.list.docs$).map(\n            doc => get(doc.meta$) as DocMeta\n          );\n        }),\n      [docsService]\n    )\n  );\n  const favourites = useLiveData(compatibleFavoriteItemsAdapter.favorites$);\n  const allowList = useMemo(\n    () => new Set(collection.allowList),\n    [collection.allowList]\n  );\n  const shareDocs = useLiveData(shareDocsService.shareDocs?.list$);\n\n  const handleRemoveFromAllowList = useCallback(\n    (id: string) => {\n      track.$.navigationPanel.collections.removeOrganizeItem({ type: 'doc' });\n      collectionService.deletePageFromCollection(collection.id, id);\n      toast(t['com.affine.collection.removePage.success']());\n    },\n    [collection.id, collectionService, t]\n  );\n\n  const filtered = docMetas.filter(meta => {\n    if (meta.trash) return false;\n    const publicMode = shareDocs?.find(d => d.id === meta.id)?.mode;\n    const pageData = {\n      meta: meta as DocMeta,\n      publicMode:\n        publicMode === PublicPageMode.Edgeless\n          ? ('edgeless' as const)\n          : publicMode === PublicPageMode.Page\n            ? ('page' as const)\n            : undefined,\n      favorite: favourites.some(fav => fav.id === meta.id),\n    };\n    return filterPage(collection, pageData);\n  });\n\n  return filtered.map(doc => (\n    <ExplorerDocNode\n      key={doc.id}\n      docId={doc.id}\n      reorderable={false}\n      location={{\n        at: 'explorer:collection:filtered-docs',\n        collectionId: collection.id,\n      }}\n      operations={\n        allowList\n          ? [\n              {\n                index: 99,\n                view: (\n                  <MenuItem\n                    preFix={\n                      <MenuIcon>\n                        <FilterMinusIcon />\n                      </MenuIcon>\n                    }\n                    onClick={() => handleRemoveFromAllowList(doc.id)}\n                  >\n                    {t['Remove special filter']()}\n                  </MenuItem>\n                ),\n              },\n            ]\n          : []\n      }\n    />\n  ));\n};\n","import { useI18n } from '@affine/i18n';\nimport { ViewLayersIcon } from '@blocksuite/icons/rc';\n\nimport { ExplorerEmptySection } from '../../layouts/empty-section';\n\nexport const RootEmpty = ({\n  onClickCreate,\n}: {\n  onClickCreate?: () => void;\n}) => {\n  const t = useI18n();\n\n  return (\n    <ExplorerEmptySection\n      icon={ViewLayersIcon}\n      message={t['com.affine.collections.empty.message']()}\n      messageTestId=\"slider-bar-collection-empty-message\"\n      actionText={t['com.affine.collections.empty.new-collection-button']()}\n      onActionClick={onClickCreate}\n    />\n  );\n};\n","import { IconButton } from '@affine/component';\nimport { useEditCollectionName } from '@affine/core/components/page-list';\nimport { createEmptyCollection } from '@affine/core/components/page-list/use-collection-manager';\nimport { track } from '@affine/core/mixpanel';\nimport { CollectionService } from '@affine/core/modules/collection';\nimport { ExplorerTreeRoot } from '@affine/core/modules/explorer/views/tree';\nimport { WorkbenchService } from '@affine/core/modules/workbench';\nimport { useI18n } from '@affine/i18n';\nimport { PlusIcon } from '@blocksuite/icons/rc';\nimport { useLiveData, useServices } from '@toeverything/infra';\nimport { nanoid } from 'nanoid';\nimport { useCallback } from 'react';\n\nimport { ExplorerService } from '../../../services/explorer';\nimport { CollapsibleSection } from '../../layouts/collapsible-section';\nimport { ExplorerCollectionNode } from '../../nodes/collection';\nimport { RootEmpty } from './empty';\n\nexport const ExplorerCollections = () => {\n  const t = useI18n();\n  const { collectionService, workbenchService, explorerService } = useServices({\n    CollectionService,\n    WorkbenchService,\n    ExplorerService,\n  });\n  const explorerSection = explorerService.sections.collections;\n  const collections = useLiveData(collectionService.collections$);\n  const { node, open: openCreateCollectionModel } = useEditCollectionName({\n    title: t['com.affine.editCollection.createCollection'](),\n    showTips: true,\n  });\n\n  const handleCreateCollection = useCallback(() => {\n    openCreateCollectionModel('')\n      .then(name => {\n        const id = nanoid();\n        collectionService.addCollection(createEmptyCollection(id, { name }));\n        track.$.navigationPanel.organize.createOrganizeItem({\n          type: 'collection',\n        });\n        workbenchService.workbench.openCollection(id);\n        explorerSection.setCollapsed(false);\n      })\n      .catch(err => {\n        console.error(err);\n      });\n  }, [\n    collectionService,\n    explorerSection,\n    openCreateCollectionModel,\n    workbenchService.workbench,\n  ]);\n\n  return (\n    <>\n      <CollapsibleSection\n        name=\"collections\"\n        testId=\"explorer-collections\"\n        title={t['com.affine.rootAppSidebar.collections']()}\n        actions={\n          <IconButton\n            data-testid=\"explorer-bar-add-collection-button\"\n            onClick={handleCreateCollection}\n            size=\"16\"\n            tooltip={t[\n              'com.affine.rootAppSidebar.explorer.collection-section-add-tooltip'\n            ]()}\n          >\n            <PlusIcon />\n          </IconButton>\n        }\n      >\n        <ExplorerTreeRoot\n          placeholder={<RootEmpty onClickCreate={handleCreateCollection} />}\n        >\n          {collections.map(collection => (\n            <ExplorerCollectionNode\n              key={collection.id}\n              collectionId={collection.id}\n              reorderable={false}\n              location={{\n                at: 'explorer:collection:list',\n              }}\n            />\n          ))}\n        </ExplorerTreeRoot>\n      </CollapsibleSection>\n      {node}\n    </>\n  );\n};\n","import { Modal } from '@affine/component';\nimport { useMount } from '@toeverything/infra';\nimport { cssVar } from '@toeverything/theme';\nimport { useCallback, useEffect, useState } from 'react';\n\nimport type { BaseSelectorDialogProps } from '.';\n\nexport const useSelectDialog = function useSelectDialog<T>(\n  Component: React.FC<BaseSelectorDialogProps<T>>,\n  debugKey?: string\n) {\n  // to control whether the dialog is open, it's not equal to !!value\n  // when closing the dialog, show will be `false` first, then after the animation, value turns to `undefined`\n  const [show, setShow] = useState(false);\n  const [value, setValue] = useState<{\n    init?: T;\n    onConfirm: (v: T) => void;\n  }>();\n\n  const onOpenChanged = useCallback((open: boolean) => {\n    if (!open) setValue(undefined);\n    setShow(open);\n  }, []);\n\n  const close = useCallback(() => setShow(false), []);\n\n  /**\n   * Open a dialog to select items\n   */\n  const open = useCallback(\n    (ids?: T) => {\n      return new Promise<T>(resolve => {\n        setShow(true);\n        setValue({\n          init: ids,\n          onConfirm: list => {\n            close();\n            resolve(list);\n          },\n        });\n      });\n    },\n    [close]\n  );\n\n  const { mount } = useMount(debugKey);\n\n  useEffect(() => {\n    return mount(\n      <Modal\n        open={show}\n        onOpenChange={onOpenChanged}\n        withoutCloseButton\n        width=\"calc(100% - 32px)\"\n        height=\"80%\"\n        contentOptions={{\n          style: {\n            padding: 0,\n            maxWidth: 976,\n            background: cssVar('backgroundPrimaryColor'),\n          },\n        }}\n      >\n        {value ? (\n          <Component\n            init={value.init}\n            onCancel={close}\n            onConfirm={value.onConfirm}\n          />\n        ) : null}\n      </Modal>\n    );\n  }, [Component, close, mount, onOpenChanged, show, value]);\n\n  return open;\n};\n","import { SelectCollection } from '../collections';\nimport { SelectTag } from '../tags';\nimport { SelectPage } from '../view/edit-collection/select-page';\nimport { useSelectDialog } from './use-select-dialog';\n\nexport interface BaseSelectorDialogProps<T> {\n  init?: T;\n  onConfirm?: (data: T) => void;\n  onCancel?: () => void;\n}\n\n/**\n * Return a `open` function to open the select collection dialog.\n */\nexport const useSelectCollection = () => {\n  return useSelectDialog(SelectCollection, 'select-collection');\n};\n\n/**\n * Return a `open` function to open the select page dialog.\n */\nexport const useSelectDoc = () => {\n  return useSelectDialog(SelectPage, 'select-doc-dialog');\n};\n\n/**\n * Return a `open` function to open the select tag dialog.\n */\nexport const useSelectTag = () => {\n  return useSelectDialog(SelectTag, 'select-tag-dialog');\n};\n","import {\n  type DropTargetDropEvent,\n  type DropTargetOptions,\n  useDropTarget,\n} from '@affine/component';\nimport type { AffineDNDData } from '@affine/core/types/dnd';\nimport { useI18n } from '@affine/i18n';\n\nimport { EmptyNodeChildren } from '../../layouts/empty-node-children';\nimport { draggedOverHighlight } from './empty.css';\n\nexport const FolderEmpty = ({\n  canDrop,\n  onDrop,\n}: {\n  onDrop?: (data: DropTargetDropEvent<AffineDNDData>) => void;\n  canDrop?: DropTargetOptions<AffineDNDData>['canDrop'];\n}) => {\n  const { dropTargetRef } = useDropTarget(\n    () => ({\n      onDrop,\n      canDrop,\n    }),\n    [onDrop, canDrop]\n  );\n\n  const t = useI18n();\n  return (\n    <EmptyNodeChildren ref={dropTargetRef} className={draggedOverHighlight}>\n      {t['com.affine.rootAppSidebar.organize.empty-folder']()}\n    </EmptyNodeChildren>\n  );\n};\n","import \"../core/src/modules/explorer/views/nodes/folder/empty.css.ts.vanilla.css!=!../../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/modules/explorer/views/nodes/folder/empty.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll80eXFqa3gwW2RhdGEtZHJhZ2dlZC1vdmVyPSJ0cnVlIl0gewogIGJhY2tncm91bmQ6IHZhcigtLWFmZmluZS1ob3Zlci1jb2xvcik7CiAgYm9yZGVyLXJhZGl1czogNHB4Owp9\\\"}!../../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var draggedOverHighlight = '_4yqjkx0';","import { MenuIcon, MenuItem } from '@affine/component';\nimport { CompatibleFavoriteItemsAdapter } from '@affine/core/modules/properties';\nimport { useI18n } from '@affine/i18n';\nimport { FavoritedIcon, FavoriteIcon } from '@blocksuite/icons/rc';\nimport { useLiveData, useService } from '@toeverything/infra';\nimport { cssVar } from '@toeverything/theme';\nimport { useMemo } from 'react';\n\nexport const FavoriteFolderOperation = ({ id }: { id: string }) => {\n  const t = useI18n();\n  const compatibleFavoriteItemsAdapter = useService(\n    CompatibleFavoriteItemsAdapter\n  );\n\n  const favorite = useLiveData(\n    useMemo(() => {\n      return compatibleFavoriteItemsAdapter.isFavorite$(id, 'folder');\n    }, [compatibleFavoriteItemsAdapter, id])\n  );\n\n  return (\n    <MenuItem\n      preFix={\n        <MenuIcon>\n          {favorite ? (\n            <FavoritedIcon style={{ color: cssVar('primaryColor') }} />\n          ) : (\n            <FavoriteIcon />\n          )}\n        </MenuIcon>\n      }\n      onClick={() => compatibleFavoriteItemsAdapter.toggle(id, 'folder')}\n    >\n      {favorite\n        ? t['com.affine.rootAppSidebar.organize.folder-rm-favorite']()\n        : t['com.affine.rootAppSidebar.organize.folder-add-favorite']()}\n    </MenuItem>\n  );\n};\n","import {\n  AnimatedCollectionsIcon,\n  AnimatedFolderIcon,\n  type DropTargetDropEvent,\n  type DropTargetOptions,\n  IconButton,\n  MenuIcon,\n  MenuItem,\n  MenuSeparator,\n  MenuSub,\n  notify,\n} from '@affine/component';\nimport {\n  useSelectCollection,\n  useSelectDoc,\n  useSelectTag,\n} from '@affine/core/components/page-list/selector';\nimport { track } from '@affine/core/mixpanel';\nimport {\n  type FolderNode,\n  OrganizeService,\n} from '@affine/core/modules/organize';\nimport { CompatibleFavoriteItemsAdapter } from '@affine/core/modules/properties';\nimport { WorkbenchService } from '@affine/core/modules/workbench';\nimport type { AffineDNDData } from '@affine/core/types/dnd';\nimport { Unreachable } from '@affine/env/constant';\nimport { useI18n } from '@affine/i18n';\nimport {\n  DeleteIcon,\n  FolderIcon,\n  PageIcon,\n  PlusIcon,\n  PlusThickIcon,\n  RemoveFolderIcon,\n  TagsIcon,\n} from '@blocksuite/icons/rc';\nimport { DocsService, useLiveData, useServices } from '@toeverything/infra';\nimport { difference } from 'lodash-es';\nimport { useCallback, useMemo, useState } from 'react';\n\nimport { ExplorerTreeNode, type ExplorerTreeNodeDropEffect } from '../../tree';\nimport type { ExplorerTreeNodeIcon } from '../../tree/node';\nimport type { NodeOperation } from '../../tree/types';\nimport { ExplorerCollectionNode } from '../collection';\nimport { ExplorerDocNode } from '../doc';\nimport { ExplorerTagNode } from '../tag';\nimport type { GenericExplorerNode } from '../types';\nimport { FolderEmpty } from './empty';\nimport { FavoriteFolderOperation } from './operations';\n\nexport const ExplorerFolderNode = ({\n  nodeId,\n  onDrop,\n  defaultRenaming,\n  operations,\n  location,\n  dropEffect,\n  canDrop,\n  reorderable,\n}: {\n  defaultRenaming?: boolean;\n  nodeId: string;\n  onDrop?: (data: DropTargetDropEvent<AffineDNDData>, node: FolderNode) => void;\n  operations?:\n    | NodeOperation[]\n    | ((type: string, node: FolderNode) => NodeOperation[]);\n} & Omit<GenericExplorerNode, 'operations'>) => {\n  const { organizeService } = useServices({ OrganizeService });\n  const node = useLiveData(organizeService.folderTree.folderNode$(nodeId));\n  const type = useLiveData(node?.type$);\n  const data = useLiveData(node?.data$);\n  const handleDrop = useCallback(\n    (data: DropTargetDropEvent<AffineDNDData>) => {\n      if (!node) {\n        return;\n      }\n      onDrop?.(data, node);\n    },\n    [node, onDrop]\n  );\n  const additionalOperations = useMemo(() => {\n    if (!type || !node) {\n      return;\n    }\n    if (typeof operations === 'function') {\n      return operations(type, node);\n    }\n    return operations;\n  }, [node, operations, type]);\n\n  if (!node) {\n    return;\n  }\n\n  if (type === 'folder') {\n    return (\n      <ExplorerFolderNodeFolder\n        node={node}\n        onDrop={handleDrop}\n        defaultRenaming={defaultRenaming}\n        operations={additionalOperations}\n        dropEffect={dropEffect}\n        reorderable={reorderable}\n        canDrop={canDrop}\n      />\n    );\n  } else if (type === 'doc') {\n    return (\n      data && (\n        <ExplorerDocNode\n          docId={data}\n          location={location}\n          onDrop={handleDrop}\n          reorderable={reorderable}\n          canDrop={canDrop}\n          dropEffect={dropEffect}\n          operations={additionalOperations}\n        />\n      )\n    );\n  } else if (type === 'collection') {\n    return (\n      data && (\n        <ExplorerCollectionNode\n          collectionId={data}\n          location={location}\n          onDrop={handleDrop}\n          canDrop={canDrop}\n          reorderable={reorderable}\n          dropEffect={dropEffect}\n          operations={additionalOperations}\n        />\n      )\n    );\n  } else if (type === 'tag') {\n    return (\n      data && (\n        <ExplorerTagNode\n          tagId={data}\n          location={location}\n          onDrop={handleDrop}\n          canDrop={canDrop}\n          reorderable\n          dropEffect={dropEffect}\n          operations={additionalOperations}\n        />\n      )\n    );\n  }\n\n  return;\n};\n\n// Define outside the `ExplorerFolderNodeFolder` to avoid re-render(the close animation won't play)\nconst ExplorerFolderIcon: ExplorerTreeNodeIcon = ({\n  collapsed,\n  className,\n  draggedOver,\n  treeInstruction,\n}) => (\n  <AnimatedFolderIcon\n    className={className}\n    open={\n      !collapsed || (!!draggedOver && treeInstruction?.type === 'make-child')\n    }\n  />\n);\n\nexport const ExplorerFolderNodeFolder = ({\n  node,\n  onDrop,\n  defaultRenaming,\n  location,\n  operations: additionalOperations,\n  canDrop,\n  dropEffect,\n  reorderable,\n}: {\n  defaultRenaming?: boolean;\n  node: FolderNode;\n} & GenericExplorerNode) => {\n  const t = useI18n();\n  const { docsService, workbenchService } = useServices({\n    DocsService,\n    WorkbenchService,\n    CompatibleFavoriteItemsAdapter,\n  });\n  const openDocsSelector = useSelectDoc();\n  const openTagsSelector = useSelectTag();\n  const openCollectionsSelector = useSelectCollection();\n  const name = useLiveData(node.name$);\n  const [collapsed, setCollapsed] = useState(true);\n  const [newFolderId, setNewFolderId] = useState<string | null>(null);\n\n  const handleDelete = useCallback(() => {\n    node.delete();\n    track.$.navigationPanel.organize.deleteOrganizeItem({\n      type: 'folder',\n    });\n    notify.success({\n      title: t['com.affine.rootAppSidebar.organize.delete.notify-title']({\n        name,\n      }),\n      message: t['com.affine.rootAppSidebar.organize.delete.notify-message'](),\n    });\n  }, [name, node, t]);\n\n  const children = useLiveData(node.sortedChildren$);\n\n  const dndData = useMemo(() => {\n    if (!node.id) {\n      throw new Unreachable();\n    }\n    return {\n      draggable: {\n        entity: {\n          type: 'folder',\n          id: node.id,\n        },\n        from: location,\n      },\n      dropTarget: {\n        at: 'explorer:organize:folder',\n      },\n    } satisfies AffineDNDData;\n  }, [location, node.id]);\n\n  const handleRename = useCallback(\n    (newName: string) => {\n      node.rename(newName);\n    },\n    [node]\n  );\n\n  const handleDropOnFolder = useCallback(\n    (data: DropTargetDropEvent<AffineDNDData>) => {\n      if (data.treeInstruction?.type === 'make-child') {\n        if (data.source.data.entity?.type === 'folder') {\n          if (\n            node.id === data.source.data.entity.id ||\n            node.beChildOf(data.source.data.entity.id)\n          ) {\n            return;\n          }\n          node.moveHere(data.source.data.entity.id, node.indexAt('before'));\n          track.$.navigationPanel.organize.moveOrganizeItem({ type: 'folder' });\n        } else if (\n          data.source.data.from?.at === 'explorer:organize:folder-node'\n        ) {\n          node.moveHere(data.source.data.from.nodeId, node.indexAt('before'));\n          track.$.navigationPanel.organize.moveOrganizeItem({\n            type: 'link',\n            target: data.source.data.entity?.type,\n          });\n        } else if (\n          data.source.data.entity?.type === 'collection' ||\n          data.source.data.entity?.type === 'doc' ||\n          data.source.data.entity?.type === 'tag'\n        ) {\n          node.createLink(\n            data.source.data.entity?.type,\n            data.source.data.entity.id,\n            node.indexAt('before')\n          );\n          track.$.navigationPanel.organize.createOrganizeItem({\n            type: 'link',\n            target: data.source.data.entity?.type,\n          });\n        }\n      } else {\n        onDrop?.(data);\n      }\n    },\n    [node, onDrop]\n  );\n\n  const handleDropEffect = useCallback<ExplorerTreeNodeDropEffect>(\n    data => {\n      if (data.treeInstruction?.type === 'make-child') {\n        if (data.source.data.entity?.type === 'folder') {\n          if (\n            node.id === data.source.data.entity.id ||\n            node.beChildOf(data.source.data.entity.id)\n          ) {\n            return;\n          }\n          return 'move';\n        } else if (\n          data.source.data.from?.at === 'explorer:organize:folder-node'\n        ) {\n          return 'move';\n        } else if (\n          data.source.data.entity?.type === 'collection' ||\n          data.source.data.entity?.type === 'doc' ||\n          data.source.data.entity?.type === 'tag'\n        ) {\n          return 'link';\n        }\n      } else {\n        return dropEffect?.(data);\n      }\n      return;\n    },\n    [dropEffect, node]\n  );\n\n  const handleDropOnPlaceholder = useCallback(\n    (data: DropTargetDropEvent<AffineDNDData>) => {\n      if (data.source.data.entity?.type === 'folder') {\n        if (\n          node.id === data.source.data.entity.id ||\n          node.beChildOf(data.source.data.entity.id)\n        ) {\n          return;\n        }\n        node.moveHere(data.source.data.entity.id, node.indexAt('before'));\n        track.$.navigationPanel.organize.moveOrganizeItem({ type: 'folder' });\n      } else if (\n        data.source.data.from?.at === 'explorer:organize:folder-node'\n      ) {\n        node.moveHere(data.source.data.from.nodeId, node.indexAt('before'));\n        track.$.navigationPanel.organize.moveOrganizeItem({\n          type: data.source.data.entity?.type,\n        });\n      } else if (\n        data.source.data.entity?.type === 'collection' ||\n        data.source.data.entity?.type === 'doc' ||\n        data.source.data.entity?.type === 'tag'\n      ) {\n        node.createLink(\n          data.source.data.entity?.type,\n          data.source.data.entity.id,\n          node.indexAt('before')\n        );\n        track.$.navigationPanel.organize.createOrganizeItem({\n          type: 'link',\n          target: data.source.data.entity?.type,\n        });\n      }\n    },\n    [node]\n  );\n\n  const handleDropOnChildren = useCallback(\n    (data: DropTargetDropEvent<AffineDNDData>, dropAtNode?: FolderNode) => {\n      if (!dropAtNode || !dropAtNode.id) {\n        return;\n      }\n      if (\n        data.treeInstruction?.type === 'reorder-above' ||\n        data.treeInstruction?.type === 'reorder-below'\n      ) {\n        const at =\n          data.treeInstruction?.type === 'reorder-below' ? 'after' : 'before';\n        if (data.source.data.entity?.type === 'folder') {\n          if (\n            node.id === data.source.data.entity.id ||\n            node.beChildOf(data.source.data.entity.id)\n          ) {\n            return;\n          }\n          node.moveHere(\n            data.source.data.entity.id,\n            node.indexAt(at, dropAtNode.id)\n          );\n          track.$.navigationPanel.organize.moveOrganizeItem({ type: 'folder' });\n        } else if (\n          data.source.data.from?.at === 'explorer:organize:folder-node'\n        ) {\n          node.moveHere(\n            data.source.data.from.nodeId,\n            node.indexAt(at, dropAtNode.id)\n          );\n          track.$.navigationPanel.organize.moveOrganizeItem({\n            type: 'link',\n            target: data.source.data.entity?.type,\n          });\n        } else if (\n          data.source.data.entity?.type === 'collection' ||\n          data.source.data.entity?.type === 'doc' ||\n          data.source.data.entity?.type === 'tag'\n        ) {\n          node.createLink(\n            data.source.data.entity?.type,\n            data.source.data.entity.id,\n            node.indexAt(at, dropAtNode.id)\n          );\n\n          track.$.navigationPanel.organize.createOrganizeItem({\n            type: 'link',\n            target: data.source.data.entity?.type,\n          });\n        }\n      } else if (data.treeInstruction?.type === 'reparent') {\n        const currentLevel = data.treeInstruction.currentLevel;\n        const desiredLevel = data.treeInstruction.desiredLevel;\n        if (currentLevel === desiredLevel + 1) {\n          onDrop?.({\n            ...data,\n            treeInstruction: {\n              type: 'reorder-below',\n              currentLevel,\n              indentPerLevel: data.treeInstruction.indentPerLevel,\n            },\n          });\n          return;\n        } else {\n          onDrop?.({\n            ...data,\n            treeInstruction: {\n              ...data.treeInstruction,\n              currentLevel: currentLevel - 1,\n            },\n          });\n        }\n      }\n    },\n    [node, onDrop]\n  );\n\n  const handleDropEffectOnChildren = useCallback<ExplorerTreeNodeDropEffect>(\n    data => {\n      if (\n        data.treeInstruction?.type === 'reorder-above' ||\n        data.treeInstruction?.type === 'reorder-below'\n      ) {\n        if (data.source.data.entity?.type === 'folder') {\n          if (\n            node.id === data.source.data.entity.id ||\n            node.beChildOf(data.source.data.entity.id)\n          ) {\n            return;\n          }\n          return 'move';\n        } else if (\n          data.source.data.from?.at === 'explorer:organize:folder-node'\n        ) {\n          return 'move';\n        } else if (\n          data.source.data.entity?.type === 'collection' ||\n          data.source.data.entity?.type === 'doc' ||\n          data.source.data.entity?.type === 'tag'\n        ) {\n          return 'link';\n        }\n      } else if (data.treeInstruction?.type === 'reparent') {\n        const currentLevel = data.treeInstruction.currentLevel;\n        const desiredLevel = data.treeInstruction.desiredLevel;\n        if (currentLevel === desiredLevel + 1) {\n          dropEffect?.({\n            ...data,\n            treeInstruction: {\n              type: 'reorder-below',\n              currentLevel,\n              indentPerLevel: data.treeInstruction.indentPerLevel,\n            },\n          });\n          return;\n        } else {\n          dropEffect?.({\n            ...data,\n            treeInstruction: {\n              ...data.treeInstruction,\n              currentLevel: currentLevel - 1,\n            },\n          });\n        }\n      }\n      return;\n    },\n    [dropEffect, node]\n  );\n\n  const handleCanDrop = useMemo<DropTargetOptions<AffineDNDData>['canDrop']>(\n    () => args => {\n      const entityType = args.source.data.entity?.type;\n      if (args.treeInstruction && args.treeInstruction?.type !== 'make-child') {\n        return (\n          (typeof canDrop === 'function' ? canDrop(args) : canDrop) ?? true\n        );\n      }\n\n      if (args.source.data.entity?.type === 'folder') {\n        if (\n          node.id === args.source.data.entity.id ||\n          node.beChildOf(args.source.data.entity.id)\n        ) {\n          return false;\n        }\n        return true;\n      } else if (\n        args.source.data.from?.at === 'explorer:organize:folder-node'\n      ) {\n        return true;\n      } else if (\n        entityType === 'collection' ||\n        entityType === 'doc' ||\n        entityType === 'tag'\n      ) {\n        return true;\n      }\n      return false;\n    },\n    [canDrop, node]\n  );\n\n  const handleChildrenCanDrop = useMemo<\n    DropTargetOptions<AffineDNDData>['canDrop']\n  >(\n    () => args => {\n      const entityType = args.source.data.entity?.type;\n\n      if (args.source.data.entity?.type === 'folder') {\n        if (\n          node.id === args.source.data.entity.id ||\n          node.beChildOf(args.source.data.entity.id)\n        ) {\n          return false;\n        }\n        return true;\n      } else if (\n        args.source.data.from?.at === 'explorer:organize:folder-node'\n      ) {\n        return true;\n      } else if (\n        entityType === 'collection' ||\n        entityType === 'doc' ||\n        entityType === 'tag'\n      ) {\n        return true;\n      }\n      return false;\n    },\n    [node]\n  );\n\n  const handleNewDoc = useCallback(() => {\n    const newDoc = docsService.createDoc();\n    node.createLink('doc', newDoc.id, node.indexAt('before'));\n    workbenchService.workbench.openDoc(newDoc.id);\n    track.$.navigationPanel.folders.createDoc();\n    track.$.navigationPanel.organize.createOrganizeItem({\n      type: 'link',\n      target: 'doc',\n    });\n    setCollapsed(false);\n  }, [docsService, node, workbenchService.workbench]);\n\n  const handleCreateSubfolder = useCallback(() => {\n    const newFolderId = node.createFolder(\n      t['com.affine.rootAppSidebar.organize.new-folders'](),\n      node.indexAt('before')\n    );\n    track.$.navigationPanel.organize.createOrganizeItem({ type: 'folder' });\n    setCollapsed(false);\n    setNewFolderId(newFolderId);\n  }, [node, t]);\n\n  const handleAddToFolder = useCallback(\n    (type: 'doc' | 'collection' | 'tag') => {\n      const initialIds = children\n        .filter(node => node.type$.value === type)\n        .map(node => node.data$.value)\n        .filter(Boolean) as string[];\n      const selector =\n        type === 'doc'\n          ? openDocsSelector\n          : type === 'collection'\n            ? openCollectionsSelector\n            : openTagsSelector;\n      selector(initialIds)\n        .then(selectedIds => {\n          const newItemIds = difference(selectedIds, initialIds);\n          const removedItemIds = difference(initialIds, selectedIds);\n          const removedItems = children.filter(\n            node =>\n              !!node.data$.value && removedItemIds.includes(node.data$.value)\n          );\n\n          newItemIds.forEach(id => {\n            node.createLink(type, id, node.indexAt('after'));\n          });\n          removedItems.forEach(node => node.delete());\n          const updated = newItemIds.length + removedItems.length;\n          updated && setCollapsed(false);\n        })\n        .catch(err => {\n          console.error(`Unexpected error while selecting ${type}`, err);\n        });\n      track.$.navigationPanel.organize.createOrganizeItem({\n        type: 'link',\n        target: type,\n      });\n    },\n    [\n      children,\n      node,\n      openCollectionsSelector,\n      openDocsSelector,\n      openTagsSelector,\n    ]\n  );\n\n  const folderOperations = useMemo(() => {\n    return [\n      {\n        index: 0,\n        inline: true,\n        view: (\n          <IconButton\n            size=\"16\"\n            onClick={handleNewDoc}\n            tooltip={t[\n              'com.affine.rootAppSidebar.explorer.organize-add-tooltip'\n            ]()}\n          >\n            <PlusIcon />\n          </IconButton>\n        ),\n      },\n      {\n        index: 100,\n        view: (\n          <MenuItem\n            preFix={\n              <MenuIcon>\n                <FolderIcon />\n              </MenuIcon>\n            }\n            onClick={handleCreateSubfolder}\n          >\n            {t['com.affine.rootAppSidebar.organize.folder.create-subfolder']()}\n          </MenuItem>\n        ),\n      },\n      {\n        index: 101,\n        view: (\n          <MenuItem\n            preFix={\n              <MenuIcon>\n                <PageIcon />\n              </MenuIcon>\n            }\n            onClick={() => handleAddToFolder('doc')}\n          >\n            {t['com.affine.rootAppSidebar.organize.folder.add-docs']()}\n          </MenuItem>\n        ),\n      },\n      {\n        index: 102,\n        view: (\n          <MenuSub\n            triggerOptions={{\n              preFix: (\n                <MenuIcon>\n                  <PlusThickIcon />\n                </MenuIcon>\n              ),\n            }}\n            items={\n              <>\n                <MenuItem\n                  onClick={() => handleAddToFolder('tag')}\n                  preFix={\n                    <MenuIcon>\n                      <TagsIcon />\n                    </MenuIcon>\n                  }\n                >\n                  {t['com.affine.rootAppSidebar.organize.folder.add-tags']()}\n                </MenuItem>\n                <MenuItem\n                  onClick={() => handleAddToFolder('collection')}\n                  preFix={\n                    <MenuIcon>\n                      <AnimatedCollectionsIcon closed={false} />\n                    </MenuIcon>\n                  }\n                >\n                  {t[\n                    'com.affine.rootAppSidebar.organize.folder.add-collections'\n                  ]()}\n                </MenuItem>\n              </>\n            }\n          >\n            {t['com.affine.rootAppSidebar.organize.folder.add-others']()}\n          </MenuSub>\n        ),\n      },\n\n      {\n        index: 200,\n        view: node.id ? <FavoriteFolderOperation id={node.id} /> : null,\n      },\n\n      {\n        index: 9999,\n        view: <MenuSeparator key=\"menu-separator\" />,\n      },\n      {\n        index: 10000,\n        view: (\n          <MenuItem\n            type={'danger'}\n            preFix={\n              <MenuIcon>\n                <DeleteIcon />\n              </MenuIcon>\n            }\n            onClick={handleDelete}\n          >\n            {t['com.affine.rootAppSidebar.organize.delete']()}\n          </MenuItem>\n        ),\n      },\n    ];\n  }, [\n    handleAddToFolder,\n    handleCreateSubfolder,\n    handleDelete,\n    handleNewDoc,\n    node,\n    t,\n  ]);\n\n  const finalOperations = useMemo(() => {\n    if (additionalOperations) {\n      return [...additionalOperations, ...folderOperations];\n    }\n    return folderOperations;\n  }, [additionalOperations, folderOperations]);\n\n  const childrenOperations = useCallback(\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    (type: string, node: FolderNode) => {\n      if (type === 'doc' || type === 'collection' || type === 'tag') {\n        return [\n          {\n            index: 999,\n            view: (\n              <MenuItem\n                type={'danger'}\n                preFix={\n                  <MenuIcon>\n                    <RemoveFolderIcon />\n                  </MenuIcon>\n                }\n                data-event-props=\"$.navigationPanel.organize.deleteOrganizeItem\"\n                data-event-args-type={node.type$.value}\n                onClick={() => node.delete()}\n              >\n                {t['com.affine.rootAppSidebar.organize.delete-from-folder']()}\n              </MenuItem>\n            ),\n          },\n        ] satisfies NodeOperation[];\n      }\n      return [];\n    },\n    [t]\n  );\n\n  const handleCollapsedChange = useCallback((collapsed: boolean) => {\n    if (collapsed) {\n      setNewFolderId(null); // reset new folder id to clear the renaming state\n      setCollapsed(true);\n    } else {\n      setCollapsed(false);\n    }\n  }, []);\n\n  return (\n    <ExplorerTreeNode\n      icon={ExplorerFolderIcon}\n      name={name}\n      dndData={dndData}\n      onDrop={handleDropOnFolder}\n      defaultRenaming={defaultRenaming}\n      renameable\n      reorderable={reorderable}\n      collapsed={collapsed}\n      setCollapsed={handleCollapsedChange}\n      onRename={handleRename}\n      operations={finalOperations}\n      canDrop={handleCanDrop}\n      childrenPlaceholder={\n        <FolderEmpty canDrop={handleCanDrop} onDrop={handleDropOnPlaceholder} />\n      }\n      dropEffect={handleDropEffect}\n      data-testid={`explorer-folder-${node.id}`}\n    >\n      {children.map(child => (\n        <ExplorerFolderNode\n          key={child.id}\n          nodeId={child.id as string}\n          defaultRenaming={child.id === newFolderId}\n          onDrop={handleDropOnChildren}\n          operations={childrenOperations}\n          dropEffect={handleDropEffectOnChildren}\n          canDrop={handleChildrenCanDrop}\n          location={{\n            at: 'explorer:organize:folder-node',\n            nodeId: child.id as string,\n          }}\n        />\n      ))}\n    </ExplorerTreeNode>\n  );\n};\n","import type { DropTargetOptions } from '@affine/component';\nimport { isFavoriteSupportType } from '@affine/core/modules/favorite';\nimport type { AffineDNDData } from '@affine/core/types/dnd';\n\nimport type { ExplorerTreeNodeDropEffect } from '../../tree';\n\nexport const favoriteChildrenDropEffect: ExplorerTreeNodeDropEffect = data => {\n  if (\n    data.treeInstruction?.type === 'reorder-above' ||\n    data.treeInstruction?.type === 'reorder-below'\n  ) {\n    if (\n      data.source.data.from?.at === 'explorer:favorite:list' &&\n      data.source.data.entity?.type &&\n      isFavoriteSupportType(data.source.data.entity.type)\n    ) {\n      return 'move';\n    } else if (\n      data.source.data.entity?.type &&\n      isFavoriteSupportType(data.source.data.entity.type)\n    ) {\n      return 'link';\n    }\n  }\n  return; // not supported\n};\n\nexport const favoriteRootDropEffect: ExplorerTreeNodeDropEffect = data => {\n  const sourceType = data.source.data.entity?.type;\n  if (sourceType && isFavoriteSupportType(sourceType)) {\n    return 'link';\n  }\n  return;\n};\n\nexport const favoriteRootCanDrop: DropTargetOptions<AffineDNDData>['canDrop'] =\n  data => {\n    return data.source.data.entity?.type\n      ? isFavoriteSupportType(data.source.data.entity.type)\n      : false;\n  };\n\nexport const favoriteChildrenCanDrop: DropTargetOptions<AffineDNDData>['canDrop'] =\n  // Same as favoriteRootCanDrop\n  data => favoriteRootCanDrop(data);\n","import {\n  type DropTargetDropEvent,\n  Skeleton,\n  useDropTarget,\n} from '@affine/component';\nimport type { AffineDNDData } from '@affine/core/types/dnd';\nimport { useI18n } from '@affine/i18n';\nimport { FavoriteIcon } from '@blocksuite/icons/rc';\n\nimport { ExplorerEmptySection } from '../../layouts/empty-section';\nimport { DropEffect } from '../../tree';\nimport { favoriteRootCanDrop, favoriteRootDropEffect } from './dnd';\n\ninterface RootEmptyProps {\n  onDrop?: (data: DropTargetDropEvent<AffineDNDData>) => void;\n  isLoading?: boolean;\n}\n\nconst RootEmptyLoading = () => {\n  return <Skeleton />;\n};\nconst RootEmptyReady = ({ onDrop }: Omit<RootEmptyProps, 'isLoading'>) => {\n  const t = useI18n();\n\n  const { dropTargetRef, draggedOverDraggable, draggedOverPosition } =\n    useDropTarget<AffineDNDData>(\n      () => ({\n        data: {\n          at: 'explorer:favorite:root',\n        },\n        onDrop: onDrop,\n        canDrop: favoriteRootCanDrop,\n      }),\n      [onDrop]\n    );\n\n  return (\n    <ExplorerEmptySection\n      ref={dropTargetRef}\n      icon={FavoriteIcon}\n      message={t['com.affine.rootAppSidebar.favorites.empty']()}\n      messageTestId=\"slider-bar-favorites-empty-message\"\n    >\n      {draggedOverDraggable && (\n        <DropEffect\n          position={draggedOverPosition}\n          dropEffect={favoriteRootDropEffect({\n            source: draggedOverDraggable,\n            treeInstruction: null,\n          })}\n        />\n      )}\n    </ExplorerEmptySection>\n  );\n};\n\nexport const RootEmpty = ({ isLoading, ...props }: RootEmptyProps) => {\n  return isLoading ? <RootEmptyLoading /> : <RootEmptyReady {...props} />;\n};\n","import {\n  type DropTargetDropEvent,\n  IconButton,\n  useDropTarget,\n} from '@affine/component';\nimport { track } from '@affine/core/mixpanel';\nimport {\n  DropEffect,\n  ExplorerTreeRoot,\n} from '@affine/core/modules/explorer/views/tree';\nimport type { FavoriteSupportType } from '@affine/core/modules/favorite';\nimport {\n  FavoriteService,\n  isFavoriteSupportType,\n} from '@affine/core/modules/favorite';\nimport { WorkbenchService } from '@affine/core/modules/workbench';\nimport type { AffineDNDData } from '@affine/core/types/dnd';\nimport { isNewTabTrigger } from '@affine/core/utils';\nimport { useI18n } from '@affine/i18n';\nimport { PlusIcon } from '@blocksuite/icons/rc';\nimport { DocsService, useLiveData, useServices } from '@toeverything/infra';\nimport { type MouseEventHandler, useCallback } from 'react';\n\nimport { ExplorerService } from '../../../services/explorer';\nimport { CollapsibleSection } from '../../layouts/collapsible-section';\nimport { ExplorerCollectionNode } from '../../nodes/collection';\nimport { ExplorerDocNode } from '../../nodes/doc';\nimport { ExplorerFolderNode } from '../../nodes/folder';\nimport { ExplorerTagNode } from '../../nodes/tag';\nimport {\n  favoriteChildrenCanDrop,\n  favoriteChildrenDropEffect,\n  favoriteRootCanDrop,\n  favoriteRootDropEffect,\n} from './dnd';\nimport { RootEmpty } from './empty';\n\nexport const ExplorerFavorites = () => {\n  const { favoriteService, docsService, workbenchService, explorerService } =\n    useServices({\n      FavoriteService,\n      DocsService,\n      WorkbenchService,\n      ExplorerService,\n    });\n\n  const explorerSection = explorerService.sections.favorites;\n\n  const favorites = useLiveData(favoriteService.favoriteList.sortedList$);\n\n  const isLoading = useLiveData(favoriteService.favoriteList.isLoading$);\n\n  const t = useI18n();\n\n  const handleDrop = useCallback(\n    (data: DropTargetDropEvent<AffineDNDData>) => {\n      if (\n        data.source.data.entity?.type &&\n        isFavoriteSupportType(data.source.data.entity.type)\n      ) {\n        favoriteService.favoriteList.add(\n          data.source.data.entity.type,\n          data.source.data.entity.id,\n          favoriteService.favoriteList.indexAt('before')\n        );\n        track.$.navigationPanel.organize.toggleFavorite({\n          type: data.source.data.entity.type,\n          on: true,\n        });\n        explorerSection.setCollapsed(false);\n      }\n    },\n    [explorerSection, favoriteService.favoriteList]\n  );\n\n  const handleCreateNewFavoriteDoc: MouseEventHandler = useCallback(\n    e => {\n      const newDoc = docsService.createDoc();\n      favoriteService.favoriteList.add(\n        'doc',\n        newDoc.id,\n        favoriteService.favoriteList.indexAt('before')\n      );\n      workbenchService.workbench.openDoc(newDoc.id, {\n        at: isNewTabTrigger(e) ? 'new-tab' : 'active',\n      });\n      explorerSection.setCollapsed(false);\n    },\n    [\n      docsService,\n      explorerSection,\n      favoriteService.favoriteList,\n      workbenchService.workbench,\n    ]\n  );\n\n  const handleOnChildrenDrop = useCallback(\n    (\n      favorite: { id: string; type: FavoriteSupportType },\n      data: DropTargetDropEvent<AffineDNDData>\n    ) => {\n      if (\n        data.treeInstruction?.type === 'reorder-above' ||\n        data.treeInstruction?.type === 'reorder-below'\n      ) {\n        if (\n          data.source.data.from?.at === 'explorer:favorite:list' &&\n          data.source.data.entity?.type &&\n          isFavoriteSupportType(data.source.data.entity.type)\n        ) {\n          // is reordering\n          favoriteService.favoriteList.reorder(\n            data.source.data.entity.type,\n            data.source.data.entity.id,\n            favoriteService.favoriteList.indexAt(\n              data.treeInstruction?.type === 'reorder-above'\n                ? 'before'\n                : 'after',\n              favorite\n            )\n          );\n          track.$.navigationPanel.organize.orderOrganizeItem({\n            type: data.source.data.entity.type,\n          });\n        } else if (\n          data.source.data.entity?.type &&\n          isFavoriteSupportType(data.source.data.entity.type)\n        ) {\n          favoriteService.favoriteList.add(\n            data.source.data.entity.type,\n            data.source.data.entity.id,\n            favoriteService.favoriteList.indexAt(\n              data.treeInstruction?.type === 'reorder-above'\n                ? 'before'\n                : 'after',\n              favorite\n            )\n          );\n          track.$.navigationPanel.organize.toggleFavorite({\n            type: data.source.data.entity.type,\n            on: true,\n          });\n        } else {\n          return; // not supported\n        }\n      }\n    },\n    [favoriteService]\n  );\n\n  const { dropTargetRef, draggedOverDraggable, draggedOverPosition } =\n    useDropTarget<AffineDNDData>(\n      () => ({\n        data: {\n          at: 'explorer:favorite:root',\n        },\n        onDrop: handleDrop,\n        canDrop: favoriteRootCanDrop,\n      }),\n      [handleDrop]\n    );\n\n  return (\n    <CollapsibleSection\n      name=\"favorites\"\n      title={t['com.affine.rootAppSidebar.favorites']()}\n      headerRef={dropTargetRef}\n      testId=\"explorer-favorites\"\n      headerTestId=\"explorer-favorite-category-divider\"\n      actions={\n        <>\n          <IconButton\n            data-testid=\"explorer-bar-add-favorite-button\"\n            data-event-props=\"$.navigationPanel.favorites.createDoc\"\n            data-event-args-control=\"addFavorite\"\n            onClick={handleCreateNewFavoriteDoc}\n            onAuxClick={handleCreateNewFavoriteDoc}\n            size=\"16\"\n            tooltip={t[\n              'com.affine.rootAppSidebar.explorer.fav-section-add-tooltip'\n            ]()}\n          >\n            <PlusIcon />\n          </IconButton>\n          {draggedOverDraggable && (\n            <DropEffect\n              position={draggedOverPosition}\n              dropEffect={favoriteRootDropEffect({\n                source: draggedOverDraggable,\n                treeInstruction: null,\n              })}\n            />\n          )}\n        </>\n      }\n    >\n      <ExplorerTreeRoot\n        placeholder={<RootEmpty onDrop={handleDrop} isLoading={isLoading} />}\n      >\n        {favorites.map(favorite => (\n          <ExplorerFavoriteNode\n            key={favorite.id}\n            favorite={favorite}\n            onDrop={handleOnChildrenDrop}\n          />\n        ))}\n      </ExplorerTreeRoot>\n    </CollapsibleSection>\n  );\n};\n\nconst childLocation = {\n  at: 'explorer:favorite:list' as const,\n};\nconst ExplorerFavoriteNode = ({\n  favorite,\n  onDrop,\n}: {\n  favorite: {\n    id: string;\n    type: FavoriteSupportType;\n  };\n  onDrop: (\n    favorite: {\n      id: string;\n      type: FavoriteSupportType;\n    },\n    data: DropTargetDropEvent<AffineDNDData>\n  ) => void;\n}) => {\n  const handleOnChildrenDrop = useCallback(\n    (data: DropTargetDropEvent<AffineDNDData>) => {\n      onDrop(favorite, data);\n    },\n    [favorite, onDrop]\n  );\n  return favorite.type === 'doc' ? (\n    <ExplorerDocNode\n      key={favorite.id}\n      docId={favorite.id}\n      location={childLocation}\n      onDrop={handleOnChildrenDrop}\n      dropEffect={favoriteChildrenDropEffect}\n      canDrop={favoriteChildrenCanDrop}\n    />\n  ) : favorite.type === 'tag' ? (\n    <ExplorerTagNode\n      key={favorite.id}\n      tagId={favorite.id}\n      location={childLocation}\n      onDrop={handleOnChildrenDrop}\n      dropEffect={favoriteChildrenDropEffect}\n      canDrop={favoriteChildrenCanDrop}\n    />\n  ) : favorite.type === 'folder' ? (\n    <ExplorerFolderNode\n      key={favorite.id}\n      nodeId={favorite.id}\n      location={childLocation}\n      onDrop={handleOnChildrenDrop}\n      dropEffect={favoriteChildrenDropEffect}\n      canDrop={favoriteChildrenCanDrop}\n    />\n  ) : (\n    <ExplorerCollectionNode\n      key={favorite.id}\n      collectionId={favorite.id}\n      location={childLocation}\n      onDrop={handleOnChildrenDrop}\n      dropEffect={favoriteChildrenDropEffect}\n      canDrop={favoriteChildrenCanDrop}\n    />\n  );\n};\n","import \"../core/src/modules/explorer/views/sections/migration-favorites/styles.css.ts.vanilla.css!=!../../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/modules/explorer/views/sections/migration-favorites/styles.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xOGtjcWVsMCB7CiAgcG9zaXRpb246IHJlbGF0aXZlOwp9Ci5fMThrY3FlbDBbZGF0YS1jb2xsYXBzZWQ9ImZhbHNlIl06YWZ0ZXIgewogIGNvbnRlbnQ6ICIiOwogIGRpc3BsYXk6IGJsb2NrOwogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICBsZWZ0OiAtOHB4OwogIHRvcDogMDsKICB3aWR0aDogNnB4OwogIGhlaWdodDogMTAwJTsKICBiYWNrZ3JvdW5kOiByZXBlYXRpbmctbGluZWFyLWdyYWRpZW50KDMwZGVnLCAjRjVDQzQ3LCAjRjVDQzQ3IDhweCwgIzAwMDAwMCA4cHgsICMwMDAwMDAgMTRweCk7Cn0KLl8xOGtjcWVsMSB7CiAgZm9udC13ZWlnaHQ6IGJvbGQ7Cn0=\\\"}!../../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var container = '_18kcqel0';\nexport var descriptionHighlight = '_18kcqel1';","import { IconButton, useConfirmModal } from '@affine/component';\nimport { track } from '@affine/core/mixpanel';\nimport { ExplorerTreeRoot } from '@affine/core/modules/explorer/views/tree';\nimport { MigrationFavoriteItemsAdapter } from '@affine/core/modules/properties';\nimport { Trans, useI18n } from '@affine/i18n';\nimport { BroomIcon, HelpIcon } from '@blocksuite/icons/rc';\nimport { DocsService, useLiveData, useServices } from '@toeverything/infra';\nimport { useCallback } from 'react';\n\nimport { CollapsibleSection } from '../../layouts/collapsible-section';\nimport { ExplorerCollectionNode } from '../../nodes/collection';\nimport { ExplorerDocNode } from '../../nodes/doc';\nimport * as styles from './styles.css';\n\nexport const ExplorerMigrationFavorites = () => {\n  const t = useI18n();\n\n  const { migrationFavoriteItemsAdapter, docsService } = useServices({\n    MigrationFavoriteItemsAdapter,\n    DocsService,\n  });\n\n  const docs = useLiveData(docsService.list.docs$);\n  const trashDocs = useLiveData(docsService.list.trashDocs$);\n  const migrated = useLiveData(migrationFavoriteItemsAdapter.migrated$);\n  const { openConfirmModal } = useConfirmModal();\n\n  const favorites = useLiveData(\n    migrationFavoriteItemsAdapter.favorites$.map(favs => {\n      return favs.filter(fav => {\n        if (fav.type === 'doc') {\n          return (\n            docs.some(doc => doc.id === fav.id) &&\n            !trashDocs.some(doc => doc.id === fav.id)\n          );\n        }\n        return true;\n      });\n    })\n  );\n\n  const handleClickClear = useCallback(() => {\n    openConfirmModal({\n      title: t['com.affine.rootAppSidebar.migration-data.clean-all'](),\n      description: (\n        <Trans\n          i18nKey=\"com.affine.rootAppSidebar.migration-data.clean-all.description\"\n          components={{\n            b: <b className={styles.descriptionHighlight} />,\n          }}\n        />\n      ),\n      confirmText:\n        t['com.affine.rootAppSidebar.migration-data.clean-all.confirm'](),\n      confirmButtonOptions: {\n        variant: 'primary',\n      },\n      cancelText:\n        t['com.affine.rootAppSidebar.migration-data.clean-all.cancel'](),\n      onConfirm() {\n        migrationFavoriteItemsAdapter.markFavoritesMigrated();\n      },\n    });\n  }, [migrationFavoriteItemsAdapter, openConfirmModal, t]);\n\n  const handleClickHelp = useCallback(() => {\n    openConfirmModal({\n      title: t['com.affine.rootAppSidebar.migration-data.help'](),\n      description: (\n        <Trans\n          i18nKey=\"com.affine.rootAppSidebar.migration-data.help.description\"\n          components={{\n            b: <b className={styles.descriptionHighlight} />,\n          }}\n        />\n      ),\n      confirmText: t['com.affine.rootAppSidebar.migration-data.help.confirm'](),\n      confirmButtonOptions: {\n        variant: 'primary',\n      },\n      cancelText:\n        t['com.affine.rootAppSidebar.migration-data.help.clean-all'](),\n      cancelButtonOptions: {\n        prefix: <BroomIcon />,\n        onClick: () => {\n          requestAnimationFrame(() => {\n            handleClickClear();\n          });\n        },\n      },\n    });\n    track.$.navigationPanel.migrationData.openMigrationDataHelp();\n  }, [handleClickClear, openConfirmModal, t]);\n\n  if (favorites.length === 0 || migrated) {\n    return null;\n  }\n\n  return (\n    <CollapsibleSection\n      name=\"migrationFavorites\"\n      className={styles.container}\n      title={t['com.affine.rootAppSidebar.migration-data']()}\n      actions={\n        <>\n          <IconButton\n            data-testid=\"explorer-bar-favorite-migration-clear-button\"\n            onClick={handleClickClear}\n            size=\"16\"\n          >\n            <BroomIcon />\n          </IconButton>\n          <IconButton\n            data-testid=\"explorer-bar-favorite-migration-help-button\"\n            size=\"16\"\n            onClick={handleClickHelp}\n          >\n            <HelpIcon />\n          </IconButton>\n        </>\n      }\n    >\n      <ExplorerTreeRoot>\n        {favorites.map((favorite, i) => (\n          <ExplorerMigrationFavoriteNode\n            key={favorite.id + ':' + i}\n            favorite={favorite}\n          />\n        ))}\n      </ExplorerTreeRoot>\n    </CollapsibleSection>\n  );\n};\n\nconst childLocation = {\n  at: 'explorer:migration-data:list' as const,\n};\nconst ExplorerMigrationFavoriteNode = ({\n  favorite,\n}: {\n  favorite: {\n    id: string;\n    type: 'collection' | 'doc';\n  };\n}) => {\n  return favorite.type === 'doc' ? (\n    <ExplorerDocNode\n      key={favorite.id}\n      docId={favorite.id}\n      location={childLocation}\n      reorderable={false}\n      canDrop={false}\n    />\n  ) : (\n    <ExplorerCollectionNode\n      key={favorite.id}\n      collectionId={favorite.id}\n      location={childLocation}\n      reorderable={false}\n      canDrop={false}\n    />\n  );\n};\n","export const OrganizeSupportType = [\n  'folder',\n  'doc',\n  'collection',\n  'tag',\n] as const;\nexport type OrganizeSupportType = 'folder' | 'doc' | 'collection' | 'tag';\n\nexport const isOrganizeSupportType = (\n  type: string\n): type is OrganizeSupportType =>\n  OrganizeSupportType.includes(type as OrganizeSupportType);\n","import type { DropTargetOptions } from '@affine/component';\nimport { isOrganizeSupportType } from '@affine/core/modules/organize/constants';\nimport type { AffineDNDData } from '@affine/core/types/dnd';\n\nimport type { ExplorerTreeNodeDropEffect } from '../../tree';\n\nexport const organizeChildrenDropEffect: ExplorerTreeNodeDropEffect = data => {\n  if (\n    data.treeInstruction?.type === 'reorder-above' ||\n    data.treeInstruction?.type === 'reorder-below'\n  ) {\n    if (data.source.data.entity?.type === 'folder') {\n      return 'move';\n    }\n  } else {\n    return; // not supported\n  }\n  return;\n};\n\nexport const organizeEmptyDropEffect: ExplorerTreeNodeDropEffect = data => {\n  const sourceType = data.source.data.entity?.type;\n  if (sourceType && isOrganizeSupportType(sourceType)) {\n    return 'link';\n  }\n  return;\n};\n\n/**\n * Check whether the data can be dropped on the empty state of the organize section\n */\nexport const organizeEmptyRootCanDrop: DropTargetOptions<AffineDNDData>['canDrop'] =\n  data => {\n    const type = data.source.data.entity?.type;\n    return !!type && isOrganizeSupportType(type);\n  };\n","import {\n  AnimatedFolderIcon,\n  type DropTargetDropEvent,\n  Skeleton,\n  useDropTarget,\n} from '@affine/component';\nimport type { AffineDNDData } from '@affine/core/types/dnd';\nimport { useI18n } from '@affine/i18n';\n\nimport { ExplorerEmptySection } from '../../layouts/empty-section';\nimport { DropEffect } from '../../tree';\nimport { organizeEmptyDropEffect, organizeEmptyRootCanDrop } from './dnd';\n\ninterface RootEmptyProps {\n  onClickCreate?: () => void;\n  isLoading?: boolean;\n  onDrop?: (data: DropTargetDropEvent<AffineDNDData>) => void;\n}\n\nexport const RootEmptyLoading = () => {\n  return <Skeleton />;\n};\n\nexport const RootEmptyReady = ({\n  onClickCreate,\n  onDrop,\n}: Omit<RootEmptyProps, 'isLoading'>) => {\n  const t = useI18n();\n\n  const { dropTargetRef, draggedOverDraggable, draggedOverPosition } =\n    useDropTarget<AffineDNDData>(\n      () => ({\n        data: { at: 'explorer:organize:root' },\n        onDrop,\n        canDrop: organizeEmptyRootCanDrop,\n      }),\n      [onDrop]\n    );\n\n  return (\n    <ExplorerEmptySection\n      ref={dropTargetRef}\n      icon={<AnimatedFolderIcon open={!!draggedOverDraggable} />}\n      message={t['com.affine.rootAppSidebar.organize.empty']()}\n      messageTestId=\"slider-bar-organize-empty-message\"\n      actionText={t[\n        'com.affine.rootAppSidebar.organize.empty.new-folders-button'\n      ]()}\n      onActionClick={onClickCreate}\n    >\n      {draggedOverDraggable && (\n        <DropEffect\n          position={draggedOverPosition}\n          dropEffect={organizeEmptyDropEffect({\n            source: draggedOverDraggable,\n            treeInstruction: null,\n          })}\n        />\n      )}\n    </ExplorerEmptySection>\n  );\n};\n\nexport const RootEmpty = ({ isLoading, ...props }: RootEmptyProps) => {\n  return isLoading ? <RootEmptyLoading /> : <RootEmptyReady {...props} />;\n};\n","import {\n  type DropTargetDropEvent,\n  type DropTargetOptions,\n  IconButton,\n  toast,\n} from '@affine/component';\nimport { track } from '@affine/core/mixpanel';\nimport { ExplorerTreeRoot } from '@affine/core/modules/explorer/views/tree';\nimport {\n  type FolderNode,\n  OrganizeService,\n} from '@affine/core/modules/organize';\nimport type { AffineDNDData } from '@affine/core/types/dnd';\nimport { useI18n } from '@affine/i18n';\nimport { PlusIcon } from '@blocksuite/icons/rc';\nimport { useLiveData, useServices } from '@toeverything/infra';\nimport { useCallback, useEffect, useMemo, useState } from 'react';\n\nimport { ExplorerService } from '../../../services/explorer';\nimport { CollapsibleSection } from '../../layouts/collapsible-section';\nimport { ExplorerFolderNode } from '../../nodes/folder';\nimport { organizeChildrenDropEffect } from './dnd';\nimport { RootEmpty } from './empty';\n\nexport const ExplorerOrganize = () => {\n  const { organizeService, explorerService } = useServices({\n    OrganizeService,\n    ExplorerService,\n  });\n  const explorerSection = explorerService.sections.organize;\n  const collapsed = useLiveData(explorerSection.collapsed$);\n  const [newFolderId, setNewFolderId] = useState<string | null>(null);\n\n  const t = useI18n();\n\n  const folderTree = organizeService.folderTree;\n  const rootFolder = folderTree.rootFolder;\n\n  const folders = useLiveData(rootFolder.sortedChildren$);\n  const isLoading = useLiveData(folderTree.isLoading$);\n\n  const handleCreateFolder = useCallback(() => {\n    const newFolderId = rootFolder.createFolder(\n      'New Folder',\n      rootFolder.indexAt('before')\n    );\n    track.$.navigationPanel.organize.createOrganizeItem({ type: 'folder' });\n    setNewFolderId(newFolderId);\n    explorerSection.setCollapsed(false);\n    return newFolderId;\n  }, [explorerSection, rootFolder]);\n\n  const handleOnChildrenDrop = useCallback(\n    (data: DropTargetDropEvent<AffineDNDData>, node?: FolderNode) => {\n      if (!node || !node.id) {\n        return; // never happens\n      }\n      if (\n        data.treeInstruction?.type === 'reorder-above' ||\n        data.treeInstruction?.type === 'reorder-below'\n      ) {\n        const at =\n          data.treeInstruction?.type === 'reorder-below' ? 'after' : 'before';\n        if (data.source.data.entity?.type === 'folder') {\n          rootFolder.moveHere(\n            data.source.data.entity.id,\n            rootFolder.indexAt(at, node.id)\n          );\n          track.$.navigationPanel.organize.moveOrganizeItem({ type: 'folder' });\n        } else {\n          toast(t['com.affine.rootAppSidebar.organize.root-folder-only']());\n        }\n      } else {\n        return; // not supported\n      }\n    },\n    [rootFolder, t]\n  );\n\n  const createFolderAndDrop = useCallback(\n    (data: DropTargetDropEvent<AffineDNDData>) => {\n      const newFolderId = handleCreateFolder();\n      setNewFolderId(null);\n      const newFolder$ = folderTree.folderNode$(newFolderId);\n\n      const entity = data.source.data.entity;\n      if (!entity) return;\n      const { type, id } = entity;\n      if (type === 'folder') return;\n\n      const folder = newFolder$.value;\n      if (!folder) return;\n      folder.createLink(type, id, folder.indexAt('after'));\n    },\n    [folderTree, handleCreateFolder]\n  );\n\n  const handleChildrenCanDrop = useMemo<\n    DropTargetOptions<AffineDNDData>['canDrop']\n  >(() => args => args.source.data.entity?.type === 'folder', []);\n\n  useEffect(() => {\n    if (collapsed) setNewFolderId(null); // reset new folder id to clear the renaming state\n  }, [collapsed]);\n\n  return (\n    <CollapsibleSection\n      name=\"organize\"\n      title={t['com.affine.rootAppSidebar.organize']()}\n      actions={\n        <IconButton\n          data-testid=\"explorer-bar-add-organize-button\"\n          onClick={handleCreateFolder}\n          size=\"16\"\n          tooltip={t[\n            'com.affine.rootAppSidebar.explorer.organize-section-add-tooltip'\n          ]()}\n        >\n          <PlusIcon />\n        </IconButton>\n      }\n    >\n      <ExplorerTreeRoot\n        placeholder={\n          <RootEmpty\n            onClickCreate={handleCreateFolder}\n            isLoading={isLoading}\n            onDrop={createFolderAndDrop}\n          />\n        }\n      >\n        {folders.map(child => (\n          <ExplorerFolderNode\n            key={child.id}\n            nodeId={child.id as string}\n            defaultRenaming={child.id === newFolderId}\n            onDrop={handleOnChildrenDrop}\n            dropEffect={organizeChildrenDropEffect}\n            canDrop={handleChildrenCanDrop}\n            location={{\n              at: 'explorer:organize:folder-node',\n              nodeId: child.id as string,\n            }}\n          />\n        ))}\n      </ExplorerTreeRoot>\n    </CollapsibleSection>\n  );\n};\n","import {\n  type Framework,\n  GlobalCache,\n  WorkspaceScope,\n} from '@toeverything/infra';\n\nimport { ExplorerSection } from './entities/explore-section';\nimport { ExplorerService } from './services/explorer';\nexport { ExplorerService } from './services/explorer';\nexport type { CollapsibleSectionName } from './types';\nexport { ExplorerCollections } from './views/sections/collections';\nexport { ExplorerFavorites } from './views/sections/favorites';\nexport { ExplorerMigrationFavorites } from './views/sections/migration-favorites';\nexport { ExplorerOrganize } from './views/sections/organize';\n\nexport function configureExplorerModule(framework: Framework) {\n  framework\n    .scope(WorkspaceScope)\n    .service(ExplorerService)\n    .entity(ExplorerSection, [GlobalCache]);\n}\n","import { Service } from '@toeverything/infra';\n\nimport { ExplorerSection } from '../entities/explore-section';\nimport type { CollapsibleSectionName } from '../types';\n\nconst allSectionName: Array<CollapsibleSectionName> = [\n  'favorites',\n  'organize',\n  'collections',\n  'tags',\n  'favoritesOld',\n  'migrationFavorites',\n];\n\nexport class ExplorerService extends Service {\n  readonly sections = allSectionName.reduce(\n    (prev, name) =>\n      Object.assign(prev, {\n        [name]: this.framework.createEntity(ExplorerSection, { name }),\n      }),\n    {} as Record<CollapsibleSectionName, ExplorerSection>\n  );\n}\n","import { CategoryDivider } from '@affine/core/components/app-sidebar';\nimport * as Collapsible from '@radix-ui/react-collapsible';\nimport { useLiveData, useService } from '@toeverything/infra';\nimport clsx from 'clsx';\nimport {\n  type PropsWithChildren,\n  type ReactNode,\n  type RefObject,\n  useCallback,\n} from 'react';\n\nimport { ExplorerService } from '../../services/explorer';\nimport type { CollapsibleSectionName } from '../../types';\nimport { content, header, root } from './collapsible-section.css';\n\ninterface CollapsibleSectionProps extends PropsWithChildren {\n  name: CollapsibleSectionName;\n  title: string;\n  actions?: ReactNode;\n\n  className?: string;\n  testId?: string;\n\n  headerRef?: RefObject<HTMLDivElement>;\n  headerTestId?: string;\n  headerClassName?: string;\n\n  contentClassName?: string;\n}\n\nexport const CollapsibleSection = ({\n  name,\n  title,\n  actions,\n  children,\n\n  className,\n  testId,\n\n  headerRef,\n  headerTestId,\n  headerClassName,\n\n  contentClassName,\n}: CollapsibleSectionProps) => {\n  const section = useService(ExplorerService).sections[name];\n\n  const collapsed = useLiveData(section.collapsed$);\n\n  const setCollapsed = useCallback(\n    (v: boolean) => {\n      section.setCollapsed(v);\n    },\n    [section]\n  );\n\n  return (\n    <Collapsible.Root\n      data-collapsed={collapsed}\n      className={clsx(root, className)}\n      open={!collapsed}\n      data-testid={testId}\n    >\n      <CategoryDivider\n        data-testid={headerTestId}\n        label={title}\n        setCollapsed={setCollapsed}\n        collapsed={collapsed}\n        ref={headerRef}\n        className={clsx(header, headerClassName)}\n      >\n        {actions}\n      </CategoryDivider>\n      <Collapsible.Content className={clsx(content, contentClassName)}>\n        {children}\n      </Collapsible.Content>\n    </Collapsible.Root>\n  );\n};\n","import \"../core/src/modules/explorer/views/layouts/collapsible-section.css.ts.vanilla.css!=!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/modules/explorer/views/layouts/collapsible-section.css.ts.vanilla.css\\\",\\\"source\\\":\\\"LnFhdmU3ZzEgewogIHBhZGRpbmctdG9wOiA2cHg7Cn0KLnFhdmU3ZzJbZGF0YS1kcmFnZ2VkLW92ZXI9InRydWUiXSB7CiAgYmFja2dyb3VuZDogdmFyKC0tYWZmaW5lLWxheWVyLWJhY2tncm91bmQtaG92ZXJPdmVybGF5KTsKfQ==\\\"}!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var content = 'qave7g1';\nexport var header = 'qave7g2';\nexport var root = 'qave7g0';","import clsx from 'clsx';\nimport { forwardRef, type HTMLAttributes, type Ref } from 'react';\n\nimport { emptyChildren } from './empty-node-children.css';\n\nexport const EmptyNodeChildren = forwardRef(function EmptyNodeChildren(\n  { children, className, ...attrs }: HTMLAttributes<HTMLDivElement>,\n  ref: Ref<HTMLDivElement>\n) {\n  return (\n    <div className={clsx(emptyChildren, className)} ref={ref} {...attrs}>\n      {children}\n    </div>\n  );\n});\n","import \"../core/src/modules/explorer/views/tree/node.css.ts.vanilla.css!=!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/modules/explorer/views/tree/node.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACq1W227bMAx9z1cIAQa0DyqctOtFRYH9x1AMjETbXGTJkOS02dB/HyzbieU6WYfuKbF41eEhqW9b3OcOKvTsx+rn/s6V+Yb9XjCWfYk/jNkaJIW9YKvHBWNvC8Zuz8ju3suyQXZ/xu7hjN0qO2n4trga0l5FFWm1dYKRKdFReBwrrKOCIl9r2LcqmgzyXONr6ws0FYZTwMoLJtEEdO3xxjqFjjtQ1HjBbuqoHPA18GghmMY8PM5EZuyFVChFTL/9rMjwEqkog2DXWeeo8ei4R40yCGasweipcb51VVsa0qhBKTKFYNmQQm5N4J5+oWA7cBecQ57H+8Tz6jJaWU+BrBHMoYZAu+i+AleQ4cHWgsU0xhiJ0u7QRaQ2ILeFs41RkxBRhcf7XqbW3xUE4CDbUE/L4BpcPn/OlyIPG40q8TYApDCHRo/RT3zHKnmU1ihw+0MQNgDLcYcm+AH4meAOioJMkQQ/8vPqa2J0HcXzvse1gI23ugnxtCVPz/RYD77qiXHgTvc58GY1LdhNl9MOXa7ti2AlKYXmwNGjALWm2pOPzksKyH0NEtsEXxzUZ1qg7ZC+4U6iXDuqwO3TEn5NG+4vnea6G/b0nocrnQ1/L2PP5klGPxsfKN+3fZd3aXE0Ko1KhgKBToKu5oKC1knM2/EYSoAiac0IqKSF19O63kU3AwtuJyzovz8K7XBhaU1AE87Mt3U/3xyYAYn4P7euYtnV2p9iweRy45t0vSSt1lD7SScfnAvmbICAF/whU1jMupidBaN2vP4QKe4+NeLu/4nT74CPZPMB3HhB3AwjPQpLR2YbGT4K+3BEa7YsDMEjJ8Ntky69h8+jD+mV3wEKwhq957IkraYrtm+ikbaMKuMd1HOuX3G8G4ldNQaj7OQ6G3lW50t6FAw8HW2EvhLrrJ+3k7a4nXQn9qP+bD7YQR8ctpXxwTWy1X5aVrDFDq7lc6fTTqJu26CKM/tpmYP2uHwWkIeerAcSLZdJ82+0ldvTM/MXJ6MOE/yDjB8201wZuofDCDUJWl7ERxp/Z3CZbq/2JfS/IerktkYzhxoYqqBD5fjAXXlGJm/piax9BYJ7XLz9AQBQy98LCwAA\\\"}!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nimport \"../core/src/modules/explorer/views/layouts/empty-node-children.css.ts.vanilla.css!=!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/modules/explorer/views/layouts/empty-node-children.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xMTEzN3JjMCB7CiAgZm9udC1zaXplOiB2YXIoLS1hZmZpbmUtZm9udC1zbSk7CiAgY29sb3I6IHZhcigtLWFmZmluZS10ZXh0LWRpc2FibGUpOwogIHRleHQtYWxpZ246IGxlZnQ7CiAgdXNlci1zZWxlY3Q6IG5vbmU7CiAgbGluZS1oZWlnaHQ6IDIycHg7CiAgcGFkZGluZzogNHB4IDBweDsKICBtYXJnaW4tdG9wOiAycHg7CiAgcGFkZGluZy1sZWZ0OiBjYWxjKHZhcigtLV8xank3cmhmMCwgMjBweCkgKyA0OHB4KTsKfQouXzExMTM3cmMwW2RhdGEtZHJhZ2dlZC1vdmVyPSJ0cnVlIl0gewogIGJhY2tncm91bmQ6IHZhcigtLWFmZmluZS1sYXllci1iYWNrZ3JvdW5kLWhvdmVyT3ZlcmxheSk7CiAgYm9yZGVyLXJhZGl1czogNHB4Owp9\\\"}!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var emptyChildren = '_11137rc0';","import \"../core/src/modules/explorer/views/layouts/empty-section.css.ts.vanilla.css!=!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/modules/explorer/views/layouts/empty-section.css.ts.vanilla.css\\\",\\\"source\\\":\\\"LnB5YWtoODAgewogIHBvc2l0aW9uOiByZWxhdGl2ZTsKICBkaXNwbGF5OiBmbGV4OwogIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBnYXA6IDRweDsKICBwYWRkaW5nOiAxMnB4IDBweDsKICBib3JkZXItcmFkaXVzOiA4cHg7Cn0KLnB5YWtoODBbZGF0YS1kcmFnZ2VkLW92ZXI9InRydWUiXSB7CiAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tYWZmaW5lLWxheWVyLWJhY2tncm91bmQtaG92ZXJPdmVybGF5KTsKfQoucHlha2g4MSB7CiAgd2lkdGg6IDM2cHg7CiAgaGVpZ2h0OiAzNnB4OwogIGRpc3BsYXk6IGZsZXg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICBib3JkZXItcmFkaXVzOiA1MCU7CiAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tYWZmaW5lLWJ1dHRvbi1lbXB0eUljb25CYWNrZ3JvdW5kKTsKfQoucHlha2g4MiB7CiAgZm9udC1zaXplOiAyMHB4OwogIGNvbG9yOiB2YXIoLS1hZmZpbmUtaWNvbi1zZWNvbmRhcnkpOwp9Ci5weWFraDgzIHsKICBmb250LXNpemU6IHZhcigtLWFmZmluZS1mb250LXNtKTsKICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgY29sb3I6IHZhcigtLWFmZmluZS10ZXh0LXRlcnRpYXJ5KTsKICB1c2VyLXNlbGVjdDogbm9uZTsKICBmb250LXdlaWdodDogNDAwOwogIGxpbmUtaGVpZ2h0OiAyMnB4Owp9Ci5weWFraDg0IHsKICBtYXJnaW4tdG9wOiA4cHg7CiAgcGFkZGluZzogNHB4IDhweDsKICBoZWlnaHQ6IDMwcHg7CiAgZm9udC1zaXplOiB2YXIoLS1hZmZpbmUtZm9udC1zbSk7Cn0=\\\"}!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var content = 'pyakh80';\nexport var icon = 'pyakh82';\nexport var iconWrapper = 'pyakh81';\nexport var message = 'pyakh83';\nexport var newButton = 'pyakh84';","import { Button } from '@affine/component';\nimport clsx from 'clsx';\nimport {\n  cloneElement,\n  forwardRef,\n  type HTMLAttributes,\n  type ReactElement,\n  type Ref,\n  type SVGProps,\n} from 'react';\n\nimport * as styles from './empty-section.css';\n\ninterface ExplorerEmptySectionProps extends HTMLAttributes<HTMLDivElement> {\n  icon: ((props: SVGProps<SVGSVGElement>) => JSX.Element) | ReactElement;\n  message: string;\n  messageTestId?: string;\n  actionText?: string;\n  onActionClick?: () => void;\n}\n\nexport const ExplorerEmptySection = forwardRef(function ExplorerEmptySection(\n  {\n    icon: Icon,\n    message,\n    messageTestId,\n    actionText,\n    children,\n    className,\n    onActionClick,\n    ...attrs\n  }: ExplorerEmptySectionProps,\n  ref: Ref<HTMLDivElement>\n) {\n  const icon =\n    typeof Icon === 'function' ? (\n      <Icon className={styles.icon} />\n    ) : (\n      cloneElement(Icon, { className: styles.icon })\n    );\n\n  return (\n    <div className={clsx(styles.content, className)} ref={ref} {...attrs}>\n      <div className={styles.iconWrapper}>{icon}</div>\n      <div data-testid={messageTestId} className={styles.message}>\n        {message}\n      </div>\n      {actionText ? (\n        <Button className={styles.newButton} onClick={onActionClick}>\n          {actionText}\n        </Button>\n      ) : null}\n      {children}\n    </div>\n  );\n});\n","import { type DropTargetDropEvent, useDropTarget } from '@affine/component';\nimport type { AffineDNDData } from '@affine/core/types/dnd';\nimport { useI18n } from '@affine/i18n';\n\nimport { EmptyNodeChildren } from '../../layouts/empty-node-children';\n\nexport const Empty = ({\n  onDrop,\n}: {\n  onDrop: (data: DropTargetDropEvent<AffineDNDData>) => void;\n}) => {\n  const { dropTargetRef } = useDropTarget<AffineDNDData>(\n    () => ({\n      onDrop,\n    }),\n    [onDrop]\n  );\n  const t = useI18n();\n\n  return (\n    <EmptyNodeChildren ref={dropTargetRef}>\n      {t['com.affine.rootAppSidebar.docs.no-subdoc']()}\n    </EmptyNodeChildren>\n  );\n};\n","import {\n  IconButton,\n  MenuIcon,\n  MenuItem,\n  MenuSeparator,\n  toast,\n  useConfirmModal,\n} from '@affine/component';\nimport { useAppSettingHelper } from '@affine/core/hooks/affine/use-app-setting-helper';\nimport { useAsyncCallback } from '@affine/core/hooks/affine-async-hooks';\nimport { track } from '@affine/core/mixpanel';\nimport { CompatibleFavoriteItemsAdapter } from '@affine/core/modules/properties';\nimport { WorkbenchService } from '@affine/core/modules/workbench';\nimport { useI18n } from '@affine/i18n';\nimport {\n  DeleteIcon,\n  FavoritedIcon,\n  FavoriteIcon,\n  InformationIcon,\n  LinkedPageIcon,\n  OpenInNewIcon,\n  PlusIcon,\n  SplitViewIcon,\n} from '@blocksuite/icons/rc';\nimport { DocsService, useLiveData, useServices } from '@toeverything/infra';\nimport { useCallback, useMemo } from 'react';\n\nimport type { NodeOperation } from '../../tree/types';\n\nexport const useExplorerDocNodeOperations = (\n  docId: string,\n  options: {\n    openInfoModal: () => void;\n    openNodeCollapsed: () => void;\n  }\n): NodeOperation[] => {\n  const t = useI18n();\n  const { appSettings } = useAppSettingHelper();\n  const { workbenchService, docsService, compatibleFavoriteItemsAdapter } =\n    useServices({\n      DocsService,\n      WorkbenchService,\n      CompatibleFavoriteItemsAdapter,\n    });\n  const { openConfirmModal } = useConfirmModal();\n\n  const docRecord = useLiveData(docsService.list.doc$(docId));\n\n  const favorite = useLiveData(\n    useMemo(() => {\n      return compatibleFavoriteItemsAdapter.isFavorite$(docId, 'doc');\n    }, [docId, compatibleFavoriteItemsAdapter])\n  );\n\n  const handleOpenInfoModal = useCallback(() => {\n    track.$.docInfoPanel.$.open();\n    options.openInfoModal();\n  }, [options]);\n\n  const handleMoveToTrash = useCallback(() => {\n    if (!docRecord) {\n      return;\n    }\n    openConfirmModal({\n      title: t['com.affine.moveToTrash.title'](),\n      description: t['com.affine.moveToTrash.confirmModal.description']({\n        title: docRecord.title$.value,\n      }),\n      confirmText: t['com.affine.moveToTrash.confirmModal.confirm'](),\n      cancelText: t['com.affine.moveToTrash.confirmModal.cancel'](),\n      confirmButtonOptions: {\n        variant: 'error',\n      },\n      onConfirm() {\n        docRecord.moveToTrash();\n        track.$.navigationPanel.docs.deleteDoc({\n          control: 'button',\n        });\n        toast(t['com.affine.toastMessage.movedTrash']());\n      },\n    });\n  }, [docRecord, openConfirmModal, t]);\n\n  const handleOpenInNewTab = useCallback(() => {\n    workbenchService.workbench.openDoc(docId, {\n      at: 'new-tab',\n    });\n    track.$.navigationPanel.organize.openInNewTab({\n      type: 'doc',\n    });\n  }, [docId, workbenchService]);\n\n  const handleOpenInSplitView = useCallback(() => {\n    workbenchService.workbench.openDoc(docId, {\n      at: 'beside',\n    });\n    track.$.navigationPanel.organize.openInSplitView({\n      type: 'doc',\n    });\n  }, [docId, workbenchService.workbench]);\n\n  const handleAddLinkedPage = useAsyncCallback(async () => {\n    const newDoc = docsService.createDoc();\n    // TODO: handle timeout & error\n    await docsService.addLinkedDoc(docId, newDoc.id);\n    track.$.navigationPanel.docs.createDoc({ control: 'linkDoc' });\n    track.$.navigationPanel.docs.linkDoc({ control: 'createDoc' });\n    workbenchService.workbench.openDoc(newDoc.id);\n    options.openNodeCollapsed();\n  }, [docsService, docId, workbenchService.workbench, options]);\n\n  const handleToggleFavoriteDoc = useCallback(() => {\n    compatibleFavoriteItemsAdapter.toggle(docId, 'doc');\n    track.$.navigationPanel.organize.toggleFavorite({\n      type: 'doc',\n    });\n  }, [docId, compatibleFavoriteItemsAdapter]);\n\n  return useMemo(\n    () => [\n      {\n        index: 0,\n        inline: true,\n        view: (\n          <IconButton\n            size=\"16\"\n            icon={<PlusIcon />}\n            tooltip={t['com.affine.rootAppSidebar.explorer.doc-add-tooltip']()}\n            onClick={handleAddLinkedPage}\n          />\n        ),\n      },\n      ...(runtimeConfig.enableInfoModal\n        ? [\n            {\n              index: 50,\n              view: (\n                <MenuItem\n                  preFix={\n                    <MenuIcon>\n                      <InformationIcon />\n                    </MenuIcon>\n                  }\n                  onClick={handleOpenInfoModal}\n                >\n                  {t['com.affine.page-properties.page-info.view']()}\n                </MenuItem>\n              ),\n            },\n          ]\n        : []),\n      {\n        index: 99,\n        view: (\n          <MenuItem\n            preFix={\n              <MenuIcon>\n                <LinkedPageIcon />\n              </MenuIcon>\n            }\n            onClick={handleAddLinkedPage}\n          >\n            {t['com.affine.page-operation.add-linked-page']()}\n          </MenuItem>\n        ),\n      },\n      {\n        index: 99,\n        view: (\n          <MenuItem\n            preFix={\n              <MenuIcon>\n                <OpenInNewIcon />\n              </MenuIcon>\n            }\n            onClick={handleOpenInNewTab}\n          >\n            {t['com.affine.workbench.tab.page-menu-open']()}\n          </MenuItem>\n        ),\n      },\n      ...(appSettings.enableMultiView\n        ? [\n            {\n              index: 100,\n              view: (\n                <MenuItem\n                  preFix={\n                    <MenuIcon>\n                      <SplitViewIcon />\n                    </MenuIcon>\n                  }\n                  onClick={handleOpenInSplitView}\n                >\n                  {t['com.affine.workbench.split-view.page-menu-open']()}\n                </MenuItem>\n              ),\n            },\n          ]\n        : []),\n      {\n        index: 199,\n        view: (\n          <MenuItem\n            preFix={\n              <MenuIcon>\n                {favorite ? (\n                  <FavoritedIcon\n                    style={{ color: 'var(--affine-primary-color)' }}\n                  />\n                ) : (\n                  <FavoriteIcon />\n                )}\n              </MenuIcon>\n            }\n            onClick={handleToggleFavoriteDoc}\n          >\n            {favorite\n              ? t['com.affine.favoritePageOperation.remove']()\n              : t['com.affine.favoritePageOperation.add']()}\n          </MenuItem>\n        ),\n      },\n      {\n        index: 9999,\n        view: <MenuSeparator key=\"menu-separator\" />,\n      },\n      {\n        index: 10000,\n        view: (\n          <MenuItem\n            type={'danger'}\n            preFix={\n              <MenuIcon>\n                <DeleteIcon />\n              </MenuIcon>\n            }\n            onClick={handleMoveToTrash}\n          >\n            {t['com.affine.moveToTrash.title']()}\n          </MenuItem>\n        ),\n      },\n    ],\n    [\n      appSettings.enableMultiView,\n      favorite,\n      handleAddLinkedPage,\n      handleMoveToTrash,\n      handleOpenInNewTab,\n      handleOpenInSplitView,\n      handleOpenInfoModal,\n      handleToggleFavoriteDoc,\n      t,\n    ]\n  );\n};\n","import {\n  type DropTargetDropEvent,\n  type DropTargetOptions,\n  Loading,\n  toast,\n  Tooltip,\n} from '@affine/component';\nimport { InfoModal } from '@affine/core/components/affine/page-properties';\nimport { useAsyncCallback } from '@affine/core/hooks/affine-async-hooks';\nimport { track } from '@affine/core/mixpanel';\nimport { DocsSearchService } from '@affine/core/modules/docs-search';\nimport type { AffineDNDData } from '@affine/core/types/dnd';\nimport { useI18n } from '@affine/i18n';\nimport {\n  EdgelessIcon,\n  LinkedEdgelessIcon,\n  LinkedPageIcon,\n  PageIcon,\n} from '@blocksuite/icons/rc';\nimport {\n  DocsService,\n  GlobalContextService,\n  LiveData,\n  useLiveData,\n  useServices,\n} from '@toeverything/infra';\nimport { useCallback, useLayoutEffect, useMemo, useState } from 'react';\n\nimport { ExplorerTreeNode, type ExplorerTreeNodeDropEffect } from '../../tree';\nimport type { GenericExplorerNode } from '../types';\nimport { Empty } from './empty';\nimport { useExplorerDocNodeOperations } from './operations';\nimport * as styles from './styles.css';\n\nexport const ExplorerDocNode = ({\n  docId,\n  onDrop,\n  location,\n  reorderable,\n  isLinked,\n  canDrop,\n  operations: additionalOperations,\n  dropEffect,\n}: {\n  docId: string;\n  isLinked?: boolean;\n} & GenericExplorerNode) => {\n  const t = useI18n();\n  const { docsSearchService, docsService, globalContextService } = useServices({\n    DocsSearchService,\n    DocsService,\n    GlobalContextService,\n  });\n  const active =\n    useLiveData(globalContextService.globalContext.docId.$) === docId;\n  const [collapsed, setCollapsed] = useState(true);\n\n  const docRecord = useLiveData(docsService.list.doc$(docId));\n  const docMode = useLiveData(docRecord?.mode$);\n  const docTitle = useLiveData(docRecord?.title$);\n  const isInTrash = useLiveData(docRecord?.trash$);\n\n  const Icon = useCallback(\n    ({ className }: { className?: string }) => {\n      return isLinked ? (\n        docMode === 'edgeless' ? (\n          <LinkedEdgelessIcon className={className} />\n        ) : (\n          <LinkedPageIcon className={className} />\n        )\n      ) : docMode === 'edgeless' ? (\n        <EdgelessIcon className={className} />\n      ) : (\n        <PageIcon className={className} />\n      );\n    },\n    [docMode, isLinked]\n  );\n\n  const children = useLiveData(\n    useMemo(\n      () => LiveData.from(docsSearchService.watchRefsFrom(docId), null),\n      [docsSearchService, docId]\n    )\n  );\n\n  const indexerLoading = useLiveData(\n    docsSearchService.indexer.status$.map(\n      v => v.remaining === undefined || v.remaining > 0\n    )\n  );\n  const [referencesLoading, setReferencesLoading] = useState(true);\n  useLayoutEffect(() => {\n    setReferencesLoading(\n      prev =>\n        prev &&\n        indexerLoading /* after loading becomes false, it never becomes true */\n    );\n  }, [indexerLoading]);\n\n  const dndData = useMemo(() => {\n    return {\n      draggable: {\n        entity: {\n          type: 'doc',\n          id: docId,\n        },\n        from: location,\n      },\n      dropTarget: {\n        at: 'explorer:doc',\n      },\n    } satisfies AffineDNDData;\n  }, [docId, location]);\n\n  const handleRename = useAsyncCallback(\n    async (newName: string) => {\n      await docsService.changeDocTitle(docId, newName);\n      track.$.navigationPanel.organize.renameOrganizeItem({ type: 'doc' });\n    },\n    [docId, docsService]\n  );\n\n  const handleDropOnDoc = useAsyncCallback(\n    async (data: DropTargetDropEvent<AffineDNDData>) => {\n      if (data.treeInstruction?.type === 'make-child') {\n        if (data.source.data.entity?.type === 'doc') {\n          await docsService.addLinkedDoc(docId, data.source.data.entity.id);\n          track.$.navigationPanel.docs.linkDoc({\n            control: 'drag',\n          });\n        } else {\n          toast(t['com.affine.rootAppSidebar.doc.link-doc-only']());\n        }\n      } else {\n        onDrop?.(data);\n      }\n    },\n    [docId, docsService, onDrop, t]\n  );\n\n  const handleDropEffectOnDoc = useCallback<ExplorerTreeNodeDropEffect>(\n    data => {\n      if (data.treeInstruction?.type === 'make-child') {\n        if (data.source.data.entity?.type === 'doc') {\n          return 'link';\n        }\n      } else {\n        return dropEffect?.(data);\n      }\n      return;\n    },\n    [dropEffect]\n  );\n\n  const handleDropOnPlaceholder = useAsyncCallback(\n    async (data: DropTargetDropEvent<AffineDNDData>) => {\n      if (data.source.data.entity?.type === 'doc') {\n        // TODO(eyhn): timeout&error handling\n        await docsService.addLinkedDoc(docId, data.source.data.entity.id);\n        track.$.navigationPanel.docs.linkDoc({\n          control: 'drag',\n        });\n      } else {\n        toast(t['com.affine.rootAppSidebar.doc.link-doc-only']());\n      }\n    },\n    [docId, docsService, t]\n  );\n\n  const handleCanDrop = useMemo<DropTargetOptions<AffineDNDData>['canDrop']>(\n    () => args => {\n      const entityType = args.source.data.entity?.type;\n      return args.treeInstruction?.type !== 'make-child'\n        ? ((typeof canDrop === 'function' ? canDrop(args) : canDrop) ?? true)\n        : entityType === 'doc';\n    },\n    [canDrop]\n  );\n\n  const [enableInfoModal, setEnableInfoModal] = useState(false);\n  const operations = useExplorerDocNodeOperations(\n    docId,\n    useMemo(\n      () => ({\n        openInfoModal: () => setEnableInfoModal(true),\n        openNodeCollapsed: () => setCollapsed(false),\n      }),\n      []\n    )\n  );\n\n  const finalOperations = useMemo(() => {\n    if (additionalOperations) {\n      return [...operations, ...additionalOperations];\n    }\n    return operations;\n  }, [additionalOperations, operations]);\n\n  if (isInTrash || !docRecord) {\n    return null;\n  }\n\n  return (\n    <>\n      <ExplorerTreeNode\n        icon={Icon}\n        name={docTitle || t['Untitled']()}\n        dndData={dndData}\n        onDrop={handleDropOnDoc}\n        renameable\n        collapsed={collapsed}\n        setCollapsed={setCollapsed}\n        canDrop={handleCanDrop}\n        to={`/${docId}`}\n        active={active}\n        postfix={\n          referencesLoading &&\n          !collapsed && (\n            <Tooltip\n              content={t['com.affine.rootAppSidebar.docs.references-loading']()}\n            >\n              <div className={styles.loadingIcon}>\n                <Loading />\n              </div>\n            </Tooltip>\n          )\n        }\n        reorderable={reorderable}\n        onRename={handleRename}\n        childrenPlaceholder={<Empty onDrop={handleDropOnPlaceholder} />}\n        operations={finalOperations}\n        dropEffect={handleDropEffectOnDoc}\n        data-testid={`explorer-doc-${docId}`}\n      >\n        {children?.map(child => (\n          <ExplorerDocNode\n            key={child.docId}\n            docId={child.docId}\n            reorderable={false}\n            location={{\n              at: 'explorer:doc:linked-docs',\n              docId,\n            }}\n            isLinked\n          />\n        ))}\n      </ExplorerTreeNode>\n      {enableInfoModal && (\n        <InfoModal\n          open={enableInfoModal}\n          onOpenChange={setEnableInfoModal}\n          docId={docId}\n        />\n      )}\n    </>\n  );\n};\n","import \"../core/src/modules/explorer/views/nodes/doc/styles.css.ts.vanilla.css!=!../../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/modules/explorer/views/nodes/doc/styles.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xcHBmc215MCB7CiAgZGlzcGxheTogZmxleDsKICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKfQ==\\\"}!../../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var loadingIcon = '_1ppfsmy0';","import { type DropTargetDropEvent, useDropTarget } from '@affine/component';\nimport type { AffineDNDData } from '@affine/core/types/dnd';\nimport { useI18n } from '@affine/i18n';\n\nimport { EmptyNodeChildren } from '../../layouts/empty-node-children';\n\nexport const Empty = ({\n  onDrop,\n}: {\n  onDrop: (data: DropTargetDropEvent<AffineDNDData>) => void;\n}) => {\n  const { dropTargetRef } = useDropTarget(\n    () => ({\n      onDrop,\n    }),\n    [onDrop]\n  );\n  const t = useI18n();\n  return (\n    <EmptyNodeChildren ref={dropTargetRef}>\n      {t['com.affine.rootAppSidebar.tags.no-doc']()}\n    </EmptyNodeChildren>\n  );\n};\n","import {\n  IconButton,\n  MenuIcon,\n  MenuItem,\n  MenuSeparator,\n  toast,\n} from '@affine/component';\nimport { useAppSettingHelper } from '@affine/core/hooks/affine/use-app-setting-helper';\nimport { track } from '@affine/core/mixpanel';\nimport { FavoriteService } from '@affine/core/modules/favorite';\nimport { TagService } from '@affine/core/modules/tag';\nimport { WorkbenchService } from '@affine/core/modules/workbench';\nimport { useI18n } from '@affine/i18n';\nimport {\n  DeleteIcon,\n  FavoritedIcon,\n  FavoriteIcon,\n  OpenInNewIcon,\n  PlusIcon,\n  SplitViewIcon,\n} from '@blocksuite/icons/rc';\nimport { DocsService, useLiveData, useServices } from '@toeverything/infra';\nimport { useCallback, useMemo } from 'react';\n\nimport type { NodeOperation } from '../../tree/types';\n\nexport const useExplorerTagNodeOperations = (\n  tagId: string,\n  {\n    openNodeCollapsed,\n  }: {\n    openNodeCollapsed: () => void;\n  }\n): NodeOperation[] => {\n  const t = useI18n();\n  const { appSettings } = useAppSettingHelper();\n  const { docsService, workbenchService, tagService, favoriteService } =\n    useServices({\n      WorkbenchService,\n      TagService,\n      DocsService,\n      FavoriteService,\n    });\n\n  const favorite = useLiveData(\n    favoriteService.favoriteList.favorite$('tag', tagId)\n  );\n  const tagRecord = useLiveData(tagService.tagList.tagByTagId$(tagId));\n\n  const handleNewDoc = useCallback(() => {\n    if (tagRecord) {\n      const newDoc = docsService.createDoc();\n      tagRecord?.tag(newDoc.id);\n      track.$.navigationPanel.tags.createDoc();\n      workbenchService.workbench.openDoc(newDoc.id);\n      openNodeCollapsed();\n    }\n  }, [docsService, openNodeCollapsed, tagRecord, workbenchService.workbench]);\n\n  const handleMoveToTrash = useCallback(() => {\n    tagService.tagList.deleteTag(tagId);\n    track.$.navigationPanel.organize.deleteOrganizeItem({ type: 'tag' });\n    toast(t['com.affine.tags.delete-tags.toast']());\n  }, [t, tagId, tagService.tagList]);\n\n  const handleOpenInSplitView = useCallback(() => {\n    workbenchService.workbench.openTag(tagId, {\n      at: 'beside',\n    });\n    track.$.navigationPanel.organize.openInSplitView({ type: 'tag' });\n  }, [tagId, workbenchService]);\n\n  const handleToggleFavoriteTag = useCallback(() => {\n    favoriteService.favoriteList.toggle('tag', tagId);\n    track.$.navigationPanel.organize.toggleFavorite({\n      type: 'tag',\n    });\n  }, [favoriteService, tagId]);\n\n  const handleOpenInNewTab = useCallback(() => {\n    workbenchService.workbench.openTag(tagId, {\n      at: 'new-tab',\n    });\n    track.$.navigationPanel.organize.openInNewTab({ type: 'tag' });\n  }, [tagId, workbenchService]);\n\n  return useMemo(\n    () => [\n      {\n        index: 0,\n        inline: true,\n        view: (\n          <IconButton\n            size=\"16\"\n            onClick={handleNewDoc}\n            tooltip={t['com.affine.rootAppSidebar.explorer.tag-add-tooltip']()}\n          >\n            <PlusIcon />\n          </IconButton>\n        ),\n      },\n      {\n        index: 50,\n        view: (\n          <MenuItem\n            preFix={\n              <MenuIcon>\n                <OpenInNewIcon />\n              </MenuIcon>\n            }\n            onClick={handleOpenInNewTab}\n          >\n            {t['com.affine.workbench.tab.page-menu-open']()}\n          </MenuItem>\n        ),\n      },\n      ...(appSettings.enableMultiView\n        ? [\n            {\n              index: 100,\n              view: (\n                <MenuItem\n                  preFix={\n                    <MenuIcon>\n                      <SplitViewIcon />\n                    </MenuIcon>\n                  }\n                  onClick={handleOpenInSplitView}\n                >\n                  {t['com.affine.workbench.split-view.page-menu-open']()}\n                </MenuItem>\n              ),\n            },\n          ]\n        : []),\n      {\n        index: 199,\n        view: (\n          <MenuItem\n            preFix={\n              <MenuIcon>\n                {favorite ? (\n                  <FavoritedIcon\n                    style={{ color: 'var(--affine-primary-color)' }}\n                  />\n                ) : (\n                  <FavoriteIcon />\n                )}\n              </MenuIcon>\n            }\n            onClick={handleToggleFavoriteTag}\n          >\n            {favorite\n              ? t['com.affine.favoritePageOperation.remove']()\n              : t['com.affine.favoritePageOperation.add']()}\n          </MenuItem>\n        ),\n      },\n      {\n        index: 9999,\n        view: <MenuSeparator key=\"menu-separator\" />,\n      },\n      {\n        index: 10000,\n        view: (\n          <MenuItem\n            type={'danger'}\n            preFix={\n              <MenuIcon>\n                <DeleteIcon />\n              </MenuIcon>\n            }\n            onClick={handleMoveToTrash}\n          >\n            {t['Delete']()}\n          </MenuItem>\n        ),\n      },\n    ],\n    [\n      appSettings.enableMultiView,\n      favorite,\n      handleMoveToTrash,\n      handleNewDoc,\n      handleOpenInNewTab,\n      handleOpenInSplitView,\n      handleToggleFavoriteTag,\n      t,\n    ]\n  );\n};\n","import {\n  type DropTargetDropEvent,\n  type DropTargetOptions,\n  toast,\n} from '@affine/component';\nimport { track } from '@affine/core/mixpanel';\nimport type { Tag } from '@affine/core/modules/tag';\nimport { TagService } from '@affine/core/modules/tag';\nimport type { AffineDNDData } from '@affine/core/types/dnd';\nimport { useI18n } from '@affine/i18n';\nimport {\n  GlobalContextService,\n  useLiveData,\n  useServices,\n} from '@toeverything/infra';\nimport clsx from 'clsx';\nimport { useCallback, useMemo, useState } from 'react';\n\nimport { ExplorerTreeNode, type ExplorerTreeNodeDropEffect } from '../../tree';\nimport { ExplorerDocNode } from '../doc';\nimport type { GenericExplorerNode } from '../types';\nimport { Empty } from './empty';\nimport { useExplorerTagNodeOperations } from './operations';\nimport * as styles from './styles.css';\n\nexport const ExplorerTagNode = ({\n  tagId,\n  onDrop,\n  location,\n  reorderable,\n  operations: additionalOperations,\n  dropEffect,\n  canDrop,\n  defaultRenaming,\n}: {\n  tagId: string;\n  defaultRenaming?: boolean;\n} & GenericExplorerNode) => {\n  const t = useI18n();\n  const { tagService, globalContextService } = useServices({\n    TagService,\n    GlobalContextService,\n  });\n  const active =\n    useLiveData(globalContextService.globalContext.tagId.$) === tagId;\n  const [collapsed, setCollapsed] = useState(true);\n\n  const tagRecord = useLiveData(tagService.tagList.tagByTagId$(tagId));\n  const tagColor = useLiveData(tagRecord?.color$);\n  const tagName = useLiveData(tagRecord?.value$);\n\n  const Icon = useCallback(\n    ({ className }: { className?: string }) => {\n      return (\n        <div className={clsx(styles.tagIconContainer, className)}>\n          <div\n            className={styles.tagIcon}\n            style={{\n              backgroundColor: tagColor,\n            }}\n          ></div>\n        </div>\n      );\n    },\n    [tagColor]\n  );\n\n  const dndData = useMemo(() => {\n    return {\n      draggable: {\n        entity: {\n          type: 'tag',\n          id: tagId,\n        },\n        from: location,\n      },\n      dropTarget: {\n        at: 'explorer:tag',\n      },\n    } satisfies AffineDNDData;\n  }, [location, tagId]);\n\n  const handleRename = useCallback(\n    (newName: string) => {\n      if (tagRecord && tagRecord.value$.value !== newName) {\n        tagRecord.rename(newName);\n        track.$.navigationPanel.organize.renameOrganizeItem({\n          type: 'tag',\n        });\n      }\n    },\n    [tagRecord]\n  );\n\n  const handleDropOnTag = useCallback(\n    (data: DropTargetDropEvent<AffineDNDData>) => {\n      if (data.treeInstruction?.type === 'make-child' && tagRecord) {\n        if (data.source.data.entity?.type === 'doc') {\n          tagRecord.tag(data.source.data.entity.id);\n          track.$.navigationPanel.tags.tagDoc({\n            control: 'drag',\n          });\n        } else {\n          toast(t['com.affine.rootAppSidebar.tag.doc-only']());\n        }\n      } else {\n        onDrop?.(data);\n      }\n    },\n    [onDrop, t, tagRecord]\n  );\n\n  const handleDropEffectOnTag = useCallback<ExplorerTreeNodeDropEffect>(\n    data => {\n      if (data.treeInstruction?.type === 'make-child') {\n        if (data.source.data.entity?.type === 'doc') {\n          return 'link';\n        }\n      } else {\n        return dropEffect?.(data);\n      }\n      return;\n    },\n    [dropEffect]\n  );\n\n  const handleDropOnPlaceholder = useCallback(\n    (data: DropTargetDropEvent<AffineDNDData>) => {\n      if (tagRecord) {\n        if (data.source.data.entity?.type === 'doc') {\n          tagRecord.tag(data.source.data.entity.id);\n        } else {\n          toast(t['com.affine.rootAppSidebar.tag.doc-only']());\n        }\n      }\n    },\n    [t, tagRecord]\n  );\n\n  const handleCanDrop = useMemo<DropTargetOptions<AffineDNDData>['canDrop']>(\n    () => args => {\n      const entityType = args.source.data.entity?.type;\n      return args.treeInstruction?.type !== 'make-child'\n        ? ((typeof canDrop === 'function' ? canDrop(args) : canDrop) ?? true)\n        : entityType === 'doc';\n    },\n    [canDrop]\n  );\n\n  const operations = useExplorerTagNodeOperations(\n    tagId,\n    useMemo(\n      () => ({\n        openNodeCollapsed: () => setCollapsed(false),\n      }),\n      []\n    )\n  );\n\n  const finalOperations = useMemo(() => {\n    if (additionalOperations) {\n      return [...operations, ...additionalOperations];\n    }\n    return operations;\n  }, [additionalOperations, operations]);\n\n  if (!tagRecord) {\n    return null;\n  }\n\n  return (\n    <ExplorerTreeNode\n      icon={Icon}\n      name={tagName || t['Untitled']()}\n      dndData={dndData}\n      onDrop={handleDropOnTag}\n      renameable\n      collapsed={collapsed}\n      setCollapsed={setCollapsed}\n      to={`/tag/${tagId}`}\n      active={active}\n      defaultRenaming={defaultRenaming}\n      reorderable={reorderable}\n      onRename={handleRename}\n      canDrop={handleCanDrop}\n      childrenPlaceholder={<Empty onDrop={handleDropOnPlaceholder} />}\n      operations={finalOperations}\n      dropEffect={handleDropEffectOnTag}\n      data-testid={`explorer-tag-${tagId}`}\n    >\n      <ExplorerTagNodeDocs tag={tagRecord} />\n    </ExplorerTreeNode>\n  );\n};\n\n/**\n * the `tag.pageIds$` has a performance issue,\n * so we split the tag node children into a separate component,\n * so it won't be rendered when the tag node is collapsed.\n */\nexport const ExplorerTagNodeDocs = ({ tag }: { tag: Tag }) => {\n  const tagDocIds = useLiveData(tag.pageIds$);\n\n  return tagDocIds.map(docId => (\n    <ExplorerDocNode\n      key={docId}\n      docId={docId}\n      reorderable={false}\n      location={{\n        at: 'explorer:tags:docs',\n      }}\n    />\n  ));\n};\n","import \"../core/src/modules/explorer/views/nodes/tag/styles.css.ts.vanilla.css!=!../../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/modules/explorer/views/nodes/tag/styles.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xN3d4bmZvMCB7CiAgYm9yZGVyLXJhZGl1czogNTAlOwogIGhlaWdodDogOHB4OwogIHdpZHRoOiA4cHg7Cn0KLl8xN3d4bmZvMSB7CiAgZGlzcGxheTogZmxleDsKICBhbGlnbi1pdGVtczogY2VudGVyOwogIGp1c3RpZnktY29udGVudDogY2VudGVyOwogIHdpZHRoOiAxZW07CiAgaGVpZ2h0OiAxZW07Cn0=\\\"}!../../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var tagIcon = '_17wxnfo0';\nexport var tagIconContainer = '_17wxnfo1';","import \"../core/src/modules/explorer/views/tree/drop-effect.css.ts.vanilla.css!=!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/modules/explorer/views/tree/drop-effect.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xbGc5NjIxMCB7CiAgei1pbmRleDogOTk5OTk7CiAgcG9zaXRpb246IGZpeGVkOwogIGxlZnQ6IDEwcHg7CiAgdG9wOiAtMjBweDsKICBiYWNrZ3JvdW5kOiB2YXIoLS1hZmZpbmUtYmFja2dyb3VuZC1wcmltYXJ5LWNvbG9yKTsKICBib3gtc2hhZG93OiB2YXIoLS1hZmZpbmUtdG9vbGJhci1zaGFkb3cpOwogIHBhZGRpbmc6IDBweCA0cHg7CiAgZm9udC1zaXplOiAxMnB4OwogIGJvcmRlci1yYWRpdXM6IDRweDsKICBsaW5lLWhlaWdodDogMS40OwogIGRpc3BsYXk6IGZsZXg7CiAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBnYXA6IDRweDsKfQouXzFsZzk2MjExIHsKICB3aWR0aDogMTJweDsKICBoZWlnaHQ6IDEycHg7Cn0=\\\"}!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var dropEffect = '_1lg96210';\nexport var icon = '_1lg96211';","import type { useDropTarget } from '@affine/component';\nimport { useI18n } from '@affine/i18n';\nimport { CopyIcon, LinkIcon, MoveToIcon } from '@blocksuite/icons/rc';\nimport { createPortal } from 'react-dom';\n\nimport * as styles from './drop-effect.css';\n\nexport const DropEffect = ({\n  dropEffect,\n  position,\n}: {\n  dropEffect?: 'copy' | 'move' | 'link' | undefined;\n  position: ReturnType<typeof useDropTarget>['draggedOverPosition'];\n}) => {\n  const t = useI18n();\n  if (dropEffect === undefined) return null;\n  return createPortal(\n    <div\n      className={styles.dropEffect}\n      style={{\n        transform: `translate(${position.clientX}px, ${position.clientY}px)`,\n      }}\n    >\n      {dropEffect === 'copy' ? (\n        <CopyIcon className={styles.icon} />\n      ) : dropEffect === 'move' ? (\n        <MoveToIcon className={styles.icon} />\n      ) : (\n        <LinkIcon className={styles.icon} />\n      )}\n      {dropEffect === 'copy'\n        ? t['com.affine.rootAppSidebar.explorer.drop-effect.copy']()\n        : dropEffect === 'move'\n          ? t['com.affine.rootAppSidebar.explorer.drop-effect.move']()\n          : t['com.affine.rootAppSidebar.explorer.drop-effect.link']()}\n    </div>,\n    document.body\n  );\n};\n","import type { KeyboardEvent, ReactElement } from 'react';\nimport { useCallback, useEffect, useState } from 'react';\n\nimport Input from '../../ui/input';\nimport { Menu } from '../../ui/menu';\n\nexport const RenameModal = ({\n  onRename,\n  currentName,\n  open,\n  width = 220,\n  children,\n  onOpenChange,\n}: {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onRename: (newName: string) => void;\n  currentName: string;\n  width?: string | number;\n  children?: ReactElement;\n}) => {\n  const [value, setValue] = useState(currentName);\n\n  const handleRename = useCallback(() => {\n    onRename(value);\n    onOpenChange(false);\n  }, [onOpenChange, onRename, value]);\n\n  const onKeyDown = useCallback(\n    (e: KeyboardEvent<HTMLInputElement>) => {\n      if (e.key !== 'Escape') return;\n      if (currentName !== value) setValue(currentName);\n      onOpenChange(false);\n    },\n    [currentName, value, onOpenChange]\n  );\n\n  // Synchronize when the title is changed in the page header or title.\n  useEffect(() => setValue(currentName), [currentName]);\n\n  return (\n    <Menu\n      rootOptions={{\n        open: open,\n        onOpenChange: onOpenChange,\n      }}\n      contentOptions={{\n        side: 'left',\n        onPointerDownOutside: handleRename,\n        sideOffset: -12,\n        onClick: e => e.stopPropagation(),\n        style: { borderRadius: 10, padding: 8 },\n      }}\n      items={\n        <Input\n          autoFocus\n          autoSelect\n          value={value}\n          onChange={setValue}\n          onEnter={handleRename}\n          onKeyDown={onKeyDown}\n          data-testid=\"rename-modal-input\"\n          style={{ width, height: 34, borderRadius: 4 }}\n        />\n      }\n    >\n      {children ?? <div />}\n    </Menu>\n  );\n};\n","import React from 'react';\n\nexport interface ExplorerTreeContextData {\n  /**\n   * The level of the current tree node.\n   */\n  level: number;\n}\n\nexport const ExplorerTreeContext =\n  React.createContext<ExplorerTreeContextData | null>(null);\n","import {\n  DropIndicator,\n  type DropTargetDropEvent,\n  type DropTargetOptions,\n  type DropTargetTreeInstruction,\n  IconButton,\n  Menu,\n  MenuIcon,\n  MenuItem,\n  useDraggable,\n  useDropTarget,\n} from '@affine/component';\nimport { RenameModal } from '@affine/component/rename-modal';\nimport { appSidebarWidthAtom } from '@affine/core/components/app-sidebar/index.jotai';\nimport { WorkbenchLink } from '@affine/core/modules/workbench';\nimport type { AffineDNDData } from '@affine/core/types/dnd';\nimport { useI18n } from '@affine/i18n';\nimport {\n  ArrowDownSmallIcon,\n  EditIcon,\n  MoreHorizontalIcon,\n} from '@blocksuite/icons/rc';\nimport * as Collapsible from '@radix-ui/react-collapsible';\nimport { assignInlineVars } from '@vanilla-extract/dynamic';\nimport clsx from 'clsx';\nimport type { To } from 'history';\nimport { useAtomValue } from 'jotai';\nimport {\n  Fragment,\n  type RefAttributes,\n  useCallback,\n  useContext,\n  useEffect,\n  useId,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\n\nimport { ExplorerTreeContext } from './context';\nimport { DropEffect } from './drop-effect';\nimport * as styles from './node.css';\nimport type { NodeOperation } from './types';\n\nexport type ExplorerTreeNodeDropEffectData = {\n  source: { data: AffineDNDData['draggable'] };\n  treeInstruction: DropTargetTreeInstruction | null;\n};\nexport type ExplorerTreeNodeDropEffect = (\n  data: ExplorerTreeNodeDropEffectData\n) => 'copy' | 'move' | 'link' | undefined;\nexport type ExplorerTreeNodeIcon = React.ComponentType<{\n  className?: string;\n  draggedOver?: boolean;\n  treeInstruction?: DropTargetTreeInstruction | null;\n  collapsed?: boolean;\n}>;\n\nexport const ExplorerTreeNode = ({\n  children,\n  icon: Icon,\n  name,\n  onClick,\n  to,\n  active,\n  defaultRenaming,\n  renameable,\n  onRename,\n  disabled,\n  collapsed,\n  setCollapsed,\n  canDrop,\n  reorderable = true,\n  operations = [],\n  postfix,\n  childrenOperations = [],\n  childrenPlaceholder,\n  linkComponent: LinkComponent = WorkbenchLink,\n  dndData,\n  onDrop,\n  dropEffect,\n  ...otherProps\n}: {\n  name?: string;\n  icon?: ExplorerTreeNodeIcon;\n  children?: React.ReactNode;\n  active?: boolean;\n  reorderable?: boolean;\n  defaultRenaming?: boolean;\n  collapsed: boolean;\n  setCollapsed: (collapsed: boolean) => void;\n  renameable?: boolean;\n  onRename?: (newName: string) => void;\n  disabled?: boolean;\n  onClick?: () => void;\n  to?: To;\n  postfix?: React.ReactNode;\n  canDrop?: DropTargetOptions<AffineDNDData>['canDrop'];\n  operations?: NodeOperation[];\n  childrenOperations?: NodeOperation[];\n  childrenPlaceholder?: React.ReactNode;\n  linkComponent?: React.ComponentType<\n    React.PropsWithChildren<{ to: To; className?: string }> & RefAttributes<any>\n  >;\n  dndData?: AffineDNDData;\n  onDrop?: (data: DropTargetDropEvent<AffineDNDData>) => void;\n  dropEffect?: ExplorerTreeNodeDropEffect;\n} & { [key in `data-${string}`]?: any }) => {\n  const t = useI18n();\n  const cid = useId();\n  const context = useContext(ExplorerTreeContext);\n  const level = context?.level ?? 0;\n  // If no onClick or to is provided, clicking on the node will toggle the collapse state\n  const clickForCollapse = !onClick && !to && !disabled;\n  const [childCount, setChildCount] = useState(0);\n  const sidebarWidth = useAtomValue(appSidebarWidthAtom);\n  const [renaming, setRenaming] = useState(defaultRenaming);\n  const [lastInGroup, setLastInGroup] = useState(false);\n  const rootRef = useRef<HTMLDivElement>(null);\n  const { dragRef, dragging, CustomDragPreview } = useDraggable<\n    AffineDNDData & { draggable: { __cid: string } }\n  >(\n    () => ({\n      data: { ...dndData?.draggable, __cid: cid },\n      dragPreviewPosition: 'pointer-outside',\n    }),\n    [cid, dndData]\n  );\n  const handleCanDrop = useMemo<DropTargetOptions<AffineDNDData>['canDrop']>(\n    () => args => {\n      if (!reorderable && args.treeInstruction?.type !== 'make-child') {\n        return false;\n      }\n      return (typeof canDrop === 'function' ? canDrop(args) : canDrop) ?? true;\n    },\n    [canDrop, reorderable]\n  );\n  const {\n    dropTargetRef,\n    treeInstruction,\n    draggedOverDraggable,\n    draggedOver,\n    draggedOverPosition,\n  } = useDropTarget<AffineDNDData & { draggable: { __cid: string } }>(\n    () => ({\n      data: dndData?.dropTarget,\n      treeInstruction: {\n        currentLevel: level,\n        indentPerLevel: 20,\n        mode: !collapsed\n          ? 'expanded'\n          : lastInGroup\n            ? 'last-in-group'\n            : 'standard',\n        block:\n          reorderable === false\n            ? ['reorder-above', 'reorder-below', 'reparent']\n            : [],\n      },\n      onDrop: data => {\n        if (\n          data.source.data.__cid === cid &&\n          data.treeInstruction?.type !== 'reparent'\n        ) {\n          // Do nothing if dropped on self\n          return;\n        }\n        onDrop?.(data);\n        if (data.treeInstruction?.type === 'make-child') {\n          setCollapsed(false);\n        }\n      },\n      canDrop: handleCanDrop,\n    }),\n    [\n      dndData?.dropTarget,\n      level,\n      collapsed,\n      lastInGroup,\n      reorderable,\n      handleCanDrop,\n      cid,\n      onDrop,\n      setCollapsed,\n    ]\n  );\n  const isSelfDraggedOver = draggedOverDraggable?.data.__cid === cid;\n\n  useEffect(() => {\n    if (\n      draggedOver &&\n      treeInstruction?.type === 'make-child' &&\n      !isSelfDraggedOver\n    ) {\n      // auto expand when dragged over\n      const timeout = setTimeout(() => {\n        setCollapsed(false);\n      }, 1000);\n      return () => clearTimeout(timeout);\n    }\n    return;\n  }, [draggedOver, isSelfDraggedOver, setCollapsed, treeInstruction?.type]);\n\n  useEffect(() => {\n    if (rootRef.current) {\n      const parent = rootRef.current.parentElement;\n      if (parent) {\n        const updateLastInGroup = () => {\n          setLastInGroup(parent?.lastElementChild === rootRef.current);\n        };\n        updateLastInGroup();\n        const observer = new MutationObserver(updateLastInGroup);\n        observer.observe(parent, {\n          childList: true,\n        });\n        return () => observer.disconnect();\n      }\n    }\n    return;\n  }, []);\n\n  const presetOperations = useMemo(\n    () =>\n      (\n        [\n          renameable\n            ? {\n                index: 0,\n                view: (\n                  <MenuItem\n                    key={'explorer-tree-rename'}\n                    type={'default'}\n                    preFix={\n                      <MenuIcon>\n                        <EditIcon />\n                      </MenuIcon>\n                    }\n                    onClick={() => setRenaming(true)}\n                  >\n                    {t['com.affine.menu.rename']()}\n                  </MenuItem>\n                ),\n              }\n            : null,\n        ] as (NodeOperation | null)[]\n      ).filter((t): t is NodeOperation => t !== null),\n    [renameable, t]\n  );\n\n  const { menuOperations, inlineOperations } = useMemo(() => {\n    const sorted = [...presetOperations, ...operations].sort(\n      (a, b) => a.index - b.index\n    );\n    return {\n      menuOperations: sorted.filter(({ inline }) => !inline),\n      inlineOperations: sorted.filter(({ inline }) => !!inline),\n    };\n  }, [presetOperations, operations]);\n\n  const contextValue = useMemo(() => {\n    return {\n      operations: childrenOperations,\n      level: (context?.level ?? 0) + 1,\n      registerChild: () => {\n        setChildCount(c => c + 1);\n        return () => setChildCount(c => c - 1);\n      },\n    };\n  }, [childrenOperations, context?.level]);\n\n  const handleCollapsedChange = useCallback(\n    (e: React.MouseEvent) => {\n      e.stopPropagation();\n      e.preventDefault(); // for links\n      setCollapsed(!collapsed);\n    },\n    [collapsed, setCollapsed]\n  );\n\n  const handleRename = useCallback(\n    (newName: string) => {\n      onRename?.(newName);\n    },\n    [onRename]\n  );\n\n  const handleClick = useCallback(() => {\n    if (!clickForCollapse) {\n      onClick?.();\n    } else {\n      setCollapsed(!collapsed);\n    }\n  }, [clickForCollapse, collapsed, onClick, setCollapsed]);\n\n  const content = (\n    <div\n      onClick={handleClick}\n      className={styles.itemRoot}\n      data-active={active}\n      data-disabled={disabled}\n    >\n      {Icon && (\n        <div className={styles.iconsContainer}>\n          <div\n            data-disabled={disabled}\n            onClick={handleCollapsedChange}\n            data-testid=\"explorer-collapsed-button\"\n            className={styles.collapsedIconContainer}\n          >\n            <ArrowDownSmallIcon\n              className={styles.collapsedIcon}\n              data-collapsed={collapsed !== false}\n            />\n          </div>\n          <Icon\n            className={styles.icon}\n            draggedOver={draggedOver && !isSelfDraggedOver}\n            treeInstruction={treeInstruction}\n            collapsed={collapsed}\n          />\n        </div>\n      )}\n      {renameable && renaming && (\n        <RenameModal\n          open\n          width={sidebarWidth - 32}\n          onOpenChange={setRenaming}\n          onRename={handleRename}\n          currentName={name ?? ''}\n        >\n          <div className={styles.itemRenameAnchor} />\n        </RenameModal>\n      )}\n\n      <div className={styles.itemContent}>{name}</div>\n\n      {postfix}\n      <div\n        className={styles.postfix}\n        onClick={e => {\n          // prevent jump to page\n          e.stopPropagation();\n          e.preventDefault();\n        }}\n      >\n        {inlineOperations.map(({ view }, index) => (\n          <Fragment key={index}>{view}</Fragment>\n        ))}\n        {menuOperations.length > 0 && (\n          <Menu\n            items={menuOperations.map(({ view }, index) => (\n              <Fragment key={index}>{view}</Fragment>\n            ))}\n          >\n            <IconButton\n              size=\"16\"\n              data-testid=\"explorer-tree-node-operation-button\"\n              style={{ marginLeft: 4 }}\n            >\n              <MoreHorizontalIcon />\n            </IconButton>\n          </Menu>\n        )}\n      </div>\n    </div>\n  );\n\n  return (\n    <Collapsible.Root\n      open={!collapsed}\n      onOpenChange={setCollapsed}\n      style={assignInlineVars({\n        [styles.levelIndent]: `${level * 20}px`,\n      })}\n      ref={rootRef}\n      {...otherProps}\n    >\n      <div\n        className={clsx(styles.contentContainer, styles.draggedOverEffect)}\n        data-open={!collapsed}\n        data-self-dragged-over={isSelfDraggedOver}\n        ref={dropTargetRef}\n      >\n        {to ? (\n          <LinkComponent to={to} className={styles.linkItemRoot} ref={dragRef}>\n            {content}\n          </LinkComponent>\n        ) : (\n          <div ref={dragRef}>{content}</div>\n        )}\n        <CustomDragPreview>\n          <div className={styles.draggingContainer}>{content}</div>\n        </CustomDragPreview>\n        {treeInstruction &&\n          // Do not show drop indicator for self dragged over\n          !(treeInstruction.type !== 'reparent' && isSelfDraggedOver) &&\n          treeInstruction.type !== 'instruction-blocked' && (\n            <DropIndicator instruction={treeInstruction} />\n          )}\n        {draggedOver &&\n          dropEffect &&\n          draggedOverPosition &&\n          !isSelfDraggedOver &&\n          draggedOverDraggable && (\n            <DropEffect\n              dropEffect={dropEffect({\n                source: draggedOverDraggable,\n                treeInstruction: treeInstruction,\n              })}\n              position={draggedOverPosition}\n            />\n          )}\n      </div>\n      <Collapsible.Content style={{ display: dragging ? 'none' : undefined }}>\n        {/* For lastInGroup check, the placeholder must be placed above all children in the dom */}\n        <div className={styles.collapseContentPlaceholder}>\n          {childCount === 0 && !collapsed && childrenPlaceholder}\n        </div>\n        <ExplorerTreeContext.Provider value={contextValue}>\n          {collapsed ? null : children}\n        </ExplorerTreeContext.Provider>\n      </Collapsible.Content>\n    </Collapsible.Root>\n  );\n};\n","import \"../core/src/modules/explorer/views/tree/node.css.ts.vanilla.css!=!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/modules/explorer/views/tree/node.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACq1W227bMAx9z1cIAQa0DyqctOtFRYH9x1AMjETbXGTJkOS02dB/HyzbieU6WYfuKbF41eEhqW9b3OcOKvTsx+rn/s6V+Yb9XjCWfYk/jNkaJIW9YKvHBWNvC8Zuz8ju3suyQXZ/xu7hjN0qO2n4trga0l5FFWm1dYKRKdFReBwrrKOCIl9r2LcqmgzyXONr6ws0FYZTwMoLJtEEdO3xxjqFjjtQ1HjBbuqoHPA18GghmMY8PM5EZuyFVChFTL/9rMjwEqkog2DXWeeo8ei4R40yCGasweipcb51VVsa0qhBKTKFYNmQQm5N4J5+oWA7cBecQ57H+8Tz6jJaWU+BrBHMoYZAu+i+AleQ4cHWgsU0xhiJ0u7QRaQ2ILeFs41RkxBRhcf7XqbW3xUE4CDbUE/L4BpcPn/OlyIPG40q8TYApDCHRo/RT3zHKnmU1ihw+0MQNgDLcYcm+AH4meAOioJMkQQ/8vPqa2J0HcXzvse1gI23ugnxtCVPz/RYD77qiXHgTvc58GY1LdhNl9MOXa7ti2AlKYXmwNGjALWm2pOPzksKyH0NEtsEXxzUZ1qg7ZC+4U6iXDuqwO3TEn5NG+4vnea6G/b0nocrnQ1/L2PP5klGPxsfKN+3fZd3aXE0Ko1KhgKBToKu5oKC1knM2/EYSoAiac0IqKSF19O63kU3AwtuJyzovz8K7XBhaU1AE87Mt3U/3xyYAYn4P7euYtnV2p9iweRy45t0vSSt1lD7SScfnAvmbICAF/whU1jMupidBaN2vP4QKe4+NeLu/4nT74CPZPMB3HhB3AwjPQpLR2YbGT4K+3BEa7YsDMEjJ8Ntky69h8+jD+mV3wEKwhq957IkraYrtm+ikbaMKuMd1HOuX3G8G4ldNQaj7OQ6G3lW50t6FAw8HW2EvhLrrJ+3k7a4nXQn9qP+bD7YQR8ctpXxwTWy1X5aVrDFDq7lc6fTTqJu26CKM/tpmYP2uHwWkIeerAcSLZdJ82+0ldvTM/MXJ6MOE/yDjB8201wZuofDCDUJWl7ERxp/Z3CZbq/2JfS/IerktkYzhxoYqqBD5fjAXXlGJm/piax9BYJ7XLz9AQBQy98LCwAA\\\"}!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var collapseContentPlaceholder = '_1jy7rhfa';\nexport var collapsedIcon = '_1jy7rhf9';\nexport var collapsedIconContainer = '_1jy7rhf7';\nexport var contentContainer = '_1jy7rhfc';\nexport var draggedOverEffect = '_1jy7rhfe';\nexport var draggingContainer = '_1jy7rhfd';\nexport var icon = '_1jy7rhf6';\nexport var iconsContainer = '_1jy7rhf8';\nexport var itemContent = '_1jy7rhf4';\nexport var itemRenameAnchor = '_1jy7rhf3';\nexport var itemRoot = '_1jy7rhf2';\nexport var levelIndent = 'var(--_1jy7rhf0)';\nexport var linkItemRoot = '_1jy7rhf1';\nexport var postfix = '_1jy7rhf5';","import { useMemo, useState } from 'react';\n\nimport { ExplorerTreeContext } from './context';\nimport * as styles from './root.css';\nimport type { NodeOperation } from './types';\n\nexport const ExplorerTreeRoot = ({\n  children,\n  childrenOperations = [],\n  placeholder,\n}: {\n  children?: React.ReactNode;\n  childrenOperations?: NodeOperation[];\n  className?: string;\n  placeholder?: React.ReactNode;\n}) => {\n  const [childCount, setChildCount] = useState(0);\n  const contextValue = useMemo(() => {\n    return {\n      operations: childrenOperations,\n      level: 0,\n      registerChild: () => {\n        setChildCount(c => c + 1);\n        return () => setChildCount(c => c - 1);\n      },\n    };\n  }, [childrenOperations]);\n\n  return (\n    // <div> is for placeholder:last-child selector\n    <div>\n      {/* For lastInGroup check, the placeholder must be placed above all children in the dom */}\n      <div className={styles.placeholder}>\n        {childCount === 0 && placeholder}\n      </div>\n      <ExplorerTreeContext.Provider value={contextValue}>\n        {children}\n      </ExplorerTreeContext.Provider>\n    </div>\n  );\n};\n","import \"../core/src/modules/explorer/views/tree/root.css.ts.vanilla.css!=!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/modules/explorer/views/tree/root.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll84NncwanUwIHsKICBkaXNwbGF5OiBub25lOwp9Ci5fODZ3MGp1MDpvbmx5LWNoaWxkIHsKICBkaXNwbGF5OiBpbml0aWFsOwp9\\\"}!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var placeholder = '_86w0ju0';","import { generateFractionalIndexingKeyBetween } from '@affine/core/utils/fractional-indexing';\nimport { Entity } from '@toeverything/infra';\n\nimport type { FavoriteSupportType } from '../constant';\nimport type { FavoriteRecord, FavoriteStore } from '../stores/favorite';\n\nexport class FavoriteList extends Entity {\n  list$ = this.store.watchFavorites();\n  sortedList$ = this.list$.map(v =>\n    v.sort((a, b) => (a.index > b.index ? 1 : -1))\n  );\n  isLoading$ = this.store.watchIsLoading();\n\n  constructor(private readonly store: FavoriteStore) {\n    super();\n  }\n\n  /**\n   * get favorite record by type and id\n   */\n  favorite$(type: FavoriteSupportType, id: string) {\n    return this.store.watchFavorite(type, id);\n  }\n\n  isFavorite$(type: FavoriteSupportType, id: string) {\n    return this.favorite$(type, id).map(v => !!v);\n  }\n\n  add(\n    type: FavoriteSupportType,\n    id: string,\n    index: string = this.indexAt('before')\n  ) {\n    return this.store.addFavorite(type, id, index);\n  }\n\n  toggle(\n    type: FavoriteSupportType,\n    id: string,\n    index: string = this.indexAt('before')\n  ) {\n    if (this.favorite$(type, id).value) {\n      return this.remove(type, id);\n    } else {\n      return this.add(type, id, index);\n    }\n  }\n\n  remove(type: FavoriteSupportType, id: string) {\n    return this.store.removeFavorite(type, id);\n  }\n\n  reorder(type: FavoriteSupportType, id: string, index: string) {\n    return this.store.reorderFavorite(type, id, index);\n  }\n\n  indexAt(\n    at: 'before' | 'after',\n    targetRecord?: {\n      type: FavoriteSupportType;\n      id: string;\n    }\n  ) {\n    if (!targetRecord) {\n      if (at === 'before') {\n        const first = this.sortedList$.value.at(0);\n        return generateFractionalIndexingKeyBetween(null, first?.index || null);\n      } else {\n        const last = this.sortedList$.value.at(-1);\n        return generateFractionalIndexingKeyBetween(last?.index || null, null);\n      }\n    } else {\n      const sortedChildren = this.sortedList$.value;\n      const targetIndex = sortedChildren.findIndex(\n        node => node.id === targetRecord.id && node.type === targetRecord.type\n      );\n      if (targetIndex === -1) {\n        throw new Error('Target favorite record not found');\n      }\n      const target = sortedChildren[targetIndex];\n      const before: FavoriteRecord | null =\n        sortedChildren[targetIndex - 1] || null;\n      const after: FavoriteRecord | null =\n        sortedChildren[targetIndex + 1] || null;\n      if (at === 'before') {\n        return generateFractionalIndexingKeyBetween(\n          before?.index || null,\n          target.index\n        );\n      } else {\n        return generateFractionalIndexingKeyBetween(\n          target.index,\n          after?.index || null\n        );\n      }\n    }\n  }\n}\n","import { Service } from '@toeverything/infra';\n\nimport { FavoriteList } from '../entities/favorite-list';\n\nexport class FavoriteService extends Service {\n  favoriteList = this.framework.createEntity(FavoriteList);\n}\n","export const FavoriteSupportType = [\n  'collection',\n  'doc',\n  'tag',\n  'folder',\n] as const;\nexport type FavoriteSupportType = 'collection' | 'doc' | 'tag' | 'folder';\nexport const isFavoriteSupportType = (\n  type: string\n): type is FavoriteSupportType =>\n  FavoriteSupportType.includes(type as FavoriteSupportType);\n","import { WorkspaceFlavour } from '@affine/env/workspace';\nimport type { WorkspaceDBService, WorkspaceService } from '@toeverything/infra';\nimport { LiveData, Store } from '@toeverything/infra';\nimport { map } from 'rxjs';\n\nimport type { AuthService } from '../../cloud';\nimport type { FavoriteSupportType } from '../constant';\nimport { isFavoriteSupportType } from '../constant';\n\nexport interface FavoriteRecord {\n  type: FavoriteSupportType;\n  id: string;\n  index: string;\n}\n\nexport class FavoriteStore extends Store {\n  constructor(\n    private readonly authService: AuthService,\n    private readonly workspaceDBService: WorkspaceDBService,\n    private readonly workspaceService: WorkspaceService\n  ) {\n    super();\n  }\n\n  private get userdataDB$() {\n    return this.authService.session.account$.map(account => {\n      // if is local workspace or no account, use __local__ userdata\n      // sometimes we may have cloud workspace but no account for a short time, we also use __local__ userdata\n      if (\n        this.workspaceService.workspace.meta.flavour ===\n          WorkspaceFlavour.LOCAL ||\n        !account\n      ) {\n        return this.workspaceDBService.userdataDB('__local__');\n      }\n      return this.workspaceDBService.userdataDB(account.id);\n    });\n  }\n\n  watchIsLoading() {\n    return this.userdataDB$\n      .map(db => LiveData.from(db.favorite.isLoading$, false))\n      .flat();\n  }\n\n  watchFavorites() {\n    return this.userdataDB$\n      .map(db => LiveData.from(db.favorite.find$(), []))\n      .flat()\n      .map(raw => {\n        return raw\n          .map(data => this.toRecord(data))\n          .filter((record): record is FavoriteRecord => !!record);\n      });\n  }\n\n  addFavorite(\n    type: FavoriteSupportType,\n    id: string,\n    index: string\n  ): FavoriteRecord {\n    const db = this.userdataDB$.value;\n    const raw = db.favorite.create({\n      key: this.encodeKey(type, id),\n      index,\n    });\n    return this.toRecord(raw) as FavoriteRecord;\n  }\n\n  reorderFavorite(type: FavoriteSupportType, id: string, index: string) {\n    const db = this.userdataDB$.value;\n    db.favorite.update(this.encodeKey(type, id), { index });\n  }\n\n  removeFavorite(type: FavoriteSupportType, id: string) {\n    const db = this.userdataDB$.value;\n    db.favorite.delete(this.encodeKey(type, id));\n  }\n\n  watchFavorite(type: FavoriteSupportType, id: string) {\n    const db = this.userdataDB$.value;\n    return LiveData.from<FavoriteRecord | undefined>(\n      db.favorite\n        .get$(this.encodeKey(type, id))\n        .pipe(map(data => (data ? this.toRecord(data) : undefined))),\n      null as any\n    );\n  }\n\n  private toRecord(data: {\n    key: string;\n    index: string;\n  }): FavoriteRecord | undefined {\n    const key = this.parseKey(data.key);\n    if (!key) {\n      return undefined;\n    }\n    return {\n      type: key.type,\n      id: key.id,\n      index: data.index,\n    };\n  }\n\n  /**\n   * parse favorite key\n   * key format: ${type}:${id}\n   * type: collection | doc | tag\n   * @returns null if key is invalid\n   */\n  private parseKey(key: string): {\n    type: FavoriteSupportType;\n    id: string;\n  } | null {\n    const [type, id] = key.split(':');\n    if (!type || !id) {\n      return null;\n    }\n    if (!isFavoriteSupportType(type)) {\n      return null;\n    }\n    return { type: type as FavoriteSupportType, id };\n  }\n\n  private encodeKey(type: FavoriteSupportType, id: string) {\n    return `${type}:${id}`;\n  }\n}\n","import {\n  type Framework,\n  WorkspaceDBService,\n  WorkspaceScope,\n  WorkspaceService,\n} from '@toeverything/infra';\n\nimport { AuthService } from '../cloud';\nimport { FavoriteList } from './entities/favorite-list';\nimport { FavoriteService } from './services/favorite';\nimport { FavoriteStore } from './stores/favorite';\n\nexport { FavoriteSupportType, isFavoriteSupportType } from './constant';\nexport type { FavoriteList } from './entities/favorite-list';\nexport { FavoriteService } from './services/favorite';\n\nexport function configureFavoriteModule(framework: Framework) {\n  framework\n    .scope(WorkspaceScope)\n    .service(FavoriteService)\n    .entity(FavoriteList, [FavoriteStore])\n    .store(FavoriteStore, [AuthService, WorkspaceDBService, WorkspaceService]);\n}\n","import { DebugLogger } from '@affine/debug';\nimport { apis } from '@affine/electron-api';\nimport { Entity, LiveData } from '@toeverything/infra';\nimport {\n  debounceTime,\n  distinctUntilChanged,\n  of,\n  shareReplay,\n  switchMap,\n  tap,\n} from 'rxjs';\n\nconst logger = new DebugLogger('affine:find-in-page');\n\nexport class FindInPage extends Entity {\n  readonly searchText$ = new LiveData<string | null>(null);\n  readonly isSearching$ = new LiveData(false);\n  private readonly direction$ = new LiveData<'forward' | 'backward'>('forward');\n  readonly visible$ = new LiveData(false);\n\n  readonly result$ = LiveData.from(\n    this.visible$.pipe(\n      distinctUntilChanged(),\n      switchMap(visible => {\n        if (!visible) {\n          return of(null);\n        }\n        let searchId = 0;\n        return this.searchText$.pipe(\n          tap(() => {\n            this.isSearching$.next(false);\n          }),\n          debounceTime(500),\n          switchMap(searchText => {\n            if (!searchText) {\n              return of(null);\n            } else {\n              let findNext = true;\n              return this.direction$.pipe(\n                switchMap(direction => {\n                  if (apis?.findInPage) {\n                    this.isSearching$.next(true);\n                    const currentId = ++searchId;\n                    return apis?.findInPage\n                      .find(searchText, {\n                        forward: direction === 'forward',\n                        findNext,\n                      })\n                      .finally(() => {\n                        if (currentId === searchId) {\n                          this.isSearching$.next(false);\n                          findNext = false;\n                        }\n                      });\n                  } else {\n                    return of(null);\n                  }\n                })\n              );\n            }\n          })\n        );\n      }),\n      shareReplay({\n        bufferSize: 1,\n        refCount: true,\n      })\n    ),\n    null\n  );\n\n  constructor() {\n    super();\n    // TODO(@Peng): hide on navigation\n  }\n\n  findInPage(searchText: string) {\n    this.onChangeVisible(true);\n    this.searchText$.next(searchText);\n  }\n\n  onChangeVisible(visible: boolean) {\n    this.visible$.next(visible);\n    if (!visible) {\n      this.clear();\n    }\n  }\n\n  toggleVisible(text?: string) {\n    const nextVisible = !this.visible$.value;\n    this.visible$.next(nextVisible);\n    if (!nextVisible) {\n      this.clear();\n    } else if (text) {\n      this.searchText$.next(text);\n    }\n  }\n\n  backward() {\n    if (!this.searchText$.value) {\n      return;\n    }\n    this.direction$.next('backward');\n  }\n\n  forward() {\n    if (!this.searchText$.value) {\n      return;\n    }\n    this.direction$.next('forward');\n  }\n\n  clear() {\n    logger.debug('clear');\n    apis?.findInPage.clear().catch(logger.error);\n  }\n}\n","import { Service } from '@toeverything/infra';\n\nimport { FindInPage } from '../entities/find-in-page';\n\nexport class FindInPageService extends Service {\n  public readonly findInPage = this.framework.createEntity(FindInPage);\n}\n","import { Entity, LiveData } from '@toeverything/infra';\nimport type { Location } from 'history';\nimport { Observable, switchMap } from 'rxjs';\n\nimport type { WorkbenchService } from '../../workbench';\n\nexport class Navigator extends Entity {\n  constructor(private readonly workbenchService: WorkbenchService) {\n    super();\n  }\n\n  private readonly history$ = this.workbenchService.workbench.activeView$.map(\n    view => view.history\n  );\n\n  private readonly location$ = LiveData.from(\n    this.history$.pipe(\n      switchMap(\n        history =>\n          new Observable<{ index: number; entries: Location[] }>(subscriber => {\n            subscriber.next({ index: history.index, entries: history.entries });\n            return history.listen(() => {\n              subscriber.next({\n                index: history.index,\n                entries: history.entries,\n              });\n            });\n          })\n      )\n    ),\n    { index: 0, entries: [] }\n  );\n\n  readonly backable$ = this.location$.map(\n    ({ index, entries }) => index > 0 && entries.length > 1\n  );\n\n  readonly forwardable$ = this.location$.map(\n    ({ index, entries }) => index < entries.length - 1\n  );\n\n  back() {\n    if (!environment.isDesktop) {\n      window.history.back();\n    } else {\n      this.history$.value.back();\n    }\n  }\n\n  forward() {\n    if (!environment.isDesktop) {\n      window.history.forward();\n    } else {\n      this.history$.value.forward();\n    }\n  }\n}\n","function maybeAffineOrigin(origin: string) {\n  return (\n    origin.startsWith('file://') ||\n    origin.startsWith('affine://') ||\n    origin.endsWith('affine.pro') || // stable/beta\n    origin.endsWith('affine.fail') || // canary\n    origin.endsWith('313.co.kr') || // canary\n    origin.endsWith('www.313.co.kr') || // canary\n    origin.endsWith('a-rms.net') || // canary\n    origin.endsWith('www.a-rms.net') || // canary\n    origin.endsWith('127.0.0.1') || // canary\n    origin.includes('localhost') // dev\n  );\n}\n\nexport const resolveRouteLinkMeta = (href: string) => {\n  try {\n    const url = new URL(href, location.origin);\n\n    // check if origin is one of affine's origins\n\n    if (!maybeAffineOrigin(url.origin)) {\n      return null;\n    }\n\n    // http://---/workspace/{workspaceid}/xxx/yyy\n    // http://---/workspace/{workspaceid}/xxx\n    const [_, workspaceId, moduleName, subModuleName] =\n      url.pathname.match(/\\/workspace\\/([^/]+)\\/([^/]+)(?:\\/([^/]+))?/) || [];\n\n    if (workspaceId) {\n      const basename = `/workspace/${workspaceId}`;\n      const pathname = url.pathname.replace(basename, '');\n      const search = url.search;\n      const hash = url.hash;\n      const location = {\n        pathname,\n        search,\n        hash,\n      };\n      if (isRouteModulePath(moduleName)) {\n        return {\n          location,\n          basename,\n          workspaceId,\n          moduleName,\n          subModuleName,\n        };\n      } else if (moduleName) {\n        // for now we assume all other cases are doc links\n        return {\n          location,\n          basename,\n          workspaceId,\n          moduleName: 'doc' as const,\n          docId: moduleName,\n          blockId: hash.slice(1),\n        };\n      }\n    }\n    return null;\n  } catch {\n    return null;\n  }\n};\n\n/**\n * @see /packages/frontend/core/src/router.tsx\n */\nexport const routeModulePaths = ['all', 'collection', 'tag', 'trash'] as const;\nexport type RouteModulePath = (typeof routeModulePaths)[number];\n\nconst isRouteModulePath = (\n  path: string\n): path is (typeof routeModulePaths)[number] =>\n  routeModulePaths.includes(path as any);\n\nexport const resolveLinkToDoc = (href: string) => {\n  const meta = resolveRouteLinkMeta(href);\n  if (!meta || meta.moduleName !== 'doc') return null;\n  return {\n    workspaceId: meta.workspaceId,\n    docId: meta.docId,\n    blockId: meta.blockId,\n  };\n};\n","import \"../core/src/modules/navigation/view/navigation-buttons.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/modules/navigation/view/navigation-buttons.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xb283Nzc5MCB7CiAgZGlzcGxheTogZmxleDsKICBhbGlnbi1pdGVtczogY2VudGVyOwogIGNvbHVtbi1nYXA6IDhweDsKfQouXzFvbzc3NzkxIHsKICB3aWR0aDogMzJweDsKICBoZWlnaHQ6IDMycHg7CiAgZmxleC1zaHJpbms6IDA7Cn0=\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var button = '_1oo77791';\nexport var container = '_1oo77790';","import { IconButton } from '@affine/component';\nimport { useI18n } from '@affine/i18n';\nimport { ArrowLeftSmallIcon, ArrowRightSmallIcon } from '@blocksuite/icons/rc';\nimport { useLiveData, useService } from '@toeverything/infra';\nimport { useCallback, useEffect } from 'react';\n\nimport { NavigatorService } from '../services/navigator';\nimport * as styles from './navigation-buttons.css';\n\nconst tooltipSideBottom = { side: 'bottom' as const };\n\nexport const NavigationButtons = () => {\n  const t = useI18n();\n\n  const navigator = useService(NavigatorService).navigator;\n\n  const backable = useLiveData(navigator.backable$);\n  const forwardable = useLiveData(navigator.forwardable$);\n\n  const handleBack = useCallback(() => {\n    navigator.back();\n  }, [navigator]);\n\n  const handleForward = useCallback(() => {\n    navigator.forward();\n  }, [navigator]);\n\n  useEffect(() => {\n    const cb = (event: MouseEvent) => {\n      if (event.button === 3 || event.button === 4) {\n        event.preventDefault();\n        event.stopPropagation();\n\n        if (event.button === 3) {\n          navigator.back();\n        } else {\n          navigator.forward();\n        }\n      }\n    };\n    document.addEventListener('mouseup', cb);\n    return () => {\n      document.removeEventListener('mouseup', cb);\n    };\n  }, [navigator]);\n\n  if (!environment.isDesktop) {\n    return null;\n  }\n\n  return (\n    <div className={styles.container}>\n      <IconButton\n        tooltip={t['Go Back']()}\n        tooltipShortcut={['$mod', '[']}\n        tooltipOptions={tooltipSideBottom}\n        className={styles.button}\n        data-testid=\"app-navigation-button-back\"\n        disabled={!backable}\n        onClick={handleBack}\n        size={24}\n      >\n        <ArrowLeftSmallIcon />\n      </IconButton>\n      <IconButton\n        tooltip={t['Go Forward']()}\n        tooltipShortcut={['$mod', ']']}\n        tooltipOptions={tooltipSideBottom}\n        className={styles.button}\n        data-testid=\"app-navigation-button-forward\"\n        disabled={!forwardable}\n        onClick={handleForward}\n        size={24}\n      >\n        <ArrowRightSmallIcon />\n      </IconButton>\n    </div>\n  );\n};\n","export { Navigator } from './entities/navigator';\nexport { resolveLinkToDoc, resolveRouteLinkMeta } from './utils';\nexport { NavigationButtons } from './view/navigation-buttons';\n\nimport { type Framework, WorkspaceScope } from '@toeverything/infra';\n\nimport { WorkbenchService } from '../workbench';\nimport { Navigator } from './entities/navigator';\nimport { NavigatorService } from './services/navigator';\n\nexport function configureNavigationModule(framework: Framework) {\n  framework\n    .scope(WorkspaceScope)\n    .service(NavigatorService)\n    .entity(Navigator, [WorkbenchService]);\n}\n","import { Service } from '@toeverything/infra';\n\nimport { Navigator } from '../entities/navigator';\n\nexport class NavigatorService extends Service {\n  public readonly navigator = this.framework.createEntity(Navigator);\n}\n","import { generateFractionalIndexingKeyBetween } from '@affine/core/utils';\nimport { Entity, LiveData } from '@toeverything/infra';\nimport { map, of, switchMap } from 'rxjs';\n\nimport type { FolderStore } from '../stores/folder';\n\nexport class FolderNode extends Entity<{\n  id: string | null;\n}> {\n  id = this.props.id;\n\n  info$ = LiveData.from<{\n    data: string;\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    type: (string & {}) | 'folder' | 'doc' | 'tag' | 'collection';\n    index: string;\n    id: string;\n    parentId?: string | null;\n  } | null>(this.store.watchNodeInfo(this.id ?? ''), null);\n  type$ = this.info$.map(info =>\n    this.id === null ? 'folder' : (info?.type ?? '')\n  );\n  data$ = this.info$.map(info => info?.data);\n  name$ = this.info$.map(info => (info?.type === 'folder' ? info.data : ''));\n  children$ = LiveData.from<FolderNode[]>(\n    // watch children if this is a folder, otherwise return empty array\n    this.type$.pipe(\n      switchMap(type =>\n        type === 'folder'\n          ? this.store\n              .watchNodeChildren(this.id)\n              .pipe(\n                map(children =>\n                  children\n                    .filter(e => this.filterInvalidChildren(e))\n                    .map(child =>\n                      this.framework.createEntity(FolderNode, child)\n                    )\n                )\n              )\n              .pipe()\n          : of([])\n      )\n    ),\n    []\n  );\n  sortedChildren$ = LiveData.computed(get => {\n    return get(this.children$)\n      .map(node => [node, get(node.index$)] as const)\n      .sort((a, b) => (a[1] > b[1] ? 1 : -1))\n      .map(([node]) => node);\n  });\n  index$ = this.info$.map(info => info?.index ?? '');\n\n  constructor(readonly store: FolderStore) {\n    super();\n  }\n\n  contains(childId: string | null): boolean {\n    if (!this.id) {\n      return true;\n    }\n    if (!childId) {\n      return false;\n    }\n    return this.store.isAncestor(childId, this.id);\n  }\n\n  beChildOf(parentId: string | null): boolean {\n    if (!this.id) {\n      return false;\n    }\n    if (!parentId) {\n      return true;\n    }\n    return this.store.isAncestor(this.id, parentId);\n  }\n\n  filterInvalidChildren(child: { type: string }): boolean {\n    if (this.id === null && child.type !== 'folder') {\n      return false; // root node can only have folders\n    }\n    return true;\n  }\n\n  createFolder(name: string, index: string) {\n    if (this.type$.value !== 'folder') {\n      throw new Error('Cannot create folder on non-folder node');\n    }\n    return this.store.createFolder(this.id, name, index);\n  }\n\n  createLink(\n    type: 'doc' | 'tag' | 'collection',\n    targetId: string,\n    index: string\n  ) {\n    if (this.id === null) {\n      throw new Error('Cannot create link on root node');\n    }\n    if (this.type$.value !== 'folder') {\n      throw new Error('Cannot create link on non-folder node');\n    }\n    this.store.createLink(this.id, type, targetId, index);\n  }\n\n  delete() {\n    if (this.id === null) {\n      throw new Error('Cannot delete root node');\n    }\n    if (this.type$.value === 'folder') {\n      this.store.removeFolder(this.id);\n    } else {\n      this.store.removeLink(this.id);\n    }\n  }\n\n  moveHere(childId: string, index: string) {\n    this.store.moveNode(childId, this.id, index);\n  }\n\n  rename(name: string) {\n    if (this.id === null) {\n      throw new Error('Cannot rename root node');\n    }\n    this.store.renameNode(this.id, name);\n  }\n\n  indexAt(at: 'before' | 'after', targetId?: string) {\n    if (!targetId) {\n      if (at === 'before') {\n        const first = this.sortedChildren$.value.at(0);\n        return generateFractionalIndexingKeyBetween(\n          null,\n          first?.index$.value || null\n        );\n      } else {\n        const last = this.sortedChildren$.value.at(-1);\n        return generateFractionalIndexingKeyBetween(\n          last?.index$.value || null,\n          null\n        );\n      }\n    } else {\n      const sortedChildren = this.sortedChildren$.value;\n      const targetIndex = sortedChildren.findIndex(\n        node => node.id === targetId\n      );\n      if (targetIndex === -1) {\n        throw new Error('Target node not found');\n      }\n      const target = sortedChildren[targetIndex];\n      const before: FolderNode | null = sortedChildren[targetIndex - 1] || null;\n      const after: FolderNode | null = sortedChildren[targetIndex + 1] || null;\n      if (at === 'before') {\n        return generateFractionalIndexingKeyBetween(\n          before?.index$.value || null,\n          target.index$.value\n        );\n      } else {\n        return generateFractionalIndexingKeyBetween(\n          target.index$.value,\n          after?.index$.value || null\n        );\n      }\n    }\n  }\n}\n","import { Entity, LiveData } from '@toeverything/infra';\nimport { map } from 'rxjs';\n\nimport type { FolderStore } from '../stores/folder';\nimport { FolderNode } from './folder-node';\n\nexport class FolderTree extends Entity {\n  constructor(private readonly folderStore: FolderStore) {\n    super();\n  }\n\n  readonly rootFolder = this.framework.createEntity(FolderNode, {\n    id: null,\n  });\n\n  isLoading$ = this.folderStore.watchIsLoading();\n\n  // get folder by id\n  folderNode$(id: string) {\n    return LiveData.from(\n      this.folderStore.watchNodeInfo(id).pipe(\n        map(info => {\n          if (!info) {\n            return null;\n          }\n          return this.framework.createEntity(FolderNode, {\n            id,\n          });\n        })\n      ),\n      null\n    );\n  }\n}\n","import { Service } from '@toeverything/infra';\n\nimport { FolderTree } from '../entities/folder-tree';\nexport class OrganizeService extends Service {\n  folderTree = this.framework.createEntity(FolderTree);\n}\n","import type { WorkspaceDBService } from '@toeverything/infra';\nimport { Store } from '@toeverything/infra';\n\nexport class FolderStore extends Store {\n  constructor(private readonly dbService: WorkspaceDBService) {\n    super();\n  }\n\n  watchNodeInfo(nodeId: string) {\n    return this.dbService.db.folders.get$(nodeId);\n  }\n\n  watchNodeChildren(parentId: string | null) {\n    return this.dbService.db.folders.find$({\n      parentId: parentId,\n    });\n  }\n\n  watchIsLoading() {\n    return this.dbService.db.folders.isLoading$;\n  }\n\n  isAncestor(childId: string, ancestorId: string): boolean {\n    if (childId === ancestorId) {\n      return false;\n    }\n    const history = new Set<string>([childId]);\n    let current: string = childId;\n    while (current) {\n      const info = this.dbService.db.folders.get(current);\n      if (info === null || !info.parentId) {\n        return false;\n      }\n      current = info.parentId;\n      if (history.has(current)) {\n        return false; // loop detected\n      }\n      history.add(current);\n      if (current === ancestorId) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  createLink(\n    parentId: string,\n    type: 'doc' | 'tag' | 'collection',\n    nodeId: string,\n    index: string\n  ) {\n    const parent = this.dbService.db.folders.get(parentId);\n    if (parent === null || parent.type !== 'folder') {\n      throw new Error('Parent folder not found');\n    }\n\n    this.dbService.db.folders.create({\n      parentId,\n      type,\n      data: nodeId,\n      index: index,\n    });\n  }\n\n  renameNode(nodeId: string, name: string) {\n    const node = this.dbService.db.folders.get(nodeId);\n    if (node === null) {\n      throw new Error('Node not found');\n    }\n    if (node.type !== 'folder') {\n      throw new Error('Cannot rename non-folder node');\n    }\n    this.dbService.db.folders.update(nodeId, {\n      data: name,\n    });\n  }\n\n  createFolder(parentId: string | null, name: string, index: string) {\n    if (parentId) {\n      const parent = this.dbService.db.folders.get(parentId);\n      if (parent === null || parent.type !== 'folder') {\n        throw new Error('Parent folder not found');\n      }\n    }\n\n    return this.dbService.db.folders.create({\n      parentId: parentId,\n      type: 'folder',\n      data: name,\n      index: index,\n    }).id;\n  }\n\n  removeFolder(folderId: string) {\n    const info = this.dbService.db.folders.get(folderId);\n    if (info === null || info.type !== 'folder') {\n      throw new Error('Folder not found');\n    }\n    const stack = [info];\n    while (stack.length > 0) {\n      const current = stack.pop();\n      if (!current) {\n        continue;\n      }\n      if (current.type !== 'folder') {\n        this.dbService.db.folders.delete(current.id);\n      } else {\n        const children = this.dbService.db.folders.find({\n          parentId: current.id,\n        });\n        stack.push(...children);\n        this.dbService.db.folders.delete(current.id);\n      }\n    }\n  }\n\n  removeLink(linkId: string) {\n    const link = this.dbService.db.folders.get(linkId);\n    if (link === null || link.type === 'folder') {\n      throw new Error('Link not found');\n    }\n    this.dbService.db.folders.delete(linkId);\n  }\n\n  moveNode(nodeId: string, parentId: string | null, index: string) {\n    const node = this.dbService.db.folders.get(nodeId);\n    if (node === null) {\n      throw new Error('Node not found');\n    }\n\n    if (parentId) {\n      if (nodeId === parentId) {\n        throw new Error('Cannot move a node to itself');\n      }\n      if (this.isAncestor(parentId, nodeId)) {\n        throw new Error('Cannot move a node to its descendant');\n      }\n      const parent = this.dbService.db.folders.get(parentId);\n      if (parent === null || parent.type !== 'folder') {\n        throw new Error('Parent folder not found');\n      }\n    } else {\n      if (node.type !== 'folder') {\n        throw new Error('Root node can only have folders');\n      }\n    }\n    this.dbService.db.folders.update(nodeId, {\n      parentId,\n      index,\n    });\n  }\n}\n","import {\n  type Framework,\n  WorkspaceDBService,\n  WorkspaceScope,\n} from '@toeverything/infra';\n\nimport { FolderNode } from './entities/folder-node';\nimport { FolderTree } from './entities/folder-tree';\nimport { OrganizeService } from './services/organize';\nimport { FolderStore } from './stores/folder';\n\nexport type { FolderNode } from './entities/folder-node';\nexport { OrganizeService } from './services/organize';\n\nexport function configureOrganizeModule(framework: Framework) {\n  framework\n    .scope(WorkspaceScope)\n    .service(OrganizeService)\n    .entity(FolderTree, [FolderStore])\n    .entity(FolderNode, [FolderStore])\n    .store(FolderStore, [WorkspaceDBService]);\n}\n","import { OnEvent, Service } from '@toeverything/infra';\n\nimport { WorkbenchLocationChanged } from '../../workbench/services/workbench';\nimport { PeekViewEntity } from '../entities/peek-view';\n\n@OnEvent(WorkbenchLocationChanged, e => () => e.peekView.close())\nexport class PeekViewService extends Service {\n  public readonly peekView = this.framework.createEntity(PeekViewEntity);\n}\n","import type { BlockComponent, EditorHost } from '@blocksuite/block-std';\nimport {\n  AffineReference,\n  type EmbedLinkedDocModel,\n  type EmbedSyncedDocModel,\n  type ImageBlockModel,\n  type SurfaceRefBlockComponent,\n  type SurfaceRefBlockModel,\n} from '@blocksuite/blocks';\nimport type { AIChatBlockModel } from '@blocksuite/presets';\nimport type { BlockModel } from '@blocksuite/store';\nimport { type DocMode, Entity, LiveData } from '@toeverything/infra';\nimport type { TemplateResult } from 'lit';\nimport { firstValueFrom, map, race } from 'rxjs';\n\nimport { resolveLinkToDoc } from '../../navigation';\nimport type { WorkbenchService } from '../../workbench';\n\nexport type PeekViewTarget =\n  | HTMLElement\n  | BlockComponent\n  | AffineReference\n  | HTMLAnchorElement\n  | { docId: string; blockId?: string };\n\nexport interface DocPeekViewInfo {\n  type: 'doc';\n  docId: string;\n  blockId?: string;\n  mode?: DocMode;\n  xywh?: `[${number},${number},${number},${number}]`;\n}\n\nexport type ImagePeekViewInfo = {\n  type: 'image';\n  docId: string;\n  blockId: string;\n};\n\nexport type AIChatBlockPeekViewInfo = {\n  type: 'ai-chat-block';\n  docId: string;\n  host: EditorHost;\n  model: AIChatBlockModel;\n};\n\nexport type CustomTemplatePeekViewInfo = {\n  type: 'template';\n  template: TemplateResult;\n};\n\nexport type ActivePeekView = {\n  target: PeekViewTarget;\n  info:\n    | DocPeekViewInfo\n    | ImagePeekViewInfo\n    | CustomTemplatePeekViewInfo\n    | AIChatBlockPeekViewInfo;\n};\n\nconst EMBED_DOC_FLAVOURS = [\n  'affine:embed-linked-doc',\n  'affine:embed-synced-doc',\n];\n\nconst isEmbedDocModel = (\n  blockModel: BlockModel\n): blockModel is EmbedSyncedDocModel | EmbedLinkedDocModel => {\n  return EMBED_DOC_FLAVOURS.includes(blockModel.flavour);\n};\n\nconst isImageBlockModel = (\n  blockModel: BlockModel\n): blockModel is ImageBlockModel => {\n  return blockModel.flavour === 'affine:image';\n};\n\nconst isSurfaceRefModel = (\n  blockModel: BlockModel\n): blockModel is SurfaceRefBlockModel => {\n  return blockModel.flavour === 'affine:surface-ref';\n};\n\nconst isAIChatBlockModel = (\n  blockModel: BlockModel\n): blockModel is AIChatBlockModel => {\n  return blockModel.flavour === 'affine:embed-ai-chat';\n};\n\nfunction resolvePeekInfoFromPeekTarget(\n  peekTarget: PeekViewTarget,\n  template?: TemplateResult\n): ActivePeekView['info'] | undefined {\n  if (template) {\n    return {\n      type: 'template',\n      template,\n    };\n  }\n\n  if (peekTarget instanceof AffineReference) {\n    if (peekTarget.refMeta) {\n      return {\n        type: 'doc',\n        docId: peekTarget.refMeta.id,\n      };\n    }\n  } else if ('model' in peekTarget) {\n    const blockModel = peekTarget.model;\n    if (isEmbedDocModel(blockModel)) {\n      return {\n        type: 'doc',\n        docId: blockModel.pageId,\n      };\n    } else if (isSurfaceRefModel(blockModel)) {\n      const refModel = (peekTarget as SurfaceRefBlockComponent).referenceModel;\n      // refModel can be null if the reference is invalid\n      if (refModel) {\n        const docId =\n          'doc' in refModel ? refModel.doc.id : refModel.surface.doc.id;\n        return {\n          type: 'doc',\n          docId,\n          mode: 'edgeless',\n          xywh: refModel.xywh,\n        };\n      }\n    } else if (isImageBlockModel(blockModel)) {\n      return {\n        type: 'image',\n        docId: blockModel.doc.id,\n        blockId: blockModel.id,\n      };\n    } else if (isAIChatBlockModel(blockModel)) {\n      return {\n        type: 'ai-chat-block',\n        docId: blockModel.doc.id,\n        model: blockModel,\n        host: peekTarget.host,\n      };\n    }\n  } else if (peekTarget instanceof HTMLAnchorElement) {\n    const maybeDoc = resolveLinkToDoc(peekTarget.href);\n    if (maybeDoc) {\n      return {\n        type: 'doc',\n        docId: maybeDoc.docId,\n        blockId: maybeDoc.blockId,\n      };\n    }\n  } else if ('docId' in peekTarget) {\n    return {\n      type: 'doc',\n      docId: peekTarget.docId,\n      blockId: peekTarget.blockId,\n    };\n  }\n  return;\n}\n\nexport type PeekViewAnimation = 'fade' | 'zoom' | 'none';\n\nexport class PeekViewEntity extends Entity {\n  private readonly _active$ = new LiveData<ActivePeekView | null>(null);\n  private readonly _show$ = new LiveData<{\n    animation: PeekViewAnimation;\n    value: boolean;\n  }>({\n    animation: 'zoom',\n    value: false,\n  });\n\n  constructor(private readonly workbenchService: WorkbenchService) {\n    super();\n  }\n\n  active$ = this._active$.distinctUntilChanged();\n  show$ = this._show$\n    .map(show => (this._active$.value !== null ? show : null))\n    .distinctUntilChanged();\n\n  // return true if the peek view will be handled\n  open = async (\n    target: ActivePeekView['target'],\n    template?: TemplateResult\n  ) => {\n    const resolvedInfo = resolvePeekInfoFromPeekTarget(target, template);\n    if (!resolvedInfo) {\n      return;\n    }\n\n    const active = this._active$.value;\n\n    // if there is an active peek view and it is a doc peek view, we will navigate it first\n    if (active?.info.type === 'doc' && this.show$.value?.value) {\n      // TODO(@pengx17): scroll to the viewing position?\n      this.workbenchService.workbench.openDoc(active.info.docId);\n    }\n\n    this._active$.next({ target, info: resolvedInfo });\n    this._show$.next({\n      value: true,\n      animation:\n        resolvedInfo.type === 'doc' || resolvedInfo.type === 'ai-chat-block'\n          ? 'zoom'\n          : 'fade',\n    });\n    return firstValueFrom(race(this._active$, this.show$).pipe(map(() => {})));\n  };\n\n  close = (animation?: PeekViewAnimation) => {\n    this._show$.next({\n      value: false,\n      animation: animation ?? this._show$.value.animation,\n    });\n  };\n}\n","import { useAppSettingHelper } from '@affine/core/hooks/affine/use-app-setting-helper';\nimport * as Dialog from '@radix-ui/react-dialog';\nimport anime, { type AnimeInstance, type AnimeParams } from 'animejs';\nimport clsx from 'clsx';\nimport {\n  createContext,\n  forwardRef,\n  type PropsWithChildren,\n  useCallback,\n  useContext,\n  useEffect,\n  useRef,\n  useState,\n} from 'react';\n\nimport type { PeekViewAnimation } from '../entities/peek-view';\nimport * as styles from './modal-container.css';\n\nconst contentOptions: Dialog.DialogContentProps = {\n  ['data-testid' as string]: 'peek-view-modal',\n  onPointerDownOutside: e => {\n    const el = e.target as HTMLElement;\n    if (\n      el.closest('[data-peek-view-wrapper]') ||\n      // workaround for slash menu click outside issue\n      el.closest('affine-slash-menu')\n    ) {\n      e.preventDefault();\n    }\n  },\n  onEscapeKeyDown: e => {\n    // prevent closing the modal when pressing escape key by default\n    // this is because radix-ui register the escape key event on the document using capture, which is not possible to prevent in blocksuite\n    e.preventDefault();\n  },\n};\n\n// a dummy context to let elements know they are inside a peek view\nexport const PeekViewContext = createContext<Record<string, never> | null>(\n  null\n);\n\nconst emptyContext = {};\n\nexport const useInsidePeekView = () => {\n  const context = useContext(PeekViewContext);\n  return !!context;\n};\n\nexport type PeekViewModalContainerProps = PropsWithChildren<{\n  onOpenChange: (open: boolean) => void;\n  open: boolean;\n  target?: HTMLElement;\n  controls?: React.ReactNode;\n  onAnimationStart?: () => void;\n  onAnimateEnd?: () => void;\n  padding?: boolean;\n  animation?: PeekViewAnimation;\n  testId?: string;\n  /** Whether to apply shadow & bg */\n  dialogFrame?: boolean;\n}>;\n\nconst PeekViewModalOverlay = 'div';\n\nexport const PeekViewModalContainer = forwardRef<\n  HTMLDivElement,\n  PeekViewModalContainerProps\n>(function PeekViewModalContainer(\n  {\n    onOpenChange,\n    open,\n    target,\n    controls,\n    children,\n    onAnimationStart,\n    onAnimateEnd,\n    animation = 'zoom',\n    padding = true,\n    dialogFrame = true,\n  },\n  ref\n) {\n  const [vtOpen, setVtOpen] = useState(open);\n  const [animeState, setAnimeState] = useState<'idle' | 'ready' | 'animating'>(\n    'idle'\n  );\n  const contentClipRef = useRef<HTMLDivElement>(null);\n  const contentRef = useRef<HTMLDivElement>(null);\n  const overlayRef = useRef<HTMLDivElement>(null);\n  const controlsRef = useRef<HTMLDivElement>(null);\n  const prevAnimeMap = useRef<Record<string, AnimeInstance | undefined>>({});\n  const { appSettings } = useAppSettingHelper();\n\n  const animateControls = useCallback((animateIn = false) => {\n    const controls = controlsRef.current;\n    if (!controls) return;\n    anime({\n      targets: controls,\n      opacity: animateIn ? [0, 1] : [1, 0],\n      translateX: animateIn ? [-32, 0] : [0, -32],\n      easing: 'easeOutQuad',\n      duration: 230,\n    });\n  }, []);\n  const zoomAnimate = useCallback(\n    async (\n      zoomIn?: boolean,\n      paramsMap?: {\n        overlay?: AnimeParams;\n        content?: AnimeParams;\n        contentWrapper?: AnimeParams;\n      }\n    ) => {\n      return new Promise<void>(resolve => {\n        const contentClip = contentClipRef.current;\n        const content = contentRef.current;\n        const overlay = overlayRef.current;\n\n        if (!contentClip || !content || !target || !overlay) {\n          resolve();\n          return;\n        }\n        const targets = contentClip;\n        const lockSizeEl = content;\n\n        const from = zoomIn ? target : contentClip;\n        const to = zoomIn ? contentClip : target;\n\n        const fromRect = from.getBoundingClientRect();\n        const toRect = to.getBoundingClientRect();\n\n        targets.style.position = 'fixed';\n        targets.style.opacity = '1';\n        lockSizeEl.style.width = zoomIn\n          ? `${toRect.width}px`\n          : `${fromRect.width}px`;\n        lockSizeEl.style.height = zoomIn\n          ? `${toRect.height}px`\n          : `${fromRect.height}px`;\n        lockSizeEl.style.overflow = 'hidden';\n        overlay.style.pointerEvents = 'none';\n\n        prevAnimeMap.current.overlay?.pause();\n        prevAnimeMap.current.content?.pause();\n        prevAnimeMap.current.contentWrapper?.pause();\n\n        const overlayAnime = anime({\n          targets: overlay,\n          opacity: zoomIn ? [0, 1] : [1, 0],\n          easing: 'easeOutQuad',\n          duration: 230,\n          ...paramsMap?.overlay,\n        });\n\n        const contentAnime =\n          paramsMap?.content &&\n          anime({\n            targets: content,\n            ...paramsMap.content,\n          });\n\n        const contentWrapperAnime = anime({\n          targets,\n          left: [fromRect.left, toRect.left],\n          top: [fromRect.top, toRect.top],\n          width: [fromRect.width, toRect.width],\n          height: [fromRect.height, toRect.height],\n          easing: 'easeOutQuad',\n          duration: 230,\n          ...paramsMap?.contentWrapper,\n          complete: (ins: AnimeInstance) => {\n            paramsMap?.contentWrapper?.complete?.(ins);\n            setAnimeState('idle');\n            overlay.style.pointerEvents = '';\n            if (zoomIn) {\n              Object.assign(targets.style, {\n                position: '',\n                left: '',\n                top: '',\n                width: '',\n                height: '',\n              });\n              Object.assign(lockSizeEl.style, {\n                width: '100%',\n                height: '100%',\n                overflow: '',\n              });\n            }\n            resolve();\n          },\n        });\n\n        prevAnimeMap.current = {\n          overlay: overlayAnime,\n          content: contentAnime,\n          contentWrapper: contentWrapperAnime,\n        };\n      });\n    },\n    [target]\n  );\n  /**\n   * ### Animation timeline:\n   * ```plain\n   *                                      150ms\n   *                                    - - - - \n   * dialog:     +--------400ms--------+\n   * controls:               +-------230ms-------+\n   *              - - - - - \n   *            controls delay =\n   *             400 - 230 + 150\n   * ```\n   */\n  const animateZoomIn = useCallback(() => {\n    setAnimeState('animating');\n    setVtOpen(true);\n    setTimeout(() => {\n      zoomAnimate(true, {\n        contentWrapper: {\n          opacity: [0.5, 1],\n          easing: 'cubicBezier(.46,.36,0,1)',\n          duration: 400,\n        },\n        content: {\n          opacity: [0, 1],\n          duration: 100,\n        },\n      }).catch(console.error);\n    }, 0);\n    setTimeout(\n      () => animateControls(true),\n      // controls delay: to make sure the time interval for animations of dialog and controls is 150ms.\n      400 - 230 + 150\n    );\n  }, [animateControls, zoomAnimate]);\n  const animateZoomOut = useCallback(() => {\n    setAnimeState('animating');\n    animateControls(false);\n    zoomAnimate(false, {\n      contentWrapper: {\n        easing: 'cubicBezier(.57,.25,.76,.44)',\n        opacity: [1, 0.5],\n        duration: 180,\n      },\n      content: {\n        opacity: [1, 0],\n        duration: 180,\n        easing: 'easeOutQuad',\n      },\n    })\n      .then(() => setVtOpen(false))\n      .catch(console.error);\n  }, [animateControls, zoomAnimate]);\n\n  const animateFade = useCallback((animateIn: boolean) => {\n    setAnimeState('animating');\n    return new Promise<void>(resolve => {\n      if (animateIn) setVtOpen(true);\n      setTimeout(() => {\n        const overlay = overlayRef.current;\n        const contentClip = contentClipRef.current;\n        if (!overlay || !contentClip) {\n          resolve();\n          return;\n        }\n        anime({\n          targets: [overlay, contentClip],\n          opacity: animateIn ? [0, 1] : [1, 0],\n          easing: 'easeOutQuad',\n          duration: 230,\n          complete: () => {\n            if (!animateIn) setVtOpen(false);\n            setAnimeState('idle');\n            resolve();\n          },\n        });\n      });\n    });\n  }, []);\n\n  useEffect(() => {\n    const onKeyDown = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        onOpenChange(false);\n      }\n    };\n    document.addEventListener('keydown', onKeyDown);\n    return () => {\n      document.removeEventListener('keydown', onKeyDown);\n    };\n  }, [onOpenChange]);\n\n  useEffect(() => {\n    if (animation === 'zoom') {\n      open ? animateZoomIn() : animateZoomOut();\n    } else if (animation === 'fade') {\n      animateFade(open).catch(console.error);\n    } else if (animation === 'none') {\n      setVtOpen(open);\n    }\n  }, [animateZoomOut, animation, open, target, animateZoomIn, animateFade]);\n\n  return (\n    <PeekViewContext.Provider value={emptyContext}>\n      <Dialog.Root modal open={vtOpen} onOpenChange={onOpenChange}>\n        <Dialog.Portal>\n          <PeekViewModalOverlay\n            ref={overlayRef}\n            className={styles.modalOverlay}\n            onAnimationStart={onAnimationStart}\n            onAnimationEnd={onAnimateEnd}\n            data-anime-state={animeState}\n          />\n          <div\n            ref={ref}\n            data-padding={padding}\n            data-peek-view-wrapper\n            className={clsx(styles.modalContentWrapper)}\n          >\n            <div\n              data-anime-state={animeState}\n              data-full-width-layout={appSettings.fullWidthLayout}\n              ref={contentClipRef}\n              className={styles.modalContentContainer}\n            >\n              <div className={styles.modalContentClip}>\n                <Dialog.Content\n                  {...contentOptions}\n                  className={clsx({\n                    [styles.modalContent]: true,\n                    [styles.dialog]: dialogFrame,\n                  })}\n                >\n                  <Dialog.Title style={{ display: 'none' }} />\n                  <div style={{ height: '100%' }} ref={contentRef}>\n                    {children}\n                  </div>\n                </Dialog.Content>\n              </div>\n              {controls ? (\n                <div\n                  // initially hide the controls to prevent flickering for zoom animation\n                  style={{ opacity: animation === 'zoom' ? 0 : undefined }}\n                  ref={controlsRef}\n                  className={styles.modalControls}\n                >\n                  {controls}\n                </div>\n              ) : null}\n            </div>\n          </div>\n        </Dialog.Portal>\n      </Dialog.Root>\n    </PeekViewContext.Provider>\n  );\n});\n","import \"../core/src/modules/peek-view/view/modal-container.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/modules/peek-view/view/modal-container.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACq1U227bMAx9z1cQAQa0DyrsJgsKFfmSIRgYi47ZyJQnyamzYf8+yHYbJ0vRYNibxMvhIXWoh+95/UMo+Ax+zQAaFziyEw0ld2SeZwAsgaKGLJ1/KhZDnYYD+julsCxZSI1WVTuD9j7FbbHY77xrxajCWecvErYWi71aZH1s41gieUUHkhg0YBvd8+z37OGd2TeDERUK16RCxEjrebpgZNnNNz1v12DB8djTnKTmtzRlODQWjxpKS10yoOWdKI5UBw0FJXbJ/NKGyOVRFU4iSZy6bpvLhNhjT+yVTaw05Fn2JaFUxLsqnu4n3p4sRj7Qf6K7dd6QVx4Nt0FD/th0id0w5waNYdmt59G3NN/Adc4F2uIuEQUFq2XT3U8buOoccZUfYpZPQ9ET/L8/8+KWaV40zVKR55g87kC+tO5VQ8XGkJxhL3vszwR9cicwi0fVoJAdgoeVcJ0KFZpU5ix3MKrFuUC+DmU/5PxJs0kbKlSeZT+q/O8mAWoW9Za5yLKml5Nro2UhDeKEPpLhlOnwbuJUv8dYpNh1Es9m3L7z/R5gJwCriyXFbXC2jX3tUSx9B9E1l9+Qyt/aGOcxqOpdbBqemg4yyCBfjY7rv80f6v2d0wcFAAA=\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var dialog = '_1mqnesr4';\nexport var modalContent = '_1mqnesr5';\nexport var modalContentClip = '_1mqnesr3';\nexport var modalContentContainer = '_1mqnesr2';\nexport var modalContentWrapper = '_1mqnesr1';\nexport var modalControls = '_1mqnesr6';\nexport var modalOverlay = '_1mqnesr0';","import type { Doc } from '@toeverything/infra';\nimport {\n  DocsService,\n  useLiveData,\n  useService,\n  WorkspaceService,\n} from '@toeverything/infra';\nimport { useEffect, useLayoutEffect, useState } from 'react';\n\nexport const useDoc = (pageId: string) => {\n  const currentWorkspace = useService(WorkspaceService).workspace;\n  const docsService = useService(DocsService);\n  const docRecordList = docsService.list;\n  const docListReady = useLiveData(docRecordList.isReady$);\n  const docRecord = docRecordList.doc$(pageId).value;\n\n  const [doc, setDoc] = useState<Doc | null>(null);\n\n  useLayoutEffect(() => {\n    if (!docRecord) {\n      return;\n    }\n    const { doc: opened, release } = docsService.open(pageId);\n    setDoc(opened);\n    return () => {\n      release();\n    };\n  }, [docRecord, docsService, pageId]);\n\n  // set sync engine priority target\n  useEffect(() => {\n    currentWorkspace.engine.doc.setPriority(pageId, 10);\n    return () => {\n      currentWorkspace.engine.doc.setPriority(pageId, 5);\n    };\n  }, [currentWorkspace, pageId]);\n\n  return { doc, workspace: currentWorkspace, loading: !docListReady };\n};\n","import { Scrollable } from '@affine/component';\nimport { PageDetailSkeleton } from '@affine/component/page-detail-skeleton';\nimport { AIProvider } from '@affine/core/blocksuite/presets/ai';\nimport { AffineErrorBoundary } from '@affine/core/components/affine/affine-error-boundary';\nimport { BlockSuiteEditor } from '@affine/core/components/blocksuite/block-suite-editor';\nimport { EditorOutlineViewer } from '@affine/core/components/blocksuite/outline-viewer';\nimport { useNavigateHelper } from '@affine/core/hooks/use-navigate-helper';\nimport { PageNotFound } from '@affine/core/pages/404';\nimport { DebugLogger } from '@affine/debug';\nimport { type EdgelessRootService } from '@blocksuite/blocks';\nimport { Bound, DisposableGroup } from '@blocksuite/global/utils';\nimport type { AffineEditorContainer } from '@blocksuite/presets';\nimport type { DocMode } from '@toeverything/infra';\nimport { DocsService, FrameworkScope, useService } from '@toeverything/infra';\nimport clsx from 'clsx';\nimport { useCallback, useEffect, useState } from 'react';\n\nimport { WorkbenchService } from '../../../workbench';\nimport { PeekViewService } from '../../services/peek-view';\nimport { useDoc } from '../utils';\nimport * as styles from './doc-peek-view.css';\n\nconst logger = new DebugLogger('doc-peek-view');\n\nfunction fitViewport(\n  editor: AffineEditorContainer,\n  xywh?: `[${number},${number},${number},${number}]`\n) {\n  try {\n    if (!editor.host) {\n      throw new Error('editor host is not ready');\n    }\n\n    const rootService =\n      editor.host.std.spec.getService<EdgelessRootService>('affine:page');\n    rootService.viewport.onResize();\n\n    if (xywh) {\n      const viewport = {\n        xywh: xywh,\n        padding: [60, 20, 20, 20] as [number, number, number, number],\n      };\n      rootService.viewport.setViewportByBound(\n        Bound.deserialize(viewport.xywh),\n        viewport.padding,\n        false\n      );\n    } else {\n      const data = rootService.getFitToScreenData();\n      rootService.viewport.setViewport(\n        data.zoom,\n        [data.centerX, data.centerY],\n        false\n      );\n    }\n  } catch (e) {\n    logger.warn('failed to fitViewPort', e);\n  }\n}\n\nexport function DocPeekPreview({\n  docId,\n  blockId,\n  mode,\n  xywh,\n}: {\n  docId: string;\n  blockId?: string;\n  mode?: DocMode;\n  xywh?: `[${number},${number},${number},${number}]`;\n}) {\n  const { doc, workspace, loading } = useDoc(docId);\n  const { jumpToTag } = useNavigateHelper();\n  const workbench = useService(WorkbenchService).workbench;\n  const peekView = useService(PeekViewService).peekView;\n  const [editor, setEditor] = useState<AffineEditorContainer | null>(null);\n\n  const onRef = (editor: AffineEditorContainer) => {\n    setEditor(editor);\n  };\n\n  const docs = useService(DocsService);\n  const [resolvedMode, setResolvedMode] = useState<DocMode | undefined>(mode);\n\n  useEffect(() => {\n    editor?.updateComplete\n      .then(() => {\n        if (resolvedMode === 'edgeless') {\n          fitViewport(editor, xywh);\n        }\n      })\n      .catch(console.error);\n    return;\n  }, [editor, resolvedMode, xywh]);\n\n  useEffect(() => {\n    if (!mode || !resolvedMode) {\n      setResolvedMode(docs.list.doc$(docId).value?.mode$.value || 'page');\n    }\n  }, [docId, docs.list, resolvedMode, mode]);\n\n  useEffect(() => {\n    const disposable = AIProvider.slots.requestOpenWithChat.on(() => {\n      if (doc) {\n        workbench.openDoc(doc.id);\n        peekView.close();\n        // chat panel open is already handled in <DetailPageImpl />\n      }\n    });\n\n    return () => {\n      disposable.dispose();\n    };\n  }, [doc, peekView, workbench, workspace.id]);\n\n  useEffect(() => {\n    const disposableGroup = new DisposableGroup();\n    if (editor) {\n      editor.updateComplete\n        .then(() => {\n          if (!editor.host) {\n            return;\n          }\n\n          const rootService = editor.host.std.spec.getService('affine:page');\n          // doc change event inside peek view should be handled by peek view\n          disposableGroup.add(\n            rootService.slots.docLinkClicked.on(({ docId, blockId }) => {\n              peekView.open({ docId, blockId }).catch(console.error);\n            })\n          );\n          // TODO(@Peng): no tag peek view yet\n          disposableGroup.add(\n            rootService.slots.tagClicked.on(({ tagId }) => {\n              jumpToTag(workspace.id, tagId);\n              peekView.close();\n            })\n          );\n        })\n        .catch(console.error);\n    }\n    return () => {\n      disposableGroup.dispose();\n    };\n  }, [editor, jumpToTag, peekView, workspace.id]);\n\n  const openOutlinePanel = useCallback(() => {\n    workbench.openDoc(docId);\n    workbench.openSidebar();\n    workbench.activeView$.value.activeSidebarTab('outline');\n    peekView.close();\n  }, [docId, peekView, workbench]);\n\n  // if sync engine has been synced and the page is null, show 404 page.\n  if (!doc || !resolvedMode) {\n    return loading || !resolvedMode ? (\n      <PageDetailSkeleton key=\"current-page-is-null\" />\n    ) : (\n      <PageNotFound noPermission />\n    );\n  }\n\n  return (\n    <AffineErrorBoundary>\n      <Scrollable.Root>\n        <Scrollable.Viewport\n          className={clsx('affine-page-viewport', styles.affineDocViewport)}\n        >\n          <FrameworkScope scope={doc.scope}>\n            <BlockSuiteEditor\n              ref={onRef}\n              className={styles.editor}\n              mode={resolvedMode}\n              defaultSelectedBlockId={blockId}\n              page={doc.blockSuiteDoc}\n            />\n          </FrameworkScope>\n          <EditorOutlineViewer\n            editor={editor}\n            show={resolvedMode === 'page'}\n            openOutlinePanel={openOutlinePanel}\n          />\n        </Scrollable.Viewport>\n\n        <Scrollable.Scrollbar />\n      </Scrollable.Root>\n    </AffineErrorBoundary>\n  );\n}\n","import \"../core/src/modules/peek-view/view/doc-preview/doc-peek-view.css.ts.vanilla.css!=!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/modules/peek-view/view/doc-preview/doc-peek-view.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xcjd0Ym5pMCB7CiAgY29udGFpbmVyLXR5cGU6IGlubGluZS1zaXplOwp9Ci5fMXI3dGJuaTEgewogIC0tYWZmaW5lLWVkaXRvci1zaWRlLXBhZGRpbmc6IDE2MHB4OwogIG1pbi1oZWlnaHQ6IDEwMCU7Cn0KW2RhdGEtZnVsbC13aWR0aC1sYXlvdXQ9InRydWUiXSAuXzFyN3RibmkxIHsKICAtLWFmZmluZS1lZGl0b3Itd2lkdGg6IDEwMCU7CiAgLS1hZmZpbmUtZWRpdG9yLXNpZGUtcGFkZGluZzogMjRweDsKfQouXzFyN3RibmkyIHsKICBkaXNwbGF5OiBmbGV4OwogIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgdXNlci1zZWxlY3Q6IG5vbmU7CiAgY29udGFpbmVyLW5hbWU6IHZpZXdwb3J0OwogIGNvbnRhaW5lci10eXBlOiBpbmxpbmUtc2l6ZTsKICBiYWNrZ3JvdW5kOiB2YXIoLS1hZmZpbmUtYmFja2dyb3VuZC1wcmltYXJ5LWNvbG9yKTsKfQ==\\\"}!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var affineDocViewport = '_1r7tbni2';\nexport var editor = '_1r7tbni1';\nexport var root = '_1r7tbni0';","import type { MouseEvent as ReactMouseEvent, RefObject } from 'react';\nimport { useCallback, useEffect, useState } from 'react';\n\ninterface UseZoomControlsProps {\n  zoomRef: RefObject<HTMLDivElement>;\n  imageRef: RefObject<HTMLImageElement>;\n}\n\nexport const useZoomControls = ({\n  zoomRef,\n  imageRef,\n}: UseZoomControlsProps) => {\n  const [currentScale, setCurrentScale] = useState<number>(1);\n  const [isZoomedBigger, setIsZoomedBigger] = useState<boolean>(false);\n  const [isDragging, setIsDragging] = useState<boolean>(false);\n  const [mouseX, setMouseX] = useState<number>(0);\n  const [mouseY, setMouseY] = useState<number>(0);\n  const [dragBeforeX, setDragBeforeX] = useState<number>(0);\n  const [dragBeforeY, setDragBeforeY] = useState<number>(0);\n  const [imagePos, setImagePos] = useState<{ x: number; y: number }>({\n    x: 0,\n    y: 0,\n  });\n\n  const handleDragStart = useCallback(\n    (event: ReactMouseEvent) => {\n      event?.preventDefault();\n      setIsDragging(true);\n      const image = imageRef.current;\n      if (image && isZoomedBigger) {\n        image.style.cursor = 'grab';\n        const rect = image.getBoundingClientRect();\n        setDragBeforeX(rect.left);\n        setDragBeforeY(rect.top);\n        setMouseX(event.clientX);\n        setMouseY(event.clientY);\n      }\n    },\n    [imageRef, isZoomedBigger]\n  );\n\n  const handleDrag = useCallback(\n    (event: ReactMouseEvent) => {\n      event?.preventDefault();\n      const image = imageRef.current;\n\n      if (isDragging && image && isZoomedBigger) {\n        image.style.cursor = 'grabbing';\n        const currentX = imagePos.x;\n        const currentY = imagePos.y;\n        const newPosX = currentX + event.clientX - mouseX;\n        const newPosY = currentY + event.clientY - mouseY;\n        image.style.transform = `translate(${newPosX}px, ${newPosY}px)`;\n      }\n    },\n    [\n      imagePos.x,\n      imagePos.y,\n      imageRef,\n      isDragging,\n      isZoomedBigger,\n      mouseX,\n      mouseY,\n    ]\n  );\n\n  const dragEndImpl = useCallback(() => {\n    setIsDragging(false);\n\n    const image = imageRef.current;\n    if (image && isZoomedBigger && isDragging) {\n      image.style.cursor = 'pointer';\n      const rect = image.getBoundingClientRect();\n      const newPos = { x: rect.left, y: rect.top };\n      const currentX = imagePos.x;\n      const currentY = imagePos.y;\n      const newPosX = currentX + newPos.x - dragBeforeX;\n      const newPosY = currentY + newPos.y - dragBeforeY;\n      setImagePos({ x: newPosX, y: newPosY });\n    }\n  }, [\n    dragBeforeX,\n    dragBeforeY,\n    imagePos.x,\n    imagePos.y,\n    imageRef,\n    isDragging,\n    isZoomedBigger,\n  ]);\n\n  const handleDragEnd = useCallback(\n    (event: ReactMouseEvent) => {\n      event.preventDefault();\n      dragEndImpl();\n    },\n    [dragEndImpl]\n  );\n\n  const handleMouseUp = useCallback(\n    (evt: MouseEvent) => {\n      evt.preventDefault();\n      if (isDragging) {\n        dragEndImpl();\n      }\n    },\n    [isDragging, dragEndImpl]\n  );\n\n  const checkZoomSize = useCallback(() => {\n    const { current: zoomArea } = zoomRef;\n    if (zoomArea) {\n      const image = zoomArea.querySelector('img');\n      if (image) {\n        const zoomedWidth = image.naturalWidth * currentScale;\n        const zoomedHeight = image.naturalHeight * currentScale;\n        const containerWidth = window.innerWidth;\n        const containerHeight = window.innerHeight;\n        setIsZoomedBigger(\n          zoomedWidth > containerWidth || zoomedHeight > containerHeight\n        );\n      }\n    }\n  }, [currentScale, zoomRef]);\n\n  const zoomIn = useCallback(() => {\n    const image = imageRef.current;\n\n    if (image && currentScale < 2) {\n      const newScale = currentScale + 0.1;\n      setCurrentScale(newScale);\n      image.style.width = `${image.naturalWidth * newScale}px`;\n      image.style.height = `${image.naturalHeight * newScale}px`;\n    }\n  }, [imageRef, currentScale]);\n\n  const zoomOut = useCallback(() => {\n    const image = imageRef.current;\n    if (image && currentScale > 0.2) {\n      const newScale = currentScale - 0.1;\n      setCurrentScale(newScale);\n      image.style.width = `${image.naturalWidth * newScale}px`;\n      image.style.height = `${image.naturalHeight * newScale}px`;\n      const zoomedWidth = image.naturalWidth * newScale;\n      const zoomedHeight = image.naturalHeight * newScale;\n      const containerWidth = window.innerWidth;\n      const containerHeight = window.innerHeight;\n      if (zoomedWidth > containerWidth || zoomedHeight > containerHeight) {\n        image.style.transform = `translate(0px, 0px)`;\n        setImagePos({ x: 0, y: 0 });\n      }\n    }\n  }, [imageRef, currentScale]);\n\n  const resetZoom = useCallback(() => {\n    const image = imageRef.current;\n    if (image) {\n      const viewportWidth = window.innerWidth;\n      const viewportHeight = window.innerHeight;\n      const margin = 0.2;\n\n      const availableWidth = viewportWidth * (1 - margin);\n      const availableHeight = viewportHeight * (1 - margin);\n\n      const widthRatio = availableWidth / image.naturalWidth;\n      const heightRatio = availableHeight / image.naturalHeight;\n\n      const newScale = Math.min(widthRatio, heightRatio);\n      setCurrentScale(newScale);\n      image.style.width = `${image.naturalWidth * newScale}px`;\n      image.style.height = `${image.naturalHeight * newScale}px`;\n      image.style.transform = 'translate(0px, 0px)';\n      setImagePos({ x: 0, y: 0 });\n      checkZoomSize();\n    }\n  }, [imageRef, checkZoomSize]);\n\n  const resetScale = useCallback(() => {\n    const image = imageRef.current;\n    if (image) {\n      setCurrentScale(1);\n      image.style.width = `${image.naturalWidth}px`;\n      image.style.height = `${image.naturalHeight}px`;\n      image.style.transform = 'translate(0px, 0px)';\n      setImagePos({ x: 0, y: 0 });\n    }\n  }, [imageRef]);\n\n  useEffect(() => {\n    const handleScroll = (event: WheelEvent) => {\n      event.preventDefault();\n      const { deltaY } = event;\n      if (deltaY > 0) {\n        zoomOut();\n      } else if (deltaY < 0 && currentScale < 2) {\n        zoomIn();\n      }\n    };\n\n    const handleResize = (event: UIEvent) => {\n      event.preventDefault();\n      checkZoomSize();\n    };\n\n    checkZoomSize();\n\n    window.addEventListener('wheel', handleScroll, { passive: false });\n    window.addEventListener('resize', handleResize);\n    window.addEventListener('mouseup', handleMouseUp);\n\n    return () => {\n      window.removeEventListener('wheel', handleScroll);\n      window.removeEventListener('resize', handleResize);\n      window.removeEventListener('mouseup', handleMouseUp);\n    };\n  }, [zoomIn, zoomOut, checkZoomSize, handleMouseUp, currentScale]);\n\n  return {\n    zoomIn,\n    zoomOut,\n    resetZoom,\n    resetScale,\n    isZoomedBigger,\n    currentScale,\n    handleDragStart,\n    handleDrag,\n    handleDragEnd,\n  };\n};\n","import \"../core/src/modules/peek-view/view/image-preview/index.css.ts.vanilla.css!=!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/modules/peek-view/view/image-preview/index.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACq1V247aMBB95yumD5V2pRolAQJ1X/orTjwEt4kd2c6S3Yp/r+w4NyDstlqBIJ6Mx2fmzBmvTZTmL4cI/qwATiiKk6UQR9HXHysALkxdslcKxxJbZ2ClKCQRFitDIUdpUTvzr8ZYcXwluZIWpR1fXVbrLn7s49fKCCuUpMAyo8rGotstpEFLIXLPZ8HtaQQwBzRESx5Eu8Hs/gkXGvPOOVdlU8mHsBcT7fFs0rqdwO2XmdIcNdGMi8Y41J3ZqppCtN5prNxSdzFGQ8by34VWjeQUXph+IoQdj0IiOZ+ExecxMgWppM+yZpwLWUyj5I02SlOolejh5qp0lllMkStJ/Asf2Gom+zKOOCBaJwaQGSRCEtVY5/pGhOTYUojdqmK6EJL43DaHLtFgCwl21oG0jSftHqQxzfuUHpW0xIg3pJCGkpZuX89Gb/R+52DMVMmdUdUsF/bVVSqZVw7iXbfvpnID5q3HfNNS1zoZKpPcbStTsxxJhvaMKBe7azh0d//Q5T5eaNYpX0Pw9JOCNwY1MVhibvuuHM7Yf4Dpafsk21mjHGazqNdWxVoS5OYeQ3GvGA2+N+n9u9ILVlM43JX1dmr1CqxbMKoUfJ5s2DZqbdQXeVycTLXEnBhXZwpR3bq0IHY/bqGLjD1F3yB81/F23CPefCFCmiRT7QfHwCM6v99vmf+fnkmoYCVkT+kmmAYu47qFZCLrTv7xvFOYRxZCeB7uqXNxvN4Q9Hn3XTbr4eRBdpMi7KKFhN+lEL6IqlbaMqeIEQQ9qRfUHso7vecdh0oMEfJPmhbjXD+KFnnXr9aqikISRDadocP53J8/kX56SJcLMhHQhPKgF/9Z73fPcyKi2c01gIpnfYYexniTXF+c4Q1c35mX1c8KuWBgco0ogUkOT5Ns9umhbp998NnsX6zjZfTcB0+LrSXefe54+QtayFhe2gkAAA==\\\"}!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var captionStyle = 's06cv8d';\nexport var cursorStyle = 's06cv89';\nexport var dividerStyle = 's06cv8a';\nexport var imageBottomContainerStyle = 's06cv8c';\nexport var imageNavigationControlStyle = 's06cv84';\nexport var imagePreviewActionBarStyle = 's06cv88';\nexport var imagePreviewModalCaptionStyle = 's06cv87';\nexport var imagePreviewModalCenterStyle = 's06cv86';\nexport var imagePreviewModalCloseButtonStyle = 's06cv82';\nexport var imagePreviewModalContainerStyle = 's06cv85';\nexport var imagePreviewModalGoStyle = 's06cv83';\nexport var imagePreviewModalStyle = 's06cv80';\nexport var imagePreviewTrap = 's06cv81';\nexport var scaleIndicatorButtonStyle = 's06cv8b';\nexport var suspenseFallbackStyle = 's06cv8e';","import { toast } from '@affine/component';\nimport { Button, IconButton } from '@affine/component/ui/button';\nimport { useAsyncCallback } from '@affine/core/hooks/affine-async-hooks';\nimport type { ImageBlockModel } from '@blocksuite/blocks';\nimport { assertExists } from '@blocksuite/global/utils';\nimport {\n  ArrowLeftSmallIcon,\n  ArrowRightSmallIcon,\n  CloseIcon,\n  CopyIcon,\n  DeleteIcon,\n  DownloadIcon,\n  MinusIcon,\n  PlusIcon,\n  ViewBarIcon,\n} from '@blocksuite/icons/rc';\nimport type { BlockModel } from '@blocksuite/store';\nimport { useService } from '@toeverything/infra';\nimport clsx from 'clsx';\nimport { fileTypeFromBuffer } from 'file-type';\nimport { useErrorBoundary } from 'foxact/use-error-boundary';\nimport type { PropsWithChildren, ReactElement } from 'react';\nimport {\n  Suspense,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport type { FallbackProps } from 'react-error-boundary';\nimport { ErrorBoundary } from 'react-error-boundary';\nimport useSWR from 'swr';\n\nimport { PeekViewService } from '../../services/peek-view';\nimport { useDoc } from '../utils';\nimport { useZoomControls } from './hooks/use-zoom';\nimport * as styles from './index.css';\n\nconst filterImageBlock = (block: BlockModel): block is ImageBlockModel => {\n  return block.flavour === 'affine:image';\n};\n\nasync function imageUrlToBlob(url: string): Promise<Blob | undefined> {\n  const buffer = await fetch(url).then(response => {\n    return response.arrayBuffer();\n  });\n\n  if (!buffer) {\n    console.warn('Could not get blob');\n    return;\n  }\n  try {\n    const type = await fileTypeFromBuffer(buffer);\n    if (!type) {\n      return;\n    }\n    const blob = new Blob([buffer], { type: type.mime });\n    return blob;\n  } catch (error) {\n    console.error('Error converting image to blob', error);\n  }\n  return;\n}\n\nasync function copyImageToClipboard(url: string) {\n  const blob = await imageUrlToBlob(url);\n  if (!blob) {\n    return;\n  }\n  try {\n    await navigator.clipboard.write([new ClipboardItem({ [blob.type]: blob })]);\n    console.log('Image copied to clipboard');\n    toast('Copied to clipboard.');\n  } catch (error) {\n    console.error('Error copying image to clipboard', error);\n  }\n}\n\nasync function saveBufferToFile(url: string, filename: string) {\n  // given input url may not have correct mime type\n  const blob = await imageUrlToBlob(url);\n  if (!blob) {\n    return;\n  }\n\n  const blobUrl = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.href = blobUrl;\n  a.download = filename;\n  document.body.append(a);\n  a.click();\n  a.remove();\n  URL.revokeObjectURL(blobUrl);\n}\n\nexport type ImagePreviewModalProps = {\n  docId: string;\n  blockId: string;\n};\n\nconst ImagePreviewModalImpl = ({\n  docId,\n  blockId,\n  onBlockIdChange,\n  onClose,\n}: ImagePreviewModalProps & {\n  onBlockIdChange: (blockId: string) => void;\n  onClose: () => void;\n}): ReactElement | null => {\n  const { doc, workspace } = useDoc(docId);\n  const blocksuiteDoc = doc?.blockSuiteDoc;\n  const docCollection = workspace.docCollection;\n  const blockModel = useMemo(() => {\n    const block = blocksuiteDoc?.getBlock(blockId);\n    if (!block) {\n      return null;\n    }\n    return block.model as ImageBlockModel;\n  }, [blockId, blocksuiteDoc]);\n  const caption = useMemo(() => {\n    return blockModel?.caption ?? '';\n  }, [blockModel?.caption]);\n  const [blocks, setBlocks] = useState<ImageBlockModel[]>([]);\n  const [cursor, setCursor] = useState(0);\n  const zoomRef = useRef<HTMLDivElement | null>(null);\n  const imageRef = useRef<HTMLImageElement | null>(null);\n  const {\n    isZoomedBigger,\n    handleDrag,\n    handleDragStart,\n    handleDragEnd,\n    resetZoom,\n    zoomIn,\n    zoomOut,\n    resetScale,\n    currentScale,\n  } = useZoomControls({ zoomRef, imageRef });\n\n  const goto = useCallback(\n    (index: number) => {\n      const page = docCollection.getDoc(docId);\n      assertExists(page);\n\n      const block = blocks[index];\n\n      if (!block) return;\n\n      setCursor(index);\n      onBlockIdChange(block.id);\n      resetZoom();\n    },\n    [docCollection, docId, blocks, onBlockIdChange, resetZoom]\n  );\n\n  const deleteHandler = useCallback(\n    (index: number) => {\n      if (!blocksuiteDoc) {\n        return;\n      }\n\n      let block = blocks[index];\n\n      if (!block) return;\n      const newBlocks = blocks.toSpliced(index, 1);\n      setBlocks(newBlocks);\n\n      blocksuiteDoc.deleteBlock(block);\n\n      // next\n      block = newBlocks[index];\n\n      // prev\n      if (!block) {\n        index -= 1;\n        block = newBlocks[index];\n\n        if (!block) {\n          onClose();\n          return;\n        }\n\n        setCursor(index);\n      }\n\n      onBlockIdChange(block.id);\n\n      resetZoom();\n    },\n    [blocksuiteDoc, blocks, onBlockIdChange, resetZoom, onClose]\n  );\n\n  const downloadHandler = useAsyncCallback(async () => {\n    const url = imageRef.current?.src;\n    if (url) {\n      await saveBufferToFile(url, caption || blockModel?.id || 'image');\n    }\n  }, [caption, blockModel?.id]);\n\n  const copyHandler = useAsyncCallback(async () => {\n    const url = imageRef.current?.src;\n    if (url) {\n      await copyImageToClipboard(url);\n    }\n  }, []);\n\n  useEffect(() => {\n    if (!blockModel || !blocksuiteDoc) {\n      return;\n    }\n\n    const prevs = blocksuiteDoc.getPrevs(blockModel).filter(filterImageBlock);\n    const nexts = blocksuiteDoc.getNexts(blockModel).filter(filterImageBlock);\n\n    const blocks = [...prevs, blockModel, ...nexts];\n    setBlocks(blocks);\n    setCursor(blocks.length ? prevs.length : 0);\n  }, [setBlocks, blockModel, blocksuiteDoc]);\n\n  const { data, error } = useSWR(['workspace', 'image', docId, blockId], {\n    fetcher: ([_, __, pageId, blockId]) => {\n      const page = docCollection.getDoc(pageId);\n      assertExists(page);\n\n      const block = page.getBlock(blockId);\n      if (!block) {\n        return null;\n      }\n      const blockModel = block.model as ImageBlockModel;\n      return docCollection.blobSync.get(blockModel.sourceId as string);\n    },\n    suspense: true,\n  });\n\n  useEffect(() => {\n    const handleKeyUp = (event: KeyboardEvent) => {\n      if (!blocksuiteDoc || !blockModel) {\n        return;\n      }\n\n      if (event.key === 'ArrowLeft') {\n        const prevBlock = blocksuiteDoc\n          .getPrevs(blockModel)\n          .findLast(\n            (block): block is ImageBlockModel =>\n              block.flavour === 'affine:image'\n          );\n        if (prevBlock) {\n          onBlockIdChange(prevBlock.id);\n        }\n      } else if (event.key === 'ArrowRight') {\n        const nextBlock = blocksuiteDoc\n          .getNexts(blockModel)\n          .find(\n            (block): block is ImageBlockModel =>\n              block.flavour === 'affine:image'\n          );\n        if (nextBlock) {\n          onBlockIdChange(nextBlock.id);\n        }\n      } else {\n        return;\n      }\n      event.preventDefault();\n      event.stopPropagation();\n    };\n\n    document.addEventListener('keyup', handleKeyUp);\n    return () => {\n      document.removeEventListener('keyup', handleKeyUp);\n    };\n  }, [blockModel, blocksuiteDoc, onBlockIdChange]);\n\n  useErrorBoundary(error);\n\n  const [prevData, setPrevData] = useState<string | null>(() => data);\n  const [url, setUrl] = useState<string | null>(null);\n\n  if (data === null) {\n    return null;\n  } else if (prevData !== data) {\n    if (url) {\n      URL.revokeObjectURL(url);\n    }\n    setUrl(URL.createObjectURL(data));\n\n    setPrevData(data);\n  } else if (!url) {\n    setUrl(URL.createObjectURL(data));\n  }\n  if (!url) {\n    return null;\n  }\n  return (\n    <div\n      data-testid=\"image-preview-modal\"\n      className={styles.imagePreviewModalStyle}\n    >\n      <div className={styles.imagePreviewTrap} onClick={onClose} />\n      <div className={styles.imagePreviewModalContainerStyle}>\n        <div\n          className={clsx('zoom-area', { 'zoomed-bigger': isZoomedBigger })}\n          ref={zoomRef}\n        >\n          <div className={styles.imagePreviewModalCenterStyle}>\n            <img\n              data-blob-id={blockId}\n              data-testid=\"image-content\"\n              src={url}\n              alt={caption}\n              ref={imageRef}\n              draggable={isZoomedBigger}\n              onMouseDown={handleDragStart}\n              onMouseMove={handleDrag}\n              onMouseUp={handleDragEnd}\n              onLoad={resetZoom}\n            />\n            {isZoomedBigger ? null : (\n              <p\n                data-testid=\"image-caption-zoomedout\"\n                className={styles.imagePreviewModalCaptionStyle}\n              >\n                {caption}\n              </p>\n            )}\n          </div>\n        </div>\n      </div>\n\n      <div className={styles.imageBottomContainerStyle}>\n        {isZoomedBigger && caption !== '' ? (\n          <p\n            data-testid={'image-caption-zoomedin'}\n            className={styles.captionStyle}\n          >\n            {caption}\n          </p>\n        ) : null}\n        <div className={styles.imagePreviewActionBarStyle}>\n          <IconButton\n            data-testid=\"previous-image-button\"\n            tooltip=\"Previous\"\n            icon={<ArrowLeftSmallIcon />}\n            disabled={cursor < 1}\n            onClick={() => goto(cursor - 1)}\n          />\n          <div className={styles.cursorStyle}>\n            {`${blocks.length ? cursor + 1 : 0}/${blocks.length}`}\n          </div>\n          <IconButton\n            data-testid=\"next-image-button\"\n            tooltip=\"Next\"\n            icon={<ArrowRightSmallIcon />}\n            disabled={cursor + 1 === blocks.length}\n            onClick={() => goto(cursor + 1)}\n          />\n          <div className={styles.dividerStyle}></div>\n          <IconButton\n            data-testid=\"fit-to-screen-button\"\n            tooltip=\"Fit to screen\"\n            icon={<ViewBarIcon />}\n            onClick={() => resetZoom()}\n          />\n          <IconButton\n            data-testid=\"zoom-out-button\"\n            tooltip=\"Zoom out\"\n            icon={<MinusIcon />}\n            onClick={zoomOut}\n          />\n          <Button\n            data-testid=\"reset-scale-button\"\n            tooltip=\"Reset scale\"\n            onClick={resetScale}\n            variant=\"plain\"\n          >\n            {`${(currentScale * 100).toFixed(0)}%`}\n          </Button>\n\n          <IconButton\n            data-testid=\"zoom-in-button\"\n            tooltip=\"Zoom in\"\n            icon={<PlusIcon />}\n            onClick={zoomIn}\n          />\n          <div className={styles.dividerStyle}></div>\n          <IconButton\n            data-testid=\"download-button\"\n            tooltip=\"Download\"\n            icon={<DownloadIcon />}\n            onClick={downloadHandler}\n          />\n          <IconButton\n            data-testid=\"copy-to-clipboard-button\"\n            tooltip=\"Copy to clipboard\"\n            icon={<CopyIcon />}\n            onClick={copyHandler}\n          />\n          {blockModel && !blockModel.doc.readonly && (\n            <>\n              <div className={styles.dividerStyle}></div>\n              <IconButton\n                data-testid=\"delete-button\"\n                tooltip=\"Delete\"\n                icon={<DeleteIcon />}\n                disabled={blocks.length === 0}\n                onClick={() => deleteHandler(cursor)}\n                variant=\"danger\"\n              />\n            </>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst ErrorLogger = (props: FallbackProps) => {\n  console.error('image preview modal error', props.error);\n  return null;\n};\n\nexport const ImagePreviewErrorBoundary = (\n  props: PropsWithChildren\n): ReactElement => {\n  return (\n    <ErrorBoundary fallbackRender={ErrorLogger}>{props.children}</ErrorBoundary>\n  );\n};\n\nexport const ImagePreviewPeekView = (\n  props: ImagePreviewModalProps\n): ReactElement | null => {\n  const [blockId, setBlockId] = useState<string | null>(props.blockId);\n  const peekView = useService(PeekViewService).peekView;\n  const onClose = useCallback(() => peekView.close(), [peekView]);\n  const buttonRef = useRef<HTMLButtonElement | null>(null);\n\n  useEffect(() => {\n    setBlockId(props.blockId);\n  }, [props.blockId]);\n\n  return (\n    <ImagePreviewErrorBoundary>\n      <Suspense>\n        {blockId ? (\n          <ImagePreviewModalImpl\n            {...props}\n            onClose={onClose}\n            blockId={blockId}\n            onBlockIdChange={setBlockId}\n          />\n        ) : null}\n        <button\n          ref={buttonRef}\n          data-testid=\"image-preview-close-button\"\n          onClick={onClose}\n          className={styles.imagePreviewModalCloseButtonStyle}\n        >\n          <CloseIcon />\n        </button>\n      </Suspense>\n    </ImagePreviewErrorBoundary>\n  );\n};\n","import \"../core/src/modules/peek-view/view/peek-view-controls.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/modules/peek-view/view/peek-view-controls.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xM3hsMXpkMCB7CiAgZGlzcGxheTogZmxleDsKICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogIGhlaWdodDogMTAwJTsKICBnYXA6IDhweDsKfQouXzEzeGwxemQxIHsKICBib3JkZXItcmFkaXVzOiA4cHg7CiAgd2lkdGg6IDMycHg7CiAgaGVpZ2h0OiAzMnB4Owp9\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var button = '_13xl1zd1';\nexport var root = '_13xl1zd0';","import { IconButton } from '@affine/component';\nimport { useNavigateHelper } from '@affine/core/hooks/use-navigate-helper';\nimport { useI18n } from '@affine/i18n';\nimport {\n  CloseIcon,\n  ExpandFullIcon,\n  OpenInNewIcon,\n  SplitViewIcon,\n} from '@blocksuite/icons/rc';\nimport { type DocMode, useService } from '@toeverything/infra';\nimport { clsx } from 'clsx';\nimport {\n  type HTMLAttributes,\n  type MouseEventHandler,\n  type ReactElement,\n  useCallback,\n  useMemo,\n} from 'react';\n\nimport { WorkbenchService } from '../../workbench';\nimport { PeekViewService } from '../services/peek-view';\nimport * as styles from './peek-view-controls.css';\nimport { useDoc } from './utils';\n\ntype ControlButtonProps = {\n  nameKey: string;\n  icon: ReactElement;\n  name: string;\n  onClick: () => void;\n};\n\nexport const ControlButton = ({\n  icon,\n  nameKey,\n  name,\n  onClick,\n}: ControlButtonProps) => {\n  const handleClick: MouseEventHandler = useCallback(\n    e => {\n      e.stopPropagation();\n      e.preventDefault();\n      onClick();\n    },\n    [onClick]\n  );\n\n  return (\n    <IconButton\n      variant=\"solid\"\n      tooltip={name}\n      data-testid=\"peek-view-control\"\n      data-action-name={nameKey}\n      size=\"20\"\n      onClick={handleClick}\n      icon={icon}\n      className={styles.button}\n    />\n  );\n};\n\ntype DocPeekViewControlsProps = HTMLAttributes<HTMLDivElement> & {\n  docId: string;\n  blockId?: string;\n  mode?: DocMode;\n};\n\nexport const DefaultPeekViewControls = ({\n  className,\n  ...rest\n}: HTMLAttributes<HTMLDivElement>) => {\n  const peekView = useService(PeekViewService).peekView;\n  const t = useI18n();\n  const controls = useMemo(() => {\n    return [\n      {\n        icon: <CloseIcon />,\n        nameKey: 'close',\n        name: t['com.affine.peek-view-controls.close'](),\n        onClick: () => peekView.close(),\n      },\n    ].filter((opt): opt is ControlButtonProps => Boolean(opt));\n  }, [peekView, t]);\n  return (\n    <div {...rest} className={clsx(styles.root, className)}>\n      {controls.map(option => (\n        <ControlButton key={option.nameKey} {...option} />\n      ))}\n    </div>\n  );\n};\n\nexport const DocPeekViewControls = ({\n  docId,\n  blockId,\n  mode,\n  className,\n  ...rest\n}: DocPeekViewControlsProps) => {\n  const peekView = useService(PeekViewService).peekView;\n  const workbench = useService(WorkbenchService).workbench;\n  const { jumpToPageBlock } = useNavigateHelper();\n  const t = useI18n();\n  const { doc, workspace } = useDoc(docId);\n  const controls = useMemo(() => {\n    return [\n      {\n        icon: <CloseIcon />,\n        nameKey: 'close',\n        name: t['com.affine.peek-view-controls.close'](),\n        onClick: () => peekView.close(),\n      },\n      {\n        icon: <ExpandFullIcon />,\n        name: t['com.affine.peek-view-controls.open-doc'](),\n        nameKey: 'open',\n        onClick: () => {\n          // TODO(@Peng): for frame blocks, we should mimic \"view in edgeless\" button behavior\n          blockId\n            ? jumpToPageBlock(workspace.id, docId, blockId)\n            : workbench.openDoc(docId);\n          if (mode) {\n            doc?.setMode(mode);\n          }\n          peekView.close('none');\n        },\n      },\n      {\n        icon: <OpenInNewIcon />,\n        nameKey: 'new-tab',\n        name: t['com.affine.peek-view-controls.open-doc-in-new-tab'](),\n        onClick: () => {\n          workbench.openDoc(docId, { at: 'new-tab' });\n          peekView.close('none');\n        },\n      },\n      environment.isDesktop && {\n        icon: <SplitViewIcon />,\n        nameKey: 'split-view',\n        name: t['com.affine.peek-view-controls.open-doc-in-split-view'](),\n        onClick: () => {\n          workbench.openDoc(docId, { at: 'beside' });\n          peekView.close('none');\n        },\n      },\n    ].filter((opt): opt is ControlButtonProps => Boolean(opt));\n  }, [\n    blockId,\n    doc,\n    docId,\n    jumpToPageBlock,\n    mode,\n    peekView,\n    t,\n    workbench,\n    workspace.id,\n  ]);\n  return (\n    <div {...rest} className={clsx(styles.root, className)}>\n      {controls.map(option => (\n        <ControlButton key={option.nameKey} {...option} />\n      ))}\n    </div>\n  );\n};\n","import { toReactNode } from '@affine/component';\nimport { AIChatBlockPeekViewTemplate } from '@affine/core/blocksuite/presets/ai';\nimport { BlockComponent } from '@blocksuite/block-std';\nimport { useLiveData, useService } from '@toeverything/infra';\nimport { useEffect, useMemo } from 'react';\n\nimport type { ActivePeekView } from '../entities/peek-view';\nimport { PeekViewService } from '../services/peek-view';\nimport { DocPeekPreview } from './doc-preview';\nimport { ImagePreviewPeekView } from './image-preview';\nimport {\n  PeekViewModalContainer,\n  type PeekViewModalContainerProps,\n} from './modal-container';\nimport {\n  DefaultPeekViewControls,\n  DocPeekViewControls,\n} from './peek-view-controls';\n\nfunction renderPeekView({ info }: ActivePeekView) {\n  if (info.type === 'template') {\n    return toReactNode(info.template);\n  }\n  if (info.type === 'doc') {\n    return (\n      <DocPeekPreview\n        mode={info.mode}\n        xywh={info.xywh}\n        docId={info.docId}\n        blockId={info.blockId}\n      />\n    );\n  }\n\n  if (info.type === 'image') {\n    return <ImagePreviewPeekView docId={info.docId} blockId={info.blockId} />;\n  }\n\n  if (info.type === 'ai-chat-block') {\n    const template = AIChatBlockPeekViewTemplate(info.model, info.host);\n    return toReactNode(template);\n  }\n\n  return null; // unreachable\n}\n\nconst renderControls = ({ info }: ActivePeekView) => {\n  if (info.type === 'doc') {\n    return (\n      <DocPeekViewControls\n        mode={info.mode}\n        docId={info.docId}\n        blockId={info.docId}\n      />\n    );\n  }\n\n  if (info.type === 'image') {\n    return null; // image controls are rendered in the image preview\n  }\n\n  return <DefaultPeekViewControls />;\n};\n\nconst getRendererProps = (\n  activePeekView?: ActivePeekView\n): Partial<PeekViewModalContainerProps> | undefined => {\n  if (!activePeekView) {\n    return;\n  }\n\n  const preview = renderPeekView(activePeekView);\n  const controls = renderControls(activePeekView);\n  return {\n    children: preview,\n    controls,\n    target:\n      activePeekView?.target instanceof HTMLElement\n        ? activePeekView.target\n        : undefined,\n    padding: activePeekView.info.type !== 'image',\n    dialogFrame: activePeekView.info.type !== 'image',\n  };\n};\n\nexport const PeekViewManagerModal = () => {\n  const peekViewEntity = useService(PeekViewService).peekView;\n  const activePeekView = useLiveData(peekViewEntity.active$);\n  const show = useLiveData(peekViewEntity.show$);\n\n  const renderProps = useMemo(() => {\n    if (!activePeekView) {\n      return;\n    }\n    return getRendererProps(activePeekView);\n  }, [activePeekView]);\n\n  useEffect(() => {\n    const subscription = peekViewEntity.show$.subscribe(() => {\n      if (activePeekView?.target instanceof BlockComponent) {\n        activePeekView.target.requestUpdate();\n      }\n    });\n\n    return () => {\n      subscription.unsubscribe();\n    };\n  }, [activePeekView, peekViewEntity]);\n\n  return (\n    <PeekViewModalContainer\n      {...renderProps}\n      open={!!show?.value && !!renderProps}\n      animation={show?.animation || 'none'}\n      onOpenChange={open => {\n        if (!open) {\n          peekViewEntity.close();\n        }\n      }}\n    >\n      {renderProps?.children}\n    </PeekViewModalContainer>\n  );\n};\n","import { type Framework, WorkspaceScope } from '@toeverything/infra';\n\nimport { WorkbenchService } from '../workbench';\nimport { PeekViewEntity } from './entities/peek-view';\nimport { PeekViewService } from './services/peek-view';\n\nexport function configurePeekViewModule(framework: Framework) {\n  framework\n    .scope(WorkspaceScope)\n    .service(PeekViewService)\n    .entity(PeekViewEntity, [WorkbenchService]);\n}\n\nexport { PeekViewEntity, PeekViewService };\nexport { PeekViewManagerModal, useInsidePeekView } from './view';\n","import { DebugLogger } from '@affine/debug';\nimport { WorkspaceFlavour } from '@affine/env/workspace';\nimport type { WorkspaceService } from '@toeverything/infra';\nimport {\n  backoffRetry,\n  catchErrorInto,\n  effect,\n  Entity,\n  fromPromise,\n  LiveData,\n  mapInto,\n  onComplete,\n  onStart,\n} from '@toeverything/infra';\nimport { exhaustMap } from 'rxjs';\n\nimport { isBackendError, isNetworkError } from '../../cloud';\nimport type { WorkspacePermissionStore } from '../stores/permission';\n\nconst logger = new DebugLogger('affine:workspace-permission');\n\nexport class WorkspacePermission extends Entity {\n  isOwner$ = new LiveData<boolean | null>(null);\n  isLoading$ = new LiveData(false);\n  error$ = new LiveData<any>(null);\n\n  constructor(\n    private readonly workspaceService: WorkspaceService,\n    private readonly store: WorkspacePermissionStore\n  ) {\n    super();\n  }\n\n  revalidate = effect(\n    exhaustMap(() => {\n      return fromPromise(async signal => {\n        if (\n          this.workspaceService.workspace.flavour ===\n          WorkspaceFlavour.AFFINE_CLOUD\n        ) {\n          return await this.store.fetchIsOwner(\n            this.workspaceService.workspace.id,\n            signal\n          );\n        } else {\n          return true;\n        }\n      }).pipe(\n        backoffRetry({\n          when: isNetworkError,\n          count: Infinity,\n        }),\n        backoffRetry({\n          when: isBackendError,\n        }),\n        mapInto(this.isOwner$),\n        catchErrorInto(this.error$, error => {\n          logger.error('Failed to fetch isOwner', error);\n        }),\n        onStart(() => this.isLoading$.setValue(true)),\n        onComplete(() => this.isLoading$.setValue(false))\n      );\n    })\n  );\n}\n","import type { WorkspaceService, WorkspacesService } from '@toeverything/infra';\nimport { Service } from '@toeverything/infra';\n\nimport { WorkspacePermission } from '../entities/permission';\nimport type { WorkspacePermissionStore } from '../stores/permission';\n\nexport class WorkspacePermissionService extends Service {\n  permission = this.framework.createEntity(WorkspacePermission);\n\n  constructor(\n    private readonly workspaceService: WorkspaceService,\n    private readonly workspacesService: WorkspacesService,\n    private readonly store: WorkspacePermissionStore\n  ) {\n    super();\n  }\n\n  async leaveWorkspace() {\n    await this.store.leaveWorkspace(\n      this.workspaceService.workspace.id,\n      this.workspaceService.workspace.name$.value ?? ''\n    );\n    this.workspacesService.list.revalidate();\n  }\n}\n","import type { GraphQLService } from '@affine/core/modules/cloud';\nimport { getIsOwnerQuery, leaveWorkspaceMutation } from '@affine/graphql';\nimport { Store } from '@toeverything/infra';\n\nexport class WorkspacePermissionStore extends Store {\n  constructor(private readonly graphqlService: GraphQLService) {\n    super();\n  }\n\n  async fetchIsOwner(workspaceId: string, signal?: AbortSignal) {\n    const isOwner = await this.graphqlService.gql({\n      query: getIsOwnerQuery,\n      variables: {\n        workspaceId,\n      },\n      context: { signal },\n    });\n\n    return isOwner.isOwner;\n  }\n\n  /**\n   * @param workspaceName for send email\n   */\n  async leaveWorkspace(workspaceId: string, workspaceName: string) {\n    await this.graphqlService.gql({\n      query: leaveWorkspaceMutation,\n      variables: {\n        workspaceId,\n        workspaceName,\n      },\n    });\n  }\n}\n","export { WorkspacePermissionService } from './services/permission';\n\nimport { GraphQLService } from '@affine/core/modules/cloud';\nimport {\n  type Framework,\n  WorkspaceScope,\n  WorkspaceService,\n  WorkspacesService,\n} from '@toeverything/infra';\n\nimport { WorkspacePermission } from './entities/permission';\nimport { WorkspacePermissionService } from './services/permission';\nimport { WorkspacePermissionStore } from './stores/permission';\n\nexport function configurePermissionsModule(framework: Framework) {\n  framework\n    .scope(WorkspaceScope)\n    .service(WorkspacePermissionService, [\n      WorkspaceService,\n      WorkspacesService,\n      WorkspacePermissionStore,\n    ])\n    .store(WorkspacePermissionStore, [GraphQLService])\n    .entity(WorkspacePermission, [WorkspaceService, WorkspacePermissionStore]);\n}\n","/* eslint-disable @typescript-eslint/no-non-null-assertion */\n// the adapter is to bridge the workspace rootdoc & native js bindings\nimport { createYProxy, type Y } from '@blocksuite/store';\nimport type { WorkspaceService } from '@toeverything/infra';\nimport { LiveData, Service } from '@toeverything/infra';\nimport { defaultsDeep } from 'lodash-es';\nimport { Observable } from 'rxjs';\n\nimport type { FavoriteService, FavoriteSupportType } from '../../favorite';\nimport {\n  PagePropertyType,\n  PageSystemPropertyId,\n  type WorkspaceAffineProperties,\n} from './schema';\n\nconst AFFINE_PROPERTIES_ID = 'affine:workspace-properties';\n\n/**\n * WorkspacePropertiesAdapter is a wrapper for workspace properties.\n * Users should not directly access the workspace properties via yjs, but use this adapter instead.\n *\n * Question for enhancement in the future:\n * May abstract the adapter for each property type, e.g. PagePropertiesAdapter, SchemaAdapter, etc.\n * So that the adapter could be more focused and easier to maintain (like assigning default values)\n * However the properties for an abstraction may not be limited to a single yjs map.\n */\nexport class WorkspacePropertiesAdapter extends Service {\n  // provides a easy-to-use interface for workspace properties\n  public readonly proxy: WorkspaceAffineProperties;\n  public readonly properties: Y.Map<any>;\n  public readonly properties$: LiveData<WorkspaceAffineProperties>;\n\n  private ensuredRoot = false;\n  private ensuredPages = {} as Record<string, boolean>;\n\n  get workspace() {\n    return this.workspaceService.workspace;\n  }\n\n  constructor(public readonly workspaceService: WorkspaceService) {\n    super();\n    // check if properties exists, if not, create one\n    const rootDoc = workspaceService.workspace.docCollection.doc;\n    this.properties = rootDoc.getMap(AFFINE_PROPERTIES_ID);\n    this.proxy = createYProxy(this.properties);\n\n    this.properties$ = LiveData.from(\n      new Observable(observer => {\n        const update = () => {\n          requestAnimationFrame(() => {\n            observer.next(new Proxy(this.proxy, {}));\n          });\n        };\n        update();\n        this.properties.observeDeep(update);\n        return () => {\n          this.properties.unobserveDeep(update);\n        };\n      }),\n      this.proxy\n    );\n  }\n\n  public ensureRootProperties() {\n    if (this.ensuredRoot) {\n      return;\n    }\n    this.ensuredRoot = true;\n    // TODO(@Peng): deal with schema change issue\n    // fixme: may not to be called every time\n    defaultsDeep(this.proxy, {\n      schema: {\n        pageProperties: {\n          custom: {},\n          system: {\n            journal: {\n              id: PageSystemPropertyId.Journal,\n              name: 'Journal',\n              source: 'system',\n              type: PagePropertyType.Date,\n            },\n            tags: {\n              id: PageSystemPropertyId.Tags,\n              name: 'Tags',\n              source: 'system',\n              type: PagePropertyType.Tags,\n              options:\n                this.workspaceService.workspace.docCollection.meta.properties\n                  .tags?.options ?? [], // better use a one time migration\n            },\n          },\n        },\n      },\n      pageProperties: {},\n    });\n  }\n\n  ensurePageProperties(pageId: string) {\n    this.ensureRootProperties();\n    if (this.ensuredPages[pageId]) {\n      return;\n    }\n    this.ensuredPages[pageId] = true;\n    // fixme: may not to be called every time\n    defaultsDeep(this.proxy.pageProperties, {\n      [pageId]: {\n        custom: {},\n        system: {\n          [PageSystemPropertyId.Journal]: {\n            id: PageSystemPropertyId.Journal,\n            value: false,\n          },\n          [PageSystemPropertyId.Tags]: {\n            id: PageSystemPropertyId.Tags,\n            value: [],\n          },\n        },\n      },\n    });\n  }\n\n  // leak some yjs abstraction to modify multiple properties at once\n  transact = this.workspaceService.workspace.docCollection.doc.transact.bind(\n    this.workspaceService.workspace.docCollection.doc\n  );\n\n  get schema() {\n    return this.proxy.schema;\n  }\n\n  /**\n   * @deprecated\n   */\n  get favorites() {\n    return this.proxy.favorites;\n  }\n\n  get pageProperties() {\n    return this.proxy.pageProperties;\n  }\n\n  // ====== utilities ======\n\n  getPageProperties(pageId: string) {\n    return this.pageProperties?.[pageId] ?? null;\n  }\n\n  getJournalPageDateString(id: string) {\n    return this.pageProperties?.[id]?.system[PageSystemPropertyId.Journal]\n      ?.value;\n  }\n\n  setJournalPageDateString(id: string, date: string) {\n    this.ensurePageProperties(id);\n    const pageProperties = this.pageProperties?.[id];\n    pageProperties!.system[PageSystemPropertyId.Journal].value = date;\n  }\n\n  /**\n   * After the user completes the migration, call this function to clear the favorite data\n   */\n  markFavoritesMigrated() {\n    this.proxy.favoritesMigrated = true;\n  }\n}\n\nexport class MigrationFavoriteItemsAdapter extends Service {\n  constructor(private readonly adapter: WorkspacePropertiesAdapter) {\n    super();\n  }\n\n  favorites$ = this.adapter.properties$.map(() =>\n    this.getItems().filter(i => i.value)\n  );\n\n  migrated$ = this.adapter.properties$.map(\n    props => props.favoritesMigrated ?? false\n  );\n\n  getItems() {\n    return Object.entries(this.adapter.favorites ?? {})\n      .filter(([k]) => k.includes(':'))\n      .map(([, v]) => v);\n  }\n\n  markFavoritesMigrated() {\n    this.adapter.markFavoritesMigrated();\n  }\n}\n\ntype CompatibleFavoriteSupportType = FavoriteSupportType;\n\n/**\n * A service written for compatibility,with the same API as old FavoriteItemsAdapter.\n */\nexport class CompatibleFavoriteItemsAdapter extends Service {\n  constructor(private readonly favoriteService: FavoriteService) {\n    super();\n  }\n\n  toggle(id: string, type: CompatibleFavoriteSupportType) {\n    this.favoriteService.favoriteList.toggle(type, id);\n  }\n\n  isFavorite$(id: string, type: CompatibleFavoriteSupportType) {\n    return this.favoriteService.favoriteList.isFavorite$(type, id);\n  }\n\n  isFavorite(id: string, type: CompatibleFavoriteSupportType) {\n    return this.favoriteService.favoriteList.isFavorite$(type, id).value;\n  }\n\n  get favorites$() {\n    return this.favoriteService.favoriteList.list$.map<\n      {\n        id: string;\n        order: string;\n        type: 'doc' | 'collection';\n        value: boolean;\n      }[]\n    >(v =>\n      v\n        .filter(i => i.type === 'doc' || i.type === 'collection') // only support doc and collection\n        .map(i => ({\n          id: i.id,\n          order: '',\n          type: i.type as 'doc' | 'collection',\n          value: true,\n        }))\n    );\n  }\n}\n","import type { Tag } from '@affine/env/filter';\nimport type { DocsPropertiesMeta } from '@blocksuite/store';\nimport type { WorkspaceService } from '@toeverything/infra';\nimport { LiveData, Service } from '@toeverything/infra';\nimport { Observable } from 'rxjs';\n\n/**\n * @deprecated use WorkspacePropertiesAdapter instead (later)\n */\nexport class WorkspaceLegacyProperties extends Service {\n  constructor(private readonly workspaceService: WorkspaceService) {\n    super();\n  }\n\n  get workspaceId() {\n    return this.workspaceService.workspace.id;\n  }\n\n  get properties() {\n    return this.workspaceService.workspace.docCollection.meta.properties;\n  }\n  get tagOptions() {\n    return this.properties.tags?.options ?? [];\n  }\n\n  updateProperties = (properties: DocsPropertiesMeta) => {\n    this.workspaceService.workspace.docCollection.meta.setProperties(\n      properties\n    );\n  };\n\n  subscribe(cb: () => void) {\n    const disposable =\n      this.workspaceService.workspace.docCollection.meta.docMetaUpdated.on(cb);\n    return disposable.dispose;\n  }\n\n  properties$ = LiveData.from(\n    new Observable<DocsPropertiesMeta>(sub => {\n      return this.subscribe(() => sub.next(this.properties));\n    }),\n    this.properties\n  );\n\n  tagOptions$ = LiveData.from(\n    new Observable<Tag[]>(sub => {\n      return this.subscribe(() => sub.next(this.tagOptions));\n    }),\n    this.tagOptions\n  );\n\n  updateTagOptions = (options: Tag[]) => {\n    this.updateProperties({\n      ...this.properties,\n      tags: {\n        options,\n      },\n    });\n  };\n\n  updateTagOption = (id: string, option: Tag) => {\n    this.updateTagOptions(this.tagOptions.map(o => (o.id === id ? option : o)));\n  };\n\n  removeTagOption = (id: string) => {\n    this.workspaceService.workspace.docCollection.doc.transact(() => {\n      this.updateTagOptions(this.tagOptions.filter(o => o.id !== id));\n      // need to remove tag from all pages\n      this.workspaceService.workspace.docCollection.docs.forEach(doc => {\n        const tags = doc.meta?.tags ?? [];\n        if (tags.includes(id)) {\n          this.updatePageTags(\n            doc.id,\n            tags.filter(t => t !== id)\n          );\n        }\n      });\n    });\n  };\n\n  updatePageTags = (pageId: string, tags: string[]) => {\n    this.workspaceService.workspace.docCollection.setDocMeta(pageId, {\n      tags,\n    });\n  };\n}\n","export {\n  CompatibleFavoriteItemsAdapter,\n  MigrationFavoriteItemsAdapter,\n  WorkspacePropertiesAdapter,\n} from './services/adapter';\nexport { WorkspaceLegacyProperties } from './services/legacy-properties';\n\nimport {\n  type Framework,\n  WorkspaceScope,\n  WorkspaceService,\n} from '@toeverything/infra';\n\nimport { FavoriteService } from '../favorite';\nimport {\n  CompatibleFavoriteItemsAdapter,\n  MigrationFavoriteItemsAdapter,\n  WorkspacePropertiesAdapter,\n} from './services/adapter';\nimport { WorkspaceLegacyProperties } from './services/legacy-properties';\n\nexport function configureWorkspacePropertiesModule(framework: Framework) {\n  framework\n    .scope(WorkspaceScope)\n    .service(WorkspaceLegacyProperties, [WorkspaceService])\n    .service(WorkspacePropertiesAdapter, [WorkspaceService])\n    .service(MigrationFavoriteItemsAdapter, [WorkspacePropertiesAdapter])\n    .service(CompatibleFavoriteItemsAdapter, [FavoriteService]);\n}\n","import { z } from 'zod';\n\n// ===== workspace-wide page property schema =====\nexport const TagOptionSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  color: z.string(),\n});\n\nexport type TagOption = z.infer<typeof TagOptionSchema>;\n\nexport enum PageSystemPropertyId {\n  Tags = 'tags',\n  Journal = 'journal',\n}\n\nexport enum PagePropertyType {\n  Text = 'text',\n  Number = 'number',\n  Date = 'date',\n  Progress = 'progress',\n  Checkbox = 'checkbox',\n  Tags = 'tags',\n}\n\nexport const PagePropertyMetaBaseSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  source: z.string(),\n  type: z.nativeEnum(PagePropertyType),\n  icon: z.string(),\n  required: z.boolean().optional(),\n});\n\nexport const PageSystemPropertyMetaBaseSchema =\n  PagePropertyMetaBaseSchema.extend({\n    source: z.literal('system'),\n  });\n\nexport const PageCustomPropertyMetaSchema = PagePropertyMetaBaseSchema.extend({\n  source: z.literal('custom'),\n  order: z.number(),\n});\n\n// ====== page info schema ======\nexport const PageInfoItemSchema = z.object({\n  id: z.string(), // property id. Maps to PagePropertyMetaSchema.id\n  visibility: z.enum(['visible', 'hide', 'hide-if-empty']),\n  value: z.any(), // corresponds to PagePropertyMetaSchema.type\n});\n\nexport const PageInfoJournalItemSchema = PageInfoItemSchema.extend({\n  id: z.literal(PageSystemPropertyId.Journal),\n  value: z.union([z.string(), z.literal(false)]),\n});\n\nexport const PageInfoTagsItemSchema = PageInfoItemSchema.extend({\n  id: z.literal(PageSystemPropertyId.Tags),\n  value: z.array(z.string()),\n});\n\nexport type PageInfoTagsItem = z.infer<typeof PageInfoTagsItemSchema>;\n\n// ====== workspace properties schema ======\nexport const WorkspaceFavoriteItemSchema = z.object({\n  id: z.string(),\n  order: z.string(),\n  type: z.enum(['doc', 'collection']),\n  value: z.boolean(),\n});\n\nexport type WorkspaceFavoriteItem = z.infer<typeof WorkspaceFavoriteItemSchema>;\n\nconst WorkspaceAffinePropertiesSchemaSchema = z.object({\n  pageProperties: z.object({\n    custom: z.record(PageCustomPropertyMetaSchema),\n    system: z.object({\n      [PageSystemPropertyId.Journal]: PageSystemPropertyMetaBaseSchema.extend({\n        id: z.literal(PageSystemPropertyId.Journal),\n        type: z.literal(PagePropertyType.Date),\n      }),\n      [PageSystemPropertyId.Tags]: PagePropertyMetaBaseSchema.extend({\n        id: z.literal(PageSystemPropertyId.Tags),\n        type: z.literal(PagePropertyType.Tags),\n        options: z.array(TagOptionSchema),\n      }),\n    }),\n  }),\n});\n\nconst PageInfoCustomPropertyItemSchema = PageInfoItemSchema.extend({\n  order: z.string(),\n});\n\nconst WorkspacePagePropertiesSchema = z.object({\n  custom: z.record(PageInfoCustomPropertyItemSchema),\n  system: z.object({\n    [PageSystemPropertyId.Journal]: PageInfoJournalItemSchema,\n    [PageSystemPropertyId.Tags]: PageInfoTagsItemSchema,\n  }),\n});\n\nexport const WorkspaceAffinePropertiesSchema = z.object({\n  schema: WorkspaceAffinePropertiesSchemaSchema.optional(),\n  favorites: z.record(WorkspaceFavoriteItemSchema).optional(),\n  pageProperties: z.record(WorkspacePagePropertiesSchema).optional(),\n  favoritesMigrated: z.boolean().optional(),\n});\n\nexport type PageInfoCustomPropertyMeta = z.infer<\n  typeof PageCustomPropertyMetaSchema\n>;\n\nexport type WorkspaceAffineProperties = z.infer<\n  typeof WorkspaceAffinePropertiesSchema\n>;\n\nexport type PageInfoCustomProperty = z.infer<\n  typeof PageInfoCustomPropertyItemSchema\n>;\n\nexport type WorkspaceAffinePageProperties = z.infer<\n  typeof WorkspacePagePropertiesSchema\n>;\n","import { ViewLayersIcon } from '@blocksuite/icons/rc';\nimport { Entity, LiveData } from '@toeverything/infra';\nimport Fuse from 'fuse.js';\n\nimport type { CollectionService } from '../../collection';\nimport type { QuickSearchSession } from '../providers/quick-search-provider';\nimport type { QuickSearchGroup } from '../types/group';\nimport type { QuickSearchItem } from '../types/item';\nimport { highlighter } from '../utils/highlighter';\n\nconst group = {\n  id: 'collections',\n  label: {\n    key: 'com.affine.cmdk.affine.category.affine.collections',\n  },\n  score: 10,\n} as QuickSearchGroup;\n\nexport class CollectionsQuickSearchSession\n  extends Entity\n  implements QuickSearchSession<'collections', { collectionId: string }>\n{\n  constructor(private readonly collectionService: CollectionService) {\n    super();\n  }\n\n  query$ = new LiveData('');\n\n  items$: LiveData<QuickSearchItem<'collections', { collectionId: string }>[]> =\n    LiveData.computed(get => {\n      const query = get(this.query$);\n\n      const collections = get(this.collectionService.collections$);\n\n      const fuse = new Fuse(collections, {\n        keys: ['name'],\n        includeMatches: true,\n        includeScore: true,\n        ignoreLocation: true,\n        threshold: 0.0,\n      });\n\n      const result = fuse.search(query);\n\n      return result.map<\n        QuickSearchItem<'collections', { collectionId: string }>\n      >(({ item, matches, score = 1 }) => {\n        const nomalizedRange = ([start, end]: [number, number]) =>\n          [\n            start,\n            end + 1 /* in fuse, the `end` is different from the `substring` */,\n          ] as [number, number];\n        const titleMatches = matches\n          ?.filter(match => match.key === 'name')\n          .flatMap(match => match.indices.map(nomalizedRange));\n\n        return {\n          id: 'collection:' + item.id,\n          source: 'collections',\n          label: {\n            title: (highlighter(item.name, '<b>', '</b>', titleMatches ?? []) ??\n              item.name) || {\n              key: 'Untitled',\n            },\n          },\n          group,\n          score:\n            1 -\n            score /* in fuse, the smaller the score, the better the match, so we need to reverse it */,\n          icon: ViewLayersIcon,\n          payload: { collectionId: item.id },\n        };\n      });\n    });\n\n  query(query: string) {\n    this.query$.next(query);\n  }\n}\n","import {\n  type AffineCommand,\n  AffineCommandRegistry,\n  type CommandCategory,\n  PreconditionStrategy,\n} from '@affine/core/commands';\nimport type { DocMode, GlobalContextService } from '@toeverything/infra';\nimport { Entity, LiveData } from '@toeverything/infra';\nimport Fuse from 'fuse.js';\n\nimport type { QuickSearchSession } from '../providers/quick-search-provider';\nimport type { QuickSearchGroup } from '../types/group';\nimport type { QuickSearchItem } from '../types/item';\nimport { highlighter } from '../utils/highlighter';\n\nconst categories = {\n  'affine:recent': {\n    id: 'command:affine:recent',\n    label: { key: 'com.affine.cmdk.affine.category.affine.recent' },\n    score: 10,\n  },\n  'affine:navigation': {\n    id: 'command:affine:navigation',\n    label: {\n      key: 'com.affine.cmdk.affine.category.affine.navigation',\n    },\n    score: 10,\n  },\n  'affine:creation': {\n    id: 'command:affine:creation',\n    label: { key: 'com.affine.cmdk.affine.category.affine.creation' },\n    score: 10,\n  },\n  'affine:general': {\n    id: 'command:affine:general',\n    label: { key: 'com.affine.cmdk.affine.category.affine.general' },\n    score: 10,\n  },\n  'affine:layout': {\n    id: 'command:affine:layout',\n    label: { key: 'com.affine.cmdk.affine.category.affine.layout' },\n    score: 10,\n  },\n  'affine:pages': {\n    id: 'command:affine:pages',\n    label: { key: 'com.affine.cmdk.affine.category.affine.pages' },\n    score: 10,\n  },\n  'affine:edgeless': {\n    id: 'command:affine:edgeless',\n    label: { key: 'com.affine.cmdk.affine.category.affine.edgeless' },\n    score: 10,\n  },\n  'affine:collections': {\n    id: 'command:affine:collections',\n    label: {\n      key: 'com.affine.cmdk.affine.category.affine.collections',\n    },\n    score: 10,\n  },\n  'affine:settings': {\n    id: 'command:affine:settings',\n    label: { key: 'com.affine.cmdk.affine.category.affine.settings' },\n    score: 10,\n  },\n  'affine:updates': {\n    id: 'command:affine:updates',\n    label: { key: 'com.affine.cmdk.affine.category.affine.updates' },\n    score: 10,\n  },\n  'affine:help': {\n    id: 'command:affine:help',\n    label: { key: 'com.affine.cmdk.affine.category.affine.help' },\n    score: 10,\n  },\n  'editor:edgeless': {\n    id: 'command:editor:edgeless',\n    label: { key: 'com.affine.cmdk.affine.category.editor.edgeless' },\n    score: 10,\n  },\n  'editor:insert-object': {\n    id: 'command:editor:insert-object',\n    label: { key: 'com.affine.cmdk.affine.category.editor.insert-object' },\n    score: 10,\n  },\n  'editor:page': {\n    id: 'command:editor:page',\n    label: { key: 'com.affine.cmdk.affine.category.editor.page' },\n    score: 10,\n  },\n  'affine:results': {\n    id: 'command:affine:results',\n    label: { key: 'com.affine.cmdk.affine.category.results' },\n    score: 10,\n  },\n} satisfies Required<{\n  [key in CommandCategory]: QuickSearchGroup & { id: `command:${key}` };\n}>;\n\nfunction filterCommandByContext(\n  command: AffineCommand,\n  context: {\n    docMode: DocMode | undefined;\n  }\n) {\n  if (command.preconditionStrategy === PreconditionStrategy.Always) {\n    return true;\n  }\n  if (command.preconditionStrategy === PreconditionStrategy.InEdgeless) {\n    return context.docMode === 'edgeless';\n  }\n  if (command.preconditionStrategy === PreconditionStrategy.InPaper) {\n    return context.docMode === 'page';\n  }\n  if (command.preconditionStrategy === PreconditionStrategy.InPaperOrEdgeless) {\n    return !!context.docMode;\n  }\n  if (command.preconditionStrategy === PreconditionStrategy.Never) {\n    return false;\n  }\n  if (typeof command.preconditionStrategy === 'function') {\n    return command.preconditionStrategy();\n  }\n  return true;\n}\n\nfunction getAllCommand(context: { docMode: DocMode | undefined }) {\n  const commands = AffineCommandRegistry.getAll();\n  return commands.filter(command => {\n    return filterCommandByContext(command, context);\n  });\n}\n\nexport class CommandsQuickSearchSession\n  extends Entity\n  implements QuickSearchSession<'commands', AffineCommand>\n{\n  constructor(private readonly contextService: GlobalContextService) {\n    super();\n  }\n\n  query$ = new LiveData('');\n\n  items$ = LiveData.computed(get => {\n    const query = get(this.query$);\n    const docMode =\n      get(this.contextService.globalContext.docMode.$) ?? undefined;\n    const commands = getAllCommand({ docMode });\n\n    const fuse = new Fuse(commands, {\n      keys: [{ name: 'label.title', weight: 2 }, 'label.subTitle'],\n      includeMatches: true,\n      includeScore: true,\n      ignoreLocation: true,\n      threshold: 0.0,\n    });\n\n    const result = query\n      ? fuse.search(query)\n      : commands.map(item => ({ item, matches: [], score: 0 }));\n\n    return result.map<QuickSearchItem<'commands', AffineCommand>>(\n      ({ item, matches, score = 1 }) => {\n        const normalizedRange = ([start, end]: [number, number]) =>\n          [\n            start,\n            end + 1 /* in fuse, the `end` is different from the `substring` */,\n          ] as [number, number];\n        const titleMatches = matches\n          ?.filter(match => match.key === 'label.title')\n          .flatMap(match => match.indices.map(normalizedRange));\n        const subTitleMatches = matches\n          ?.filter(match => match.key === 'label.subTitle')\n          .flatMap(match => match.indices.map(normalizedRange));\n\n        return {\n          id: 'command:' + item.id,\n          source: 'commands',\n          label: {\n            title:\n              highlighter(\n                item.label.title,\n                '<b>',\n                '</b>',\n                titleMatches ?? []\n              ) ?? item.label.title,\n            subTitle: item.label.subTitle\n              ? (highlighter(\n                  item.label.subTitle,\n                  '<b>',\n                  '</b>',\n                  subTitleMatches ?? []\n                ) ?? item.label.subTitle)\n              : undefined,\n          },\n          group: categories[item.category],\n          score:\n            1 -\n            score /* in fuse, the smaller the score, the better the match, so we need to reverse it */,\n          icon: item.icon,\n          keyBinding: item.keyBinding?.binding,\n          payload: item,\n        };\n      }\n    );\n  });\n\n  query(query: string) {\n    this.query$.next(query);\n  }\n}\n","import { EdgelessIcon, PageIcon } from '@blocksuite/icons/rc';\nimport { type DocMode, Entity, LiveData } from '@toeverything/infra';\n\nimport type { QuickSearchSession } from '../providers/quick-search-provider';\nimport type { QuickSearchGroup } from '../types/group';\nimport type { QuickSearchItem } from '../types/item';\n\nconst group = {\n  id: 'creation',\n  label: { key: 'com.affine.quicksearch.group.creation' },\n  score: 0,\n} as QuickSearchGroup;\n\nexport class CreationQuickSearchSession\n  extends Entity\n  implements QuickSearchSession<'creation', { title: string; mode: DocMode }>\n{\n  query$ = new LiveData('');\n\n  items$ = LiveData.computed(get => {\n    const query = get(this.query$);\n\n    if (!query.trim()) {\n      return [];\n    }\n\n    return [\n      {\n        id: 'creation:create-page',\n        source: 'creation',\n        label: {\n          key: 'com.affine.cmdk.affine.create-new-page-as',\n          options: { keyWord: query },\n        },\n        group,\n        icon: PageIcon,\n        payload: { mode: 'edgeless', title: query },\n      },\n      {\n        id: 'creation:create-edgeless',\n        source: 'creation',\n        label: {\n          key: 'com.affine.cmdk.affine.create-new-edgeless-as',\n          options: { keyWord: query },\n        },\n        group,\n        icon: EdgelessIcon,\n        payload: { mode: 'edgeless', title: query },\n      },\n    ] as QuickSearchItem<'creation', { title: string; mode: DocMode }>[];\n  });\n\n  query(query: string) {\n    this.query$.next(query);\n  }\n}\n","import type { DocRecord, DocsService } from '@toeverything/infra';\nimport {\n  effect,\n  Entity,\n  LiveData,\n  onComplete,\n  onStart,\n} from '@toeverything/infra';\nimport { truncate } from 'lodash-es';\nimport { EMPTY, map, mergeMap, of, switchMap } from 'rxjs';\n\nimport type { DocsSearchService } from '../../docs-search';\nimport { resolveLinkToDoc } from '../../navigation';\nimport type { QuickSearchSession } from '../providers/quick-search-provider';\nimport type { DocDisplayMetaService } from '../services/doc-display-meta';\nimport type { QuickSearchItem } from '../types/item';\n\ninterface DocsPayload {\n  docId: string;\n  title?: string;\n  blockId?: string | undefined;\n  blockContent?: string | undefined;\n}\n\nexport class DocsQuickSearchSession\n  extends Entity\n  implements QuickSearchSession<'docs', DocsPayload>\n{\n  constructor(\n    private readonly docsSearchService: DocsSearchService,\n    private readonly docsService: DocsService,\n    private readonly docDisplayMetaService: DocDisplayMetaService\n  ) {\n    super();\n  }\n\n  private readonly isIndexerLoading$ =\n    this.docsSearchService.indexer.status$.map(({ remaining }) => {\n      return remaining === undefined || remaining > 0;\n    });\n\n  private readonly isQueryLoading$ = new LiveData(false);\n\n  isLoading$ = LiveData.computed(get => {\n    return get(this.isIndexerLoading$) || get(this.isQueryLoading$);\n  });\n\n  query$ = new LiveData('');\n\n  items$ = new LiveData<QuickSearchItem<'docs', DocsPayload>[]>([]);\n\n  query = effect(\n    switchMap((query: string) => {\n      let out;\n      if (!query) {\n        out = of([] as QuickSearchItem<'docs', DocsPayload>[]);\n      } else {\n        out = this.docsSearchService.search$(query).pipe(\n          map(docs => {\n            const resolvedDoc = resolveLinkToDoc(query);\n            if (\n              resolvedDoc &&\n              !docs.some(doc => doc.docId === resolvedDoc.docId)\n            ) {\n              return [\n                {\n                  docId: resolvedDoc.docId,\n                  score: 100,\n                  blockId: resolvedDoc.blockId,\n                  blockContent: '',\n                },\n                ...docs,\n              ];\n            } else {\n              return docs;\n            }\n          }),\n          map(docs =>\n            docs\n              .map(doc => {\n                const docRecord = this.docsService.list.doc$(doc.docId).value;\n                return [doc, docRecord] as const;\n              })\n              .filter(\n                (props): props is [(typeof props)[0], DocRecord] => !!props[1]\n              )\n              .map(([doc, docRecord]) => {\n                const { title, icon, updatedDate } =\n                  this.docDisplayMetaService.getDocDisplayMeta(\n                    docRecord,\n                    'title' in doc ? doc.title : undefined\n                  );\n                return {\n                  id: 'doc:' + docRecord.id,\n                  source: 'docs',\n                  group: {\n                    id: 'docs',\n                    label: {\n                      key: 'com.affine.quicksearch.group.searchfor',\n                      options: { query: truncate(query) },\n                    },\n                    score: 5,\n                  },\n                  label: {\n                    title: title,\n                    subTitle: doc.blockContent,\n                  },\n                  score: doc.score,\n                  icon,\n                  timestamp: updatedDate,\n                  payload: doc,\n                } as QuickSearchItem<'docs', DocsPayload>;\n              })\n          )\n        );\n      }\n      return out.pipe(\n        mergeMap((items: QuickSearchItem<'docs', DocsPayload>[]) => {\n          this.items$.next(items);\n          this.isQueryLoading$.next(false);\n          return EMPTY;\n        }),\n        onStart(() => {\n          this.items$.next([]);\n          this.isQueryLoading$.next(true);\n        }),\n        onComplete(() => {})\n      );\n    })\n  );\n\n  // TODO(@EYHN): load more\n\n  setQuery(query: string) {\n    this.query$.next(query);\n  }\n}\n","import { Entity, LiveData } from '@toeverything/infra';\n\nimport type { QuickSearchSession } from '../providers/quick-search-provider';\nimport type { DocDisplayMetaService } from '../services/doc-display-meta';\nimport type { RecentDocsService } from '../services/recent-pages';\nimport type { QuickSearchGroup } from '../types/group';\nimport type { QuickSearchItem } from '../types/item';\n\nconst group = {\n  id: 'recent-docs',\n  label: {\n    key: 'com.affine.cmdk.affine.category.affine.recent',\n  },\n  score: 15,\n} as QuickSearchGroup;\n\nexport class RecentDocsQuickSearchSession\n  extends Entity\n  implements QuickSearchSession<'recent-doc', { docId: string }>\n{\n  constructor(\n    private readonly recentDocsService: RecentDocsService,\n    private readonly docDisplayMetaService: DocDisplayMetaService\n  ) {\n    super();\n  }\n\n  query$ = new LiveData('');\n\n  items$: LiveData<QuickSearchItem<'recent-doc', { docId: string }>[]> =\n    LiveData.computed(get => {\n      const query = get(this.query$);\n\n      if (query) {\n        return []; /* recent docs only for empty query */\n      }\n\n      const docRecords = this.recentDocsService.getRecentDocs();\n\n      return docRecords\n        .filter(doc => !get(doc.trash$))\n        .map<QuickSearchItem<'recent-doc', { docId: string }>>(docRecord => {\n          const { title, icon } =\n            this.docDisplayMetaService.getDocDisplayMeta(docRecord);\n\n          return {\n            id: 'recent-doc:' + docRecord.id,\n            source: 'recent-doc',\n            group: group,\n            label: {\n              title: title,\n            },\n            score: 0,\n            icon,\n            timestamp: docRecord.meta$.value.updatedDate,\n            payload: { docId: docRecord.id },\n          };\n        });\n    });\n\n  query(query: string) {\n    this.query$.next(query);\n  }\n}\n","import { Entity, LiveData } from '@toeverything/infra';\nimport { mean } from 'lodash-es';\n\nimport type {\n  QuickSearchSession,\n  QuickSearchSource,\n  QuickSearchSourceItemType,\n} from '../providers/quick-search-provider';\nimport type { QuickSearchItem } from '../types/item';\nimport type { QuickSearchOptions } from '../types/options';\n\nexport class QuickSearch extends Entity {\n  constructor() {\n    super();\n  }\n  private readonly state$ = new LiveData<{\n    query: string;\n    sessions: QuickSearchSession<any, any>[];\n    options: QuickSearchOptions;\n    callback: (result: QuickSearchItem | null) => void;\n  } | null>(null);\n\n  readonly items$ = this.state$\n    .map(s => s?.sessions.map(session => session.items$) ?? [])\n    .flat()\n    .map(items => items.flat());\n\n  readonly show$ = this.state$.map(s => !!s);\n\n  readonly options$ = this.state$.map(s => s?.options);\n\n  readonly isLoading$ = this.state$\n    .map(\n      s =>\n        s?.sessions.map(session => session.isLoading$ ?? new LiveData(false)) ??\n        []\n    )\n    .flat()\n    .map(items => items.reduce((acc, item) => acc || item, false));\n\n  readonly loadingProgress$ = this.state$\n    .map(\n      s =>\n        s?.sessions.map(\n          session =>\n            (session.loadingProgress$ ?? new LiveData(null)) as LiveData<\n              number | null\n            >\n        ) ?? []\n    )\n    .flat()\n    .map(items => mean(items.filter((v): v is number => v === null)));\n\n  show = <const Sources extends any[]>(\n    sources: Sources,\n    cb: (result: QuickSearchSourceItemType<Sources[number]> | null) => void,\n    options: QuickSearchOptions = {}\n  ) => {\n    if (this.state$.value) {\n      this.hide();\n    }\n\n    const sessions = sources.map((source: QuickSearchSource<any, any>) => {\n      if (typeof source === 'function') {\n        const items$ = new LiveData<QuickSearchItem<any, any>[]>([]);\n        return {\n          items$,\n          query: (query: string) => {\n            items$.next(source(query));\n          },\n        } as QuickSearchSession<any, any>;\n      } else {\n        return source as QuickSearchSession<any, any>;\n      }\n    });\n    sessions.forEach(session => {\n      session.query?.(options.defaultQuery || '');\n    });\n    this.state$.next({\n      query: options.defaultQuery ?? '',\n      options,\n      sessions: sessions,\n      callback: cb as any,\n    });\n  };\n\n  query$ = this.state$.map(s => s?.query || '');\n\n  setQuery = (query: string) => {\n    if (!this.state$.value) return;\n    this.state$.next({\n      ...this.state$.value,\n      query,\n    });\n    this.state$.value.sessions.forEach(session => session.query?.(query));\n  };\n\n  hide() {\n    if (this.state$.value) {\n      this.state$.value.sessions.forEach(session => session.dispose?.());\n      this.state$.value.callback?.(null);\n    }\n\n    this.state$.next(null);\n  }\n\n  submit(result: QuickSearchItem | null) {\n    if (this.state$.value?.callback) {\n      this.state$.value.callback(result);\n    }\n    this.state$.next(null);\n  }\n}\n","import { i18nTime } from '@affine/i18n';\nimport { EdgelessIcon, PageIcon, TodayIcon } from '@blocksuite/icons/rc';\nimport type { DocRecord } from '@toeverything/infra';\nimport { Service } from '@toeverything/infra';\n\nimport type { WorkspacePropertiesAdapter } from '../../properties';\n\nexport class DocDisplayMetaService extends Service {\n  constructor(private readonly propertiesAdapter: WorkspacePropertiesAdapter) {\n    super();\n  }\n\n  getDocDisplayMeta(docRecord: DocRecord, originalTitle?: string) {\n    const journalDateString = this.propertiesAdapter.getJournalPageDateString(\n      docRecord.id\n    );\n    const icon = journalDateString\n      ? TodayIcon\n      : docRecord.mode$.value === 'edgeless'\n        ? EdgelessIcon\n        : PageIcon;\n\n    const title = journalDateString\n      ? i18nTime(journalDateString, { absolute: { accuracy: 'day' } })\n      : originalTitle ||\n        docRecord.meta$.value.title ||\n        ({\n          key: 'Untitled',\n        } as const);\n\n    return {\n      title: title,\n      icon: icon,\n      updatedDate: docRecord.meta$.value.updatedDate,\n    };\n  }\n}\n","import { Service } from '@toeverything/infra';\n\nimport { QuickSearch } from '../entities/quick-search';\n\nexport class QuickSearchService extends Service {\n  public readonly quickSearch = this.framework.createEntity(QuickSearch);\n}\n","import type {\n  DocRecord,\n  DocsService,\n  WorkspaceLocalState,\n} from '@toeverything/infra';\nimport { Service } from '@toeverything/infra';\n\nconst RECENT_PAGES_LIMIT = 3; // adjust this?\nconst RECENT_PAGES_KEY = 'recent-pages';\n\nconst EMPTY_ARRAY: string[] = [];\n\nexport class RecentDocsService extends Service {\n  constructor(\n    private readonly localState: WorkspaceLocalState,\n    private readonly docsService: DocsService\n  ) {\n    super();\n  }\n\n  addRecentDoc(pageId: string) {\n    let recentPages = this.getRecentDocIds();\n    recentPages = recentPages.filter(id => id !== pageId);\n    if (recentPages.length >= RECENT_PAGES_LIMIT) {\n      recentPages.pop();\n    }\n    recentPages.unshift(pageId);\n    this.localState.set(RECENT_PAGES_KEY, recentPages);\n  }\n\n  getRecentDocs() {\n    const docs = this.docsService.list.docs$.value;\n    return this.getRecentDocIds()\n      .map(id => docs.find(doc => doc.id === id))\n      .filter((d): d is DocRecord => !!d);\n  }\n\n  private getRecentDocIds() {\n    return (\n      this.localState.get<string[] | null>(RECENT_PAGES_KEY) || EMPTY_ARRAY\n    );\n  }\n}\n","import { Fragment, useMemo } from 'react';\n\nimport * as styles from './highlight-text.css';\n\ntype HighlightProps = {\n  text: string;\n  start: string;\n  end: string;\n};\n\nexport const HighlightText = ({ text = '', end, start }: HighlightProps) => {\n  const parts = useMemo(\n    () =>\n      text.split(start).flatMap(part => {\n        if (part.includes(end)) {\n          const [highlighted, ...ending] = part.split(end);\n\n          return [\n            {\n              h: highlighted,\n            },\n            ending.join(),\n          ];\n        } else {\n          return part;\n        }\n      }),\n    [end, start, text]\n  );\n\n  return (\n    <span className={styles.highlightText}>\n      {parts.map((part, i) =>\n        typeof part === 'string' ? (\n          <Fragment key={i}>{part}</Fragment>\n        ) : (\n          <span key={i} className={styles.highlightKeyword}>\n            {part.h}\n          </span>\n        )\n      )}\n    </span>\n  );\n};\n","import \"../core/src/modules/quicksearch/views/highlight-text.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/modules/quicksearch/views/highlight-text.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xZHhvcG9sMCB7CiAgd2hpdGUtc3BhY2U6IG5vd3JhcDsKICBvdmVyZmxvdzogaGlkZGVuOwogIHRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzOwp9Ci5fMWR4b3BvbDEgewogIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICB2ZXJ0aWNhbC1hbGlnbjogYm90dG9tOwogIGNvbG9yOiB2YXIoLS1hZmZpbmUtcHJpbWFyeS1jb2xvcik7CiAgd2hpdGUtc3BhY2U6IHByZTsKICBvdmVyZmxvdzogaGlkZGVuOwogIHRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzOwogIGZsZXgtc2hyaW5rOiAwOwogIG1heC13aWR0aDogMzYwcHg7Cn0=\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var highlightKeyword = '_1dxopol1';\nexport var highlightText = '_1dxopol0';","import { Loading } from '@affine/component/ui/loading';\nimport { i18nTime, isI18nString, useI18n } from '@affine/i18n';\nimport clsx from 'clsx';\nimport { Command } from 'cmdk';\nimport {\n  type ReactNode,\n  useCallback,\n  useEffect,\n  useLayoutEffect,\n  useMemo,\n  useReducer,\n  useRef,\n  useState,\n} from 'react';\n\nimport type { QuickSearchGroup } from '../types/group';\nimport type { QuickSearchItem } from '../types/item';\nimport * as styles from './cmdk.css';\nimport { HighlightText } from './highlight-text';\n\ntype Groups = { group?: QuickSearchGroup; items: QuickSearchItem[] }[];\n\nexport const CMDK = ({\n  className,\n  query,\n  groups: newGroups = [],\n  inputLabel,\n  placeholder,\n  loading: newLoading = false,\n  loadingProgress,\n  onQueryChange,\n  onSubmit,\n}: React.PropsWithChildren<{\n  className?: string;\n  query: string;\n  inputLabel?: ReactNode;\n  placeholder?: string;\n  loading?: boolean;\n  loadingProgress?: number;\n  groups?: Groups;\n  onSubmit?: (item: QuickSearchItem) => void;\n  onQueryChange?: (query: string) => void;\n}>) => {\n  const [opening, setOpening] = useState(false);\n  const [loading, setLoading] = useState(false);\n\n  const [{ groups, selectedValue }, dispatch] = useReducer(\n    (\n      state: {\n        groups: Groups;\n        selectedValue: string;\n      },\n      action:\n        | { type: 'select'; payload: string }\n        | { type: 'reset-select' }\n        | { type: 'update-groups'; payload: Groups }\n    ) => {\n      // control the currently selected item so that when the item list changes, the selected item remains controllable\n      if (action.type === 'select') {\n        return {\n          ...state,\n          selectedValue: action.payload,\n        };\n      }\n      if (action.type === 'reset-select') {\n        // reset selected item to the first item\n        const firstItem = state.groups.at(0)?.items.at(0)?.id;\n        return {\n          ...state,\n          selectedValue: firstItem ?? '',\n        };\n      }\n      if (action.type === 'update-groups') {\n        const prevGroups = state.groups;\n        const prevSelectedValue = state.selectedValue;\n\n        const prevFirstItem = prevGroups.at(0)?.items.at(0)?.id;\n        const newFirstItem = action.payload.at(0)?.items.at(0)?.id;\n        const isSelectingFirstItem = prevSelectedValue === prevFirstItem;\n        // if previous selected item is the first item, select the new first item\n        if (isSelectingFirstItem) {\n          return {\n            ...state,\n            groups: action.payload,\n            selectedValue: newFirstItem ?? '',\n          };\n        }\n\n        const selectedExists = state.groups.some(({ items }) =>\n          items.some(item => item.id === prevSelectedValue)\n        );\n        // if previous selected item exists in the new list, keep it\n        if (selectedExists) {\n          return {\n            ...state,\n            groups: action.payload,\n            selectedValue: prevSelectedValue,\n          };\n        }\n\n        // if previous selected item does not exist in the new list, select the new first item\n        return {\n          ...state,\n          groups: action.payload,\n          selectedExists: newFirstItem ?? '',\n        };\n      }\n      return state;\n    },\n    { groups: [], selectedValue: '' }\n  );\n\n  const listRef = useRef<HTMLDivElement>(null);\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  // fix list height animation on opening\n  useLayoutEffect(() => {\n    setOpening(true);\n    const timeout = setTimeout(() => {\n      setOpening(false);\n      inputRef.current?.focus();\n    }, 150);\n    return () => {\n      clearTimeout(timeout);\n    };\n  }, []);\n\n  const handleValueChange = useCallback(\n    (query: string) => {\n      onQueryChange?.(query);\n      dispatch({\n        type: 'reset-select',\n      });\n      requestAnimationFrame(() => {\n        if (listRef.current) listRef.current.scrollTop = 0;\n      });\n    },\n    [onQueryChange]\n  );\n\n  const handleSelectChange = useCallback(\n    (value: string) => {\n      dispatch({\n        type: 'select',\n        payload: value,\n      });\n    },\n    [dispatch]\n  );\n\n  useEffect(() => {\n    // on group change\n    dispatch({\n      type: 'update-groups',\n      payload: newGroups,\n    });\n  }, [newGroups]);\n\n  useEffect(() => {\n    // debounce loading state\n    const timeout = setTimeout(() => setLoading(newLoading), 1000);\n    return () => clearTimeout(timeout);\n  }, [newLoading]);\n\n  return (\n    <Command\n      data-testid=\"cmdk-quick-search\"\n      shouldFilter={false}\n      className={clsx(className, styles.root, styles.panelContainer)}\n      value={selectedValue}\n      onValueChange={handleSelectChange}\n      loop\n    >\n      {inputLabel ? (\n        <div className={styles.pageTitleWrapper}>\n          <span className={styles.pageTitle}>{inputLabel}</span>\n        </div>\n      ) : null}\n      <div\n        className={clsx(className, styles.searchInputContainer, {\n          [styles.hasInputLabel]: inputLabel,\n        })}\n      >\n        <Command.Input\n          placeholder={placeholder}\n          ref={inputRef}\n          value={query}\n          onValueChange={handleValueChange}\n          className={clsx(className, styles.searchInput)}\n        />\n        {loading ? (\n          <Loading\n            size={24}\n            progress={\n              loadingProgress ? Math.max(loadingProgress, 0.2) : undefined\n            }\n            speed={loadingProgress ? 0 : undefined}\n          />\n        ) : null}\n      </div>\n\n      <Command.List ref={listRef} data-opening={opening ? true : undefined}>\n        {groups.map(({ group, items }) => {\n          return (\n            <CMDKGroup\n              key={group?.id ?? ''}\n              onSubmit={onSubmit}\n              query={query}\n              group={{ group, items }}\n            />\n          );\n        })}\n      </Command.List>\n    </Command>\n  );\n};\n\nexport const CMDKGroup = ({\n  group: { group, items },\n  onSubmit,\n  query,\n}: {\n  group: { group?: QuickSearchGroup; items: QuickSearchItem[] };\n  onSubmit?: (item: QuickSearchItem) => void;\n  query: string;\n}) => {\n  const i18n = useI18n();\n  return (\n    <Command.Group\n      key={query + ':' + (group?.id ?? '')}\n      heading={group && i18n.t(group.label)}\n      style={{ overflowAnchor: 'none' }}\n    >\n      {items.map(item => {\n        const title = !isI18nString(item.label)\n          ? i18n.t(item.label.title)\n          : i18n.t(item.label);\n        const subTitle = !isI18nString(item.label)\n          ? item.label.subTitle && i18n.t(item.label.subTitle)\n          : null;\n        return (\n          <Command.Item\n            key={item.id}\n            onSelect={() => onSubmit?.(item)}\n            value={item.id}\n            disabled={item.disabled}\n            data-is-danger={\n              item.id === 'editor:page-move-to-trash' ||\n              item.id === 'editor:edgeless-move-to-trash'\n            }\n          >\n            <div className={styles.itemIcon}>\n              {item.icon &&\n                (typeof item.icon === 'function' ? <item.icon /> : item.icon)}\n            </div>\n            <div\n              data-testid=\"cmdk-label\"\n              className={styles.itemLabel}\n              data-value={item.id}\n            >\n              <div className={styles.itemTitle}>\n                <HighlightText text={title} start=\"<b>\" end=\"</b>\" />\n              </div>\n              {subTitle && (\n                <div className={styles.itemSubtitle}>\n                  <HighlightText text={subTitle} start=\"<b>\" end=\"</b>\" />\n                </div>\n              )}\n            </div>\n            {item.timestamp ? (\n              <div className={styles.timestamp}>\n                {i18nTime(new Date(item.timestamp))}\n              </div>\n            ) : null}\n            {item.keyBinding ? (\n              <CMDKKeyBinding keyBinding={item.keyBinding} />\n            ) : null}\n          </Command.Item>\n        );\n      })}\n    </Command.Group>\n  );\n};\n\nconst CMDKKeyBinding = ({ keyBinding }: { keyBinding: string }) => {\n  const isMacOS = environment.isBrowser && environment.isMacOs;\n  const fragments = useMemo(() => {\n    return keyBinding.split('+').map(fragment => {\n      if (fragment === '$mod') {\n        return isMacOS ? '' : 'Ctrl';\n      }\n      if (fragment === 'Alt') {\n        return isMacOS ? '' : 'Alt';\n      }\n      if (fragment.startsWith('Key')) {\n        return fragment.slice(3);\n      }\n      if (fragment === 'ArrowUp') {\n        return '';\n      }\n      if (fragment === 'ArrowDown') {\n        return '';\n      }\n      if (fragment === 'ArrowLeft') {\n        return '';\n      }\n      if (fragment === 'ArrowRight') {\n        return '';\n      }\n      return fragment;\n    });\n  }, [isMacOS, keyBinding]);\n\n  return (\n    <div className={styles.keybinding}>\n      {fragments.map((fragment, index) => {\n        return (\n          <div key={index} className={styles.keybindingFragment}>\n            {fragment}\n          </div>\n        );\n      })}\n    </div>\n  );\n};\n","import \"../core/src/modules/quicksearch/views/cmdk.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/modules/quicksearch/views/cmdk.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACq1X227jNhB9z1fwpUCMloZ8idfLoF8SBAVFji2uKZIgqdhpsf9eUNQ9kiNl980ekjNnzly1/mfzw+92T8UG/feA0Ekrj534FwjaJub2/IBQTu1ZKGzFOfMEbQ5RepJwwy6zQl0ISoKEC2ckfSflURBQKc4KCw+5I4iB8mCDmGmpLUFv1D5iTE8noQALphV2wLTi1L6vnh9+PqxrYNshsM0+QpDhZQYVrvXTlHIPN4+NFTm177i8sKo9IGgTfuo3sCeprwRlgnNQQVa+ag9ASmGccOHomgkP2BnKgCClr5aaHuIEvbCcX7DV2r+W6BuUSfLH6NWz1YXBGVAu1Dm+MZSHPwQdo7uTrjW8dZ1r6eo9KOU31965VsgOSTLC6eHbNNrXl0hWRNtEX2kFo4+kcBUbOb01NvZJnWZCNcJjJWvpp4XXtcQxq6XEKWT0TQRKmFaeijJqtYZcqMfdLjG3vxCjkj1GEhoclaUV+jOwu1q1eV7Sjaokj5ZSavG58B4sQc7TVEJ7hqso4VRqdiFosx2+vAruM4J8FgG2B5N1EKOIvKXKGWpB+Wk+idL+8YVTT7E2oELyrEqOy9fCC61IRQpabxwC6u5EhxB8hfQiPG5glsoqHypWao7LvwtUYZ8VeVoqTLXlYLGlXBSOoKqgU8ouIbUUx0wKQ1BDrr5nKQtJ8Ym9juYR2rl4EwFPXT9fNBWP5xjsxHnUWmiag7qqu2q3TvYVcU2rOJhbk4JT7bewLuDhcKKF9M+T0SgcWOxAAvN3qrpEGhMw3gX+t7cFvA5oGBDQ4edj+1piJsqEw5yqM9iFtsFabTttcyxW/TuLKFj3h+uXM2G+4zMsft2fT0xul5vcjUzHkZwvlw0uLLDY0JiWRa56mvbj1TJRBE3BbEK3DztN3GGqRvdhTD/1J/K2HRHjtTNn/PZGbb1sLRryv2NtidO45/en3Wtu8R560T0cBs2q4b6zZabae503O88A19zwnqlpR3EVoVrzxtyQ01LwgU/xVn897C64Hb++dbMBe90x1k6sytpxMCSPk0UytabeS6UMP63u5e2RECMpg0xLXk2mBRnWUfR9vLzm5PmilA7TrXamrolh9Vt9xRbCItgfSfSXMBa5wmXebAcRSxd1lh+F8+IUXFIelB9tOkmz8Iw2j0WEzS9VD9aLSba3+/5yV5NfGi6XyZO2OUGFMWDZcItkw2+0j0yn1MFI3+s2zGv7TdCYLmkmNa2Lu14HI/8c473OPBvhz/8BqodS4VMPAAA=\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var hasInputLabel = '_1jt335u7 _1jt335u6';\nexport var itemIcon = '_1jt335u1';\nexport var itemLabel = '_1jt335u2';\nexport var itemSubtitle = '_1jt335ud';\nexport var itemTitle = '_1jt335uc';\nexport var keybinding = '_1jt335ua';\nexport var keybindingFragment = '_1jt335ub';\nexport var pageTitle = '_1jt335u5';\nexport var pageTitleWrapper = '_1jt335u4';\nexport var panelContainer = '_1jt335u3';\nexport var root = '_1jt335u0';\nexport var searchInput = '_1jt335u8';\nexport var searchInputContainer = '_1jt335u6';\nexport var timestamp = '_1jt335u9';","import * as Dialog from '@radix-ui/react-dialog';\nimport { assignInlineVars } from '@vanilla-extract/dynamic';\nimport { useEffect } from 'react';\nimport { useTransition } from 'react-transition-state';\n\nimport * as styles from './modal.css';\n\n// a QuickSearch modal that can be used to display a QuickSearch command\n// it has a smooth animation and can be closed by clicking outside of the modal\n\nexport interface QuickSearchModalProps {\n  open: boolean;\n  onOpenChange?: (open: boolean) => void;\n}\n\nconst animationTimeout = 120;\n\nexport const QuickSearchModal = ({\n  onOpenChange,\n  open,\n  children,\n}: React.PropsWithChildren<QuickSearchModalProps>) => {\n  const [{ status }, toggle] = useTransition({\n    timeout: animationTimeout,\n  });\n  useEffect(() => {\n    toggle(open);\n  }, [open]);\n  return (\n    <Dialog.Root modal open={status !== 'exited'} onOpenChange={onOpenChange}>\n      <Dialog.Portal>\n        <Dialog.Overlay className={styles.modalOverlay} />\n        <div className={styles.modalContentWrapper}>\n          <Dialog.Content\n            style={assignInlineVars({\n              [styles.animationTimeout]: `${animationTimeout}ms`,\n            })}\n            className={styles.modalContent}\n            data-state={status}\n          >\n            {children}\n          </Dialog.Content>\n        </div>\n      </Dialog.Portal>\n    </Dialog.Root>\n  );\n};\n","import \"../core/src/modules/quicksearch/views/modal.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/modules/quicksearch/views/modal.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACrWUYWvbMBCGv+dX3JdBAlGQ0yRrFQr9G2WUcZHOzq2yZCQlcTr634dlZ23aEtrBvhjp7tV7j+9k3z3SsQxYU4SfxXe8qZZawu8RQBl8nRcAvkHN6ahArvM+BXSx9KFW/dJiovuxmH+bQNRoaSxnN6tJp30eAST/1qa4ZCNPJsXg8Dy6e89YZM/31v9E+NGrfpVxdiKbZ6fGR07snYKSWzKdil2kNBBuUD9Wwe+cEdpbHwb3BgO51AmeBDtDrYI9hrEQWJbsSAxRUXuDdrJ+XfbqM2UNx8biUUFpqe0CaLlyghPVsQ+KmDBkgl+7mLg8Cu1dIpcUaHKJwufhABo0hl2loLjab6FYNW1+nHEvM/eBTdoqWC1k037cn7NSr9J+T8HiUTToyPbiXHvjWxG3aPzhzVldmyEx6IKhIAIa3kUFxbwHqLEVA5RGq8eFlPsDCFjKps3nanYnweJ6oPa7ZNmRAucdrc/GEchi4j19pX0HtlboLbqK1MtFnJ7u6HkbfxhM2E0v0W0eFJmHKVzIs6secu/RcY095csfoEc77RcT0LsNa7GhJ6YwlrPFfApyCnK2vJ5C/xX89RFlB157QwpKHw4YTLwA23K6xNpyuoRa/A/UP91+x/cVBQAA\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var animationTimeout = 'var(--_17a9g5c4)';\nexport var modalContent = '_17a9g5c5';\nexport var modalContentWrapper = '_17a9g5c3';\nexport var modalOverlay = '_17a9g5c2';","import { useI18n } from '@affine/i18n';\nimport { useLiveData, useServices } from '@toeverything/infra';\nimport { useCallback, useMemo } from 'react';\n\nimport { QuickSearchService } from '../services/quick-search';\nimport type { QuickSearchGroup } from '../types/group';\nimport type { QuickSearchItem } from '../types/item';\nimport { CMDK } from './cmdk';\nimport { QuickSearchModal } from './modal';\n\nexport const QuickSearchContainer = () => {\n  const { quickSearchService } = useServices({\n    QuickSearchService,\n  });\n  const quickSearch = quickSearchService.quickSearch;\n  const open = useLiveData(quickSearch.show$);\n  const query = useLiveData(quickSearch.query$);\n  const loading = useLiveData(quickSearch.isLoading$);\n  const loadingProgress = useLiveData(quickSearch.loadingProgress$);\n  const items = useLiveData(quickSearch.items$);\n  const options = useLiveData(quickSearch.options$);\n  const i18n = useI18n();\n\n  const onToggleQuickSearch = useCallback(\n    (open: boolean) => {\n      if (open) {\n        // should never be here\n      } else {\n        quickSearch.hide();\n      }\n    },\n    [quickSearch]\n  );\n\n  const groups = useMemo(() => {\n    const groups: { group?: QuickSearchGroup; items: QuickSearchItem[] }[] = [];\n\n    for (const item of items) {\n      const group = item.group;\n      const existingGroup = groups.find(g => g.group?.id === group?.id);\n      if (existingGroup) {\n        existingGroup.items.push(item);\n      } else {\n        groups.push({ group, items: [item] });\n      }\n    }\n\n    for (const { items } of groups) {\n      items.sort((a, b) => (b.score ?? 0) - (a.score ?? 0));\n    }\n\n    groups.sort((a, b) => {\n      const group = (b.group?.score ?? 0) - (a.group?.score ?? 0);\n      if (group !== 0) {\n        return group;\n      }\n      return (b.items[0].score ?? 0) - (a.items[0].score ?? 0);\n    });\n\n    return groups;\n  }, [items]);\n\n  const handleChangeQuery = useCallback(\n    (query: string) => {\n      quickSearch.setQuery(query);\n    },\n    [quickSearch]\n  );\n\n  const handleSubmit = useCallback(\n    (item: QuickSearchItem) => {\n      quickSearch.submit(item);\n    },\n    [quickSearch]\n  );\n\n  return (\n    <QuickSearchModal open={open} onOpenChange={onToggleQuickSearch}>\n      <CMDK\n        query={query}\n        groups={groups}\n        loading={loading}\n        loadingProgress={loadingProgress}\n        onQueryChange={handleChangeQuery}\n        onSubmit={handleSubmit}\n        inputLabel={options?.label && i18n.t(options.label)}\n        placeholder={options?.placeholder && i18n.t(options.placeholder)}\n      />\n    </QuickSearchModal>\n  );\n};\n","import {\n  DocsService,\n  type Framework,\n  GlobalContextService,\n  WorkspaceLocalState,\n  WorkspaceScope,\n} from '@toeverything/infra';\n\nimport { CollectionService } from '../collection';\nimport { DocsSearchService } from '../docs-search';\nimport { WorkspacePropertiesAdapter } from '../properties';\nimport { WorkbenchService } from '../workbench';\nimport { QuickSearch } from './entities/quick-search';\nimport { CollectionsQuickSearchSession } from './impls/collections';\nimport { CommandsQuickSearchSession } from './impls/commands';\nimport { CreationQuickSearchSession } from './impls/creation';\nimport { DocsQuickSearchSession } from './impls/docs';\nimport { RecentDocsQuickSearchSession } from './impls/recent-docs';\nimport { CMDKQuickSearchService } from './services/cmdk';\nimport { DocDisplayMetaService } from './services/doc-display-meta';\nimport { QuickSearchService } from './services/quick-search';\nimport { RecentDocsService } from './services/recent-pages';\n\nexport { QuickSearch } from './entities/quick-search';\nexport { QuickSearchService, RecentDocsService };\nexport { CollectionsQuickSearchSession } from './impls/collections';\nexport { CommandsQuickSearchSession } from './impls/commands';\nexport { CreationQuickSearchSession } from './impls/creation';\nexport { DocsQuickSearchSession } from './impls/docs';\nexport { RecentDocsQuickSearchSession } from './impls/recent-docs';\nexport type { QuickSearchItem } from './types/item';\nexport { QuickSearchContainer } from './views/container';\n\nexport function configureQuickSearchModule(framework: Framework) {\n  framework\n    .scope(WorkspaceScope)\n    .service(QuickSearchService)\n    .service(CMDKQuickSearchService, [\n      QuickSearchService,\n      WorkbenchService,\n      DocsService,\n    ])\n    .service(RecentDocsService, [WorkspaceLocalState, DocsService])\n    .service(DocDisplayMetaService, [WorkspacePropertiesAdapter])\n    .entity(QuickSearch)\n    .entity(CommandsQuickSearchSession, [GlobalContextService])\n    .entity(DocsQuickSearchSession, [\n      DocsSearchService,\n      DocsService,\n      DocDisplayMetaService,\n    ])\n    .entity(CreationQuickSearchSession)\n    .entity(CollectionsQuickSearchSession, [CollectionService])\n    .entity(RecentDocsQuickSearchSession, [\n      RecentDocsService,\n      DocDisplayMetaService,\n    ]);\n}\n","import { track } from '@affine/core/mixpanel';\nimport type { DocsService } from '@toeverything/infra';\nimport { Service } from '@toeverything/infra';\n\nimport type { WorkbenchService } from '../../workbench';\nimport { CollectionsQuickSearchSession } from '../impls/collections';\nimport { CommandsQuickSearchSession } from '../impls/commands';\nimport { CreationQuickSearchSession } from '../impls/creation';\nimport { DocsQuickSearchSession } from '../impls/docs';\nimport { RecentDocsQuickSearchSession } from '../impls/recent-docs';\nimport type { QuickSearchService } from './quick-search';\n\nexport class CMDKQuickSearchService extends Service {\n  constructor(\n    private readonly quickSearchService: QuickSearchService,\n    private readonly workbenchService: WorkbenchService,\n    private readonly docsService: DocsService\n  ) {\n    super();\n  }\n\n  toggle() {\n    if (this.quickSearchService.quickSearch.show$.value) {\n      this.quickSearchService.quickSearch.hide();\n    } else {\n      this.quickSearchService.quickSearch.show(\n        [\n          this.framework.createEntity(RecentDocsQuickSearchSession),\n          this.framework.createEntity(CollectionsQuickSearchSession),\n          this.framework.createEntity(CommandsQuickSearchSession),\n          this.framework.createEntity(CreationQuickSearchSession),\n          this.framework.createEntity(DocsQuickSearchSession),\n        ],\n        result => {\n          if (!result) {\n            return;\n          }\n          if (result.source === 'commands') {\n            result.payload.run()?.catch(err => {\n              console.error(err);\n            });\n          } else if (\n            result.source === 'recent-doc' ||\n            result.source === 'docs'\n          ) {\n            const doc: {\n              docId: string;\n              blockId?: string;\n            } = result.payload;\n\n            result.source === 'recent-doc' && track.$.cmdk.recent.recentDocs();\n            result.source === 'docs' &&\n              track.$.cmdk.results.searchResultsDocs();\n\n            this.workbenchService.workbench.openDoc({\n              docId: doc.docId,\n              blockId: doc.blockId,\n            });\n          } else if (result.source === 'collections') {\n            this.workbenchService.workbench.openCollection(\n              result.payload.collectionId\n            );\n          } else if (result.source === 'creation') {\n            if (result.id === 'creation:create-page') {\n              const newDoc = this.docsService.createDoc({\n                mode: 'page',\n                title: result.payload.title,\n              });\n              this.workbenchService.workbench.openDoc(newDoc.id);\n            } else if (result.id === 'creation:create-edgeless') {\n              const newDoc = this.docsService.createDoc({\n                mode: 'edgeless',\n                title: result.payload.title,\n              });\n              this.workbenchService.workbench.openDoc(newDoc.id);\n            }\n          }\n        },\n        {\n          placeholder: {\n            key: 'com.affine.cmdk.docs.placeholder',\n          },\n        }\n      );\n    }\n  }\n}\n","export function highlighter(\n  originText: string,\n  before: string,\n  after: string,\n  matches: [number, number][],\n  {\n    maxLength = 50,\n    maxPrefix = 20,\n  }: { maxLength?: number; maxPrefix?: number } = {}\n) {\n  if (!originText) {\n    return;\n  }\n  const merged = mergeRanges(matches);\n\n  if (merged.length === 0) {\n    return null;\n  }\n\n  const firstMatch = merged[0][0];\n  const start = Math.max(\n    0,\n    Math.min(firstMatch - maxPrefix, originText.length - maxLength)\n  );\n  const end = Math.min(start + maxLength, originText.length);\n  const text = originText.substring(start, end);\n\n  let result = '';\n\n  let pointer = 0;\n  for (const match of merged) {\n    const matchStart = match[0] - start;\n    const matchEnd = match[1] - start;\n    if (matchStart >= text.length) {\n      break;\n    }\n    result += text.substring(pointer, matchStart);\n    pointer = matchStart;\n    const highlighted = text.substring(matchStart, matchEnd);\n\n    if (highlighted.length === 0) {\n      continue;\n    }\n\n    result += `${before}${highlighted}${after}`;\n    pointer = matchEnd;\n  }\n  result += text.substring(pointer);\n\n  if (start > 0) {\n    result = `...${result}`;\n  }\n\n  if (end < originText.length) {\n    result = `${result}...`;\n  }\n\n  return result;\n}\n\nfunction mergeRanges(intervals: [number, number][]) {\n  if (intervals.length === 0) return [];\n\n  intervals.sort((a, b) => a[0] - b[0]);\n\n  const merged = [intervals[0]];\n\n  for (let i = 1; i < intervals.length; i++) {\n    const last = merged[merged.length - 1];\n    const current = intervals[i];\n\n    if (current[0] <= last[1]) {\n      last[1] = Math.max(last[1], current[1]);\n    } else {\n      merged.push(current);\n    }\n  }\n\n  return merged;\n}\n","import { DebugLogger } from '@affine/debug';\nimport type { WorkspaceQuotaQuery } from '@affine/graphql';\nimport type { WorkspaceService } from '@toeverything/infra';\nimport {\n  backoffRetry,\n  catchErrorInto,\n  effect,\n  Entity,\n  fromPromise,\n  LiveData,\n  mapInto,\n  onComplete,\n  onStart,\n} from '@toeverything/infra';\nimport { exhaustMap } from 'rxjs';\n\nimport { isBackendError, isNetworkError } from '../../cloud';\nimport type { WorkspaceQuotaStore } from '../stores/quota';\n\ntype QuotaType = WorkspaceQuotaQuery['workspace']['quota'];\n\nconst logger = new DebugLogger('affine:workspace-permission');\n\nexport class WorkspaceQuota extends Entity {\n  quota$ = new LiveData<QuotaType | null>(null);\n  isLoading$ = new LiveData(false);\n  error$ = new LiveData<any>(null);\n\n  constructor(\n    private readonly workspaceService: WorkspaceService,\n    private readonly store: WorkspaceQuotaStore\n  ) {\n    super();\n  }\n\n  revalidate = effect(\n    exhaustMap(() => {\n      return fromPromise(signal =>\n        this.store.fetchWorkspaceQuota(\n          this.workspaceService.workspace.id,\n          signal\n        )\n      ).pipe(\n        backoffRetry({\n          when: isNetworkError,\n          count: Infinity,\n        }),\n        backoffRetry({\n          when: isBackendError,\n          count: 3,\n        }),\n        mapInto(this.quota$),\n        catchErrorInto(this.error$, error => {\n          logger.error('Failed to fetch isOwner', error);\n        }),\n        onStart(() => this.isLoading$.setValue(true)),\n        onComplete(() => this.isLoading$.setValue(false))\n      );\n    })\n  );\n}\n","import { Service } from '@toeverything/infra';\n\nimport { WorkspaceQuota } from '../entities/quota';\n\nexport class WorkspaceQuotaService extends Service {\n  quota = this.framework.createEntity(WorkspaceQuota);\n}\n","import type { GraphQLService } from '@affine/core/modules/cloud';\nimport { workspaceQuotaQuery } from '@affine/graphql';\nimport { Store } from '@toeverything/infra';\n\nexport class WorkspaceQuotaStore extends Store {\n  constructor(private readonly graphqlService: GraphQLService) {\n    super();\n  }\n\n  async fetchWorkspaceQuota(workspaceId: string, signal?: AbortSignal) {\n    const data = await this.graphqlService.gql({\n      query: workspaceQuotaQuery,\n      variables: {\n        id: workspaceId,\n      },\n      context: {\n        signal,\n      },\n    });\n    return data.workspace.quota;\n  }\n}\n","export { WorkspaceQuotaService } from './services/quota';\n\nimport { GraphQLService } from '@affine/core/modules/cloud';\nimport {\n  type Framework,\n  WorkspaceScope,\n  WorkspaceService,\n} from '@toeverything/infra';\n\nimport { WorkspaceQuota } from './entities/quota';\nimport { WorkspaceQuotaService } from './services/quota';\nimport { WorkspaceQuotaStore } from './stores/quota';\n\nexport function configureQuotaModule(framework: Framework) {\n  framework\n    .scope(WorkspaceScope)\n    .service(WorkspaceQuotaService)\n    .store(WorkspaceQuotaStore, [GraphQLService])\n    .entity(WorkspaceQuota, [WorkspaceService, WorkspaceQuotaStore]);\n}\n","import type {\n  GetWorkspacePublicPageByIdQuery,\n  PublicPageMode,\n} from '@affine/graphql';\nimport type { DocService, WorkspaceService } from '@toeverything/infra';\nimport {\n  backoffRetry,\n  catchErrorInto,\n  effect,\n  Entity,\n  fromPromise,\n  LiveData,\n  mapInto,\n  onComplete,\n  onStart,\n} from '@toeverything/infra';\nimport { switchMap } from 'rxjs';\n\nimport { isBackendError, isNetworkError } from '../../cloud';\nimport type { ShareStore } from '../stores/share';\n\ntype ShareInfoType = GetWorkspacePublicPageByIdQuery['workspace']['publicPage'];\n\nexport class Share extends Entity {\n  info$ = new LiveData<ShareInfoType | undefined | null>(null);\n  isShared$ = this.info$.map(info =>\n    // null means not loaded yet, undefined means not shared\n    info !== null ? info !== undefined : null\n  );\n  sharedMode$ = this.info$.map(info => (info !== null ? info?.mode : null));\n\n  error$ = new LiveData<any>(null);\n  isRevalidating$ = new LiveData<boolean>(false);\n\n  constructor(\n    private readonly workspaceService: WorkspaceService,\n    private readonly docService: DocService,\n    private readonly store: ShareStore\n  ) {\n    super();\n  }\n\n  revalidate = effect(\n    switchMap(() => {\n      return fromPromise(signal =>\n        this.store.getShareInfoByDocId(\n          this.workspaceService.workspace.id,\n          this.docService.doc.id,\n          signal\n        )\n      ).pipe(\n        backoffRetry({\n          when: isNetworkError,\n          count: Infinity,\n        }),\n        backoffRetry({\n          when: isBackendError,\n        }),\n        mapInto(this.info$),\n        catchErrorInto(this.error$),\n        onStart(() => this.isRevalidating$.next(true)),\n        onComplete(() => this.isRevalidating$.next(false))\n      );\n    })\n  );\n\n  waitForRevalidation(signal?: AbortSignal) {\n    this.revalidate();\n    return this.isRevalidating$.waitFor(v => v === false, signal);\n  }\n\n  async enableShare(mode: PublicPageMode) {\n    await this.store.enableSharePage(\n      this.workspaceService.workspace.id,\n      this.docService.doc.id,\n      mode\n    );\n    await this.waitForRevalidation();\n  }\n\n  async changeShare(mode: PublicPageMode) {\n    await this.enableShare(mode);\n  }\n\n  async disableShare() {\n    await this.store.disableSharePage(\n      this.workspaceService.workspace.id,\n      this.docService.doc.id\n    );\n    await this.waitForRevalidation();\n  }\n}\n","import { Service } from '@toeverything/infra';\n\nimport { Share } from '../entities/share-info';\n\nexport class ShareService extends Service {\n  share = this.framework.createEntity(Share);\n}\n","import { DebugLogger } from '@affine/debug';\nimport type { GetWorkspacePublicPagesQuery } from '@affine/graphql';\nimport type { GlobalCache, WorkspaceService } from '@toeverything/infra';\nimport {\n  backoffRetry,\n  catchErrorInto,\n  effect,\n  Entity,\n  fromPromise,\n  LiveData,\n  onComplete,\n  onStart,\n} from '@toeverything/infra';\nimport { EMPTY, mergeMap, switchMap } from 'rxjs';\n\nimport { isBackendError, isNetworkError } from '../../cloud';\nimport type { ShareDocsStore } from '../stores/share-docs';\n\ntype ShareDocListType =\n  GetWorkspacePublicPagesQuery['workspace']['publicPages'];\n\nexport const logger = new DebugLogger('affine:share-doc-list');\n\nexport class ShareDocsList extends Entity {\n  list$ = LiveData.from(this.cache.watch<ShareDocListType>('share-docs'), []);\n  isLoading$ = new LiveData<boolean>(false);\n  error$ = new LiveData<any>(null);\n\n  constructor(\n    private readonly workspaceService: WorkspaceService,\n    private readonly store: ShareDocsStore,\n    private readonly cache: GlobalCache\n  ) {\n    super();\n  }\n\n  revalidate = effect(\n    switchMap(() =>\n      fromPromise(signal => {\n        return this.store.getWorkspacesShareDocs(\n          this.workspaceService.workspace.id,\n          signal\n        );\n      }).pipe(\n        backoffRetry({\n          when: isNetworkError,\n          count: Infinity,\n        }),\n        backoffRetry({\n          when: isBackendError,\n        }),\n        mergeMap(list => {\n          this.cache.set('share-docs', list);\n          return EMPTY;\n        }),\n        catchErrorInto(this.error$, err =>\n          logger.error('revalidate share docs error', err)\n        ),\n        onStart(() => {\n          this.isLoading$.next(true);\n        }),\n        onComplete(() => {\n          this.isLoading$.next(false);\n        })\n      )\n    )\n  );\n}\n","import { WorkspaceFlavour } from '@affine/env/workspace';\nimport type { WorkspaceService } from '@toeverything/infra';\nimport { Service } from '@toeverything/infra';\n\nimport { ShareDocsList } from '../entities/share-docs-list';\n\nexport class ShareDocsService extends Service {\n  constructor(private readonly workspaceService: WorkspaceService) {\n    super();\n  }\n\n  shareDocs =\n    this.workspaceService.workspace.flavour === WorkspaceFlavour.AFFINE_CLOUD\n      ? this.framework.createEntity(ShareDocsList)\n      : null;\n}\n","import type { PublicPageMode } from '@affine/graphql';\nimport {\n  getWorkspacePublicPageByIdQuery,\n  publishPageMutation,\n  revokePublicPageMutation,\n} from '@affine/graphql';\nimport { Store } from '@toeverything/infra';\n\nimport type { GraphQLService } from '../../cloud';\n\nexport class ShareStore extends Store {\n  constructor(private readonly gqlService: GraphQLService) {\n    super();\n  }\n\n  async getShareInfoByDocId(\n    workspaceId: string,\n    docId: string,\n    signal?: AbortSignal\n  ) {\n    const data = await this.gqlService.gql({\n      query: getWorkspacePublicPageByIdQuery,\n      variables: {\n        pageId: docId,\n        workspaceId,\n      },\n      context: {\n        signal,\n      },\n    });\n    return data.workspace.publicPage ?? undefined;\n  }\n\n  async enableSharePage(\n    workspaceId: string,\n    pageId: string,\n    docMode?: PublicPageMode,\n    signal?: AbortSignal\n  ) {\n    await this.gqlService.gql({\n      query: publishPageMutation,\n      variables: {\n        pageId,\n        workspaceId,\n        mode: docMode,\n      },\n      context: {\n        signal,\n      },\n    });\n  }\n\n  async disableSharePage(\n    workspaceId: string,\n    pageId: string,\n    signal?: AbortSignal\n  ) {\n    await this.gqlService.gql({\n      query: revokePublicPageMutation,\n      variables: {\n        pageId,\n        workspaceId,\n      },\n      context: {\n        signal,\n      },\n    });\n  }\n}\n","import type { GraphQLService } from '@affine/core/modules/cloud';\nimport { getWorkspacePublicPagesQuery } from '@affine/graphql';\nimport { Store } from '@toeverything/infra';\n\nexport class ShareDocsStore extends Store {\n  constructor(private readonly graphqlService: GraphQLService) {\n    super();\n  }\n\n  async getWorkspacesShareDocs(workspaceId: string, signal?: AbortSignal) {\n    const data = await this.graphqlService.gql({\n      query: getWorkspacePublicPagesQuery,\n      variables: {\n        workspaceId: workspaceId,\n      },\n      context: {\n        signal,\n      },\n    });\n    return data.workspace.publicPages;\n  }\n}\n","export { ShareService } from './services/share';\nexport { ShareDocsService } from './services/share-docs';\n\nimport {\n  DocScope,\n  DocService,\n  type Framework,\n  WorkspaceLocalCache,\n  WorkspaceScope,\n  WorkspaceService,\n} from '@toeverything/infra';\n\nimport { GraphQLService } from '../cloud';\nimport { ShareDocsList } from './entities/share-docs-list';\nimport { Share } from './entities/share-info';\nimport { ShareService } from './services/share';\nimport { ShareDocsService } from './services/share-docs';\nimport { ShareStore } from './stores/share';\nimport { ShareDocsStore } from './stores/share-docs';\n\nexport function configureShareDocsModule(framework: Framework) {\n  framework\n    .scope(WorkspaceScope)\n    .service(ShareDocsService, [WorkspaceService])\n    .store(ShareDocsStore, [GraphQLService])\n    .entity(ShareDocsList, [\n      WorkspaceService,\n      ShareDocsStore,\n      WorkspaceLocalCache,\n    ])\n    .scope(DocScope)\n    .service(ShareService)\n    .entity(Share, [WorkspaceService, DocService, ShareStore])\n    .store(ShareStore, [GraphQLService]);\n}\n","// hack: map var(--affine-tag-xxx) colors to var(--affine-palette-line-xxx)\nexport const tagColorMap = (color: string) => {\n  const mapping: Record<string, string> = {\n    'var(--affine-tag-red)': 'var(--affine-palette-line-red)',\n    'var(--affine-tag-teal)': 'var(--affine-palette-line-green)',\n    'var(--affine-tag-blue)': 'var(--affine-palette-line-blue)',\n    'var(--affine-tag-yellow)': 'var(--affine-palette-line-yellow)',\n    'var(--affine-tag-pink)': 'var(--affine-palette-line-magenta)',\n    'var(--affine-tag-white)': 'var(--affine-palette-line-grey)',\n    'var(--affine-tag-gray)': 'var(--affine-palette-line-grey)',\n    'var(--affine-tag-orange)': 'var(--affine-palette-line-orange)',\n    'var(--affine-tag-purple)': 'var(--affine-palette-line-purple)',\n    'var(--affine-tag-green)': 'var(--affine-palette-line-green)',\n  };\n  return mapping[color] || color;\n};\n","import type { DocsService } from '@toeverything/infra';\nimport { Entity, LiveData } from '@toeverything/infra';\n\nimport type { TagStore } from '../stores/tag';\nimport { tagColorMap } from './utils';\n\nexport class Tag extends Entity<{ id: string }> {\n  id = this.props.id;\n  constructor(\n    private readonly store: TagStore,\n    private readonly docs: DocsService\n  ) {\n    super();\n  }\n\n  private readonly tagOption$ = LiveData.from(\n    this.store.watchTagInfo(this.id),\n    undefined\n  ).map(tagInfo => tagInfo);\n\n  value$ = this.tagOption$.map(tag => tag?.value || '');\n\n  color$ = this.tagOption$.map(tag => tagColorMap(tag?.color ?? '') || '');\n\n  createDate$ = this.tagOption$.map(tag => tag?.createDate || Date.now());\n\n  updateDate$ = this.tagOption$.map(tag => tag?.updateDate || Date.now());\n\n  rename(value: string) {\n    this.store.updateTagInfo(this.id, {\n      id: this.id,\n      value,\n      color: this.color$.value,\n      createDate: this.createDate$.value,\n      updateDate: Date.now(),\n    });\n  }\n\n  changeColor(color: string) {\n    this.store.updateTagInfo(this.id, {\n      color,\n    });\n  }\n\n  tag(pageId: string) {\n    const pageRecord = this.docs.list.doc$(pageId).value;\n    if (!pageRecord) {\n      return;\n    }\n    pageRecord?.setMeta({\n      tags: [...(pageRecord.meta$.value.tags ?? []), this.id],\n    });\n  }\n\n  untag(pageId: string) {\n    const pageRecord = this.docs.list.doc$(pageId).value;\n    if (!pageRecord) {\n      return;\n    }\n    pageRecord?.setMeta({\n      tags: pageRecord.meta$.value.tags?.filter(tagId => tagId !== this.id),\n    });\n  }\n\n  /**\n   * @deprecated performance issue here, use with caution until it is fixed\n   * @fixme(EYHN): page.meta$ has performance issue\n   */\n  readonly pageIds$ = LiveData.computed(get => {\n    const pages = get(this.docs.list.docs$);\n    return pages\n      .filter(page => get(page.meta$).tags?.includes(this.id))\n      .map(page => page.id);\n  });\n}\n","import type { DocsService } from '@toeverything/infra';\nimport { Entity, LiveData } from '@toeverything/infra';\n\nimport { Tag } from '../entities/tag';\nimport type { TagStore } from '../stores/tag';\n\nexport class TagList extends Entity {\n  constructor(\n    private readonly store: TagStore,\n    private readonly docs: DocsService\n  ) {\n    super();\n  }\n\n  private readonly pool = new Map<string, Tag>();\n\n  readonly tags$ = LiveData.from(this.store.watchTagIds(), []).map(ids => {\n    return ids.map(id => {\n      const exists = this.pool.get(id);\n      if (exists) {\n        return exists;\n      }\n      const record = this.framework.createEntity(Tag, { id });\n      this.pool.set(id, record);\n      return record;\n    });\n  });\n\n  createTag(value: string, color: string) {\n    const newId = this.store.createNewTag(value, color);\n    const newTag = this.framework.createEntity(Tag, { id: newId });\n    return newTag;\n  }\n\n  deleteTag(tagId: string) {\n    this.store.deleteTag(tagId);\n  }\n\n  tagsByPageId$(pageId: string) {\n    return LiveData.computed(get => {\n      const docRecord = get(this.docs.list.doc$(pageId));\n      if (!docRecord) return [];\n      const tagIds = get(docRecord.meta$).tags;\n\n      return get(this.tags$).filter(tag => (tagIds ?? []).includes(tag.id));\n    });\n  }\n\n  tagIdsByPageId$(pageId: string) {\n    return this.tagsByPageId$(pageId).map(tags => tags.map(tag => tag.id));\n  }\n\n  tagByTagId$(tagId?: string) {\n    return this.tags$.map(tags => tags.find(tag => tag.id === tagId));\n  }\n\n  tagMetas$ = LiveData.computed(get => {\n    return get(this.tags$).map(tag => {\n      return {\n        id: tag.id,\n        title: get(tag.value$),\n        color: get(tag.color$),\n        pageCount: get(tag.pageIds$).length,\n        createDate: get(tag.createDate$),\n        updatedDate: get(tag.updateDate$),\n      };\n    });\n  });\n\n  private filterFn(value: string, query?: string) {\n    const trimmedQuery = query?.trim().toLowerCase() ?? '';\n    const trimmedValue = value.trim().toLowerCase();\n    return trimmedValue.includes(trimmedQuery);\n  }\n\n  filterTagsByName$(name: string) {\n    return LiveData.computed(get => {\n      return get(this.tags$).filter(tag =>\n        this.filterFn(get(tag.value$), name)\n      );\n    });\n  }\n}\n","import { Service } from '@toeverything/infra';\nimport { cssVar } from '@toeverything/theme';\n\nimport { TagList } from '../entities/tag-list';\n\ntype TagColorHelper<T> = T extends `paletteLine${infer Color}` ? Color : never;\nexport type TagColorName = TagColorHelper<Parameters<typeof cssVar>[0]>;\n\nconst tagColorIds: TagColorName[] = [\n  'Red',\n  'Magenta',\n  'Orange',\n  'Yellow',\n  'Green',\n  'Teal',\n  'Blue',\n  'Purple',\n  'Grey',\n];\n\nexport class TagService extends Service {\n  tagList = this.framework.createEntity(TagList);\n\n  tagColors = tagColorIds.map(\n    color => [color, cssVar(`paletteLine${color}`)] as const\n  );\n\n  randomTagColor() {\n    const randomIndex = Math.floor(Math.random() * this.tagColors.length);\n    return this.tagColors[randomIndex][1];\n  }\n}\n","import { ConfirmModal, toast } from '@affine/component';\nimport { Trans, useI18n } from '@affine/i18n';\nimport { useLiveData, useService } from '@toeverything/infra';\nimport { useCallback, useMemo } from 'react';\n\nimport { TagService } from '../service/tag';\n\nexport const DeleteTagConfirmModal = ({\n  open,\n  onOpenChange,\n  selectedTagIds,\n}: {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  selectedTagIds: string[];\n}) => {\n  const t = useI18n();\n  const tagService = useService(TagService);\n  const tags = useLiveData(tagService.tagList.tags$);\n  const selectedTags = useMemo(() => {\n    return tags.filter(tag => selectedTagIds.includes(tag.id));\n  }, [selectedTagIds, tags]);\n  const tagName = useLiveData(selectedTags[0]?.value$ || '');\n\n  const handleDelete = useCallback(() => {\n    selectedTagIds.forEach(tagId => {\n      tagService.tagList.deleteTag(tagId);\n    });\n\n    toast(\n      selectedTagIds.length > 1\n        ? t['com.affine.delete-tags.count']({ count: selectedTagIds.length })\n        : t['com.affine.tags.delete-tags.toast']()\n    );\n\n    onOpenChange(false);\n  }, [onOpenChange, selectedTagIds, t, tagService]);\n\n  return (\n    <ConfirmModal\n      open={open}\n      onOpenChange={onOpenChange}\n      title={t['com.affine.delete-tags.confirm.title']()}\n      description={\n        selectedTags.length === 1 ? (\n          <Trans\n            i18nKey={'com.affine.delete-tags.confirm.description'}\n            values={{ tag: tagName }}\n            components={{ 1: <strong /> }}\n          />\n        ) : (\n          t['com.affine.delete-tags.confirm.multi-tag-description']({\n            count: selectedTags.length.toString(),\n          })\n        )\n      }\n      confirmText={t['Delete']()}\n      confirmButtonOptions={{\n        variant: 'error',\n      }}\n      onConfirm={handleDelete}\n    />\n  );\n};\n","import type { Tag as TagSchema } from '@affine/env/filter';\nimport { Store } from '@toeverything/infra';\nimport { nanoid } from 'nanoid';\n\nimport type { WorkspaceLegacyProperties } from '../../properties';\n\nexport class TagStore extends Store {\n  constructor(private readonly properties: WorkspaceLegacyProperties) {\n    super();\n  }\n\n  watchTagIds() {\n    return this.properties.tagOptions$\n      .map(tags => tags.map(tag => tag.id))\n      .asObservable();\n  }\n\n  createNewTag(value: string, color: string) {\n    const newId = nanoid();\n    this.properties.updateTagOptions([\n      ...this.properties.tagOptions$.value,\n      {\n        id: newId,\n        value,\n        color,\n        createDate: Date.now(),\n        updateDate: Date.now(),\n      },\n    ]);\n    return newId;\n  }\n\n  deleteTag(id: string) {\n    this.properties.removeTagOption(id);\n  }\n\n  watchTagInfo(id: string) {\n    return this.properties.tagOptions$.map(\n      tags => tags.find(tag => tag.id === id) as TagSchema | undefined\n    );\n  }\n\n  updateTagInfo(id: string, tagInfo: Partial<TagSchema>) {\n    const tag = this.properties.tagOptions$.value.find(tag => tag.id === id) as\n      | TagSchema\n      | undefined;\n    if (!tag) {\n      return;\n    }\n    this.properties.updateTagOption(id, {\n      id: id,\n      value: tag.value,\n      color: tag.color,\n      createDate: tag.createDate,\n      updateDate: Date.now(),\n      ...tagInfo,\n    });\n  }\n}\n","export { Tag } from './entities/tag';\nexport { tagColorMap } from './entities/utils';\nexport { TagService } from './service/tag';\nexport { DeleteTagConfirmModal } from './view/delete-tag-modal';\n\nimport {\n  DocsService,\n  type Framework,\n  WorkspaceScope,\n} from '@toeverything/infra';\n\nimport { WorkspaceLegacyProperties } from '../properties';\nimport { Tag } from './entities/tag';\nimport { TagList } from './entities/tag-list';\nimport { TagService } from './service/tag';\nimport { TagStore } from './stores/tag';\n\nexport function configureTagModule(framework: Framework) {\n  framework\n    .scope(WorkspaceScope)\n    .service(TagService)\n    .store(TagStore, [WorkspaceLegacyProperties])\n    .entity(TagList, [TagStore, DocsService])\n    .entity(Tag, [TagStore, DocsService]);\n}\n","import type { GlobalState } from '@toeverything/infra';\nimport { LiveData, Service } from '@toeverything/infra';\nimport { map } from 'rxjs';\n\nimport type { CustomTheme } from '../types';\n\nexport class ThemeEditorService extends Service {\n  constructor(public readonly globalState: GlobalState) {\n    super();\n  }\n\n  private readonly _key = 'custom-theme';\n\n  customTheme$ = LiveData.from<CustomTheme | undefined>(\n    this.globalState.watch<CustomTheme>(this._key).pipe(\n      map(value => {\n        if (!value) return { light: {}, dark: {} };\n        if (!value.light) value.light = {};\n        if (!value.dark) value.dark = {};\n        const removeEmpty = (obj: Record<string, string>) =>\n          Object.fromEntries(Object.entries(obj).filter(([, v]) => v));\n        return {\n          light: removeEmpty(value.light),\n          dark: removeEmpty(value.dark),\n        };\n      })\n    ),\n    { light: {}, dark: {} }\n  );\n\n  modified$ = LiveData.computed(get => {\n    const theme = get(this.customTheme$);\n    const isEmptyObj = (obj: Record<string, string>) =>\n      Object.keys(obj).length === 0;\n    return theme && !(isEmptyObj(theme.light) && isEmptyObj(theme.dark));\n  });\n\n  reset() {\n    this.globalState.set(this._key, { light: {}, dark: {} });\n  }\n\n  setCustomTheme(theme: CustomTheme) {\n    this.globalState.set(this._key, theme);\n  }\n\n  updateCustomTheme(mode: 'light' | 'dark', key: string, value?: string) {\n    const prev: CustomTheme = this.globalState.get(this._key) ?? {\n      light: {},\n      dark: {},\n    };\n    const next = {\n      ...prev,\n      [mode]: {\n        ...prev[mode],\n        [key]: value,\n      },\n    };\n\n    if (!value) {\n      delete next[mode][key];\n    }\n\n    this.globalState.set(this._key, next);\n  }\n}\n","import { useService } from '@toeverything/infra';\nimport { useTheme } from 'next-themes';\nimport { useEffect } from 'react';\n\nimport { ThemeEditorService } from '../services/theme-editor';\n\nlet _provided = false;\n\nexport const useCustomTheme = (target: HTMLElement) => {\n  const themeEditor = useService(ThemeEditorService);\n  const { resolvedTheme } = useTheme();\n\n  useEffect(() => {\n    if (!runtimeConfig.enableThemeEditor) return;\n    if (_provided) return;\n\n    _provided = true;\n\n    const sub = themeEditor.customTheme$.subscribe(themeObj => {\n      if (!themeObj) return;\n\n      const mode = resolvedTheme === 'dark' ? 'dark' : 'light';\n      const valueMap = themeObj[mode];\n\n      // remove previous style\n      target.style.cssText = '';\n\n      Object.entries(valueMap).forEach(([key, value]) => {\n        value && target.style.setProperty(key, value);\n      });\n    });\n\n    return () => {\n      _provided = false;\n      sub.unsubscribe();\n    };\n  }, [resolvedTheme, target.style, themeEditor.customTheme$]);\n};\n\nexport const CustomThemeModifier = () => {\n  useCustomTheme(document.documentElement);\n\n  return null;\n};\n","import { Empty } from '@affine/component';\n\nexport const ThemeEmpty = () => {\n  return (\n    <div\n      style={{ width: 0, flex: 1, display: 'flex', justifyContent: 'center' }}\n    >\n      <Empty description=\"Select a variable to edit\" />\n    </div>\n  );\n};\n","import \"../core/src/modules/theme-editor/views/theme-editor.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/modules/theme-editor/views/theme-editor.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACq1W/W7aMBD/n6ewKk2CqUaBQgtB2yvsAaZpcuxL4jaxM9uh0KnvPtnONymDtkIIdD7f/e53X57/XiwfHqM/Afo7QeiZM5OGaBEE++fdBKEUeJIaL0itgHFdZOQYojiDgxVEhD4lSpaChWhP1BRjEsdcAM7IERRuj3GheE7UcWZvUZlJNbhg4GBqJewUZrvJ62TeAPzqIEbygDV/4SIJUSQVs07koau5cHoWINap4uIpRMGuDW65CgoP3d9WVYjFAWmZcTYahlOdjTLgHDGugBouRWhjK3NhT0oNCmvIgJoQCSmgi3LZJTyoDYVocZWT1t6ds1cQxhw1m+KAVpviAzlqyDVG5pfy0+JZOTx1AQ0D7OG038D/di3cn7HQaj04rXcQthlU/JdR4knGE4G5gVyHiIIwoKw4IYWD9DpJgTBQqG81lsLg5wr5OvDYrUzzFxgkwctzx3lmBXXEy6VPX8PV1vL0Cal5GKBtHKy8g1HNUEgzDTOiDaYpz9is6sYekmC+vhLLBn1HGb+qF95IyWOpDY/t6BAGhOke9QIcVNn2w2WwGaTJlvPivj9jCOOlblQvHn8I0VJpq1tI7p12kP9kxBBMqOF7+HZjVAk3v1w0Y/YjRQQbmauVFZoCfQJWm7ltEr8NU7kH5bN98SBxd37sQWXkOOqu1Ebm/KX16Bw4EhhQqYhv21IwULYrujbIdS1fpanfTTiD2ITobiA1snBV0pXVxb3qF070JtWcSoE1UClYPUw/oYjr9VVtr2ZKBH1Y1BOpiNDc8+D+x1LlKJgv9a4+tZIQKWmIgSneBgySXqaoz5QsQPRzdHL55CobT9AFTXR2SB70rEvEMHJ4t9dC1lwpyIhtJyvNuWhn8d3AlycH8sIce+w07of7vrph+0Jx1u9XWRDKzdHOTzfyTtrA7QWTKlkmaddofP6pU0+h5hk3PpVWb7PQcRVGEEsFVdVX5Xlzc4G71jCJtMxKAyMguEhBceO2oGtNF4jrx87O6y47lURkGty6z3xRvVn+9ziE7vz5hfpEDiCt7TJoryany3Jzjs/utHRYF8v1bf31iFvj6dgaqon0U+r1H/NhJOKsCwAA\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var colorCell = '_127jbqd';\nexport var colorCellColor = '_127jbqf';\nexport var colorCellInput = '_127jbqh';\nexport var colorCellRow = '_127jbqe';\nexport var colorCellValue = '_127jbqg';\nexport var content = '_127jbq2';\nexport var mainHeader = '_127jbq5';\nexport var mainScrollable = '_127jbq6';\nexport var mainViewport = '_127jbq7';\nexport var root = '_127jbq0';\nexport var row = '_127jbq8';\nexport var sidebar = '_127jbq1';\nexport var sidebarHeader = '_127jbq3';\nexport var sidebarScrollable = '_127jbq4';\nexport var treeNode = '_127jbq9';\nexport var treeNodeCollapseIcon = '_127jbqc';\nexport var treeNodeContent = '_127jbqa';\nexport var treeNodeIconWrapper = '_127jbqb';","import { ArrowDownSmallIcon, PaletteIcon } from '@blocksuite/icons/rc';\nimport * as Collapsible from '@radix-ui/react-collapsible';\nimport { useCallback, useState } from 'react';\n\nimport { type TreeNode } from '../resource';\nimport * as styles from '../theme-editor.css';\n\nexport const ThemeTreeNode = ({\n  node,\n  checked,\n  setActive,\n  isActive,\n  isCustomized,\n}: {\n  node: TreeNode;\n  checked?: TreeNode;\n  setActive: (vs: TreeNode) => void;\n  isActive?: (node: TreeNode) => boolean;\n  isCustomized?: (node: TreeNode) => boolean;\n}) => {\n  const isLeaf = !node.children && node.variables;\n  const [open, setOpen] = useState(false);\n\n  const onClick = useCallback(() => {\n    if (isLeaf || node.variables?.length) setActive(node);\n    if (node.children) setOpen(prev => !prev);\n  }, [isLeaf, node, setActive]);\n\n  return (\n    <Collapsible.Root open={open}>\n      <div\n        data-checked={node === checked}\n        data-active={isActive?.(node)}\n        data-customized={isCustomized?.(node)}\n        className={styles.treeNode}\n        onClick={onClick}\n      >\n        <div className={styles.treeNodeIconWrapper}>\n          {isLeaf ? (\n            <PaletteIcon width={16} height={16} />\n          ) : (\n            <ArrowDownSmallIcon\n              data-open={open}\n              className={styles.treeNodeCollapseIcon}\n              width={20}\n              height={20}\n            />\n          )}\n        </div>\n        <span>{node.label}</span>\n      </div>\n      <Collapsible.Content className={styles.treeNodeContent}>\n        {node.children?.map(child => (\n          <ThemeTreeNode\n            key={child.id}\n            node={child}\n            checked={checked}\n            isActive={isActive}\n            setActive={setActive}\n            isCustomized={isCustomized}\n          />\n        ))}\n      </Collapsible.Content>\n    </Collapsible.Root>\n  );\n};\n","export const variableNameToParts = (name: string) => name.slice(9).split('-');\n\nexport const partsToVariableName = (parts: string[]) =>\n  `--affine-${parts.join('-')}`;\n\nexport const isColor = (value: string) => {\n  return value.startsWith('#') || value.startsWith('rgb');\n};\n","import clsx from 'clsx';\nimport { type HTMLAttributes, useId } from 'react';\n\nimport * as styles from './simple-color-picker.css';\n\nexport const SimpleColorPicker = ({\n  value,\n  setValue,\n  className,\n  ...attrs\n}: HTMLAttributes<HTMLDivElement> & {\n  value: string;\n  setValue: (value: string) => void;\n}) => {\n  const id = useId();\n  return (\n    <label htmlFor={id}>\n      <div\n        style={{ backgroundColor: value }}\n        className={clsx(styles.wrapper, className)}\n        {...attrs}\n      >\n        <input\n          className={styles.input}\n          type=\"color\"\n          name={id}\n          id={id}\n          value={value}\n          onChange={e => setValue(e.target.value)}\n        />\n      </div>\n    </label>\n  );\n};\n","import \"../core/src/modules/theme-editor/views/components/simple-color-picker.css.ts.vanilla.css!=!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/modules/theme-editor/views/components/simple-color-picker.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xMGloeGN4MCB7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIGJvcmRlci1yYWRpdXM6IDhweDsKICBvdmVyZmxvdzogaGlkZGVuOwogIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMTI1LDEyNSwxMjUsIDAuMyk7CiAgY3Vyc29yOiBwb2ludGVyOwp9Ci5fMTBpaHhjeDEgewogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICBwb2ludGVyLWV2ZW50czogbm9uZTsKICB3aWR0aDogMTAwJTsKICBoZWlnaHQ6IDEwMCU7CiAgdG9wOiAwOwogIGxlZnQ6IDA7CiAgb3BhY2l0eTogMDsKfQ==\\\"}!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var input = '_10ihxcx1';\nexport var wrapper = '_10ihxcx0';","import { IconButton, Input, Menu, MenuItem } from '@affine/component';\nimport { MoreHorizontalIcon } from '@blocksuite/icons/rc';\nimport { cssVar } from '@toeverything/theme';\nimport { useCallback, useState } from 'react';\n\nimport * as styles from '../theme-editor.css';\nimport { SimpleColorPicker } from './simple-color-picker';\n\nexport const ColorCell = ({\n  value,\n  custom,\n  onValueChange,\n}: {\n  value: string;\n  custom?: string;\n  onValueChange?: (color?: string) => void;\n}) => {\n  const [inputValue, setInputValue] = useState(value);\n\n  const onInput = useCallback(\n    (color: string) => {\n      onValueChange?.(color);\n      setInputValue(color);\n    },\n    [onValueChange]\n  );\n  return (\n    <div className={styles.colorCell}>\n      <div>\n        <div data-override={!!custom} className={styles.colorCellRow}>\n          <div\n            className={styles.colorCellColor}\n            style={{ backgroundColor: value }}\n          />\n          <div className={styles.colorCellValue}>{value}</div>\n        </div>\n\n        <div data-empty={!custom} data-custom className={styles.colorCellRow}>\n          <div\n            className={styles.colorCellColor}\n            style={{ backgroundColor: custom }}\n          />\n          <div className={styles.colorCellValue}>{custom}</div>\n        </div>\n      </div>\n\n      <Menu\n        contentOptions={{ style: { background: cssVar('white') } }}\n        items={\n          <ul style={{ display: 'flex', flexDirection: 'column', gap: 8 }}>\n            <SimpleColorPicker\n              value={inputValue}\n              setValue={onInput}\n              className={styles.colorCellInput}\n            />\n            <Input\n              value={inputValue}\n              onChange={onInput}\n              placeholder=\"Input color\"\n            />\n            {custom ? (\n              <MenuItem type=\"danger\" onClick={() => onValueChange?.()}>\n                Recover\n              </MenuItem>\n            ) : null}\n          </ul>\n        }\n      >\n        <IconButton size=\"14\" icon={<MoreHorizontalIcon />} />\n      </Menu>\n    </div>\n  );\n};\n","import { Input } from '@affine/component';\nimport { useCallback, useState } from 'react';\n\nimport * as styles from './string-cell.css';\n\nexport const StringCell = ({\n  value,\n  custom,\n  onValueChange,\n}: {\n  value: string;\n  custom?: string;\n  onValueChange?: (color?: string) => void;\n}) => {\n  const [inputValue, setInputValue] = useState(custom ?? '');\n\n  const onInput = useCallback(\n    (color: string) => {\n      onValueChange?.(color || undefined);\n      setInputValue(color);\n    },\n    [onValueChange]\n  );\n\n  return (\n    <div style={{ display: 'flex', gap: 8, flexDirection: 'column' }}>\n      <div className={styles.row}>{value}</div>\n      <Input\n        placeholder=\"Input value to override\"\n        style={{ width: '100%' }}\n        value={inputValue}\n        onChange={onInput}\n      />\n    </div>\n  );\n};\n","import \"../core/src/modules/theme-editor/views/components/string-cell.css.ts.vanilla.css!=!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/modules/theme-editor/views/components/string-cell.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Lm9wbGEzbDAgewogIGJhY2tncm91bmQ6IHJnYmEoMTI1LDEyNSwxMjUsMC4xKTsKICBib3JkZXItcmFkaXVzOiA0cHg7CiAgZm9udC1zaXplOiB2YXIoLS1hZmZpbmUtZm9udC14cyk7CiAgcGFkZGluZzogNHB4IDhweDsKfQ==\\\"}!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var row = 'opla3l0';","import { Scrollable } from '@affine/component';\nimport { useLiveData, useService } from '@toeverything/infra';\n\nimport { ThemeEditorService } from '../../services/theme-editor';\nimport type { TreeNode } from '../resource';\nimport * as styles from '../theme-editor.css';\nimport { isColor } from '../utils';\nimport { ColorCell } from './color-cell';\nimport { StringCell } from './string-cell';\n\nexport const VariableList = ({ node }: { node: TreeNode }) => {\n  const themeEditor = useService(ThemeEditorService);\n  const customTheme = useLiveData(themeEditor.customTheme$);\n\n  const variables = node.variables ?? [];\n\n  return (\n    <main className={styles.content}>\n      <header>\n        <ul className={styles.row}>\n          <li>Name</li>\n          <li>Light</li>\n          <li>Dark</li>\n        </ul>\n      </header>\n      <Scrollable.Root className={styles.mainScrollable}>\n        <Scrollable.Viewport className={styles.mainViewport}>\n          {variables.map(variable => (\n            <ul className={styles.row} key={variable.variableName}>\n              <li\n                style={{\n                  textDecoration:\n                    customTheme?.light?.[variable.variableName] ||\n                    customTheme?.dark?.[variable.variableName]\n                      ? 'underline'\n                      : 'none',\n                }}\n              >\n                {variable.name}\n              </li>\n              {(['light', 'dark'] as const).map(mode => {\n                const Renderer = isColor(variable[mode])\n                  ? ColorCell\n                  : StringCell;\n                return (\n                  <li key={mode}>\n                    <Renderer\n                      value={variable[mode]}\n                      custom={customTheme?.[mode]?.[variable.variableName]}\n                      onValueChange={color =>\n                        themeEditor.updateCustomTheme(\n                          mode,\n                          variable.variableName,\n                          color\n                        )\n                      }\n                    />\n                  </li>\n                );\n              })}\n            </ul>\n          ))}\n        </Scrollable.Viewport>\n        <Scrollable.Scrollbar />\n      </Scrollable.Root>\n    </main>\n  );\n};\n","import { darkCssVariables, lightCssVariables } from '@toeverything/theme';\nimport {\n  darkCssVariablesV2,\n  lightCssVariablesV2,\n} from '@toeverything/theme/v2';\n\nimport { partsToVariableName, variableNameToParts } from './utils';\n\nexport type Variable = {\n  id: string;\n  name: string;\n  variableName: string;\n  light: string;\n  dark: string;\n  ancestors: string[];\n};\n\nexport interface TreeNode {\n  id: string;\n  label: string;\n  parentId?: string;\n  children?: TreeNode[];\n  variables?: Variable[];\n}\nexport interface ThemeInfo {\n  tree: TreeNode[];\n  nodeMap: Map<string, TreeNode>;\n  variableMap: Map<string, Variable>;\n}\n\nconst sortTree = (tree: TreeNode[]) => {\n  const compare = (a: TreeNode, b: TreeNode) => {\n    if (a.children && !b.children) return -1;\n    if (!a.children && b.children) return 1;\n    return a.label.localeCompare(b.label);\n  };\n  const walk = (node: TreeNode) => {\n    node.children?.sort(compare);\n    node.children?.forEach(walk);\n  };\n\n  tree.sort(compare).forEach(walk);\n  return tree;\n};\n\nconst getTree = (\n  light: Record<string, string>,\n  dark: Record<string, string>\n): ThemeInfo => {\n  const lightKeys = Object.keys(light);\n  const darkKeys = Object.keys(dark);\n  const allKeys = Array.from(new Set([...lightKeys, ...darkKeys])).map(name =>\n    variableNameToParts(name)\n  );\n  const rootNodesSet = new Set<TreeNode>();\n  const nodeMap = new Map<string, TreeNode>();\n  const variableMap = new Map<string, Variable>();\n\n  allKeys.forEach(parts => {\n    let id = '';\n    let node: TreeNode | undefined;\n    const ancestors: string[] = [];\n\n    parts.slice(0, -1).forEach((part, index) => {\n      const isLeaf = index === parts.length - 2;\n      const parentId = id ? id : undefined;\n      id += `/${part}`;\n      ancestors.push(id);\n      if (!nodeMap.has(id)) {\n        nodeMap.set(id, {\n          id,\n          parentId,\n          label: part,\n          children: isLeaf ? undefined : [],\n          variables: isLeaf ? [] : undefined,\n        });\n      }\n\n      node = nodeMap.get(id);\n\n      if (!node) return; // should never reach\n\n      if (parentId) {\n        const parent = nodeMap.get(parentId);\n        if (!parent) return; // should never reach\n        if (parent.children?.includes(node)) return;\n        parent.children?.push(node);\n      }\n\n      if (index === 0) rootNodesSet.add(node);\n    });\n\n    if (node) {\n      const variableName = partsToVariableName(parts);\n      // for the case that a node should have both children & variables\n      if (!node.variables) {\n        node.variables = [];\n      }\n      const variable = {\n        id: variableName,\n        name: parts[parts.length - 1],\n        variableName,\n        light: light[variableName],\n        dark: dark[variableName],\n        ancestors,\n      };\n      node.variables.push(variable);\n      variableMap.set(variableName, variable);\n    }\n  });\n\n  return {\n    tree: sortTree(Array.from(rootNodesSet)),\n    nodeMap,\n    variableMap,\n  };\n};\n\nexport const affineThemes = {\n  v1: getTree(lightCssVariables, darkCssVariables),\n  v2: getTree(lightCssVariablesV2, darkCssVariablesV2),\n};\n","import { RadioGroup, Scrollable } from '@affine/component';\nimport { useService } from '@toeverything/infra';\nimport { useCallback, useEffect, useState } from 'react';\n\nimport { ThemeEditorService } from '../services/theme-editor';\nimport { ThemeEmpty } from './components/empty';\nimport { ThemeTreeNode } from './components/tree-node';\nimport { VariableList } from './components/variable-list';\nimport { affineThemes, type TreeNode } from './resource';\nimport * as styles from './theme-editor.css';\n\nexport const ThemeEditor = () => {\n  const themeEditor = useService(ThemeEditorService);\n  const [version, setVersion] = useState<'v1' | 'v2'>('v1');\n  const [activeNode, setActiveNode] = useState<TreeNode | null>();\n\n  const { nodeMap, variableMap, tree } = affineThemes[version];\n\n  const [customizedNodeIds, setCustomizedNodeIds] = useState<Set<string>>(\n    new Set()\n  );\n\n  // workaround for the performance issue of using `useLiveData(themeEditor.customTheme$)` here\n  useEffect(() => {\n    const sub = themeEditor.customTheme$.subscribe(customTheme => {\n      const ids = Array.from(\n        new Set([\n          ...Object.keys(customTheme?.light ?? {}),\n          ...Object.keys(customTheme?.dark ?? {}),\n        ])\n      ).reduce((acc, name) => {\n        const variable = variableMap.get(name);\n        if (!variable) return acc;\n        variable.ancestors.forEach(id => acc.add(id));\n        return acc;\n      }, new Set<string>());\n\n      setCustomizedNodeIds(prev => {\n        const isSame =\n          Array.from(ids).every(id => prev.has(id)) &&\n          Array.from(prev).every(id => ids.has(id));\n        return isSame ? prev : ids;\n      });\n    });\n    return () => sub.unsubscribe();\n  }, [themeEditor.customTheme$, variableMap]);\n\n  const onToggleVersion = useCallback((v: 'v1' | 'v2') => {\n    setVersion(v);\n    setActiveNode(null);\n  }, []);\n\n  const isActive = useCallback(\n    (node: TreeNode) => {\n      let pointer = activeNode;\n      while (pointer) {\n        if (!pointer) return false;\n        if (pointer === node) return true;\n        pointer = pointer.parentId ? nodeMap.get(pointer.parentId) : undefined;\n      }\n      return false;\n    },\n    [activeNode, nodeMap]\n  );\n\n  const isCustomized = useCallback(\n    (node: TreeNode) => customizedNodeIds.has(node.id),\n    [customizedNodeIds]\n  );\n\n  return (\n    <div className={styles.root}>\n      <div className={styles.sidebar}>\n        <header className={styles.sidebarHeader}>\n          <RadioGroup\n            width=\"100%\"\n            value={version}\n            onChange={onToggleVersion}\n            items={['v1', 'v2']}\n          />\n        </header>\n        <Scrollable.Root className={styles.sidebarScrollable} key={version}>\n          <Scrollable.Viewport>\n            {tree.map(node => (\n              <ThemeTreeNode\n                key={node.id}\n                node={node}\n                checked={activeNode ?? undefined}\n                setActive={setActiveNode}\n                isActive={isActive}\n                isCustomized={isCustomized}\n              />\n            ))}\n          </Scrollable.Viewport>\n          <Scrollable.Scrollbar />\n        </Scrollable.Root>\n      </div>\n      {activeNode ? <VariableList node={activeNode} /> : <ThemeEmpty />}\n    </div>\n  );\n};\n","import { type Framework, GlobalState } from '@toeverything/infra';\n\nimport { ThemeEditorService } from './services/theme-editor';\n\nexport { CustomThemeModifier, useCustomTheme } from './views/custom-theme';\nexport { ThemeEditor } from './views/theme-editor';\nexport { ThemeEditorService };\n\nexport function configureThemeEditorModule(framework: Framework) {\n  framework.service(ThemeEditorService, [GlobalState]);\n}\n","import { Entity } from '@toeverything/infra';\n\nexport class SidebarTab extends Entity<{ id: string }> {\n  readonly id = this.props.id;\n}\n","import type {\n  Blocker,\n  Listener,\n  Location,\n  MemoryHistory,\n  MemoryHistoryOptions,\n  To,\n} from 'history';\nimport { Action, createPath, parsePath } from 'history';\n\nexport interface NavigableHistory extends MemoryHistory {\n  entries: Location[];\n}\n\n/**\n * Same as `createMemoryHistory` from `history` package, but with additional `entries` property.\n *\n * Original `MemoryHistory` does not have `entries` property, so we can't get `backable` and `forwardable` state which\n * is needed for implementing back and forward buttons.\n *\n * @see https://github.com/remix-run/history/tree/main/docs/api-reference.md#creatememoryhistory\n */\nexport function createNavigableHistory(\n  options: MemoryHistoryOptions = {}\n): NavigableHistory {\n  const { initialEntries = ['/'], initialIndex } = options;\n  const entries: Location[] = initialEntries.map(entry => {\n    const location = Object.freeze<Location>({\n      pathname: '/',\n      search: '',\n      hash: '',\n      state: null,\n      key: createKey(),\n      ...(typeof entry === 'string' ? parsePath(entry) : entry),\n    });\n\n    warning(\n      location.pathname.charAt(0) === '/',\n      `Relative pathnames are not supported in createMemoryHistory({ initialEntries }) (invalid entry: ${JSON.stringify(\n        entry\n      )})`\n    );\n\n    return location;\n  });\n  let index = clamp(\n    initialIndex == null ? entries.length - 1 : initialIndex,\n    0,\n    entries.length - 1\n  );\n\n  let action = Action.Pop;\n  let location = entries[index];\n  const listeners = createEvents<Listener>();\n  const blockers = createEvents<Blocker>();\n\n  function createHref(to: To) {\n    return typeof to === 'string' ? to : createPath(to);\n  }\n\n  function getNextLocation(to: To, state: any = null): Location {\n    return Object.freeze<Location>({\n      pathname: location.pathname,\n      search: '',\n      hash: '',\n      ...(typeof to === 'string' ? parsePath(to) : to),\n      state,\n      key: createKey(),\n    });\n  }\n\n  function allowTx(action: Action, location: Location, retry: () => void) {\n    return (\n      !blockers.length || (blockers.call({ action, location, retry }), false)\n    );\n  }\n\n  function applyTx(nextAction: Action, nextLocation: Location) {\n    action = nextAction;\n    location = nextLocation;\n    listeners.call({ action, location });\n  }\n\n  function push(to: To, state?: any) {\n    const nextAction = Action.Push;\n    const nextLocation = getNextLocation(to, state);\n    function retry() {\n      push(to, state);\n    }\n\n    warning(\n      location.pathname.charAt(0) === '/',\n      `Relative pathnames are not supported in memory history.push(${JSON.stringify(\n        to\n      )})`\n    );\n\n    if (allowTx(nextAction, nextLocation, retry)) {\n      index += 1;\n      entries.splice(index, entries.length, nextLocation);\n      applyTx(nextAction, nextLocation);\n    }\n  }\n\n  function replace(to: To, state?: any) {\n    const nextAction = Action.Replace;\n    const nextLocation = getNextLocation(to, state);\n    function retry() {\n      replace(to, state);\n    }\n\n    warning(\n      location.pathname.charAt(0) === '/',\n      `Relative pathnames are not supported in memory history.replace(${JSON.stringify(\n        to\n      )})`\n    );\n\n    if (allowTx(nextAction, nextLocation, retry)) {\n      entries[index] = nextLocation;\n      applyTx(nextAction, nextLocation);\n    }\n  }\n\n  function go(delta: number) {\n    const nextIndex = clamp(index + delta, 0, entries.length - 1);\n    const nextAction = Action.Pop;\n    const nextLocation = entries[nextIndex];\n    function retry() {\n      go(delta);\n    }\n\n    if (allowTx(nextAction, nextLocation, retry)) {\n      index = nextIndex;\n      applyTx(nextAction, nextLocation);\n    }\n  }\n\n  const history: NavigableHistory = {\n    get index() {\n      return index;\n    },\n    get action() {\n      return action;\n    },\n    get location() {\n      return location;\n    },\n    get entries() {\n      return entries;\n    },\n    createHref,\n    push,\n    replace,\n    go,\n    back() {\n      go(-1);\n    },\n    forward() {\n      go(1);\n    },\n    listen(listener) {\n      return listeners.push(listener);\n    },\n    block(blocker) {\n      return blockers.push(blocker);\n    },\n  };\n\n  return history;\n}\n\nfunction createKey() {\n  return Math.random().toString(36).substr(2, 8);\n}\n\nfunction warning(cond: any, message: string) {\n  if (!cond) {\n    // eslint-disable-next-line no-console\n    if (typeof console !== 'undefined') console.warn(message);\n\n    try {\n      // Welcome to debugging history!\n      //\n      // This error is thrown as a convenience so you can more easily\n      // find the source for a warning that appears in the console by\n      // enabling \"pause on exceptions\" in your JavaScript debugger.\n      throw new Error(message);\n      // eslint-disable-next-line no-empty\n    } catch (e) {}\n  }\n}\n\nfunction clamp(n: number, lowerBound: number, upperBound: number) {\n  return Math.min(Math.max(n, lowerBound), upperBound);\n}\n\ntype Events<F> = {\n  length: number;\n  push: (fn: F) => () => void;\n  call: (arg: any) => void;\n};\n\n// eslint-disable-next-line @typescript-eslint/ban-types\nfunction createEvents<F extends Function>(): Events<F> {\n  let handlers: F[] = [];\n\n  return {\n    get length() {\n      return handlers.length;\n    },\n    push(fn: F) {\n      handlers.push(fn);\n      return function () {\n        handlers = handlers.filter(handler => handler !== fn);\n      };\n    },\n    call(arg) {\n      handlers.forEach(fn => fn && fn(arg));\n    },\n  };\n}\n","import { Entity, LiveData } from '@toeverything/infra';\nimport type { Location, To } from 'history';\nimport { Observable } from 'rxjs';\n\nimport { createNavigableHistory } from '../../../utils/navigable-history';\nimport type { ViewIconName } from '../constants';\nimport { ViewScope } from '../scopes/view';\nimport { SidebarTab } from './sidebar-tab';\n\nexport class View extends Entity<{\n  id: string;\n  defaultLocation?: To | undefined;\n  title?: string;\n  icon?: ViewIconName;\n}> {\n  scope = this.framework.createScope(ViewScope, {\n    view: this as View,\n  });\n\n  get id() {\n    return this.props.id;\n  }\n\n  set id(id: string) {\n    this.props.id = id;\n  }\n\n  sidebarTabs$ = new LiveData<SidebarTab[]>([]);\n\n  // _activeTabId may point to a non-existent tab.\n  // In this case, we still retain the activeTabId data and wait for the non-existent tab to be mounted.\n  _activeSidebarTabId$ = new LiveData<string | null>(null);\n  activeSidebarTab$ = LiveData.computed(get => {\n    const activeTabId = get(this._activeSidebarTabId$);\n    const tabs = get(this.sidebarTabs$);\n    return tabs.length > 0\n      ? (tabs.find(tab => tab.id === activeTabId) ?? tabs[0])\n      : null;\n  });\n\n  constructor() {\n    super();\n    this.history = createNavigableHistory({\n      initialEntries: [this.props.defaultLocation ?? { pathname: '/all' }],\n      initialIndex: 0,\n    });\n  }\n\n  history = createNavigableHistory({\n    initialEntries: ['/all'],\n    initialIndex: 0,\n  });\n\n  location$ = LiveData.from<Location>(\n    new Observable(subscriber => {\n      subscriber.next(this.history.location);\n      return this.history.listen(update => {\n        subscriber.next(update.location);\n      });\n    }),\n    this.history.location\n  );\n\n  entries$ = LiveData.from<Location[]>(\n    new Observable(subscriber => {\n      subscriber.next(this.history.entries);\n      return this.history.listen(() => {\n        subscriber.next(this.history.entries);\n      });\n    }),\n    this.history.entries\n  );\n\n  size$ = new LiveData(100);\n\n  title$ = new LiveData(this.props.title ?? '');\n\n  icon$ = new LiveData(this.props.icon ?? 'allDocs');\n\n  push(path: To) {\n    this.history.push(path);\n  }\n\n  go(n: number) {\n    this.history.go(n);\n  }\n\n  replace(path: To) {\n    this.history.replace(path);\n  }\n\n  setSize(size?: number) {\n    this.size$.next(size ?? 100);\n  }\n\n  addSidebarTab(id: string) {\n    this.sidebarTabs$.next([\n      ...this.sidebarTabs$.value,\n      this.scope.createEntity(SidebarTab, {\n        id,\n      }),\n    ]);\n    return id;\n  }\n\n  removeSidebarTab(id: string) {\n    this.sidebarTabs$.next(\n      this.sidebarTabs$.value.filter(tab => tab.id !== id)\n    );\n  }\n\n  activeSidebarTab(id: string | null) {\n    this._activeSidebarTabId$.next(id);\n  }\n\n  setTitle(title: string) {\n    this.title$.next(title);\n  }\n\n  setIcon(icon: ViewIconName) {\n    this.icon$.next(icon);\n  }\n}\n","import { Unreachable } from '@affine/env/constant';\nimport { Entity, LiveData } from '@toeverything/infra';\nimport { type To } from 'history';\nimport { nanoid } from 'nanoid';\n\nimport type { WorkbenchNewTabHandler } from '../services/workbench-new-tab-handler';\nimport type { WorkbenchDefaultState } from '../services/workbench-view-state';\nimport { View } from './view';\n\nexport type WorkbenchPosition = 'beside' | 'active' | 'head' | 'tail' | number;\n\ntype WorkbenchOpenOptions = {\n  at?: WorkbenchPosition | 'new-tab';\n  replaceHistory?: boolean;\n  show?: boolean; // only for new tab\n};\n\nexport class Workbench extends Entity {\n  constructor(\n    private readonly defaultState: WorkbenchDefaultState,\n    private readonly newTabHandler: WorkbenchNewTabHandler\n  ) {\n    super();\n  }\n\n  readonly activeViewIndex$ = new LiveData(this.defaultState.activeViewIndex);\n  readonly basename$ = new LiveData(this.defaultState.basename);\n\n  readonly views$: LiveData<View[]> = new LiveData(\n    this.defaultState.views.map(meta => {\n      return this.framework.createEntity(View, {\n        id: meta.id,\n        defaultLocation: meta.path,\n        icon: meta.icon,\n        title: meta.title,\n      });\n    })\n  );\n\n  activeView$ = LiveData.computed(get => {\n    const activeIndex = get(this.activeViewIndex$);\n    const views = get(this.views$);\n    return views[activeIndex]; // todo: this could be null\n  });\n  location$ = LiveData.computed(get => {\n    return get(get(this.activeView$).location$);\n  });\n  sidebarOpen$ = new LiveData(false);\n\n  active(index: number) {\n    index = Math.max(0, Math.min(index, this.views$.value.length - 1));\n    this.activeViewIndex$.next(index);\n  }\n\n  updateBasename(basename: string) {\n    this.basename$.next(basename);\n  }\n\n  createView(at: WorkbenchPosition = 'beside', defaultLocation: To) {\n    const view = this.framework.createEntity(View, {\n      id: nanoid(),\n      defaultLocation,\n    });\n    const newViews = [...this.views$.value];\n    newViews.splice(this.indexAt(at), 0, view);\n    this.views$.next(newViews);\n    const index = newViews.indexOf(view);\n    this.active(index);\n    return index;\n  }\n\n  openSidebar() {\n    this.sidebarOpen$.next(true);\n  }\n\n  closeSidebar() {\n    this.sidebarOpen$.next(false);\n  }\n\n  toggleSidebar() {\n    this.sidebarOpen$.next(!this.sidebarOpen$.value);\n  }\n\n  open(to: To, option: WorkbenchOpenOptions = {}) {\n    if (option.at === 'new-tab') {\n      this.newTab(to, {\n        show: option.show,\n      });\n    } else {\n      const { at = 'active', replaceHistory = false } = option;\n      let view = this.viewAt(at);\n      if (!view) {\n        const newIndex = this.createView(at, to);\n        view = this.viewAt(newIndex);\n        if (!view) {\n          throw new Unreachable();\n        }\n      } else {\n        if (replaceHistory) {\n          view.history.replace(to);\n        } else {\n          view.history.push(to);\n        }\n      }\n    }\n  }\n\n  newTab(\n    to: To,\n    {\n      show,\n    }: {\n      show?: boolean;\n    } = {}\n  ) {\n    this.newTabHandler({\n      basename: this.basename$.value,\n      to,\n      show: show ?? true,\n    });\n  }\n\n  openDoc(\n    id: string | { docId: string; blockId?: string },\n    options?: WorkbenchOpenOptions\n  ) {\n    const docId = typeof id === 'string' ? id : id.docId;\n    const blockId = typeof id === 'string' ? undefined : id.blockId;\n    this.open(blockId ? `/${docId}#${blockId}` : `/${docId}`, options);\n  }\n\n  openCollections(options?: WorkbenchOpenOptions) {\n    this.open('/collection', options);\n  }\n\n  openCollection(collectionId: string, options?: WorkbenchOpenOptions) {\n    this.open(`/collection/${collectionId}`, options);\n  }\n\n  openAll(options?: WorkbenchOpenOptions) {\n    this.open('/all', options);\n  }\n\n  openTrash(options?: WorkbenchOpenOptions) {\n    this.open('/trash', options);\n  }\n\n  openTags(options?: WorkbenchOpenOptions) {\n    this.open('/tag', options);\n  }\n\n  openTag(tagId: string, options?: WorkbenchOpenOptions) {\n    this.open(`/tag/${tagId}`, options);\n  }\n\n  viewAt(positionIndex: WorkbenchPosition): View | undefined {\n    return this.views$.value[this.indexAt(positionIndex)];\n  }\n\n  close(view: View) {\n    if (this.views$.value.length === 1) return;\n    const index = this.views$.value.indexOf(view);\n    if (index === -1) return;\n    const newViews = [...this.views$.value];\n    newViews.splice(index, 1);\n    const activeViewIndex = this.activeViewIndex$.value;\n    if (activeViewIndex !== 0 && activeViewIndex >= index) {\n      this.active(activeViewIndex - 1);\n    }\n    this.views$.next(newViews);\n  }\n\n  closeOthers(view: View) {\n    view.size$.next(100);\n    this.views$.next([view]);\n    this.active(0);\n  }\n\n  moveView(from: number, to: number) {\n    from = Math.max(0, Math.min(from, this.views$.value.length - 1));\n    to = Math.max(0, Math.min(to, this.views$.value.length - 1));\n    if (from === to) return;\n    const views = [...this.views$.value];\n    const fromView = views[from];\n    const toView = views[to];\n    views[to] = fromView;\n    views[from] = toView;\n    this.views$.next(views);\n    this.active(to);\n  }\n\n  /**\n   * resize specified view and the next view\n   * @param view\n   * @param percent from 0 to 1\n   * @returns\n   */\n  resize(index: number, percent: number) {\n    const view = this.views$.value[index];\n    const nextView = this.views$.value[index + 1];\n    if (!nextView) return;\n\n    const totalViewSize = this.views$.value.reduce(\n      (sum, v) => sum + v.size$.value,\n      0\n    );\n    const percentOfTotal = totalViewSize * percent;\n    const newSize = Number((view.size$.value + percentOfTotal).toFixed(4));\n    const newNextSize = Number(\n      (nextView.size$.value - percentOfTotal).toFixed(4)\n    );\n    // TODO(@catsjuice): better strategy to limit size\n    if (newSize / totalViewSize < 0.2 || newNextSize / totalViewSize < 0.2)\n      return;\n    view.setSize(newSize);\n    nextView.setSize(newNextSize);\n  }\n\n  private indexAt(positionIndex: WorkbenchPosition): number {\n    if (positionIndex === 'active') {\n      return this.activeViewIndex$.value;\n    }\n    if (positionIndex === 'beside') {\n      return this.activeViewIndex$.value + 1;\n    }\n    if (positionIndex === 'head') {\n      return 0;\n    }\n    if (positionIndex === 'tail') {\n      return this.views$.value.length;\n    }\n    return positionIndex;\n  }\n}\n","import { useLiveData, useService } from '@toeverything/infra';\n\nimport { ViewService } from '../services/view';\nimport { WorkbenchService } from '../services/workbench';\n\nexport function useIsActiveView() {\n  const workbench = useService(WorkbenchService).workbench;\n  const view = useService(ViewService).view;\n\n  const activeView = useLiveData(workbench.activeView$);\n  return view === activeView;\n}\n","import { LiveData, useLiveData } from '@toeverything/infra';\nimport {\n  forwardRef,\n  type Ref,\n  useEffect,\n  useImperativeHandle,\n  useRef,\n} from 'react';\nimport { createPortal } from 'react-dom';\n\nexport const createIsland = () => {\n  const targetLiveData$ = new LiveData<HTMLDivElement | null>(null);\n  let mounted = false;\n  let provided = false;\n  return {\n    Target: forwardRef(function IslandTarget(\n      { ...other }: React.HTMLProps<HTMLDivElement>,\n      ref: Ref<HTMLDivElement>\n    ) {\n      const target = useRef<HTMLDivElement | null>(null);\n\n      useImperativeHandle(ref, () => target.current as HTMLDivElement, []);\n      useEffect(() => {\n        if (mounted === true) {\n          throw new Error('Island should not be mounted more than once');\n        }\n        mounted = true;\n        targetLiveData$.next(target.current);\n        return () => {\n          mounted = false;\n          targetLiveData$.next(null);\n        };\n      }, []);\n      return <div {...other} ref={target}></div>;\n    }),\n    Provider: ({ children }: React.PropsWithChildren) => {\n      const target = useLiveData(targetLiveData$);\n      useEffect(() => {\n        if (provided === true && process.env.NODE_ENV !== 'production') {\n          throw new Error('Island should not be provided more than once');\n        }\n        provided = true;\n        return () => {\n          provided = false;\n        };\n      }, []);\n      return target ? createPortal(children, target) : null;\n    },\n  };\n};\n\nexport type Island = ReturnType<typeof createIsland>;\n","/**\n * # View Islands\n *\n * This file defines some components that allow each UI area to be defined inside each View route as shown below,\n * and the Workbench is responsible for rendering these areas into their containers.\n *\n * ```tsx\n * const MyView = () => {\n *   return <>\n *     <ViewHeader>\n *       ...\n *     </ViewHeader>\n *     <ViewBody>\n *       ...\n *     </ViewBody>\n *     <ViewSidebarTab tabId=\"my-tab\" icon={<MyIcon />}>\n *       ...\n *     </ViewSidebarTab>\n *   </>\n * }\n *\n * const viewRoute = [\n *   {\n *     path: '/my-view',\n *     component: MyView,\n *   }\n * ]\n * ```\n *\n * Each Island is divided into `Target` and `Provider`.\n * The `Provider` wraps the content to be rendered, while the `Target` is placed where it needs to be rendered.\n * Then you get a view portal.\n */\n\nimport { createIsland, type Island } from '@affine/core/utils/island';\nimport { useLiveData, useService } from '@toeverything/infra';\nimport type React from 'react';\nimport {\n  createContext,\n  forwardRef,\n  type Ref,\n  useContext,\n  useEffect,\n  useState,\n} from 'react';\n\nimport { ViewService } from '../services/view';\n\ninterface ViewIslandRegistry {\n  [key: string]: Island | undefined;\n}\n\n/**\n * A registry context will be placed at the top level of the workbench.\n *\n * The `View` will create islands and place them in the registry,\n * while `Workbench` can use the KEY to retrieve and display the islands.\n */\nconst ViewIslandRegistryContext = createContext<ViewIslandRegistry>({});\nconst ViewIslandSetContext = createContext<React.Dispatch<\n  React.SetStateAction<ViewIslandRegistry>\n> | null>(null);\n\nconst ViewIsland = ({\n  id,\n  children,\n}: React.PropsWithChildren<{ id: string }>) => {\n  const setter = useContext(ViewIslandSetContext);\n\n  if (!setter) {\n    throw new Error(\n      'ViewIslandProvider must be used inside ViewIslandRegistryProvider'\n    );\n  }\n\n  const [island] = useState<Island>(createIsland());\n\n  useEffect(() => {\n    setter(prev => ({ ...prev, [id]: island }));\n\n    return () => {\n      setter(prev => {\n        const next = { ...prev };\n        delete next[id];\n        return next;\n      });\n    };\n  }, [id, island, setter]);\n\n  return <island.Provider>{children}</island.Provider>;\n};\n\nconst ViewIslandTarget = forwardRef(function ViewIslandTarget(\n  {\n    id,\n    children,\n    ...otherProps\n  }: { id: string } & React.HTMLProps<HTMLDivElement>,\n  ref: Ref<HTMLDivElement>\n) {\n  const island = useContext(ViewIslandRegistryContext)[id];\n  if (!island) {\n    return <div ref={ref} {...otherProps} />;\n  }\n\n  return (\n    <island.Target ref={ref} {...otherProps}>\n      {children}\n    </island.Target>\n  );\n});\n\nexport const ViewIslandRegistryProvider = ({\n  children,\n}: React.PropsWithChildren) => {\n  const [contextValue, setContextValue] = useState<ViewIslandRegistry>({});\n\n  return (\n    <ViewIslandRegistryContext.Provider value={contextValue}>\n      <ViewIslandSetContext.Provider value={setContextValue}>\n        {children}\n      </ViewIslandSetContext.Provider>\n    </ViewIslandRegistryContext.Provider>\n  );\n};\n\nexport const ViewBody = ({ children }: React.PropsWithChildren) => {\n  const view = useService(ViewService).view;\n\n  return <ViewIsland id={`${view.id}:body`}>{children}</ViewIsland>;\n};\n\nexport const ViewBodyTarget = forwardRef(function ViewBodyTarget(\n  {\n    viewId,\n    ...otherProps\n  }: React.HTMLProps<HTMLDivElement> & { viewId: string },\n  ref: React.ForwardedRef<HTMLDivElement>\n) {\n  return <ViewIslandTarget id={`${viewId}:body`} {...otherProps} ref={ref} />;\n});\n\nexport const ViewHeader = ({ children }: React.PropsWithChildren) => {\n  const view = useService(ViewService).view;\n\n  return <ViewIsland id={`${view.id}:header`}>{children}</ViewIsland>;\n};\n\nexport const ViewHeaderTarget = forwardRef(function ViewHeaderTarget(\n  {\n    viewId,\n    ...otherProps\n  }: React.HTMLProps<HTMLDivElement> & { viewId: string },\n  ref: React.ForwardedRef<HTMLDivElement>\n) {\n  return <ViewIslandTarget id={`${viewId}:header`} {...otherProps} ref={ref} />;\n});\n\nexport const ViewSidebarTab = ({\n  children,\n  tabId,\n  icon,\n  unmountOnInactive = true,\n}: React.PropsWithChildren<{\n  tabId: string;\n  icon: React.ReactNode;\n  unmountOnInactive?: boolean;\n}>) => {\n  const view = useService(ViewService).view;\n  const activeTab = useLiveData(view.activeSidebarTab$);\n  useEffect(() => {\n    view.addSidebarTab(tabId);\n    return () => {\n      view.removeSidebarTab(tabId);\n    };\n  }, [tabId, view]);\n\n  return (\n    <>\n      <ViewIsland id={`${view.id}:sidebar:${tabId}:icon`}>{icon}</ViewIsland>\n      <ViewIsland id={`${view.id}:sidebar:${tabId}:body`}>\n        {unmountOnInactive && activeTab?.id !== tabId ? null : children}\n      </ViewIsland>\n    </>\n  );\n};\n\nexport const ViewSidebarTabIconTarget = forwardRef(\n  function ViewSidebarTabIconTarget(\n    {\n      viewId,\n      tabId,\n      ...otherProps\n    }: React.HTMLProps<HTMLDivElement> & { tabId: string; viewId: string },\n    ref: Ref<HTMLDivElement>\n  ) {\n    return (\n      <ViewIslandTarget\n        ref={ref}\n        id={`${viewId}:sidebar:${tabId}:icon`}\n        {...otherProps}\n      />\n    );\n  }\n);\n\nexport const ViewSidebarTabBodyTarget = forwardRef(\n  function ViewSidebarTabBodyTarget(\n    {\n      viewId,\n      tabId,\n      ...otherProps\n    }: React.HTMLProps<HTMLDivElement> & {\n      tabId: string;\n      viewId: string;\n    },\n    ref: Ref<HTMLDivElement>\n  ) {\n    return (\n      <ViewIslandTarget\n        ref={ref}\n        id={`${viewId}:sidebar:${tabId}:body`}\n        {...otherProps}\n      />\n    );\n  }\n);\n","import { IconButton } from '@affine/component';\nimport { RightSidebarIcon } from '@blocksuite/icons/rc';\n\nimport * as styles from './sidebar-header.css';\n\nexport type HeaderProps = {\n  floating: boolean;\n  onToggle?: () => void;\n  children?: React.ReactNode;\n};\n\nfunction Container({\n  children,\n  style,\n  className,\n  floating,\n}: {\n  children: React.ReactNode;\n  className?: string;\n  style?: React.CSSProperties;\n  floating?: boolean;\n}) {\n  return (\n    <div\n      data-testid=\"header\"\n      style={style}\n      className={className}\n      data-sidebar-floating={floating}\n    >\n      {children}\n    </div>\n  );\n}\n\nconst ToggleButton = ({ onToggle }: { onToggle?: () => void }) => {\n  return (\n    <IconButton size=\"24\" onClick={onToggle}>\n      <RightSidebarIcon />\n    </IconButton>\n  );\n};\n\nexport const Header = ({ floating, children, onToggle }: HeaderProps) => {\n  return (\n    <Container className={styles.header} floating={floating}>\n      {children}\n      {!environment.isDesktop && (\n        <>\n          <div className={styles.spacer} />\n          <ToggleButton onToggle={onToggle} />\n        </>\n      )}\n    </Container>\n  );\n};\n","import \"../core/src/modules/workbench/view/sidebar/sidebar-header.css.ts.vanilla.css!=!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/modules/workbench/view/sidebar/sidebar-header.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xNnZwdnFhMCB7CiAgZGlzcGxheTogZmxleDsKICBoZWlnaHQ6IDUycHg7CiAgd2lkdGg6IDEwMCU7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBmbGV4LXNocmluazogMDsKICBwYWRkaW5nOiAwIDE2cHg7CiAgei1pbmRleDogMTsKICBnYXA6IDEycHg7CiAgYmFja2dyb3VuZDogdmFyKC0tYWZmaW5lLWJhY2tncm91bmQtcHJpbWFyeS1jb2xvcik7Cn0KLl8xNnZwdnFhMSB7CiAgZmxleC1ncm93OiAxOwogIG1pbi13aWR0aDogMTJweDsKfQouXzE2dnB2cWEyIHsKICBkaXNwbGF5OiBmbGV4OwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgZmxleC1zaHJpbms6IDA7CiAgaGVpZ2h0OiA1MnB4OwogIHBvc2l0aW9uOiByZWxhdGl2ZTsKfQpAbWVkaWEgcHJpbnQgewogIC5fMTZ2cHZxYTAgewogICAgZGlzcGxheTogbm9uZTsKICB9Cn0=\\\"}!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var header = '_16vpvqa0';\nexport var spacer = '_16vpvqa1';\nexport var standaloneExtensionSwitcherWrapper = '_16vpvqa2';","import { RadioGroup } from '@affine/component';\nimport { useLiveData, useService } from '@toeverything/infra';\nimport { useCallback } from 'react';\n\nimport { ViewService } from '../../services/view';\nimport { ViewSidebarTabIconTarget } from '../view-islands';\nimport * as styles from './sidebar-header-switcher.css';\n\n// provide a switcher for active extensions\n// will be used in global top header (MacOS) or sidebar (Windows)\nexport const SidebarHeaderSwitcher = () => {\n  const view = useService(ViewService).view;\n  const tabs = useLiveData(view.sidebarTabs$);\n  const activeTab = useLiveData(view.activeSidebarTab$);\n\n  const tabItems = tabs.map(tab => ({\n    value: tab.id,\n    label: (\n      <ViewSidebarTabIconTarget\n        className={styles.iconContainer}\n        viewId={view.id}\n        tabId={tab.id}\n      />\n    ),\n    style: { padding: 0, fontSize: 20, width: 24 },\n  }));\n\n  const handleActiveTabChange = useCallback(\n    (tabId: string) => {\n      view.activeSidebarTab(tabId);\n    },\n    [view]\n  );\n\n  return tabItems.length ? (\n    <RadioGroup\n      iconMode\n      borderRadius={8}\n      itemHeight={24}\n      padding={4}\n      gap={8}\n      items={tabItems}\n      value={activeTab?.id}\n      onChange={handleActiveTabChange}\n    />\n  ) : null;\n};\n","import \"../core/src/modules/workbench/view/sidebar/sidebar-header-switcher.css.ts.vanilla.css!=!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/modules/workbench/view/sidebar/sidebar-header-switcher.css.ts.vanilla.css\\\",\\\"source\\\":\\\"LnY2cmg0MjAgewogIGRpc3BsYXk6IGZsZXg7CiAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBwb2ludGVyLWV2ZW50czogbm9uZTsKfQ==\\\"}!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var iconContainer = 'v6rh420';","import { useLiveData, useService } from '@toeverything/infra';\nimport clsx from 'clsx';\nimport { useCallback } from 'react';\n\nimport { ViewService } from '../../services/view';\nimport { WorkbenchService } from '../../services/workbench';\nimport { ViewSidebarTabBodyTarget } from '../view-islands';\nimport * as styles from './sidebar-container.css';\nimport { Header } from './sidebar-header';\nimport { SidebarHeaderSwitcher } from './sidebar-header-switcher';\n\nexport const SidebarContainer = ({\n  className,\n  ...props\n}: React.HtmlHTMLAttributes<HTMLDivElement>) => {\n  const workbenchService = useService(WorkbenchService);\n  const workbench = workbenchService.workbench;\n  const viewService = useService(ViewService);\n  const view = viewService.view;\n  const sidebarTabs = useLiveData(view.sidebarTabs$);\n  const activeSidebarTab = useLiveData(view.activeSidebarTab$);\n\n  const handleToggleOpen = useCallback(() => {\n    workbench.toggleSidebar();\n  }, [workbench]);\n\n  return (\n    <div className={clsx(styles.sidebarContainerInner, className)} {...props}>\n      <Header floating={false} onToggle={handleToggleOpen}>\n        <SidebarHeaderSwitcher />\n      </Header>\n      {sidebarTabs.length > 0 ? (\n        sidebarTabs.map(sidebar => (\n          <ViewSidebarTabBodyTarget\n            tabId={sidebar.id}\n            key={sidebar.id}\n            style={{ display: activeSidebarTab === sidebar ? 'block' : 'none' }}\n            viewId={view.id}\n            className={clsx(\n              styles.sidebarBodyTarget,\n              !environment.isDesktop && styles.borderTop\n            )}\n          />\n        ))\n      ) : (\n        <div className={styles.sidebarBodyNoSelection}>No Selection</div>\n      )}\n    </div>\n  );\n};\n","import \"../core/src/modules/workbench/view/sidebar/sidebar-container.css.ts.vanilla.css!=!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/modules/workbench/view/sidebar/sidebar-container.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll84cTZxeG0wIHsKICBkaXNwbGF5OiBmbGV4OwogIGJhY2tncm91bmQ6IHZhcigtLWFmZmluZS1iYWNrZ3JvdW5kLXByaW1hcnktY29sb3IpOwogIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgb3ZlcmZsb3c6IGhpZGRlbjsKICBoZWlnaHQ6IDEwMCU7CiAgd2lkdGg6IDEwMCU7CiAgYm9yZGVyLXJhZGl1czogaW5oZXJpdDsKfQpbZGF0YS1jbGllbnQtYm9yZGVyPXRydWVdW2RhdGEtaXMtZmxvYXRpbmc9InRydWUiXSAuXzhxNnF4bTAgewogIGJveC1zaGFkb3c6IHZhcigtLWFmZmluZS1zaGFkb3ctMyk7CiAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYWZmaW5lLWJvcmRlci1jb2xvcik7Cn0KLl84cTZxeG0xIHsKICBkaXNwbGF5OiBmbGV4OwogIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgZmxleDogMTsKICB3aWR0aDogMTAwJTsKICBoZWlnaHQ6IDEwMCU7CiAgb3ZlcmZsb3c6IGhpZGRlbjsKICBhbGlnbi1pdGVtczogY2VudGVyOwp9Ci5fOHE2cXhtMiB7CiAgYm9yZGVyLXRvcDogMC41cHggc29saWQgdmFyKC0tYWZmaW5lLWJvcmRlci1jb2xvcik7Cn0KLl84cTZxeG0zIHsKICBkaXNwbGF5OiBmbGV4OwogIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgZmxleDogMTsKICB3aWR0aDogMTAwJTsKICBoZWlnaHQ6IDEwMCU7CiAgb3ZlcmZsb3c6IGhpZGRlbjsKICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICB1c2VyLXNlbGVjdDogbm9uZTsKICBjb2xvcjogdmFyKC0tYWZmaW5lLXRleHQtc2Vjb25kYXJ5LWNvbG9yKTsKICBhbGlnbi1pdGVtczogY2VudGVyOwp9\\\"}!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var borderTop = '_8q6qxm2';\nexport var sidebarBodyNoSelection = '_8q6qxm3';\nexport var sidebarBodyTarget = '_8q6qxm1';\nexport var sidebarContainerInner = '_8q6qxm0';","import type { MenuProps } from '@affine/component';\nimport { Menu } from '@affine/component';\nimport clsx from 'clsx';\nimport type { HTMLAttributes, MouseEventHandler } from 'react';\nimport { forwardRef, memo, useCallback, useMemo, useState } from 'react';\n\nimport * as styles from './indicator.css';\n\nexport interface SplitViewMenuProps extends HTMLAttributes<HTMLDivElement> {\n  active?: boolean;\n  open?: boolean;\n  onOpenMenu?: () => void;\n  setPressed: (v: boolean) => void;\n}\n\nexport const SplitViewMenuIndicator = memo(\n  forwardRef<HTMLDivElement, SplitViewMenuProps>(\n    function SplitViewMenuIndicator(\n      {\n        className,\n        active,\n        open,\n        setPressed,\n        onOpenMenu,\n        ...attrs\n      }: SplitViewMenuProps,\n      ref\n    ) {\n      // dnd's `isDragging` changes after mouseDown and mouseMoved\n      const onMouseDown = useCallback(() => {\n        const t = setTimeout(() => setPressed(true), 100);\n        window.addEventListener(\n          'mouseup',\n          () => {\n            clearTimeout(t);\n            setPressed(false);\n          },\n          { once: true }\n        );\n      }, [setPressed]);\n\n      const onClick: MouseEventHandler = useCallback(() => {\n        !open && onOpenMenu?.();\n      }, [onOpenMenu, open]);\n\n      return (\n        <div\n          ref={ref}\n          data-active={active}\n          data-testid=\"split-view-indicator\"\n          className={clsx(className, styles.indicator)}\n          onClick={onClick}\n          onMouseDown={onMouseDown}\n          {...attrs}\n        >\n          <div className={styles.indicatorInner} />\n        </div>\n      );\n    }\n  )\n);\n\ninterface SplitViewIndicatorProps extends HTMLAttributes<HTMLDivElement> {\n  isDragging?: boolean;\n  isActive?: boolean;\n  menuItems?: React.ReactNode;\n  // import type { SyntheticListenerMap } from '@dnd-kit/core/dist/hooks/utilities' is not allowed\n  listeners?: any;\n  setPressed?: (pressed: boolean) => void;\n}\nexport const SplitViewIndicator = ({\n  isDragging,\n  isActive,\n  menuItems,\n  listeners,\n  setPressed,\n}: SplitViewIndicatorProps) => {\n  const active = isActive || isDragging;\n  const [menuOpen, setMenuOpen] = useState(false);\n\n  // prevent menu from opening when dragging\n  const setOpenMenuManually = useCallback((open: boolean) => {\n    if (open) return;\n    setMenuOpen(open);\n  }, []);\n  const openMenu = useCallback(() => {\n    setMenuOpen(true);\n  }, []);\n\n  const menuRootOptions = useMemo(\n    () =>\n      ({\n        open: menuOpen,\n        onOpenChange: setOpenMenuManually,\n      }) satisfies MenuProps['rootOptions'],\n    [menuOpen, setOpenMenuManually]\n  );\n  const menuContentOptions = useMemo(\n    () =>\n      ({\n        align: 'center',\n      }) satisfies MenuProps['contentOptions'],\n    []\n  );\n\n  return (\n    <div data-is-dragging={isDragging} className={styles.indicatorWrapper}>\n      <Menu\n        contentOptions={menuContentOptions}\n        items={menuItems}\n        rootOptions={menuRootOptions}\n      >\n        <div className={styles.menuTrigger} />\n      </Menu>\n      <SplitViewMenuIndicator\n        open={menuOpen}\n        onOpenMenu={openMenu}\n        active={active}\n        setPressed={setPressed}\n        {...listeners}\n      />\n    </div>\n  );\n};\n","import \"../core/src/modules/workbench/view/split-view/indicator.css.ts.vanilla.css!=!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/modules/workbench/view/split-view/indicator.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xbHR1eGNlMCB7CiAgcG9zaXRpb246IGFic29sdXRlOwogIHotaW5kZXg6IDQ7CiAgdG9wOiAwOwogIGxlZnQ6IDUwJTsKICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoLTUwJSk7CiAgd2lkdGg6IDUwJTsKICBtYXgtd2lkdGg6IDMwMHB4OwogIG1pbi13aWR0aDogMTIwcHg7CiAgaGVpZ2h0OiAxNXB4OwogIGRpc3BsYXk6IGZsZXg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAtd2Via2l0LWFwcC1yZWdpb246IG5vLWRyYWc7Cn0KLl8xbHR1eGNlMSB7CiAgcG9zaXRpb246IGFic29sdXRlOwogIHdpZHRoOiAwOwogIGhlaWdodDogMDsKICBwb2ludGVyLWV2ZW50czogbm9uZTsKfQouXzFsdHV4Y2UyIHsKICB3aWR0aDogMjlweDsKICBoZWlnaHQ6IDE1cHg7CiAgZGlzcGxheTogZmxleDsKICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICBhbGlnbi1pdGVtczogY2VudGVyOwogIGN1cnNvcjogZ3JhYjsKICAtd2Via2l0LWFwcC1yZWdpb246IG5vLWRyYWc7CiAgY29sb3I6IHZhcigtLWFmZmluZS1wbGFjZWhvbGRlci1jb2xvcik7Cn0KLl8xbHR1eGNlMjpob3ZlciwgLl8xbHR1eGNlMjphY3RpdmUsIC5fMWx0dXhjZTJbZGF0YS1hY3RpdmU9InRydWUiXSB7CiAgY29sb3I6IHZhcigtLWFmZmluZS1icmFuZC1jb2xvcik7Cn0KLl8xbHR1eGNlMyB7CiAgd2lkdGg6IDE2cHg7CiAgaGVpZ2h0OiAzcHg7CiAgYm9yZGVyLXJhZGl1czogMTBweDsKICBiYWNrZ3JvdW5kLWNvbG9yOiBjdXJyZW50Q29sb3I7CiAgdHJhbnNpdGlvbjogYWxsIDAuNXMgY3ViaWMtYmV6aWVyKDAuMTYsIDEsIDAuMywgMSk7Cn0KW2RhdGEtaXMtZHJhZ2dpbmc9InRydWUiXSAuXzFsdHV4Y2UzIHsKICB3aWR0aDogMjRweDsKICBoZWlnaHQ6IDJweDsKfQ==\\\"}!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var indicator = '_1ltuxce2';\nexport var indicatorInner = '_1ltuxce3';\nexport var indicatorWrapper = '_1ltuxce0';\nexport var menuTrigger = '_1ltuxce1';","import { MenuIcon, MenuItem } from '@affine/component';\nimport { useI18n } from '@affine/i18n';\nimport {\n  ExpandCloseIcon,\n  MoveToLeftDuotoneIcon,\n  MoveToRightDuotoneIcon,\n  SoloViewIcon,\n} from '@blocksuite/icons/rc';\nimport { useSortable } from '@dnd-kit/sortable';\nimport { useLiveData, useService } from '@toeverything/infra';\nimport { assignInlineVars } from '@vanilla-extract/dynamic';\nimport type { SetStateAction } from 'jotai';\nimport type {\n  Dispatch,\n  HTMLAttributes,\n  PropsWithChildren,\n  RefObject,\n} from 'react';\nimport {\n  memo,\n  useCallback,\n  useLayoutEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\n\nimport type { View } from '../../entities/view';\nimport { WorkbenchService } from '../../services/workbench';\nimport { SplitViewIndicator } from './indicator';\nimport * as styles from './split-view.css';\n\nexport interface SplitViewPanelProps\n  extends PropsWithChildren<HTMLAttributes<HTMLDivElement>> {\n  view: View;\n  resizeHandle?: React.ReactNode;\n  setSlots?: Dispatch<\n    SetStateAction<Record<string, RefObject<HTMLDivElement | null>>>\n  >;\n}\n\nexport const SplitViewPanel = memo(function SplitViewPanel({\n  children,\n  view,\n  setSlots,\n}: SplitViewPanelProps) {\n  const [indicatorPressed, setIndicatorPressed] = useState(false);\n  const ref = useRef<HTMLDivElement>(null);\n  const size = useLiveData(view.size$);\n  const workbench = useService(WorkbenchService).workbench;\n  const activeView = useLiveData(workbench.activeView$);\n  const views = useLiveData(workbench.views$);\n  const isLast = views[views.length - 1] === view;\n\n  const {\n    attributes,\n    listeners,\n    transform,\n    transition,\n    isDragging: dndIsDragging,\n    setNodeRef,\n  } = useSortable({ id: view.id, attributes: { role: 'group' } });\n\n  const isDragging = dndIsDragging || indicatorPressed;\n  const isActive = activeView === view;\n\n  useLayoutEffect(() => {\n    if (ref.current) {\n      setSlots?.(slots => ({ ...slots, [view.id]: ref }));\n    }\n  }, [setSlots, view.id]);\n\n  const style = useMemo(\n    () => ({\n      ...assignInlineVars({ '--size': size.toString() }),\n    }),\n    [size]\n  );\n  const dragStyle = useMemo(\n    () => ({\n      transform: `translate3d(${transform?.x ?? 0}px, 0, 0)`,\n      transition,\n    }),\n    [transform, transition]\n  );\n\n  return (\n    <div\n      style={style}\n      className={styles.splitViewPanel}\n      data-is-dragging={isDragging}\n      data-is-active={isActive && views.length > 1}\n      data-is-last={isLast}\n    >\n      <div\n        ref={setNodeRef}\n        style={dragStyle}\n        className={styles.splitViewPanelDrag}\n        {...attributes}\n      >\n        <div className={styles.splitViewPanelContent} ref={ref} />\n        {views.length > 1 ? (\n          <SplitViewIndicator\n            listeners={listeners}\n            isDragging={isDragging}\n            isActive={isActive}\n            menuItems={<SplitViewMenu view={view} />}\n            setPressed={setIndicatorPressed}\n          />\n        ) : null}\n      </div>\n      {children}\n    </div>\n  );\n});\n\nconst SplitViewMenu = ({ view }: { view: View }) => {\n  const t = useI18n();\n  const workbench = useService(WorkbenchService).workbench;\n  const views = useLiveData(workbench.views$);\n\n  const viewIndex = views.findIndex(v => v === view);\n\n  const handleClose = useCallback(\n    () => workbench.close(view),\n    [view, workbench]\n  );\n  const handleMoveLeft = useCallback(() => {\n    workbench.moveView(viewIndex, viewIndex - 1);\n  }, [viewIndex, workbench]);\n  const handleMoveRight = useCallback(() => {\n    workbench.moveView(viewIndex, viewIndex + 1);\n  }, [viewIndex, workbench]);\n  const handleCloseOthers = useCallback(() => {\n    workbench.closeOthers(view);\n  }, [view, workbench]);\n\n  const CloseItem =\n    views.length > 1 ? (\n      <MenuItem\n        preFix={<MenuIcon icon={<ExpandCloseIcon />} />}\n        onClick={handleClose}\n      >\n        {t['com.affine.workbench.split-view-menu.close']()}\n      </MenuItem>\n    ) : null;\n\n  const MoveLeftItem =\n    viewIndex > 0 && views.length > 1 ? (\n      <MenuItem\n        onClick={handleMoveLeft}\n        preFix={<MenuIcon icon={<MoveToLeftDuotoneIcon />} />}\n      >\n        {t['com.affine.workbench.split-view-menu.move-left']()}\n      </MenuItem>\n    ) : null;\n\n  const FullScreenItem =\n    views.length > 1 ? (\n      <MenuItem\n        onClick={handleCloseOthers}\n        preFix={<MenuIcon icon={<SoloViewIcon />} />}\n      >\n        {t['com.affine.workbench.split-view-menu.keep-this-one']()}\n      </MenuItem>\n    ) : null;\n\n  const MoveRightItem =\n    viewIndex < views.length - 1 ? (\n      <MenuItem\n        onClick={handleMoveRight}\n        preFix={<MenuIcon icon={<MoveToRightDuotoneIcon />} />}\n      >\n        {t['com.affine.workbench.split-view-menu.move-right']()}\n      </MenuItem>\n    ) : null;\n  return (\n    <>\n      {MoveRightItem}\n      {MoveLeftItem}\n      {FullScreenItem}\n      {CloseItem}\n    </>\n  );\n};\n","import \"../core/src/modules/workbench/view/split-view/split-view.css.ts.vanilla.css!=!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/modules/workbench/view/split-view/split-view.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACqVVUY/aMAx+51dYSJM4ibAWRjUF3S+Z7iGkbutdL6mSlOOY7r9PaUNpobBuEw8oTvzZ/j7bXWVJUh+rNfyaATDWniIOUXXc9SxxZ0nJVqX44JCV2Bj8P0vJoHSkFQej37250paCAUvh6IDeutcmRcOMSKm2HA7CLLoQT/5BLqqhOXrazT5nq5Dmj1Q4wWRJqBxrwZ7nztQ4f7mu4PtNBYm3XGNp47GET/V5fkDjSIoyoF2XJnVZv6kexubyzBaG1CuHqOMkN/r9XIulEy6hLXESM6QKNOR8rMd5DjIpkPLCNUmM+hXa0Ekrd+v5TqkrBo5XJGeitNjz4kq7RfuSLCuFdWchnoZXqRF5Tirvrpt453JDvqttdQSrS0oDYSLLSGGIzqQutek3wuYufIN+YqRSPHKI79YTXg9IaO/+IZ1vfQ7jKPqy64lxPt9X+IzCucgcmgZMauVQOQ7z+bBpxN7qsnZN05Cy6ELP3YP3vqQcGoYHVM5yUFo13heWAoDvYpH6rm2AIQo/Z4SylTCoGrzmGLK5OHnWLMh6T5Lt8URoFtEqTpYQLyFabdruP4sxJtwYC/dyWlfHK2WMUOmtMNv/EQZAH9BkpQ9eUJpif/STBnlcFqerThTn9Fs4hGZn23YzdVm1x06Nzeia/VlbR9kH6/pCohfVX4mScsXI4ZvlYJ1BJwtvl7Wx2jRrixn0K2jiNLS1hXSlKOXC5wzsajHDV1hPHMoBcFdb24iTN1XC+R4zbXAJ0z3uTlSgf92yPy7kTacI+ZobXauUPxyK7hlEq9iO9Fgr+vTK23eNiKTyl78n4gbgwksgYjP4Oia88M1/CfSHTNpp7dEzZTq7IE0yD2KML4SoOkLsN8E6ro7w7fFKANCVkOQ+/HqPt7vZ528QUhIi+wgAAA==\\\"}!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var resizeHandle = 'f66uxp6';\nexport var splitViewPanel = 'f66uxp3';\nexport var splitViewPanelContent = 'f66uxp5';\nexport var splitViewPanelDrag = 'f66uxp4';\nexport var splitViewRoot = 'f66uxp2';","import type { HTMLAttributes } from 'react';\nimport { useCallback } from 'react';\n\nimport * as styles from './split-view.css';\n\ninterface ResizeHandleProps extends HTMLAttributes<HTMLDivElement> {\n  resizing: boolean;\n  onResizeStart: () => void;\n  onResizeEnd: () => void;\n  onResizing: (offset: { x: number; y: number }) => void;\n}\nexport const ResizeHandle = ({\n  resizing,\n  onResizing,\n  onResizeStart,\n  onResizeEnd,\n}: ResizeHandleProps) => {\n  // TODO(@catsjuice): touch support\n  const onMouseDown = useCallback(\n    (e: React.MouseEvent) => {\n      e.preventDefault();\n\n      onResizeStart();\n      const prevPos = { x: e.clientX, y: e.clientY };\n\n      function onMouseMove(e: MouseEvent) {\n        e.preventDefault();\n        const dx = e.clientX - prevPos.x;\n        const dy = e.clientY - prevPos.y;\n        onResizing({ x: dx, y: dy });\n        prevPos.x = e.clientX;\n        prevPos.y = e.clientY;\n      }\n\n      function onMouseUp(e: MouseEvent) {\n        e.preventDefault();\n        onResizeEnd();\n        document.removeEventListener('mousemove', onMouseMove);\n      }\n\n      document.addEventListener('mousemove', onMouseMove);\n      document.addEventListener('mouseup', onMouseUp, { once: true });\n    },\n    [onResizeEnd, onResizeStart, onResizing]\n  );\n\n  return (\n    <div\n      onMouseDown={onMouseDown}\n      data-resizing={resizing || null}\n      className={styles.resizeHandle}\n    />\n  );\n};\n","import { useAppSettingHelper } from '@affine/core/hooks/affine/use-app-setting-helper';\nimport type { DragEndEvent } from '@dnd-kit/core';\nimport {\n  closestCenter,\n  DndContext,\n  PointerSensor,\n  useSensor,\n  useSensors,\n} from '@dnd-kit/core';\nimport {\n  horizontalListSortingStrategy,\n  SortableContext,\n} from '@dnd-kit/sortable';\nimport { useService } from '@toeverything/infra';\nimport clsx from 'clsx';\nimport type { HTMLAttributes, RefObject } from 'react';\nimport { useCallback, useMemo, useRef, useState } from 'react';\nimport { createPortal } from 'react-dom';\n\nimport type { View } from '../../entities/view';\nimport { WorkbenchService } from '../../services/workbench';\nimport { SplitViewPanel } from './panel';\nimport { ResizeHandle } from './resize-handle';\nimport * as styles from './split-view.css';\n\nexport interface SplitViewProps extends HTMLAttributes<HTMLDivElement> {\n  /**\n   *  `vertical` orientation is not supported yet\n   * @default 'horizontal'\n   */\n  orientation?: 'horizontal' | 'vertical';\n  views: View[];\n  renderer: (item: View, index: number) => React.ReactNode;\n  onMove?: (from: number, to: number) => void;\n}\n\ntype SlotsMap = Record<View['id'], RefObject<HTMLDivElement | null>>;\n// TODO(@catsjuice): vertical orientation support\nexport const SplitView = ({\n  orientation = 'horizontal',\n  className,\n  views,\n  renderer,\n  onMove,\n  ...attrs\n}: SplitViewProps) => {\n  const rootRef = useRef<HTMLDivElement>(null);\n  const [slots, setSlots] = useState<SlotsMap>({});\n  const [resizingViewId, setResizingViewId] = useState<View['id'] | null>(null);\n  const { appSettings } = useAppSettingHelper();\n  const workbench = useService(WorkbenchService).workbench;\n\n  const sensors = useSensors(\n    useSensor(\n      PointerSensor,\n      useMemo(\n        /* avoid re-rendering */\n        () => ({\n          activationConstraint: {\n            distance: 0,\n          },\n        }),\n        []\n      )\n    )\n  );\n\n  const onResizing = useCallback(\n    (index: number, { x, y }: { x: number; y: number }) => {\n      const rootEl = rootRef.current;\n      if (!rootEl) return;\n\n      const rootRect = rootEl.getBoundingClientRect();\n      const offset = orientation === 'horizontal' ? x : y;\n      const total =\n        orientation === 'horizontal' ? rootRect.width : rootRect.height;\n\n      const percent = offset / total;\n      workbench.resize(index, percent);\n    },\n    [orientation, workbench]\n  );\n\n  const resizeHandleRenderer = useCallback(\n    (view: View, index: number) =>\n      index < views.length - 1 ? (\n        <ResizeHandle\n          resizing={resizingViewId === view.id}\n          onResizeStart={() => setResizingViewId(view.id)}\n          onResizeEnd={() => setResizingViewId(null)}\n          onResizing={dxy => onResizing(index, dxy)}\n        />\n      ) : null,\n    [onResizing, resizingViewId, views.length]\n  );\n\n  const handleDragEnd = useCallback(\n    (event: DragEndEvent) => {\n      const { active, over } = event;\n      if (active.id !== over?.id) {\n        // update order\n        const fromIndex = views.findIndex(v => v.id === active.id);\n        const toIndex = views.findIndex(v => v.id === over?.id);\n        onMove?.(fromIndex, toIndex);\n      }\n    },\n    [onMove, views]\n  );\n\n  return (\n    <div\n      ref={rootRef}\n      className={clsx(styles.splitViewRoot, className)}\n      data-orientation={orientation}\n      data-client-border={appSettings.clientBorder}\n      {...attrs}\n    >\n      <DndContext\n        sensors={sensors}\n        collisionDetection={closestCenter}\n        onDragEnd={handleDragEnd}\n      >\n        <SortableContext items={views} strategy={horizontalListSortingStrategy}>\n          {views.map((view, index) => (\n            <SplitViewPanel view={view} key={view.id} setSlots={setSlots}>\n              {resizeHandleRenderer(view, index)}\n            </SplitViewPanel>\n          ))}\n        </SortableContext>\n      </DndContext>\n\n      {views.map((view, index) => {\n        const slot = slots[view.id]?.current;\n        if (!slot) return null;\n        return createPortal(\n          renderer(view, index),\n          slot,\n          `portalToSplitViewPanel_${view.id}`\n        );\n      })}\n    </div>\n  );\n};\n","import { IconButton } from '@affine/component';\nimport { RightSidebarIcon } from '@blocksuite/icons/rc';\nimport { useLiveData, useService } from '@toeverything/infra';\nimport { useAtomValue } from 'jotai';\nimport { Suspense, useCallback } from 'react';\n\nimport { AffineErrorBoundary } from '../../../components/affine/affine-error-boundary';\nimport { appSidebarOpenAtom } from '../../../components/app-sidebar/index.jotai';\nimport { SidebarSwitch } from '../../../components/app-sidebar/sidebar-header/sidebar-switch';\nimport { ViewService } from '../services/view';\nimport { WorkbenchService } from '../services/workbench';\nimport * as styles from './route-container.css';\nimport { useViewPosition } from './use-view-position';\nimport { ViewBodyTarget, ViewHeaderTarget } from './view-islands';\n\nexport interface Props {\n  route: {\n    Component: React.ComponentType;\n  };\n}\n\nconst ToggleButton = ({\n  onToggle,\n  className,\n  show,\n}: {\n  onToggle?: () => void;\n  className: string;\n  show: boolean;\n}) => {\n  return (\n    <IconButton\n      size=\"24\"\n      onClick={onToggle}\n      className={className}\n      data-show={show}\n    >\n      <RightSidebarIcon />\n    </IconButton>\n  );\n};\n\nexport const RouteContainer = ({ route }: Props) => {\n  const viewPosition = useViewPosition();\n  const leftSidebarOpen = useAtomValue(appSidebarOpenAtom);\n  const workbench = useService(WorkbenchService).workbench;\n  const view = useService(ViewService).view;\n  const sidebarOpen = useLiveData(workbench.sidebarOpen$);\n  const handleToggleSidebar = useCallback(() => {\n    workbench.toggleSidebar();\n  }, [workbench]);\n\n  return (\n    <div className={styles.root}>\n      <div className={styles.header}>\n        {viewPosition.isFirst && !environment.isDesktop && (\n          <SidebarSwitch\n            show={!leftSidebarOpen}\n            className={styles.leftSidebarButton}\n          />\n        )}\n        <ViewHeaderTarget\n          viewId={view.id}\n          className={styles.viewHeaderContainer}\n        />\n        {viewPosition.isLast && !environment.isDesktop && (\n          <ToggleButton\n            show={!sidebarOpen}\n            className={styles.rightSidebarButton}\n            onToggle={handleToggleSidebar}\n          />\n        )}\n      </div>\n\n      <AffineErrorBoundary>\n        <Suspense>\n          <route.Component />\n        </Suspense>\n      </AffineErrorBoundary>\n      <ViewBodyTarget viewId={view.id} className={styles.viewBodyContainer} />\n    </div>\n  );\n};\n","import \"../core/src/modules/workbench/view/route-container.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/modules/workbench/view/route-container.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xZ2NucDRmMCB7CiAgZGlzcGxheTogZmxleDsKICBoZWlnaHQ6IDEwMCU7CiAgb3ZlcmZsb3c6IGNsaXA7CiAgd2lkdGg6IDEwMCU7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgbWluLXdpZHRoOiAwOwogIGJhY2tncm91bmQ6IHZhcigtLWFmZmluZS1iYWNrZ3JvdW5kLXByaW1hcnktY29sb3IpOwp9Ci5fMWdjbnA0ZjEgewogIGRpc3BsYXk6IGZsZXg7CiAgaGVpZ2h0OiA1MnB4OwogIHdpZHRoOiAxMDAlOwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgZmxleC1zaHJpbms6IDA7CiAgYmFja2dyb3VuZDogdmFyKC0tYWZmaW5lLWJhY2tncm91bmQtcHJpbWFyeS1jb2xvcik7CiAgcGFkZGluZzogMCAxNnB4Owp9Ci5fMWdjbnA0ZjIgewogIGRpc3BsYXk6IGZsZXg7CiAgZmxleDogMTsKICBvdmVyZmxvdzogaGlkZGVuOwp9Ci5fMWdjbnA0ZjMgewogIG1hcmdpbjogMCAxNnB4IDAgMDsKfQouXzFnY25wNGY0IHsKICB0cmFuc2l0aW9uOiBhbGwgMC4ycyBlYXNlLWluLW91dDsKfQouXzFnY25wNGY0W2RhdGEtc2hvdz10cnVlXSB7CiAgb3BhY2l0eTogMTsKICB3aWR0aDogMzJweDsKICBtYXgtd2lkdGg6IDMycHg7CiAgbWFyZ2luLWxlZnQ6IDE2cHg7Cn0KLl8xZ2NucDRmNFtkYXRhLXNob3c9ZmFsc2VdIHsKICBvcGFjaXR5OiAwOwogIG1heC13aWR0aDogMDsKICBtYXJnaW4tbGVmdDogMDsKfQouXzFnY25wNGY1IHsKICBkaXNwbGF5OiBmbGV4OwogIGhlaWdodDogMTAwJTsKICB3aWR0aDogMDsKICBmbGV4LWdyb3c6IDE7CiAgbWluLXdpZHRoOiAxMnB4Owp9CkBtZWRpYSBwcmludCB7CiAgLl8xZ2NucDRmMSB7CiAgICBkaXNwbGF5OiBub25lOwogIH0KfQ==\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var header = '_1gcnp4f1';\nexport var leftSidebarButton = '_1gcnp4f3';\nexport var rightSidebarButton = '_1gcnp4f4';\nexport var root = '_1gcnp4f0';\nexport var viewBodyContainer = '_1gcnp4f2';\nexport var viewHeaderContainer = '_1gcnp4f5';","import { FrameworkScope, useLiveData } from '@toeverything/infra';\nimport { lazy as reactLazy, useLayoutEffect, useMemo } from 'react';\nimport {\n  createMemoryRouter,\n  RouterProvider,\n  UNSAFE_LocationContext,\n  UNSAFE_RouteContext,\n} from 'react-router-dom';\n\nimport { viewRoutes } from '../../../router';\nimport type { View } from '../entities/view';\nimport { RouteContainer } from './route-container';\n\nconst warpedRoutes = viewRoutes.map(({ path, lazy }) => {\n  const Component = reactLazy(() =>\n    lazy().then(m => ({\n      default: m.Component as React.ComponentType,\n    }))\n  );\n  const route = {\n    Component,\n  };\n\n  return {\n    path,\n    Component: () => {\n      return <RouteContainer route={route} />;\n    },\n  };\n});\n\nexport const ViewRoot = ({ view }: { view: View }) => {\n  const viewRouter = useMemo(() => createMemoryRouter(warpedRoutes), []);\n\n  const location = useLiveData(view.location$);\n\n  useLayoutEffect(() => {\n    viewRouter.navigate(location).catch(err => {\n      console.error('navigate error', err);\n    });\n  }, [location, view, viewRouter]);\n\n  // https://github.com/remix-run/react-router/issues/7375#issuecomment-975431736\n  return (\n    <FrameworkScope scope={view.scope}>\n      <UNSAFE_LocationContext.Provider value={null as any}>\n        <UNSAFE_RouteContext.Provider\n          value={{\n            outlet: null,\n            matches: [],\n            isDataRoute: false,\n          }}\n        >\n          <RouterProvider router={viewRouter} />\n        </UNSAFE_RouteContext.Provider>\n      </UNSAFE_LocationContext.Provider>\n    </FrameworkScope>\n  );\n};\n","import { ResizePanel } from '@affine/component/resize-panel';\nimport { rightSidebarWidthAtom } from '@affine/core/atoms';\nimport {\n  appSettingAtom,\n  FrameworkScope,\n  useLiveData,\n  useService,\n} from '@toeverything/infra';\nimport { useAtom, useAtomValue } from 'jotai';\nimport { memo, useCallback, useEffect, useRef, useState } from 'react';\nimport { useLocation } from 'react-router-dom';\n\nimport type { View } from '../entities/view';\nimport { WorkbenchService } from '../services/workbench';\nimport { useBindWorkbenchToBrowserRouter } from './browser-adapter';\nimport { useBindWorkbenchToDesktopRouter } from './desktop-adapter';\nimport { SidebarContainer } from './sidebar/sidebar-container';\nimport { SplitView } from './split-view/split-view';\nimport { ViewIslandRegistryProvider } from './view-islands';\nimport { ViewRoot } from './view-root';\nimport * as styles from './workbench-root.css';\n\nconst useAdapter = environment.isDesktop\n  ? useBindWorkbenchToDesktopRouter\n  : useBindWorkbenchToBrowserRouter;\n\nexport const WorkbenchRoot = memo(() => {\n  const workbench = useService(WorkbenchService).workbench;\n\n  // for debugging\n  (window as any).workbench = workbench;\n\n  const views = useLiveData(workbench.views$);\n\n  const location = useLocation();\n  const basename = location.pathname.match(/\\/workspace\\/[^/]+/g)?.[0] ?? '/';\n\n  useAdapter(workbench, basename);\n\n  const panelRenderer = useCallback((view: View, index: number) => {\n    return <WorkbenchView key={view.id} view={view} index={index} />;\n  }, []);\n\n  const onMove = useCallback(\n    (from: number, to: number) => {\n      workbench.moveView(from, to);\n    },\n    [workbench]\n  );\n\n  useEffect(() => {\n    workbench.updateBasename(basename);\n  }, [basename, workbench]);\n\n  return (\n    <ViewIslandRegistryProvider>\n      <SplitView\n        className={styles.workbenchRootContainer}\n        views={views}\n        renderer={panelRenderer}\n        onMove={onMove}\n      />\n      <WorkbenchSidebar />\n    </ViewIslandRegistryProvider>\n  );\n});\n\nWorkbenchRoot.displayName = 'memo(WorkbenchRoot)';\n\nconst WorkbenchView = ({ view, index }: { view: View; index: number }) => {\n  const workbench = useService(WorkbenchService).workbench;\n\n  const handleOnFocus = useCallback(() => {\n    workbench.active(index);\n  }, [workbench, index]);\n\n  const containerRef = useRef<HTMLDivElement | null>(null);\n\n  useEffect(() => {\n    if (containerRef.current) {\n      const element = containerRef.current;\n      element.addEventListener('pointerdown', handleOnFocus, {\n        capture: true,\n      });\n      return () => {\n        element.removeEventListener('pointerdown', handleOnFocus, {\n          capture: true,\n        });\n      };\n    }\n    return;\n  }, [handleOnFocus]);\n\n  return (\n    <div className={styles.workbenchViewContainer} ref={containerRef}>\n      <ViewRoot key={view.id} view={view} />\n    </div>\n  );\n};\n\nconst MIN_SIDEBAR_WIDTH = 320;\nconst MAX_SIDEBAR_WIDTH = 800;\n\nconst WorkbenchSidebar = () => {\n  const { clientBorder } = useAtomValue(appSettingAtom);\n\n  const [width, setWidth] = useAtom(rightSidebarWidthAtom);\n  const [resizing, setResizing] = useState(false);\n\n  const workbench = useService(WorkbenchService).workbench;\n\n  const views = useLiveData(workbench.views$);\n  const activeView = useLiveData(workbench.activeView$);\n  const sidebarOpen = useLiveData(workbench.sidebarOpen$);\n  const [floating, setFloating] = useState(false);\n\n  const handleOpenChange = useCallback(\n    (open: boolean) => {\n      if (open) {\n        workbench.openSidebar();\n      } else {\n        workbench.closeSidebar();\n      }\n    },\n    [workbench]\n  );\n\n  useEffect(() => {\n    const onResize = () => setFloating(!!(window.innerWidth < 768));\n    onResize();\n    window.addEventListener('resize', onResize);\n    return () => {\n      window.removeEventListener('resize', onResize);\n    };\n  }, []);\n\n  return (\n    <ResizePanel\n      floating={floating}\n      resizeHandlePos=\"left\"\n      resizeHandleOffset={clientBorder ? 3.5 : 0}\n      width={width}\n      resizing={resizing}\n      onResizing={setResizing}\n      className={styles.workbenchSidebar}\n      data-client-border={clientBorder && sidebarOpen}\n      open={sidebarOpen}\n      onOpen={handleOpenChange}\n      onWidthChange={setWidth}\n      minWidth={MIN_SIDEBAR_WIDTH}\n      maxWidth={MAX_SIDEBAR_WIDTH}\n      unmountOnExit={false}\n    >\n      {views.map(view => (\n        <FrameworkScope key={view.id} scope={view.scope}>\n          <SidebarContainer\n            style={{ display: activeView !== view ? 'none' : undefined }}\n          />\n        </FrameworkScope>\n      ))}\n    </ResizePanel>\n  );\n};\n","import type { Location } from 'history';\nimport { useEffect } from 'react';\n// eslint-disable-next-line @typescript-eslint/no-restricted-imports\nimport { useLocation } from 'react-router-dom';\n\nimport type { Workbench } from '../entities/workbench';\n\n/**\n * This hook binds the workbench to the browser router.\n *\n * It listens to the browser location and updates the active view accordingly.\n *\n * In desktop, we not really care about the browser history, we only listen it,\n * and never modify it.\n *\n * REPLACE and POP action in browser history is not supported.\n * To do these actions, you should use the workbench API.\n */\nexport function useBindWorkbenchToDesktopRouter(\n  workbench: Workbench,\n  basename: string\n) {\n  const browserLocation = useLocation();\n\n  useEffect(() => {\n    const newLocation = browserLocationToViewLocation(\n      browserLocation,\n      basename\n    );\n    if (newLocation === null) {\n      return;\n    }\n    if (\n      workbench.location$.value.pathname === newLocation.pathname &&\n      workbench.location$.value.search === newLocation.search &&\n      workbench.location$.value.hash === newLocation.hash\n    ) {\n      return;\n    }\n\n    workbench.open(newLocation);\n  }, [basename, browserLocation, workbench]);\n}\n\nfunction browserLocationToViewLocation(\n  location: Location,\n  basename: string\n): Location | null {\n  if (!location.pathname.startsWith(basename)) {\n    return null;\n  }\n  return {\n    ...location,\n    pathname: location.pathname.slice(basename.length),\n  };\n}\n","import { useLiveData } from '@toeverything/infra';\nimport type { Location } from 'history';\nimport { useEffect } from 'react';\n// eslint-disable-next-line @typescript-eslint/no-restricted-imports\nimport { useLocation, useNavigate } from 'react-router-dom';\n\nimport type { Workbench } from '../entities/workbench';\n\n/**\n * This hook binds the workbench to the browser router.\n * It listens to the active view and updates the browser location accordingly.\n * It also listens to the browser location and updates the active view accordingly.\n *\n * The history of the active view and the browser are two different stacks.\n *\n * In the browser, we use browser history as the criterion, and view history is not very important.\n * So our synchronization strategy is as follows:\n *\n * 1. When the active view history changed, we update the browser history, based on the update action.\n *    - If the update action is PUSH, we navigate to the new location.\n *    - If the update action is REPLACE, we replace the current location.\n * 2. When the browser location changed, we update the active view history just in PUSH action.\n * 3. To avoid infinite loop, we add a state to the location to indicate the source of the change.\n */\nexport function useBindWorkbenchToBrowserRouter(\n  workbench: Workbench,\n  basename: string\n) {\n  const navigate = useNavigate();\n  const browserLocation = useLocation();\n\n  const view = useLiveData(workbench.activeView$);\n\n  useEffect(() => {\n    return view.history.listen(update => {\n      if (update.action === 'POP') {\n        // This is because the history of view and browser are two different stacks,\n        // the POP action cannot be synchronized.\n        throw new Error('POP view history is not allowed on browser');\n      }\n\n      if (update.location.state === 'fromBrowser') {\n        return;\n      }\n\n      const newBrowserLocation = viewLocationToBrowserLocation(\n        update.location,\n        basename\n      );\n\n      if (locationIsEqual(browserLocation, newBrowserLocation)) {\n        return;\n      }\n\n      navigate(newBrowserLocation, {\n        state: 'fromView',\n        replace: update.action === 'REPLACE',\n      });\n    });\n  }, [basename, browserLocation, navigate, view]);\n\n  useEffect(() => {\n    const newLocation = browserLocationToViewLocation(\n      browserLocation,\n      basename\n    );\n    if (newLocation === null) {\n      return;\n    }\n\n    view.history.push(newLocation, 'fromBrowser');\n  }, [basename, browserLocation, view]);\n}\n\nfunction browserLocationToViewLocation(\n  location: Location,\n  basename: string\n): Location | null {\n  if (!location.pathname.startsWith(basename)) {\n    return null;\n  }\n  return {\n    ...location,\n    pathname: location.pathname.slice(basename.length),\n  };\n}\n\nfunction viewLocationToBrowserLocation(\n  location: Location,\n  basename: string\n): Location {\n  return {\n    ...location,\n    pathname: `${basename}${location.pathname}`,\n  };\n}\n\nfunction locationIsEqual(a: Location, b: Location) {\n  return (\n    a.hash === b.hash &&\n    a.pathname === b.pathname &&\n    a.search === b.search &&\n    a.state === b.state\n  );\n}\n","import \"../core/src/modules/workbench/view/workbench-root.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/modules/workbench/view/workbench-root.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xd2FpZ3d4MCB7CiAgZGlzcGxheTogZmxleDsKICBoZWlnaHQ6IDEwMCU7CiAgZmxleDogMTsKICBvdmVyZmxvdzogaGlkZGVuOwp9Ci5fMXdhaWd3eDEgewogIGZsZXg6IDE7CiAgb3ZlcmZsb3c6IGhpZGRlbjsKICBoZWlnaHQ6IDEwMCU7Cn0KLl8xd2FpZ3d4MiB7CiAgZGlzcGxheTogZmxleDsKICBmbGV4LXNocmluazogMDsKICBoZWlnaHQ6IDEwMCU7CiAgcmlnaHQ6IDA7Cn0KLl8xd2FpZ3d4MltkYXRhLWNsaWVudC1ib3JkZXI9dHJ1ZV0gewogIHBhZGRpbmctbGVmdDogOHB4OwogIGJvcmRlci1yYWRpdXM6IDZweDsKfQouXzF3YWlnd3gyW2RhdGEtY2xpZW50LWJvcmRlcj1mYWxzZV0gewogIGJvcmRlci1sZWZ0OiAwLjVweCBzb2xpZCB2YXIoLS1hZmZpbmUtYm9yZGVyLWNvbG9yKTsKfQ==\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var workbenchRootContainer = '_1waigwx0';\nexport var workbenchSidebar = '_1waigwx2';\nexport var workbenchViewContainer = '_1waigwx1';","import { popupWindow } from '@affine/core/utils';\nimport { apis } from '@affine/electron-api';\nimport { createIdentifier } from '@toeverything/infra';\nimport { parsePath, type To } from 'history';\n\nexport type WorkbenchNewTabHandler = (option: {\n  basename: string;\n  to: To;\n  show: boolean;\n}) => void;\n\nexport const WorkbenchNewTabHandler = createIdentifier<WorkbenchNewTabHandler>(\n  'WorkbenchNewTabHandler'\n);\n\nexport const BrowserWorkbenchNewTabHandler: WorkbenchNewTabHandler = ({\n  basename,\n  to,\n}) => {\n  const link =\n    basename +\n    (typeof to === 'string' ? to : `${to.pathname}${to.search}${to.hash}`);\n  popupWindow(link);\n};\n\nexport const DesktopWorkbenchNewTabHandler: WorkbenchNewTabHandler = ({\n  basename,\n  to,\n}) => {\n  const path = typeof to === 'string' ? parsePath(to) : to;\n  apis?.ui\n    .addTab({\n      basename,\n      view: { path },\n      show: false,\n    })\n    .catch(console.error);\n};\n","import { appInfo, type TabViewsMetaSchema } from '@affine/electron-api';\nimport type { GlobalStateService } from '@toeverything/infra';\nimport { createIdentifier, Service } from '@toeverything/infra';\nimport { nanoid } from 'nanoid';\n\nimport type { ViewIconName } from '../constants';\n\nexport type WorkbenchDefaultState = {\n  basename: string;\n  views: {\n    id: string;\n    path?: { pathname?: string; hash?: string; search?: string };\n    icon?: ViewIconName;\n    title?: string;\n  }[];\n  activeViewIndex: number;\n};\n\nexport const WorkbenchDefaultState = createIdentifier<WorkbenchDefaultState>(\n  'WorkbenchDefaultState'\n);\n\nexport const InMemoryWorkbenchDefaultState: WorkbenchDefaultState = {\n  basename: '/',\n  views: [\n    {\n      id: nanoid(),\n    },\n  ],\n  activeViewIndex: 0,\n};\n\nexport class DesktopWorkbenchDefaultState\n  extends Service\n  implements WorkbenchDefaultState\n{\n  constructor(private readonly globalStateService: GlobalStateService) {\n    super();\n  }\n\n  get value() {\n    const tabViewsMeta =\n      this.globalStateService.globalState.get<TabViewsMetaSchema>(\n        'tabViewsMetaSchema'\n      );\n\n    return (\n      tabViewsMeta?.workbenches.find(w => w.id === appInfo?.viewId) ||\n      InMemoryWorkbenchDefaultState\n    );\n  }\n\n  get basename() {\n    return this.value.basename;\n  }\n\n  get activeViewIndex() {\n    return this.value.activeViewIndex;\n  }\n\n  get views() {\n    return this.value.views;\n  }\n}\n","export { Workbench } from './entities/workbench';\nexport { ViewScope } from './scopes/view';\nexport { WorkbenchService } from './services/workbench';\nexport { useIsActiveView } from './view/use-is-active-view';\nexport { ViewBody, ViewHeader, ViewSidebarTab } from './view/view-islands';\nexport { ViewIcon, ViewTitle } from './view/view-meta';\nexport { WorkbenchLink } from './view/workbench-link';\nexport { WorkbenchRoot } from './view/workbench-root';\n\nimport {\n  type Framework,\n  GlobalStateService,\n  WorkspaceScope,\n} from '@toeverything/infra';\n\nimport { SidebarTab } from './entities/sidebar-tab';\nimport { View } from './entities/view';\nimport { Workbench } from './entities/workbench';\nimport { ViewScope } from './scopes/view';\nimport { DesktopStateSynchronizer } from './services/desktop-state-synchronizer';\nimport { ViewService } from './services/view';\nimport { WorkbenchService } from './services/workbench';\nimport {\n  BrowserWorkbenchNewTabHandler,\n  DesktopWorkbenchNewTabHandler,\n  WorkbenchNewTabHandler,\n} from './services/workbench-new-tab-handler';\nimport {\n  DesktopWorkbenchDefaultState,\n  InMemoryWorkbenchDefaultState,\n  WorkbenchDefaultState,\n} from './services/workbench-view-state';\n\nexport function configureWorkbenchCommonModule(services: Framework) {\n  services\n    .scope(WorkspaceScope)\n    .service(WorkbenchService)\n    .entity(Workbench, [WorkbenchDefaultState, WorkbenchNewTabHandler])\n    .entity(View)\n    .scope(ViewScope)\n    .service(ViewService, [ViewScope])\n    .entity(SidebarTab);\n}\n\nexport function configureBrowserWorkbenchModule(services: Framework) {\n  configureWorkbenchCommonModule(services);\n  services\n    .scope(WorkspaceScope)\n    .impl(WorkbenchDefaultState, InMemoryWorkbenchDefaultState)\n    .impl(WorkbenchNewTabHandler, () => BrowserWorkbenchNewTabHandler);\n}\n\nexport function configureDesktopWorkbenchModule(services: Framework) {\n  configureWorkbenchCommonModule(services);\n  services\n    .scope(WorkspaceScope)\n    .impl(WorkbenchDefaultState, DesktopWorkbenchDefaultState, [\n      GlobalStateService,\n    ])\n    .impl(WorkbenchNewTabHandler, () => DesktopWorkbenchNewTabHandler)\n    .service(DesktopStateSynchronizer, [WorkbenchService]);\n}\n","import { Scope } from '@toeverything/infra';\n\nimport type { View } from '../entities/view';\n\nexport class ViewScope extends Scope<{\n  view: View;\n}> {}\n","import { apis, appInfo, events } from '@affine/electron-api';\nimport { LiveData, Service } from '@toeverything/infra';\n\nimport type { WorkbenchService } from '../../workbench';\n\n/**\n * Synchronize workbench state with state stored in main process\n */\nexport class DesktopStateSynchronizer extends Service {\n  constructor(private readonly workbenchService: WorkbenchService) {\n    super();\n    this.startSync();\n  }\n\n  startSync = () => {\n    if (!environment.isDesktop) {\n      return;\n    }\n\n    const workbench = this.workbenchService.workbench;\n\n    events?.ui.onTabAction(event => {\n      if (\n        event.type === 'open-in-split-view' &&\n        event.payload.tabId === appInfo?.viewId\n      ) {\n        const to =\n          event.payload.view?.path ??\n          workbench.activeView$.value?.location$.value;\n\n        workbench.open(to, {\n          at: 'beside',\n        });\n      }\n\n      if (\n        event.type === 'separate-view' &&\n        event.payload.tabId === appInfo?.viewId\n      ) {\n        const view = workbench.viewAt(event.payload.viewIndex);\n        if (view) {\n          workbench.close(view);\n        }\n      }\n\n      if (\n        event.type === 'activate-view' &&\n        event.payload.tabId === appInfo?.viewId\n      ) {\n        workbench.active(event.payload.viewIndex);\n      }\n    });\n\n    events?.ui.onToggleRightSidebar(tabId => {\n      if (tabId === appInfo?.viewId) {\n        workbench.sidebarOpen$.next(!workbench.sidebarOpen$.value);\n      }\n    });\n\n    // sync workbench state with main process\n    // also fill tab view meta with title & moduleName\n    LiveData.computed(get => {\n      return get(workbench.views$).map(view => {\n        const location = get(view.location$);\n        return {\n          id: view.id,\n          title: get(view.title$),\n          iconName: get(view.icon$),\n          path: {\n            pathname: location.pathname,\n            search: location.search,\n            hash: location.hash,\n          },\n        };\n      });\n    }).subscribe(views => {\n      if (!apis || !appInfo?.viewId) {\n        return;\n      }\n\n      apis.ui\n        .updateWorkbenchMeta(appInfo.viewId, {\n          views,\n        })\n        .catch(console.error);\n    });\n\n    workbench.activeViewIndex$.subscribe(activeViewIndex => {\n      if (!apis || !appInfo?.viewId) {\n        return;\n      }\n\n      apis.ui\n        .updateWorkbenchMeta(appInfo.viewId, {\n          activeViewIndex: activeViewIndex,\n        })\n        .catch(console.error);\n    });\n\n    workbench.basename$.subscribe(basename => {\n      if (!apis || !appInfo?.viewId) {\n        return;\n      }\n\n      apis.ui\n        .updateWorkbenchMeta(appInfo.viewId, {\n          basename: basename,\n        })\n        .catch(console.error);\n    });\n  };\n}\n","import { Service } from '@toeverything/infra';\n\nimport type { ViewScope } from '../scopes/view';\n\nexport class ViewService extends Service {\n  view = this.scope.props.view;\n\n  constructor(private readonly scope: ViewScope) {\n    super();\n  }\n}\n","import { mixpanel } from '@affine/core/mixpanel';\nimport { createEvent, Service } from '@toeverything/infra';\nimport { combineLatest, distinctUntilChanged, map, skip } from 'rxjs';\n\nimport { Workbench } from '../entities/workbench';\n\nexport const WorkbenchLocationChanged = createEvent<string>(\n  'WorkbenchLocationChanged'\n);\n\nexport class WorkbenchService extends Service {\n  constructor() {\n    super();\n    combineLatest([this.workbench.location$, this.workbench.basename$])\n      .pipe(\n        map(([location, basename]) => basename + location.pathname),\n        distinctUntilChanged(),\n        skip(1)\n      )\n      .subscribe(newLocation => {\n        this.eventBus.root.emit(WorkbenchLocationChanged, newLocation);\n        mixpanel.track_pageview({\n          location: newLocation,\n        });\n      });\n  }\n\n  workbench = this.framework.createEntity(Workbench);\n}\n","import { useService } from '@toeverything/infra';\nimport { useEffect, useState } from 'react';\n\nimport type { View } from '../entities/view';\nimport { ViewService } from '../services/view';\nimport { WorkbenchService } from '../services/workbench';\n\nexport const useViewPosition = () => {\n  const workbench = useService(WorkbenchService).workbench;\n  const view = useService(ViewService).view;\n\n  const [position, setPosition] = useState(() =>\n    calcPosition(view, workbench.views$.value)\n  );\n\n  useEffect(() => {\n    const subscription = workbench.views$.subscribe(views => {\n      setPosition(calcPosition(view, views));\n    });\n    return () => {\n      subscription.unsubscribe();\n    };\n  }, [view, workbench]);\n\n  return position;\n};\n\nfunction calcPosition(view: View, viewList: View[]) {\n  const index = viewList.indexOf(view);\n  return {\n    index: index,\n    isFirst: index === 0,\n    isLast: index === viewList.length - 1,\n  };\n}\n","import { useServiceOptional } from '@toeverything/infra';\nimport { useEffect } from 'react';\n\nimport type { ViewIconName } from '../constants';\nimport { ViewService } from '../services/view';\n\nexport const ViewTitle = ({ title }: { title: string }) => {\n  const view = useServiceOptional(ViewService)?.view;\n\n  useEffect(() => {\n    if (view) {\n      view.setTitle(title);\n    }\n  }, [title, view]);\n\n  return null;\n};\n\nexport const ViewIcon = ({ icon }: { icon: ViewIconName }) => {\n  const view = useServiceOptional(ViewService)?.view;\n\n  useEffect(() => {\n    if (view) {\n      view.setIcon(icon);\n    }\n  }, [icon, view]);\n\n  return null;\n};\n","import { useAppSettingHelper } from '@affine/core/hooks/affine/use-app-setting-helper';\nimport { useCatchEventCallback } from '@affine/core/hooks/use-catch-event-hook';\nimport { isNewTabTrigger } from '@affine/core/utils';\nimport { useLiveData, useService } from '@toeverything/infra';\nimport { type To } from 'history';\nimport { forwardRef, type MouseEvent } from 'react';\n\nimport { WorkbenchService } from '../services/workbench';\n\nexport const WorkbenchLink = forwardRef<\n  HTMLAnchorElement,\n  React.PropsWithChildren<\n    {\n      to: To;\n      onClick?: (e: MouseEvent) => void;\n    } & React.HTMLProps<HTMLAnchorElement>\n  >\n>(function WorkbenchLink({ to, onClick, ...other }, ref) {\n  const workbench = useService(WorkbenchService).workbench;\n  const { appSettings } = useAppSettingHelper();\n  const basename = useLiveData(workbench.basename$);\n  const link =\n    basename +\n    (typeof to === 'string' ? to : `${to.pathname}${to.search}${to.hash}`);\n  const handleClick = useCatchEventCallback(\n    async (event: React.MouseEvent<HTMLAnchorElement>) => {\n      onClick?.(event);\n      if (event.defaultPrevented) {\n        return;\n      }\n      const at = (() => {\n        if (isNewTabTrigger(event)) {\n          return event.altKey && appSettings.enableMultiView\n            ? 'tail'\n            : 'new-tab';\n        }\n        return 'active';\n      })();\n      workbench.open(to, { at });\n      event.preventDefault();\n    },\n    [appSettings.enableMultiView, onClick, to, workbench]\n  );\n\n  // eslint suspicious runtime error\n  // eslint-disable-next-line react/no-danger-with-children\n  return (\n    <a\n      {...other}\n      ref={ref}\n      href={link}\n      onClick={handleClick}\n      onAuxClick={handleClick}\n    />\n  );\n});\n","import {\n  deleteBlobMutation,\n  fetcher,\n  getBaseUrl,\n  listBlobsQuery,\n  setBlobMutation,\n  UserFriendlyError,\n} from '@affine/graphql';\nimport type { BlobStorage } from '@toeverything/infra';\nimport { BlobStorageOverCapacity } from '@toeverything/infra';\n\nimport { bufferToBlob } from '../../utils/buffer-to-blob';\n\nexport class CloudBlobStorage implements BlobStorage {\n  constructor(private readonly workspaceId: string) {}\n\n  name = 'cloud';\n  readonly = false;\n\n  async get(key: string) {\n    const suffix = key.startsWith('/')\n      ? key\n      : `/api/workspaces/${this.workspaceId}/blobs/${key}`;\n\n    return fetch(getBaseUrl() + suffix, { cache: 'default' }).then(\n      async res => {\n        if (!res.ok) {\n          // status not in the range 200-299\n          return null;\n        }\n        return bufferToBlob(await res.arrayBuffer());\n      }\n    );\n  }\n\n  async set(key: string, value: Blob) {\n    // set blob will check blob size & quota\n    return await fetcher({\n      query: setBlobMutation,\n      variables: {\n        workspaceId: this.workspaceId,\n        blob: new File([value], key),\n      },\n    })\n      .then(res => res.setBlob)\n      .catch(err => {\n        const error = UserFriendlyError.fromAnyError(err);\n        if (error.status === 413) {\n          throw new BlobStorageOverCapacity(error);\n        }\n\n        throw err;\n      });\n  }\n\n  async delete(key: string) {\n    await fetcher({\n      query: deleteBlobMutation,\n      variables: {\n        workspaceId: key,\n        hash: key,\n      },\n    });\n  }\n\n  async list() {\n    const result = await fetcher({\n      query: listBlobsQuery,\n      variables: {\n        workspaceId: this.workspaceId,\n      },\n    });\n    return result.listBlobs;\n  }\n}\n","import { DebugLogger } from '@affine/debug';\nimport { WorkspaceFlavour } from '@affine/env/workspace';\nimport {\n  createWorkspaceMutation,\n  deleteWorkspaceMutation,\n  getIsOwnerQuery,\n  getWorkspacesQuery,\n} from '@affine/graphql';\nimport { DocCollection } from '@blocksuite/store';\nimport {\n  ApplicationStarted,\n  type BlobStorage,\n  catchErrorInto,\n  type DocStorage,\n  exhaustMapSwitchUntilChanged,\n  fromPromise,\n  type GlobalState,\n  LiveData,\n  onComplete,\n  OnEvent,\n  onStart,\n  type WorkspaceEngineProvider,\n  type WorkspaceFlavourProvider,\n  type WorkspaceMetadata,\n  type WorkspaceProfileInfo,\n} from '@toeverything/infra';\nimport { effect, globalBlockSuiteSchema, Service } from '@toeverything/infra';\nimport { isEqual } from 'lodash-es';\nimport { nanoid } from 'nanoid';\nimport { EMPTY, map, mergeMap } from 'rxjs';\nimport { applyUpdate, encodeStateAsUpdate } from 'yjs';\n\nimport type {\n  AuthService,\n  GraphQLService,\n  WebSocketService,\n} from '../../cloud';\nimport { AccountChanged } from '../../cloud';\nimport type { WorkspaceEngineStorageProvider } from '../providers/engine';\nimport { BroadcastChannelAwarenessConnection } from './engine/awareness-broadcast-channel';\nimport { CloudAwarenessConnection } from './engine/awareness-cloud';\nimport { CloudBlobStorage } from './engine/blob-cloud';\nimport { StaticBlobStorage } from './engine/blob-static';\nimport { CloudDocEngineServer } from './engine/doc-cloud';\nimport { CloudStaticDocStorage } from './engine/doc-cloud-static';\n\nconst CLOUD_WORKSPACES_CACHE_KEY = 'cloud-workspace:';\n\nconst logger = new DebugLogger('affine:cloud-workspace-flavour-provider');\n\n@OnEvent(ApplicationStarted, e => e.revalidate)\n@OnEvent(AccountChanged, e => e.revalidate)\nexport class CloudWorkspaceFlavourProviderService\n  extends Service\n  implements WorkspaceFlavourProvider\n{\n  constructor(\n    private readonly globalState: GlobalState,\n    private readonly authService: AuthService,\n    private readonly storageProvider: WorkspaceEngineStorageProvider,\n    private readonly graphqlService: GraphQLService,\n    private readonly webSocketService: WebSocketService\n  ) {\n    super();\n  }\n  flavour: WorkspaceFlavour = WorkspaceFlavour.AFFINE_CLOUD;\n\n  async deleteWorkspace(id: string): Promise<void> {\n    await this.graphqlService.gql({\n      query: deleteWorkspaceMutation,\n      variables: {\n        id: id,\n      },\n    });\n    this.revalidate();\n    await this.waitForLoaded();\n  }\n  async createWorkspace(\n    initial: (\n      docCollection: DocCollection,\n      blobStorage: BlobStorage,\n      docStorage: DocStorage\n    ) => Promise<void>\n  ): Promise<WorkspaceMetadata> {\n    // create workspace on cloud, get workspace id\n    const {\n      createWorkspace: { id: workspaceId },\n    } = await this.graphqlService.gql({\n      query: createWorkspaceMutation,\n    });\n\n    // save the initial state to local storage, then sync to cloud\n    const blobStorage = this.storageProvider.getBlobStorage(workspaceId);\n    const docStorage = this.storageProvider.getDocStorage(workspaceId);\n\n    const docCollection = new DocCollection({\n      id: workspaceId,\n      idGenerator: () => nanoid(),\n      schema: globalBlockSuiteSchema,\n      blobSources: {\n        main: blobStorage,\n      },\n      disableBacklinkIndex: true,\n      disableSearchIndex: true,\n    });\n\n    // apply initial state\n    await initial(docCollection, blobStorage, docStorage);\n\n    // save workspace to local storage, should be vary fast\n    await docStorage.doc.set(\n      workspaceId,\n      encodeStateAsUpdate(docCollection.doc)\n    );\n    for (const subdocs of docCollection.doc.getSubdocs()) {\n      await docStorage.doc.set(subdocs.guid, encodeStateAsUpdate(subdocs));\n    }\n\n    this.revalidate();\n    await this.waitForLoaded();\n\n    return { id: workspaceId, flavour: WorkspaceFlavour.AFFINE_CLOUD };\n  }\n  revalidate = effect(\n    map(() => {\n      return { accountId: this.authService.session.account$.value?.id };\n    }),\n    exhaustMapSwitchUntilChanged(\n      (a, b) => a.accountId === b.accountId,\n      ({ accountId }) => {\n        return fromPromise(async signal => {\n          if (!accountId) {\n            return null; // no cloud workspace if no account\n          }\n\n          const { workspaces } = await this.graphqlService.gql({\n            query: getWorkspacesQuery,\n            context: {\n              signal,\n            },\n          });\n\n          const ids = workspaces.map(({ id }) => id);\n          return {\n            accountId,\n            workspaces: ids.map(id => ({\n              id,\n              flavour: WorkspaceFlavour.AFFINE_CLOUD,\n            })),\n          };\n        }).pipe(\n          mergeMap(data => {\n            if (data) {\n              const { accountId, workspaces } = data;\n              const sorted = workspaces.sort((a, b) => {\n                return a.id.localeCompare(b.id);\n              });\n              this.globalState.set(\n                CLOUD_WORKSPACES_CACHE_KEY + accountId,\n                sorted\n              );\n              if (!isEqual(this.workspaces$.value, sorted)) {\n                this.workspaces$.next(sorted);\n              }\n            } else {\n              this.workspaces$.next([]);\n            }\n            return EMPTY;\n          }),\n          catchErrorInto(this.error$, err => {\n            logger.error('error to revalidate cloud workspaces', err);\n          }),\n          onStart(() => this.isLoading$.next(true)),\n          onComplete(() => this.isLoading$.next(false))\n        );\n      },\n      ({ accountId }) => {\n        if (accountId) {\n          this.workspaces$.next(\n            this.globalState.get(CLOUD_WORKSPACES_CACHE_KEY + accountId) ?? []\n          );\n        } else {\n          this.workspaces$.next([]);\n        }\n      }\n    )\n  );\n  error$ = new LiveData<any>(null);\n  isLoading$ = new LiveData(false);\n  workspaces$ = new LiveData<WorkspaceMetadata[]>([]);\n  async getWorkspaceProfile(\n    id: string,\n    signal?: AbortSignal\n  ): Promise<WorkspaceProfileInfo | undefined> {\n    // get information from both cloud and local storage\n\n    // we use affine 'static' storage here, which use http protocol, no need to websocket.\n    const cloudStorage = new CloudStaticDocStorage(id);\n    const docStorage = this.storageProvider.getDocStorage(id);\n    // download root doc\n    const localData = await docStorage.doc.get(id);\n    const cloudData = await cloudStorage.pull(id);\n\n    const isOwner = await this.getIsOwner(id, signal);\n\n    if (!cloudData && !localData) {\n      return {\n        isOwner,\n      };\n    }\n\n    const bs = new DocCollection({\n      id,\n      schema: globalBlockSuiteSchema,\n      disableBacklinkIndex: true,\n      disableSearchIndex: true,\n    });\n\n    if (localData) applyUpdate(bs.doc, localData);\n    if (cloudData) applyUpdate(bs.doc, cloudData.data);\n\n    return {\n      name: bs.meta.name,\n      avatar: bs.meta.avatar,\n      isOwner,\n    };\n  }\n  async getWorkspaceBlob(id: string, blob: string): Promise<Blob | null> {\n    const localBlob = await this.storageProvider.getBlobStorage(id).get(blob);\n\n    if (localBlob) {\n      return localBlob;\n    }\n\n    const cloudBlob = new CloudBlobStorage(id);\n    return await cloudBlob.get(blob);\n  }\n  getEngineProvider(workspaceId: string): WorkspaceEngineProvider {\n    return {\n      getAwarenessConnections: () => {\n        return [\n          new BroadcastChannelAwarenessConnection(workspaceId),\n          new CloudAwarenessConnection(\n            workspaceId,\n            this.webSocketService.newSocket()\n          ),\n        ];\n      },\n      getDocServer: () => {\n        return new CloudDocEngineServer(\n          workspaceId,\n          this.webSocketService.newSocket()\n        );\n      },\n      getDocStorage: () => {\n        return this.storageProvider.getDocStorage(workspaceId);\n      },\n      getLocalBlobStorage: () => {\n        return this.storageProvider.getBlobStorage(workspaceId);\n      },\n      getRemoteBlobStorages() {\n        return [new CloudBlobStorage(workspaceId), new StaticBlobStorage()];\n      },\n    };\n  }\n\n  private async getIsOwner(workspaceId: string, signal?: AbortSignal) {\n    return (\n      await this.graphqlService.gql({\n        query: getIsOwnerQuery,\n        variables: {\n          workspaceId,\n        },\n        context: { signal },\n      })\n    ).isOwner;\n  }\n\n  private waitForLoaded() {\n    return this.isLoading$.waitFor(loading => !loading);\n  }\n}\n","import type { AwarenessConnection } from '@toeverything/infra';\nimport type { Awareness } from 'y-protocols/awareness.js';\nimport {\n  applyAwarenessUpdate,\n  encodeAwarenessUpdate,\n} from 'y-protocols/awareness.js';\n\ntype AwarenessChanges = Record<'added' | 'updated' | 'removed', number[]>;\n\ntype ChannelMessage =\n  | { type: 'connect' }\n  | { type: 'update'; update: Uint8Array };\n\nexport class BroadcastChannelAwarenessConnection\n  implements AwarenessConnection\n{\n  channel: BroadcastChannel | null = null;\n  awareness: Awareness | null = null;\n\n  constructor(private readonly workspaceId: string) {}\n\n  connect(awareness: Awareness): void {\n    this.awareness = awareness;\n    this.channel = new BroadcastChannel('awareness:' + this.workspaceId);\n    this.channel.postMessage({\n      type: 'connect',\n    } satisfies ChannelMessage);\n    this.awareness.on('update', this.handleAwarenessUpdate);\n    this.channel.addEventListener('message', this.handleChannelMessage);\n  }\n\n  disconnect(): void {\n    this.channel?.close();\n    this.channel = null;\n    this.awareness?.off('update', this.handleAwarenessUpdate);\n    this.awareness = null;\n  }\n\n  handleAwarenessUpdate = (changes: AwarenessChanges, origin: unknown) => {\n    if (this.awareness === null) {\n      return;\n    }\n\n    if (origin === 'remote') {\n      return;\n    }\n\n    const changedClients = Object.values(changes).reduce((res, cur) =>\n      res.concat(cur)\n    );\n\n    const update = encodeAwarenessUpdate(this.awareness, changedClients);\n    this.channel?.postMessage({\n      type: 'update',\n      update: update,\n    } satisfies ChannelMessage);\n  };\n\n  handleChannelMessage = (event: MessageEvent<ChannelMessage>) => {\n    if (this.awareness === null) {\n      return;\n    }\n\n    if (event.data.type === 'update') {\n      const update = event.data.update;\n      applyAwarenessUpdate(this.awareness, update, 'remote');\n    }\n    if (event.data.type === 'connect') {\n      this.channel?.postMessage({\n        type: 'update',\n        update: encodeAwarenessUpdate(this.awareness, [\n          this.awareness.clientID,\n        ]),\n      } satisfies ChannelMessage);\n    }\n  };\n}\n","export function uint8ArrayToBase64(array: Uint8Array): Promise<string> {\n  return new Promise<string>(resolve => {\n    // Create a blob from the Uint8Array\n    const blob = new Blob([array]);\n\n    const reader = new FileReader();\n    reader.onload = function () {\n      const dataUrl = reader.result as string | null;\n      if (!dataUrl) {\n        resolve('');\n        return;\n      }\n      // The result includes the `data:` URL prefix and the MIME type. We only want the Base64 data\n      const base64 = dataUrl.split(',')[1];\n      resolve(base64);\n    };\n\n    reader.readAsDataURL(blob);\n  });\n}\n\nexport function base64ToUint8Array(base64: string) {\n  const binaryString = atob(base64);\n  const binaryArray = binaryString.split('').map(function (char) {\n    return char.charCodeAt(0);\n  });\n  return new Uint8Array(binaryArray);\n}\n","import { DebugLogger } from '@affine/debug';\nimport type { AwarenessConnection } from '@toeverything/infra';\nimport type { Socket } from 'socket.io-client';\nimport type { Awareness } from 'y-protocols/awareness';\nimport {\n  applyAwarenessUpdate,\n  encodeAwarenessUpdate,\n  removeAwarenessStates,\n} from 'y-protocols/awareness';\n\nimport { base64ToUint8Array, uint8ArrayToBase64 } from '../../utils/base64';\n\nconst logger = new DebugLogger('affine:awareness:socketio');\n\ntype AwarenessChanges = Record<'added' | 'updated' | 'removed', number[]>;\n\nexport class CloudAwarenessConnection implements AwarenessConnection {\n  awareness: Awareness | null = null;\n\n  constructor(\n    private readonly workspaceId: string,\n    private readonly socket: Socket\n  ) {}\n\n  connect(awareness: Awareness): void {\n    this.socket.on('server-awareness-broadcast', this.awarenessBroadcast);\n    this.socket.on(\n      'new-client-awareness-init',\n      this.newClientAwarenessInitHandler\n    );\n    this.awareness = awareness;\n    this.awareness.on('update', this.awarenessUpdate);\n\n    window.addEventListener('beforeunload', this.windowBeforeUnloadHandler);\n\n    this.socket.on('connect', this.handleConnect);\n    this.socket.on('server-version-rejected', this.handleReject);\n\n    if (this.socket.connected) {\n      this.handleConnect();\n    } else {\n      this.socket.connect();\n    }\n  }\n\n  disconnect(): void {\n    if (this.awareness) {\n      removeAwarenessStates(\n        this.awareness,\n        [this.awareness.clientID],\n        'disconnect'\n      );\n      this.awareness.off('update', this.awarenessUpdate);\n    }\n    this.awareness = null;\n\n    this.socket.emit('client-leave-awareness', this.workspaceId);\n    this.socket.off('server-awareness-broadcast', this.awarenessBroadcast);\n    this.socket.off(\n      'new-client-awareness-init',\n      this.newClientAwarenessInitHandler\n    );\n    this.socket.off('connect', this.handleConnect);\n    this.socket.off('server-version-rejected', this.handleReject);\n    window.removeEventListener('unload', this.windowBeforeUnloadHandler);\n  }\n\n  awarenessBroadcast = ({\n    workspaceId: wsId,\n    awarenessUpdate,\n  }: {\n    workspaceId: string;\n    awarenessUpdate: string;\n  }) => {\n    if (!this.awareness) {\n      return;\n    }\n    if (wsId !== this.workspaceId) {\n      return;\n    }\n    applyAwarenessUpdate(\n      this.awareness,\n      base64ToUint8Array(awarenessUpdate),\n      'remote'\n    );\n  };\n\n  awarenessUpdate = (changes: AwarenessChanges, origin: unknown) => {\n    if (!this.awareness) {\n      return;\n    }\n\n    if (origin === 'remote') {\n      return;\n    }\n\n    const changedClients = Object.values(changes).reduce((res, cur) =>\n      res.concat(cur)\n    );\n\n    const update = encodeAwarenessUpdate(this.awareness, changedClients);\n    uint8ArrayToBase64(update)\n      .then(encodedUpdate => {\n        this.socket.emit('awareness-update', {\n          workspaceId: this.workspaceId,\n          awarenessUpdate: encodedUpdate,\n        });\n      })\n      .catch(err => logger.error(err));\n  };\n\n  newClientAwarenessInitHandler = () => {\n    if (!this.awareness) {\n      return;\n    }\n\n    const awarenessUpdate = encodeAwarenessUpdate(this.awareness, [\n      this.awareness.clientID,\n    ]);\n    uint8ArrayToBase64(awarenessUpdate)\n      .then(encodedAwarenessUpdate => {\n        this.socket.emit('awareness-update', {\n          workspaceId: this.workspaceId,\n          awarenessUpdate: encodedAwarenessUpdate,\n        });\n      })\n      .catch(err => logger.error(err));\n  };\n\n  windowBeforeUnloadHandler = () => {\n    if (!this.awareness) {\n      return;\n    }\n\n    removeAwarenessStates(\n      this.awareness,\n      [this.awareness.clientID],\n      'window unload'\n    );\n  };\n\n  handleConnect = () => {\n    this.socket.emit(\n      'client-handshake-awareness',\n      {\n        workspaceId: this.workspaceId,\n        version: runtimeConfig.appVersion,\n      },\n      (res: any) => {\n        logger.debug('awareness handshake finished', res);\n        this.socket.emit('awareness-init', this.workspaceId, (res: any) => {\n          logger.debug('awareness-init finished', res);\n        });\n      }\n    );\n  };\n\n  handleReject = () => {\n    this.socket.off('server-version-rejected', this.handleReject);\n    this.disconnect();\n    this.socket.disconnect();\n  };\n}\n","import type { BlobStorage } from '@toeverything/infra';\n\nexport const predefinedStaticFiles = [\n  '029uztLz2CzJezK7UUhrbGiWUdZ0J7NVs_qR6RDsvb8=',\n  '047ebf2c9a5c7c9d8521c2ea5e6140ff7732ef9e28a9f944e9bf3ca4',\n  '0hjYqQd8SvwHT2gPds7qFw8W6qIEGVbZvG45uzoYjUU=',\n  '1326bc48553a572c6756d9ee1b30a0dfdda26222fc2d2c872b14e609',\n  '27f983d0765289c19d10ee0b51c00c3c7665236a1a82406370d46e0a',\n  '28516717d63e469cd98729ff46be6595711898bab3dc43302319a987',\n  '4HXJrnBZGaGPFpowNawNog0aMg3dgoVaAnNqEMeUxq0=',\n  '5Cfem_137WmzR35ZeIC76oTkq5SQt-eHlZwJiLy0hgU=',\n  '6aa785ee927547ce9dd9d7b43e01eac948337fe57571443e87bc3a60',\n  '8oj6ym4HlTcshT40Zn6D5DeOgaVCSOOXJvT_EyiqUw8=',\n  '9288be57321c8772d04e05dbb69a22742372b3534442607a2d6a9998',\n  '9vXwWGEX5W9v5pzwpu0eK4pf22DZ_sCloO0zCH1aVQ4=',\n  'Bd5F0WRI0fLh8RK1al9PawPVT3jv7VwBrqiiBEtdV-g=',\n  'CBWoKrhSDndjBJzscQKENRqiXOOZnzIA5qyiCoy4-A0=',\n  'D7g-4LMqOsVWBNOD-_kGgCOvJEoc8rcpYbkfDlF2u5U=',\n  'Vqc8rxFbGyc5L1QeE_Zr10XEcIai_0Xw4Qv6d3ldRPE=',\n  'VuXYyM9JUv1Fv_qjg1v5Go4Zksz0r4NXFeh3Na7JkIc=',\n  'bfXllFddegV9vvxPcSWnOtm-_tuzXm-0OQ59z9Su1zA=',\n  'c820edeeba50006b531883903f5bb0b96bf523c9a6b3ce5868f03db5',\n  'cw9XjQ-pCeSW7LKMzVREGHeCPTXWYbtE-QbZLEY3RrI=',\n  'e93536e1be97e3b5206d43bf0793fdef24e60044d174f0abdefebe08',\n  'f9yKnlNMgKhF-CxOgHBsXkxfViCCkC6KwTv6Uj2Fcjw=',\n  'fb0SNPtMpQlzBQ90_PB7vCu34WpiSUJbNKocFkL2vIo=',\n  'gZLmSgmwumNdgf0eIfOSW44emctrLyFUaZapbk8eZ6s=',\n  'i39ZQ24NlUfWI0MhkbtvHTzGnWMVdr-aC2aOjvHPVg4=',\n  'k07JiWnb-S7qgd9gDQNgqo-LYMe03RX8fR0TXQ-SpG4=',\n  'nSEEkYxrThpZfLoPNOzMp6HWekvutAIYmADElDe1J6I=',\n  'pIqdA3pM1la1gKzxOmAcpLmTh3yXBrL9mGTz_hGj5xE=',\n  'qezoK6du9n3PF4dl4aq5r7LeXz_sV3xOVpFzVVgjNsE=',\n  'rY96Bunn-69CnNe5X_e5CJLwgCJnN6rcbUisecs8kkQ=',\n  'sNVNYDBzUDN2J9OFVJdLJlryBLzRZBLl-4MTNoPF1tA=',\n  'uvpOG9DrldeqIGNaqfwjFdMw_CcfXKfiEjYf7RXdeL0=',\n  'v2yF7lY2L5rtorTtTmYFsoMb9dBPKs5M1y9cUKxcI1M=',\n];\n\nexport class StaticBlobStorage implements BlobStorage {\n  name = 'static';\n  readonly = true;\n  async get(key: string) {\n    const isStaticResource =\n      predefinedStaticFiles.includes(key) || key.startsWith('/static/');\n\n    if (!isStaticResource) {\n      return null;\n    }\n\n    const path = key.startsWith('/static/') ? key : `/static/${key}`;\n    const response = await fetch(path);\n\n    if (response.ok) {\n      return await response.blob();\n    }\n\n    return null;\n  }\n\n  async set(key: string) {\n    // ignore\n    return key;\n  }\n  async delete() {\n    // ignore\n  }\n  async list() {\n    // ignore\n    return [];\n  }\n}\n","import { DebugLogger } from '@affine/debug';\nimport {\n  ErrorNames,\n  UserFriendlyError,\n  type UserFriendlyErrorResponse,\n} from '@affine/graphql';\nimport type { DocServer } from '@toeverything/infra';\nimport { throwIfAborted } from '@toeverything/infra';\nimport type { Socket } from 'socket.io-client';\n\nimport { base64ToUint8Array, uint8ArrayToBase64 } from '../../utils/base64';\n\n(window as any)._TEST_SIMULATE_SYNC_LAG = Promise.resolve();\n\nconst logger = new DebugLogger('affine-cloud-doc-engine-server');\n\ntype WebsocketResponse<T> = { error: UserFriendlyErrorResponse } | { data: T };\n\nexport class CloudDocEngineServer implements DocServer {\n  interruptCb: ((reason: string) => void) | null = null;\n  SEND_TIMEOUT = 30000;\n\n  constructor(\n    private readonly workspaceId: string,\n    private readonly socket: Socket\n  ) {}\n\n  private async clientHandShake() {\n    await this.socket.emitWithAck('client-handshake-sync', {\n      workspaceId: this.workspaceId,\n      version: runtimeConfig.appVersion,\n    });\n  }\n\n  async pullDoc(docId: string, state: Uint8Array) {\n    // for testing\n    await (window as any)._TEST_SIMULATE_SYNC_LAG;\n\n    const stateVector = state ? await uint8ArrayToBase64(state) : undefined;\n\n    const response: WebsocketResponse<{\n      missing: string;\n      state: string;\n      timestamp: number;\n    }> = await this.socket\n      .timeout(this.SEND_TIMEOUT)\n      .emitWithAck('doc-load-v2', {\n        workspaceId: this.workspaceId,\n        guid: docId,\n        stateVector,\n      });\n\n    if ('error' in response) {\n      const error = new UserFriendlyError(response.error);\n      if (error.name === ErrorNames.DOC_NOT_FOUND) {\n        return null;\n      } else {\n        throw error;\n      }\n    } else {\n      return {\n        data: base64ToUint8Array(response.data.missing),\n        stateVector: response.data.state\n          ? base64ToUint8Array(response.data.state)\n          : undefined,\n        serverClock: response.data.timestamp,\n      };\n    }\n  }\n  async pushDoc(docId: string, data: Uint8Array) {\n    const payload = await uint8ArrayToBase64(data);\n\n    const response: WebsocketResponse<{ timestamp: number }> = await this.socket\n      .timeout(this.SEND_TIMEOUT)\n      .emitWithAck('client-update-v2', {\n        workspaceId: this.workspaceId,\n        guid: docId,\n        updates: [payload],\n      });\n\n    if ('error' in response) {\n      logger.error('client-update-v2 error', {\n        workspaceId: this.workspaceId,\n        guid: docId,\n        response,\n      });\n\n      throw new UserFriendlyError(response.error);\n    }\n\n    return { serverClock: response.data.timestamp };\n  }\n  async loadServerClock(after: number): Promise<Map<string, number>> {\n    const response: WebsocketResponse<Record<string, number>> =\n      await this.socket\n        .timeout(this.SEND_TIMEOUT)\n        .emitWithAck('client-pre-sync', {\n          workspaceId: this.workspaceId,\n          timestamp: after,\n        });\n\n    if ('error' in response) {\n      logger.error('client-pre-sync error', {\n        workspaceId: this.workspaceId,\n        response,\n      });\n\n      throw new UserFriendlyError(response.error);\n    }\n\n    return new Map(Object.entries(response.data));\n  }\n  async subscribeAllDocs(\n    cb: (updates: {\n      docId: string;\n      data: Uint8Array;\n      serverClock: number;\n    }) => void\n  ): Promise<() => void> {\n    const handleUpdate = async (message: {\n      workspaceId: string;\n      guid: string;\n      updates: string[];\n      timestamp: number;\n    }) => {\n      if (message.workspaceId === this.workspaceId) {\n        message.updates.forEach(update => {\n          cb({\n            docId: message.guid,\n            data: base64ToUint8Array(update),\n            serverClock: message.timestamp,\n          });\n        });\n      }\n    };\n    this.socket.on('server-updates', handleUpdate);\n\n    return () => {\n      this.socket.off('server-updates', handleUpdate);\n    };\n  }\n  async waitForConnectingServer(signal: AbortSignal): Promise<void> {\n    this.socket.on('server-version-rejected', this.handleVersionRejected);\n    this.socket.on('disconnect', this.handleDisconnect);\n\n    throwIfAborted(signal);\n    if (this.socket.connected) {\n      await this.clientHandShake();\n    } else {\n      this.socket.connect();\n      await new Promise<void>((resolve, reject) => {\n        this.socket.on('connect', () => {\n          resolve();\n        });\n        signal.addEventListener('abort', () => {\n          reject('aborted');\n        });\n      });\n      throwIfAborted(signal);\n      await this.clientHandShake();\n    }\n  }\n  disconnectServer(): void {\n    if (!this.socket) {\n      return;\n    }\n\n    this.socket.emit('client-leave-sync', this.workspaceId);\n    this.socket.off('server-version-rejected', this.handleVersionRejected);\n    this.socket.off('disconnect', this.handleDisconnect);\n    this.socket.disconnect();\n  }\n  onInterrupted = (cb: (reason: string) => void) => {\n    this.interruptCb = cb;\n  };\n  handleInterrupted = (reason: string) => {\n    this.interruptCb?.(reason);\n  };\n  handleDisconnect = (reason: Socket.DisconnectReason) => {\n    this.interruptCb?.(reason);\n  };\n  handleVersionRejected = () => {\n    this.interruptCb?.('Client version rejected');\n  };\n}\n","export class CloudStaticDocStorage {\n  name = 'cloud-static';\n  constructor(private readonly workspaceId: string) {}\n\n  async pull(\n    docId: string\n  ): Promise<{ data: Uint8Array; state?: Uint8Array | undefined } | null> {\n    const response = await fetch(\n      `/api/workspaces/${this.workspaceId}/docs/${docId}`,\n      {\n        priority: 'high',\n      } as any\n    );\n    if (response.ok) {\n      const arrayBuffer = await response.arrayBuffer();\n\n      return { data: new Uint8Array(arrayBuffer) };\n    }\n\n    return null;\n  }\n}\n","import type { BlobStorage } from '@toeverything/infra';\nimport { createStore, del, get, keys, set } from 'idb-keyval';\n\nimport { bufferToBlob } from '../../utils/buffer-to-blob';\n\nexport class IndexedDBBlobStorage implements BlobStorage {\n  constructor(private readonly workspaceId: string) {}\n\n  name = 'indexeddb';\n  readonly = false;\n  db = createStore(`${this.workspaceId}_blob`, 'blob');\n  mimeTypeDb = createStore(`${this.workspaceId}_blob_mime`, 'blob_mime');\n\n  async get(key: string) {\n    const res = await get<ArrayBuffer>(key, this.db);\n    if (res) {\n      return bufferToBlob(res);\n    }\n    return null;\n  }\n  async set(key: string, value: Blob) {\n    await set(key, await value.arrayBuffer(), this.db);\n    await set(key, value.type, this.mimeTypeDb);\n    return key;\n  }\n  async delete(key: string) {\n    await del(key, this.db);\n    await del(key, this.mimeTypeDb);\n  }\n  async list() {\n    return keys<string>(this.db);\n  }\n}\n","import type { DocEvent, DocEventBus } from '@toeverything/infra';\n\nexport class BroadcastChannelDocEventBus implements DocEventBus {\n  senderChannel = new BroadcastChannel('doc:' + this.workspaceId);\n  constructor(private readonly workspaceId: string) {}\n  emit(event: DocEvent): void {\n    this.senderChannel.postMessage(event);\n  }\n\n  on(cb: (event: DocEvent) => void): () => void {\n    const listener = (event: MessageEvent<DocEvent>) => {\n      cb(event.data);\n    };\n    const channel = new BroadcastChannel('doc:' + this.workspaceId);\n    channel.addEventListener('message', listener);\n    return () => {\n      channel.removeEventListener('message', listener);\n      channel.close();\n    };\n  }\n}\n","import type { ByteKV, ByteKVBehavior, DocStorage } from '@toeverything/infra';\nimport type { DBSchema, IDBPDatabase, IDBPObjectStore } from 'idb';\nimport { openDB } from 'idb';\nimport { mergeUpdates } from 'yjs';\n\nimport { BroadcastChannelDocEventBus } from './doc-broadcast-channel';\n\nfunction isEmptyUpdate(binary: Uint8Array) {\n  return (\n    binary.byteLength === 0 ||\n    (binary.byteLength === 2 && binary[0] === 0 && binary[1] === 0)\n  );\n}\n\nexport class IndexedDBDocStorage implements DocStorage {\n  constructor(private readonly workspaceId: string) {}\n  eventBus = new BroadcastChannelDocEventBus(this.workspaceId);\n  readonly doc = new Doc();\n  readonly syncMetadata = new KV(`${this.workspaceId}:sync-metadata`);\n  readonly serverClock = new KV(`${this.workspaceId}:server-clock`);\n}\n\ninterface DocDBSchema extends DBSchema {\n  workspace: {\n    key: string;\n    value: {\n      id: string;\n      updates: {\n        timestamp: number;\n        update: Uint8Array;\n      }[];\n    };\n  };\n}\n\ntype DocType = DocStorage['doc'];\nclass Doc implements DocType {\n  dbName = 'affine-local';\n  dbPromise: Promise<IDBPDatabase<DocDBSchema>> | null = null;\n  dbVersion = 1;\n\n  constructor() {}\n\n  upgradeDB(db: IDBPDatabase<DocDBSchema>) {\n    db.createObjectStore('workspace', { keyPath: 'id' });\n  }\n\n  getDb() {\n    if (this.dbPromise === null) {\n      this.dbPromise = openDB<DocDBSchema>(this.dbName, this.dbVersion, {\n        upgrade: db => this.upgradeDB(db),\n      });\n    }\n    return this.dbPromise;\n  }\n\n  async get(docId: string): Promise<Uint8Array | null> {\n    const db = await this.getDb();\n    const store = db\n      .transaction('workspace', 'readonly')\n      .objectStore('workspace');\n    const data = await store.get(docId);\n\n    if (!data) {\n      return null;\n    }\n\n    const updates = data.updates\n      .map(({ update }) => update)\n      .filter(update => !isEmptyUpdate(update));\n    const update = updates.length > 0 ? mergeUpdates(updates) : null;\n\n    return update;\n  }\n\n  async set(docId: string, data: Uint8Array) {\n    const db = await this.getDb();\n    const store = db\n      .transaction('workspace', 'readwrite')\n      .objectStore('workspace');\n\n    const rows = [{ timestamp: Date.now(), update: data }];\n    await store.put({\n      id: docId,\n      updates: rows,\n    });\n  }\n\n  async keys() {\n    const db = await this.getDb();\n    const store = db\n      .transaction('workspace', 'readonly')\n      .objectStore('workspace');\n\n    return store.getAllKeys();\n  }\n\n  clear(): void | Promise<void> {\n    return;\n  }\n\n  del(_key: string): void | Promise<void> {\n    return;\n  }\n\n  async transaction<T>(\n    cb: (transaction: ByteKVBehavior) => Promise<T>\n  ): Promise<T> {\n    const db = await this.getDb();\n    const store = db\n      .transaction('workspace', 'readwrite')\n      .objectStore('workspace');\n    return await cb({\n      async get(docId) {\n        const data = await store.get(docId);\n\n        if (!data) {\n          return null;\n        }\n\n        const { updates } = data;\n        const update = mergeUpdates(updates.map(({ update }) => update));\n\n        return update;\n      },\n      keys() {\n        return store.getAllKeys();\n      },\n      async set(docId, data) {\n        const rows = [{ timestamp: Date.now(), update: data }];\n        await store.put({\n          id: docId,\n          updates: rows,\n        });\n      },\n      async clear() {\n        return await store.clear();\n      },\n      async del(key) {\n        return store.delete(key);\n      },\n    });\n  }\n}\n\ninterface KvDBSchema extends DBSchema {\n  kv: {\n    key: string;\n    value: { key: string; val: Uint8Array };\n  };\n}\n\nclass KV implements ByteKV {\n  constructor(private readonly dbName: string) {}\n\n  dbPromise: Promise<IDBPDatabase<KvDBSchema>> | null = null;\n  dbVersion = 1;\n\n  upgradeDB(db: IDBPDatabase<KvDBSchema>) {\n    db.createObjectStore('kv', { keyPath: 'key' });\n  }\n\n  getDb() {\n    if (this.dbPromise === null) {\n      this.dbPromise = openDB<KvDBSchema>(this.dbName, this.dbVersion, {\n        upgrade: db => this.upgradeDB(db),\n      });\n    }\n    return this.dbPromise;\n  }\n\n  async transaction<T>(\n    cb: (transaction: ByteKVBehavior) => Promise<T>\n  ): Promise<T> {\n    const db = await this.getDb();\n    const store = db.transaction('kv', 'readwrite').objectStore('kv');\n\n    const behavior = new KVBehavior(store);\n    return await cb(behavior);\n  }\n\n  async get(key: string): Promise<Uint8Array | null> {\n    const db = await this.getDb();\n    const store = db.transaction('kv', 'readonly').objectStore('kv');\n    return new KVBehavior(store).get(key);\n  }\n  async set(key: string, value: Uint8Array): Promise<void> {\n    const db = await this.getDb();\n    const store = db.transaction('kv', 'readwrite').objectStore('kv');\n    return new KVBehavior(store).set(key, value);\n  }\n  async keys(): Promise<string[]> {\n    const db = await this.getDb();\n    const store = db.transaction('kv', 'readwrite').objectStore('kv');\n    return new KVBehavior(store).keys();\n  }\n  async clear() {\n    const db = await this.getDb();\n    const store = db.transaction('kv', 'readwrite').objectStore('kv');\n    return new KVBehavior(store).clear();\n  }\n  async del(key: string) {\n    const db = await this.getDb();\n    const store = db.transaction('kv', 'readwrite').objectStore('kv');\n    return new KVBehavior(store).del(key);\n  }\n}\n\nclass KVBehavior implements ByteKVBehavior {\n  constructor(\n    private readonly store: IDBPObjectStore<KvDBSchema, ['kv'], 'kv', any>\n  ) {}\n  async get(key: string): Promise<Uint8Array | null> {\n    const value = await this.store.get(key);\n    return value?.val ?? null;\n  }\n  async set(key: string, value: Uint8Array): Promise<void> {\n    if (this.store.put === undefined) {\n      throw new Error('Cannot set in a readonly transaction');\n    }\n    await this.store.put({\n      key: key,\n      val: value,\n    });\n  }\n  async keys(): Promise<string[]> {\n    return await this.store.getAllKeys();\n  }\n  async del(key: string) {\n    if (this.store.delete === undefined) {\n      throw new Error('Cannot set in a readonly transaction');\n    }\n    return await this.store.delete(key);\n  }\n\n  async clear() {\n    if (this.store.clear === undefined) {\n      throw new Error('Cannot set in a readonly transaction');\n    }\n    return await this.store.clear();\n  }\n}\n","import { apis } from '@affine/electron-api';\nimport { WorkspaceFlavour } from '@affine/env/workspace';\nimport { DocCollection } from '@blocksuite/store';\nimport type {\n  BlobStorage,\n  DocStorage,\n  WorkspaceEngineProvider,\n  WorkspaceFlavourProvider,\n  WorkspaceMetadata,\n  WorkspaceProfileInfo,\n} from '@toeverything/infra';\nimport { globalBlockSuiteSchema, LiveData, Service } from '@toeverything/infra';\nimport { isEqual } from 'lodash-es';\nimport { nanoid } from 'nanoid';\nimport { Observable } from 'rxjs';\nimport { applyUpdate, encodeStateAsUpdate } from 'yjs';\n\nimport type { WorkspaceEngineStorageProvider } from '../providers/engine';\nimport { BroadcastChannelAwarenessConnection } from './engine/awareness-broadcast-channel';\nimport { StaticBlobStorage } from './engine/blob-static';\n\nexport const LOCAL_WORKSPACE_LOCAL_STORAGE_KEY = 'affine-local-workspace';\nconst LOCAL_WORKSPACE_CHANGED_BROADCAST_CHANNEL_KEY =\n  'affine-local-workspace-changed';\n\nexport class LocalWorkspaceFlavourProvider\n  extends Service\n  implements WorkspaceFlavourProvider\n{\n  constructor(\n    private readonly storageProvider: WorkspaceEngineStorageProvider\n  ) {\n    super();\n  }\n\n  flavour: WorkspaceFlavour = WorkspaceFlavour.LOCAL;\n  notifyChannel = new BroadcastChannel(\n    LOCAL_WORKSPACE_CHANGED_BROADCAST_CHANNEL_KEY\n  );\n\n  async deleteWorkspace(id: string): Promise<void> {\n    const allWorkspaceIDs: string[] = JSON.parse(\n      localStorage.getItem(LOCAL_WORKSPACE_LOCAL_STORAGE_KEY) ?? '[]'\n    );\n    localStorage.setItem(\n      LOCAL_WORKSPACE_LOCAL_STORAGE_KEY,\n      JSON.stringify(allWorkspaceIDs.filter(x => x !== id))\n    );\n\n    if (apis && environment.isDesktop) {\n      await apis.workspace.delete(id);\n    }\n\n    // notify all browser tabs, so they can update their workspace list\n    this.notifyChannel.postMessage(id);\n  }\n  async createWorkspace(\n    initial: (\n      docCollection: DocCollection,\n      blobStorage: BlobStorage,\n      docStorage: DocStorage\n    ) => Promise<void>\n  ): Promise<WorkspaceMetadata> {\n    const id = nanoid();\n\n    // save the initial state to local storage, then sync to cloud\n    const blobStorage = this.storageProvider.getBlobStorage(id);\n    const docStorage = this.storageProvider.getDocStorage(id);\n\n    const docCollection = new DocCollection({\n      id: id,\n      idGenerator: () => nanoid(),\n      schema: globalBlockSuiteSchema,\n      blobSources: { main: blobStorage },\n      disableBacklinkIndex: true,\n      disableSearchIndex: true,\n    });\n\n    // apply initial state\n    await initial(docCollection, blobStorage, docStorage);\n\n    // save workspace to local storage, should be vary fast\n    await docStorage.doc.set(id, encodeStateAsUpdate(docCollection.doc));\n    for (const subdocs of docCollection.doc.getSubdocs()) {\n      await docStorage.doc.set(subdocs.guid, encodeStateAsUpdate(subdocs));\n    }\n\n    // save workspace id to local storage\n    const allWorkspaceIDs: string[] = JSON.parse(\n      localStorage.getItem(LOCAL_WORKSPACE_LOCAL_STORAGE_KEY) ?? '[]'\n    );\n    allWorkspaceIDs.push(id);\n    localStorage.setItem(\n      LOCAL_WORKSPACE_LOCAL_STORAGE_KEY,\n      JSON.stringify(allWorkspaceIDs)\n    );\n\n    // notify all browser tabs, so they can update their workspace list\n    this.notifyChannel.postMessage(id);\n\n    return { id, flavour: WorkspaceFlavour.LOCAL };\n  }\n  workspaces$ = LiveData.from(\n    new Observable<WorkspaceMetadata[]>(subscriber => {\n      let last: WorkspaceMetadata[] | null = null;\n      const emit = () => {\n        const value = JSON.parse(\n          localStorage.getItem(LOCAL_WORKSPACE_LOCAL_STORAGE_KEY) ?? '[]'\n        ).map((id: string) => ({ id, flavour: WorkspaceFlavour.LOCAL }));\n        if (isEqual(last, value)) return;\n        subscriber.next(value);\n        last = value;\n      };\n\n      emit();\n      const channel = new BroadcastChannel(\n        LOCAL_WORKSPACE_CHANGED_BROADCAST_CHANNEL_KEY\n      );\n      channel.addEventListener('message', emit);\n\n      return () => {\n        channel.removeEventListener('message', emit);\n        channel.close();\n      };\n    }),\n    []\n  );\n  isLoading$ = new LiveData(false);\n  revalidate(): void {\n    // notify livedata to re-scan workspaces\n    this.notifyChannel.postMessage(null);\n  }\n\n  async getWorkspaceProfile(\n    id: string\n  ): Promise<WorkspaceProfileInfo | undefined> {\n    const docStorage = this.storageProvider.getDocStorage(id);\n    const localData = await docStorage.doc.get(id);\n\n    if (!localData) {\n      return {\n        isOwner: true,\n      };\n    }\n\n    const bs = new DocCollection({\n      id,\n      schema: globalBlockSuiteSchema,\n      disableBacklinkIndex: true,\n      disableSearchIndex: true,\n    });\n\n    if (localData) applyUpdate(bs.doc, localData);\n\n    return {\n      name: bs.meta.name,\n      avatar: bs.meta.avatar,\n      isOwner: true,\n    };\n  }\n  getWorkspaceBlob(id: string, blob: string): Promise<Blob | null> {\n    return this.storageProvider.getBlobStorage(id).get(blob);\n  }\n\n  getEngineProvider(workspaceId: string): WorkspaceEngineProvider {\n    return {\n      getAwarenessConnections() {\n        return [new BroadcastChannelAwarenessConnection(workspaceId)];\n      },\n      getDocServer() {\n        return null;\n      },\n      getDocStorage: () => {\n        return this.storageProvider.getDocStorage(workspaceId);\n      },\n      getLocalBlobStorage: () => {\n        return this.storageProvider.getBlobStorage(workspaceId);\n      },\n      getRemoteBlobStorages() {\n        return [new StaticBlobStorage()];\n      },\n    };\n  }\n}\n","import {\n  type BlobStorage,\n  createIdentifier,\n  type DocStorage,\n} from '@toeverything/infra';\n\nexport interface WorkspaceEngineStorageProvider {\n  getDocStorage(workspaceId: string): DocStorage;\n  getBlobStorage(workspaceId: string): BlobStorage;\n}\n\nexport const WorkspaceEngineStorageProvider =\n  createIdentifier<WorkspaceEngineStorageProvider>(\n    'WorkspaceEngineStorageProvider'\n  );\n","import {\n  AuthService,\n  GraphQLService,\n  WebSocketService,\n} from '@affine/core/modules/cloud';\nimport {\n  type Framework,\n  GlobalState,\n  WorkspaceFlavourProvider,\n} from '@toeverything/infra';\n\nimport { CloudWorkspaceFlavourProviderService } from './impls/cloud';\nimport { IndexedDBBlobStorage } from './impls/engine/blob-indexeddb';\nimport { SqliteBlobStorage } from './impls/engine/blob-sqlite';\nimport { IndexedDBDocStorage } from './impls/engine/doc-indexeddb';\nimport { SqliteDocStorage } from './impls/engine/doc-sqlite';\nimport {\n  LOCAL_WORKSPACE_LOCAL_STORAGE_KEY,\n  LocalWorkspaceFlavourProvider,\n} from './impls/local';\nimport { WorkspaceEngineStorageProvider } from './providers/engine';\n\nexport function configureBrowserWorkspaceFlavours(framework: Framework) {\n  framework\n    .impl(WorkspaceFlavourProvider('LOCAL'), LocalWorkspaceFlavourProvider, [\n      WorkspaceEngineStorageProvider,\n    ])\n    .service(CloudWorkspaceFlavourProviderService, [\n      GlobalState,\n      AuthService,\n      WorkspaceEngineStorageProvider,\n      GraphQLService,\n      WebSocketService,\n    ])\n    .impl(WorkspaceFlavourProvider('CLOUD'), p =>\n      p.get(CloudWorkspaceFlavourProviderService)\n    );\n}\n\nexport function configureIndexedDBWorkspaceEngineStorageProvider(\n  framework: Framework\n) {\n  framework.impl(WorkspaceEngineStorageProvider, {\n    getDocStorage(workspaceId: string) {\n      return new IndexedDBDocStorage(workspaceId);\n    },\n    getBlobStorage(workspaceId: string) {\n      return new IndexedDBBlobStorage(workspaceId);\n    },\n  });\n}\n\nexport function configureSqliteWorkspaceEngineStorageProvider(\n  framework: Framework\n) {\n  framework.impl(WorkspaceEngineStorageProvider, {\n    getDocStorage(workspaceId: string) {\n      return new SqliteDocStorage(workspaceId);\n    },\n    getBlobStorage(workspaceId: string) {\n      return new SqliteBlobStorage(workspaceId);\n    },\n  });\n}\n\n/**\n * a hack for directly add local workspace to workspace list\n * Used after copying sqlite database file to appdata folder\n */\nexport function _addLocalWorkspace(id: string) {\n  const allWorkspaceIDs: string[] = JSON.parse(\n    localStorage.getItem(LOCAL_WORKSPACE_LOCAL_STORAGE_KEY) ?? '[]'\n  );\n  allWorkspaceIDs.push(id);\n  localStorage.setItem(\n    LOCAL_WORKSPACE_LOCAL_STORAGE_KEY,\n    JSON.stringify(allWorkspaceIDs)\n  );\n}\n","import isSvg from 'is-svg';\n\nfunction fastCheckIsNotSvg(buffer: Uint8Array) {\n  // check first non-whitespace character is not '<svg' or '<?xml'\n  for (let i = 0; i < buffer.length; i++) {\n    const ch = buffer[i];\n\n    // skip whitespace\n    if (\n      ch === 0x20 /* \\s */ ||\n      ch === 0x09 /* \\t */ ||\n      ch === 0x0b /* \\v */ ||\n      ch === 0x0c /* \\f */ ||\n      ch === 0x0a /* \\n */ ||\n      ch === 0x0d /* \\r */ ||\n      ch === 0xa0\n    ) {\n      continue;\n    }\n\n    return (\n      !(\n        buffer[i] === /* '<' */ 0x3c &&\n        buffer[i + 1] === /* 's' */ 0x73 &&\n        buffer[i + 2] === /* 'v' */ 0x76 &&\n        buffer[i + 3] === /* 'g' */ 0x67\n      ) &&\n      !(\n        buffer[i] === /* '<' */ 0x3c &&\n        buffer[i + 1] === /* '?' */ 0x3f &&\n        buffer[i + 2] === /* 'x' */ 0x78 &&\n        buffer[i + 3] === /* 'm' */ 0x6d &&\n        buffer[i + 4] === /* 'l' */ 0x6c\n      )\n    );\n  }\n\n  return true;\n}\n\n// this has a overhead of converting to string for testing if it is svg.\nexport function isSvgBuffer(buffer: Uint8Array) {\n  if (fastCheckIsNotSvg(buffer)) {\n    return false;\n  }\n  const decoder = new TextDecoder('utf-8');\n  const str = decoder.decode(buffer);\n  return isSvg(str);\n}\n\nexport function bufferToBlob(buffer: Uint8Array | ArrayBuffer) {\n  const isSVG = isSvgBuffer(\n    buffer instanceof ArrayBuffer ? new Uint8Array(buffer) : buffer\n  );\n  // for svg blob, we need to explicitly set the type to image/svg+xml\n  return isSVG\n    ? new Blob([buffer], { type: 'image/svg+xml' })\n    : new Blob([buffer]);\n}\n","export const NotFoundPattern = () => {\n  return (\n    <svg\n      width=\"240\"\n      height=\"209\"\n      viewBox=\"0 0 240 209\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        d=\"M24.4197 172.91L119.045 8.64233L213.671 172.91H24.4197Z\"\n        stroke=\"var(--affine-text-disable-color)\"\n        strokeOpacity=\"0.6\"\n      />\n      <path\n        d=\"M165.921 91.5342L119.045 172.161L72.1684 91.5342L165.921 91.5342Z\"\n        stroke=\"var(--affine-text-disable-color)\"\n        strokeOpacity=\"0.6\"\n      />\n      <path\n        d=\"M179.022 68.1181C179.022 101.243 152.169 128.096 119.045 128.096C85.9202 128.096 59.0674 101.243 59.0674 68.1181C59.0674 34.9934 85.9202 8.14062 119.045 8.14062C152.169 8.14062 179.022 34.9934 179.022 68.1181Z\"\n        stroke=\"var(--affine-text-disable-color)\"\n        strokeOpacity=\"0.6\"\n      />\n      <circle\n        cx=\"162.485\"\n        cy=\"142.984\"\n        r=\"59.9775\"\n        transform=\"rotate(120 162.485 142.984)\"\n        stroke=\"var(--affine-text-disable-color)\"\n        strokeOpacity=\"0.6\"\n      />\n      <circle\n        cx=\"75.2925\"\n        cy=\"142.984\"\n        r=\"59.9775\"\n        transform=\"rotate(-120 75.2925 142.984)\"\n        stroke=\"var(--affine-text-disable-color)\"\n        strokeOpacity=\"0.6\"\n      />\n      <path\n        d=\"M119.045 7.64062V173.158\"\n        stroke=\"var(--affine-text-disable-color)\"\n        strokeOpacity=\"0.6\"\n      />\n      <path\n        d=\"M214.536 173.475L71.2998 91.0352\"\n        stroke=\"var(--affine-text-disable-color)\"\n        strokeOpacity=\"0.6\"\n      />\n      <path\n        d=\"M23.5547 173.475L166.791 91.0352\"\n        stroke=\"var(--affine-text-disable-color)\"\n        strokeOpacity=\"0.6\"\n      />\n      <ellipse\n        cx=\"119.045\"\n        cy=\"7.63971\"\n        rx=\"5.09284\"\n        ry=\"5.09284\"\n        fill=\"var(--affine-text-primary-color)\"\n      />\n      <ellipse\n        cx=\"214.536\"\n        cy=\"173.155\"\n        rx=\"5.09284\"\n        ry=\"5.09284\"\n        fill=\"var(--affine-text-primary-color)\"\n      />\n      <ellipse\n        cx=\"166.79\"\n        cy=\"91.0342\"\n        rx=\"5.09284\"\n        ry=\"5.09284\"\n        fill=\"var(--affine-text-primary-color)\"\n      />\n      <ellipse\n        cx=\"119.045\"\n        cy=\"173.155\"\n        rx=\"5.09284\"\n        ry=\"5.09284\"\n        fill=\"var(--affine-text-primary-color)\"\n      />\n      <ellipse\n        cx=\"71.2999\"\n        cy=\"91.0342\"\n        rx=\"5.09284\"\n        ry=\"5.09284\"\n        fill=\"var(--affine-text-primary-color)\"\n      />\n      <ellipse\n        cx=\"119.045\"\n        cy=\"91.0342\"\n        rx=\"5.09284\"\n        ry=\"5.09284\"\n        fill=\"var(--affine-text-primary-color)\"\n      />\n      <ellipse\n        cx=\"95.4903\"\n        cy=\"131.776\"\n        rx=\"5.09284\"\n        ry=\"5.09284\"\n        fill=\"var(--affine-text-primary-color)\"\n      />\n      <ellipse\n        cx=\"143.236\"\n        cy=\"131.776\"\n        rx=\"5.09284\"\n        ry=\"5.09284\"\n        fill=\"var(--affine-text-primary-color)\"\n      />\n      <ellipse\n        cx=\"23.5548\"\n        cy=\"173.155\"\n        rx=\"5.09284\"\n        ry=\"5.09284\"\n        fill=\"var(--affine-text-primary-color)\"\n      />\n    </svg>\n  );\n};\n","import \"../component/src/components/not-found-page/styles.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/components/not-found-page/styles.css.ts.vanilla.css\\\",\\\"source\\\":\\\"LnFtM3ZpODAgewogIGZvbnQtc2l6ZTogdmFyKC0tYWZmaW5lLWZvbnQtYmFzZSk7CiAgY29sb3I6IHZhcigtLWFmZmluZS10ZXh0LXByaW1hcnktY29sb3IpOwogIGhlaWdodDogMTAwdmg7CiAgZGlzcGxheTogZmxleDsKICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgd2lkdGg6IDEwMCU7CiAgcGFkZGluZzogMCAyMHB4Owp9Ci5xbTN2aTgxIHsKICBkaXNwbGF5OiBmbGV4OwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgbWFyZ2luOiAyNHB4IGF1dG8gMDsKfQoucW0zdmk4MiB7CiAgYm94LXNoYWRvdzogdmFyKC0tYWZmaW5lLWxhcmdlLWJ1dHRvbi1lZmZlY3QpICFpbXBvcnRhbnQ7Cn0=\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var largeButtonEffect = 'qm3vi82';\nexport var notFoundPageContainer = 'qm3vi80';\nexport var wrapper = 'qm3vi81';","import { useI18n } from '@affine/i18n';\nimport { SignOutIcon } from '@blocksuite/icons/rc';\n\nimport { Avatar } from '../../ui/avatar';\nimport { Button, IconButton } from '../../ui/button';\nimport { AffineOtherPageLayout } from '../affine-other-page-layout';\nimport type { User } from '../auth-components';\nimport { NotFoundPattern } from './not-found-pattern';\nimport {\n  largeButtonEffect,\n  notFoundPageContainer,\n  wrapper,\n} from './styles.css';\n\nexport interface NotFoundPageProps {\n  user?: User | null;\n  signInComponent?: JSX.Element;\n  onBack: () => void;\n  onSignOut: () => void;\n}\nexport const NoPermissionOrNotFound = ({\n  user,\n  onBack,\n  onSignOut,\n  signInComponent,\n}: NotFoundPageProps) => {\n  const t = useI18n();\n\n  return (\n    <AffineOtherPageLayout>\n      <div className={notFoundPageContainer} data-testid=\"not-found\">\n        {user ? (\n          <>\n            <div className={wrapper}>\n              <NotFoundPattern />\n            </div>\n            <p className={wrapper}>{t['404.hint']()}</p>\n            <div className={wrapper}>\n              <Button\n                variant=\"primary\"\n                size=\"extraLarge\"\n                onClick={onBack}\n                className={largeButtonEffect}\n              >\n                {t['404.back']()}\n              </Button>\n            </div>\n            <div className={wrapper}>\n              <Avatar url={user.avatar ?? user.image} name={user.label} />\n              <span style={{ margin: '0 12px' }}>{user.email}</span>\n              <IconButton\n                onClick={onSignOut}\n                size=\"20\"\n                tooltip={t['404.signOut']()}\n              >\n                <SignOutIcon />\n              </IconButton>\n            </div>\n          </>\n        ) : (\n          signInComponent\n        )}\n      </div>\n    </AffineOtherPageLayout>\n  );\n};\n\nexport const NotFoundPage = ({\n  user,\n  onBack,\n  onSignOut,\n}: NotFoundPageProps) => {\n  const t = useI18n();\n\n  return (\n    <AffineOtherPageLayout>\n      <div className={notFoundPageContainer} data-testid=\"not-found\">\n        <div className={wrapper}>\n          <NotFoundPattern />\n        </div>\n        <p className={wrapper}>{t['404.hint']()}</p>\n        <div className={wrapper}>\n          <Button\n            variant=\"primary\"\n            size=\"extraLarge\"\n            onClick={onBack}\n            className={largeButtonEffect}\n          >\n            {t['404.back']()}\n          </Button>\n        </div>\n\n        {user ? (\n          <div className={wrapper}>\n            <Avatar url={user.avatar ?? user.image} name={user.label} />\n            <span style={{ margin: '0 12px' }}>{user.email}</span>\n            <IconButton\n              onClick={onSignOut}\n              size=\"20\"\n              tooltip={t['404.signOut']()}\n            >\n              <SignOutIcon />\n            </IconButton>\n          </div>\n        ) : null}\n      </div>\n    </AffineOtherPageLayout>\n  );\n};\n","import {\n  NoPermissionOrNotFound,\n  NotFoundPage,\n} from '@affine/component/not-found-page';\nimport { useAsyncCallback } from '@affine/core/hooks/affine-async-hooks';\nimport { apis } from '@affine/electron-api';\nimport { useLiveData, useService } from '@toeverything/infra';\nimport type { ReactElement } from 'react';\nimport { useCallback, useEffect, useState } from 'react';\n\nimport { SignOutModal } from '../components/affine/sign-out-modal';\nimport { RouteLogic, useNavigateHelper } from '../hooks/use-navigate-helper';\nimport { AuthService } from '../modules/cloud';\nimport { SignIn } from './sign-in';\n\nexport const PageNotFound = ({\n  noPermission,\n}: {\n  noPermission?: boolean;\n}): ReactElement => {\n  const authService = useService(AuthService);\n  const account = useLiveData(authService.session.account$);\n  const { jumpToIndex } = useNavigateHelper();\n  const [open, setOpen] = useState(false);\n\n  const handleBackButtonClick = useCallback(\n    () => jumpToIndex(RouteLogic.REPLACE),\n    [jumpToIndex]\n  );\n\n  const handleOpenSignOutModal = useCallback(() => {\n    setOpen(true);\n  }, [setOpen]);\n\n  const onConfirmSignOut = useAsyncCallback(async () => {\n    setOpen(false);\n    await authService.signOut();\n  }, [authService]);\n\n  useEffect(() => {\n    apis?.ui.pingAppLayoutReady().catch(console.error);\n  }, []);\n\n  return (\n    <>\n      {noPermission ? (\n        <NoPermissionOrNotFound\n          user={account}\n          onBack={handleBackButtonClick}\n          onSignOut={handleOpenSignOutModal}\n          signInComponent={<SignIn />}\n        />\n      ) : (\n        <NotFoundPage\n          user={account}\n          onBack={handleBackButtonClick}\n          onSignOut={handleOpenSignOutModal}\n        />\n      )}\n\n      <SignOutModal\n        open={open}\n        onOpenChange={setOpen}\n        onConfirm={onConfirmSignOut}\n      />\n    </>\n  );\n};\n\nexport const Component = PageNotFound;\n","import { AffineOtherPageLayout } from '@affine/component/affine-other-page-layout';\nimport { SignInPageContainer } from '@affine/component/auth-components';\nimport { AuthService } from '@affine/core/modules/cloud';\nimport { useLiveData, useService } from '@toeverything/infra';\nimport { useAtom } from 'jotai';\nimport { useCallback, useEffect } from 'react';\n// eslint-disable-next-line @typescript-eslint/no-restricted-imports\nimport { useNavigate, useSearchParams } from 'react-router-dom';\n\nimport { authAtom } from '../atoms';\nimport type { AuthProps } from '../components/affine/auth';\nimport { AuthPanel } from '../components/affine/auth';\nimport { RouteLogic, useNavigateHelper } from '../hooks/use-navigate-helper';\n\nexport const SignIn = () => {\n  const [{ state, email = '', emailType = 'changePassword' }, setAuthAtom] =\n    useAtom(authAtom);\n  const session = useService(AuthService).session;\n  const status = useLiveData(session.status$);\n  const isRevalidating = useLiveData(session.isRevalidating$);\n  const navigate = useNavigate();\n  const { jumpToIndex } = useNavigateHelper();\n  const [searchParams] = useSearchParams();\n  const isLoggedIn = status === 'authenticated' && !isRevalidating;\n\n  useEffect(() => {\n    if (isLoggedIn) {\n      const redirectUri = searchParams.get('redirect_uri');\n      if (redirectUri) {\n        navigate(redirectUri, {\n          replace: true,\n        });\n      } else {\n        jumpToIndex(RouteLogic.REPLACE, {\n          search: searchParams.toString(),\n        });\n      }\n    }\n  }, [jumpToIndex, navigate, setAuthAtom, isLoggedIn, searchParams]);\n\n  const onSetEmailType = useCallback(\n    (emailType: AuthProps['emailType']) => {\n      setAuthAtom(prev => ({ ...prev, emailType }));\n    },\n    [setAuthAtom]\n  );\n\n  const onSetAuthState = useCallback(\n    (state: AuthProps['state']) => {\n      setAuthAtom(prev => ({ ...prev, state }));\n    },\n    [setAuthAtom]\n  );\n\n  const onSetAuthEmail = useCallback(\n    (email: AuthProps['email']) => {\n      setAuthAtom(prev => ({ ...prev, email }));\n    },\n    [setAuthAtom]\n  );\n\n  return (\n    <SignInPageContainer>\n      <div style={{ maxWidth: '400px', width: '100%' }}>\n        <AuthPanel\n          state={state}\n          email={email}\n          emailType={emailType}\n          setEmailType={onSetEmailType}\n          setAuthState={onSetAuthState}\n          setAuthEmail={onSetAuthEmail}\n        />\n      </div>\n    </SignInPageContainer>\n  );\n};\n\nexport const Component = () => {\n  return (\n    <AffineOtherPageLayout>\n      <div style={{ padding: '0 20px' }}>\n        <SignIn />\n      </div>\n    </AffineOtherPageLayout>\n  );\n};\n","import { wrapCreateBrowserRouter } from '@sentry/react';\nimport { createContext, useEffect, useState } from 'react';\nimport type { NavigateFunction, RouteObject } from 'react-router-dom';\nimport {\n  createBrowserRouter as reactRouterCreateBrowserRouter,\n  Outlet,\n  redirect,\n  // eslint-disable-next-line @typescript-eslint/no-restricted-imports\n  useNavigate,\n} from 'react-router-dom';\n\nexport const NavigateContext = createContext<NavigateFunction | null>(null);\n\nfunction RootRouter() {\n  const navigate = useNavigate();\n  const [ready, setReady] = useState(false);\n  useEffect(() => {\n    // a hack to make sure router is ready\n    setReady(true);\n  }, []);\n\n  return (\n    ready && (\n      <NavigateContext.Provider value={navigate}>\n        <Outlet />\n      </NavigateContext.Provider>\n    )\n  );\n}\n\nexport const topLevelRoutes = [\n  {\n    element: <RootRouter />,\n    children: [\n      {\n        path: '/',\n        lazy: () => import('./pages/index'),\n      },\n      {\n        path: '/workspace/:workspaceId/*',\n        lazy: () => import('./pages/workspace/index'),\n      },\n      {\n        path: '/share/:workspaceId/:pageId',\n        lazy: () => import('./pages/share/share-detail-page'),\n      },\n      {\n        path: '/404',\n        lazy: () => import('./pages/404'),\n      },\n      {\n        path: '/admin-panel',\n        lazy: () => import('./pages/admin-panel'),\n      },\n      {\n        path: '/auth/:authType',\n        lazy: () => import('./pages/auth'),\n      },\n      {\n        path: '/expired',\n        lazy: () => import('./pages/expired'),\n      },\n      {\n        path: '/invite/:inviteId',\n        lazy: () => import('./pages/invite'),\n      },\n      {\n        path: '/signIn',\n        lazy: () => import('./pages/sign-in'),\n      },\n      {\n        path: '/magic-link',\n        lazy: () => import('./pages/magic-link'),\n      },\n      {\n        path: '/open-app/:action',\n        lazy: () => import('./pages/open-app'),\n      },\n      {\n        path: '/upgrade-success',\n        lazy: () => import('./pages/upgrade-success'),\n      },\n      {\n        path: '/ai-upgrade-success',\n        lazy: () => import('./pages/ai-upgrade-success'),\n      },\n      {\n        path: '/desktop-signin',\n        lazy: () => import('./pages/desktop-signin'),\n      },\n      {\n        path: '/onboarding',\n        lazy: () => import('./pages/onboarding'),\n      },\n      {\n        path: '/redirect-proxy',\n        lazy: () => import('./pages/redirect'),\n      },\n      {\n        path: '/subscribe',\n        lazy: () => import('./pages/subscribe'),\n      },\n      {\n        path: '/try-cloud',\n        loader: () => {\n          return redirect(\n            `/signIn?redirect_uri=${encodeURIComponent('/?initCloud=true')}`\n          );\n        },\n      },\n      {\n        path: '/theme-editor',\n        lazy: () => import('./pages/theme-editor'),\n      },\n      {\n        path: '*',\n        lazy: () => import('./pages/404'),\n      },\n    ],\n  },\n] satisfies [RouteObject, ...RouteObject[]];\n\nexport const viewRoutes = [\n  {\n    path: '/all',\n    lazy: () => import('./pages/workspace/all-page/all-page'),\n  },\n  {\n    path: '/collection',\n    lazy: () => import('./pages/workspace/all-collection'),\n  },\n  {\n    path: '/collection/:collectionId',\n    lazy: () => import('./pages/workspace/collection/index'),\n  },\n  {\n    path: '/tag',\n    lazy: () => import('./pages/workspace/all-tag'),\n  },\n  {\n    path: '/tag/:tagId',\n    lazy: () => import('./pages/workspace/tag'),\n  },\n  {\n    path: '/trash',\n    lazy: () => import('./pages/workspace/trash-page'),\n  },\n  {\n    path: '/:pageId',\n    lazy: () => import('./pages/workspace/detail-page/detail-page'),\n  },\n  {\n    path: '*',\n    lazy: () => import('./pages/404'),\n  },\n] satisfies [RouteObject, ...RouteObject[]];\n\nconst createBrowserRouter = wrapCreateBrowserRouter(\n  reactRouterCreateBrowserRouter\n);\nexport const router = (\n  window.SENTRY_RELEASE ? createBrowserRouter : reactRouterCreateBrowserRouter\n)(topLevelRoutes, {\n  future: {\n    v7_normalizeFormMethod: true,\n  },\n});\n","import { DebugLogger } from '@affine/debug';\nimport { DocCollection } from '@blocksuite/store';\n\nexport { DocCollection };\n\nexport enum WorkspaceSubPath {\n  ALL = 'all',\n  TRASH = 'trash',\n  SHARED = 'shared',\n}\n\nexport const WorkspaceSubPathName = {\n  [WorkspaceSubPath.ALL]: 'All Pages',\n  [WorkspaceSubPath.TRASH]: 'Trash',\n  [WorkspaceSubPath.SHARED]: 'Shared',\n} satisfies {\n  [Path in WorkspaceSubPath]: string;\n};\n\nexport const pathGenerator = {\n  all: workspaceId => `/workspace/${workspaceId}/all`,\n  trash: workspaceId => `/workspace/${workspaceId}/trash`,\n  shared: workspaceId => `/workspace/${workspaceId}/shared`,\n} satisfies {\n  [Path in WorkspaceSubPath]: (workspaceId: string) => string;\n};\n\nexport const performanceLogger = new DebugLogger('performance');\nexport const performanceRenderLogger = performanceLogger.namespace('render');\n","import { isBrowser } from '@affine/env/constant';\nimport createCache from '@emotion/cache';\n\nexport default function createEmotionCache() {\n  let insertionPoint;\n\n  if (isBrowser) {\n    const emotionInsertionPoint = document.querySelector<HTMLMetaElement>(\n      'meta[name=\"emotion-insertion-point\"]'\n    );\n    insertionPoint = emotionInsertionPoint ?? undefined;\n  }\n\n  return createCache({ key: 'affine', insertionPoint });\n}\n","import { generateKeyBetween } from 'fractional-indexing';\n\nexport interface SortableProvider<T, K extends string | number> {\n  getItems(): T[];\n  getItemId(item: T): K;\n  getItemOrder(item: T): string;\n  setItemOrder(item: T, order: string): void;\n}\n\n// Using fractional-indexing managing orders of items in a list\n/**\n * @deprecated\n */\nexport function createFractionalIndexingSortableHelper<\n  T,\n  K extends string | number,\n>(provider: SortableProvider<T, K>) {\n  function getOrderedItems() {\n    return provider.getItems().sort((a, b) => {\n      const oa = provider.getItemOrder(a);\n      const ob = provider.getItemOrder(b);\n      return oa > ob ? 1 : oa < ob ? -1 : 0;\n    });\n  }\n\n  function getLargestOrder() {\n    const lastItem = getOrderedItems().at(-1);\n    return lastItem ? provider.getItemOrder(lastItem) : null;\n  }\n\n  function getSmallestOrder() {\n    const firstItem = getOrderedItems().at(0);\n    return firstItem ? provider.getItemOrder(firstItem) : null;\n  }\n\n  /**\n   * Get a new order at the end of the list\n   */\n  function getNewItemOrder() {\n    return generateKeyBetween(getLargestOrder(), null);\n  }\n\n  /**\n   * Move item from one position to another\n   *\n   * in the most common sorting case, moving over will visually place the dragging item to the target position\n   * the original item in the target position will either move up or down, depending on the direction of the drag\n   *\n   * @param fromId\n   * @param toId\n   */\n  function move(fromId: K, toId: K) {\n    const items = getOrderedItems();\n    const from = items.findIndex(i => provider.getItemId(i) === fromId);\n    const to = items.findIndex(i => provider.getItemId(i) === toId);\n    const fromItem = items[from];\n    const toItem = items[to];\n    const toNextItem = items[from < to ? to + 1 : to - 1];\n    const toOrder = toItem ? provider.getItemOrder(toItem) : null;\n    const toNextOrder = toNextItem ? provider.getItemOrder(toNextItem) : null;\n    const args: [string | null, string | null] =\n      from < to ? [toOrder, toNextOrder] : [toNextOrder, toOrder];\n    provider.setItemOrder(fromItem, generateKeyBetween(...args));\n  }\n\n  function moveTo(fromId: K, toId: K, position: 'before' | 'after') {\n    const items = getOrderedItems();\n    const from = items.findIndex(i => provider.getItemId(i) === fromId);\n    const to = items.findIndex(i => provider.getItemId(i) === toId);\n    const fromItem = items[from] as T | undefined;\n    if (fromItem === undefined) return;\n    const toItem = items[to] as T | undefined;\n    const toItemPrev = items[to - 1] as T | undefined;\n    const toItemNext = items[to + 1] as T | undefined;\n    const toItemOrder = toItem ? provider.getItemOrder(toItem) : null;\n    const toItemPrevOrder = toItemPrev\n      ? provider.getItemOrder(toItemPrev)\n      : null;\n    const toItemNextOrder = toItemNext\n      ? provider.getItemOrder(toItemNext)\n      : null;\n    if (position === 'before') {\n      provider.setItemOrder(\n        fromItem,\n        generateKeyBetween(toItemPrevOrder, toItemOrder)\n      );\n    } else {\n      provider.setItemOrder(\n        fromItem,\n        generateKeyBetween(toItemOrder, toItemNextOrder)\n      );\n    }\n  }\n\n  /**\n   * Cases example:\n   * Imagine we have the following items,  | a | b | c |\n   * 1. insertBefore('b', undefined). before is not provided, which means insert b after c\n   * | a | c |\n   *         \n   *         b\n   * result: | a | c | b |\n   *\n   * 2. insertBefore('b', 'a'). insert b before a\n   * | a | c |\n   * \n   * b\n   *\n   * result: | b | a | c |\n   */\n  function insertBefore(\n    id: string | number,\n    beforeId: string | number | undefined\n  ) {\n    const items = getOrderedItems();\n    // assert id is in the list\n    const item = items.find(i => provider.getItemId(i) === id);\n    if (!item) return;\n\n    const beforeItemIndex = items.findIndex(\n      i => provider.getItemId(i) === beforeId\n    );\n    const beforeItem = beforeItemIndex !== -1 ? items[beforeItemIndex] : null;\n    const beforeItemPrev = beforeItem ? items[beforeItemIndex - 1] : null;\n\n    const beforeOrder = beforeItem ? provider.getItemOrder(beforeItem) : null;\n    const beforePrevOrder = beforeItemPrev\n      ? provider.getItemOrder(beforeItemPrev)\n      : null;\n\n    provider.setItemOrder(\n      item,\n      generateKeyBetween(beforePrevOrder, beforeOrder)\n    );\n  }\n\n  return {\n    getOrderedItems,\n    getLargestOrder,\n    getSmallestOrder,\n    getNewItemOrder,\n    move,\n    moveTo,\n    insertBefore,\n  };\n}\n\n/**\n * generate a key between a and b, the result key is always satisfied with a < result < b.\n * the key always has a random suffix, so there is no need to worry about collision.\n *\n * make sure a and b are generated by this function.\n */\nexport function generateFractionalIndexingKeyBetween(\n  a: string | null,\n  b: string | null\n) {\n  const randomSize = 32;\n  function randomString(length: number = randomSize) {\n    const values = new Uint8Array(length);\n    crypto.getRandomValues(values);\n    const chars =\n      '123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';\n    let result = '';\n    for (let i = 0; i < length; i++) {\n      result += chars.charAt(values[i] % chars.length);\n    }\n    return result;\n  }\n\n  if (a !== null && b !== null && a >= b) {\n    throw new Error('a should be smaller than b');\n  }\n\n  // get the subkey in full key\n  // e.g.\n  // a0xxxx -> a\n  // a0x0xxxx -> a0x\n  function subkey(key: string | null) {\n    if (key === null) {\n      return null;\n    }\n    if (key.length <= randomSize + 1) {\n      // no subkey\n      return key;\n    }\n    const splitAt = key.substring(0, key.length - randomSize - 1);\n    return splitAt;\n  }\n\n  const aSubkey = subkey(a);\n  const bSubkey = subkey(b);\n\n  if (aSubkey === null && bSubkey === null) {\n    // generate a new key\n    return generateKeyBetween(null, null) + '0' + randomString();\n  } else if (aSubkey === null && bSubkey !== null) {\n    // generate a key before b\n    return generateKeyBetween(null, bSubkey) + '0' + randomString();\n  } else if (bSubkey === null && aSubkey !== null) {\n    // generate a key after a\n    return generateKeyBetween(aSubkey, null) + '0' + randomString();\n  } else if (aSubkey !== null && bSubkey !== null) {\n    // generate a key between a and b\n    if (aSubkey === bSubkey && a !== null && b !== null) {\n      // conflict, if the subkeys are the same, generate a key between fullkeys\n      return generateKeyBetween(a, b) + '0' + randomString();\n    } else {\n      return generateKeyBetween(aSubkey, bSubkey) + '0' + randomString();\n    }\n  }\n  throw new Error('Never reach here');\n}\n","import type { BaseSyntheticEvent } from 'react';\n\nexport function stopPropagation(event: BaseSyntheticEvent) {\n  event.stopPropagation();\n}\n\nexport function stopEvent(event: BaseSyntheticEvent) {\n  event.stopPropagation();\n  event.preventDefault();\n}\n\nexport function isNewTabTrigger(event?: React.MouseEvent) {\n  return event ? event.ctrlKey || event.metaKey || event.button === 1 : false;\n}\n","export function popupWindow(target: string) {\n  const url = new URL(runtimeConfig.serverUrlPrefix + '/redirect-proxy');\n  target = /^https?:\\/\\//.test(target)\n    ? target\n    : runtimeConfig.serverUrlPrefix + target;\n  url.searchParams.set('redirect_uri', target);\n  return window.open(url, '_blank', `noreferrer noopener`);\n}\n","import type { ToastOptions } from '@affine/component';\nimport { toast as basicToast } from '@affine/component';\nimport { assertEquals } from '@blocksuite/global/utils';\n\nexport const toast = (message: string, options?: ToastOptions) => {\n  const modal = document.querySelector(\n    '[role=presentation]'\n  ) as HTMLDivElement | null;\n  if (modal) {\n    assertEquals(modal.constructor, HTMLDivElement, 'modal should be div');\n  }\n  return basicToast(message, {\n    portal: modal || document.body,\n    ...options,\n  });\n};\n\ndeclare global {\n  // global Events\n  interface WindowEventMap {\n    'affine-toast:emit': CustomEvent<{\n      message: string;\n    }>;\n  }\n}\n","import reduce from 'image-blob-reduce';\n\n// validate and reduce image size and return as file\nexport const validateAndReduceImage = async (file: File): Promise<File> => {\n  // Declare a new async function that wraps the decode logic\n  const decodeAndReduceImage = async (): Promise<Blob> => {\n    const img = new Image();\n    const url = URL.createObjectURL(file);\n    img.src = url;\n\n    await img.decode().catch(() => {\n      URL.revokeObjectURL(url);\n      throw new Error('Image could not be decoded');\n    });\n\n    img.onload = img.onerror = () => {\n      URL.revokeObjectURL(url);\n    };\n\n    const sizeInMB = file.size / (1024 * 1024);\n    if (sizeInMB > 10 || img.width > 4000 || img.height > 4000) {\n      // Compress the file to less than 10MB\n      const compressedImg = await reduce().toBlob(file, {\n        max: 4000,\n        unsharpAmount: 80,\n        unsharpRadius: 0.6,\n        unsharpThreshold: 2,\n      });\n      return compressedImg;\n    }\n\n    return file;\n  };\n\n  try {\n    const reducedBlob = await decodeAndReduceImage();\n\n    return new File([reducedBlob], file.name, { type: file.type });\n  } catch (error) {\n    throw new Error('Image could not be reduce :' + error);\n  }\n};\n","import type {\n  events as helperEvents,\n  handlers as helperHandlers,\n} from '@affine/electron/helper/exposed';\nimport type {\n  events as mainEvents,\n  handlers as mainHandlers,\n} from '@affine/electron/main/exposed';\nimport type { appInfo as exposedAppInfo } from '@affine/electron/preload/electron-api';\nimport type { sharedStorage as exposedSharedStorage } from '@affine/electron/preload/shared-storage';\n\ntype MainHandlers = typeof mainHandlers;\ntype HelperHandlers = typeof helperHandlers;\ntype HelperEvents = typeof helperEvents;\ntype MainEvents = typeof mainEvents;\ntype ClientHandler = {\n  [namespace in keyof MainHandlers]: {\n    [method in keyof MainHandlers[namespace]]: MainHandlers[namespace][method] extends (\n      arg0: any,\n      ...rest: infer A\n    ) => any\n      ? (\n          ...args: A\n        ) => ReturnType<MainHandlers[namespace][method]> extends Promise<any>\n          ? ReturnType<MainHandlers[namespace][method]>\n          : Promise<ReturnType<MainHandlers[namespace][method]>>\n      : never;\n  };\n} & HelperHandlers;\ntype ClientEvents = MainEvents & HelperEvents;\n\nexport const appInfo = (globalThis as any).appInfo as\n  | typeof exposedAppInfo\n  | null;\nexport const apis = (globalThis as any).apis as ClientHandler | null;\nexport const events = (globalThis as any).events as ClientEvents | null;\n\nexport const sharedStorage = (globalThis as any).sharedStorage as\n  | typeof exposedSharedStorage\n  | null;\n\nexport type { UpdateMeta } from '@affine/electron/main/updater/event';\nexport {\n  type TabViewsMetaSchema,\n  type WorkbenchMeta,\n  type WorkbenchViewMeta,\n  type WorkbenchViewModule,\n} from '@affine/electron/main/windows-manager/tab-views-meta-schema';\n","import { GraphQLError as BaseGraphQLError } from 'graphql';\n\nimport { type ErrorDataUnion, ErrorNames } from './schema';\n\nexport interface UserFriendlyErrorResponse {\n  status: number;\n  code: string;\n  type: string;\n  name: ErrorNames;\n  message: string;\n  args?: any;\n  stacktrace?: string;\n}\n\nexport class UserFriendlyError implements UserFriendlyErrorResponse {\n  status = this.response.status;\n  code = this.response.code;\n  type = this.response.type;\n  name = this.response.name;\n  message = this.response.message;\n  args = this.response.args;\n  stacktrace = this.response.stacktrace;\n\n  static fromAnyError(response: any) {\n    if (response instanceof GraphQLError) {\n      return new UserFriendlyError(response.extensions);\n    }\n\n    if (\n      response &&\n      typeof response === 'object' &&\n      response.type &&\n      response.name\n    ) {\n      return new UserFriendlyError(response);\n    }\n\n    return new UserFriendlyError({\n      status: 500,\n      code: 'INTERNAL_SERVER_ERROR',\n      type: 'INTERNAL_SERVER_ERROR',\n      name: ErrorNames.INTERNAL_SERVER_ERROR,\n      message: 'Internal server error',\n    });\n  }\n\n  constructor(private readonly response: UserFriendlyErrorResponse) {}\n}\n\nexport class GraphQLError extends BaseGraphQLError {\n  // @ts-expect-error better to be a known type without any type casting\n  override extensions!: UserFriendlyErrorResponse;\n}\n\ntype ToPascalCase<S extends string> = S extends `${infer A}_${infer B}`\n  ? `${Capitalize<Lowercase<A>>}${ToPascalCase<B>}`\n  : Capitalize<Lowercase<S>>;\n\nexport type ErrorData = {\n  [K in ErrorNames]: Extract<\n    ErrorDataUnion,\n    { __typename?: `${ToPascalCase<K>}DataType` }\n  >;\n};\n","import type { ExecutionResult } from 'graphql';\nimport { isNil, isObject, merge } from 'lodash-es';\n\nimport { GraphQLError } from './error';\nimport type { GraphQLQuery } from './graphql';\nimport type { Mutations, Queries } from './schema';\n\nexport type NotArray<T> = T extends Array<unknown> ? never : T;\n\nexport type _QueryVariables<Q extends GraphQLQuery> =\n  Q['id'] extends Queries['name']\n    ? Extract<Queries, { name: Q['id'] }>['variables']\n    : Q['id'] extends Mutations['name']\n      ? Extract<Mutations, { name: Q['id'] }>['variables']\n      : undefined;\n\nexport type QueryVariables<Q extends GraphQLQuery> =\n  _QueryVariables<Q> extends never | Record<string, never>\n    ? never\n    : _QueryVariables<Q>;\n\nexport type QueryResponse<Q extends GraphQLQuery> = Extract<\n  Queries | Mutations,\n  { name: Q['id'] }\n>['response'];\n\ntype NullableKeys<T> = {\n  [K in keyof T]: null extends T[K] ? K : never;\n}[keyof T];\n\ntype NonNullableKeys<T> = {\n  [K in keyof T]: null extends T[K] ? never : K;\n}[keyof T];\n\nexport type RecursiveMaybeFields<T> = T extends\n  | number\n  | boolean\n  | string\n  | null\n  | undefined\n  ? T\n  : {\n      [K in NullableKeys<T>]?: RecursiveMaybeFields<T[K]>;\n    } & {\n      [K in NonNullableKeys<T>]: RecursiveMaybeFields<T[K]>;\n    };\n\ntype AllowedRequestContext = Omit<RequestInit, 'method' | 'body'>;\n\nexport interface RequestBody {\n  operationName?: string;\n  variables: any;\n  query: string;\n  form?: FormData;\n}\n\ntype QueryVariablesOption<Q extends GraphQLQuery> =\n  QueryVariables<Q> extends never\n    ? {\n        variables?: undefined;\n      }\n    : { variables: RecursiveMaybeFields<QueryVariables<Q>> };\n\nexport type RequestOptions<Q extends GraphQLQuery> = QueryVariablesOption<Q> & {\n  /**\n   * parameter passed to `fetch` function\n   */\n  context?: AllowedRequestContext;\n  /**\n   * Whether keep null or undefined value in variables.\n   *\n   * if `false` given, `{ a: 0, b: undefined, c: null }` will be converted to `{ a: 0 }`\n   *\n   * @default true\n   */\n  keepNilVariables?: boolean;\n};\n\nexport type QueryOptions<Q extends GraphQLQuery> = RequestOptions<Q> & {\n  query: Q;\n};\nexport type MutationOptions<M extends GraphQLQuery> = RequestOptions<M> & {\n  mutation: M;\n};\n\nfunction filterEmptyValue(vars: any) {\n  const newVars: Record<string, any> = {};\n  Object.entries(vars).forEach(([key, value]) => {\n    if (isNil(value)) {\n      return;\n    }\n    if (isObject(value) && !(value instanceof File)) {\n      newVars[key] = filterEmptyValue(value);\n      return;\n    }\n    newVars[key] = value;\n  });\n\n  return newVars;\n}\n\nexport function transformToForm(body: RequestBody) {\n  const form = new FormData();\n  const gqlBody: {\n    name?: string;\n    query: string;\n    variables: any;\n    map: any;\n  } = {\n    query: body.query,\n    variables: body.variables,\n    map: {},\n  };\n\n  if (body.operationName) {\n    gqlBody.name = body.operationName;\n  }\n  const map: Record<string, string[]> = {};\n  const files: File[] = [];\n  if (body.variables) {\n    let i = 0;\n    const buildMap = (key: string, value: any) => {\n      if (value instanceof File) {\n        map['' + i] = [key];\n        files[i] = value;\n        i++;\n      } else if (Array.isArray(value)) {\n        value.forEach((v, index) => {\n          buildMap(`${key}.${index}`, v);\n        });\n      } else if (isObject(value)) {\n        Object.entries(value).forEach(([k, v]) => {\n          buildMap(`${key}.${k}`, v);\n        });\n      }\n    };\n    buildMap('variables', body.variables);\n  }\n\n  form.set('operations', JSON.stringify(gqlBody));\n  form.set('map', JSON.stringify(map));\n  for (const [i, file] of files.entries()) {\n    form.set(`${i}`, file);\n  }\n  return form;\n}\n\nfunction formatRequestBody<Q extends GraphQLQuery>({\n  query,\n  variables,\n  keepNilVariables,\n}: QueryOptions<Q>): RequestBody | FormData {\n  const body: RequestBody = {\n    query: query.query,\n    variables:\n      (keepNilVariables ?? true) ? variables : filterEmptyValue(variables),\n  };\n\n  if (query.operationName) {\n    body.operationName = query.operationName;\n  }\n\n  if (query.containsFile) {\n    return transformToForm(body);\n  }\n  return body;\n}\n\nexport const gqlFetcherFactory = (\n  endpoint: string,\n  fetcher: (input: string, init?: RequestInit) => Promise<Response> = fetch\n) => {\n  const gqlFetch = async <Query extends GraphQLQuery>(\n    options: QueryOptions<Query>\n  ): Promise<QueryResponse<Query>> => {\n    const body = formatRequestBody(options);\n\n    const isFormData = body instanceof FormData;\n    const headers: Record<string, string> = {\n      'x-operation-name': options.query.operationName,\n      'x-definition-name': options.query.definitionName,\n    };\n    if (!isFormData) {\n      headers['content-type'] = 'application/json';\n    }\n    const ret = fetcher(\n      endpoint,\n      merge(options.context, {\n        method: 'POST',\n        headers,\n        body: isFormData ? body : JSON.stringify(body),\n      })\n    ).then(async res => {\n      if (res.headers.get('content-type')?.startsWith('application/json')) {\n        const result = (await res.json()) as ExecutionResult;\n        if (res.status >= 400 || result.errors) {\n          if (result.errors && result.errors.length > 0) {\n            // throw the first error is enough\n            const firstError = result.errors[0];\n            throw new GraphQLError(firstError.message, firstError);\n          } else {\n            throw new GraphQLError('Empty GraphQL error body');\n          }\n        } else if (result.data) {\n          // we have to cast here because the type of result.data is a union type\n          return result.data as any;\n        }\n      }\n\n      throw new GraphQLError(\n        'GraphQL query responds unexpected result, query ' +\n          options.query.operationName\n      );\n    });\n\n    return ret;\n  };\n\n  return gqlFetch;\n};\n","/* do not manipulate this file manually. */\nexport interface GraphQLQuery {\n  id: string;\n  operationName: string;\n  definitionName: string;\n  query: string;\n  containsFile?: boolean;\n}\n\nexport const passwordLimitsFragment = `\nfragment PasswordLimits on PasswordLimitsType {\n  minLength\n  maxLength\n}`\nexport const credentialsRequirementFragment = `\nfragment CredentialsRequirement on CredentialsRequirementType {\n  password {\n    ...PasswordLimits\n  }\n}`\nexport const adminServerConfigQuery = {\n  id: 'adminServerConfigQuery' as const,\n  operationName: 'adminServerConfig',\n  definitionName: 'serverConfig',\n  containsFile: false,\n  query: `\nquery adminServerConfig {\n  serverConfig {\n    version\n    baseUrl\n    name\n    features\n    type\n    initialized\n    credentialsRequirement {\n      ...CredentialsRequirement\n    }\n    availableUserFeatures\n  }\n}${passwordLimitsFragment}\n${credentialsRequirementFragment}`,\n};\n\nexport const deleteBlobMutation = {\n  id: 'deleteBlobMutation' as const,\n  operationName: 'deleteBlob',\n  definitionName: 'deleteBlob',\n  containsFile: false,\n  query: `\nmutation deleteBlob($workspaceId: String!, $hash: String!) {\n  deleteBlob(workspaceId: $workspaceId, hash: $hash)\n}`,\n};\n\nexport const listBlobsQuery = {\n  id: 'listBlobsQuery' as const,\n  operationName: 'listBlobs',\n  definitionName: 'listBlobs',\n  containsFile: false,\n  query: `\nquery listBlobs($workspaceId: String!) {\n  listBlobs(workspaceId: $workspaceId)\n}`,\n};\n\nexport const setBlobMutation = {\n  id: 'setBlobMutation' as const,\n  operationName: 'setBlob',\n  definitionName: 'setBlob',\n  containsFile: true,\n  query: `\nmutation setBlob($workspaceId: String!, $blob: Upload!) {\n  setBlob(workspaceId: $workspaceId, blob: $blob)\n}`,\n};\n\nexport const cancelSubscriptionMutation = {\n  id: 'cancelSubscriptionMutation' as const,\n  operationName: 'cancelSubscription',\n  definitionName: 'cancelSubscription',\n  containsFile: false,\n  query: `\nmutation cancelSubscription($idempotencyKey: String!, $plan: SubscriptionPlan = Pro) {\n  cancelSubscription(idempotencyKey: $idempotencyKey, plan: $plan) {\n    id\n    status\n    nextBillAt\n    canceledAt\n  }\n}`,\n};\n\nexport const changeEmailMutation = {\n  id: 'changeEmailMutation' as const,\n  operationName: 'changeEmail',\n  definitionName: 'changeEmail',\n  containsFile: false,\n  query: `\nmutation changeEmail($token: String!, $email: String!) {\n  changeEmail(token: $token, email: $email) {\n    id\n    email\n  }\n}`,\n};\n\nexport const createChangePasswordUrlMutation = {\n  id: 'createChangePasswordUrlMutation' as const,\n  operationName: 'createChangePasswordUrl',\n  definitionName: 'createChangePasswordUrl',\n  containsFile: false,\n  query: `\nmutation createChangePasswordUrl($callbackUrl: String!, $userId: String!) {\n  createChangePasswordUrl(callbackUrl: $callbackUrl, userId: $userId)\n}`,\n};\n\nexport const changePasswordMutation = {\n  id: 'changePasswordMutation' as const,\n  operationName: 'changePassword',\n  definitionName: 'changePassword',\n  containsFile: false,\n  query: `\nmutation changePassword($token: String!, $userId: String!, $newPassword: String!) {\n  changePassword(token: $token, userId: $userId, newPassword: $newPassword)\n}`,\n};\n\nexport const copilotQuotaQuery = {\n  id: 'copilotQuotaQuery' as const,\n  operationName: 'copilotQuota',\n  definitionName: 'currentUser',\n  containsFile: false,\n  query: `\nquery copilotQuota {\n  currentUser {\n    copilot {\n      quota {\n        limit\n        used\n      }\n    }\n  }\n}`,\n};\n\nexport const cleanupCopilotSessionMutation = {\n  id: 'cleanupCopilotSessionMutation' as const,\n  operationName: 'cleanupCopilotSession',\n  definitionName: 'cleanupCopilotSession',\n  containsFile: false,\n  query: `\nmutation cleanupCopilotSession($input: DeleteSessionInput!) {\n  cleanupCopilotSession(options: $input)\n}`,\n};\n\nexport const createCheckoutSessionMutation = {\n  id: 'createCheckoutSessionMutation' as const,\n  operationName: 'createCheckoutSession',\n  definitionName: 'createCheckoutSession',\n  containsFile: false,\n  query: `\nmutation createCheckoutSession($input: CreateCheckoutSessionInput!) {\n  createCheckoutSession(input: $input)\n}`,\n};\n\nexport const createCopilotMessageMutation = {\n  id: 'createCopilotMessageMutation' as const,\n  operationName: 'createCopilotMessage',\n  definitionName: 'createCopilotMessage',\n  containsFile: true,\n  query: `\nmutation createCopilotMessage($options: CreateChatMessageInput!) {\n  createCopilotMessage(options: $options)\n}`,\n};\n\nexport const createCopilotSessionMutation = {\n  id: 'createCopilotSessionMutation' as const,\n  operationName: 'createCopilotSession',\n  definitionName: 'createCopilotSession',\n  containsFile: false,\n  query: `\nmutation createCopilotSession($options: CreateChatSessionInput!) {\n  createCopilotSession(options: $options)\n}`,\n};\n\nexport const createCustomerPortalMutation = {\n  id: 'createCustomerPortalMutation' as const,\n  operationName: 'createCustomerPortal',\n  definitionName: 'createCustomerPortal',\n  containsFile: false,\n  query: `\nmutation createCustomerPortal {\n  createCustomerPortal\n}`,\n};\n\nexport const createUserMutation = {\n  id: 'createUserMutation' as const,\n  operationName: 'createUser',\n  definitionName: 'createUser',\n  containsFile: false,\n  query: `\nmutation createUser($input: CreateUserInput!) {\n  createUser(input: $input) {\n    id\n  }\n}`,\n};\n\nexport const createWorkspaceMutation = {\n  id: 'createWorkspaceMutation' as const,\n  operationName: 'createWorkspace',\n  definitionName: 'createWorkspace',\n  containsFile: false,\n  query: `\nmutation createWorkspace {\n  createWorkspace {\n    id\n    public\n    createdAt\n  }\n}`,\n};\n\nexport const deleteAccountMutation = {\n  id: 'deleteAccountMutation' as const,\n  operationName: 'deleteAccount',\n  definitionName: 'deleteAccount',\n  containsFile: false,\n  query: `\nmutation deleteAccount {\n  deleteAccount {\n    success\n  }\n}`,\n};\n\nexport const deleteUserMutation = {\n  id: 'deleteUserMutation' as const,\n  operationName: 'deleteUser',\n  definitionName: 'deleteUser',\n  containsFile: false,\n  query: `\nmutation deleteUser($id: String!) {\n  deleteUser(id: $id) {\n    success\n  }\n}`,\n};\n\nexport const deleteWorkspaceMutation = {\n  id: 'deleteWorkspaceMutation' as const,\n  operationName: 'deleteWorkspace',\n  definitionName: 'deleteWorkspace',\n  containsFile: false,\n  query: `\nmutation deleteWorkspace($id: String!) {\n  deleteWorkspace(id: $id)\n}`,\n};\n\nexport const forkCopilotSessionMutation = {\n  id: 'forkCopilotSessionMutation' as const,\n  operationName: 'forkCopilotSession',\n  definitionName: 'forkCopilotSession',\n  containsFile: false,\n  query: `\nmutation forkCopilotSession($options: ForkChatSessionInput!) {\n  forkCopilotSession(options: $options)\n}`,\n};\n\nexport const getCopilotHistoriesQuery = {\n  id: 'getCopilotHistoriesQuery' as const,\n  operationName: 'getCopilotHistories',\n  definitionName: 'currentUser',\n  containsFile: false,\n  query: `\nquery getCopilotHistories($workspaceId: String!, $docId: String, $options: QueryChatHistoriesInput) {\n  currentUser {\n    copilot(workspaceId: $workspaceId) {\n      histories(docId: $docId, options: $options) {\n        sessionId\n        tokens\n        action\n        createdAt\n        messages {\n          id\n          role\n          content\n          attachments\n          createdAt\n        }\n      }\n    }\n  }\n}`,\n};\n\nexport const getCopilotHistoryIdsQuery = {\n  id: 'getCopilotHistoryIdsQuery' as const,\n  operationName: 'getCopilotHistoryIds',\n  definitionName: 'currentUser',\n  containsFile: false,\n  query: `\nquery getCopilotHistoryIds($workspaceId: String!, $docId: String, $options: QueryChatHistoriesInput) {\n  currentUser {\n    copilot(workspaceId: $workspaceId) {\n      histories(docId: $docId, options: $options) {\n        sessionId\n        messages {\n          id\n          role\n          createdAt\n        }\n      }\n    }\n  }\n}`,\n};\n\nexport const getCopilotSessionsQuery = {\n  id: 'getCopilotSessionsQuery' as const,\n  operationName: 'getCopilotSessions',\n  definitionName: 'currentUser',\n  containsFile: false,\n  query: `\nquery getCopilotSessions($workspaceId: String!) {\n  currentUser {\n    copilot(workspaceId: $workspaceId) {\n      actions\n      chats\n    }\n  }\n}`,\n};\n\nexport const getCurrentUserFeaturesQuery = {\n  id: 'getCurrentUserFeaturesQuery' as const,\n  operationName: 'getCurrentUserFeatures',\n  definitionName: 'currentUser',\n  containsFile: false,\n  query: `\nquery getCurrentUserFeatures {\n  currentUser {\n    id\n    name\n    email\n    emailVerified\n    avatarUrl\n    features\n  }\n}`,\n};\n\nexport const getCurrentUserQuery = {\n  id: 'getCurrentUserQuery' as const,\n  operationName: 'getCurrentUser',\n  definitionName: 'currentUser',\n  containsFile: false,\n  query: `\nquery getCurrentUser {\n  currentUser {\n    id\n    name\n    email\n    emailVerified\n    avatarUrl\n    token {\n      sessionToken\n    }\n  }\n}`,\n};\n\nexport const getInviteInfoQuery = {\n  id: 'getInviteInfoQuery' as const,\n  operationName: 'getInviteInfo',\n  definitionName: 'getInviteInfo',\n  containsFile: false,\n  query: `\nquery getInviteInfo($inviteId: String!) {\n  getInviteInfo(inviteId: $inviteId) {\n    workspace {\n      id\n      name\n      avatar\n    }\n    user {\n      id\n      name\n      avatarUrl\n    }\n  }\n}`,\n};\n\nexport const getIsOwnerQuery = {\n  id: 'getIsOwnerQuery' as const,\n  operationName: 'getIsOwner',\n  definitionName: 'isOwner',\n  containsFile: false,\n  query: `\nquery getIsOwner($workspaceId: String!) {\n  isOwner(workspaceId: $workspaceId)\n}`,\n};\n\nexport const getMemberCountByWorkspaceIdQuery = {\n  id: 'getMemberCountByWorkspaceIdQuery' as const,\n  operationName: 'getMemberCountByWorkspaceId',\n  definitionName: 'workspace',\n  containsFile: false,\n  query: `\nquery getMemberCountByWorkspaceId($workspaceId: String!) {\n  workspace(id: $workspaceId) {\n    memberCount\n  }\n}`,\n};\n\nexport const getMembersByWorkspaceIdQuery = {\n  id: 'getMembersByWorkspaceIdQuery' as const,\n  operationName: 'getMembersByWorkspaceId',\n  definitionName: 'workspace',\n  containsFile: false,\n  query: `\nquery getMembersByWorkspaceId($workspaceId: String!, $skip: Int!, $take: Int!) {\n  workspace(id: $workspaceId) {\n    memberCount\n    members(skip: $skip, take: $take) {\n      id\n      name\n      email\n      avatarUrl\n      permission\n      inviteId\n      accepted\n      emailVerified\n    }\n  }\n}`,\n};\n\nexport const oauthProvidersQuery = {\n  id: 'oauthProvidersQuery' as const,\n  operationName: 'oauthProviders',\n  definitionName: 'serverConfig',\n  containsFile: false,\n  query: `\nquery oauthProviders {\n  serverConfig {\n    oauthProviders\n  }\n}`,\n};\n\nexport const getPromptsQuery = {\n  id: 'getPromptsQuery' as const,\n  operationName: 'getPrompts',\n  definitionName: 'listCopilotPrompts',\n  containsFile: false,\n  query: `\nquery getPrompts {\n  listCopilotPrompts {\n    name\n    model\n    action\n    config {\n      jsonMode\n      frequencyPenalty\n      presencePenalty\n      temperature\n      topP\n    }\n    messages {\n      role\n      content\n      params\n    }\n  }\n}`,\n};\n\nexport const getServerRuntimeConfigQuery = {\n  id: 'getServerRuntimeConfigQuery' as const,\n  operationName: 'getServerRuntimeConfig',\n  definitionName: 'serverRuntimeConfig',\n  containsFile: false,\n  query: `\nquery getServerRuntimeConfig {\n  serverRuntimeConfig {\n    id\n    module\n    key\n    description\n    value\n    type\n    updatedAt\n  }\n}`,\n};\n\nexport const getServerServiceConfigsQuery = {\n  id: 'getServerServiceConfigsQuery' as const,\n  operationName: 'getServerServiceConfigs',\n  definitionName: 'serverServiceConfigs',\n  containsFile: false,\n  query: `\nquery getServerServiceConfigs {\n  serverServiceConfigs {\n    name\n    config\n  }\n}`,\n};\n\nexport const getUserByEmailQuery = {\n  id: 'getUserByEmailQuery' as const,\n  operationName: 'getUserByEmail',\n  definitionName: 'userByEmail',\n  containsFile: false,\n  query: `\nquery getUserByEmail($email: String!) {\n  userByEmail(email: $email) {\n    id\n    name\n    email\n    features\n    hasPassword\n    emailVerified\n    avatarUrl\n    quota {\n      humanReadable {\n        blobLimit\n        historyPeriod\n        memberLimit\n        name\n        storageQuota\n      }\n    }\n  }\n}`,\n};\n\nexport const getUserFeaturesQuery = {\n  id: 'getUserFeaturesQuery' as const,\n  operationName: 'getUserFeatures',\n  definitionName: 'currentUser',\n  containsFile: false,\n  query: `\nquery getUserFeatures {\n  currentUser {\n    id\n    features\n  }\n}`,\n};\n\nexport const getUserQuery = {\n  id: 'getUserQuery' as const,\n  operationName: 'getUser',\n  definitionName: 'user',\n  containsFile: false,\n  query: `\nquery getUser($email: String!) {\n  user(email: $email) {\n    __typename\n    ... on UserType {\n      id\n      name\n      avatarUrl\n      email\n      hasPassword\n    }\n    ... on LimitedUserType {\n      email\n      hasPassword\n    }\n  }\n}`,\n};\n\nexport const getUsersCountQuery = {\n  id: 'getUsersCountQuery' as const,\n  operationName: 'getUsersCount',\n  definitionName: 'usersCount',\n  containsFile: false,\n  query: `\nquery getUsersCount {\n  usersCount\n}`,\n};\n\nexport const getWorkspaceFeaturesQuery = {\n  id: 'getWorkspaceFeaturesQuery' as const,\n  operationName: 'getWorkspaceFeatures',\n  definitionName: 'workspace',\n  containsFile: false,\n  query: `\nquery getWorkspaceFeatures($workspaceId: String!) {\n  workspace(id: $workspaceId) {\n    features\n  }\n}`,\n};\n\nexport const getWorkspacePublicByIdQuery = {\n  id: 'getWorkspacePublicByIdQuery' as const,\n  operationName: 'getWorkspacePublicById',\n  definitionName: 'workspace',\n  containsFile: false,\n  query: `\nquery getWorkspacePublicById($id: String!) {\n  workspace(id: $id) {\n    public\n  }\n}`,\n};\n\nexport const getWorkspacePublicPageByIdQuery = {\n  id: 'getWorkspacePublicPageByIdQuery' as const,\n  operationName: 'getWorkspacePublicPageById',\n  definitionName: 'workspace',\n  containsFile: false,\n  query: `\nquery getWorkspacePublicPageById($workspaceId: String!, $pageId: String!) {\n  workspace(id: $workspaceId) {\n    publicPage(pageId: $pageId) {\n      id\n      mode\n    }\n  }\n}`,\n};\n\nexport const getWorkspacePublicPagesQuery = {\n  id: 'getWorkspacePublicPagesQuery' as const,\n  operationName: 'getWorkspacePublicPages',\n  definitionName: 'workspace',\n  containsFile: false,\n  query: `\nquery getWorkspacePublicPages($workspaceId: String!) {\n  workspace(id: $workspaceId) {\n    publicPages {\n      id\n      mode\n    }\n  }\n}`,\n};\n\nexport const getWorkspaceQuery = {\n  id: 'getWorkspaceQuery' as const,\n  operationName: 'getWorkspace',\n  definitionName: 'workspace',\n  containsFile: false,\n  query: `\nquery getWorkspace($id: String!) {\n  workspace(id: $id) {\n    id\n  }\n}`,\n};\n\nexport const getWorkspacesQuery = {\n  id: 'getWorkspacesQuery' as const,\n  operationName: 'getWorkspaces',\n  definitionName: 'workspaces',\n  containsFile: false,\n  query: `\nquery getWorkspaces {\n  workspaces {\n    id\n    owner {\n      id\n    }\n  }\n}`,\n};\n\nexport const listHistoryQuery = {\n  id: 'listHistoryQuery' as const,\n  operationName: 'listHistory',\n  definitionName: 'workspace',\n  containsFile: false,\n  query: `\nquery listHistory($workspaceId: String!, $pageDocId: String!, $take: Int, $before: DateTime) {\n  workspace(id: $workspaceId) {\n    histories(guid: $pageDocId, take: $take, before: $before) {\n      id\n      timestamp\n    }\n  }\n}`,\n};\n\nexport const getInvoicesCountQuery = {\n  id: 'getInvoicesCountQuery' as const,\n  operationName: 'getInvoicesCount',\n  definitionName: 'currentUser',\n  containsFile: false,\n  query: `\nquery getInvoicesCount {\n  currentUser {\n    invoiceCount\n  }\n}`,\n};\n\nexport const invoicesQuery = {\n  id: 'invoicesQuery' as const,\n  operationName: 'invoices',\n  definitionName: 'currentUser',\n  containsFile: false,\n  query: `\nquery invoices($take: Int!, $skip: Int!) {\n  currentUser {\n    invoices(take: $take, skip: $skip) {\n      id\n      status\n      plan\n      recurring\n      currency\n      amount\n      reason\n      lastPaymentError\n      link\n      createdAt\n    }\n  }\n}`,\n};\n\nexport const leaveWorkspaceMutation = {\n  id: 'leaveWorkspaceMutation' as const,\n  operationName: 'leaveWorkspace',\n  definitionName: 'leaveWorkspace',\n  containsFile: false,\n  query: `\nmutation leaveWorkspace($workspaceId: String!, $workspaceName: String!, $sendLeaveMail: Boolean) {\n  leaveWorkspace(\n    workspaceId: $workspaceId\n    workspaceName: $workspaceName\n    sendLeaveMail: $sendLeaveMail\n  )\n}`,\n};\n\nexport const listUsersQuery = {\n  id: 'listUsersQuery' as const,\n  operationName: 'listUsers',\n  definitionName: 'users',\n  containsFile: false,\n  query: `\nquery listUsers($filter: ListUserInput!) {\n  users(filter: $filter) {\n    id\n    name\n    email\n    features\n    hasPassword\n    emailVerified\n    avatarUrl\n  }\n}`,\n};\n\nexport const pricesQuery = {\n  id: 'pricesQuery' as const,\n  operationName: 'prices',\n  definitionName: 'prices',\n  containsFile: false,\n  query: `\nquery prices {\n  prices {\n    type\n    plan\n    currency\n    amount\n    yearlyAmount\n    lifetimeAmount\n  }\n}`,\n};\n\nexport const publishPageMutation = {\n  id: 'publishPageMutation' as const,\n  operationName: 'publishPage',\n  definitionName: 'publishPage',\n  containsFile: false,\n  query: `\nmutation publishPage($workspaceId: String!, $pageId: String!, $mode: PublicPageMode = Page) {\n  publishPage(workspaceId: $workspaceId, pageId: $pageId, mode: $mode) {\n    id\n    mode\n  }\n}`,\n};\n\nexport const quotaQuery = {\n  id: 'quotaQuery' as const,\n  operationName: 'quota',\n  definitionName: 'currentUser,collectAllBlobSizes',\n  containsFile: false,\n  query: `\nquery quota {\n  currentUser {\n    id\n    quota {\n      name\n      blobLimit\n      storageQuota\n      historyPeriod\n      memberLimit\n      humanReadable {\n        name\n        blobLimit\n        storageQuota\n        historyPeriod\n        memberLimit\n      }\n    }\n  }\n  collectAllBlobSizes {\n    size\n  }\n}`,\n};\n\nexport const recoverDocMutation = {\n  id: 'recoverDocMutation' as const,\n  operationName: 'recoverDoc',\n  definitionName: 'recoverDoc',\n  containsFile: false,\n  query: `\nmutation recoverDoc($workspaceId: String!, $docId: String!, $timestamp: DateTime!) {\n  recoverDoc(workspaceId: $workspaceId, guid: $docId, timestamp: $timestamp)\n}`,\n};\n\nexport const removeAvatarMutation = {\n  id: 'removeAvatarMutation' as const,\n  operationName: 'removeAvatar',\n  definitionName: 'removeAvatar',\n  containsFile: false,\n  query: `\nmutation removeAvatar {\n  removeAvatar {\n    success\n  }\n}`,\n};\n\nexport const resumeSubscriptionMutation = {\n  id: 'resumeSubscriptionMutation' as const,\n  operationName: 'resumeSubscription',\n  definitionName: 'resumeSubscription',\n  containsFile: false,\n  query: `\nmutation resumeSubscription($idempotencyKey: String!, $plan: SubscriptionPlan = Pro) {\n  resumeSubscription(idempotencyKey: $idempotencyKey, plan: $plan) {\n    id\n    status\n    nextBillAt\n    start\n    end\n  }\n}`,\n};\n\nexport const revokeMemberPermissionMutation = {\n  id: 'revokeMemberPermissionMutation' as const,\n  operationName: 'revokeMemberPermission',\n  definitionName: 'revoke',\n  containsFile: false,\n  query: `\nmutation revokeMemberPermission($workspaceId: String!, $userId: String!) {\n  revoke(workspaceId: $workspaceId, userId: $userId)\n}`,\n};\n\nexport const revokePublicPageMutation = {\n  id: 'revokePublicPageMutation' as const,\n  operationName: 'revokePublicPage',\n  definitionName: 'revokePublicPage',\n  containsFile: false,\n  query: `\nmutation revokePublicPage($workspaceId: String!, $pageId: String!) {\n  revokePublicPage(workspaceId: $workspaceId, pageId: $pageId) {\n    id\n    mode\n    public\n  }\n}`,\n};\n\nexport const sendChangeEmailMutation = {\n  id: 'sendChangeEmailMutation' as const,\n  operationName: 'sendChangeEmail',\n  definitionName: 'sendChangeEmail',\n  containsFile: false,\n  query: `\nmutation sendChangeEmail($callbackUrl: String!) {\n  sendChangeEmail(callbackUrl: $callbackUrl)\n}`,\n};\n\nexport const sendChangePasswordEmailMutation = {\n  id: 'sendChangePasswordEmailMutation' as const,\n  operationName: 'sendChangePasswordEmail',\n  definitionName: 'sendChangePasswordEmail',\n  containsFile: false,\n  query: `\nmutation sendChangePasswordEmail($callbackUrl: String!) {\n  sendChangePasswordEmail(callbackUrl: $callbackUrl)\n}`,\n};\n\nexport const sendSetPasswordEmailMutation = {\n  id: 'sendSetPasswordEmailMutation' as const,\n  operationName: 'sendSetPasswordEmail',\n  definitionName: 'sendSetPasswordEmail',\n  containsFile: false,\n  query: `\nmutation sendSetPasswordEmail($callbackUrl: String!) {\n  sendSetPasswordEmail(callbackUrl: $callbackUrl)\n}`,\n};\n\nexport const sendVerifyChangeEmailMutation = {\n  id: 'sendVerifyChangeEmailMutation' as const,\n  operationName: 'sendVerifyChangeEmail',\n  definitionName: 'sendVerifyChangeEmail',\n  containsFile: false,\n  query: `\nmutation sendVerifyChangeEmail($token: String!, $email: String!, $callbackUrl: String!) {\n  sendVerifyChangeEmail(token: $token, email: $email, callbackUrl: $callbackUrl)\n}`,\n};\n\nexport const sendVerifyEmailMutation = {\n  id: 'sendVerifyEmailMutation' as const,\n  operationName: 'sendVerifyEmail',\n  definitionName: 'sendVerifyEmail',\n  containsFile: false,\n  query: `\nmutation sendVerifyEmail($callbackUrl: String!) {\n  sendVerifyEmail(callbackUrl: $callbackUrl)\n}`,\n};\n\nexport const serverConfigQuery = {\n  id: 'serverConfigQuery' as const,\n  operationName: 'serverConfig',\n  definitionName: 'serverConfig',\n  containsFile: false,\n  query: `\nquery serverConfig {\n  serverConfig {\n    version\n    baseUrl\n    name\n    features\n    type\n    credentialsRequirement {\n      ...CredentialsRequirement\n    }\n  }\n}${passwordLimitsFragment}\n${credentialsRequirementFragment}`,\n};\n\nexport const setWorkspacePublicByIdMutation = {\n  id: 'setWorkspacePublicByIdMutation' as const,\n  operationName: 'setWorkspacePublicById',\n  definitionName: 'updateWorkspace',\n  containsFile: false,\n  query: `\nmutation setWorkspacePublicById($id: ID!, $public: Boolean!) {\n  updateWorkspace(input: {id: $id, public: $public}) {\n    id\n  }\n}`,\n};\n\nexport const subscriptionQuery = {\n  id: 'subscriptionQuery' as const,\n  operationName: 'subscription',\n  definitionName: 'currentUser',\n  containsFile: false,\n  query: `\nquery subscription {\n  currentUser {\n    id\n    subscriptions {\n      id\n      status\n      plan\n      recurring\n      start\n      end\n      nextBillAt\n      canceledAt\n    }\n  }\n}`,\n};\n\nexport const updateAccountFeaturesMutation = {\n  id: 'updateAccountFeaturesMutation' as const,\n  operationName: 'updateAccountFeatures',\n  definitionName: 'updateUserFeatures',\n  containsFile: false,\n  query: `\nmutation updateAccountFeatures($userId: String!, $features: [FeatureType!]!) {\n  updateUserFeatures(id: $userId, features: $features)\n}`,\n};\n\nexport const updateAccountMutation = {\n  id: 'updateAccountMutation' as const,\n  operationName: 'updateAccount',\n  definitionName: 'updateUser',\n  containsFile: false,\n  query: `\nmutation updateAccount($id: String!, $input: ManageUserInput!) {\n  updateUser(id: $id, input: $input) {\n    id\n    name\n    email\n  }\n}`,\n};\n\nexport const updatePromptMutation = {\n  id: 'updatePromptMutation' as const,\n  operationName: 'updatePrompt',\n  definitionName: 'updateCopilotPrompt',\n  containsFile: false,\n  query: `\nmutation updatePrompt($name: String!, $messages: [CopilotPromptMessageInput!]!) {\n  updateCopilotPrompt(name: $name, messages: $messages) {\n    name\n    model\n    action\n    config {\n      jsonMode\n      frequencyPenalty\n      presencePenalty\n      temperature\n      topP\n    }\n    messages {\n      role\n      content\n      params\n    }\n  }\n}`,\n};\n\nexport const updateServerRuntimeConfigsMutation = {\n  id: 'updateServerRuntimeConfigsMutation' as const,\n  operationName: 'updateServerRuntimeConfigs',\n  definitionName: 'updateRuntimeConfigs',\n  containsFile: false,\n  query: `\nmutation updateServerRuntimeConfigs($updates: JSONObject!) {\n  updateRuntimeConfigs(updates: $updates) {\n    key\n    value\n  }\n}`,\n};\n\nexport const updateSubscriptionMutation = {\n  id: 'updateSubscriptionMutation' as const,\n  operationName: 'updateSubscription',\n  definitionName: 'updateSubscriptionRecurring',\n  containsFile: false,\n  query: `\nmutation updateSubscription($idempotencyKey: String!, $plan: SubscriptionPlan = Pro, $recurring: SubscriptionRecurring!) {\n  updateSubscriptionRecurring(\n    idempotencyKey: $idempotencyKey\n    plan: $plan\n    recurring: $recurring\n  ) {\n    id\n    plan\n    recurring\n    nextBillAt\n  }\n}`,\n};\n\nexport const updateUserProfileMutation = {\n  id: 'updateUserProfileMutation' as const,\n  operationName: 'updateUserProfile',\n  definitionName: 'updateProfile',\n  containsFile: false,\n  query: `\nmutation updateUserProfile($input: UpdateUserInput!) {\n  updateProfile(input: $input) {\n    id\n    name\n  }\n}`,\n};\n\nexport const uploadAvatarMutation = {\n  id: 'uploadAvatarMutation' as const,\n  operationName: 'uploadAvatar',\n  definitionName: 'uploadAvatar',\n  containsFile: true,\n  query: `\nmutation uploadAvatar($avatar: Upload!) {\n  uploadAvatar(avatar: $avatar) {\n    id\n    name\n    avatarUrl\n    email\n  }\n}`,\n};\n\nexport const verifyEmailMutation = {\n  id: 'verifyEmailMutation' as const,\n  operationName: 'verifyEmail',\n  definitionName: 'verifyEmail',\n  containsFile: false,\n  query: `\nmutation verifyEmail($token: String!) {\n  verifyEmail(token: $token)\n}`,\n};\n\nexport const enabledFeaturesQuery = {\n  id: 'enabledFeaturesQuery' as const,\n  operationName: 'enabledFeatures',\n  definitionName: 'workspace',\n  containsFile: false,\n  query: `\nquery enabledFeatures($id: String!) {\n  workspace(id: $id) {\n    features\n  }\n}`,\n};\n\nexport const availableFeaturesQuery = {\n  id: 'availableFeaturesQuery' as const,\n  operationName: 'availableFeatures',\n  definitionName: 'workspace',\n  containsFile: false,\n  query: `\nquery availableFeatures($id: String!) {\n  workspace(id: $id) {\n    availableFeatures\n  }\n}`,\n};\n\nexport const setWorkspaceExperimentalFeatureMutation = {\n  id: 'setWorkspaceExperimentalFeatureMutation' as const,\n  operationName: 'setWorkspaceExperimentalFeature',\n  definitionName: 'setWorkspaceExperimentalFeature',\n  containsFile: false,\n  query: `\nmutation setWorkspaceExperimentalFeature($workspaceId: String!, $feature: FeatureType!, $enable: Boolean!) {\n  setWorkspaceExperimentalFeature(\n    workspaceId: $workspaceId\n    feature: $feature\n    enable: $enable\n  )\n}`,\n};\n\nexport const addWorkspaceFeatureMutation = {\n  id: 'addWorkspaceFeatureMutation' as const,\n  operationName: 'addWorkspaceFeature',\n  definitionName: 'addWorkspaceFeature',\n  containsFile: false,\n  query: `\nmutation addWorkspaceFeature($workspaceId: String!, $feature: FeatureType!) {\n  addWorkspaceFeature(workspaceId: $workspaceId, feature: $feature)\n}`,\n};\n\nexport const listWorkspaceFeaturesQuery = {\n  id: 'listWorkspaceFeaturesQuery' as const,\n  operationName: 'listWorkspaceFeatures',\n  definitionName: 'listWorkspaceFeatures',\n  containsFile: false,\n  query: `\nquery listWorkspaceFeatures($feature: FeatureType!) {\n  listWorkspaceFeatures(feature: $feature) {\n    id\n    public\n    createdAt\n    memberCount\n    owner {\n      id\n    }\n    features\n  }\n}`,\n};\n\nexport const removeWorkspaceFeatureMutation = {\n  id: 'removeWorkspaceFeatureMutation' as const,\n  operationName: 'removeWorkspaceFeature',\n  definitionName: 'removeWorkspaceFeature',\n  containsFile: false,\n  query: `\nmutation removeWorkspaceFeature($workspaceId: String!, $feature: FeatureType!) {\n  removeWorkspaceFeature(workspaceId: $workspaceId, feature: $feature)\n}`,\n};\n\nexport const inviteByEmailMutation = {\n  id: 'inviteByEmailMutation' as const,\n  operationName: 'inviteByEmail',\n  definitionName: 'invite',\n  containsFile: false,\n  query: `\nmutation inviteByEmail($workspaceId: String!, $email: String!, $permission: Permission!, $sendInviteMail: Boolean) {\n  invite(\n    workspaceId: $workspaceId\n    email: $email\n    permission: $permission\n    sendInviteMail: $sendInviteMail\n  )\n}`,\n};\n\nexport const acceptInviteByInviteIdMutation = {\n  id: 'acceptInviteByInviteIdMutation' as const,\n  operationName: 'acceptInviteByInviteId',\n  definitionName: 'acceptInviteById',\n  containsFile: false,\n  query: `\nmutation acceptInviteByInviteId($workspaceId: String!, $inviteId: String!, $sendAcceptMail: Boolean) {\n  acceptInviteById(\n    workspaceId: $workspaceId\n    inviteId: $inviteId\n    sendAcceptMail: $sendAcceptMail\n  )\n}`,\n};\n\nexport const workspaceQuotaQuery = {\n  id: 'workspaceQuotaQuery' as const,\n  operationName: 'workspaceQuota',\n  definitionName: 'workspace',\n  containsFile: false,\n  query: `\nquery workspaceQuota($id: String!) {\n  workspace(id: $id) {\n    quota {\n      name\n      blobLimit\n      storageQuota\n      historyPeriod\n      memberLimit\n      humanReadable {\n        name\n        blobLimit\n        storageQuota\n        historyPeriod\n        memberLimit\n      }\n      usedSize\n    }\n  }\n}`,\n};\n","export * from './error';\nexport * from './fetcher';\nexport * from './graphql';\nexport * from './schema';\n\nimport { setupGlobal } from '@affine/env/global';\n\nimport { gqlFetcherFactory } from './fetcher';\n\nsetupGlobal();\n\nexport function getBaseUrl(): string {\n  if (environment.isDesktop) {\n    return runtimeConfig.serverUrlPrefix;\n  }\n  if (typeof window === 'undefined') {\n    // is nodejs\n    return '';\n  }\n  const { protocol, hostname, port } = window.location;\n  return `${protocol}//${hostname}${port ? `:${port}` : ''}`;\n}\n\nexport const fetcher = gqlFetcherFactory(getBaseUrl() + '/graphql');\n","/* eslint-disable */\nexport type Maybe<T> = T | null;\nexport type InputMaybe<T> = T | null;\nexport type Exact<T extends { [key: string]: unknown }> = {\n  [K in keyof T]: T[K];\n};\nexport type MakeOptional<T, K extends keyof T> = Omit<T, K> & {\n  [SubKey in K]?: Maybe<T[SubKey]>;\n};\nexport type MakeMaybe<T, K extends keyof T> = Omit<T, K> & {\n  [SubKey in K]: Maybe<T[SubKey]>;\n};\nexport type MakeEmpty<\n  T extends { [key: string]: unknown },\n  K extends keyof T,\n> = { [_ in K]?: never };\nexport type Incremental<T> =\n  | T\n  | {\n      [P in keyof T]?: P extends ' $fragmentName' | '__typename' ? T[P] : never;\n    };\n/** All built-in and custom scalars, mapped to their actual values */\nexport interface Scalars {\n  ID: { input: string; output: string };\n  String: { input: string; output: string };\n  Boolean: { input: boolean; output: boolean };\n  Int: { input: number; output: number };\n  Float: { input: number; output: number };\n  /** A date-time string at UTC, such as 2019-12-03T09:54:33Z, compliant with the date-time format. */\n  DateTime: { input: string; output: string };\n  /** The `JSON` scalar type represents JSON values as specified by [ECMA-404](http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf). */\n  JSON: { input: Record<string, string>; output: Record<string, string> };\n  /** The `JSONObject` scalar type represents JSON objects as specified by [ECMA-404](http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf). */\n  JSONObject: { input: any; output: any };\n  /** The `SafeInt` scalar type represents non-fractional signed whole numeric values that are considered safe as defined by the ECMAScript specification. */\n  SafeInt: { input: number; output: number };\n  /** The `Upload` scalar type represents a file upload. */\n  Upload: { input: File; output: File };\n}\n\nexport interface BlobNotFoundDataType {\n  __typename?: 'BlobNotFoundDataType';\n  blobId: Scalars['String']['output'];\n  workspaceId: Scalars['String']['output'];\n}\n\nexport enum ChatHistoryOrder {\n  asc = 'asc',\n  desc = 'desc',\n}\n\nexport interface ChatMessage {\n  __typename?: 'ChatMessage';\n  attachments: Maybe<Array<Scalars['String']['output']>>;\n  content: Scalars['String']['output'];\n  createdAt: Scalars['DateTime']['output'];\n  id: Maybe<Scalars['ID']['output']>;\n  params: Maybe<Scalars['JSON']['output']>;\n  role: Scalars['String']['output'];\n}\n\nexport interface Copilot {\n  __typename?: 'Copilot';\n  /** Get the session list of actions in the workspace */\n  actions: Array<Scalars['String']['output']>;\n  /** Get the session list of chats in the workspace */\n  chats: Array<Scalars['String']['output']>;\n  histories: Array<CopilotHistories>;\n  /** Get the quota of the user in the workspace */\n  quota: CopilotQuota;\n  workspaceId: Maybe<Scalars['ID']['output']>;\n}\n\nexport interface CopilotHistoriesArgs {\n  docId: InputMaybe<Scalars['String']['input']>;\n  options: InputMaybe<QueryChatHistoriesInput>;\n}\n\nexport interface CopilotHistories {\n  __typename?: 'CopilotHistories';\n  /** An mark identifying which view to use to display the session */\n  action: Maybe<Scalars['String']['output']>;\n  createdAt: Scalars['DateTime']['output'];\n  messages: Array<ChatMessage>;\n  sessionId: Scalars['String']['output'];\n  /** The number of tokens used in the session */\n  tokens: Scalars['Int']['output'];\n}\n\nexport interface CopilotMessageNotFoundDataType {\n  __typename?: 'CopilotMessageNotFoundDataType';\n  messageId: Scalars['String']['output'];\n}\n\nexport enum CopilotModels {\n  DallE3 = 'DallE3',\n  Gpt4Omni = 'Gpt4Omni',\n  Gpt4OmniMini = 'Gpt4OmniMini',\n  TextEmbedding3Large = 'TextEmbedding3Large',\n  TextEmbedding3Small = 'TextEmbedding3Small',\n  TextEmbeddingAda002 = 'TextEmbeddingAda002',\n  TextModerationLatest = 'TextModerationLatest',\n  TextModerationStable = 'TextModerationStable',\n}\n\nexport interface CopilotPromptConfigInput {\n  frequencyPenalty: InputMaybe<Scalars['Float']['input']>;\n  jsonMode: InputMaybe<Scalars['Boolean']['input']>;\n  presencePenalty: InputMaybe<Scalars['Float']['input']>;\n  temperature: InputMaybe<Scalars['Float']['input']>;\n  topP: InputMaybe<Scalars['Float']['input']>;\n}\n\nexport interface CopilotPromptConfigType {\n  __typename?: 'CopilotPromptConfigType';\n  frequencyPenalty: Maybe<Scalars['Float']['output']>;\n  jsonMode: Maybe<Scalars['Boolean']['output']>;\n  presencePenalty: Maybe<Scalars['Float']['output']>;\n  temperature: Maybe<Scalars['Float']['output']>;\n  topP: Maybe<Scalars['Float']['output']>;\n}\n\nexport interface CopilotPromptMessageInput {\n  content: Scalars['String']['input'];\n  params: InputMaybe<Scalars['JSON']['input']>;\n  role: CopilotPromptMessageRole;\n}\n\nexport enum CopilotPromptMessageRole {\n  assistant = 'assistant',\n  system = 'system',\n  user = 'user',\n}\n\nexport interface CopilotPromptMessageType {\n  __typename?: 'CopilotPromptMessageType';\n  content: Scalars['String']['output'];\n  params: Maybe<Scalars['JSON']['output']>;\n  role: CopilotPromptMessageRole;\n}\n\nexport interface CopilotPromptNotFoundDataType {\n  __typename?: 'CopilotPromptNotFoundDataType';\n  name: Scalars['String']['output'];\n}\n\nexport interface CopilotPromptType {\n  __typename?: 'CopilotPromptType';\n  action: Maybe<Scalars['String']['output']>;\n  config: Maybe<CopilotPromptConfigType>;\n  messages: Array<CopilotPromptMessageType>;\n  model: Scalars['String']['output'];\n  name: Scalars['String']['output'];\n}\n\nexport interface CopilotProviderSideErrorDataType {\n  __typename?: 'CopilotProviderSideErrorDataType';\n  kind: Scalars['String']['output'];\n  message: Scalars['String']['output'];\n  provider: Scalars['String']['output'];\n}\n\nexport interface CopilotQuota {\n  __typename?: 'CopilotQuota';\n  limit: Maybe<Scalars['SafeInt']['output']>;\n  used: Scalars['SafeInt']['output'];\n}\n\nexport interface CreateChatMessageInput {\n  attachments: InputMaybe<Array<Scalars['String']['input']>>;\n  blobs: InputMaybe<Array<Scalars['Upload']['input']>>;\n  content: InputMaybe<Scalars['String']['input']>;\n  params: InputMaybe<Scalars['JSON']['input']>;\n  sessionId: Scalars['String']['input'];\n}\n\nexport interface CreateChatSessionInput {\n  docId: Scalars['String']['input'];\n  /** The prompt name to use for the session */\n  promptName: Scalars['String']['input'];\n  workspaceId: Scalars['String']['input'];\n}\n\nexport interface CreateCheckoutSessionInput {\n  coupon: InputMaybe<Scalars['String']['input']>;\n  idempotencyKey: Scalars['String']['input'];\n  plan: InputMaybe<SubscriptionPlan>;\n  recurring: InputMaybe<SubscriptionRecurring>;\n  successCallbackLink: Scalars['String']['input'];\n}\n\nexport interface CreateCopilotPromptInput {\n  action: InputMaybe<Scalars['String']['input']>;\n  config: InputMaybe<CopilotPromptConfigInput>;\n  messages: Array<CopilotPromptMessageInput>;\n  model: CopilotModels;\n  name: Scalars['String']['input'];\n}\n\nexport interface CreateUserInput {\n  email: Scalars['String']['input'];\n  name: InputMaybe<Scalars['String']['input']>;\n}\n\nexport interface CredentialsRequirementType {\n  __typename?: 'CredentialsRequirementType';\n  password: PasswordLimitsType;\n}\n\nexport interface DeleteAccount {\n  __typename?: 'DeleteAccount';\n  success: Scalars['Boolean']['output'];\n}\n\nexport interface DeleteSessionInput {\n  docId: Scalars['String']['input'];\n  sessionIds: Array<Scalars['String']['input']>;\n  workspaceId: Scalars['String']['input'];\n}\n\nexport interface DocAccessDeniedDataType {\n  __typename?: 'DocAccessDeniedDataType';\n  docId: Scalars['String']['output'];\n  workspaceId: Scalars['String']['output'];\n}\n\nexport interface DocHistoryNotFoundDataType {\n  __typename?: 'DocHistoryNotFoundDataType';\n  docId: Scalars['String']['output'];\n  timestamp: Scalars['Int']['output'];\n  workspaceId: Scalars['String']['output'];\n}\n\nexport interface DocHistoryType {\n  __typename?: 'DocHistoryType';\n  id: Scalars['String']['output'];\n  timestamp: Scalars['DateTime']['output'];\n  workspaceId: Scalars['String']['output'];\n}\n\nexport interface DocNotFoundDataType {\n  __typename?: 'DocNotFoundDataType';\n  docId: Scalars['String']['output'];\n  workspaceId: Scalars['String']['output'];\n}\n\nexport type ErrorDataUnion =\n  | BlobNotFoundDataType\n  | CopilotMessageNotFoundDataType\n  | CopilotPromptNotFoundDataType\n  | CopilotProviderSideErrorDataType\n  | DocAccessDeniedDataType\n  | DocHistoryNotFoundDataType\n  | DocNotFoundDataType\n  | InvalidHistoryTimestampDataType\n  | InvalidPasswordLengthDataType\n  | InvalidRuntimeConfigTypeDataType\n  | MissingOauthQueryParameterDataType\n  | NotInWorkspaceDataType\n  | RuntimeConfigNotFoundDataType\n  | SameSubscriptionRecurringDataType\n  | SubscriptionAlreadyExistsDataType\n  | SubscriptionNotExistsDataType\n  | SubscriptionPlanNotFoundDataType\n  | UnknownOauthProviderDataType\n  | VersionRejectedDataType\n  | WorkspaceAccessDeniedDataType\n  | WorkspaceNotFoundDataType\n  | WorkspaceOwnerNotFoundDataType;\n\nexport enum ErrorNames {\n  ACCESS_DENIED = 'ACCESS_DENIED',\n  ACTION_FORBIDDEN = 'ACTION_FORBIDDEN',\n  AUTHENTICATION_REQUIRED = 'AUTHENTICATION_REQUIRED',\n  BLOB_NOT_FOUND = 'BLOB_NOT_FOUND',\n  BLOB_QUOTA_EXCEEDED = 'BLOB_QUOTA_EXCEEDED',\n  CANNOT_DELETE_ALL_ADMIN_ACCOUNT = 'CANNOT_DELETE_ALL_ADMIN_ACCOUNT',\n  CANNOT_DELETE_OWN_ACCOUNT = 'CANNOT_DELETE_OWN_ACCOUNT',\n  CANT_CHANGE_WORKSPACE_OWNER = 'CANT_CHANGE_WORKSPACE_OWNER',\n  CANT_UPDATE_LIFETIME_SUBSCRIPTION = 'CANT_UPDATE_LIFETIME_SUBSCRIPTION',\n  COPILOT_ACTION_TAKEN = 'COPILOT_ACTION_TAKEN',\n  COPILOT_FAILED_TO_CREATE_MESSAGE = 'COPILOT_FAILED_TO_CREATE_MESSAGE',\n  COPILOT_FAILED_TO_GENERATE_TEXT = 'COPILOT_FAILED_TO_GENERATE_TEXT',\n  COPILOT_MESSAGE_NOT_FOUND = 'COPILOT_MESSAGE_NOT_FOUND',\n  COPILOT_PROMPT_INVALID = 'COPILOT_PROMPT_INVALID',\n  COPILOT_PROMPT_NOT_FOUND = 'COPILOT_PROMPT_NOT_FOUND',\n  COPILOT_PROVIDER_SIDE_ERROR = 'COPILOT_PROVIDER_SIDE_ERROR',\n  COPILOT_QUOTA_EXCEEDED = 'COPILOT_QUOTA_EXCEEDED',\n  COPILOT_SESSION_DELETED = 'COPILOT_SESSION_DELETED',\n  COPILOT_SESSION_NOT_FOUND = 'COPILOT_SESSION_NOT_FOUND',\n  CUSTOMER_PORTAL_CREATE_FAILED = 'CUSTOMER_PORTAL_CREATE_FAILED',\n  DOC_ACCESS_DENIED = 'DOC_ACCESS_DENIED',\n  DOC_HISTORY_NOT_FOUND = 'DOC_HISTORY_NOT_FOUND',\n  DOC_NOT_FOUND = 'DOC_NOT_FOUND',\n  EARLY_ACCESS_REQUIRED = 'EARLY_ACCESS_REQUIRED',\n  EMAIL_ALREADY_USED = 'EMAIL_ALREADY_USED',\n  EMAIL_TOKEN_NOT_FOUND = 'EMAIL_TOKEN_NOT_FOUND',\n  EMAIL_VERIFICATION_REQUIRED = 'EMAIL_VERIFICATION_REQUIRED',\n  EXPECT_TO_PUBLISH_PAGE = 'EXPECT_TO_PUBLISH_PAGE',\n  EXPECT_TO_REVOKE_PUBLIC_PAGE = 'EXPECT_TO_REVOKE_PUBLIC_PAGE',\n  FAILED_TO_CHECKOUT = 'FAILED_TO_CHECKOUT',\n  INTERNAL_SERVER_ERROR = 'INTERNAL_SERVER_ERROR',\n  INVALID_EMAIL = 'INVALID_EMAIL',\n  INVALID_EMAIL_TOKEN = 'INVALID_EMAIL_TOKEN',\n  INVALID_HISTORY_TIMESTAMP = 'INVALID_HISTORY_TIMESTAMP',\n  INVALID_OAUTH_CALLBACK_STATE = 'INVALID_OAUTH_CALLBACK_STATE',\n  INVALID_PASSWORD_LENGTH = 'INVALID_PASSWORD_LENGTH',\n  INVALID_RUNTIME_CONFIG_TYPE = 'INVALID_RUNTIME_CONFIG_TYPE',\n  LINK_EXPIRED = 'LINK_EXPIRED',\n  MAILER_SERVICE_IS_NOT_CONFIGURED = 'MAILER_SERVICE_IS_NOT_CONFIGURED',\n  MEMBER_QUOTA_EXCEEDED = 'MEMBER_QUOTA_EXCEEDED',\n  MISSING_OAUTH_QUERY_PARAMETER = 'MISSING_OAUTH_QUERY_PARAMETER',\n  NOT_IN_WORKSPACE = 'NOT_IN_WORKSPACE',\n  NO_COPILOT_PROVIDER_AVAILABLE = 'NO_COPILOT_PROVIDER_AVAILABLE',\n  OAUTH_ACCOUNT_ALREADY_CONNECTED = 'OAUTH_ACCOUNT_ALREADY_CONNECTED',\n  OAUTH_STATE_EXPIRED = 'OAUTH_STATE_EXPIRED',\n  PAGE_IS_NOT_PUBLIC = 'PAGE_IS_NOT_PUBLIC',\n  PASSWORD_REQUIRED = 'PASSWORD_REQUIRED',\n  RUNTIME_CONFIG_NOT_FOUND = 'RUNTIME_CONFIG_NOT_FOUND',\n  SAME_EMAIL_PROVIDED = 'SAME_EMAIL_PROVIDED',\n  SAME_SUBSCRIPTION_RECURRING = 'SAME_SUBSCRIPTION_RECURRING',\n  SIGN_UP_FORBIDDEN = 'SIGN_UP_FORBIDDEN',\n  SUBSCRIPTION_ALREADY_EXISTS = 'SUBSCRIPTION_ALREADY_EXISTS',\n  SUBSCRIPTION_EXPIRED = 'SUBSCRIPTION_EXPIRED',\n  SUBSCRIPTION_HAS_BEEN_CANCELED = 'SUBSCRIPTION_HAS_BEEN_CANCELED',\n  SUBSCRIPTION_NOT_EXISTS = 'SUBSCRIPTION_NOT_EXISTS',\n  SUBSCRIPTION_PLAN_NOT_FOUND = 'SUBSCRIPTION_PLAN_NOT_FOUND',\n  TOO_MANY_REQUEST = 'TOO_MANY_REQUEST',\n  UNKNOWN_OAUTH_PROVIDER = 'UNKNOWN_OAUTH_PROVIDER',\n  UNSPLASH_IS_NOT_CONFIGURED = 'UNSPLASH_IS_NOT_CONFIGURED',\n  USER_AVATAR_NOT_FOUND = 'USER_AVATAR_NOT_FOUND',\n  USER_NOT_FOUND = 'USER_NOT_FOUND',\n  VERSION_REJECTED = 'VERSION_REJECTED',\n  WORKSPACE_ACCESS_DENIED = 'WORKSPACE_ACCESS_DENIED',\n  WORKSPACE_NOT_FOUND = 'WORKSPACE_NOT_FOUND',\n  WORKSPACE_OWNER_NOT_FOUND = 'WORKSPACE_OWNER_NOT_FOUND',\n  WRONG_SIGN_IN_CREDENTIALS = 'WRONG_SIGN_IN_CREDENTIALS',\n  WRONG_SIGN_IN_METHOD = 'WRONG_SIGN_IN_METHOD',\n}\n\n/** The type of workspace feature */\nexport enum FeatureType {\n  AIEarlyAccess = 'AIEarlyAccess',\n  Admin = 'Admin',\n  Copilot = 'Copilot',\n  EarlyAccess = 'EarlyAccess',\n  UnlimitedCopilot = 'UnlimitedCopilot',\n  UnlimitedWorkspace = 'UnlimitedWorkspace',\n}\n\nexport interface ForkChatSessionInput {\n  docId: Scalars['String']['input'];\n  /** Identify a message in the array and keep it with all previous messages into a forked session. */\n  latestMessageId: Scalars['String']['input'];\n  sessionId: Scalars['String']['input'];\n  workspaceId: Scalars['String']['input'];\n}\n\nexport interface HumanReadableQuotaType {\n  __typename?: 'HumanReadableQuotaType';\n  blobLimit: Scalars['String']['output'];\n  copilotActionLimit: Maybe<Scalars['String']['output']>;\n  historyPeriod: Scalars['String']['output'];\n  memberLimit: Scalars['String']['output'];\n  name: Scalars['String']['output'];\n  storageQuota: Scalars['String']['output'];\n}\n\nexport interface InvalidHistoryTimestampDataType {\n  __typename?: 'InvalidHistoryTimestampDataType';\n  timestamp: Scalars['String']['output'];\n}\n\nexport interface InvalidPasswordLengthDataType {\n  __typename?: 'InvalidPasswordLengthDataType';\n  max: Scalars['Int']['output'];\n  min: Scalars['Int']['output'];\n}\n\nexport interface InvalidRuntimeConfigTypeDataType {\n  __typename?: 'InvalidRuntimeConfigTypeDataType';\n  get: Scalars['String']['output'];\n  key: Scalars['String']['output'];\n  want: Scalars['String']['output'];\n}\n\nexport interface InvitationType {\n  __typename?: 'InvitationType';\n  /** Invitee information */\n  invitee: UserType;\n  /** User information */\n  user: UserType;\n  /** Workspace information */\n  workspace: InvitationWorkspaceType;\n}\n\nexport interface InvitationWorkspaceType {\n  __typename?: 'InvitationWorkspaceType';\n  /** Base64 encoded avatar */\n  avatar: Scalars['String']['output'];\n  id: Scalars['ID']['output'];\n  /** Workspace name */\n  name: Scalars['String']['output'];\n}\n\nexport interface InviteUserType {\n  __typename?: 'InviteUserType';\n  /** User accepted */\n  accepted: Scalars['Boolean']['output'];\n  /** User avatar url */\n  avatarUrl: Maybe<Scalars['String']['output']>;\n  /**\n   * User email verified\n   * @deprecated useless\n   */\n  createdAt: Maybe<Scalars['DateTime']['output']>;\n  /** User email */\n  email: Maybe<Scalars['String']['output']>;\n  /** User email verified */\n  emailVerified: Maybe<Scalars['Boolean']['output']>;\n  /** User password has been set */\n  hasPassword: Maybe<Scalars['Boolean']['output']>;\n  id: Scalars['ID']['output'];\n  /** Invite id */\n  inviteId: Scalars['String']['output'];\n  /** User name */\n  name: Maybe<Scalars['String']['output']>;\n  /** User permission in workspace */\n  permission: Permission;\n}\n\nexport enum InvoiceStatus {\n  Draft = 'Draft',\n  Open = 'Open',\n  Paid = 'Paid',\n  Uncollectible = 'Uncollectible',\n  Void = 'Void',\n}\n\nexport interface LimitedUserType {\n  __typename?: 'LimitedUserType';\n  /** User email */\n  email: Scalars['String']['output'];\n  /** User password has been set */\n  hasPassword: Maybe<Scalars['Boolean']['output']>;\n}\n\nexport interface ListUserInput {\n  first: InputMaybe<Scalars['Int']['input']>;\n  skip: InputMaybe<Scalars['Int']['input']>;\n}\n\nexport interface ManageUserInput {\n  /** User email */\n  email: InputMaybe<Scalars['String']['input']>;\n  /** User name */\n  name: InputMaybe<Scalars['String']['input']>;\n}\n\nexport interface MissingOauthQueryParameterDataType {\n  __typename?: 'MissingOauthQueryParameterDataType';\n  name: Scalars['String']['output'];\n}\n\nexport interface Mutation {\n  __typename?: 'Mutation';\n  acceptInviteById: Scalars['Boolean']['output'];\n  addWorkspaceFeature: Scalars['Int']['output'];\n  cancelSubscription: UserSubscription;\n  changeEmail: UserType;\n  changePassword: Scalars['Boolean']['output'];\n  /** Cleanup sessions */\n  cleanupCopilotSession: Array<Scalars['String']['output']>;\n  /** Create change password url */\n  createChangePasswordUrl: Scalars['String']['output'];\n  /** Create a subscription checkout link of stripe */\n  createCheckoutSession: Scalars['String']['output'];\n  /** Create a chat message */\n  createCopilotMessage: Scalars['String']['output'];\n  /** Create a copilot prompt */\n  createCopilotPrompt: CopilotPromptType;\n  /** Create a chat session */\n  createCopilotSession: Scalars['String']['output'];\n  /** Create a stripe customer portal to manage payment methods */\n  createCustomerPortal: Scalars['String']['output'];\n  /** Create a new user */\n  createUser: UserType;\n  /** Create a new workspace */\n  createWorkspace: WorkspaceType;\n  deleteAccount: DeleteAccount;\n  deleteBlob: Scalars['Boolean']['output'];\n  /** Delete a user account */\n  deleteUser: DeleteAccount;\n  deleteWorkspace: Scalars['Boolean']['output'];\n  /** Create a chat session */\n  forkCopilotSession: Scalars['String']['output'];\n  invite: Scalars['String']['output'];\n  leaveWorkspace: Scalars['Boolean']['output'];\n  publishPage: WorkspacePage;\n  recoverDoc: Scalars['DateTime']['output'];\n  /** Remove user avatar */\n  removeAvatar: RemoveAvatar;\n  removeWorkspaceFeature: Scalars['Int']['output'];\n  resumeSubscription: UserSubscription;\n  revoke: Scalars['Boolean']['output'];\n  /** @deprecated use revokePublicPage */\n  revokePage: Scalars['Boolean']['output'];\n  revokePublicPage: WorkspacePage;\n  sendChangeEmail: Scalars['Boolean']['output'];\n  sendChangePasswordEmail: Scalars['Boolean']['output'];\n  sendSetPasswordEmail: Scalars['Boolean']['output'];\n  sendVerifyChangeEmail: Scalars['Boolean']['output'];\n  sendVerifyEmail: Scalars['Boolean']['output'];\n  setBlob: Scalars['String']['output'];\n  setWorkspaceExperimentalFeature: Scalars['Boolean']['output'];\n  /** @deprecated renamed to publishPage */\n  sharePage: Scalars['Boolean']['output'];\n  /** Update a copilot prompt */\n  updateCopilotPrompt: CopilotPromptType;\n  updateProfile: UserType;\n  /** update server runtime configurable setting */\n  updateRuntimeConfig: ServerRuntimeConfigType;\n  /** update multiple server runtime configurable settings */\n  updateRuntimeConfigs: Array<ServerRuntimeConfigType>;\n  updateSubscriptionRecurring: UserSubscription;\n  /** Update a user */\n  updateUser: UserType;\n  /** update user enabled feature */\n  updateUserFeatures: Array<FeatureType>;\n  /** Update workspace */\n  updateWorkspace: WorkspaceType;\n  /** Upload user avatar */\n  uploadAvatar: UserType;\n  verifyEmail: Scalars['Boolean']['output'];\n}\n\nexport interface MutationAcceptInviteByIdArgs {\n  inviteId: Scalars['String']['input'];\n  sendAcceptMail: InputMaybe<Scalars['Boolean']['input']>;\n  workspaceId: Scalars['String']['input'];\n}\n\nexport interface MutationAddWorkspaceFeatureArgs {\n  feature: FeatureType;\n  workspaceId: Scalars['String']['input'];\n}\n\nexport interface MutationCancelSubscriptionArgs {\n  idempotencyKey: Scalars['String']['input'];\n  plan?: InputMaybe<SubscriptionPlan>;\n}\n\nexport interface MutationChangeEmailArgs {\n  email: Scalars['String']['input'];\n  token: Scalars['String']['input'];\n}\n\nexport interface MutationChangePasswordArgs {\n  newPassword: Scalars['String']['input'];\n  token: Scalars['String']['input'];\n  userId: InputMaybe<Scalars['String']['input']>;\n}\n\nexport interface MutationCleanupCopilotSessionArgs {\n  options: DeleteSessionInput;\n}\n\nexport interface MutationCreateChangePasswordUrlArgs {\n  callbackUrl: Scalars['String']['input'];\n  userId: Scalars['String']['input'];\n}\n\nexport interface MutationCreateCheckoutSessionArgs {\n  input: CreateCheckoutSessionInput;\n}\n\nexport interface MutationCreateCopilotMessageArgs {\n  options: CreateChatMessageInput;\n}\n\nexport interface MutationCreateCopilotPromptArgs {\n  input: CreateCopilotPromptInput;\n}\n\nexport interface MutationCreateCopilotSessionArgs {\n  options: CreateChatSessionInput;\n}\n\nexport interface MutationCreateUserArgs {\n  input: CreateUserInput;\n}\n\nexport interface MutationCreateWorkspaceArgs {\n  init: InputMaybe<Scalars['Upload']['input']>;\n}\n\nexport interface MutationDeleteBlobArgs {\n  hash: Scalars['String']['input'];\n  workspaceId: Scalars['String']['input'];\n}\n\nexport interface MutationDeleteUserArgs {\n  id: Scalars['String']['input'];\n}\n\nexport interface MutationDeleteWorkspaceArgs {\n  id: Scalars['String']['input'];\n}\n\nexport interface MutationForkCopilotSessionArgs {\n  options: ForkChatSessionInput;\n}\n\nexport interface MutationInviteArgs {\n  email: Scalars['String']['input'];\n  permission: Permission;\n  sendInviteMail: InputMaybe<Scalars['Boolean']['input']>;\n  workspaceId: Scalars['String']['input'];\n}\n\nexport interface MutationLeaveWorkspaceArgs {\n  sendLeaveMail: InputMaybe<Scalars['Boolean']['input']>;\n  workspaceId: Scalars['String']['input'];\n  workspaceName: Scalars['String']['input'];\n}\n\nexport interface MutationPublishPageArgs {\n  mode?: InputMaybe<PublicPageMode>;\n  pageId: Scalars['String']['input'];\n  workspaceId: Scalars['String']['input'];\n}\n\nexport interface MutationRecoverDocArgs {\n  guid: Scalars['String']['input'];\n  timestamp: Scalars['DateTime']['input'];\n  workspaceId: Scalars['String']['input'];\n}\n\nexport interface MutationRemoveWorkspaceFeatureArgs {\n  feature: FeatureType;\n  workspaceId: Scalars['String']['input'];\n}\n\nexport interface MutationResumeSubscriptionArgs {\n  idempotencyKey: Scalars['String']['input'];\n  plan?: InputMaybe<SubscriptionPlan>;\n}\n\nexport interface MutationRevokeArgs {\n  userId: Scalars['String']['input'];\n  workspaceId: Scalars['String']['input'];\n}\n\nexport interface MutationRevokePageArgs {\n  pageId: Scalars['String']['input'];\n  workspaceId: Scalars['String']['input'];\n}\n\nexport interface MutationRevokePublicPageArgs {\n  pageId: Scalars['String']['input'];\n  workspaceId: Scalars['String']['input'];\n}\n\nexport interface MutationSendChangeEmailArgs {\n  callbackUrl: Scalars['String']['input'];\n  email: InputMaybe<Scalars['String']['input']>;\n}\n\nexport interface MutationSendChangePasswordEmailArgs {\n  callbackUrl: Scalars['String']['input'];\n  email: InputMaybe<Scalars['String']['input']>;\n}\n\nexport interface MutationSendSetPasswordEmailArgs {\n  callbackUrl: Scalars['String']['input'];\n  email: InputMaybe<Scalars['String']['input']>;\n}\n\nexport interface MutationSendVerifyChangeEmailArgs {\n  callbackUrl: Scalars['String']['input'];\n  email: Scalars['String']['input'];\n  token: Scalars['String']['input'];\n}\n\nexport interface MutationSendVerifyEmailArgs {\n  callbackUrl: Scalars['String']['input'];\n}\n\nexport interface MutationSetBlobArgs {\n  blob: Scalars['Upload']['input'];\n  workspaceId: Scalars['String']['input'];\n}\n\nexport interface MutationSetWorkspaceExperimentalFeatureArgs {\n  enable: Scalars['Boolean']['input'];\n  feature: FeatureType;\n  workspaceId: Scalars['String']['input'];\n}\n\nexport interface MutationSharePageArgs {\n  pageId: Scalars['String']['input'];\n  workspaceId: Scalars['String']['input'];\n}\n\nexport interface MutationUpdateCopilotPromptArgs {\n  messages: Array<CopilotPromptMessageInput>;\n  name: Scalars['String']['input'];\n}\n\nexport interface MutationUpdateProfileArgs {\n  input: UpdateUserInput;\n}\n\nexport interface MutationUpdateRuntimeConfigArgs {\n  id: Scalars['String']['input'];\n  value: Scalars['JSON']['input'];\n}\n\nexport interface MutationUpdateRuntimeConfigsArgs {\n  updates: Scalars['JSONObject']['input'];\n}\n\nexport interface MutationUpdateSubscriptionRecurringArgs {\n  idempotencyKey: Scalars['String']['input'];\n  plan?: InputMaybe<SubscriptionPlan>;\n  recurring: SubscriptionRecurring;\n}\n\nexport interface MutationUpdateUserArgs {\n  id: Scalars['String']['input'];\n  input: ManageUserInput;\n}\n\nexport interface MutationUpdateUserFeaturesArgs {\n  features: Array<FeatureType>;\n  id: Scalars['String']['input'];\n}\n\nexport interface MutationUpdateWorkspaceArgs {\n  input: UpdateWorkspaceInput;\n}\n\nexport interface MutationUploadAvatarArgs {\n  avatar: Scalars['Upload']['input'];\n}\n\nexport interface MutationVerifyEmailArgs {\n  token: Scalars['String']['input'];\n}\n\nexport interface NotInWorkspaceDataType {\n  __typename?: 'NotInWorkspaceDataType';\n  workspaceId: Scalars['String']['output'];\n}\n\nexport enum OAuthProviderType {\n  GitHub = 'GitHub',\n  Google = 'Google',\n  OIDC = 'OIDC',\n}\n\nexport interface PasswordLimitsType {\n  __typename?: 'PasswordLimitsType';\n  maxLength: Scalars['Int']['output'];\n  minLength: Scalars['Int']['output'];\n}\n\n/** User permission in workspace */\nexport enum Permission {\n  Admin = 'Admin',\n  Owner = 'Owner',\n  Read = 'Read',\n  Write = 'Write',\n}\n\n/** The mode which the public page default in */\nexport enum PublicPageMode {\n  Edgeless = 'Edgeless',\n  Page = 'Page',\n}\n\nexport interface Query {\n  __typename?: 'Query';\n  /** @deprecated no more needed */\n  checkBlobSize: WorkspaceBlobSizes;\n  /** @deprecated use `user.storageUsage` instead */\n  collectAllBlobSizes: WorkspaceBlobSizes;\n  /** Get current user */\n  currentUser: Maybe<UserType>;\n  error: ErrorDataUnion;\n  /** send workspace invitation */\n  getInviteInfo: InvitationType;\n  /** Get is owner of workspace */\n  isOwner: Scalars['Boolean']['output'];\n  /**\n   * List blobs of workspace\n   * @deprecated use `workspace.blobs` instead\n   */\n  listBlobs: Array<Scalars['String']['output']>;\n  /** List all copilot prompts */\n  listCopilotPrompts: Array<CopilotPromptType>;\n  listWorkspaceFeatures: Array<WorkspaceType>;\n  prices: Array<SubscriptionPrice>;\n  /** server config */\n  serverConfig: ServerConfigType;\n  /** get all server runtime configurable settings */\n  serverRuntimeConfig: Array<ServerRuntimeConfigType>;\n  serverServiceConfigs: Array<ServerServiceConfig>;\n  /** Get user by email */\n  user: Maybe<UserOrLimitedUser>;\n  /** Get user by email for admin */\n  userByEmail: Maybe<UserType>;\n  /** Get user by id */\n  userById: UserType;\n  /** List registered users */\n  users: Array<UserType>;\n  /** Get users count */\n  usersCount: Scalars['Int']['output'];\n  /** Get workspace by id */\n  workspace: WorkspaceType;\n  /** Get all accessible workspaces for current user */\n  workspaces: Array<WorkspaceType>;\n}\n\nexport interface QueryCheckBlobSizeArgs {\n  size: Scalars['SafeInt']['input'];\n  workspaceId: Scalars['String']['input'];\n}\n\nexport interface QueryErrorArgs {\n  name: ErrorNames;\n}\n\nexport interface QueryGetInviteInfoArgs {\n  inviteId: Scalars['String']['input'];\n}\n\nexport interface QueryIsOwnerArgs {\n  workspaceId: Scalars['String']['input'];\n}\n\nexport interface QueryListBlobsArgs {\n  workspaceId: Scalars['String']['input'];\n}\n\nexport interface QueryListWorkspaceFeaturesArgs {\n  feature: FeatureType;\n}\n\nexport interface QueryUserArgs {\n  email: Scalars['String']['input'];\n}\n\nexport interface QueryUserByEmailArgs {\n  email: Scalars['String']['input'];\n}\n\nexport interface QueryUserByIdArgs {\n  id: Scalars['String']['input'];\n}\n\nexport interface QueryUsersArgs {\n  filter: ListUserInput;\n}\n\nexport interface QueryWorkspaceArgs {\n  id: Scalars['String']['input'];\n}\n\nexport interface QueryChatHistoriesInput {\n  action: InputMaybe<Scalars['Boolean']['input']>;\n  fork: InputMaybe<Scalars['Boolean']['input']>;\n  limit: InputMaybe<Scalars['Int']['input']>;\n  messageOrder: InputMaybe<ChatHistoryOrder>;\n  sessionId: InputMaybe<Scalars['String']['input']>;\n  sessionOrder: InputMaybe<ChatHistoryOrder>;\n  skip: InputMaybe<Scalars['Int']['input']>;\n}\n\nexport interface QuotaQueryType {\n  __typename?: 'QuotaQueryType';\n  blobLimit: Scalars['SafeInt']['output'];\n  copilotActionLimit: Maybe<Scalars['SafeInt']['output']>;\n  historyPeriod: Scalars['SafeInt']['output'];\n  humanReadable: HumanReadableQuotaType;\n  memberLimit: Scalars['SafeInt']['output'];\n  name: Scalars['String']['output'];\n  storageQuota: Scalars['SafeInt']['output'];\n  usedSize: Scalars['SafeInt']['output'];\n}\n\nexport interface RemoveAvatar {\n  __typename?: 'RemoveAvatar';\n  success: Scalars['Boolean']['output'];\n}\n\nexport interface RuntimeConfigNotFoundDataType {\n  __typename?: 'RuntimeConfigNotFoundDataType';\n  key: Scalars['String']['output'];\n}\n\nexport enum RuntimeConfigType {\n  Array = 'Array',\n  Boolean = 'Boolean',\n  Number = 'Number',\n  Object = 'Object',\n  String = 'String',\n}\n\nexport interface SameSubscriptionRecurringDataType {\n  __typename?: 'SameSubscriptionRecurringDataType';\n  recurring: Scalars['String']['output'];\n}\n\nexport interface ServerConfigType {\n  __typename?: 'ServerConfigType';\n  /** Features for user that can be configured */\n  availableUserFeatures: Array<FeatureType>;\n  /** server base url */\n  baseUrl: Scalars['String']['output'];\n  /** credentials requirement */\n  credentialsRequirement: CredentialsRequirementType;\n  /** enable telemetry */\n  enableTelemetry: Scalars['Boolean']['output'];\n  /** enabled server features */\n  features: Array<ServerFeature>;\n  /** server flags */\n  flags: ServerFlagsType;\n  /**\n   * server flavor\n   * @deprecated use `features`\n   */\n  flavor: Scalars['String']['output'];\n  /** whether server has been initialized */\n  initialized: Scalars['Boolean']['output'];\n  /** server identical name could be shown as badge on user interface */\n  name: Scalars['String']['output'];\n  oauthProviders: Array<OAuthProviderType>;\n  /** server type */\n  type: ServerDeploymentType;\n  /** server version */\n  version: Scalars['String']['output'];\n}\n\nexport enum ServerDeploymentType {\n  Affine = 'Affine',\n  Selfhosted = 'Selfhosted',\n}\n\nexport enum ServerFeature {\n  Copilot = 'Copilot',\n  OAuth = 'OAuth',\n  Payment = 'Payment',\n}\n\nexport interface ServerFlagsType {\n  __typename?: 'ServerFlagsType';\n  earlyAccessControl: Scalars['Boolean']['output'];\n  syncClientVersionCheck: Scalars['Boolean']['output'];\n}\n\nexport interface ServerRuntimeConfigType {\n  __typename?: 'ServerRuntimeConfigType';\n  description: Scalars['String']['output'];\n  id: Scalars['String']['output'];\n  key: Scalars['String']['output'];\n  module: Scalars['String']['output'];\n  type: RuntimeConfigType;\n  updatedAt: Scalars['DateTime']['output'];\n  value: Scalars['JSON']['output'];\n}\n\nexport interface ServerServiceConfig {\n  __typename?: 'ServerServiceConfig';\n  config: Scalars['JSONObject']['output'];\n  name: Scalars['String']['output'];\n}\n\nexport interface SubscriptionAlreadyExistsDataType {\n  __typename?: 'SubscriptionAlreadyExistsDataType';\n  plan: Scalars['String']['output'];\n}\n\nexport interface SubscriptionNotExistsDataType {\n  __typename?: 'SubscriptionNotExistsDataType';\n  plan: Scalars['String']['output'];\n}\n\nexport enum SubscriptionPlan {\n  AI = 'AI',\n  Enterprise = 'Enterprise',\n  Free = 'Free',\n  Pro = 'Pro',\n  SelfHosted = 'SelfHosted',\n  Team = 'Team',\n}\n\nexport interface SubscriptionPlanNotFoundDataType {\n  __typename?: 'SubscriptionPlanNotFoundDataType';\n  plan: Scalars['String']['output'];\n  recurring: Scalars['String']['output'];\n}\n\nexport interface SubscriptionPrice {\n  __typename?: 'SubscriptionPrice';\n  amount: Maybe<Scalars['Int']['output']>;\n  currency: Scalars['String']['output'];\n  lifetimeAmount: Maybe<Scalars['Int']['output']>;\n  plan: SubscriptionPlan;\n  type: Scalars['String']['output'];\n  yearlyAmount: Maybe<Scalars['Int']['output']>;\n}\n\nexport enum SubscriptionRecurring {\n  Lifetime = 'Lifetime',\n  Monthly = 'Monthly',\n  Yearly = 'Yearly',\n}\n\nexport enum SubscriptionStatus {\n  Active = 'Active',\n  Canceled = 'Canceled',\n  Incomplete = 'Incomplete',\n  IncompleteExpired = 'IncompleteExpired',\n  PastDue = 'PastDue',\n  Paused = 'Paused',\n  Trialing = 'Trialing',\n  Unpaid = 'Unpaid',\n}\n\nexport interface UnknownOauthProviderDataType {\n  __typename?: 'UnknownOauthProviderDataType';\n  name: Scalars['String']['output'];\n}\n\nexport interface UpdateUserInput {\n  /** User name */\n  name: InputMaybe<Scalars['String']['input']>;\n}\n\nexport interface UpdateWorkspaceInput {\n  id: Scalars['ID']['input'];\n  /** is Public workspace */\n  public: InputMaybe<Scalars['Boolean']['input']>;\n}\n\nexport interface UserInvoice {\n  __typename?: 'UserInvoice';\n  amount: Scalars['Int']['output'];\n  createdAt: Scalars['DateTime']['output'];\n  currency: Scalars['String']['output'];\n  id: Scalars['String']['output'];\n  lastPaymentError: Maybe<Scalars['String']['output']>;\n  link: Maybe<Scalars['String']['output']>;\n  plan: SubscriptionPlan;\n  reason: Scalars['String']['output'];\n  recurring: SubscriptionRecurring;\n  status: InvoiceStatus;\n  updatedAt: Scalars['DateTime']['output'];\n}\n\nexport type UserOrLimitedUser = LimitedUserType | UserType;\n\nexport interface UserQuota {\n  __typename?: 'UserQuota';\n  blobLimit: Scalars['SafeInt']['output'];\n  historyPeriod: Scalars['SafeInt']['output'];\n  humanReadable: UserQuotaHumanReadable;\n  memberLimit: Scalars['Int']['output'];\n  name: Scalars['String']['output'];\n  storageQuota: Scalars['SafeInt']['output'];\n}\n\nexport interface UserQuotaHumanReadable {\n  __typename?: 'UserQuotaHumanReadable';\n  blobLimit: Scalars['String']['output'];\n  historyPeriod: Scalars['String']['output'];\n  memberLimit: Scalars['String']['output'];\n  name: Scalars['String']['output'];\n  storageQuota: Scalars['String']['output'];\n}\n\nexport interface UserSubscription {\n  __typename?: 'UserSubscription';\n  canceledAt: Maybe<Scalars['DateTime']['output']>;\n  createdAt: Scalars['DateTime']['output'];\n  end: Maybe<Scalars['DateTime']['output']>;\n  id: Maybe<Scalars['String']['output']>;\n  nextBillAt: Maybe<Scalars['DateTime']['output']>;\n  /**\n   * The 'Free' plan just exists to be a placeholder and for the type convenience of frontend.\n   * There won't actually be a subscription with plan 'Free'\n   */\n  plan: SubscriptionPlan;\n  recurring: SubscriptionRecurring;\n  start: Scalars['DateTime']['output'];\n  status: SubscriptionStatus;\n  trialEnd: Maybe<Scalars['DateTime']['output']>;\n  trialStart: Maybe<Scalars['DateTime']['output']>;\n  updatedAt: Scalars['DateTime']['output'];\n}\n\nexport interface UserType {\n  __typename?: 'UserType';\n  /** User avatar url */\n  avatarUrl: Maybe<Scalars['String']['output']>;\n  copilot: Copilot;\n  /**\n   * User email verified\n   * @deprecated useless\n   */\n  createdAt: Maybe<Scalars['DateTime']['output']>;\n  /** User email */\n  email: Scalars['String']['output'];\n  /** User email verified */\n  emailVerified: Scalars['Boolean']['output'];\n  /** Enabled features of a user */\n  features: Array<FeatureType>;\n  /** User password has been set */\n  hasPassword: Maybe<Scalars['Boolean']['output']>;\n  id: Scalars['ID']['output'];\n  /** Get user invoice count */\n  invoiceCount: Scalars['Int']['output'];\n  invoices: Array<UserInvoice>;\n  /** User name */\n  name: Scalars['String']['output'];\n  quota: Maybe<UserQuota>;\n  /** @deprecated use `UserType.subscriptions` */\n  subscription: Maybe<UserSubscription>;\n  subscriptions: Array<UserSubscription>;\n  /** @deprecated use [/api/auth/authorize] */\n  token: TokenType;\n}\n\nexport interface UserTypeCopilotArgs {\n  workspaceId: InputMaybe<Scalars['String']['input']>;\n}\n\nexport interface UserTypeInvoicesArgs {\n  skip: InputMaybe<Scalars['Int']['input']>;\n  take?: InputMaybe<Scalars['Int']['input']>;\n}\n\nexport interface UserTypeSubscriptionArgs {\n  plan?: InputMaybe<SubscriptionPlan>;\n}\n\nexport interface VersionRejectedDataType {\n  __typename?: 'VersionRejectedDataType';\n  serverVersion: Scalars['String']['output'];\n  version: Scalars['String']['output'];\n}\n\nexport interface WorkspaceAccessDeniedDataType {\n  __typename?: 'WorkspaceAccessDeniedDataType';\n  workspaceId: Scalars['String']['output'];\n}\n\nexport interface WorkspaceBlobSizes {\n  __typename?: 'WorkspaceBlobSizes';\n  size: Scalars['SafeInt']['output'];\n}\n\nexport interface WorkspaceNotFoundDataType {\n  __typename?: 'WorkspaceNotFoundDataType';\n  workspaceId: Scalars['String']['output'];\n}\n\nexport interface WorkspaceOwnerNotFoundDataType {\n  __typename?: 'WorkspaceOwnerNotFoundDataType';\n  workspaceId: Scalars['String']['output'];\n}\n\nexport interface WorkspacePage {\n  __typename?: 'WorkspacePage';\n  id: Scalars['String']['output'];\n  mode: PublicPageMode;\n  public: Scalars['Boolean']['output'];\n  workspaceId: Scalars['String']['output'];\n}\n\nexport interface WorkspaceType {\n  __typename?: 'WorkspaceType';\n  /** Available features of workspace */\n  availableFeatures: Array<FeatureType>;\n  /** List blobs of workspace */\n  blobs: Array<Scalars['String']['output']>;\n  /** Blobs size of workspace */\n  blobsSize: Scalars['Int']['output'];\n  /** Workspace created date */\n  createdAt: Scalars['DateTime']['output'];\n  /** Enabled features of workspace */\n  features: Array<FeatureType>;\n  histories: Array<DocHistoryType>;\n  id: Scalars['ID']['output'];\n  /** member count of workspace */\n  memberCount: Scalars['Int']['output'];\n  /** Members of workspace */\n  members: Array<InviteUserType>;\n  /** Owner of workspace */\n  owner: UserType;\n  /** Permission of current signed in user in workspace */\n  permission: Permission;\n  /** is Public workspace */\n  public: Scalars['Boolean']['output'];\n  /** Get public page of a workspace by page id. */\n  publicPage: Maybe<WorkspacePage>;\n  /** Public pages of a workspace */\n  publicPages: Array<WorkspacePage>;\n  /** quota of workspace */\n  quota: QuotaQueryType;\n  /**\n   * Shared pages of workspace\n   * @deprecated use WorkspaceType.publicPages\n   */\n  sharedPages: Array<Scalars['String']['output']>;\n}\n\nexport interface WorkspaceTypeHistoriesArgs {\n  before: InputMaybe<Scalars['DateTime']['input']>;\n  guid: Scalars['String']['input'];\n  take: InputMaybe<Scalars['Int']['input']>;\n}\n\nexport interface WorkspaceTypeMembersArgs {\n  skip: InputMaybe<Scalars['Int']['input']>;\n  take: InputMaybe<Scalars['Int']['input']>;\n}\n\nexport interface WorkspaceTypePublicPageArgs {\n  pageId: Scalars['String']['input'];\n}\n\nexport interface TokenType {\n  __typename?: 'tokenType';\n  refresh: Scalars['String']['output'];\n  sessionToken: Maybe<Scalars['String']['output']>;\n  token: Scalars['String']['output'];\n}\n\nexport type AdminServerConfigQueryVariables = Exact<{ [key: string]: never }>;\n\nexport type AdminServerConfigQuery = {\n  __typename?: 'Query';\n  serverConfig: {\n    __typename?: 'ServerConfigType';\n    version: string;\n    baseUrl: string;\n    name: string;\n    features: Array<ServerFeature>;\n    type: ServerDeploymentType;\n    initialized: boolean;\n    availableUserFeatures: Array<FeatureType>;\n    credentialsRequirement: {\n      __typename?: 'CredentialsRequirementType';\n      password: {\n        __typename?: 'PasswordLimitsType';\n        minLength: number;\n        maxLength: number;\n      };\n    };\n  };\n};\n\nexport type DeleteBlobMutationVariables = Exact<{\n  workspaceId: Scalars['String']['input'];\n  hash: Scalars['String']['input'];\n}>;\n\nexport type DeleteBlobMutation = {\n  __typename?: 'Mutation';\n  deleteBlob: boolean;\n};\n\nexport type ListBlobsQueryVariables = Exact<{\n  workspaceId: Scalars['String']['input'];\n}>;\n\nexport type ListBlobsQuery = { __typename?: 'Query'; listBlobs: Array<string> };\n\nexport type SetBlobMutationVariables = Exact<{\n  workspaceId: Scalars['String']['input'];\n  blob: Scalars['Upload']['input'];\n}>;\n\nexport type SetBlobMutation = { __typename?: 'Mutation'; setBlob: string };\n\nexport type CancelSubscriptionMutationVariables = Exact<{\n  idempotencyKey: Scalars['String']['input'];\n  plan?: InputMaybe<SubscriptionPlan>;\n}>;\n\nexport type CancelSubscriptionMutation = {\n  __typename?: 'Mutation';\n  cancelSubscription: {\n    __typename?: 'UserSubscription';\n    id: string | null;\n    status: SubscriptionStatus;\n    nextBillAt: string | null;\n    canceledAt: string | null;\n  };\n};\n\nexport type ChangeEmailMutationVariables = Exact<{\n  token: Scalars['String']['input'];\n  email: Scalars['String']['input'];\n}>;\n\nexport type ChangeEmailMutation = {\n  __typename?: 'Mutation';\n  changeEmail: { __typename?: 'UserType'; id: string; email: string };\n};\n\nexport type CreateChangePasswordUrlMutationVariables = Exact<{\n  callbackUrl: Scalars['String']['input'];\n  userId: Scalars['String']['input'];\n}>;\n\nexport type CreateChangePasswordUrlMutation = {\n  __typename?: 'Mutation';\n  createChangePasswordUrl: string;\n};\n\nexport type ChangePasswordMutationVariables = Exact<{\n  token: Scalars['String']['input'];\n  userId: Scalars['String']['input'];\n  newPassword: Scalars['String']['input'];\n}>;\n\nexport type ChangePasswordMutation = {\n  __typename?: 'Mutation';\n  changePassword: boolean;\n};\n\nexport type CopilotQuotaQueryVariables = Exact<{ [key: string]: never }>;\n\nexport type CopilotQuotaQuery = {\n  __typename?: 'Query';\n  currentUser: {\n    __typename?: 'UserType';\n    copilot: {\n      __typename?: 'Copilot';\n      quota: {\n        __typename?: 'CopilotQuota';\n        limit: number | null;\n        used: number;\n      };\n    };\n  } | null;\n};\n\nexport type CleanupCopilotSessionMutationVariables = Exact<{\n  input: DeleteSessionInput;\n}>;\n\nexport type CleanupCopilotSessionMutation = {\n  __typename?: 'Mutation';\n  cleanupCopilotSession: Array<string>;\n};\n\nexport type CreateCheckoutSessionMutationVariables = Exact<{\n  input: CreateCheckoutSessionInput;\n}>;\n\nexport type CreateCheckoutSessionMutation = {\n  __typename?: 'Mutation';\n  createCheckoutSession: string;\n};\n\nexport type CreateCopilotMessageMutationVariables = Exact<{\n  options: CreateChatMessageInput;\n}>;\n\nexport type CreateCopilotMessageMutation = {\n  __typename?: 'Mutation';\n  createCopilotMessage: string;\n};\n\nexport type CreateCopilotSessionMutationVariables = Exact<{\n  options: CreateChatSessionInput;\n}>;\n\nexport type CreateCopilotSessionMutation = {\n  __typename?: 'Mutation';\n  createCopilotSession: string;\n};\n\nexport type CreateCustomerPortalMutationVariables = Exact<{\n  [key: string]: never;\n}>;\n\nexport type CreateCustomerPortalMutation = {\n  __typename?: 'Mutation';\n  createCustomerPortal: string;\n};\n\nexport type CreateUserMutationVariables = Exact<{\n  input: CreateUserInput;\n}>;\n\nexport type CreateUserMutation = {\n  __typename?: 'Mutation';\n  createUser: { __typename?: 'UserType'; id: string };\n};\n\nexport type CreateWorkspaceMutationVariables = Exact<{ [key: string]: never }>;\n\nexport type CreateWorkspaceMutation = {\n  __typename?: 'Mutation';\n  createWorkspace: {\n    __typename?: 'WorkspaceType';\n    id: string;\n    public: boolean;\n    createdAt: string;\n  };\n};\n\nexport type DeleteAccountMutationVariables = Exact<{ [key: string]: never }>;\n\nexport type DeleteAccountMutation = {\n  __typename?: 'Mutation';\n  deleteAccount: { __typename?: 'DeleteAccount'; success: boolean };\n};\n\nexport type DeleteUserMutationVariables = Exact<{\n  id: Scalars['String']['input'];\n}>;\n\nexport type DeleteUserMutation = {\n  __typename?: 'Mutation';\n  deleteUser: { __typename?: 'DeleteAccount'; success: boolean };\n};\n\nexport type DeleteWorkspaceMutationVariables = Exact<{\n  id: Scalars['String']['input'];\n}>;\n\nexport type DeleteWorkspaceMutation = {\n  __typename?: 'Mutation';\n  deleteWorkspace: boolean;\n};\n\nexport type ForkCopilotSessionMutationVariables = Exact<{\n  options: ForkChatSessionInput;\n}>;\n\nexport type ForkCopilotSessionMutation = {\n  __typename?: 'Mutation';\n  forkCopilotSession: string;\n};\n\nexport type CredentialsRequirementFragment = {\n  __typename?: 'CredentialsRequirementType';\n  password: {\n    __typename?: 'PasswordLimitsType';\n    minLength: number;\n    maxLength: number;\n  };\n};\n\nexport type PasswordLimitsFragment = {\n  __typename?: 'PasswordLimitsType';\n  minLength: number;\n  maxLength: number;\n};\n\nexport type GetCopilotHistoriesQueryVariables = Exact<{\n  workspaceId: Scalars['String']['input'];\n  docId: InputMaybe<Scalars['String']['input']>;\n  options: InputMaybe<QueryChatHistoriesInput>;\n}>;\n\nexport type GetCopilotHistoriesQuery = {\n  __typename?: 'Query';\n  currentUser: {\n    __typename?: 'UserType';\n    copilot: {\n      __typename?: 'Copilot';\n      histories: Array<{\n        __typename?: 'CopilotHistories';\n        sessionId: string;\n        tokens: number;\n        action: string | null;\n        createdAt: string;\n        messages: Array<{\n          __typename?: 'ChatMessage';\n          id: string | null;\n          role: string;\n          content: string;\n          attachments: Array<string> | null;\n          createdAt: string;\n        }>;\n      }>;\n    };\n  } | null;\n};\n\nexport type GetCopilotHistoryIdsQueryVariables = Exact<{\n  workspaceId: Scalars['String']['input'];\n  docId: InputMaybe<Scalars['String']['input']>;\n  options: InputMaybe<QueryChatHistoriesInput>;\n}>;\n\nexport type GetCopilotHistoryIdsQuery = {\n  __typename?: 'Query';\n  currentUser: {\n    __typename?: 'UserType';\n    copilot: {\n      __typename?: 'Copilot';\n      histories: Array<{\n        __typename?: 'CopilotHistories';\n        sessionId: string;\n        messages: Array<{\n          __typename?: 'ChatMessage';\n          id: string | null;\n          role: string;\n          createdAt: string;\n        }>;\n      }>;\n    };\n  } | null;\n};\n\nexport type GetCopilotSessionsQueryVariables = Exact<{\n  workspaceId: Scalars['String']['input'];\n}>;\n\nexport type GetCopilotSessionsQuery = {\n  __typename?: 'Query';\n  currentUser: {\n    __typename?: 'UserType';\n    copilot: {\n      __typename?: 'Copilot';\n      actions: Array<string>;\n      chats: Array<string>;\n    };\n  } | null;\n};\n\nexport type GetCurrentUserFeaturesQueryVariables = Exact<{\n  [key: string]: never;\n}>;\n\nexport type GetCurrentUserFeaturesQuery = {\n  __typename?: 'Query';\n  currentUser: {\n    __typename?: 'UserType';\n    id: string;\n    name: string;\n    email: string;\n    emailVerified: boolean;\n    avatarUrl: string | null;\n    features: Array<FeatureType>;\n  } | null;\n};\n\nexport type GetCurrentUserQueryVariables = Exact<{ [key: string]: never }>;\n\nexport type GetCurrentUserQuery = {\n  __typename?: 'Query';\n  currentUser: {\n    __typename?: 'UserType';\n    id: string;\n    name: string;\n    email: string;\n    emailVerified: boolean;\n    avatarUrl: string | null;\n    token: { __typename?: 'tokenType'; sessionToken: string | null };\n  } | null;\n};\n\nexport type GetInviteInfoQueryVariables = Exact<{\n  inviteId: Scalars['String']['input'];\n}>;\n\nexport type GetInviteInfoQuery = {\n  __typename?: 'Query';\n  getInviteInfo: {\n    __typename?: 'InvitationType';\n    workspace: {\n      __typename?: 'InvitationWorkspaceType';\n      id: string;\n      name: string;\n      avatar: string;\n    };\n    user: {\n      __typename?: 'UserType';\n      id: string;\n      name: string;\n      avatarUrl: string | null;\n    };\n  };\n};\n\nexport type GetIsOwnerQueryVariables = Exact<{\n  workspaceId: Scalars['String']['input'];\n}>;\n\nexport type GetIsOwnerQuery = { __typename?: 'Query'; isOwner: boolean };\n\nexport type GetMemberCountByWorkspaceIdQueryVariables = Exact<{\n  workspaceId: Scalars['String']['input'];\n}>;\n\nexport type GetMemberCountByWorkspaceIdQuery = {\n  __typename?: 'Query';\n  workspace: { __typename?: 'WorkspaceType'; memberCount: number };\n};\n\nexport type GetMembersByWorkspaceIdQueryVariables = Exact<{\n  workspaceId: Scalars['String']['input'];\n  skip: Scalars['Int']['input'];\n  take: Scalars['Int']['input'];\n}>;\n\nexport type GetMembersByWorkspaceIdQuery = {\n  __typename?: 'Query';\n  workspace: {\n    __typename?: 'WorkspaceType';\n    memberCount: number;\n    members: Array<{\n      __typename?: 'InviteUserType';\n      id: string;\n      name: string | null;\n      email: string | null;\n      avatarUrl: string | null;\n      permission: Permission;\n      inviteId: string;\n      accepted: boolean;\n      emailVerified: boolean | null;\n    }>;\n  };\n};\n\nexport type OauthProvidersQueryVariables = Exact<{ [key: string]: never }>;\n\nexport type OauthProvidersQuery = {\n  __typename?: 'Query';\n  serverConfig: {\n    __typename?: 'ServerConfigType';\n    oauthProviders: Array<OAuthProviderType>;\n  };\n};\n\nexport type GetPromptsQueryVariables = Exact<{ [key: string]: never }>;\n\nexport type GetPromptsQuery = {\n  __typename?: 'Query';\n  listCopilotPrompts: Array<{\n    __typename?: 'CopilotPromptType';\n    name: string;\n    model: string;\n    action: string | null;\n    config: {\n      __typename?: 'CopilotPromptConfigType';\n      jsonMode: boolean | null;\n      frequencyPenalty: number | null;\n      presencePenalty: number | null;\n      temperature: number | null;\n      topP: number | null;\n    } | null;\n    messages: Array<{\n      __typename?: 'CopilotPromptMessageType';\n      role: CopilotPromptMessageRole;\n      content: string;\n      params: Record<string, string> | null;\n    }>;\n  }>;\n};\n\nexport type GetServerRuntimeConfigQueryVariables = Exact<{\n  [key: string]: never;\n}>;\n\nexport type GetServerRuntimeConfigQuery = {\n  __typename?: 'Query';\n  serverRuntimeConfig: Array<{\n    __typename?: 'ServerRuntimeConfigType';\n    id: string;\n    module: string;\n    key: string;\n    description: string;\n    value: Record<string, string>;\n    type: RuntimeConfigType;\n    updatedAt: string;\n  }>;\n};\n\nexport type GetServerServiceConfigsQueryVariables = Exact<{\n  [key: string]: never;\n}>;\n\nexport type GetServerServiceConfigsQuery = {\n  __typename?: 'Query';\n  serverServiceConfigs: Array<{\n    __typename?: 'ServerServiceConfig';\n    name: string;\n    config: any;\n  }>;\n};\n\nexport type GetUserByEmailQueryVariables = Exact<{\n  email: Scalars['String']['input'];\n}>;\n\nexport type GetUserByEmailQuery = {\n  __typename?: 'Query';\n  userByEmail: {\n    __typename?: 'UserType';\n    id: string;\n    name: string;\n    email: string;\n    features: Array<FeatureType>;\n    hasPassword: boolean | null;\n    emailVerified: boolean;\n    avatarUrl: string | null;\n    quota: {\n      __typename?: 'UserQuota';\n      humanReadable: {\n        __typename?: 'UserQuotaHumanReadable';\n        blobLimit: string;\n        historyPeriod: string;\n        memberLimit: string;\n        name: string;\n        storageQuota: string;\n      };\n    } | null;\n  } | null;\n};\n\nexport type GetUserFeaturesQueryVariables = Exact<{ [key: string]: never }>;\n\nexport type GetUserFeaturesQuery = {\n  __typename?: 'Query';\n  currentUser: {\n    __typename?: 'UserType';\n    id: string;\n    features: Array<FeatureType>;\n  } | null;\n};\n\nexport type GetUserQueryVariables = Exact<{\n  email: Scalars['String']['input'];\n}>;\n\nexport type GetUserQuery = {\n  __typename?: 'Query';\n  user:\n    | {\n        __typename: 'LimitedUserType';\n        email: string;\n        hasPassword: boolean | null;\n      }\n    | {\n        __typename: 'UserType';\n        id: string;\n        name: string;\n        avatarUrl: string | null;\n        email: string;\n        hasPassword: boolean | null;\n      }\n    | null;\n};\n\nexport type GetUsersCountQueryVariables = Exact<{ [key: string]: never }>;\n\nexport type GetUsersCountQuery = { __typename?: 'Query'; usersCount: number };\n\nexport type GetWorkspaceFeaturesQueryVariables = Exact<{\n  workspaceId: Scalars['String']['input'];\n}>;\n\nexport type GetWorkspaceFeaturesQuery = {\n  __typename?: 'Query';\n  workspace: { __typename?: 'WorkspaceType'; features: Array<FeatureType> };\n};\n\nexport type GetWorkspacePublicByIdQueryVariables = Exact<{\n  id: Scalars['String']['input'];\n}>;\n\nexport type GetWorkspacePublicByIdQuery = {\n  __typename?: 'Query';\n  workspace: { __typename?: 'WorkspaceType'; public: boolean };\n};\n\nexport type GetWorkspacePublicPageByIdQueryVariables = Exact<{\n  workspaceId: Scalars['String']['input'];\n  pageId: Scalars['String']['input'];\n}>;\n\nexport type GetWorkspacePublicPageByIdQuery = {\n  __typename?: 'Query';\n  workspace: {\n    __typename?: 'WorkspaceType';\n    publicPage: {\n      __typename?: 'WorkspacePage';\n      id: string;\n      mode: PublicPageMode;\n    } | null;\n  };\n};\n\nexport type GetWorkspacePublicPagesQueryVariables = Exact<{\n  workspaceId: Scalars['String']['input'];\n}>;\n\nexport type GetWorkspacePublicPagesQuery = {\n  __typename?: 'Query';\n  workspace: {\n    __typename?: 'WorkspaceType';\n    publicPages: Array<{\n      __typename?: 'WorkspacePage';\n      id: string;\n      mode: PublicPageMode;\n    }>;\n  };\n};\n\nexport type GetWorkspaceQueryVariables = Exact<{\n  id: Scalars['String']['input'];\n}>;\n\nexport type GetWorkspaceQuery = {\n  __typename?: 'Query';\n  workspace: { __typename?: 'WorkspaceType'; id: string };\n};\n\nexport type GetWorkspacesQueryVariables = Exact<{ [key: string]: never }>;\n\nexport type GetWorkspacesQuery = {\n  __typename?: 'Query';\n  workspaces: Array<{\n    __typename?: 'WorkspaceType';\n    id: string;\n    owner: { __typename?: 'UserType'; id: string };\n  }>;\n};\n\nexport type ListHistoryQueryVariables = Exact<{\n  workspaceId: Scalars['String']['input'];\n  pageDocId: Scalars['String']['input'];\n  take: InputMaybe<Scalars['Int']['input']>;\n  before: InputMaybe<Scalars['DateTime']['input']>;\n}>;\n\nexport type ListHistoryQuery = {\n  __typename?: 'Query';\n  workspace: {\n    __typename?: 'WorkspaceType';\n    histories: Array<{\n      __typename?: 'DocHistoryType';\n      id: string;\n      timestamp: string;\n    }>;\n  };\n};\n\nexport type GetInvoicesCountQueryVariables = Exact<{ [key: string]: never }>;\n\nexport type GetInvoicesCountQuery = {\n  __typename?: 'Query';\n  currentUser: { __typename?: 'UserType'; invoiceCount: number } | null;\n};\n\nexport type InvoicesQueryVariables = Exact<{\n  take: Scalars['Int']['input'];\n  skip: Scalars['Int']['input'];\n}>;\n\nexport type InvoicesQuery = {\n  __typename?: 'Query';\n  currentUser: {\n    __typename?: 'UserType';\n    invoices: Array<{\n      __typename?: 'UserInvoice';\n      id: string;\n      status: InvoiceStatus;\n      plan: SubscriptionPlan;\n      recurring: SubscriptionRecurring;\n      currency: string;\n      amount: number;\n      reason: string;\n      lastPaymentError: string | null;\n      link: string | null;\n      createdAt: string;\n    }>;\n  } | null;\n};\n\nexport type LeaveWorkspaceMutationVariables = Exact<{\n  workspaceId: Scalars['String']['input'];\n  workspaceName: Scalars['String']['input'];\n  sendLeaveMail: InputMaybe<Scalars['Boolean']['input']>;\n}>;\n\nexport type LeaveWorkspaceMutation = {\n  __typename?: 'Mutation';\n  leaveWorkspace: boolean;\n};\n\nexport type ListUsersQueryVariables = Exact<{\n  filter: ListUserInput;\n}>;\n\nexport type ListUsersQuery = {\n  __typename?: 'Query';\n  users: Array<{\n    __typename?: 'UserType';\n    id: string;\n    name: string;\n    email: string;\n    features: Array<FeatureType>;\n    hasPassword: boolean | null;\n    emailVerified: boolean;\n    avatarUrl: string | null;\n  }>;\n};\n\nexport type PricesQueryVariables = Exact<{ [key: string]: never }>;\n\nexport type PricesQuery = {\n  __typename?: 'Query';\n  prices: Array<{\n    __typename?: 'SubscriptionPrice';\n    type: string;\n    plan: SubscriptionPlan;\n    currency: string;\n    amount: number | null;\n    yearlyAmount: number | null;\n    lifetimeAmount: number | null;\n  }>;\n};\n\nexport type PublishPageMutationVariables = Exact<{\n  workspaceId: Scalars['String']['input'];\n  pageId: Scalars['String']['input'];\n  mode?: InputMaybe<PublicPageMode>;\n}>;\n\nexport type PublishPageMutation = {\n  __typename?: 'Mutation';\n  publishPage: {\n    __typename?: 'WorkspacePage';\n    id: string;\n    mode: PublicPageMode;\n  };\n};\n\nexport type QuotaQueryVariables = Exact<{ [key: string]: never }>;\n\nexport type QuotaQuery = {\n  __typename?: 'Query';\n  currentUser: {\n    __typename?: 'UserType';\n    id: string;\n    quota: {\n      __typename?: 'UserQuota';\n      name: string;\n      blobLimit: number;\n      storageQuota: number;\n      historyPeriod: number;\n      memberLimit: number;\n      humanReadable: {\n        __typename?: 'UserQuotaHumanReadable';\n        name: string;\n        blobLimit: string;\n        storageQuota: string;\n        historyPeriod: string;\n        memberLimit: string;\n      };\n    } | null;\n  } | null;\n  collectAllBlobSizes: { __typename?: 'WorkspaceBlobSizes'; size: number };\n};\n\nexport type RecoverDocMutationVariables = Exact<{\n  workspaceId: Scalars['String']['input'];\n  docId: Scalars['String']['input'];\n  timestamp: Scalars['DateTime']['input'];\n}>;\n\nexport type RecoverDocMutation = {\n  __typename?: 'Mutation';\n  recoverDoc: string;\n};\n\nexport type RemoveAvatarMutationVariables = Exact<{ [key: string]: never }>;\n\nexport type RemoveAvatarMutation = {\n  __typename?: 'Mutation';\n  removeAvatar: { __typename?: 'RemoveAvatar'; success: boolean };\n};\n\nexport type ResumeSubscriptionMutationVariables = Exact<{\n  idempotencyKey: Scalars['String']['input'];\n  plan?: InputMaybe<SubscriptionPlan>;\n}>;\n\nexport type ResumeSubscriptionMutation = {\n  __typename?: 'Mutation';\n  resumeSubscription: {\n    __typename?: 'UserSubscription';\n    id: string | null;\n    status: SubscriptionStatus;\n    nextBillAt: string | null;\n    start: string;\n    end: string | null;\n  };\n};\n\nexport type RevokeMemberPermissionMutationVariables = Exact<{\n  workspaceId: Scalars['String']['input'];\n  userId: Scalars['String']['input'];\n}>;\n\nexport type RevokeMemberPermissionMutation = {\n  __typename?: 'Mutation';\n  revoke: boolean;\n};\n\nexport type RevokePublicPageMutationVariables = Exact<{\n  workspaceId: Scalars['String']['input'];\n  pageId: Scalars['String']['input'];\n}>;\n\nexport type RevokePublicPageMutation = {\n  __typename?: 'Mutation';\n  revokePublicPage: {\n    __typename?: 'WorkspacePage';\n    id: string;\n    mode: PublicPageMode;\n    public: boolean;\n  };\n};\n\nexport type SendChangeEmailMutationVariables = Exact<{\n  callbackUrl: Scalars['String']['input'];\n}>;\n\nexport type SendChangeEmailMutation = {\n  __typename?: 'Mutation';\n  sendChangeEmail: boolean;\n};\n\nexport type SendChangePasswordEmailMutationVariables = Exact<{\n  callbackUrl: Scalars['String']['input'];\n}>;\n\nexport type SendChangePasswordEmailMutation = {\n  __typename?: 'Mutation';\n  sendChangePasswordEmail: boolean;\n};\n\nexport type SendSetPasswordEmailMutationVariables = Exact<{\n  callbackUrl: Scalars['String']['input'];\n}>;\n\nexport type SendSetPasswordEmailMutation = {\n  __typename?: 'Mutation';\n  sendSetPasswordEmail: boolean;\n};\n\nexport type SendVerifyChangeEmailMutationVariables = Exact<{\n  token: Scalars['String']['input'];\n  email: Scalars['String']['input'];\n  callbackUrl: Scalars['String']['input'];\n}>;\n\nexport type SendVerifyChangeEmailMutation = {\n  __typename?: 'Mutation';\n  sendVerifyChangeEmail: boolean;\n};\n\nexport type SendVerifyEmailMutationVariables = Exact<{\n  callbackUrl: Scalars['String']['input'];\n}>;\n\nexport type SendVerifyEmailMutation = {\n  __typename?: 'Mutation';\n  sendVerifyEmail: boolean;\n};\n\nexport type ServerConfigQueryVariables = Exact<{ [key: string]: never }>;\n\nexport type ServerConfigQuery = {\n  __typename?: 'Query';\n  serverConfig: {\n    __typename?: 'ServerConfigType';\n    version: string;\n    baseUrl: string;\n    name: string;\n    features: Array<ServerFeature>;\n    type: ServerDeploymentType;\n    credentialsRequirement: {\n      __typename?: 'CredentialsRequirementType';\n      password: {\n        __typename?: 'PasswordLimitsType';\n        minLength: number;\n        maxLength: number;\n      };\n    };\n  };\n};\n\nexport type SetWorkspacePublicByIdMutationVariables = Exact<{\n  id: Scalars['ID']['input'];\n  public: Scalars['Boolean']['input'];\n}>;\n\nexport type SetWorkspacePublicByIdMutation = {\n  __typename?: 'Mutation';\n  updateWorkspace: { __typename?: 'WorkspaceType'; id: string };\n};\n\nexport type SubscriptionQueryVariables = Exact<{ [key: string]: never }>;\n\nexport type SubscriptionQuery = {\n  __typename?: 'Query';\n  currentUser: {\n    __typename?: 'UserType';\n    id: string;\n    subscriptions: Array<{\n      __typename?: 'UserSubscription';\n      id: string | null;\n      status: SubscriptionStatus;\n      plan: SubscriptionPlan;\n      recurring: SubscriptionRecurring;\n      start: string;\n      end: string | null;\n      nextBillAt: string | null;\n      canceledAt: string | null;\n    }>;\n  } | null;\n};\n\nexport type UpdateAccountFeaturesMutationVariables = Exact<{\n  userId: Scalars['String']['input'];\n  features: Array<FeatureType> | FeatureType;\n}>;\n\nexport type UpdateAccountFeaturesMutation = {\n  __typename?: 'Mutation';\n  updateUserFeatures: Array<FeatureType>;\n};\n\nexport type UpdateAccountMutationVariables = Exact<{\n  id: Scalars['String']['input'];\n  input: ManageUserInput;\n}>;\n\nexport type UpdateAccountMutation = {\n  __typename?: 'Mutation';\n  updateUser: {\n    __typename?: 'UserType';\n    id: string;\n    name: string;\n    email: string;\n  };\n};\n\nexport type UpdatePromptMutationVariables = Exact<{\n  name: Scalars['String']['input'];\n  messages: Array<CopilotPromptMessageInput> | CopilotPromptMessageInput;\n}>;\n\nexport type UpdatePromptMutation = {\n  __typename?: 'Mutation';\n  updateCopilotPrompt: {\n    __typename?: 'CopilotPromptType';\n    name: string;\n    model: string;\n    action: string | null;\n    config: {\n      __typename?: 'CopilotPromptConfigType';\n      jsonMode: boolean | null;\n      frequencyPenalty: number | null;\n      presencePenalty: number | null;\n      temperature: number | null;\n      topP: number | null;\n    } | null;\n    messages: Array<{\n      __typename?: 'CopilotPromptMessageType';\n      role: CopilotPromptMessageRole;\n      content: string;\n      params: Record<string, string> | null;\n    }>;\n  };\n};\n\nexport type UpdateServerRuntimeConfigsMutationVariables = Exact<{\n  updates: Scalars['JSONObject']['input'];\n}>;\n\nexport type UpdateServerRuntimeConfigsMutation = {\n  __typename?: 'Mutation';\n  updateRuntimeConfigs: Array<{\n    __typename?: 'ServerRuntimeConfigType';\n    key: string;\n    value: Record<string, string>;\n  }>;\n};\n\nexport type UpdateSubscriptionMutationVariables = Exact<{\n  idempotencyKey: Scalars['String']['input'];\n  plan?: InputMaybe<SubscriptionPlan>;\n  recurring: SubscriptionRecurring;\n}>;\n\nexport type UpdateSubscriptionMutation = {\n  __typename?: 'Mutation';\n  updateSubscriptionRecurring: {\n    __typename?: 'UserSubscription';\n    id: string | null;\n    plan: SubscriptionPlan;\n    recurring: SubscriptionRecurring;\n    nextBillAt: string | null;\n  };\n};\n\nexport type UpdateUserProfileMutationVariables = Exact<{\n  input: UpdateUserInput;\n}>;\n\nexport type UpdateUserProfileMutation = {\n  __typename?: 'Mutation';\n  updateProfile: { __typename?: 'UserType'; id: string; name: string };\n};\n\nexport type UploadAvatarMutationVariables = Exact<{\n  avatar: Scalars['Upload']['input'];\n}>;\n\nexport type UploadAvatarMutation = {\n  __typename?: 'Mutation';\n  uploadAvatar: {\n    __typename?: 'UserType';\n    id: string;\n    name: string;\n    avatarUrl: string | null;\n    email: string;\n  };\n};\n\nexport type VerifyEmailMutationVariables = Exact<{\n  token: Scalars['String']['input'];\n}>;\n\nexport type VerifyEmailMutation = {\n  __typename?: 'Mutation';\n  verifyEmail: boolean;\n};\n\nexport type EnabledFeaturesQueryVariables = Exact<{\n  id: Scalars['String']['input'];\n}>;\n\nexport type EnabledFeaturesQuery = {\n  __typename?: 'Query';\n  workspace: { __typename?: 'WorkspaceType'; features: Array<FeatureType> };\n};\n\nexport type AvailableFeaturesQueryVariables = Exact<{\n  id: Scalars['String']['input'];\n}>;\n\nexport type AvailableFeaturesQuery = {\n  __typename?: 'Query';\n  workspace: {\n    __typename?: 'WorkspaceType';\n    availableFeatures: Array<FeatureType>;\n  };\n};\n\nexport type SetWorkspaceExperimentalFeatureMutationVariables = Exact<{\n  workspaceId: Scalars['String']['input'];\n  feature: FeatureType;\n  enable: Scalars['Boolean']['input'];\n}>;\n\nexport type SetWorkspaceExperimentalFeatureMutation = {\n  __typename?: 'Mutation';\n  setWorkspaceExperimentalFeature: boolean;\n};\n\nexport type AddWorkspaceFeatureMutationVariables = Exact<{\n  workspaceId: Scalars['String']['input'];\n  feature: FeatureType;\n}>;\n\nexport type AddWorkspaceFeatureMutation = {\n  __typename?: 'Mutation';\n  addWorkspaceFeature: number;\n};\n\nexport type ListWorkspaceFeaturesQueryVariables = Exact<{\n  feature: FeatureType;\n}>;\n\nexport type ListWorkspaceFeaturesQuery = {\n  __typename?: 'Query';\n  listWorkspaceFeatures: Array<{\n    __typename?: 'WorkspaceType';\n    id: string;\n    public: boolean;\n    createdAt: string;\n    memberCount: number;\n    features: Array<FeatureType>;\n    owner: { __typename?: 'UserType'; id: string };\n  }>;\n};\n\nexport type RemoveWorkspaceFeatureMutationVariables = Exact<{\n  workspaceId: Scalars['String']['input'];\n  feature: FeatureType;\n}>;\n\nexport type RemoveWorkspaceFeatureMutation = {\n  __typename?: 'Mutation';\n  removeWorkspaceFeature: number;\n};\n\nexport type InviteByEmailMutationVariables = Exact<{\n  workspaceId: Scalars['String']['input'];\n  email: Scalars['String']['input'];\n  permission: Permission;\n  sendInviteMail: InputMaybe<Scalars['Boolean']['input']>;\n}>;\n\nexport type InviteByEmailMutation = { __typename?: 'Mutation'; invite: string };\n\nexport type AcceptInviteByInviteIdMutationVariables = Exact<{\n  workspaceId: Scalars['String']['input'];\n  inviteId: Scalars['String']['input'];\n  sendAcceptMail: InputMaybe<Scalars['Boolean']['input']>;\n}>;\n\nexport type AcceptInviteByInviteIdMutation = {\n  __typename?: 'Mutation';\n  acceptInviteById: boolean;\n};\n\nexport type WorkspaceQuotaQueryVariables = Exact<{\n  id: Scalars['String']['input'];\n}>;\n\nexport type WorkspaceQuotaQuery = {\n  __typename?: 'Query';\n  workspace: {\n    __typename?: 'WorkspaceType';\n    quota: {\n      __typename?: 'QuotaQueryType';\n      name: string;\n      blobLimit: number;\n      storageQuota: number;\n      historyPeriod: number;\n      memberLimit: number;\n      usedSize: number;\n      humanReadable: {\n        __typename?: 'HumanReadableQuotaType';\n        name: string;\n        blobLimit: string;\n        storageQuota: string;\n        historyPeriod: string;\n        memberLimit: string;\n      };\n    };\n  };\n};\n\nexport type Queries =\n  | {\n      name: 'adminServerConfigQuery';\n      variables: AdminServerConfigQueryVariables;\n      response: AdminServerConfigQuery;\n    }\n  | {\n      name: 'listBlobsQuery';\n      variables: ListBlobsQueryVariables;\n      response: ListBlobsQuery;\n    }\n  | {\n      name: 'copilotQuotaQuery';\n      variables: CopilotQuotaQueryVariables;\n      response: CopilotQuotaQuery;\n    }\n  | {\n      name: 'getCopilotHistoriesQuery';\n      variables: GetCopilotHistoriesQueryVariables;\n      response: GetCopilotHistoriesQuery;\n    }\n  | {\n      name: 'getCopilotHistoryIdsQuery';\n      variables: GetCopilotHistoryIdsQueryVariables;\n      response: GetCopilotHistoryIdsQuery;\n    }\n  | {\n      name: 'getCopilotSessionsQuery';\n      variables: GetCopilotSessionsQueryVariables;\n      response: GetCopilotSessionsQuery;\n    }\n  | {\n      name: 'getCurrentUserFeaturesQuery';\n      variables: GetCurrentUserFeaturesQueryVariables;\n      response: GetCurrentUserFeaturesQuery;\n    }\n  | {\n      name: 'getCurrentUserQuery';\n      variables: GetCurrentUserQueryVariables;\n      response: GetCurrentUserQuery;\n    }\n  | {\n      name: 'getInviteInfoQuery';\n      variables: GetInviteInfoQueryVariables;\n      response: GetInviteInfoQuery;\n    }\n  | {\n      name: 'getIsOwnerQuery';\n      variables: GetIsOwnerQueryVariables;\n      response: GetIsOwnerQuery;\n    }\n  | {\n      name: 'getMemberCountByWorkspaceIdQuery';\n      variables: GetMemberCountByWorkspaceIdQueryVariables;\n      response: GetMemberCountByWorkspaceIdQuery;\n    }\n  | {\n      name: 'getMembersByWorkspaceIdQuery';\n      variables: GetMembersByWorkspaceIdQueryVariables;\n      response: GetMembersByWorkspaceIdQuery;\n    }\n  | {\n      name: 'oauthProvidersQuery';\n      variables: OauthProvidersQueryVariables;\n      response: OauthProvidersQuery;\n    }\n  | {\n      name: 'getPromptsQuery';\n      variables: GetPromptsQueryVariables;\n      response: GetPromptsQuery;\n    }\n  | {\n      name: 'getServerRuntimeConfigQuery';\n      variables: GetServerRuntimeConfigQueryVariables;\n      response: GetServerRuntimeConfigQuery;\n    }\n  | {\n      name: 'getServerServiceConfigsQuery';\n      variables: GetServerServiceConfigsQueryVariables;\n      response: GetServerServiceConfigsQuery;\n    }\n  | {\n      name: 'getUserByEmailQuery';\n      variables: GetUserByEmailQueryVariables;\n      response: GetUserByEmailQuery;\n    }\n  | {\n      name: 'getUserFeaturesQuery';\n      variables: GetUserFeaturesQueryVariables;\n      response: GetUserFeaturesQuery;\n    }\n  | {\n      name: 'getUserQuery';\n      variables: GetUserQueryVariables;\n      response: GetUserQuery;\n    }\n  | {\n      name: 'getUsersCountQuery';\n      variables: GetUsersCountQueryVariables;\n      response: GetUsersCountQuery;\n    }\n  | {\n      name: 'getWorkspaceFeaturesQuery';\n      variables: GetWorkspaceFeaturesQueryVariables;\n      response: GetWorkspaceFeaturesQuery;\n    }\n  | {\n      name: 'getWorkspacePublicByIdQuery';\n      variables: GetWorkspacePublicByIdQueryVariables;\n      response: GetWorkspacePublicByIdQuery;\n    }\n  | {\n      name: 'getWorkspacePublicPageByIdQuery';\n      variables: GetWorkspacePublicPageByIdQueryVariables;\n      response: GetWorkspacePublicPageByIdQuery;\n    }\n  | {\n      name: 'getWorkspacePublicPagesQuery';\n      variables: GetWorkspacePublicPagesQueryVariables;\n      response: GetWorkspacePublicPagesQuery;\n    }\n  | {\n      name: 'getWorkspaceQuery';\n      variables: GetWorkspaceQueryVariables;\n      response: GetWorkspaceQuery;\n    }\n  | {\n      name: 'getWorkspacesQuery';\n      variables: GetWorkspacesQueryVariables;\n      response: GetWorkspacesQuery;\n    }\n  | {\n      name: 'listHistoryQuery';\n      variables: ListHistoryQueryVariables;\n      response: ListHistoryQuery;\n    }\n  | {\n      name: 'getInvoicesCountQuery';\n      variables: GetInvoicesCountQueryVariables;\n      response: GetInvoicesCountQuery;\n    }\n  | {\n      name: 'invoicesQuery';\n      variables: InvoicesQueryVariables;\n      response: InvoicesQuery;\n    }\n  | {\n      name: 'listUsersQuery';\n      variables: ListUsersQueryVariables;\n      response: ListUsersQuery;\n    }\n  | {\n      name: 'pricesQuery';\n      variables: PricesQueryVariables;\n      response: PricesQuery;\n    }\n  | {\n      name: 'quotaQuery';\n      variables: QuotaQueryVariables;\n      response: QuotaQuery;\n    }\n  | {\n      name: 'serverConfigQuery';\n      variables: ServerConfigQueryVariables;\n      response: ServerConfigQuery;\n    }\n  | {\n      name: 'subscriptionQuery';\n      variables: SubscriptionQueryVariables;\n      response: SubscriptionQuery;\n    }\n  | {\n      name: 'enabledFeaturesQuery';\n      variables: EnabledFeaturesQueryVariables;\n      response: EnabledFeaturesQuery;\n    }\n  | {\n      name: 'availableFeaturesQuery';\n      variables: AvailableFeaturesQueryVariables;\n      response: AvailableFeaturesQuery;\n    }\n  | {\n      name: 'listWorkspaceFeaturesQuery';\n      variables: ListWorkspaceFeaturesQueryVariables;\n      response: ListWorkspaceFeaturesQuery;\n    }\n  | {\n      name: 'workspaceQuotaQuery';\n      variables: WorkspaceQuotaQueryVariables;\n      response: WorkspaceQuotaQuery;\n    };\n\nexport type Mutations =\n  | {\n      name: 'deleteBlobMutation';\n      variables: DeleteBlobMutationVariables;\n      response: DeleteBlobMutation;\n    }\n  | {\n      name: 'setBlobMutation';\n      variables: SetBlobMutationVariables;\n      response: SetBlobMutation;\n    }\n  | {\n      name: 'cancelSubscriptionMutation';\n      variables: CancelSubscriptionMutationVariables;\n      response: CancelSubscriptionMutation;\n    }\n  | {\n      name: 'changeEmailMutation';\n      variables: ChangeEmailMutationVariables;\n      response: ChangeEmailMutation;\n    }\n  | {\n      name: 'createChangePasswordUrlMutation';\n      variables: CreateChangePasswordUrlMutationVariables;\n      response: CreateChangePasswordUrlMutation;\n    }\n  | {\n      name: 'changePasswordMutation';\n      variables: ChangePasswordMutationVariables;\n      response: ChangePasswordMutation;\n    }\n  | {\n      name: 'cleanupCopilotSessionMutation';\n      variables: CleanupCopilotSessionMutationVariables;\n      response: CleanupCopilotSessionMutation;\n    }\n  | {\n      name: 'createCheckoutSessionMutation';\n      variables: CreateCheckoutSessionMutationVariables;\n      response: CreateCheckoutSessionMutation;\n    }\n  | {\n      name: 'createCopilotMessageMutation';\n      variables: CreateCopilotMessageMutationVariables;\n      response: CreateCopilotMessageMutation;\n    }\n  | {\n      name: 'createCopilotSessionMutation';\n      variables: CreateCopilotSessionMutationVariables;\n      response: CreateCopilotSessionMutation;\n    }\n  | {\n      name: 'createCustomerPortalMutation';\n      variables: CreateCustomerPortalMutationVariables;\n      response: CreateCustomerPortalMutation;\n    }\n  | {\n      name: 'createUserMutation';\n      variables: CreateUserMutationVariables;\n      response: CreateUserMutation;\n    }\n  | {\n      name: 'createWorkspaceMutation';\n      variables: CreateWorkspaceMutationVariables;\n      response: CreateWorkspaceMutation;\n    }\n  | {\n      name: 'deleteAccountMutation';\n      variables: DeleteAccountMutationVariables;\n      response: DeleteAccountMutation;\n    }\n  | {\n      name: 'deleteUserMutation';\n      variables: DeleteUserMutationVariables;\n      response: DeleteUserMutation;\n    }\n  | {\n      name: 'deleteWorkspaceMutation';\n      variables: DeleteWorkspaceMutationVariables;\n      response: DeleteWorkspaceMutation;\n    }\n  | {\n      name: 'forkCopilotSessionMutation';\n      variables: ForkCopilotSessionMutationVariables;\n      response: ForkCopilotSessionMutation;\n    }\n  | {\n      name: 'leaveWorkspaceMutation';\n      variables: LeaveWorkspaceMutationVariables;\n      response: LeaveWorkspaceMutation;\n    }\n  | {\n      name: 'publishPageMutation';\n      variables: PublishPageMutationVariables;\n      response: PublishPageMutation;\n    }\n  | {\n      name: 'recoverDocMutation';\n      variables: RecoverDocMutationVariables;\n      response: RecoverDocMutation;\n    }\n  | {\n      name: 'removeAvatarMutation';\n      variables: RemoveAvatarMutationVariables;\n      response: RemoveAvatarMutation;\n    }\n  | {\n      name: 'resumeSubscriptionMutation';\n      variables: ResumeSubscriptionMutationVariables;\n      response: ResumeSubscriptionMutation;\n    }\n  | {\n      name: 'revokeMemberPermissionMutation';\n      variables: RevokeMemberPermissionMutationVariables;\n      response: RevokeMemberPermissionMutation;\n    }\n  | {\n      name: 'revokePublicPageMutation';\n      variables: RevokePublicPageMutationVariables;\n      response: RevokePublicPageMutation;\n    }\n  | {\n      name: 'sendChangeEmailMutation';\n      variables: SendChangeEmailMutationVariables;\n      response: SendChangeEmailMutation;\n    }\n  | {\n      name: 'sendChangePasswordEmailMutation';\n      variables: SendChangePasswordEmailMutationVariables;\n      response: SendChangePasswordEmailMutation;\n    }\n  | {\n      name: 'sendSetPasswordEmailMutation';\n      variables: SendSetPasswordEmailMutationVariables;\n      response: SendSetPasswordEmailMutation;\n    }\n  | {\n      name: 'sendVerifyChangeEmailMutation';\n      variables: SendVerifyChangeEmailMutationVariables;\n      response: SendVerifyChangeEmailMutation;\n    }\n  | {\n      name: 'sendVerifyEmailMutation';\n      variables: SendVerifyEmailMutationVariables;\n      response: SendVerifyEmailMutation;\n    }\n  | {\n      name: 'setWorkspacePublicByIdMutation';\n      variables: SetWorkspacePublicByIdMutationVariables;\n      response: SetWorkspacePublicByIdMutation;\n    }\n  | {\n      name: 'updateAccountFeaturesMutation';\n      variables: UpdateAccountFeaturesMutationVariables;\n      response: UpdateAccountFeaturesMutation;\n    }\n  | {\n      name: 'updateAccountMutation';\n      variables: UpdateAccountMutationVariables;\n      response: UpdateAccountMutation;\n    }\n  | {\n      name: 'updatePromptMutation';\n      variables: UpdatePromptMutationVariables;\n      response: UpdatePromptMutation;\n    }\n  | {\n      name: 'updateServerRuntimeConfigsMutation';\n      variables: UpdateServerRuntimeConfigsMutationVariables;\n      response: UpdateServerRuntimeConfigsMutation;\n    }\n  | {\n      name: 'updateSubscriptionMutation';\n      variables: UpdateSubscriptionMutationVariables;\n      response: UpdateSubscriptionMutation;\n    }\n  | {\n      name: 'updateUserProfileMutation';\n      variables: UpdateUserProfileMutationVariables;\n      response: UpdateUserProfileMutation;\n    }\n  | {\n      name: 'uploadAvatarMutation';\n      variables: UploadAvatarMutationVariables;\n      response: UploadAvatarMutation;\n    }\n  | {\n      name: 'verifyEmailMutation';\n      variables: VerifyEmailMutationVariables;\n      response: VerifyEmailMutation;\n    }\n  | {\n      name: 'setWorkspaceExperimentalFeatureMutation';\n      variables: SetWorkspaceExperimentalFeatureMutationVariables;\n      response: SetWorkspaceExperimentalFeatureMutation;\n    }\n  | {\n      name: 'addWorkspaceFeatureMutation';\n      variables: AddWorkspaceFeatureMutationVariables;\n      response: AddWorkspaceFeatureMutation;\n    }\n  | {\n      name: 'removeWorkspaceFeatureMutation';\n      variables: RemoveWorkspaceFeatureMutationVariables;\n      response: RemoveWorkspaceFeatureMutation;\n    }\n  | {\n      name: 'inviteByEmailMutation';\n      variables: InviteByEmailMutationVariables;\n      response: InviteByEmailMutation;\n    }\n  | {\n      name: 'acceptInviteByInviteIdMutation';\n      variables: AcceptInviteByInviteIdMutationVariables;\n      response: AcceptInviteByInviteIdMutation;\n    };\n","// THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY.\n// Run `yarn run download-resources` to regenerate.\n// If you need to update the code, please edit `i18n/src/scripts/download.ts` inside your project.\nimport ar from './ar.json';\nimport ca from './ca.json';\nimport da from './da.json';\nimport de from './de.json';\nimport en from './en.json';\nimport en_US from './en-US.json';\nimport es from './es.json';\nimport es_AR from './es-AR.json';\nimport es_CL from './es-CL.json';\nimport fr from './fr.json';\nimport hi from './hi.json';\nimport it from './it.json';\nimport ja from './ja.json';\nimport ko from './ko.json';\nimport pt_BR from './pt-BR.json';\nimport ru from './ru.json';\nimport sv_SE from './sv-SE.json';\nimport ur from './ur.json';\nimport zh_Hans from './zh-Hans.json';\nimport zh_Hant from './zh-Hant.json';\n\nexport const LOCALES = [\n  {\n    id: 1000040010,\n    name: 'Korean (South Korea)',\n    tag: 'ko',\n    originalName: '()',\n    flagEmoji: '',\n    base: false,\n    completeRate: 0.726,\n    res: ko,\n  },\n  {\n    id: 1000040021,\n    name: 'Portuguese (Brazil)',\n    tag: 'pt-BR',\n    originalName: 'portugus (Brasil)',\n    flagEmoji: '',\n    base: false,\n    completeRate: 0.317,\n    res: pt_BR,\n  },\n  {\n    id: 1000040001,\n    name: 'English',\n    tag: 'en',\n    originalName: 'English',\n    flagEmoji: '',\n    base: true,\n    completeRate: 1,\n    res: en,\n  },\n  {\n    id: 1000040003,\n    name: 'Traditional Chinese',\n    tag: 'zh-Hant',\n    originalName: '',\n    flagEmoji: '',\n    base: false,\n    completeRate: 0.34,\n    res: zh_Hant,\n  },\n  {\n    id: 1000040004,\n    name: 'Simplified Chinese',\n    tag: 'zh-Hans',\n    originalName: '',\n    flagEmoji: '',\n    base: false,\n    completeRate: 0.974,\n    res: zh_Hans,\n  },\n  {\n    id: 1000040006,\n    name: 'French',\n    tag: 'fr',\n    originalName: 'franais',\n    flagEmoji: '',\n    base: false,\n    completeRate: 0.877,\n    res: fr,\n  },\n  {\n    id: 1000040008,\n    name: 'Spanish',\n    tag: 'es',\n    originalName: 'espaol',\n    flagEmoji: '',\n    base: false,\n    completeRate: 0.241,\n    res: es,\n  },\n  {\n    id: 1000040009,\n    name: 'German',\n    tag: 'de',\n    originalName: 'Deutsch',\n    flagEmoji: '',\n    base: false,\n    completeRate: 0.277,\n    res: de,\n  },\n  {\n    id: 1000040011,\n    name: 'Russian',\n    tag: 'ru',\n    originalName: '',\n    flagEmoji: '',\n    base: false,\n    completeRate: 0.913,\n    res: ru,\n  },\n  {\n    id: 1000040014,\n    name: 'Japanese',\n    tag: 'ja',\n    originalName: '',\n    flagEmoji: '',\n    base: false,\n    completeRate: 0.414,\n    res: ja,\n  },\n  {\n    id: 1000040023,\n    name: 'Italian',\n    tag: 'it',\n    originalName: 'italiano',\n    flagEmoji: '',\n    base: false,\n    completeRate: 0.001,\n    res: it,\n  },\n  {\n    id: 1000070001,\n    name: 'Catalan',\n    tag: 'ca',\n    originalName: 'catal',\n    flagEmoji: '',\n    base: false,\n    completeRate: 0.063,\n    res: ca,\n  },\n  {\n    id: 1000074001,\n    name: 'Danish',\n    tag: 'da',\n    originalName: 'dansk',\n    flagEmoji: '',\n    base: false,\n    completeRate: 0.094,\n    res: da,\n  },\n  {\n    id: 1000074002,\n    name: 'English (United States)',\n    tag: 'en-US',\n    originalName: 'English (United States)',\n    flagEmoji: '',\n    base: false,\n    completeRate: 0.009,\n    res: en_US,\n  },\n  {\n    id: 1000074003,\n    name: 'Spanish (Chile)',\n    tag: 'es-CL',\n    originalName: 'espaol (Chile)',\n    flagEmoji: '',\n    base: false,\n    completeRate: 0.026,\n    res: es_CL,\n  },\n  {\n    id: 1000074004,\n    name: 'Hindi',\n    tag: 'hi',\n    originalName: '',\n    flagEmoji: '',\n    base: false,\n    completeRate: 0.016,\n    res: hi,\n  },\n  {\n    id: 1000134010,\n    name: 'Swedish (Sweden)',\n    tag: 'sv-SE',\n    originalName: 'svenska (Sverige)',\n    flagEmoji: '',\n    base: false,\n    completeRate: 0.059,\n    res: sv_SE,\n  },\n  {\n    id: 1000134011,\n    name: 'Spanish (Argentina)',\n    tag: 'es-AR',\n    originalName: 'espaol (Argentina)',\n    flagEmoji: '',\n    base: false,\n    completeRate: 0.094,\n    res: es_AR,\n  },\n  {\n    id: 1000134012,\n    name: 'Urdu',\n    tag: 'ur',\n    originalName: '',\n    flagEmoji: '',\n    base: false,\n    completeRate: 0.021,\n    res: ur,\n  },\n  {\n    id: 1000134005,\n    name: 'Arabic',\n    tag: 'ar',\n    originalName: '',\n    flagEmoji: '',\n    base: false,\n    completeRate: 0.974,\n    res: ar,\n  },\n] as const;\n","import { useMemo } from 'react';\nimport { getI18n, useTranslation } from 'react-i18next';\n\nimport type { useAFFiNEI18N } from './i18n-generated';\n\nexport type I18nFuncs = ReturnType<typeof useAFFiNEI18N>;\n\nexport type I18nInfos = {\n  [K in keyof I18nFuncs]: I18nFuncs[K] extends (...a: infer Opt) => any\n    ? Opt[0]\n    : never;\n};\n\nexport type I18nKeys = keyof I18nInfos;\n\nexport type I18nString =\n  | {\n      [K in I18nKeys]: {\n        key: K;\n      } & (I18nInfos[K] extends undefined\n        ? unknown\n        : { options: I18nInfos[K] });\n    }[I18nKeys]\n  | string;\n\nexport const isI18nString = (value: any): value is I18nString => {\n  return (\n    typeof value === 'string' || (typeof value === 'object' && 'key' in value)\n  );\n};\n\nfunction createI18nWrapper(\n  getI18nFn: () => ReturnType<typeof getI18n>,\n  getI18nT: () => ReturnType<typeof getI18n>['t']\n) {\n  const I18nMethod = {\n    t(i18nStr: I18nString) {\n      const i18n = getI18nFn();\n      if (typeof i18nStr === 'object') {\n        return i18n.t(i18nStr.key, 'options' in i18nStr ? i18nStr.options : {});\n      }\n      return i18nStr;\n    },\n    get language() {\n      const i18n = getI18nFn();\n      return i18n.language;\n    },\n    changeLanguage(lng?: string | undefined) {\n      const i18n = getI18nFn();\n      return i18n.changeLanguage(lng);\n    },\n    get on() {\n      const i18n = getI18nFn();\n      return i18n.on.bind(i18n);\n    },\n  };\n\n  return new Proxy(I18nMethod, {\n    get(self, key) {\n      const i18n = getI18nFn();\n      if (typeof key === 'string' && i18n.exists(key)) {\n        return getI18nT().bind(null, key as string);\n      } else {\n        return (self as any)[key as string] as any;\n      }\n    },\n  }) as I18nFuncs & typeof I18nMethod;\n}\n\nexport const useI18n = () => {\n  const { i18n, t } = useTranslation();\n  return useMemo(\n    () =>\n      createI18nWrapper(\n        () => i18n,\n        () => t\n      ),\n    [i18n, t]\n  );\n};\n\n/**\n * I18n['com.affine.xxx']({ arg1: 'hello' }) -> ' hello'\n */\nexport const I18n = createI18nWrapper(getI18n, () => getI18n().t);\nexport type I18n = typeof I18n;\n","import dayjs from 'dayjs';\n\nimport { I18n } from '../i18n';\n\nexport type TimeUnit =\n  | 'second'\n  | 'minute'\n  | 'hour'\n  | 'day'\n  | 'week'\n  | 'month'\n  | 'year';\n\nconst timeUnitCode = {\n  second: 1,\n  minute: 2,\n  hour: 3,\n  day: 4,\n  week: 5,\n  month: 6,\n  year: 7,\n} satisfies Record<TimeUnit, number>;\n\n/**\n * ```ts\n * // timestamp to string\n * i18nTime(1728538228000) -> 'Oct 10, 2024, 1:30:28 PM'\n *\n * // absolute time string\n * i18nTime('2024-10-10 13:30:28', { absolute: { accuracy: 'minute' } }) -> '2024-10-10 13:30 PM'\n * i18nTime('2024-10-10 13:30:28', { absolute: { accuracy: 'minute', noDate: true } }) -> '13:30 PM'\n * i18nTime('2024-10-10 13:30:28', { absolute: { accuracy: 'minute', noYear: true } }) -> 'Oct 10, 13:30 PM'\n * i18nTime('2024-10-10 13:30:28', { absolute: { accuracy: 'day' } }) -> 'Oct 10, 2024'\n *\n * // relative time string\n * i18nTime('2024-10-10 13:30:30', { relative: true }) -> 'now'\n * i18nTime('2024-10-10 13:30:00', { relative: true }) -> '30s ago'\n * i18nTime('2024-10-10 13:30:30', { relative: { accuracy: 'minute' } }) -> '2m ago'\n *\n * // show absolute time string if time is pass 1 day\n * i18nTime('2024-10-9 14:30:30', { relative: { max: [1, 'day'] } }) -> '23h ago'\n * i18nTime('2024-10-9 13:30:30', { relative: { max: [1, 'day'] } }) -> 'Oct 9, 2024, 1:30:30 PM'\n * ```\n */\nexport function i18nTime(\n  time: dayjs.ConfigType,\n  options: {\n    // override i18n instance, default is global I18n instance\n    i18n?: I18n;\n    // override now time, default is current time\n    now?: dayjs.ConfigType;\n    relative?:\n      | {\n          // max time to show relative time, if time is pass this time, show absolute time\n          max?: [number, TimeUnit];\n          // show time with this accuracy\n          accuracy?: TimeUnit;\n          // show weekday, e.g. 'Monday', 'Tuesday', etc.\n          weekday?: boolean;\n          // show 'yesterday' or 'tomorrow' if time is\n          yesterdayAndTomorrow?: boolean;\n        }\n      | true; // use default relative option\n    absolute?: {\n      // show time with this accuracy\n      accuracy?: TimeUnit;\n      // hide year\n      noYear?: boolean;\n      // hide date (year, month, day)\n      noDate?: boolean;\n    };\n  } = {}\n) {\n  const i18n = options.i18n ?? I18n;\n  time = dayjs(time);\n  if (!time.isValid()) {\n    return ''; // invalid time, return empty string\n  }\n\n  const now = dayjs(options.now);\n\n  const defaultRelativeOption = {\n    max: [1000, 'year'],\n    accuracy: 'second',\n    weekday: false,\n    yesterdayAndTomorrow: true,\n  } satisfies typeof options.relative;\n\n  const relativeOption = options.relative\n    ? options.relative === true\n      ? defaultRelativeOption\n      : {\n          ...defaultRelativeOption,\n          ...options.relative,\n        }\n    : null;\n\n  const defaultAbsoluteOption = {\n    accuracy: 'second',\n    noYear: false,\n    noDate: false,\n  } satisfies typeof options.absolute;\n\n  const absoluteOption = {\n    ...defaultAbsoluteOption,\n    ...options.absolute,\n  };\n\n  if (relativeOption) {\n    // show relative\n\n    const formatter = new Intl.RelativeTimeFormat(i18n.language, {\n      style: 'narrow',\n      numeric: relativeOption.yesterdayAndTomorrow ? 'auto' : 'always',\n    });\n\n    const timeUnitProcessor = {\n      second: () => {\n        const diffSecond = time.diff(now) / 1000;\n        if (Math.abs(diffSecond) < 1) {\n          return i18n['com.affine.time.now']();\n        }\n        if (\n          relativeOption.max[1] === 'second' &&\n          Math.abs(diffSecond) >= relativeOption.max[0]\n        ) {\n          return false;\n        }\n        if (Math.abs(diffSecond) < 60) {\n          return formatter.format(Math.trunc(diffSecond), 'second');\n        }\n        return null;\n      },\n      minute: () => {\n        const diffMinute = time.diff(now) / 1000 / 60;\n        if (Math.abs(diffMinute) < 1) {\n          return i18n['com.affine.time.now']();\n        }\n        if (\n          relativeOption.max[1] === 'minute' &&\n          Math.abs(diffMinute) >= relativeOption.max[0]\n        ) {\n          return false;\n        }\n        if (Math.abs(diffMinute) < 60) {\n          return formatter.format(Math.trunc(diffMinute), 'minute');\n        }\n        return null;\n      },\n      hour: () => {\n        const diffHour = time.diff(now) / 1000 / 60 / 60;\n        if (Math.abs(diffHour) < 1) {\n          return i18n['com.affine.time.now']();\n        }\n        if (\n          relativeOption.max[1] === 'hour' &&\n          Math.abs(diffHour) >= relativeOption.max[0]\n        ) {\n          return false;\n        }\n        if (Math.abs(diffHour) < 24) {\n          return formatter.format(Math.trunc(diffHour), 'hour');\n        }\n        return null;\n      },\n      day: () => {\n        const diffDay = time.startOf('day').diff(now.startOf('day'), 'day');\n        if (Math.abs(diffDay) < 1) {\n          return i18n['com.affine.time.today']();\n        }\n        if (\n          relativeOption.max[1] === 'day' &&\n          Math.abs(diffDay) >= relativeOption.max[0]\n        ) {\n          return false;\n        }\n        if (relativeOption.yesterdayAndTomorrow && Math.abs(diffDay) < 2) {\n          return formatter.format(Math.trunc(diffDay), 'day');\n        } else if (relativeOption.weekday && Math.abs(diffDay) < 7) {\n          return new Intl.DateTimeFormat(i18n.language, {\n            weekday: 'long',\n          }).format(time.startOf('day').toDate());\n        } else if (Math.abs(diffDay) < 7) {\n          return formatter.format(Math.trunc(diffDay), 'day');\n        }\n        return null;\n      },\n      week: () => {\n        const inSameMonth = time.startOf('month').isSame(now.startOf('month'));\n        const diffWeek = time.startOf('week').diff(now.startOf('week'), 'week');\n        if (Math.abs(diffWeek) < 1) {\n          return i18n['com.affine.time.this-week']();\n        }\n        if (\n          relativeOption.max[1] === 'week' &&\n          Math.abs(diffWeek) >= relativeOption.max[0]\n        ) {\n          return false;\n        }\n        if (inSameMonth || Math.abs(diffWeek) < 3) {\n          return formatter.format(Math.trunc(diffWeek), 'week');\n        }\n        return null;\n      },\n      month: () => {\n        const diffMonth = time\n          .startOf('month')\n          .diff(now.startOf('month'), 'month');\n        if (Math.abs(diffMonth) < 1) {\n          return i18n['com.affine.time.this-mouth']();\n        }\n        if (\n          relativeOption.max[1] === 'month' &&\n          Math.abs(diffMonth) >= relativeOption.max[0]\n        ) {\n          return false;\n        }\n        if (Math.abs(diffMonth) < 12) {\n          return formatter.format(Math.trunc(diffMonth), 'month');\n        }\n        return null;\n      },\n      year: () => {\n        const diffYear = time.startOf('year').diff(now.startOf('year'), 'year');\n        if (Math.abs(diffYear) < 1) {\n          return i18n['com.affine.time.this-year']();\n        }\n        if (\n          relativeOption.max[1] === 'year' &&\n          Math.abs(diffYear) >= relativeOption.max[0]\n        ) {\n          return false;\n        }\n        return formatter.format(Math.trunc(diffYear), 'year');\n      },\n    } as Record<TimeUnit, () => string | false | null>;\n\n    const processors = Object.entries(timeUnitProcessor).sort(\n      (a, b) => timeUnitCode[a[0] as TimeUnit] - timeUnitCode[b[0] as TimeUnit]\n    ) as [TimeUnit, () => string | false | null][];\n\n    for (const [unit, processor] of processors) {\n      if (timeUnitCode[relativeOption.accuracy] > timeUnitCode[unit]) {\n        continue;\n      }\n      const result = processor();\n      if (result) {\n        return result;\n      }\n      if (result === false) {\n        break;\n      }\n    }\n  }\n\n  // show absolute\n  const formatter = new Intl.DateTimeFormat(i18n.language, {\n    year:\n      !absoluteOption.noYear && !absoluteOption.noDate ? 'numeric' : undefined,\n    month:\n      !absoluteOption.noDate &&\n      timeUnitCode[absoluteOption.accuracy] <= timeUnitCode['month']\n        ? 'short'\n        : undefined,\n    day:\n      !absoluteOption.noDate &&\n      timeUnitCode[absoluteOption.accuracy] <= timeUnitCode['day']\n        ? 'numeric'\n        : undefined,\n    hour:\n      timeUnitCode[absoluteOption.accuracy] <= timeUnitCode['hour']\n        ? 'numeric'\n        : undefined,\n    minute:\n      timeUnitCode[absoluteOption.accuracy] <= timeUnitCode['minute']\n        ? 'numeric'\n        : undefined,\n    second:\n      timeUnitCode[absoluteOption.accuracy] <= timeUnitCode['second']\n        ? 'numeric'\n        : undefined,\n  });\n\n  return formatter.format(time.toDate());\n}\n","import type { i18n, Resource } from 'i18next';\nimport i18next from 'i18next';\nimport type { I18nextProviderProps } from 'react-i18next';\nimport { I18nextProvider, initReactI18next, Trans } from 'react-i18next';\n\nimport { LOCALES } from './resources';\nimport type en_US from './resources/en.json';\n\nexport * from './i18n';\nexport * from './utils';\n\ndeclare module 'i18next' {\n  // Refs: https://www.i18next.com/overview/typescript#argument-of-type-defaulttfuncreturn-is-not-assignable-to-parameter-of-type-xyz\n  interface CustomTypeOptions {\n    returnNull: false;\n  }\n}\n\n// const localStorage = {\n//   getItem() {\n//     return undefined;\n//   },\n//   setItem() {},\n// };\n// See https://react.i18next.com/latest/typescript\ndeclare module 'react-i18next' {\n  interface CustomTypeOptions {\n    // custom namespace type if you changed it\n    // defaultNS: 'ns1';\n    // custom resources type\n    allowObjectInHTMLChildren: true;\n    resources: {\n      en: typeof en_US;\n    };\n  }\n}\n\nconst STORAGE_KEY = 'i18n_lng';\n\nexport { I18nextProvider, LOCALES, Trans };\n\nconst resources = LOCALES.reduce<Resource>((acc, { tag, res }) => {\n  return Object.assign(acc, { [tag]: { translation: res } });\n}, {});\n\nconst fallbackLng = 'en';\nconst standardizeLocale = (language: string) => {\n  if (language === 'zh-CN' || language === 'zh' || language === 'zh-Hans') {\n    language = 'zh-Hans';\n  } else if (language.slice(0, 2).toLowerCase() === 'zh') {\n    language = 'zh-Hant';\n  }\n  if (LOCALES.some(locale => locale.tag === language)) return language;\n  if (\n    LOCALES.some(locale => locale.tag === language.slice(0, 2).toLowerCase())\n  ) {\n    return language.slice(0, 2).toLowerCase();\n  }\n\n  return fallbackLng;\n};\n\nexport const createI18n = (): I18nextProviderProps['i18n'] => {\n  const i18n: I18nextProviderProps['i18n'] = i18next.createInstance();\n  i18n\n    .use(initReactI18next)\n    .init({\n      lng: 'en',\n      fallbackLng,\n      debug: false,\n      resources,\n      interpolation: {\n        escapeValue: false, // not needed for react as it escapes by default\n      },\n    })\n    .then(() => {\n      console.info('i18n init success');\n    })\n    .catch(() => {\n      console.error('i18n init failed');\n    });\n\n  if (globalThis.localStorage) {\n    i18n.on('languageChanged', lng => {\n      localStorage.setItem(STORAGE_KEY, lng);\n    });\n  }\n  return i18n;\n};\n\nexport function setUpLanguage(i: i18n) {\n  let language;\n  const localStorageLanguage = localStorage.getItem(STORAGE_KEY);\n  if (localStorageLanguage) {\n    language = standardizeLocale(localStorageLanguage);\n  } else {\n    language = standardizeLocale(navigator.language);\n  }\n  return i.changeLanguage(language);\n}\n","import { mixpanel } from '@affine/core/mixpanel';\nimport type { EventProps } from '@affine/core/mixpanel/types';\nimport type { QuotaQuery } from '@affine/graphql';\nimport type { GlobalContextService } from '@toeverything/infra';\nimport { ApplicationStarted, OnEvent, Service } from '@toeverything/infra';\n\nimport {\n  AccountChanged,\n  type AuthAccountInfo,\n  type AuthService,\n} from '../../cloud';\nimport { AccountLoggedOut } from '../../cloud/services/auth';\nimport { UserQuotaChanged } from '../../cloud/services/user-quota';\n\n@OnEvent(ApplicationStarted, e => e.onApplicationStart)\n@OnEvent(AccountChanged, e => e.updateIdentity)\n@OnEvent(AccountLoggedOut, e => e.onAccountLoggedOut)\n@OnEvent(UserQuotaChanged, e => e.onUserQuotaChanged)\nexport class TelemetryService extends Service {\n  private prevQuota: NonNullable<QuotaQuery['currentUser']>['quota'] | null =\n    null;\n  private readonly disposables: (() => void)[] = [];\n\n  constructor(\n    private readonly auth: AuthService,\n    private readonly globalContextService: GlobalContextService\n  ) {\n    super();\n  }\n\n  onApplicationStart() {\n    const account = this.auth.session.account$.value;\n    this.updateIdentity(account);\n    this.registerMiddlewares();\n  }\n\n  updateIdentity(account: AuthAccountInfo | null) {\n    if (!account) {\n      return;\n    }\n    mixpanel.identify(account.id);\n    mixpanel.people.set({\n      $email: account.email,\n      $name: account.label,\n      $avatar: account.avatar,\n    });\n  }\n\n  onAccountLoggedOut() {\n    mixpanel.reset();\n  }\n\n  onUserQuotaChanged(quota: NonNullable<QuotaQuery['currentUser']>['quota']) {\n    const plan = quota?.humanReadable.name;\n    // only set when plan is not empty and changed\n    if (plan !== this.prevQuota?.humanReadable.name && plan) {\n      mixpanel.people.set({\n        plan: quota?.humanReadable.name,\n      });\n    }\n    this.prevQuota = quota;\n  }\n\n  registerMiddlewares() {\n    this.disposables.push(\n      mixpanel.middleware((_event, parameters) => {\n        const extraContext = this.extractGlobalContext();\n        return {\n          ...extraContext,\n          ...parameters,\n        };\n      })\n    );\n  }\n\n  extractGlobalContext(): EventProps {\n    const globalContext = this.globalContextService.globalContext;\n    const page = globalContext.isDoc.get()\n      ? globalContext.isTrashDoc.get()\n        ? 'trash'\n        : globalContext.docMode.get() === 'page'\n          ? 'doc'\n          : 'edgeless'\n      : globalContext.isAllDocs.get()\n        ? 'allDocs'\n        : globalContext.isTrash.get()\n          ? 'trash'\n          : globalContext.isCollection.get()\n            ? 'collection'\n            : globalContext.isTag.get()\n              ? 'tag'\n              : undefined;\n    return { page };\n  }\n\n  override dispose(): void {\n    this.disposables.forEach(dispose => dispose());\n    super.dispose();\n  }\n}\n","import type { ReactNode } from 'react';\nimport { cloneElement } from 'react';\n\ninterface ProviderComposerProps {\n  contexts: any;\n  children: ReactNode;\n}\n\nexport const ProviderComposer = ({\n  contexts,\n  children,\n}: ProviderComposerProps) =>\n  contexts.reduceRight(\n    (kids: ReactNode, parent: any) =>\n      cloneElement(parent, {\n        children: kids,\n      }),\n    children\n  );\n","import { apis } from '@affine/electron-api';\nimport { ThemeProvider as NextThemeProvider, useTheme } from 'next-themes';\nimport type { PropsWithChildren } from 'react';\nimport { memo, useRef } from 'react';\n\nconst themes = ['dark', 'light'];\n\nconst DesktopThemeSync = memo(function DesktopThemeSync() {\n  const { theme } = useTheme();\n  const lastThemeRef = useRef(theme);\n  const onceRef = useRef(false);\n  if (lastThemeRef.current !== theme || !onceRef.current) {\n    if (environment.isDesktop && theme) {\n      apis?.ui\n        .handleThemeChange(theme as 'dark' | 'light' | 'system')\n        .catch(err => {\n          console.error(err);\n        });\n    }\n    lastThemeRef.current = theme;\n    onceRef.current = true;\n  }\n  return null;\n});\n\nexport const ThemeProvider = ({ children }: PropsWithChildren) => {\n  return (\n    <NextThemeProvider themes={themes} enableSystem={true}>\n      {children}\n      <DesktopThemeSync />\n    </NextThemeProvider>\n  );\n};\n","import { ProviderComposer } from '@affine/component/provider-composer';\nimport { ThemeProvider } from '@affine/component/theme-provider';\nimport type { createStore } from 'jotai';\nimport { Provider } from 'jotai';\nimport type { PropsWithChildren } from 'react';\nimport { useMemo } from 'react';\n\nimport { ConfirmModalProvider } from '../../ui/modal';\n\nexport type AffineContextProps = PropsWithChildren<{\n  store?: ReturnType<typeof createStore>;\n}>;\n\nexport function AffineContext(props: AffineContextProps) {\n  return (\n    <ProviderComposer\n      contexts={useMemo(\n        () =>\n          [\n            <Provider key=\"JotaiProvider\" store={props.store} />,\n            <ThemeProvider key=\"ThemeProvider\" />,\n            <ConfirmModalProvider key=\"ConfirmModalProvider\" />,\n          ].filter(Boolean),\n        [props.store]\n      )}\n    >\n      {props.children}\n    </ProviderComposer>\n  );\n}\n","import { type DocMeta } from '@blocksuite/store';\nimport { isEqual } from 'lodash-es';\nimport { distinctUntilChanged, Observable } from 'rxjs';\n\nimport { Store } from '../../../framework';\nimport type { WorkspaceLocalState, WorkspaceService } from '../../workspace';\nimport type { DocMode } from '../entities/record';\n\nexport class DocsStore extends Store {\n  constructor(\n    private readonly workspaceService: WorkspaceService,\n    private readonly localState: WorkspaceLocalState\n  ) {\n    super();\n  }\n\n  getBlockSuiteDoc(id: string) {\n    return this.workspaceService.workspace.docCollection.getDoc(id);\n  }\n\n  createBlockSuiteDoc() {\n    return this.workspaceService.workspace.docCollection.createDoc();\n  }\n\n  watchDocIds() {\n    return new Observable<string[]>(subscriber => {\n      const emit = () => {\n        subscriber.next(\n          this.workspaceService.workspace.docCollection.meta.docMetas.map(\n            v => v.id\n          )\n        );\n      };\n\n      emit();\n\n      const dispose =\n        this.workspaceService.workspace.docCollection.meta.docMetaUpdated.on(\n          emit\n        ).dispose;\n      return () => {\n        dispose();\n      };\n    });\n  }\n\n  watchTrashDocIds() {\n    return new Observable<string[]>(subscriber => {\n      const emit = () => {\n        subscriber.next(\n          this.workspaceService.workspace.docCollection.meta.docMetas\n            .map(v => (v.trash ? v.id : null))\n            .filter(Boolean) as string[]\n        );\n      };\n\n      emit();\n\n      const dispose =\n        this.workspaceService.workspace.docCollection.meta.docMetaUpdated.on(\n          emit\n        ).dispose;\n      return () => {\n        dispose();\n      };\n    });\n  }\n\n  watchDocMeta(id: string) {\n    let meta: DocMeta | null = null;\n    return new Observable<Partial<DocMeta>>(subscriber => {\n      const emit = () => {\n        if (meta === null) {\n          // getDocMeta is heavy, so we cache the doc meta reference\n          meta =\n            this.workspaceService.workspace.docCollection.meta.getDocMeta(id) ||\n            null;\n        }\n        subscriber.next({ ...meta });\n      };\n\n      emit();\n\n      const dispose =\n        this.workspaceService.workspace.docCollection.meta.docMetaUpdated.on(\n          emit\n        ).dispose;\n      return () => {\n        dispose();\n      };\n    }).pipe(distinctUntilChanged((p, c) => isEqual(p, c)));\n  }\n\n  watchDocListReady() {\n    return this.workspaceService.workspace.engine.rootDocState$\n      .map(state => !state.syncing)\n      .asObservable();\n  }\n\n  setDocMeta(id: string, meta: Partial<DocMeta>) {\n    this.workspaceService.workspace.docCollection.setDocMeta(id, meta);\n  }\n\n  setDocModeSetting(id: string, mode: DocMode) {\n    return this.localState.set(`page:${id}:mode`, mode);\n  }\n\n  getDocModeSetting(id: string) {\n    return this.localState.get<DocMode>(`page:${id}:mode`);\n  }\n\n  watchDocModeSetting(id: string) {\n    return this.localState.watch<DocMode>(`page:${id}:mode`);\n  }\n\n  waitForDocLoadReady(id: string) {\n    return this.workspaceService.workspace.engine.doc.waitForReady(id);\n  }\n\n  setPriorityLoad(id: string, priority: number) {\n    return this.workspaceService.workspace.engine.doc.setPriority(id, priority);\n  }\n\n  markDocSyncStateAsReady(id: string) {\n    this.workspaceService.workspace.engine.doc.markAsReady(id);\n  }\n}\n","export { GlobalCache, GlobalState } from './providers/global';\nexport { GlobalCacheService, GlobalStateService } from './services/global';\n\nimport type { Framework } from '../../framework';\nimport { MemoryMemento } from '../../storage';\nimport { GlobalCache, GlobalState } from './providers/global';\nimport { GlobalCacheService, GlobalStateService } from './services/global';\n\nexport const configureGlobalStorageModule = (framework: Framework) => {\n  framework.service(GlobalStateService, [GlobalState]);\n  framework.service(GlobalCacheService, [GlobalCache]);\n};\n\nexport const configureTestingGlobalStorage = (framework: Framework) => {\n  framework.impl(GlobalCache, MemoryMemento);\n  framework.impl(GlobalState, MemoryMemento);\n};\n","import { Entity } from '../../../framework';\nimport { LiveData } from '../../../livedata';\nimport type { WorkspaceFlavourProvider } from '../providers/flavour';\n\nexport class WorkspaceList extends Entity {\n  workspaces$ = new LiveData(this.providers.map(p => p.workspaces$))\n    .map(v => {\n      return v;\n    })\n    .flat()\n    .map(workspaces => {\n      return workspaces.flat();\n    });\n  isLoading$ = new LiveData(\n    this.providers.map(p => p.isLoading$ ?? new LiveData(false))\n  )\n    .flat()\n    .map(isLoadings => isLoadings.some(isLoading => isLoading));\n\n  constructor(private readonly providers: WorkspaceFlavourProvider[]) {\n    super();\n  }\n\n  revalidate() {\n    this.providers.forEach(provider => provider.revalidate?.());\n  }\n}\n","import { DebugLogger } from '@affine/debug';\nimport { isEqual } from 'lodash-es';\nimport { catchError, EMPTY, exhaustMap, mergeMap } from 'rxjs';\n\nimport { Entity } from '../../../framework';\nimport {\n  effect,\n  fromPromise,\n  LiveData,\n  onComplete,\n  onStart,\n} from '../../../livedata';\nimport type { WorkspaceMetadata } from '../metadata';\nimport type { WorkspaceFlavourProvider } from '../providers/flavour';\nimport type { WorkspaceProfileCacheStore } from '../stores/profile-cache';\nimport type { Workspace } from './workspace';\n\nconst logger = new DebugLogger('affine:workspace-profile');\n\nexport interface WorkspaceProfileInfo {\n  avatar?: string;\n  name?: string;\n  isOwner?: boolean;\n}\n\n/**\n * # WorkspaceProfile\n *\n * This class take care of workspace avatar and name\n */\nexport class WorkspaceProfile extends Entity<{ metadata: WorkspaceMetadata }> {\n  private readonly provider: WorkspaceFlavourProvider | null;\n\n  get id() {\n    return this.props.metadata.id;\n  }\n\n  profile$ = LiveData.from<WorkspaceProfileInfo | null>(\n    this.cache.watchProfileCache(this.props.metadata.id),\n    null\n  );\n\n  avatar$ = this.profile$.map(v => v?.avatar);\n  name$ = this.profile$.map(v => v?.name);\n\n  isLoading$ = new LiveData(false);\n\n  constructor(\n    private readonly cache: WorkspaceProfileCacheStore,\n    providers: WorkspaceFlavourProvider[]\n  ) {\n    super();\n\n    this.provider =\n      providers.find(p => p.flavour === this.props.metadata.flavour) ?? null;\n  }\n\n  private setProfile(info: WorkspaceProfileInfo) {\n    if (isEqual(this.profile$.value, info)) {\n      return;\n    }\n    this.cache.setProfileCache(this.props.metadata.id, info);\n  }\n\n  revalidate = effect(\n    exhaustMap(() => {\n      const provider = this.provider;\n      if (!provider) {\n        return EMPTY;\n      }\n      return fromPromise(signal =>\n        provider.getWorkspaceProfile(this.props.metadata.id, signal)\n      ).pipe(\n        mergeMap(info => {\n          if (info) {\n            this.setProfile({ ...this.profile$.value, ...info });\n          }\n          return EMPTY;\n        }),\n        catchError(err => {\n          logger.error(err);\n          return EMPTY;\n        }),\n        onStart(() => this.isLoading$.next(true)),\n        onComplete(() => this.isLoading$.next(false))\n      );\n    })\n  );\n\n  syncWithWorkspace(workspace: Workspace) {\n    workspace.name$.subscribe(name => {\n      const old = this.profile$.value;\n      this.setProfile({ ...old, name: name ?? old?.name });\n    });\n    workspace.avatar$.subscribe(avatar => {\n      const old = this.profile$.value;\n      this.setProfile({ ...old, avatar: avatar ?? old?.avatar });\n    });\n  }\n}\n","import { type Memento, wrapMemento } from '../../../storage';\nimport type { GlobalCache, GlobalState } from '../../storage';\nimport type {\n  WorkspaceLocalCache,\n  WorkspaceLocalState,\n} from '../providers/storage';\nimport type { WorkspaceService } from '../services/workspace';\n\nexport class WorkspaceLocalStateImpl implements WorkspaceLocalState {\n  wrapped: Memento;\n  constructor(workspaceService: WorkspaceService, globalState: GlobalState) {\n    this.wrapped = wrapMemento(\n      globalState,\n      `workspace-state:${workspaceService.workspace.id}:`\n    );\n  }\n\n  keys(): string[] {\n    return this.wrapped.keys();\n  }\n\n  get<T>(key: string): T | undefined {\n    return this.wrapped.get<T>(key);\n  }\n\n  watch<T>(key: string) {\n    return this.wrapped.watch<T>(key);\n  }\n\n  set<T>(key: string, value: T): void {\n    return this.wrapped.set<T>(key, value);\n  }\n\n  del(key: string): void {\n    return this.wrapped.del(key);\n  }\n\n  clear(): void {\n    return this.wrapped.clear();\n  }\n}\n\nexport class WorkspaceLocalCacheImpl implements WorkspaceLocalCache {\n  wrapped: Memento;\n  constructor(workspaceService: WorkspaceService, globalCache: GlobalCache) {\n    this.wrapped = wrapMemento(\n      globalCache,\n      `workspace-cache:${workspaceService.workspace.id}:`\n    );\n  }\n\n  keys(): string[] {\n    return this.wrapped.keys();\n  }\n\n  get<T>(key: string): T | undefined {\n    return this.wrapped.get<T>(key);\n  }\n\n  watch<T>(key: string) {\n    return this.wrapped.watch<T>(key);\n  }\n\n  set<T>(key: string, value: T): void {\n    return this.wrapped.set<T>(key, value);\n  }\n\n  del(key: string): void {\n    return this.wrapped.del(key);\n  }\n\n  clear(): void {\n    return this.wrapped.clear();\n  }\n}\n","import { Service } from '../../../framework';\nimport type { WorkspaceMetadata } from '../metadata';\nimport type { WorkspaceFlavourProvider } from '../providers/flavour';\n\nexport class WorkspaceDestroyService extends Service {\n  constructor(private readonly providers: WorkspaceFlavourProvider[]) {\n    super();\n  }\n\n  deleteWorkspace = async (metadata: WorkspaceMetadata) => {\n    const provider = this.providers.find(p => p.flavour === metadata.flavour);\n    if (!provider) {\n      throw new Error(`Unknown workspace flavour: ${metadata.flavour}`);\n    }\n    return provider.deleteWorkspace(metadata.id);\n  };\n}\n","import type { WorkspaceFlavour } from '@affine/env/workspace';\nimport type { DocCollection } from '@blocksuite/store';\n\nimport { Service } from '../../../framework';\nimport type { BlobStorage, DocStorage } from '../../../sync';\nimport type { WorkspaceFlavourProvider } from '../providers/flavour';\n\nexport class WorkspaceFactoryService extends Service {\n  constructor(private readonly providers: WorkspaceFlavourProvider[]) {\n    super();\n  }\n\n  /**\n   * create workspace\n   * @param flavour workspace flavour\n   * @param initial callback to put initial data to workspace\n   * @returns workspace id\n   */\n  create = async (\n    flavour: WorkspaceFlavour,\n    initial: (\n      docCollection: DocCollection,\n      blobStorage: BlobStorage,\n      docStorage: DocStorage\n    ) => Promise<void> = () => Promise.resolve()\n  ) => {\n    const provider = this.providers.find(x => x.flavour === flavour);\n    if (!provider) {\n      throw new Error(`Unknown workspace flavour: ${flavour}`);\n    }\n    const metadata = await provider.createWorkspace(initial);\n    return metadata;\n  };\n}\n","import { Service } from '../../../framework';\nimport { WorkspaceList } from '../entities/list';\n\nexport class WorkspaceListService extends Service {\n  list = this.framework.createEntity(WorkspaceList);\n}\n","import { Service } from '../../../framework';\nimport { ObjectPool } from '../../../utils';\nimport { WorkspaceProfile } from '../entities/profile';\nimport type { WorkspaceMetadata } from '../metadata';\n\nexport class WorkspaceProfileService extends Service {\n  pool = new ObjectPool<string, WorkspaceProfile>();\n\n  getProfile = (metadata: WorkspaceMetadata): WorkspaceProfile => {\n    const exists = this.pool.get(metadata.id);\n    if (exists) {\n      return exists.obj;\n    }\n\n    const profile = this.framework.createEntity(WorkspaceProfile, {\n      metadata,\n    });\n\n    return this.pool.put(metadata.id, profile).obj;\n  };\n}\n","import { DebugLogger } from '@affine/debug';\n\nimport { setupEditorFlags } from '../../../atom';\nimport { fixWorkspaceVersion } from '../../../blocksuite';\nimport { Service } from '../../../framework';\nimport { ObjectPool } from '../../../utils';\nimport type { Workspace } from '../entities/workspace';\nimport type { WorkspaceOpenOptions } from '../open-options';\nimport type { WorkspaceFlavourProvider } from '../providers/flavour';\nimport { WorkspaceScope } from '../scopes/workspace';\nimport type { WorkspaceProfileService } from './profile';\nimport { WorkspaceService } from './workspace';\n\nconst logger = new DebugLogger('affine:workspace-repository');\n\nexport class WorkspaceRepositoryService extends Service {\n  constructor(\n    private readonly providers: WorkspaceFlavourProvider[],\n    private readonly profileRepo: WorkspaceProfileService\n  ) {\n    super();\n  }\n  pool = new ObjectPool<string, Workspace>({\n    onDelete(workspace) {\n      workspace.scope.dispose();\n    },\n    onDangling(workspace) {\n      return workspace.canGracefulStop;\n    },\n  });\n\n  /**\n   * open workspace reference by metadata.\n   *\n   * You basically don't need to call this function directly, use the react hook `useWorkspace(metadata)` instead.\n   *\n   * @returns the workspace reference and a release function, don't forget to call release function when you don't\n   * need the workspace anymore.\n   */\n  open = (\n    options: WorkspaceOpenOptions,\n    customProvider?: WorkspaceFlavourProvider\n  ): {\n    workspace: Workspace;\n    dispose: () => void;\n  } => {\n    if (options.isSharedMode) {\n      const workspace = this.instantiate(options, customProvider);\n      return {\n        workspace,\n        dispose: () => {\n          workspace.dispose();\n        },\n      };\n    }\n\n    const exist = this.pool.get(options.metadata.id);\n    if (exist) {\n      return {\n        workspace: exist.obj,\n        dispose: exist.release,\n      };\n    }\n\n    const workspace = this.instantiate(options, customProvider);\n    // sync information with workspace list, when workspace's avatar and name changed, information will be updated\n    // this.list.getInformation(metadata).syncWithWorkspace(workspace);\n\n    const ref = this.pool.put(workspace.meta.id, workspace);\n\n    return {\n      workspace: ref.obj,\n      dispose: ref.release,\n    };\n  };\n\n  instantiate(\n    openOptions: WorkspaceOpenOptions,\n    customProvider?: WorkspaceFlavourProvider\n  ) {\n    logger.info(\n      `open workspace [${openOptions.metadata.flavour}] ${openOptions.metadata.id} `\n    );\n    const provider =\n      customProvider ??\n      this.providers.find(p => p.flavour === openOptions.metadata.flavour);\n    if (!provider) {\n      throw new Error(\n        `Unknown workspace flavour: ${openOptions.metadata.flavour}`\n      );\n    }\n\n    const workspaceScope = this.framework.createScope(WorkspaceScope, {\n      openOptions,\n      flavourProvider: provider,\n    });\n\n    const workspace = workspaceScope.get(WorkspaceService).workspace;\n\n    workspace.engine.setRootDoc(workspace.docCollection.doc);\n    workspace.engine.start();\n\n    // apply compatibility fix\n    fixWorkspaceVersion(workspace.docCollection.doc);\n\n    setupEditorFlags(workspace.docCollection);\n\n    this.profileRepo\n      .getProfile(openOptions.metadata)\n      .syncWithWorkspace(workspace);\n\n    return workspace;\n  }\n}\n","import type { Doc as YDoc, Map as YMap } from 'yjs';\nimport { transact } from 'yjs';\n\n/**\n * Hard code to fix workspace version to be compatible with legacy data.\n * Let e2e to ensure the data version is correct.\n */\nexport function fixWorkspaceVersion(rootDoc: YDoc) {\n  const meta = rootDoc.getMap('meta') as YMap<unknown>;\n\n  /**\n   * It doesn't matter to upgrade workspace version from 1 or undefined to 2.\n   * Blocksuite just set the value, do nothing else.\n   */\n  function doFix() {\n    if (meta.size === 0) {\n      return;\n    }\n    const workspaceVersion = meta.get('workspaceVersion');\n    if (typeof workspaceVersion !== 'number' || workspaceVersion < 2) {\n      transact(\n        rootDoc,\n        () => {\n          meta.set('workspaceVersion', 2);\n        },\n        'fixWorkspaceVersion',\n        // transact as remote update, because blocksuite will skip local changes.\n        false\n      );\n    }\n    const pageVersion = meta.get('pageVersion');\n    if (typeof pageVersion !== 'number' || pageVersion < 2) {\n      transact(\n        rootDoc,\n        () => {\n          meta.set('pageVersion', 2);\n        },\n        'fixPageVersion',\n        // transact as remote update, because blocksuite will skip local changes.\n        false\n      );\n    }\n  }\n\n  doFix();\n\n  // do fix every time when meta changed\n  meta.observe(() => doFix());\n}\n","import { WorkspaceFlavour } from '@affine/env/workspace';\nimport { assertEquals } from '@blocksuite/global/utils';\nimport { applyUpdate, encodeStateAsUpdate } from 'yjs';\n\nimport { Service } from '../../../framework';\nimport { transformWorkspaceDBLocalToCloud } from '../../db';\nimport type { Workspace } from '../entities/workspace';\nimport type { WorkspaceMetadata } from '../metadata';\nimport type { WorkspaceDestroyService } from './destroy';\nimport type { WorkspaceFactoryService } from './factory';\n\nexport class WorkspaceTransformService extends Service {\n  constructor(\n    private readonly factory: WorkspaceFactoryService,\n    private readonly destroy: WorkspaceDestroyService\n  ) {\n    super();\n  }\n\n  /**\n   * helper function to transform local workspace to cloud workspace\n   *\n   * @param accountId - all local user data will be transformed to this account\n   */\n  transformLocalToCloud = async (\n    local: Workspace,\n    accountId: string\n  ): Promise<WorkspaceMetadata> => {\n    assertEquals(local.flavour, WorkspaceFlavour.LOCAL);\n\n    await local.engine.waitForDocSynced();\n\n    const newMetadata = await this.factory.create(\n      WorkspaceFlavour.AFFINE_CLOUD,\n      async (docCollection, blobStorage, docStorage) => {\n        applyUpdate(\n          docCollection.doc,\n          encodeStateAsUpdate(local.docCollection.doc)\n        );\n\n        for (const subdoc of local.docCollection.doc.getSubdocs()) {\n          for (const newSubdoc of docCollection.doc.getSubdocs()) {\n            if (newSubdoc.guid === subdoc.guid) {\n              applyUpdate(newSubdoc, encodeStateAsUpdate(subdoc));\n            }\n          }\n        }\n\n        // transform db\n        await transformWorkspaceDBLocalToCloud(\n          local.id,\n          docCollection.id,\n          local.engine.doc.storage.behavior,\n          docStorage,\n          accountId\n        );\n\n        const blobList = await local.engine.blob.list();\n\n        for (const blobKey of blobList) {\n          const blob = await local.engine.blob.get(blobKey);\n          if (blob) {\n            await blobStorage.set(blobKey, blob);\n          }\n        }\n      }\n    );\n\n    await this.destroy.deleteWorkspace(local.meta);\n\n    return newMetadata;\n  };\n}\n","import { map } from 'rxjs';\n\nimport { Store } from '../../../framework';\nimport type { GlobalCache } from '../../storage';\nimport type { WorkspaceProfileInfo } from '../entities/profile';\n\nconst WORKSPACE_PROFILE_CACHE_KEY = 'workspace-information:';\n\nexport class WorkspaceProfileCacheStore extends Store {\n  constructor(private readonly cache: GlobalCache) {\n    super();\n  }\n\n  watchProfileCache(workspaceId: string) {\n    return this.cache.watch(WORKSPACE_PROFILE_CACHE_KEY + workspaceId).pipe(\n      map(data => {\n        if (!data || typeof data !== 'object') {\n          return null;\n        }\n\n        const info = data as WorkspaceProfileInfo;\n\n        return {\n          avatar: info.avatar,\n          name: info.name,\n          isOwner: info.isOwner,\n        };\n      })\n    );\n  }\n\n  setProfileCache(workspaceId: string, info: WorkspaceProfileInfo) {\n    this.cache.set(WORKSPACE_PROFILE_CACHE_KEY + workspaceId, info);\n  }\n}\n","import type { GlobalCache, GlobalState, Memento } from '@toeverything/infra';\nimport { Observable } from 'rxjs';\n\nexport class LocalStorageMemento implements Memento {\n  constructor(private readonly prefix: string) {}\n\n  keys(): string[] {\n    const keys: string[] = [];\n    for (let i = 0; i < localStorage.length; i++) {\n      const key = localStorage.key(i);\n      if (key && key.startsWith(this.prefix)) {\n        keys.push(key.slice(this.prefix.length));\n      }\n    }\n    return keys;\n  }\n\n  get<T>(key: string): T | undefined {\n    const json = localStorage.getItem(this.prefix + key);\n    return json ? JSON.parse(json) : undefined;\n  }\n  watch<T>(key: string): Observable<T | undefined> {\n    return new Observable<T | undefined>(subscriber => {\n      const json = localStorage.getItem(this.prefix + key);\n      const first = json ? JSON.parse(json) : undefined;\n      subscriber.next(first);\n\n      const channel = new BroadcastChannel(this.prefix + key);\n      channel.addEventListener('message', event => {\n        subscriber.next(event.data);\n      });\n      return () => {\n        channel.close();\n      };\n    });\n  }\n  set<T>(key: string, value: T): void {\n    localStorage.setItem(this.prefix + key, JSON.stringify(value));\n    const channel = new BroadcastChannel(this.prefix + key);\n    channel.postMessage(value);\n    channel.close();\n  }\n\n  del(key: string): void {\n    localStorage.removeItem(this.prefix + key);\n  }\n\n  clear(): void {\n    for (const key of this.keys()) {\n      this.del(key);\n    }\n  }\n}\n\nexport class LocalStorageGlobalCache\n  extends LocalStorageMemento\n  implements GlobalCache\n{\n  constructor() {\n    super('global-cache:');\n  }\n}\n\nexport class LocalStorageGlobalState\n  extends LocalStorageMemento\n  implements GlobalState\n{\n  constructor() {\n    super('global-state:');\n  }\n}\n","import { appSettingAtom } from '@toeverything/infra';\nimport { useAtomValue } from 'jotai/react';\nimport { useLayoutEffect } from 'react';\n\nimport { enableAutoTrack, mixpanel } from './mixpanel';\n\nexport function Telemetry() {\n  const settings = useAtomValue(appSettingAtom);\n  useLayoutEffect(() => {\n    if (settings.enableTelemetry === false) {\n      mixpanel.opt_out_tracking();\n      return;\n    } else {\n      return enableAutoTrack(document.body, mixpanel.track);\n    }\n  }, [settings.enableTelemetry]);\n  return null;\n}\n","import '@affine/component/theme/global.css';\nimport '@affine/component/theme/theme.css';\n\nimport { NotificationCenter } from '@affine/component';\nimport { AffineContext } from '@affine/component/context';\nimport { GlobalLoading } from '@affine/component/global-loading';\nimport { AppFallback } from '@affine/core/components/affine/app-container';\nimport { configureCommonModules } from '@affine/core/modules';\nimport { configureLocalStorageStateStorageImpls } from '@affine/core/modules/storage';\nimport { CustomThemeModifier } from '@affine/core/modules/theme-editor';\nimport { configureBrowserWorkbenchModule } from '@affine/core/modules/workbench';\nimport {\n  configureBrowserWorkspaceFlavours,\n  configureIndexedDBWorkspaceEngineStorageProvider,\n} from '@affine/core/modules/workspace-engine';\nimport { router } from '@affine/core/router';\nimport {\n  performanceLogger,\n  performanceRenderLogger,\n} from '@affine/core/shared';\nimport { Telemetry } from '@affine/core/telemetry';\nimport createEmotionCache from '@affine/core/utils/create-emotion-cache';\nimport { createI18n, setUpLanguage } from '@affine/i18n';\nimport { CacheProvider } from '@emotion/react';\nimport {\n  Framework,\n  FrameworkRoot,\n  getCurrentStore,\n  LifecycleService,\n} from '@toeverything/infra';\nimport type { PropsWithChildren, ReactElement } from 'react';\nimport { lazy, Suspense } from 'react';\nimport { RouterProvider } from 'react-router-dom';\n\nif (!environment.isBrowser && environment.isDebug) {\n  document.body.innerHTML = `<h1 style=\"color:red;font-size:5rem;text-align:center;\">Don't run web entry in electron.</h1>`;\n  throw new Error('Wrong distribution');\n}\n\nconst performanceI18nLogger = performanceLogger.namespace('i18n');\nconst cache = createEmotionCache();\n\nconst DevTools = lazy(() =>\n  import('jotai-devtools').then(m => ({ default: m.DevTools }))\n);\n\nconst DebugProvider = ({ children }: PropsWithChildren): ReactElement => {\n  return (\n    <>\n      <Suspense>{process.env.DEBUG_JOTAI === 'true' && <DevTools />}</Suspense>\n      {children}\n    </>\n  );\n};\n\nconst future = {\n  v7_startTransition: true,\n} as const;\n\nasync function loadLanguage() {\n  performanceI18nLogger.info('start');\n\n  const i18n = createI18n();\n  document.documentElement.lang = i18n.language;\n\n  performanceI18nLogger.info('set up');\n  await setUpLanguage(i18n);\n  performanceI18nLogger.info('done');\n}\n\nlet languageLoadingPromise: Promise<void> | null = null;\n\nconst framework = new Framework();\nconfigureCommonModules(framework);\nconfigureBrowserWorkbenchModule(framework);\nconfigureLocalStorageStateStorageImpls(framework);\nconfigureBrowserWorkspaceFlavours(framework);\nconfigureIndexedDBWorkspaceEngineStorageProvider(framework);\nconst frameworkProvider = framework.provider();\n\n// setup application lifecycle events, and emit application start event\nwindow.addEventListener('focus', () => {\n  frameworkProvider.get(LifecycleService).applicationFocus();\n});\nframeworkProvider.get(LifecycleService).applicationStart();\n\nexport function App() {\n  performanceRenderLogger.debug('App');\n\n  if (!languageLoadingPromise) {\n    languageLoadingPromise = loadLanguage().catch(console.error);\n  }\n\n  return (\n    <Suspense>\n      <FrameworkRoot framework={frameworkProvider}>\n        <CacheProvider value={cache}>\n          <AffineContext store={getCurrentStore()}>\n            <Telemetry />\n            <CustomThemeModifier />\n            <DebugProvider>\n              <GlobalLoading />\n              <NotificationCenter />\n              <RouterProvider\n                fallbackElement={<AppFallback key=\"RouterFallback\" />}\n                router={router}\n                future={future}\n              />\n            </DebugProvider>\n          </AffineContext>\n        </CacheProvider>\n      </FrameworkRoot>\n    </Suspense>\n  );\n}\n","import { configureQuotaModule } from '@affine/core/modules/quota';\nimport { configureInfraModules, type Framework } from '@toeverything/infra';\n\nimport { configureCloudModule } from './cloud';\nimport { configureCollectionModule } from './collection';\nimport { configureDocLinksModule } from './doc-link';\nimport { configureDocsSearchModule } from './docs-search';\nimport { configureExplorerModule } from './explorer';\nimport { configureFavoriteModule } from './favorite';\nimport { configureFindInPageModule } from './find-in-page';\nimport { configureNavigationModule } from './navigation';\nimport { configureOrganizeModule } from './organize';\nimport { configurePeekViewModule } from './peek-view';\nimport { configurePermissionsModule } from './permissions';\nimport { configureWorkspacePropertiesModule } from './properties';\nimport { configureQuickSearchModule } from './quicksearch';\nimport { configureShareDocsModule } from './share-doc';\nimport { configureTagModule } from './tag';\nimport { configureTelemetryModule } from './telemetry';\nimport { configureThemeEditorModule } from './theme-editor';\n\nexport function configureCommonModules(framework: Framework) {\n  configureInfraModules(framework);\n  configureCollectionModule(framework);\n  configureNavigationModule(framework);\n  configureTagModule(framework);\n  configureWorkspacePropertiesModule(framework);\n  configureCloudModule(framework);\n  configureQuotaModule(framework);\n  configurePermissionsModule(framework);\n  configureShareDocsModule(framework);\n  configureTelemetryModule(framework);\n  configureFindInPageModule(framework);\n  configurePeekViewModule(framework);\n  configureQuickSearchModule(framework);\n  configureDocsSearchModule(framework);\n  configureDocLinksModule(framework);\n  configureOrganizeModule(framework);\n  configureFavoriteModule(framework);\n  configureExplorerModule(framework);\n  configureThemeEditorModule(framework);\n}\n","export * from './app-config-storage';\nexport * from './atom';\nexport * from './blocksuite';\nexport * from './framework';\nexport * from './initialization';\nexport * from './livedata';\nexport * from './modules/db';\nexport * from './modules/doc';\nexport * from './modules/global-context';\nexport * from './modules/lifecycle';\nexport * from './modules/storage';\nexport * from './modules/workspace';\nexport * from './storage';\nexport * from './sync';\nexport * from './utils';\n\nimport type { Framework } from './framework';\nimport { configureWorkspaceDBModule } from './modules/db';\nimport { configureDocModule } from './modules/doc';\nimport { configureGlobalContextModule } from './modules/global-context';\nimport { configureLifecycleModule } from './modules/lifecycle';\nimport {\n  configureGlobalStorageModule,\n  configureTestingGlobalStorage,\n} from './modules/storage';\nimport {\n  configureTestingWorkspaceProvider,\n  configureWorkspaceModule,\n} from './modules/workspace';\n\nexport function configureInfraModules(framework: Framework) {\n  configureWorkspaceModule(framework);\n  configureDocModule(framework);\n  configureWorkspaceDBModule(framework);\n  configureGlobalStorageModule(framework);\n  configureGlobalContextModule(framework);\n  configureLifecycleModule(framework);\n}\n\nexport function configureTestingInfraModules(framework: Framework) {\n  configureTestingGlobalStorage(framework);\n  configureTestingWorkspaceProvider(framework);\n}\n","export type { WorkspaceProfileInfo } from './entities/profile';\nexport { Workspace } from './entities/workspace';\nexport { WorkspaceEngineBeforeStart } from './events';\nexport { globalBlockSuiteSchema } from './global-schema';\nexport type { WorkspaceMetadata } from './metadata';\nexport type { WorkspaceOpenOptions } from './open-options';\nexport type { WorkspaceEngineProvider } from './providers/flavour';\nexport { WorkspaceFlavourProvider } from './providers/flavour';\nexport { WorkspaceLocalCache, WorkspaceLocalState } from './providers/storage';\nexport { WorkspaceScope } from './scopes/workspace';\nexport { WorkspaceService } from './services/workspace';\nexport { WorkspacesService } from './services/workspaces';\n\nimport type { Framework } from '../../framework';\nimport { GlobalCache, GlobalState } from '../storage';\nimport { WorkspaceEngine } from './entities/engine';\nimport { WorkspaceList } from './entities/list';\nimport { WorkspaceProfile } from './entities/profile';\nimport { WorkspaceUpgrade } from './entities/upgrade';\nimport { Workspace } from './entities/workspace';\nimport {\n  WorkspaceLocalCacheImpl,\n  WorkspaceLocalStateImpl,\n} from './impls/storage';\nimport { WorkspaceFlavourProvider } from './providers/flavour';\nimport { WorkspaceLocalCache, WorkspaceLocalState } from './providers/storage';\nimport { WorkspaceScope } from './scopes/workspace';\nimport { WorkspaceDestroyService } from './services/destroy';\nimport { WorkspaceEngineService } from './services/engine';\nimport { WorkspaceFactoryService } from './services/factory';\nimport { WorkspaceListService } from './services/list';\nimport { WorkspaceProfileService } from './services/profile';\nimport { WorkspaceRepositoryService } from './services/repo';\nimport { WorkspaceTransformService } from './services/transform';\nimport { WorkspaceUpgradeService } from './services/upgrade';\nimport { WorkspaceService } from './services/workspace';\nimport { WorkspacesService } from './services/workspaces';\nimport { WorkspaceProfileCacheStore } from './stores/profile-cache';\nimport { TestingWorkspaceLocalProvider } from './testing/testing-provider';\n\nexport function configureWorkspaceModule(framework: Framework) {\n  framework\n    .service(WorkspacesService, [\n      [WorkspaceFlavourProvider],\n      WorkspaceListService,\n      WorkspaceProfileService,\n      WorkspaceTransformService,\n      WorkspaceRepositoryService,\n      WorkspaceFactoryService,\n      WorkspaceDestroyService,\n    ])\n    .service(WorkspaceDestroyService, [[WorkspaceFlavourProvider]])\n    .service(WorkspaceListService)\n    .entity(WorkspaceList, [[WorkspaceFlavourProvider]])\n    .service(WorkspaceProfileService)\n    .store(WorkspaceProfileCacheStore, [GlobalCache])\n    .entity(WorkspaceProfile, [\n      WorkspaceProfileCacheStore,\n      [WorkspaceFlavourProvider],\n    ])\n    .service(WorkspaceFactoryService, [[WorkspaceFlavourProvider]])\n    .service(WorkspaceTransformService, [\n      WorkspaceFactoryService,\n      WorkspaceDestroyService,\n    ])\n    .service(WorkspaceRepositoryService, [\n      [WorkspaceFlavourProvider],\n      WorkspaceProfileService,\n    ])\n    .scope(WorkspaceScope)\n    .service(WorkspaceService)\n    .entity(Workspace, [WorkspaceScope])\n    .service(WorkspaceEngineService, [WorkspaceScope])\n    .entity(WorkspaceEngine, [WorkspaceService])\n    .service(WorkspaceUpgradeService)\n    .entity(WorkspaceUpgrade, [\n      WorkspaceService,\n      WorkspaceFactoryService,\n      WorkspaceDestroyService,\n    ])\n    .impl(WorkspaceLocalState, WorkspaceLocalStateImpl, [\n      WorkspaceService,\n      GlobalState,\n    ])\n    .impl(WorkspaceLocalCache, WorkspaceLocalCacheImpl, [\n      WorkspaceService,\n      GlobalCache,\n    ]);\n}\n\nexport function configureTestingWorkspaceProvider(framework: Framework) {\n  framework.impl(\n    WorkspaceFlavourProvider('LOCAL'),\n    TestingWorkspaceLocalProvider,\n    [GlobalState]\n  );\n}\n","export { Doc } from './entities/doc';\nexport type { DocMode } from './entities/record';\nexport { DocRecord } from './entities/record';\nexport { DocRecordList } from './entities/record-list';\nexport { DocScope } from './scopes/doc';\nexport { DocService } from './services/doc';\nexport { DocsService } from './services/docs';\n\nimport type { Framework } from '../../framework';\nimport {\n  WorkspaceLocalState,\n  WorkspaceScope,\n  WorkspaceService,\n} from '../workspace';\nimport { Doc } from './entities/doc';\nimport { DocRecord } from './entities/record';\nimport { DocRecordList } from './entities/record-list';\nimport { DocScope } from './scopes/doc';\nimport { DocService } from './services/doc';\nimport { DocsService } from './services/docs';\nimport { DocsStore } from './stores/docs';\n\nexport function configureDocModule(framework: Framework) {\n  framework\n    .scope(WorkspaceScope)\n    .service(DocsService, [DocsStore])\n    .store(DocsStore, [WorkspaceService, WorkspaceLocalState])\n    .entity(DocRecord, [DocsStore])\n    .entity(DocRecordList, [DocsStore])\n    .scope(DocScope)\n    .entity(Doc, [DocScope, DocsStore])\n    .service(DocService);\n}\n","import type { Framework } from '../../framework';\nimport { WorkspaceScope, WorkspaceService } from '../workspace';\nimport { DB } from './entities/db';\nimport { Table } from './entities/table';\nimport { WorkspaceDBService } from './services/db';\n\nexport { AFFiNE_WORKSPACE_DB_SCHEMA } from './schema';\nexport { WorkspaceDBService } from './services/db';\nexport { transformWorkspaceDBLocalToCloud } from './services/db';\n\nexport function configureWorkspaceDBModule(framework: Framework) {\n  framework\n    .scope(WorkspaceScope)\n    .service(WorkspaceDBService, [WorkspaceService])\n    .entity(DB)\n    .entity(Table, [WorkspaceService]);\n}\n","export { GlobalContextService } from './services/global-context';\n\nimport type { Framework } from '../../framework';\nimport { GlobalContext } from './entities/global-context';\nimport { GlobalContextService } from './services/global-context';\n\nexport function configureGlobalContextModule(framework: Framework) {\n  framework.service(GlobalContextService).entity(GlobalContext);\n}\n","import type { Framework } from '../../framework';\nimport { LifecycleService } from './service/lifecycle';\n\nexport {\n  ApplicationFocused,\n  ApplicationStarted,\n  LifecycleService,\n} from './service/lifecycle';\n\nexport function configureLifecycleModule(framework: Framework) {\n  framework.service(LifecycleService);\n}\n","import { type Framework, GlobalContextService } from '@toeverything/infra';\n\nimport { AuthService } from '../cloud';\nimport { TelemetryService } from './services/telemetry';\n\nexport function configureTelemetryModule(framework: Framework) {\n  framework.service(TelemetryService, [AuthService, GlobalContextService]);\n}\n","import type { Framework } from '@toeverything/infra';\n\nimport { FindInPage } from './entities/find-in-page';\nimport { FindInPageService } from './services/find-in-page';\n\nexport function configureFindInPageModule(framework: Framework) {\n  framework.service(FindInPageService).entity(FindInPage);\n}\n","import { type Framework, GlobalCache, GlobalState } from '@toeverything/infra';\n\nimport { ElectronGlobalCache, ElectronGlobalState } from './impls/electron';\nimport {\n  LocalStorageGlobalCache,\n  LocalStorageGlobalState,\n} from './impls/local-storage';\n\nexport function configureLocalStorageStateStorageImpls(framework: Framework) {\n  framework.impl(GlobalCache, LocalStorageGlobalCache);\n  framework.impl(GlobalState, LocalStorageGlobalState);\n}\n\nexport function configureElectronStateStorageImpls(framework: Framework) {\n  framework.impl(GlobalCache, ElectronGlobalCache);\n  framework.impl(GlobalState, ElectronGlobalState);\n}\n","import './polyfill/dispose';\nimport './polyfill/intl-segmenter';\nimport './polyfill/promise-with-resolvers';\nimport './polyfill/request-idle-callback';\nimport '@affine/core/bootstrap/preload';\n\nimport { performanceLogger } from '@affine/core/shared';\nimport { isDesktop } from '@affine/env/constant';\nimport {\n  init,\n  reactRouterV6BrowserTracingIntegration,\n  setTags,\n} from '@sentry/react';\nimport { StrictMode, useEffect } from 'react';\nimport { createRoot } from 'react-dom/client';\nimport {\n  createRoutesFromChildren,\n  matchRoutes,\n  useLocation,\n  useNavigationType,\n} from 'react-router-dom';\n\nimport { App } from './app';\n\nconst performanceMainLogger = performanceLogger.namespace('main');\nfunction main() {\n  performanceMainLogger.info('start');\n\n  // skip bootstrap setup for desktop onboarding\n  if (isDesktop && window.appInfo?.windowName === 'onboarding') {\n    performanceMainLogger.info('skip setup');\n  } else {\n    performanceMainLogger.info('setup start');\n    if (window.SENTRY_RELEASE || environment.isDebug) {\n      // https://docs.sentry.io/platforms/javascript/guides/react/#configure\n      init({\n        dsn: process.env.SENTRY_DSN,\n        environment: process.env.BUILD_TYPE ?? 'development',\n        integrations: [\n          reactRouterV6BrowserTracingIntegration({\n            useEffect,\n            useLocation,\n            useNavigationType,\n            createRoutesFromChildren,\n            matchRoutes,\n          }),\n        ],\n      });\n      setTags({\n        appVersion: runtimeConfig.appVersion,\n        editorVersion: runtimeConfig.editorVersion,\n      });\n    }\n    performanceMainLogger.info('setup done');\n  }\n\n  mountApp();\n}\n\nfunction mountApp() {\n  performanceMainLogger.info('import app');\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  const root = document.getElementById('app')!;\n  performanceMainLogger.info('render app');\n  createRoot(root).render(\n    <StrictMode>\n      <App />\n    </StrictMode>\n  );\n}\n\ntry {\n  main();\n} catch (err) {\n  console.error('Failed to bootstrap app', err);\n}\n","if (Intl.Segmenter === undefined) {\n  await import('intl-segmenter-polyfill-rs').then(({ Segmenter }) => {\n    Object.defineProperty(Intl, 'Segmenter', {\n      value: Segmenter,\n      configurable: true,\n      writable: true,\n    });\n  });\n}\n\nexport {};\n","window.requestIdleCallback =\n  window.requestIdleCallback ||\n  function (cb) {\n    const start = Date.now();\n    return setTimeout(function () {\n      cb({\n        didTimeout: false,\n        timeRemaining: function () {\n          return Math.max(0, 50 - (Date.now() - start));\n        },\n      });\n    }, 1);\n  };\n\nwindow.cancelIdleCallback =\n  window.cancelIdleCallback ||\n  function (id) {\n    clearTimeout(id);\n  };\n"],"names":["authMessage","authModalContent","captchaWrapper","forgetPasswordButtonRow","linkButton","resendCountdown","resendWrapper","sendMagicLinkButtonRow","sentMessage","sentRow","userPlanButton","addPropertyButton","backlinksList","checkboxProperty","collapsedIcon","menuHeader","menuItemList","menuItemListScrollable","menuItemListScrollbar","pageInfoDimmed","propertyRow","propertyRowIconContainer","propertyRowName","propertyRowNameCell","propertyRowNameContainer","propertyRowNamePopupRow","propertyRowTypeItem","propertyRowValueCell","propertyRowValueNumberCell","propertyRowValueTextCell","propertyRowValueTextarea","propertyRowValueTextareaInvisible","propertySettingRow","propertyTypeName","root","rootCentered","selectorButton","sortablePropertyRowNameCell","tableBodyRoot","tableBodySortable","tableHeader","tableHeaderBacklinksHint","tableHeaderCollapseButtonWrapper","tableHeaderDivider","tableHeaderInfoRow","tableHeaderSecondaryRow","tableHeaderTimestamp","tagsPropertyRow","argStyle","ellipsisTextStyle","filterContainerStyle","filterItemCloseStyle","filterItemStyle","filterTypeIconStyle","filterTypeStyle","inputStyle","menuItemStyle","menuItemTextStyle","switchStyle","variableSelectTitleStyle","colWrapper","deleteButton","deleteIcon","editTagWrapper","favoriteCell","groupsContainer","heading","hideInSmallContainer","pageListScrollContainer","actionButton","bottomLeft","collectionEditContainer","ellipsis","includeItem","includeItemContent","includeItemContentIs","includeItemTitle","includeListTitle","includeTitle","pageList","pagesTab","pagesTabContent","previewCountTips","previewCountTipsHighlight","resultPages","rulesBottom","rulesContainer","rulesContainerLeft","rulesContainerLeftContent","rulesContainerLeftContentInclude","rulesContainerLeftTab","rulesContainerRight","rulesTitle","rulesTitleHighlight","SESSION_KEY","window","location","search","includes","sessionStorage","setItem","getItem","debug","console","warn","DebugLogger","constructor","namespace","_debug","enabled","message","args","log","info","error","level","bind","toUpperCase","extra","currentNamespace","isBrowser","isServer","navigator","isDesktop","appInfo","electron","DEFAULT_WORKSPACE_NAME","UNTITLED_WORKSPACE_NAME","DEFAULT_SORT_KEY","MessageCode","loginError","noPermission","loadListFailed","getDetailFailed","createWorkspaceFailed","getMembersFailed","updateWorkspaceFailed","deleteWorkspaceFailed","inviteMemberFailed","removeMemberFailed","acceptInvitingFailed","getBlobFailed","leaveWorkspaceFailed","downloadWorkspaceFailed","refreshTokenError","blobTooLarge","PageNotFoundError","TypeError","docCollection","pageId","Unreachable","Error","UaHelper","isLinux","isMacOs","isSafari","isWindows","isFireFox","isMobile","isChrome","isIOS","getChromeVersion","raw","userAgent","match","parseInt","uaMap","getUa","initUaFlags","checkUseragent","isUseragent","Boolean","ua","uas","toLowerCase","mobile","test","android","indexOf","ios","mac","iphone","wx","chrome","tiktok","weibo","safari","firefox","ipad","win","linux","runtimeFlagsSchema","z","object","serverUrlPrefix","string","appVersion","editorVersion","appBuildType","union","literal","isSelfHosted","boolean","optional","githubUrl","changelogUrl","downloadUrl","imageProxyUrl","linkPreviewUrl","allowLocalWorkspace","enablePreloading","enableNewSettingUnstableApi","enableCaptcha","enableEnhanceShareMode","enableExperimentalFeature","enableInfoModal","enableOrganize","enableThemeEditor","setupGlobal","environment","globalThis","$AFFINE_SETUP","parse","runtimeConfig","isDebug","process","uaHelper","origin","assertEquals","chromeVersion","WorkspaceFlavour","rootStore","createStore","getCurrentStore","logger","windowFrameStyleOptions","dateFormatOptions","fontStyleOptions","key","value","appSettingBaseAtom","atomWithStorage","clientBorder","fullWidthLayout","windowFrameStyle","fontStyle","dateFormat","startWeekOnMonday","enableBlurBackground","enableNoisyBackground","autoCheckUpdate","autoDownloadUpdate","enableTelemetry","enableMultiView","editorFlags","setupEditorFlags","store","syncEditorFlags","get","Object","entries","forEach","awarenessStore","setFlag","blocksuiteFeatureFlags","undefined","defaultState","err","sub","appSettingEffect","atomEffect","settings","apis","updater","setConfig","catch","appSettingAtom","atom","_get","set","apply","prev","next","isNotStableBuild","neverShow","enable_database_attachment_note","displayName","description","precondition","enable_database_statistics","enable_block_query","enable_synced_doc_block","enable_edgeless_text","enable_color_picker","enable_ai_chat_block","enable_ai_onboarding","enable_expand_database_block","affineFeatureFlags","feedbackType","Symbol","dispose","Component","eventBus","framework","CONSTRUCTOR_CONTEXT","current","provider","props","Entity","__isEntity","Scope","collection","scope","getAll","getOptional","createEntity","createScope","emitEvent","__injectable","Service","__isService","Store","__isStore","withContext","cb","context","pre","DEFAULT_VARIANT","ROOT_SCOPE","SUB_COMPONENTS","RecursionLimitError","CircularDependencyError","stringifyDependencyStack","dependencyStack","ComponentNotFoundError","stringifyIdentifier","identifier","MissingDependencyError","target","from","DuplicateDefinitionError","identifierName","variant","map","join","createEvent","id","_type","EventBus","handler","parent","listeners","handlers","EventHandler","sameScope","values","on","event","listener","push","off","filter","l","emit","payload","e","createIdentifier","OnEvent","pick","name","stableHash","factory","i","FrameworkProvider","options","getRaw","parseIdentifier","getAllRaw","noCache","newProvider","ComponentCachePool","getOrInsert","insert","cache","Map","has","cached","t","setImmediate","Resolver","depth","stack","getFactory","runFactory","nextResolver","track","vars","getFactoryAll","result","service","find","BasicFrameworkProvider","disposed","resolver","stringifyScope","Framework","EMPTY","componentCount","count","identifiers","components","variants","size","FrameworkEditor","impl","entity","override","addValue","addFactory","normalizedScope","normalizedIdentifier","normalizedVariant","services","remove","delete","clone","di","s","currentScopeStack","arg2","Function","Array","dependenciesToFactory","arg3","cls","deps","dep","isAll","isArray","length","isConstructor","Reflect","construct","assign","input","FrameworkStackContext","React","useFramework","useContext","useService","useServices","charAt","slice","useServiceOptional","FrameworkRoot","children","Provider","FrameworkScope","nextStack","useMemo","MountPoint","ScopeRootComponentsContext","nodes","setNodes","_id","useMount","unmount","mount","node","debugKey","div","data-testid","style","display","initEmptyPage","page","title","load","pageBlockId","addBlock","Text","noteBlockId","history","clear","effect","subject$","Subject","effectLocation","split","trim","EffectError","subscription","pipe","subscribe","complete","effectError","fn","unsubscribe","observable","LiveData","Observable","upstream$","initialValue","stream$","mergeMap","v","of","scan","acc","op","distinctUntilChanged","switchMap","GLOBAL_COMPUTED_RECURSIVE_COUNT","computed","compute","execute","subscriptions","first","data$","looper","upstream","ops$","isPoisoned","poisonedError","getValue","raw$","setValue","reactSubscribe","skip","add","reactGetSnapshot","Promise","resolve","then","BehaviorSubject","upstreamSubscription","closed","PoisonedError","observerOrNext","mapper","sub$","subscriber","comparator","throttleTime","duration","trailing","leading","asObservable","flat","combineLatest","waitFor","predicate","signal","reject","addEventListener","reason","waitForNonNull","_subscribe","originalError","mapInto","l$","catchErrorInto","onComplete","catchError","onStart","observable$","fromPromise","promise","abortController","AbortController","rawPromise","abort","MANUALLY_STOP","backoffRetry","when","delay","maxDelay","obs$","retry","retryIndex","throwError","d","Math","pow","timer","min","exhaustMapSwitchUntilChanged","project","onSwitch","connect","shared$","merge","exhaustMap","index","noopSubscribe","nullGetSnapshot","undefinedGetSnapshot","useLiveData","liveData","useSyncExternalStore","useEnsureLiveData","liveData$","data","use","DB","db","schema","tableName","table","Table","storageDocId","defineProperty","workspaceService","isSyncing$","workspace","engine","doc","docState$","docState","syncing","isLoading$","loading","create","update","get$","find$","keys","inputType","val","typeMatches","typeWant","typeGet","dataValidators","PrimaryKeyShouldExist","validate","keyField","PrimaryKeyShouldNotBeUpdated","DataTypeShouldMatch","field","type","DataTypeShouldExactlyMatch","Set","lodashPick","createEntityDataValidators","updateEntityDataValidators","PRESERVED_FIELDS","rules","errors","code","validator","throwIfError","validators","validateTableSchema","some","isPrimaryKey","OnlyOnePrimaryKey","primaryFields","PrimaryKeyShouldNotBeOptional","opts","default","validateCreateEntityData","validateUpdateEntityData","validateYjsTableSchema","UsePreservedFields","validateYjsEntityData","SetPreservedFields","subscribedKeys","adapter","reduce","fieldName","fieldBuilder","setup","omitBy","isUndefined","record","where","byKey","ob$","observe","callback","shareReplay","refCount","bufferSize","select","keys$","ORMClient","hooksMap","tables","tableSchema","hooks","defineHook","_desc","hook","createORMClient","Class","deserialize","toObject","YjsTableAdapter","deleteFlagKey","fields","destroy","query","getMap","toString","transact","results","iterate","setField","records","listeningOnAll","keyof","ob","hasChanged","ty","tx","changed","isMatch","isDeleted","prevMatch","isPrevMatched","newValue","deleteTy","YMap","prototype","toJSON","call","recordByKey","share","selectedFields","isEmpty","every","c","_map","YjsDBAdapter","getDoc","FieldSchemaBuilder","primaryKey","f","AFFiNE_WORKSPACE_DB_SCHEMA","folders","nanoid","parentId","AFFiNE_WORKSPACE_USERDATA_DB_SCHEMA","favorite","WorkspaceDBClient","WorkspaceUserdataDBClient","WorkspaceDBService","userdataDBPool","ObjectPool","onDangling","guid","ydoc","YDoc","addDoc","setPriority","userdataDB","userId","userdataDb","obj","newDB","put","isDBDocId","docId","startsWith","transformWorkspaceDBLocalToCloud","localWorkspaceId","cloudWorkspaceId","localDocStorage","cloudDocStorage","accountId","localDocName","localDoc","cloudDocName","Doc","blockSuiteDoc","meta$","mode$","title$","trash$","setMode","mode","getMode","toggleMode","observeMode","moveToTrash","restoreFromTrash","waitForSyncReady","waitForDocLoadReady","setPriorityLoad","priority","DocRecordList","pool","docs$","watchDocIds","ids","exists","DocRecord","trashDocs$","watchTrashDocIds","isReady$","watchDocListReady","doc$","setDocModeSetting","getDocModeSetting","watchDocModeSetting","docsStore","watchDocMeta","meta","trash","setMeta","setDocMeta","DocScope","DocService","DocsService","list","onDelete","open","docRecord","getBlockSuiteDoc","release","docScope","createDoc","createBlockSuiteDoc","markDocSyncStateAsReady","addLinkedDoc","targetDocId","linkedDocId","text","fromDelta","attributes","reference","frame","getBlocksByFlavour","changeDocTitle","newTitle","pageBlock","at","model","GlobalContext","define","memento","$","watch","MemoryMemento","workspaceId","isDoc","isTrashDoc","docMode","isCollection","collectionId","isTrash","isTag","tagId","isAllDocs","GlobalContextService","globalContext","ApplicationStarted","ApplicationFocused","LifecycleService","applicationStart","applicationFocus","GlobalState","GlobalCache","GlobalStateService","globalState","GlobalCacheService","globalCache","PriorityQueue","oldPriority","priorityMap","tree","pop","max","removeNode","removed","updatePriority","BinarySearchTree","a","b","AsyncPriorityQueue","asyncPop","_waitForUpdate","_resolveUpdate","race","_","aborted","DOC_ENGINE_ORIGIN","DocEngineLocalPart","ready","status","readyDocs","connectedDocs","jobMap","currentJob","statusUpdatedSubject$","updatedId","clientId","storage","prioritySettings","docs","jobDocQueue","engineState$","total","actions","schedule","markAsReady","jobs","job","existingData","encodeStateAsUpdate","isEmptyUpdate","handleDocUpdate","docData","loadDocFromLocal","applyUpdate","save","merged","mergeUpdates","j","newSeqNum","commitDocAsClientUpdate","seqNum","throwIfAborted","isInitialize","events","ServerUpdateCommitted","ClientUpdateCommitted","mainLoop","groupBy","applyJob","existingJobs","ClockMap","setIfBigger","DocEngineRemotePart","server","serverClocks","retrying","errorMessage","pushedSeqNum","loadDocSeqNumPushed","loadDocSeqNum","pullAndPush","pulled","loadDocServerClockPulled","normalizeServerDocId","pull","maxSeqNum","serverClock","pushDoc","saveDocPushedSeqNum","stateVector","encodeStateVectorFromUpdate","Uint8Array","serverData","pullDoc","newData","serverStateVector","saveServerClock","updateServerClock","commitDocAsServerUpdate","diff","diffUpdate","saveDocServerClockPulled","serverDoc","retryLoop","setTimeout","disposes","onInterrupted","waitForConnectingServer","subscribeAllDocs","loadServerClock","maxClockValue","newClocks","disconnectServer","DocVariant","parts","DocEngine","localState$","localPart","remoteState$","remotePart","localState","remoteState","saving","DocStorageInner","start","all","stop","resetSyncStatus","clearSyncMetadata","clearServerClock","withSubDocs","subdoc","getSubdocs","added","waitForSaved","state","saved","waitForSynced","synced","waitForReady","AwarenessEngine","connections","awareness","connection","disconnect","WorkspaceEngine","engineProvider","getDocStorage","getDocServer","blob","BlobEngine","getLocalBlobStorage","getRemoteBlobStorages","getAwarenessConnections","docEngineState$","rootDocState$","setRootDoc","yDoc","WorkspaceEngineBeforeStart","canGracefulStop","waitForGracefulStop","forceStop","waitForDocSynced","waitForRootDocReady","checkWorkspaceCompatibility","isCloud","spaceMetaObj","docKeys","haveSpaceMeta","haveLegacySpace","hasVersion","validateVersion","flavour","version","blockVersions","flavourSchemaMap","MigrationPoint","migrationOrigin","upgradeV1ToV2","oldDoc","targetDoc","newDoc","migrateToSubdoc","idMap","migrateMeta","originalMeta","originalVersions","originalPages","pages","YArray","updateBlockVersions","versions","frameVersion","embedVersion","databaseVersion","mapList","migrateBlocks","spaces","newId","spaceId","originalBlocks","blocks","blockData","runBlockMigration","elements","migrateSurface","migrateSurfaceConnector","controllers","xywh","JSON","position","x","y","width","color","migrateDatabase","columns","views","col","hide","conditions","cells","convertColumn","row","newColumns","selection","cell","Number","parseFloat","getLatestVersions","migratePages","rootDoc","oldVersions","upgradeDoc","space","upgradeCollection","pageVersion","newVersions","migrateGuidCompatibility","newPageId","WorkspaceUpgrade","workspaceFactory","workspaceDestroy","needUpgrade$","upgrading$","checkIfNeedUpgrade","needUpgrade","AFFINE_CLOUD","upgrade","step","clonedDoc","applyDoc","SubDoc","newWorkspace","LOCAL","blobStorage","blobKey","forceUpgradePages","blobSync","deleteWorkspace","GuidFix","BlockVersion","targetSubDoc","subdocs","resultSubDoc","resultSubDocs","item","Workspace","openOptions","metadata","_docCollection","name$","commonFieldsUpdated","avatar$","avatar","DocCollection","blobSources","main","idGenerator","globalBlockSuiteSchema","disableBacklinkIndex","disableSearchIndex","rootYDoc","WorkspaceEngineService","WorkspaceUpgradeService","flavourProvider","Schema","schemas","AffineSchemas","AIChatBlockSchema","register","WorkspaceFlavourProvider","WorkspaceLocalState","WorkspaceLocalCache","WorkspaceScope","_engine","workspaceScope","getEngineProvider","WorkspaceService","_workspace","WorkspacesService","listService","providers","profileRepo","transform","workspaceRepo","getProfile","transformLocalToCloud","getWorkspaceBlob","setAll","init","getLiveData","v$","k","del","wrapMemento","prefix","local","remotes","readonly","isStorageOverCapacity$","singleBlobSizeLimit","onAbortLargeBlob","Slot","abortSignal","sync","finally","storages","remote","localList","remoteList","difference","BlobStorageOverCapacity","allSettled","r","peer","_key","blobList","EmptyBlobStorage","_value","originError","AsyncLock","acquire","nextLock","_lock","MemoryByteKV","lock","transaction","u","ReadonlyByteKV","MemoryDocEventBus","DocEventBusInner","eventBusBehavior","Keys","SeqNum","SeqNumPushed","ServerClockPulled","Values","UInt64","view","DataView","buffer","getBigUint64","serialize","ArrayBuffer","setBigUint64","BigInt","behavior","oldBuffer","bytes","syncMetadata","saveDocSeqNum","oldBytes","old","ReadonlyStorage","binary","byteLength","objects","timeoutToGc","exist","rc","released","requestGc","clearInterval","setInterval","gc","arg","isDate","Date","RegExp","counter","sort","stringify","WeakMap","useNavConfig","useI18n","path","DesktopNavbar","config","className","href","rel","MobileNavbar","openMenu","setOpenMenu","useState","navConfig","menuItems","MenuItem","onClick","Menu","items","contentOptions","sideOffset","rootOptions","onOpenChange","IconButton","CloseIcon","PropertyIcon","AffineOtherPageLayout","openDownloadLink","useCallback","Logo1Icon","height","Button","AuthContent","otherProps","clsx","AuthInput","label","errorHint","withoutHint","onEnter","inputProps","Input","onKeyDown","AuthPageContainer","subtitle","p","Empty","BackButton","marginTop","marginLeft","paddingLeft","paddingRight","cssVar","ArrowLeftSmallIcon","ChangeEmailPage","onChangeEmail","propsOnChangeEmail","hasSetUp","setHasSetUp","email","setEmail","isValidEmail","setIsValidEmail","setLoading","onContinue","emailRegex","onEmailChange","styles","placeholder","onChange","disabled","ErrorIcon","svg","viewBox","fill","xmlns","g","fillRule","clipRule","statusWrapper","SuccessIcon","Tag","minimum","maximum","textMap","weak","medium","strong","PASSWORD_STRENGTH_OPTIONS","minDiversity","minLength","PasswordInput","passwordLimits","onPass","onPrevent","setStatus","confirmStatus","setConfirmStatus","canSubmit","setCanSubmit","password","setPassWord","confirmPassword","setConfirmPassword","validationSchema","maxLength","superRefine","ctx","addIssue","ZodIssueCode","custom","params","passwordStrength","validatePasswords","safeParse","success","firstIssue","issues","isEqual","onPasswordChange","onConfirmPasswordChange","useEffect","marginBottom","String","endFix","SetPassword","onLater","onSetPassword","showLater","passwordPass","setPasswordPass","passwordRef","useRef","Wrapper","marginRight","ChangePasswordPage","propsOnSetPassword","onOpenAffine","passWord","notify","ConfirmChangeEmail","formatTime","formattedMinutes","minutes","floor","time","padStart","formattedSeconds","seconds","CountDownRender","forwardRef","timeLeft","ref","AuthModal","setOpen","Modal","minHeight","padding","ModalHeader","subTitle","disableButton","ScrollableLayout","headerItems","isMacosDesktop","isWindowsDesktop","data-is-macos-electron","header","data-is-windows-electron","ScrollableContainer","footer","Divider","orientation","OnboardingPage","user","useLocation","navigate","useNavigate","questionIdx","setQuestionIdx","questions","useSWR","url","fetch","json","suspense","revalidateOnFocus","setOptions","inputs","setInputs","callbackUrl","getCallbackUrl","callbackURL","URLSearchParams","parsedUrl","URL","pathname","question","searchParams","h1","option","optionIndex","Checkbox","labelClassName","checked","itemType","method","body","form","ask","answer","suffix","ArrowRightSmallIcon","SetPasswordPage","SignInPageContainer","SignInSuccessPage","SignUpPage","openButtonText","PublicLinkDisableModal","ConfirmModal","cancelText","confirmText","confirmButtonOptions","globalLoadingEventsBaseAtom","globalLoadingEventsAtom","resolveGlobalLoadingEventAtom","globalLoadingEvent","notification","pushGlobalLoadingEventAtom","newGlobalLoadingEvent","globalLoadingEvents","GlobalLoading","useAtomValue","data-loading","Loading","EditorLoading","Skeleton","animation","PageDetailSkeleton","ResizeHandle","resizing","minWidth","maxWidth","resizeHandlePos","resizeHandleOffset","resizeHandleVerticalPadding","onOpen","onResizing","onWidthChange","rest","onResizeStart","resized","panelContainer","parentElement","assertExists","left","anchorLeft","right","anchorRight","getBoundingClientRect","onMouseMove","preventDefault","clientX","document","removeEventListener","once","assignInlineVars","data-handle-position","data-resizing","data-open","onMouseDown","ResizePanel","floating","enableAnimation","_enableAnimation","unmountOnExit","useEnableAnimation","enable","setEnable","safeWidth","toggle","useTransition","timeout","useLayoutEffect","data-transition-state","data-is-floating","data-enable-animation","WorkspaceAvatar","workspacesService","profile","revalidate","avatarKey","profile$","downloadedAvatar","setDownloadedAvatar","canceled","image","createElement","objectUrl","createObjectURL","src","decode","ratio","naturalWidth","naturalHeight","imageBitmap","createImageBitmap","resizeWidth","resizeHeight","revokeObjectURL","Avatar","useAutoFocus","autoFocus","focus","useAutoSelect","autoSelect","reservedReactProperties","listenedEvents","addOrUpdateEventListener","handleEvent","setProperty","HTMLElement","removeAttribute","createComponent","react","tagName","elementClass","eventProps","ReactComponent","containerRef","prevPropsRef","elementRef","reactProps","elementProps","element","prop","container","append","LitElement","customElement","LitReactPortal","properties","portalId","createRenderRoot","connectedCallback","disconnectedCallback","willUpdate","changedProperties","previousPortalId","useLitPortalFactory","portals","setPortals","elementOrFactory","createLitPortalAnchor","html","newPortals","portal","ReactDOM","LitTemplateWrapper","template","render","TemplateWrapper","toReactNode","calendarHeaderTriggerButton","decadeViewBodyCell","monthViewBodyCell","monthViewRow","gapX","gapY","yearViewBodyCell","DATE_MIN","DATE_MAX","YEAR_MIN","dayjs","year","YEAR_MAX","autoHeight","HeaderLayout","memo","attrs","finalStyle","isLeft","isRight","data-length","data-is-left","data-is-right","CalendarLayout","headerLeft","headerRight","data-mode","DefaultDateCell","date","isToday","notCurrentMonth","selected","focused","button","data-is-date-cell","data-value","format","data-is-today","data-not-current-month","data-selected","tabIndex","NavButtons","prevDisabled","nextDisabled","onPrev","onNext","DayPicker","dayPickerRootRef","headerMonthRef","cursor","weekDays","monthNames","todayLabel","customDayRenderer","onCursorChange","onModeChange","matrix","firstDayOfFirstWeek","firstDayOfMonth","startOf","lastDayOfLastWeek","lastDayOfMonth","endOf","currentDay","isBefore","week","isSame","onNextMonth","onPrevMonth","focusCursor","querySelector","openMonthPicker","openYearPicker","activeElement","hasAttribute","shiftKey","stopPropagation","HeaderLeft","whiteSpace","data-month","month","data-year","HeaderRight","Body","day","MonthPicker","monthCursor","setMonthCursor","closeMonthPicker","onMonthChange","m","nextYear","prevYear","subtract","nextYearDisabled","prevYearDisabled","currentMonth","data-is-month-cell","data-current-month","aria-label","defaultDatePickerProps","YearPicker","yearCursor","setYearCursor","closeYearPicker","onYearChange","nextDecade","prevDecade","decadeIndex","decadeStart","decadeEnd","DECADE","nextDecadeDisabled","isAfter","prevDecadeDisabled","currentYear","isDisabled","aria-disabled","data-is-year-cell","data-current-year","DatePicker","finalProps","setCursor","variables","onPreChange","newCursor","_resizeObserver","elementsMap","_resizeObserverElementsMap","getResizeObserver","ResizeObserver","entry","removeListener","observer","unobserve","observeResize","prevListeners","WeekDatePicker","handleRef","weekRef","dense","setDense","viewPortSize","setViewPortSize","useImperativeHandle","range","cursorIndex","end","allDays","displayDays","nextDay","prevDay","onDayClick","el","contentRect","rect","focusCursorCell","cursorCell","Cell","toISOString","isActive","isCurrentMonth","data-active","data-curr-month","data-today","draggableGet","useDraggable","getOptions","dragging","setDragging","draggingPosition","setDraggingPosition","offsetX","offsetY","clientY","outWindow","dropTarget","setDropTarget","customDragPreviewPortal","setCustomDragPreviewPortal","dragRef","dragHandleRef","enableCustomDragPreview","enableDraggingPosition","enableDropTarget","enableDragging","windowEvent","dragleave","dragover","cleanupDraggable","draggable","dragHandle","canDrag","getInitialData","getInitialDataForExternal","dataForExternal","onDragStart","initial","dataset","onDrop","onDrag","onDropTargetChange","dropTargets","onGenerateDragPreview","nativeSetDragImage","source","disableDragPreview","disableNativeDragPreview","previewPosition","dragPreviewPosition","setCustomNativeDragPreview","getOffset","centerUnderPointer","pointerOutsideOfPreview","preserveOffsetOnSource","flushSync","cloneNode","CustomDragPreview","horizontalIndent","lineBelowStyles","treeLine","getTreeElement","instruction","isBlocked","currentLevel","indentPerLevel","desiredLevel","edgeToOrientationMap","top","bottom","orientationStyles","horizontal","vertical","edgeStyles","DropIndicator","edge","getEdgeElement","gap","lineOffset","desired","dropTargetGet","treeInstruction","extractInstruction","attachInstruction","block","closestEdge","extractClosestEdge","attachClosestEdge","allowedEdges","useDropTarget","dropTargetRef","draggedOver","setDraggedOver","setTreeInstruction","setClosestEdge","dropEffect","setDropEffect","draggedOverDraggable","setDraggedOverDraggable","draggedOverPosition","setDraggedOverPosition","relativeX","relativeY","enableDraggedOver","enableDraggedOverDraggable","enableDraggedOverPosition","enableDropEffect","dropTargetForElements","canDrop","getDropEffect","getIsSticky","isSticky","self","getData","originData","withInstruction","InlineEdit","editable","exitible","trigger","onInput","placeholderClassName","placeholderStyle","inputAttrs","editing","setEditing","editingValue","setEditingValue","inputRef","triggerEdit","onDoubleClick","submit","blur","onBlur","scrollTo","inputHandler","displayValue","replace","inputWrapperInheritsStyles","margin","borderRadius","fontSize","fontFamily","lineHeight","fontWeight","letterSpacing","textAlign","backgroundColor","inputInheritsStyles","data-editing","Placeholder","ErrorMessage","inline","span","AnimatedCollectionsIcon","lottieRef","lottie","setDirection","play","Lottie","autoPlay","loop","animationData","AnimatedDeleteIcon","AnimatedFolderIcon","speed","setSpeed","Popover","content","portalOptions","contentClassName","contentStyle","otherContentOptions","PopoverPrimitive","asChild","align","zIndex","Switch","checkedProp","onChangeProp","checkedState","setCheckedState","newChecked","styled","showBorder","tableLayout","borderCollapse","borderSpacing","thead","background","transition","opacity","proportion","active","boxSizing","verticalAlign","userSelect","textEllipsis","td","borderTopLeftRadius","borderBottomLeftRadius","borderTopRightRadius","borderBottomRightRadius","ToastContainer","htmlToElement","innerHTML","strings","cur","firstChild","createToastContainer","css","animateToastOut","toastElement","createAndShowNewToast","contains","toastStyles","textContent","dispatchEvent","CustomEvent","detail","toast","oldestToast","lineNum","wordBreak","WebkitBoxOrient","WebkitLineClamp","overflow","textOverflow","avatarImage","colorsSchema","ColorfulFallback","char","colors","charCodeAt","topColor","middleColor","bottomColor","isHover","setIsHover","onMouseEnter","onMouseLeave","clearTimeout","propsStyles","colorfulFallback","hoverIcon","fallbackProps","fallbackClassName","imageProps","avatarProps","rounded","onRemove","hoverWrapperProps","hoverWrapperClassName","avatarTooltipOptions","removeTooltipOptions","removeButtonProps","removeButtonClassName","firstCharOfName","containerDom","setContainerDom","removeButtonDom","setRemoveButtonDom","canvas","setCanvas","getContext","drawImageFit","img","centerShift_x","centerShift_y","drawImage","devicePixelRatio","canvasRef","AvatarRoot","Tooltip","withUnit","AvatarImage","alt","AvatarFallback","delayMs","tooltipOptions","IconSlot","icon","visible","showLoadingHere","cloneElement","withoutHover","prefixClassName","prefixStyle","suffixClassName","suffixStyle","tooltip","tooltipShortcut","upstreamRef","handleClick","shortcut","data-block","data-disabled","data-size","data-variant","data-no-hover","DropdownButton","onClickDropDown","ArrowDownSmallIcon","iconClassName","iconStyle","validatedSize","isNaN","data-icon-variant","data-icon-size","RadioGroup","RadioButton","spanStyle","RadixRadioGroup","RadioButtonGroup","unchecked","indeterminate","inputClassName","handleChange","inputElement","playCheckAnimation","role","icons","htmlFor","refElement","sparkingEl","classList","cssText","animate","boxShadow","easing","finished","dividerColor","data-divider","EmptySvg","fillOpacity","circle","cx","cy","containerStyle","descriptionStyle","propsOnChange","noBorder","preFix","focusRef","selectRef","warning","large","shouldForwardProp","weight","paddingTop","paddingBottom","FlexWrapper","justifyContent","alignItems","wrap","flexDirection","flexShrink","flexGrow","flexWrap","progress","sizeWithUnit","strokeWidth","stroke","strokeDasharray","PI","menuContent","noPortal","DropdownMenu","MenuIcon","useMenuItem","propsChildren","propsClassName","danger","DoneIcon","MenuSeparator","MenuSub","subOptions","triggerOptions","otherTriggerOptions","subContentOptions","subContentClassName","otherSubContentOptions","MenuTrigger","getVar","defaultValue","ModalTransitionContainer","child","startViewTransition","pendingTransitionNodes","requestTransition","removeChild","animationFrame","cancelAnimationFrame","requestAnimationFrame","defined","ModalInner","modal","withoutCloseButton","persistent","onPointerDownOutside","onEscapeKeyDown","overlayOptions","overlayClassName","overlayStyle","otherOverlayOptions","closeButtonOptions","closeButtonClassName","otherCloseButtonProps","setContainer","createContainer","customElements","handlePointerDownOutSide","handleEscapeKeyDown","Dialog","data-modal","VisuallyHidden","cancelButtonOptions","reverseFooter","onConfirm","onCancel","autoFocusConfirm","onConfirmClick","modalFooterWithChildren","reverse","DialogTrigger","ConfirmModalContext","createContext","modalProps","openConfirmModal","closeConfirmModal","ConfirmModalProvider","setModalProps","autoClose","onSuccess","_onConfirm","useConfirmModal","defaultContentOptions","defaultOverlayOptions","backdropFilter","OverlayModal","topImage","to","external","withoutCancelButton","handleConfirm","Link","headAlignWrapper","getCardColor","theme","getActionTextColor","getCardForegroundColor","getCardBorderColor","getIconColor","iconColor","getCloseIconColor","NotificationCard","InformationFillDuotoneIcon","thumb","action","alignMessage","onDismiss","rootAttrs","onActionClicked","data-with-icon","buttonProps","data-float","data-align","NotificationCenter","pointerEvents","toastOptions","Toaster","dismiss","SingleSelectSelectSolidIcon","itemHeight","animationDuration","animationEasing","activeItemClassName","activeItemStyle","iconMode","animationTImerRef","finalItems","createRef","indicatorRef","oldValue","oldItem","newItem","oldRect","newRect","activeIndicator","prevValue","previousValue","onValueChange","data-icon-mode","customRender","testId","classMap","forceMount","scrollableContainerRoot","scrollableViewport","scrollbar","scrollbarThumb","ScrollableRoot","ScrollArea","ScrollableViewport","ScrollableScrollbar","Scrollable","Root","Viewport","Scrollbar","useHasScrollTop","hasScrollTop","setHasScrollTop","unsub","updateScrollTop","debounce","scrollTop","showScrollTopBorder","inTableView","_styles","viewPortClassName","scrollBarClassName","data-has-scroll-top","pulse","wave","circular","rectangular","getSize","_width","_height","_style","_className","macOS","getCommand","cmd","TooltipShortcut","commands","side","restContentOptions","TooltipPrimitive","delayDuration","cssVarV2","unit","openCreateWorkspaceModalAtom","openSignOutModalAtom","openQuotaModalAtom","openStarAFFiNEModalAtom","openIssueFeedbackModalAtom","openHistoryTipsModalAtom","openInfoModalAtom","rightSidebarWidthAtom","openSettingModalAtom","activeTab","authAtom","openModal","emailType","allPageFilterSelectAtom","openWorkspaceListModalAtom","WithDisposable","withMargin","AIStarIcon","AIStarIconWithAnimation","SmallHintIcon","AIHelpIcon","AffineIcon","ChatClearIcon","ChatSendIcon","ChatAbortIcon","CurrentSelectionIcon","ImageIcon","SmallImageIcon","DocIcon","DownArrowIcon","ReplaceIcon","InsertBelowIcon","InsertTopIcon","CreateIcon","AffineAvatarIcon","ActionIcon","LanguageIcon","ImproveWritingIcon","AIDoneIcon","ShorterIcon","LongerIcon","ExplainIcon","AIExplainIcon","SelectionIcon","AIExplainSelectionIcon","ToneIcon","AIChangeToneIcon","AISearchIcon","AIImproveWritingIcon","AIMakeLongerIcon","AIMakeShorterIcon","AIMakeRealIcon","AIPenIcon","AIPenIconWithAnimation","AIPresentationIcon","AIPresentationIconWithAnimation","AIMindMapIcon","AIMindMapIconWithAnimation","AIExpandMindMapIcon","AIFindActionsIcon","AIImageIcon","AIImageIconWithAnimation","ChatWithAIIcon","MakeItRealIcon","MakeItRealIconWithAnimation","ArrowDownIcon","ArrowUpIcon","DiscardIcon","ErrorTipIcon","CopyIcon","RetryIcon","MoreIcon","ArticleIcon","MindmapIcon","PreloadImageIcon","PreloadPenIcon","CommunicateIcon","CommentIcon","BlockIcon","EXCLUDING_COPY_ACTIONS","EXCLUDING_INSERT_ACTIONS","IMAGE_ACTIONS","commonImageStages","generatingStages","makeItReal","brainstormMindmap","createSlides","createImage","processImage","filterImage","INSERT_ABOVE_ACTIONS","CustomPageRootService","PageRootService","loadFonts","CustomPageEditorBlockSpecs","PageEditorBlockSpecs","spec","component","updateSnapshotText","point","snapshot","delta","sliceToDelta","getContentFromSlice","host","Job","std","middlewares","titleMiddleware","embedSyncedDocMiddleware","sliceToSnapshot","processTextInSnapshot","processSnapshot","getBlockById","modelId","blockId","childSnapshot","MarkdownAdapter","PlainTextAdapter","fromSliceSnapshot","assets","assetsManager","file","markdownToSnapshot","markdown","defaultImageProxyMiddleware","pasteMiddleware","markdownAdapter","MixTextAdapter","workspaceVersion","toSliceSnapshot","insertFromMarkdown","snapshots","flatMap","models","blockSnapshot","snapshotToBlock","markDownToDoc","initialize","mdAdapter","toDoc","textBlockStyles","ParagraphBlockComponent","ListBlockComponent","DividerBlockComponent","CodeBlockComponent","customHeadingStyles","property","attribute","AIAnswerText","_container","_onWheel","shouldUpdate","_answers","_updateDoc","_timer","_clearTimer","updated","scrollHeight","maxHeight","customHeading","classes","keyed","_doc","renderSpecPortal","_query","viewType","BlockViewType","Display","latestAnswer","blockCollection","disposables","clearQuery","setReadonly","requestUpdate","createTextRenderer","AIProvider","slots","instance","userInfo","userInfoFn","photoEngine","histories","actionHistory","toggleGeneralAIOnboarding","forkChat","LAST_ACTION_SESSIONID","LAST_ROOT_SESSION_ID","MAX_LOCAL_HISTORY","shift","asyncIterator","PaymentRequiredError","UnauthorizedError","provide","provideAction","requestOpenWithChat","requestInsertTemplate","requestLogin","requestUpgradePlan","requestRunInEdgeless","toggleChatCards","reportResponse","lastAction","isMindMapRoot","ele","group","MindmapElementModel","isMindmapChild","getService","getEdgelessCopilotWidget","rootBlockId","getWidget","AFFINE_EDGELESS_COPILOT_WIDGET","getNoteId","blockElement","parentBlock","setBlockSelection","selections","isInsideEdgelessEditor","surfaceElementId","surfaceSelection","setGroup","selectBlock","below","blockParent","findIndex","updateComplete","insertBelow","insertAbove","firstBlock","selectedModels","textSelection","firstBlockParent","firstIndex","snapshotToSlice","deleteBlock","copyTextAnswer","panel","copyText","previewDoc","Slice","fromModels","clipboard","copySlice","getRootService","getEdgelessRootFromEditor","editor","edgelessRoot","getElementsByTagName","alert","getEdgelessService","rootService","EdgelessRootService","selectedToCanvas","notes","frames","shapes","images","BlocksUtils","splitElements","selectedElements","clipboardController","toCanvas","getSelectedModels","editorHost","chain","command","types","run","getTextContentFromBlockModels","drafts","selectedTextModels","matchFlavours","toDraftModel","draft","traverse","isDatabase","idx","splice","getSelectedTextContent","selectAboveBlocks","num","lastLeafModel","noteModel","lastRootModel","getParent","endIndex","startIndex","startBlock","getSelections","tryAll","getTextSelection","getBlockSelections","getImageSelections","getSelectedBlocks","getSelectedImagesAsBlobs","blobs","selectedBlocks","sourceId","File","getSelectedNoteAnchor","getCopilotSelectedElems","tool","imageCustomInput","imageBlock","ImageBlockModel","attachments","getSelection","lastBlock","asCaption","showWhen","getAIPanel","caption","updateBlock","createNewNote","findNoteBlockModel","curBlock","bound","Bound","newBound","w","displayMode","NoteDisplayMode","EdgelessOnly","generateIndex","newNote","getBlock","bounds","zoom","centerX","centerY","getFitToScreenData","viewport","setViewport","replaceWithAnswer","insertAnswerBelow","insertAnswerAbove","buildFinishConfig","responses","buildTextResponseConfig","generate","discard","buildErrorConfig","login","cancel","buildErrorResponseConfig","buildGeneratingConfig","generatingIcon","buildCopyConfig","allowed","onCopy","buildAIPanelConfig","answerRenderer","finishStateConfig","generatingStateConfig","errorStateConfig","copy","aiPanel","AFFINE_AI_PANEL_WIDGET","AffineAIPanelWidget","bindTextStream","stream","finish","actionToHandler","trackerOptions","updateAIPanelConfig","generateAnswer","actionToStream","currentTextSelection","isCollapsed","sendAttachments","control","discardCallback","handleInlineAskAIAction","lastBlockPath","chat","AskAIPanel","actionGroups","scrollbarStyle","_edgeless","_actionGroups","styleMap","buttonWidthMap","small","middle","buttonHeightMap","AskAIButton","_askAIButton","toggleType","_clearAbortController","buttonStyles","_whenHover","setReference","nothing","_toggleAIPanel","_abortController","HoverController","computePosition","referenceElement","placement","middleware","flip","offset","mainAxis","crossAxis","autoUpdate","allowMultiple","panelWidth","panelMinWidth","createLitPortal","closeOnClickAway","noop","MiniMindmapPreview","createMindmapRenderer","generatingElement","updateLoadingProgress","createMindmapExecuteRenderer","markdownToMindmap","getSurfaceElementFromEditor","surfaceModel","getBlockByFlavour","surfaceId","surfaceElement","replaceText","getImageUrlByKeyword","h","photos","searchImages","keyword","rng","stringToNumber","str","res","getImages","imgs","getImage","createBasicCover","section1","getRandomElement","keywords","arr","random","basic1section","basic2section","section2","basic3section","section3","basic4section","section4","basicTheme","isCover","sections","PPTBuilder","contents","allImages","getText","createTemplateJob","insertTemplate","refresh","done","createSlidesRenderer","preprocessHtml","AISlidesRenderer","_editorHost","firstUpdated","_editorContainer","EdgelessEditorBlockSpecs","resetHistory","AIAnswerWrapper","createIframeRenderer","createImageRenderer","fetchImageToFile","filename","imageProxy","fetchImage","ok","convertToPng","reader","FileReader","Image","onload","imageSmoothingEnabled","imageSmoothingQuality","toBlob","onerror","readAsDataURL","tmp","crossOrigin","readBlobAsURL","canvasToBlob","quality","getElementToolbar","EDGELESS_ELEMENT_TOOLBAR_WIDGET","DeleteIcon","ResetIcon","createBlockAndInsert","edgelessCopilot","determineInsertionBounds","EDGELESS_TEXT_BLOCK_MIN_WIDTH","EDGELESS_TEXT_BLOCK_MIN_HEIGHT","surfaceBlock","defaultHandler","EdgelessTextBlockModel","edgelessTextBlockId","imageHandler","selectedImageBlockModel","selectedBound","hideCopilotPanel","configs","minX","minY","toViewCoord","addImages","blockIds","imageBlockId","imageModel","imageBound","expandMindmap","surface","queueMicrotask","mindmap","childTree","addTree","subtree","getNode","updateNodeSize","fitContent","edgelessService","selectionRect","selectionModelRect","newGenerated","removeElement","mindmapId","addElement","getElementById","childElements","shape","telemetryService","module","segment","moveTo","setViewportByBound","elementBound","design","getButtonText","regenerate","getInsertAndReplaceHandler","buttonText","createInsertResp","getContentFromEmbedSyncedDocModel","getContentFromHubBlockModel","getContentFromSelected","texts","edgelessTexts","embedSyncedDocs","NoteBlockModel","TextElementModel","ShapeElementModel","EmbedSyncedDocModel","noteContent","edgelessTextContent","syncedDocsContent","customInput","internal","lockToolbar","updateEdgelessAIPanelConfig","actionToRenderer","extract","getTextFromSelected","stages","hideCallback","edgeless","switchToDefaultMode","elementToolbar","isCreateImageAction","isMakeItRealAction","togglePanel","selectionElem","toolbarVisible","lastSelected","noteBlockOrTextShowWhen","__","noteWithCodeBlockShowWen","imageOnlyShowWhen","notAllAIChatBlockShowWhen","AIChatBlockModel","translateLangs","textTones","imageFilterStyles","imageProcessingTypes","translateSubItem","lang","toneSubItem","tone","blockActionTrackerOptions","textBlockShowWhen","codeBlockShowWhen","EditAIGroup","subItem","DraftAIGroup","edgelessHandler","tools","setEdgelessTool","currentController","updateDragPointsWith","draggingAreaUpdated","edgelessActionToHandler","ReviewWIthAIGroup","GenerateWithAIGroup","beta","OthersAIGroup","AIItemGroups","AICodeItemGroups","buttonOptions","imageFilterSubItem","imageProcessingSubItem","editGroup","draftGroup","edgelessActionGroups","len","inputText","pureShapes","dpr","png","seed","randomSeed","now","round","firstSelected","mindMapToMarkdown","markdownStr","indent","repeat","n","subItemOffset","setupFormatBarEntry","formatBar","toolbarDefaultConfig","addRawConfigItems","EdgelessCopilotToolbarEntry","AIImageItemGroups","setupSlashMenuEntry","slashMenu","AIItems","iconWrapper","showWhenWrapper","rootComponent","affineAIPanelWidget","editorMode","docModeService","actionItemWrapper","basicItemConfig","alias","menu","unshift","AIMenuItems","groupName","MoreHorizontalIcon","subMenu","basicGroupEnd","AffineSlashMenuWidget","DEFAULT_CONFIG","setupSpaceEntry","keyboardState","isComposing","AIPageRootBlockSpec","PageRootBlockSpec","widgets","unsafeStatic","disposableGroup","widgetConnected","AffineFormatBarWidget","AIEdgelessRootBlockSpec","EdgelessRootBlockSpec","EdgelessCopilotWidget","widget","groups","EdgelessElementToolbarWidget","setupEdgelessElementToolbarEntry","registerEntry","filtered","AIParagraphBlockSpec","ParagraphBlockSpec","mounted","assertInstanceOf","ParagraphBlockService","placeholderGenerator","placeholders","h2","h3","h4","h5","h6","quote","AICodeBlockSpec","CodeBlockSpec","AffineCodeToolbarWidget","setupCodeToolbarEntry","codeToolbar","onAskAIClick","codeBlock","setupDefaultConfig","addItems","AIImageBlockSpec","ImageBlockSpec","AffineImageToolbarWidget","setupImageToolbarEntry","imageToolbar","buildDefaultConfig","addConfigItems","imageBlockComponent","ChatPanelInput","imagesWrapper","textarea","closeWrapper","curIndex","isInputEmpty","chatContextValue","updateContext","cleanupHistories","_addImages","oldImages","_renderImages","evt","parentRect","abs","newImages","hasImages","lines","line","imagesHeight","overflowY","send","clipboardData","kind","getAsFile","openFileOrFiles","acceptType","multiple","createdAt","isRootSession","last","chatSessionId","historyIds","sessionId","messages","AILoading","stopGenerating","renderImages","HISTORY_IMAGE_ACTIONS","Translate","Summary","Clearer","ActionWrapper","promptShow","originalText","ActionText","isCode","border","ActionMakeReal","ShadowlessElement","ActionSlides","ActionMindmap","ChatText","ActionImageToText","ActionImage","cardsStyles","CardType","ChatCards","temporaryParams","cards","renderText","renderImage","renderDoc","textTpl","imageTpl","hasImage","_renderCard","card","_updateCards","_handleDocSelection","_extractAll","_selectCard","_selectedCardId","_extract","hasText","currentImageSelections","_extractOnEdgeless","note","_appendCardWithParams","_currentDocId","_disposables","ChatActionList","messageId","layoutDirection","_selectionValue","_rootService","_currentTextSelection","_currentBlockSelections","_currentImageSelections","currentSelections","notificationService","accent","onClose","ChatCopyMore","_showMoreMenu","_moreButton","_moreMenu","isLast","_toggle","_morePopper","createButtonPopper","_notifySuccess","queryHistoryMessages","forkSessionId","chats","messageOrder","ChatHistoryOrder","asc","constructUserInfoWithMessages","userInfoProps","isUser","userName","avatarUrl","constructRootChatBlockMessages","getViewportCenter","center","editPropsStore","getStorage","SAVE_CHAT_TO_BLOCK_ACTION","surfaceService","layer","curMode","viewportCenter","newBlockIndex","newSessionId","latestMessageId","addAIChatBlock","getBlocks","rootWorkspaceId","rootDocId","category","ADD_TO_EDGELESS_AS_NOTE","getElementsBound","maxY","CommonActions","blockSelections","currentBlockSelections","PageEditorActions","rootId","noteId","docLinkClicked","addContent","newHost","EdgelessEditorActions","ChatBlockPeekViewActions","POSITIVE_INFINITY","AIErrorWrapper","PaymentRequiredErrorRenderer","generateText","nope","GeneralErrorRenderer","AIChatErrorRenderer","tip","AIPreloadConfig","readAforeign","TidyMindMapV3","redHat","completeWritingWithAI","freelyCommunicateWithAI","ChatPanelMessages","showDownIndicator","isLoading","messagesContainer","showChatCards","_renderAIOnboarding","getFlag","filteredItems","clientHeight","renderAvatar","renderItem","scrollToDown","renderLoading","shouldRenderError","renderEditorActions","isInsidePageEditor","ChatPanel","_changedProperties","_resetItems","_chatMessages","_cleanupHistories","_resettingCounter","fork","getTime","confirm","cleanup","continueInChat","ChatBlockInput","parentSessionId","updateChatBlock","createChatBlock","chatContext","_isInputEmpty","_focused","_curIndex","disableCleanUp","cleanButtonClasses","_send","currentChatBlockId","currentSessionId","DateTime","i18nTime","relative","accuracy","weekday","absolute","PeekViewStyles","unsafeCSS","baseTheme","fontSansFamily","AIChatBlockPeekView","_chatMessagesContainer","parentModel","_historyMessages","_modeService","historyMessagesString","parentChatBlockId","parentRootDocId","parentRootWorkspaceId","_deserializeHistoryChatMessages","latestHistoryMessage","latestMessageCreatedAt","latestHistoryMessageId","updateChatBlockMessages","createAIChatBlock","cleanCurrentChatHistories","currentChatMessages","CurrentMessages","ChatMessagesSchema","_constructBranchChatBlockMessages","currentUserInfo","forkMessages","forkLength","historyLength","_resetContext","calcChildBound","parentX","parentY","parentWidth","connectors","getConnectors","defaultX","CHAT_BLOCK_WIDTH","CHAT_BLOCK_HEIGHT","targetBlocks","childConnectors","connector","middleIndex","middleBlock","middleY","middleHeight","lastX","lastY","lastHeight","aiChatBlockId","CanvasElementType","CONNECTOR","ConnectorMode","Curve","chatBlock","currentMessages","isAssistantMessage","isLastReply","isNotReady","shouldRenderCopyMore","shouldRenderActions","messageClasses","AIChatBlockPeekViewTemplate","templates","FiveWTwoH","ConceptMap","Flowchart","SMART","SWOT","FourPMarketingMatrix","Storyboard","UserJourneyMap","BusinessProposal","DataAnalysis","SimplePresentation","FishboneDiagram","GanttChart","builtInTemplates","categories","candidates","cates","cate","temp","lcs","text1","text2","dp","buildStickerTemplate","preview","cover","hash","createDate","tags","rotate","stickerCover000","stickerContent000","stickerCover001","stickerContent001","stickerCover002","stickerContent002","stickerCover003","stickerContent003","stickerCover004","stickerContent004","stickerCover005","stickerContent005","stickerCover006","stickerContent006","stickerCover007","stickerContent007","stickerCover008","stickerContent008","stickerCover009","stickerContent009","stickerCover010","stickerContent010","stickerCover011","stickerContent011","stickerCover012","stickerContent012","stickerCover013","stickerContent013","stickerCover014","stickerContent014","stickerCover015","stickerContent015","stickerCover016","stickerContent016","stickerCover017","stickerContent017","stickerCover018","stickerContent018","stickerCover019","stickerContent019","stickerCover020","stickerContent020","stickerCover021","stickerContent021","stickerCover022","stickerContent022","stickerCover023","stickerContent023","stickerCover024","stickerContent024","stickerCover025","stickerContent025","stickerCover026","stickerContent026","stickerCover027","stickerContent027","stickerCover028","stickerContent028","stickerCover029","stickerContent029","stickerCover030","stickerContent030","stickerCover031","stickerContent031","stickerCover032","stickerContent032","stickerCover033","stickerContent033","stickerCover034","stickerContent034","stickerCover035","stickerContent035","stickerCover036","stickerContent036","stickerCover037","stickerContent037","stickerCover038","stickerContent038","stickerCover039","stickerContent039","stickerCover040","stickerContent040","stickerCover041","stickerContent041","stickerCover042","stickerContent042","stickerCover043","stickerContent043","stickerCover044","stickerContent044","stickerCover045","stickerContent045","stickerCover046","stickerContent046","stickerCover047","stickerContent047","stickerCover048","stickerContent048","stickerCover049","stickerContent049","stickerCover050","stickerContent050","stickerCover051","stickerContent051","stickerCover052","stickerContent052","stickerCover053","stickerContent053","stickerCover054","stickerContent054","stickerCover055","stickerContent055","stickerCover056","stickerContent056","stickerCover057","stickerContent057","stickerCover058","stickerContent058","stickerCover059","stickerContent059","stickerCover060","stickerContent060","stickerCover061","stickerContent061","stickerCover062","stickerContent062","stickerCover063","stickerContent063","stickerCover064","stickerContent064","stickerCover065","stickerContent065","stickerCover066","stickerContent066","stickerCover067","stickerContent067","stickerCover068","stickerContent068","stickerCover069","stickerContent069","stickerCover070","stickerContent070","stickerCover071","stickerContent071","stickerCover072","stickerContent072","stickerCover073","stickerContent073","stickerCover074","stickerContent074","stickerCover075","stickerContent075","stickerCover076","stickerContent076","stickerCover077","stickerContent077","stickerCover078","stickerContent078","stickerCover079","stickerContent079","stickerCover080","stickerContent080","stickerCover081","stickerContent081","stickerCover082","stickerContent082","stickerCover083","stickerContent083","stickerCover084","stickerContent084","stickerCover085","stickerContent085","stickerCover086","stickerContent086","stickerCover087","stickerContent087","stickerCover088","stickerContent088","stickerCover089","stickerContent089","stickerCover090","stickerContent090","stickerCover091","stickerContent091","stickerCover092","stickerContent092","stickerCover093","stickerContent093","stickerCover094","stickerContent094","stickerCover095","stickerContent095","stickerCover096","stickerContent096","stickerCover097","stickerContent097","stickerCover098","stickerContent098","stickerCover099","stickerContent099","stickerCover100","stickerContent100","stickerCover101","stickerContent101","stickerCover102","stickerContent102","stickerCover103","stickerContent103","stickerCover104","stickerContent104","stickerCover105","stickerContent105","stickerCover106","stickerContent106","stickerCover107","stickerContent107","stickerCover108","stickerContent108","stickerCover109","stickerContent109","stickerCover110","stickerContent110","stickerCover111","stickerContent111","stickerCover112","stickerContent112","stickerCover113","stickerContent113","stickerCover114","stickerContent114","stickerCover115","stickerContent115","stickerCover116","stickerContent116","stickerCover117","stickerContent117","stickerCover118","stickerContent118","stickerCover119","stickerContent119","stickerCover120","stickerContent120","stickerCover121","stickerContent121","stickerCover122","stickerContent122","stickerCover123","stickerContent123","stickerCover124","stickerContent124","stickerCover125","stickerContent125","stickerCover126","stickerContent126","stickerCover127","stickerContent127","stickerCover128","stickerContent128","stickerCover129","stickerContent129","stickerCover130","stickerContent130","stickerCover131","stickerContent131","stickerCover132","stickerContent132","stickerCover133","stickerContent133","stickerCover134","stickerContent134","stickerCover135","stickerContent135","stickerCover136","stickerContent136","stickerCover137","stickerContent137","stickerCover138","stickerContent138","stickerCover139","stickerContent139","stickerCover140","stickerContent140","stickerCover141","stickerContent141","stickerCover142","stickerContent142","stickerCover143","stickerContent143","stickerCover144","stickerContent144","stickerCover145","stickerContent145","stickerCover146","stickerContent146","stickerCover147","stickerContent147","stickerCover148","stickerContent148","stickerCover149","stickerContent149","stickerCover150","stickerContent150","stickerCover151","stickerContent151","stickerCover152","stickerContent152","stickerCover153","stickerContent153","stickerCover154","stickerContent154","stickerCover155","stickerContent155","stickerCover156","stickerContent156","stickerCover157","stickerContent157","stickerCover158","stickerContent158","stickerCover159","stickerContent159","stickerCover160","stickerContent160","stickerCover161","stickerContent161","stickerCover162","stickerContent162","stickerCover163","stickerContent163","stickerCover164","stickerContent164","stickerCover165","stickerContent165","stickerCover166","stickerContent166","stickerCover167","stickerContent167","stickerCover168","stickerContent168","stickerCover169","stickerContent169","stickerCover170","stickerContent170","stickerCover171","stickerContent171","stickerCover172","stickerContent172","stickerCover173","stickerContent173","stickerCover174","stickerContent174","stickerCover175","stickerContent175","stickerCover176","stickerContent176","stickerCover177","stickerContent177","stickerCover178","stickerContent178","stickerCover179","stickerContent179","stickerCover180","stickerContent180","stickerCover181","stickerContent181","stickerCover182","stickerContent182","stickerCover183","stickerContent183","stickerCover184","stickerContent184","stickerCover185","stickerContent185","stickerCover186","stickerContent186","stickerCover187","stickerContent187","stickerCover188","stickerContent188","stickerCover189","stickerContent189","stickerCover190","stickerContent190","stickerCover191","stickerContent191","stickerCover192","stickerContent192","stickerCover193","stickerContent193","stickerCover194","stickerContent194","stickerCover195","stickerContent195","stickerCover196","stickerContent196","stickerCover197","stickerContent197","stickerCover198","stickerContent198","stickerCover199","stickerContent199","stickerCover200","stickerContent200","stickerCover201","stickerContent201","stickerCover202","stickerContent202","stickerCover203","stickerContent203","stickerCover204","stickerContent204","stickerCover205","stickerContent205","stickerCover206","stickerContent206","stickerCover207","stickerContent207","stickerCover208","stickerContent208","stickerCover209","stickerContent209","stickerCover210","stickerContent210","stickerCover211","stickerContent211","stickerCover212","stickerContent212","stickerCover213","stickerContent213","stickerCover214","stickerContent214","stickerCover215","stickerContent215","stickerCover216","stickerContent216","stickerCover217","stickerContent217","stickerCover218","stickerContent218","stickerCover219","stickerContent219","stickerCover220","stickerContent220","stickerCover221","stickerContent221","stickerCover222","stickerContent222","stickerCover223","stickerContent223","stickerCover224","stickerContent224","stickerCover225","stickerContent225","stickerCover226","stickerContent226","stickerCover227","stickerContent227","stickerCover228","stickerContent228","stickerCover229","stickerContent229","stickerCover230","stickerContent230","EdgelessTemplatePanel","extend","builtInStickersTemplates","builtInEdgelessTemplates","PreconditionStrategy","commandLogger","bindKeys","keyBindingMap","onKeyEvent","createKeybindingsHandler","capture","AffineCommandRegistry","unsubKb","preconditionStrategy","keyBinding","binding","skipRegister","keybinding","registerAffineCommand","registerAffineCreationCommands","pageHelper","unsubs","PlusIcon","cmdk","creation","createPage","createEdgeless","createWorkspace","ImportIcon","registerAffineHelpCommands","NewIcon","help","openChangelog","popupWindow","ContactWithUsIcon","contactUs","workspaceMetadata","registerAffineLayoutCommands","SidebarIcon","appSidebarOpenAtom","navigationPanel","registerAffineNavigationCommands","navigationHelper","ArrowRightBigIcon","navigation","jumpToSubPath","WorkspaceSubPath","ALL","jumpToCollections","jumpToTags","openSettings","TRASH","registerAffineSettingsCommands","languageHelper","onLanguageChange","languagesList","currentLanguage","SettingsIcon","changeAppSetting","setTheme","language","originalName","tag","registerAffineUpdatesCommands","updateReadyAtom","updates","quitAndInstall","ERROR_REFLECT_KEY","createErrorFallback","ErrorConstructor","DumpInfo","globalContextService","currentWorkspaceId","useParams","ErrorStatus","imageMap","light","imageUrlFor404","dark","imageUrlForLight500","imageUrlForDark500","ErrorDetail","direction","onButtonClick","resetError","withoutImage","descriptions","isBtnLoading","setBtnLoading","resolvedTheme","useTheme","onBtnClick","useAsyncCallback","backgroundImage","ContactUS","Trans","AnyErrorFallback","reloadPage","reload","NoPageRootFallback","NoPageRootError","fallbacks","jumpToIndex","useNavigateHelper","RouteLogic","REPLACE","NotFound","canRetry","ttl","rerender","buttonDesc","onRetry","AffineErrorFallback","getErrorFallbackComponent","AffineErrorBoundary","fallbackRender","onError","componentStack","ErrorBoundary","fallback","AppContainer","appSettings","useAppSettingHelper","AppContainerWithoutSettings","useNoisyBackground","useBlurBackground","AppFallback","AppSidebarFallback","MainContainer","showAILoginRequiredAtom","AiLoginRequiredModal","useAtom","setAuth","useSetAtom","openSignIn","challengeFetcher","challenge","resource","generateChallengeResponse","ui","getChallengeResponse","captchaAtom","responseAtom","Captcha","setCaptcha","response","Turnstile","siteKey","useCaptcha","verifyToken","setResponse","prevChallenge","useEmailTitle","useNotificationHint","useButtonContent","useSendEmail","sendChangePasswordEmail","isMutating","isChangePasswordMutating","useMutation","mutation","sendChangePasswordEmailMutation","sendSetPasswordEmail","isSetPasswordMutating","sendSetPasswordEmailMutation","sendChangeEmail","isChangeEmailMutating","sendChangeEmailMutation","sendVerifyEmail","isVerifyEmailMutation","sendVerifyEmailMutation","sendEmail","OAuthProviderMap","OAuthProviderType","Google","GoogleDuotoneIcon","GitHub","GithubIcon","OIDC","OAuth","redirectUri","serverConfig","ServerConfigService","oauth","features$","oauthProviders","config$","OAuthProvider","br","authService","AuthService","isConnecting","setIsConnecting","signInOauth","auth","signIn","setAuthState","setAuthEmail","onSignedIn","useSearchParams","setIsMutating","session","status$","hasPassword","isExist","isUserExist","checkUserByEmail","sendEmailMagicLink","signUp","i18nKey","afterSignUpSendEmail","resendCountDown","setResendCountDown","isSending","setIsSending","loginStatus","onResendClick","afterSignInSendEmail","onSignInWithPasswordClick","onBackBottomClick","signInWithPassword","setEmailType","setPassword","passwordError","setPasswordError","setIsLoading","sendingEmail","setSendingEmail","onSignIn","signInPassword","sendMagicLink","credentialsRequirement$","hasSentEmail","setHasSentEmail","hint","buttonContent","onSendEmail","onBack","AuthModalBase","AuthPanel","CurrentPanel","UserPlanButton","serverConfigService","subscriptionService","SubscriptionService","hasPayment","payment","plan","pro$","isBeliever","isBeliever$","setSettingModalAtom","useCatchEventCallback","scrollAnchor","planLabel","SubscriptionPlan","Free","data-is-believer","data-event-props","ConfirmDeletePropertyModal","show","WorkspacePropertiesAdapter","manager","PagePropertiesMetaManager","getPropertyRelatedPages","iconNames","getDefaultIconName","getSafeIconName","iconName","PagePropertyType","nameToComponentName","capitalize","nameToIcon","Icon","managerContext","tagSelectorItem","InlineTagsList","focusedIndex","tagList","TagService","tags$","tagIds","tagIdsByPageId$","onRemoved","untag","TagItem","EditTagMenu","onTagDelete","legacyProperties","WorkspaceLegacyProperties","tagService","tagByTagId$","tagColor","color$","tagValue","value$","menuProps","updateTagName","rename","currentTarget","TagsIcon","jumpToTag","tagColors","changeColor","renderMenuItemOptions","isCreateNewTag","tagOption","TagsEditor","inputValue","setInputValue","filteredTags","filterTagsByName$","selectedTagIds","setSelectedTagIds","showCreateTag","tagOptions","setFocusedIndex","focusedInlineIndex","setFocusedInlineIndex","safeFocusedIndex","clamp","safeInlineFocusedIndex","scrollContainerRef","handleCloseModal","onInputChange","onToggleTag","tagEntity","o","focusInput","nextColor","rotateNextColor","useReducer","onCreateTag","newTag","createTag","onSelectTagOption","onInputKeyDown","tagToRemove","newFocusedIndex","scrollIntoView","newItemToFocus","commonProps","TempTagItem","data-tag-id","data-tag-value","DeleteTagConfirmModal","TagsInlineEditor","empty","avoidCollisions","data-empty","data-readonly","TextValue","handleBlur","updateCustomProperty","handleOnChange","endsWith","TagsValue","propertyValueRenderers","checkbox","number","editingPropertyAtom","modifiers","restrictToParentElement","restrictToVerticalAxis","SortableProperties","sorter","getOrderedItems","editingItem","sensors","useSensors","useSensor","PointerSensor","activationConstraint","distance","localProperties","setLocalProperties","onDragEnd","over","move","filteredProperties","getCustomPropertyMeta","DndContext","SortableContext","SortablePropertyRow","setNodeRef","isDragging","isSorting","useSortable","data-property","data-draggable","data-dragging","data-other-dragging","visibilities","rotateVisibility","visibility","visibilityMenuText","visibilitySelectorText","VisibilityModeSelector","required","data-required","PagePropertiesSettingsPopup","PageBacklinksPopup","backlinks","link","AffinePageReference","wrapper","PagePropertyRowNameMenu","onFinishEditing","localPropertyMeta","setLocalPropertyMeta","localProperty","setLocalProperty","nextVisibility","showDeleteModal","setShowDeleteModal","handleFinishEditing","updateCustomPropertyMeta","handleNameBlur","handleNameChange","toggleHide","handleDelete","removeCustomProperty","handleIconChange","EditPropertyNameMenuItem","onIconChange","onNameBlur","onNameChange","PropertyTypeMenuItem","InvisibleIcon","ViewIcon","onInteractOutside","PagePropertiesTableHeader","docLinksServices","DocLinksServices","DocLinksService","docBacklinks","backlinks$","docService","timestampElement","localizedCreateTime","createTimeElement","updatedDate","dTimestampElement","useDebouncedValue","handleCollapse","inlineDocInfo","Collapsible","ToggleExpandIcon","data-collapsed","PagePropertyRow","rowNameClassName","ValueRenderer","editingMeta","setEditingMeta","setEditingItem","handleEditMeta","handleFinishEditingMeta","PageTagsRow","PagePropertiesTableBody","isPropertyRequired","PagePropertiesAddProperty","findNextDefaultName","allNames","PagePropertiesCreatePropertyMenuItems","onCreated","metaManager","onAddProperty","schemaList","getOrderedPropertiesSchema","nameExists","addPropertyMeta","newPropertyTypes","PagePropertiesAddPropertyMenuItems","onCreateClicked","nonRequiredMetaList","metaList","isChecked","hasCustomProperty","onClickProperty","addCustomProperty","nonRequiredMetaOptions","adding","setAdding","toggleAdding","menuOptions","PagePropertiesTableInner","expanded","setExpanded","whenSynced","usePagePropertiesManager","useCurrentWorkspacePropertiesAdapter","PagePropertiesManager","PagePropertiesTable","Suspense","BackLinksRow","references","TagsRow","RowComponent","TimeRow","formatI18nTime","DateTimeIcon","HistoryIcon","InfoModal","docsSearchService","DocsSearchService","titleInputHandleRef","handleClose","watchRefsFrom","BlocksuiteHeaderTitle","inputHandleRef","InfoTable","iconRows","chunk","IconsSelectorPanel","onSelectedChange","iconButton","iconRow","data-name","IconsSelectorButton","isElementOption","isValidElement","propertiesSchema","pageProperties","systemPropertiesSchema","system","customPropertiesSchema","order","checkPropertyExists","validatePropertyValue","Tags","newOrder","updatePropertyMeta","opt","removePropertyMeta","getPropertyStatistics","mapping","getPageProperties","createFractionalIndexingSortableHelper","ensuring","ensureRequiredProperties","ensurePageProperties","getItems","getCustomProperties","getItemOrder","setItemOrder","getItemId","intrinsicMeta","fromEntries","getCustomProperty","getNewItemOrder","pageReferenceIcon","pageMetaHelper","useDocMetaHelper","journalHelper","useJournalHelper","docsService","pageReferenceRenderer","isPageJournal","getLocalizedJournalDateString","referencedPage","getDocMeta","LinkedPageIcon","LinkedEdgelessIcon","isJournal","localizedJournalDate","TodayIcon","peekView","PeekViewService","isInPeekView","useInsidePeekView","close","WorkbenchLink","SignOutModal","defaultTexts","getDefaultText","APP_SIDEBAR_OPEN","innerWidth","appSidebarFloatingAtom","appSidebarResizingAtom","appSidebarWidthAtom","navBodyStyle","navHeaderStyle","navStyle","navWrapperStyle","SidebarHeader","SidebarSwitch","sideBottom","AddPageButton","onAuxClick","CategoryDivider","collapsed","setCollapsed","collapsible","data-collapsible","ToggleCollapseIcon","onCollapsedChange","postfix","MenuLinkItem","linkComponent","LinkComponent","Spotlight","outside","useMouseOffset","setOffset","setOutside","offsetVars","isDark","QuickSearchInput","isMac","SearchIcon","SidebarContainer","SidebarScrollableContainer","AppSidebar","setWidth","setFloating","setResizing","dOnResize","isFloatingMaxWidth","matchMedia","matches","isOverflowWidth","isFloating","localStorage","hasRightBorder","data-transparent","data-has-border","nav","currentWorkspace","WorkspaceSelector","tooltipContent","data-show","EmbedLinkedDocBlockComponent","divider","dividerContainer","linksContainer","linksTitles","BiDirectionalLinkPanel","setShow","docLinksService","links","links$","handleClickShow","BlocksuiteEditorJournalDocTitle","isTodayJournal","journalDate","useJournalInfoHelper","patchSpecService","onMounted","onWidgetConnected","oldSetup","disposable","patchReferenceRenderer","specs","reactToLit","reactRenderer","litRenderer","referenceNodeConfig","setCustomContent","LinkedDocBlockComponent","_load","isBannerEmpty","CustomAttachmentBlockService","AttachmentBlockService","maxFileSize","CustomAttachmentBlockSpec","AttachmentBlockSpec","CommonBlockSpecs","ListBlockSpec","NoteBlockSpec","DatabaseBlockSpec","DataViewBlockSpec","DividerBlockSpec","BookmarkBlockSpec","EmbedFigmaBlockSpec","EmbedGithubBlockSpec","EmbedYoutubeBlockSpec","EmbedLoomBlockSpec","EmbedHtmlBlockSpec","EmbedSyncedDocBlockSpec","EmbedLinkedDocBlockSpec","AIChatBlockSpec","EdgelessAIChatBlockSpec","createLinkedWidgetConfig","getMenus","inlineEditor","rawMetas","docMetas","getJournalPageDateString","I18n","isFuzzyMatch","pureName","regex","isEdgeless","LinkedWidgetUtils","insertLinkedNode","atMenu","linkDoc","maxDisplay","overflowText","createNewDocMenuGroup","withAffineRootService","customLoadFonts","fontLoader","AffineCanvasTextFonts","eventName","mixpanel","adapted","DocEditor","createReactComponentFromLit","PageEditor","DocTitle","PageMetaTags","DocMetaTags","EdgelessEditor","usePatchSpecs","shared","peekViewService","referenceRenderer","EdgelessSurfaceBlockSpec","EdgelessSurfaceRefBlockSpec","FrameBlockSpec","EdgelessTextBlockSpec","EdgelessNoteBlockSpec","linkedWidget","PageSurfaceBlockSpec","PageSurfaceRefBlockSpec","confirmModal","patched","patchEdgelessClipboard","rootSpec","viewConnected","EdgelessRootBlockComponent","AIChatBlockFlavour","registerBlock","scale","patchPeekViewService","pageService","peek","patchNotificationService","prompt","autofill","accentToNotify","toastId","onAutoClose","patchQuickSearchService","quickSearchService","searchDoc","searchResult","skipSelection","userInput","resolvedDoc","resolveLinkToDoc","searchedDoc","QuickSearchService","quickSearch","RecentDocsQuickSearchSession","DocsQuickSearchSession","CreationQuickSearchSession","LinkIcon","isNewDoc","defaultQuery","oldAction","linkedDoc","addSiblingBlocks","embedOptions","getEmbedBlockOptions","linkedDocNames","patchDocModeService","DEFAULT_MODE","Fragment","BlocksuiteDocEditor","titleRef","docRef","docPage","setDocPage","workbench","WorkbenchService","activeView","activeView$","location$","onDocRef","richText","focusEnd","focusFirstParagraph","hasViewport","appendParagraph","BlocksuiteEdgelessEditor","editorRef","click","forwardSlot","slot","useBlockElementById","setBlockElement","BlocksuiteEditorContainer","defaultSelectedBlockId","scrolledRef","hashChangedRef","rootRef","edgelessRef","editorModeSwitched","docUpdated","tagClicked","edgelessPage","newDocId","affineEditorContainerProxy","api","Proxy","maybeFn","handleScrollToBlock","selectManager","newSelection","data-affine-editor-container","BlockSuiteEditorImpl","onLoadEditor","rootAdded","editorDisposeRef","onRefChange","blockUpdated","BlockSuiteEditor","AIOnboardingType","createStorageEvent","StorageEvent","storageArea","GENERAL","handleError","codeToError","GeneralNetworkError","GraphQLError","UserFriendlyError","extensions","fromAnyError","fetcher","defaultFetcher","ms","safeParseError","toTextStream","eventSource","resolveMessagePromise","rejectMessagePromise","messageQueue","resetMessagePromise","messagePromise","messageListener","readyState","EventSource","CLOSED","client","createSession","createCopilotSessionMutation","createCopilotSession","forkSession","forkCopilotSessionMutation","forkCopilotSession","createMessage","createCopilotMessageMutation","createCopilotMessage","getSessions","getCopilotSessionsQuery","currentUser","copilot","getHistories","getCopilotHistoriesQuery","getHistoryIds","getCopilotHistoryIdsQuery","cleanupSessions","cleanupCopilotSessionMutation","cleanupCopilotSession","chatText","backendUrl","chatTextStream","endpoint","imagesStream","getBaseUrl","resizeImage","createSessionMessage","promptName","providedSessionId","hasAttachments","stringAttachments","partition","attachment","textToText","workflow","_sessionId","_messageId","retrySessionId","onabort","listHistories","toImage","trackAction","inferPageMode","defaultActionOptions","isElementModel","isBlockModel","toTrackedOptions","inferEventName","pageMode","otherProperties","omit","inferObjectType","inferSegment","inferModule","inferControl","lowerCase","other","filterStyleToPromptName","processTypeToPromptName","setupAIProvider","chatSessions","getChatSessionId","storeKey","createChatSession","SlideSchema","enum","parseJson","slides","slide","sessionIds","urls","regular","paywall","aiAction","viewPlans","CustomSpecs","specProvider","SpecProvider","getInstance","extendSpec","hasExpectSpace","spaceDoc","havePageBlock","expectPageId","expectGuid","blockSize","isPublic","onEditSave","currentPage","pageMeta","useBlockSuiteDocMeta","setDocTitle","usePageHelper","useDocCollectionHelper","docRecordList","isPreferredEdgeless","createPageAndOpen","openDoc","createEdgelessAndOpen","importFileAndOpen","showImportModal","withResolvers","pageIds","importedCount","isWorkspaceFile","openAll","onFail","importFile","EditorOutlineViewer","openOutlinePanel","outlineViewerRef","OutlineViewer","toggleOutlinePanel","titleIconsWrapper","ListTitleCell","ListIconCell","CollectionSelectionCell","selectable","onSelectionChange","CollectionListOperationsCell","operations","CollectionListItem","collectionTitleElement","CollectionListItemWrapper","ColWrapper","flex","alignment","selectionState","setSelectionActive","selectionStateAtom","selectionActive","CollectionListHeader","onCreate","FavoriteOperation","favAdapter","CompatibleFavoriteItemsAdapter","isFavorite","isFavorite$","onToggleFavoriteCollection","FavoriteTag","SelectCollection","collectionService","CollectionService","collections","collections$","setSelection","setKeyword","collectionMetas","reg","collectionItemRenderer","CollectionListItemRenderer","collectionHeaderRenderer","ListTableHeader","headerCols","collectionHeaderColsDef","collectionOperationRenderer","SelectorLayout","searchPlaceholder","selectedCount","onSearch","onClear","VirtualizedList","selectedIds","onSelectedIdsChange","itemRenderer","rowAsLink","operationsRenderer","headerRenderer","useCollectionOperationsRenderer","CollectionOperationCell","VirtualizedCollectionList","setHideHeaderCreateNewCollection","handleCreateCollection","listRef","showFloatingToolbar","setShowFloatingToolbar","selectedCollectionIds","setSelectedCollectionIds","useDeleteCollectionInfo","collectionOperations","filteredSelectedCollectionIds","hideFloatingToolbar","toggleSelectable","deleteCollection","atTopThreshold","atTopStateChange","onSelectionActiveChange","ListFloatingToolbar","playAnimation","setPlayAnimation","favoritedAnimation","FavoritedIcon","FavoriteIcon","FloatingToolbar","Toolbar","Item","Separator","onRestore","DeletePermanentlyIcon","dateCell","displayProperties","useAllDocDisplayProperties","bodyNotes","PageSelectionCell","PageTagsCell","tagsByPageId$","PageTags","hoverExpandDirection","widthOnHover","maxItems","PageCreateDateCell","data-date-raw","PageUpdatedDateCell","PageListOperationsCell","PageListItem","pageTitleElement","PageListItemWrapper","hidden","anchorIndex","setAnchorIndex","anchorIndexAtom","rangeIds","setRangeIds","rangeIdsAtom","handleShiftClick","currentIndex","lowerIndex","upperIndex","newRangeIds","currentSelected","setRange","newSelected","concat","handleKeyUp","tagIndicator","tagInline","tagLabel","handleRemove","data-idx","data-focused","TagItemNormal","nTags","tagsOrdered","sanitizedWidthOnHover","tagsInPopover","lastTags","useFilterTag","FilterTag","evalRef","variableMap","evalLiteral","lit","evalFilter","filterMatcher","findData","funcName","evalFilterList","filterList","datePickerPopperContentOptions","DateSelect","onDateChange","valueOf","MultiSelect","optionMap","literalMatcher","Matcher","typesystem","isSubtype","tDateRange","tBoolean","tDate","getTagsOfArrayTag","tTag","is","tArray","Condition","propertiesMeta","variableDefineMap","ast","renderArgs","VariableSelect","onSelect","FunctionSelect","allMatchedData","defaultArgs","Arg","argType","FilterList","oldIndex","CreateFilterMenu","defineData","DataHelper","supers","_match","allMatched","tUnion","tTypeVar","tTypeRef","tFunction","typeVars","rt","DataDefine","dataMap","isByName","isSubOf","superType","sup","isSubOfByName","isSuperOf","subType","dataDefine","createDataHelper","extends","isDataType","tUnknown","subst","realArgs","realRt","realArg","Created","CreatedIcon","Updated","UpdatedIcon","CloudWorkspaceIcon","createDefaultFilter","variable","firstArg","staticType","safeArray","safeTags","usePageHeaderColsDef","ListHeaderTitleCell","sortable","tagHeaderColsDef","blockCardAround","BlockCard","desc","CreateNewPagePopup","createNewPage","createNewEdgeless","PageIcon","EdgelessIcon","NewPageButton","handleCreateNewPage","allDocs","handleCreateNewEdgeless","handleImportFile","hideWhenDetached","PageDisplayMenu","workspaceProperties","setProperties","handleSelect","handleSetDocDisplayProperties","propertyOptions","groupOptions","subItems","currentGroupType","alignOffset","createTagFilter","docListHeader","docListHeaderTitle","PageListNewPageButton","onCreatePage","onCreateEdgeless","onImportFile","PageListHeader","isNewTabTrigger","CollectionPageListHeader","handleJumpToCollections","useEditCollection","handleEdit","ret","updateCollection","createAndAddDocument","createDocumentFn","addPageToCollection","onConfirmAddDocument","ViewLayersIcon","TagPageListHeader","tagTitle","jumpToCollection","useEditCollectionName","showTips","handleJumpToTags","saveToCollection","addCollection","createEmptyCollection","SwitchTag","TagLink","GroupLabel","useDateGroupDefinitions","withinDaysAgo","betweenDaysAgo","GroupTagLabel","useTagGroupDefinitions","sortedTagsLiveData$","localeCompare","untagged","useFavoriteGroupDefinitions","favourites","favorites$","fav","usePageItemGroupDefinitions","tagGroupDefinitions","createDateGroupDefinitions","updatedDateGroupDefinitions","favouriteGroupDefinitions","itemGroupDefinitions","none","useFilteredPageMetas","pageMetas","shareDocsService","ShareDocsService","shareDocs","list$","getPublicMode","shareDoc","PublicPageMode","Edgeless","favoriteItems","pageData","publicMode","filters","filterPageByRules","filterPage","usePageOperationsRenderer","removeFromAllowList","deletePagesFromCollections","isInAllowList","PageOperationCell","onRemoveFromAllowList","VirtualizedPageList","listItem","setHideHeaderCreateNewPage","selectedPageIds","setSelectedPageIds","pageOperations","pageHeaderColsDef","filteredPageMetas","pageMetasToRender","filteredSelectedPageIds","pageOperationRenderer","allowList","pageHeaderRenderer","pageItemRenderer","PageListItemRenderer","setTrashModal","useTrashModalHelper","handleMultiDelete","pageNameMapping","pageNames","pageTitles","VirtualizedTrashList","permanentlyDeletePage","useBlockSuiteMetaHelper","handleMultiRestore","onConfirmPermanentlyDelete","pageOperationsRenderer","TrashOperationCell","onPermanentlyDeletePage","onRestorePage","List","ListProvider","initialValues","listPropsAtom","ListInnerWrapper","ListInner","useItemSelectionStateEffect","startTime","dblClickHandler","closest","escHandler","setListPropsAtom","setListSelectionState","groupsAtom","hideHeader","ItemGroup","ListScrollContainer","tooltipSideTop","tooltipSideTopAlignEnd","openDisableShared","setOpenDisableShared","favourite","duplicate","blocksuiteDoc","openInfoModal","setOpenInfoModal","onOpenInfoModal","docInfoPanel","onDisablePublicSharing","onRemoveToTrash","docMenu","deleteDoc","onOpenInSplitView","openInSplitView","onOpenInNewTab","onToggleFavoritePage","onToggleFavoritePageOption","toggleFavorite","onDuplicate","handleRemoveFromAllowList","docList","removeOrganizeItem","OperationMenu","DisablePublicSharing","FilterMinusIcon","InformationIcon","OpenInNewIcon","SplitViewIcon","DuplicateIcon","MoveToTrash","data-favorite","MoreVerticalIcon","DisablePublicSharingModal","handleRestorePage","openEditCollectionModal","editModal","openEditCollectionNameModal","editNameModal","handleEditName","onConfirmAddDocToCollection","EditIcon","FilterIcon","TagOperationCell","favoriteService","FavoriteService","favoriteList","CreateOrEditTag","tagMeta","ShareIcon","transitionStyle","ExportMenuItem","ExportMenuItems","exportHandler","itemMap","ExportToPdfIcon","ExportToHtmlIcon","ExportToPngIcon","ExportToMarkdownIcon","Export","handleExportMenuOpenChange","docOptions","export","ExportIcon","titles","confirmModalProps","Delete","weakMap","getPagePreviewText","pageRoot","queue","previewLenNeeded","emptyAtom","PagePreviewInner","previewAtom","useBlockSuitePagePreview","baseAtom","onMount","useDocCollectionPage","setPage","DisposableGroup","docAdded","docRemoved","loaded","PagePreview","collapsedIconContainer","headerCount","headerLabel","selectAllButton","spacer","ItemGroupHeader","collapseState","setCollapseState","groupCollapseStateAtom","onExpandedClicked","selectedItems","allSelected","onSelectAll","nonCurrentGroupIds","newSelectedPageIds","data-group-id","data-group-items-count","data-group-selected-items-count","data-state","requiredPropNames","listsPropsAtom","selectAtom","shallowEqual","pageItems","pageMetaToListItemProp","toggleSelection","prevSelected","PageTitle","UnifiedPageIcon","isPublicPage","collectionMetaToListItemProp","TagListItemRenderer","TagListItem","tagMetaToListItemProp","pageCount","ListHeaderCell","sortKey","sorting","onSort","data-sortable","data-sorting","SortUpIcon","SortDownIcon","ListHeaderCheckbox","setSelectionState","itemsAtom","onActivateSelection","listHandlersAtom","_e","MultiSelectIcon","hideHeaderAtom","setSorter","sorterAtom","newSortKey","data-selectable","data-selection-active","isTagHidden","selectionActiveAtom","baseState","validKeys","sorterStateAtom","sortingFn","fallbackKey","valA","valB","revertSymbol","revert","sorterState","sortCtx","itemsToItemGroups","groupDefs","allItems","groupDef","def","createIsolation","onSearchChange","TagIcon","tagMetas$","menuOpen","setMenuOpen","setTagName","handleChangeName","tagIcon","setTagIcon","randomTagColor","handleChangeIcon","tagItems","handleEscape","SelectTag","tagMetas","filteredTagMetas","tagItemRenderer","tagOperationRenderer","tagHeaderRenderer","TagListHeader","VirtualizedTagList","showCreateTagInput","setShowCreateTagInput","tagOperations","filteredSelectedTagIds","onOpenCreate","TagListTitleCell","TagSelectionCell","TagListOperationsCell","TagListItemWrapper","displayPropertiesAtom","defaultProps","filterByFilterList","varMap","flexBasis","data-hide-item","days","startDate","getDate","getMonth","getFullYear","days0","days1","objA","objB","keysA","keysB","hasOwnProperty","AffineShapeIcon","ellipse","rx","ry","CreateCollectionModal","onConfirmTitle","CreateCollection","onConfirmText","isNameEmpty","useAllPageListConfig","shareDocService","pageMap","allPages","Page","getPage","favoriteRender","RulesMode","reset","buttons","switchMode","allPageListConfig","showPreview","setShowPreview","allowListPages","rulesPages","favorites","expandInclude","setExpandInclude","tips","highlight","onFocus","RulesEmpty","noRules","fullHeight","filteredCount","EditCollectionModal","onConfirmOnCollection","EditCollection","initMode","onSaveCollection","onIdsChange","SelectPage","useFilter","changeFilters","showFilter","setShowFilter","clickFilter","onCreateFilter","updateFilters","createFilter","filteredList","useSearch","searchText","updateSearchText","searchedList","clearSelected","compatibleFavoriteItemsAdapter","EmptyList","AllPageListOperationsMenu","onChangeFilterList","SaveAsCollectionButton","SaveIcon","setData","headingAtom","PageListHeading","useVirtuosoItems","groupCollapsedState","Scroller","virtuosoItems","atTop","setAtTop","handleAtTopStateChange","Header","itemContentRenderer","_index","Virtuoso","data-total-count","topItemCount","totalCount","itemContent","ItemContainer","ItemText","AddWorkspace","onAddWorkspace","onNewWorkspace","UserAccountItem","WorkspaceCardSkeleton","WorkspaceCard","onSettingClick","onEnableCloudClick","openingId","isOwner","enableCloudText","isLocal","onEnableCloud","CollaborationIcon","SortableWorkspaceItem","useIsWorkspaceOwner","useWorkspaceName","WorkspaceList","workspaceList","workspaceType","workspaceTypeIcon","useWorkspaceInfo","CloudWorkSpaceList","workspaces","onClickWorkspace","onClickWorkspaceSetting","LocalWorkspaces","onClickEnableCloud","LocalWorkspaceIcon","AFFiNEWorkspaceList","onEventEnd","workspaces$","setOpenCreateWorkspaceModal","confirmEnableCloud","useEnableCloud","setOpenSettingModalAtom","cloudWorkspaces","localWorkspaces","onFinished","isAuthenticated","SignInItem","onClickSignIn","UserWithWorkspaceListLoading","UserWithWorkspaceListInner","session$","setOpenSignIn","openSignInModal","workspaceManager","account","UserWithWorkspaceList","useDocEngineStatus","engineState","workspaceInfo","CloudWorkspaceStatus","SyncingWorkspaceStatus","UnSyncWorkspaceStatus","UnsyncIcon","LocalWorkspaceStatus","OfflineStatus","NoNetworkIcon","useSyncEngineSyncProgress","isOnline","useSystemOnline","isOverCapacity","setIsOverCapacity","permissionService","WorkspacePermissionService","permission","isOwner$","jumpToPricePlan","disposableOverCapacity","isStorageOverCapacity","CloudWorkspaceSyncStatus","usePauseAnimation","timeToResume","paused","setPaused","resume","pause","WorkspaceInfo","delayActive","setDelayActive","data-type","information","isUserWorkspaceListOpened","setOpenUserWorkspaceList","closeUserWorkspaceList","openUserWorkspaceList","mainContainerStyle","noisyBackground","blurBackground","data-noise-background","data-is-resizing","data-blur-background","appSideBarOpen","data-is-desktop","data-client-border","data-side-bar-open","AsyncCallbackContext","handleAsyncError","setAppSettings","updateSettings","prevSettings","setDocReadonly","openPage","pageRecordList","removeToTrash","trashDate","removeDoc","publicPage","cancelPublicPage","openPageAfterDuplication","currentPageMode","currentPageMeta","newPage","lastDigitRegex","newNumber","newPageTitle","account$","setAuthAtom","enableCloud","ws","openPageId","signInOrEnableCloud","closeOnSuccess","trashModalAtom","trashModal","handleOnConfirm","useReactiveAdapter","proxy","setProxy","useDebouncedState","docMetaUpdated","observeDeep","unobserveDeep","rpcToObservable","onSubscribe","atomWithObservable","onUpdateReady","updateAvailableAtom","onUpdateAvailable","downloadProgressAtom","onDownloadProgress","changelogCheckedAtom","checkingForUpdatesAtom","currentVersionAtom","currentVersion","currentChangelogUnreadAtom","useAppUpdater","appQuitting","setAppQuitting","updateReady","setting","setSetting","downloadProgress","changelogUnread","setChangelogUnread","checkingForUpdates","setCheckingForUpdates","bottomButtons","checkForUpdates","settingsPanel","about","checkUpdates","updateInfo","downloadUpdate","toggleAutoDownload","toggleAutoCheck","dismissChangelog","autoCheck","autoDownload","updateAvailable","useAllBlockSuiteDocMeta","docMeta","JOURNAL_DATE_FORMAT","bsWorkspaceHelper","_createJournal","maybeDate","toDate","setJournalPageDateString","getJournalsByDate","getJournalByDate","isPageTodayJournal","getJournalDateString","journalDateString","appendContentToToday","useJournalRouteHelper","openJournal","newTab","openToday","toDayjs","isValid","useSWRMutation","useMutateQueryResource","mutate","useSWRConfig","varsFilter","_vars","defaultNavigate","router","NavigateContext","jumpToPage","logic","jumpToPageBlock","subPath","jumpTo404","jumpToExpired","jumpToSignIn","otherOptions","encodeURIComponent","openInApp","encodedUrl","getOnLineStatus","onLine","onStoreChange","trackFn","levels","enableAutoTrack","argName","createMixpanel","createProxyHandler","event_name","middlewareProperties","opt_out_tracking","opt_in_tracking","has_opted_in_tracking","has_opted_out_tracking","identify","unique_id","people","track_pageview","makeTrackerInner","levelProxy","AuthSession","watchCachedAuthSession","waitForAuthenticated","isRevalidating$","getSession","Infinity","sessionInfo","setCachedAuthSession","fetchSession","waitForRevalidation","isRevalidating","removeAvatar","uploadAvatar","reducedFile","validateAndReduceImage","updateLabel","UserFeature","isEarlyAccess$","features","FeatureType","EarlyAccess","error$","getUserFeatures","isNetworkError","isBackendError","UserQuota","quota$","used$","usedFormatted$","used","max$","quota","storageQuota","maxFormatted$","percent$","toFixed","percent","fetchUserQuota","NetworkError","BackendError","GraphQLService","rawGql","gqlFetcherFactory","rxGql","gql","standardError","ServerConfig","credentialsRequirement","fetchServerConfig","revalidateIfNeeded","onApplicationStart","Subscription","subscription$","Pro","ai$","AI","recurring","SubscriptionRecurring","Lifetime","fetchSubscriptions","setCachedSubscriptions","getCachedSubscriptions","resumeSubscription","idempotencyKey","mutateResumeSubscription","cancelSubscription","mutateCancelSubscription","setSubscriptionRecurring","SubscriptionPrices","prices$","proPrice$","prices","price","aiPrice$","readableLifetimePrice$","lifetimeAmount","fetchSubscriptionPrices","AccountChanged","onAccountChanged","createCheckoutSession","UserCopilotQuota","copilotActionLimit$","copilotActionUsed$","aiQuota","fetchUserCopilotQuota","limit","UserCopilotQuotaService","copilotQuota","reconnect","WebSocketService","ioManager","Manager","getAffineCloudBaseUrl","autoConnect","transports","secure","protocol","sockets","newSocket","socket","AuthStore","fetchService","gqlService","globalStateService","headers","uploadAvatarMutation","removeAvatarMutation","updateUserProfileMutation","getUserQuery","ServerConfigStore","serverConfigData","serverConfigQuery","ServerFeature","oauthProvidersData","oauthProvidersQuery","SUBSCRIPTION_CACHE_KEY","getDefaultSubscriptionSuccessCallbackLink","SubscriptionStore","globalCacheService","subscriptionQuery","resumeSubscriptionMutation","cancelSubscriptionMutation","updateSubscriptionMutation","createCheckoutSessionMutation","successCallbackLink","pricesQuery","UserCopilotQuotaStore","graphqlService","copilotQuotaQuery","UserFeatureStore","getUserFeaturesQuery","UserQuotaStore","quotaQuery","collectAllBlobSizes","configureCloudModule","FetchService","UserQuotaService","UserFeatureService","AccountLoggedIn","AccountLoggedOut","toAIUserInfo","onApplicationFocused","redirect","buildRedirectUri","openExternal","credential","signOut","hostname","port","rxFetch","externalSignal","timeoutId","statusText","userFeature","UserQuotaChanged","q","COLLECTIONS_KEY","COLLECTIONS_TRASH_KEY","collectionsYArray","toArray","collectionsTrash$","collectionsTrashYArray","collection$","updateFirstOfYArray","deletePageFromCollection","indexList","deletePagesFromCollection","idSet","newAllowList","array","configureCollectionModule","DocBacklinks","watchRefsTo","DocLinks","configureDocLinksModule","exhaustMapWithTrailing","defer","release$","source$","throttle","scheduled","asyncScheduler","finalize","IndexedDBJobQueue","databaseName","database","broadcast","BroadcastChannel","TIMEOUT","enqueue","ensureInitialized","trx","objectStore","batchKey","commit","postMessage","accept","batchKeys","currentBatchKey","currentBatchJobs","skipCurrentBatch","isAcceptable","waitForAccept","deferred","onmessage","return","nid","openDB","createObjectStore","autoIncrement","createIndex","isTimeout","remaining","JobRunner","worker","interval","defaultBM25params","bm25","termFreq","matchingCount","fieldLength","avgFieldLength","bm25params","invDocFreq","Match","scores","highlighters","getScore","addScore","score","currentScore","getHighlighters","addHighlighter","newRanges","ranges","and","newWeight","copyExtData","or","exclude","boost","asyncFilter","NGramTokenizer","tokenize","splitted","nextBreak","Graphemer","substring","term","tokens","GeneralTokenizer","tokenizeWord","word","testLang","token","StringInvertedIndex","fieldKey","objs","InvertedIndexKey","forString","IDBKeyRange","forPrefix","add1","terms","IntegerInvertedIndex","forInt64","BooleanInvertedIndex","forBoolean","FullTextInvertedIndex","queryTokens","matched","submatched","originTokenTerm","fromBuffer","asString","matchLength","pos","rs","positions","_end","maxScore","minScore","normalizedScore","highestScore","highestIndex","highestRanges","tokenMap","originString","kvMetadataStore","TextDecoder","asInt64","getBigInt64","carry","sum","TextEncoder","encode","setBigInt64","DataStruct","initializePromise","invertedIndex","iidx","getKey","indexId","getAllKeys","batchWrite","deletes","inserts","inst","matchAll","allNids","queryRaw","weights","queries","occur","pagination","nids","resultNode","hasMore","aggregate","hitPagination","hits","buckets","bucket","bucketIndex","Document","readwrite","keyPath","recordsStore","unique","invertedIndexStore","highlights","before","highlightValues","rawValues","highlighter","originText","after","maxPrefix","mergeRanges","intervals","firstMatch","pointer","matchStart","matchEnd","highlighted","IndexedDBIndex","broadcast$","channel","write","IndexedDBIndexWriter","search$","aggregate$","rollback","IndexedDBIndexStorage","getIndex","docIndexSchema","blockIndexSchema","createWorker","Worker","msgId","terminateAbort","currentMsgId","msgHandler","output","abortHandler","terminate","DocsIndexer","jobQueue","runner","execJob","requestIdleCallback","indexStorage","docIndex","blockIndex","workspaceEngine","setupListener","workerOutput","ensureWorker","performance","rootDocBuffer","allIndexedDocs","MAX_SAFE_INTEGER","docBuffer","deletedDoc","addedDoc","docIndexWriter","blockIndexWriter","oldBlocks","reindexDoc","startCrawling","handleWorkspaceEngineBeforeStart","indexer","firstMatchFlavour","blockContent","matchedBlockId","searchRefsFrom","docIds","refs","searchRefsTo","getDocTitle","configureDocsSearchModule","DEFAULT_COLLAPSABLE_STATE","organize","favoritesOld","migrationFavorites","ExplorerSection","collapsed$","EmptyNodeChildren","useExplorerCollectionNodeOperations","onOpenCollapsed","onOpenEdit","workbenchService","deleteInfo","addDocToCollection","handleToggleFavoriteCollection","handleAddDocToCollection","handleOpenInSplitView","openCollection","handleOpenInNewTab","openInNewTab","handleDeleteCollection","deleteOrganizeItem","handleShowEdit","CollectionIcon","ExplorerCollectionNode","reorderable","additionalOperations","dndData","handleRename","renameOrganizeItem","handleDropOnCollection","createOrganizeItem","handleDropEffectOnCollection","handleDropOnPlaceholder","finalOperations","handleCanDrop","entityType","ExplorerTreeNode","renameable","onRename","childrenPlaceholder","ExplorerCollectionNodeChildren","ExplorerDocNode","RootEmpty","onClickCreate","ExplorerEmptySection","messageTestId","actionText","onActionClick","ExplorerCollections","explorerService","ExplorerService","explorerSection","openCreateCollectionModel","CollapsibleSection","ExplorerTreeRoot","useSelectDialog","onOpenChanged","useSelectCollection","useSelectDoc","useSelectTag","FolderEmpty","FavoriteFolderOperation","ExplorerFolderNode","nodeId","defaultRenaming","organizeService","OrganizeService","folderTree","folderNode$","type$","handleDrop","ExplorerFolderNodeFolder","ExplorerTagNode","ExplorerFolderIcon","openDocsSelector","openTagsSelector","openCollectionsSelector","newFolderId","setNewFolderId","sortedChildren$","newName","handleDropOnFolder","beChildOf","moveHere","indexAt","moveOrganizeItem","createLink","handleDropEffect","handleDropOnChildren","dropAtNode","handleDropEffectOnChildren","handleChildrenCanDrop","handleNewDoc","handleCreateSubfolder","createFolder","handleAddToFolder","initialIds","selector","newItemIds","removedItemIds","removedItems","folderOperations","FolderIcon","PlusThickIcon","childrenOperations","RemoveFolderIcon","data-event-args-type","handleCollapsedChange","favoriteChildrenDropEffect","isFavoriteSupportType","favoriteRootDropEffect","sourceType","favoriteRootCanDrop","favoriteChildrenCanDrop","RootEmptyLoading","RootEmptyReady","DropEffect","ExplorerFavorites","sortedList$","handleCreateNewFavoriteDoc","handleOnChildrenDrop","reorder","orderOrganizeItem","headerRef","headerTestId","data-event-args-control","ExplorerFavoriteNode","childLocation","descriptionHighlight","ExplorerMigrationFavorites","migrationFavoriteItemsAdapter","MigrationFavoriteItemsAdapter","trashDocs","migrated","migrated$","favs","handleClickClear","markFavoritesMigrated","handleClickHelp","BroomIcon","migrationData","openMigrationDataHelp","HelpIcon","ExplorerMigrationFavoriteNode","OrganizeSupportType","isOrganizeSupportType","organizeChildrenDropEffect","organizeEmptyDropEffect","organizeEmptyRootCanDrop","ExplorerOrganize","rootFolder","handleCreateFolder","createFolderAndDrop","newFolder$","folder","configureExplorerModule","allSectionName","headerClassName","section","useExplorerDocNodeOperations","handleOpenInfoModal","handleMoveToTrash","handleAddLinkedPage","openNodeCollapsed","handleToggleFavoriteDoc","isLinked","docTitle","isInTrash","indexerLoading","referencesLoading","setReferencesLoading","handleDropOnDoc","handleDropEffectOnDoc","setEnableInfoModal","useExplorerTagNodeOperations","favorite$","tagRecord","deleteTag","openTag","handleToggleFavoriteTag","handleDropOnTag","tagDoc","handleDropEffectOnTag","ExplorerTagNodeDocs","tagDocIds","pageIds$","createPortal","MoveToIcon","RenameModal","currentName","ExplorerTreeContext","cid","useId","clickForCollapse","childCount","setChildCount","sidebarWidth","renaming","setRenaming","lastInGroup","setLastInGroup","__cid","isSelfDraggedOver","updateLastInGroup","lastElementChild","MutationObserver","childList","presetOperations","menuOperations","inlineOperations","sorted","contextValue","registerChild","data-self-dragged-over","FavoriteList","watchFavorites","watchIsLoading","watchFavorite","addFavorite","removeFavorite","reorderFavorite","targetRecord","sortedChildren","targetIndex","generateFractionalIndexingKeyBetween","FavoriteSupportType","FavoriteStore","workspaceDBService","userdataDB$","toRecord","encodeKey","parseKey","configureFavoriteModule","FindInPage","searchText$","isSearching$","direction$","visible$","result$","searchId","tap","debounceTime","findNext","findInPage","currentId","forward","onChangeVisible","toggleVisible","nextVisible","backward","FindInPageService","Navigator","history$","listen","backable$","forwardable$","back","resolveRouteLinkMeta","maybeAffineOrigin","moduleName","subModuleName","basename","isRouteModulePath","routeModulePaths","tooltipSideBottom","NavigationButtons","NavigatorService","backable","forwardable","handleBack","handleForward","configureNavigationModule","FolderNode","info$","watchNodeInfo","children$","watchNodeChildren","filterInvalidChildren","index$","childId","isAncestor","targetId","removeFolder","removeLink","moveNode","renameNode","FolderTree","folderStore","FolderStore","dbService","ancestorId","folderId","linkId","configureOrganizeModule","EMBED_DOC_FLAVOURS","isEmbedDocModel","blockModel","isImageBlockModel","isSurfaceRefModel","isAIChatBlockModel","PeekViewEntity","_active$","_show$","active$","show$","resolvedInfo","resolvePeekInfoFromPeekTarget","peekTarget","AffineReference","refMeta","refModel","referenceModel","HTMLAnchorElement","maybeDoc","firstValueFrom","WorkbenchLocationChanged","PeekViewContext","emptyContext","PeekViewModalContainer","controls","onAnimationStart","onAnimateEnd","dialogFrame","vtOpen","setVtOpen","animeState","setAnimeState","contentClipRef","contentRef","overlayRef","controlsRef","prevAnimeMap","animateControls","animateIn","anime","targets","translateX","zoomAnimate","zoomIn","paramsMap","contentClip","overlay","fromRect","toRect","lockSizeEl","contentWrapper","overlayAnime","contentAnime","contentWrapperAnime","ins","animateZoomIn","animateZoomOut","animateFade","PeekViewModalOverlay","onAnimationEnd","data-anime-state","data-padding","data-peek-view-wrapper","data-full-width-layout","useDoc","docListReady","setDoc","opened","DocPeekPreview","setEditor","resolvedMode","setResolvedMode","fitViewport","onResize","openSidebar","activeSidebarTab","PageNotFound","useZoomControls","zoomRef","imageRef","currentScale","setCurrentScale","isZoomedBigger","setIsZoomedBigger","setIsDragging","mouseX","setMouseX","mouseY","setMouseY","dragBeforeX","setDragBeforeX","dragBeforeY","setDragBeforeY","imagePos","setImagePos","handleDragStart","handleDrag","currentX","currentY","newPosX","newPosY","dragEndImpl","newPos","handleDragEnd","handleMouseUp","checkZoomSize","zoomArea","zoomedWidth","zoomedHeight","containerWidth","containerHeight","innerHeight","newScale","zoomOut","resetZoom","viewportWidth","viewportHeight","availableWidth","availableHeight","resetScale","handleScroll","deltaY","handleResize","passive","dividerStyle","filterImageBlock","imageUrlToBlob","arrayBuffer","fileTypeFromBuffer","Blob","mime","copyImageToClipboard","ClipboardItem","saveBufferToFile","blobUrl","download","ImagePreviewModalImpl","onBlockIdChange","setBlocks","goto","deleteHandler","newBlocks","toSpliced","downloadHandler","copyHandler","prevs","getPrevs","nexts","getNexts","prevBlock","findLast","nextBlock","useErrorBoundary","prevData","setPrevData","setUrl","data-blob-id","onMouseUp","onLoad","ViewBarIcon","MinusIcon","DownloadIcon","ErrorLogger","ImagePreviewErrorBoundary","ImagePreviewPeekView","setBlockId","buttonRef","ControlButton","nameKey","data-action-name","DefaultPeekViewControls","DocPeekViewControls","ExpandFullIcon","renderControls","getRendererProps","activePeekView","renderPeekView","PeekViewManagerModal","peekViewEntity","renderProps","BlockComponent","configurePeekViewModule","WorkspacePermission","fetchIsOwner","leaveWorkspace","WorkspacePermissionStore","getIsOwnerQuery","workspaceName","leaveWorkspaceMutation","configurePermissionsModule","ensuredRoot","ensuredPages","createYProxy","properties$","ensureRootProperties","defaultsDeep","journal","PageSystemPropertyId","Journal","favoritesMigrated","updateProperties","tagOptions$","updateTagOptions","updateTagOption","removeTagOption","updatePageTags","configureWorkspacePropertiesModule","TagOptionSchema","PagePropertyMetaBaseSchema","nativeEnum","PageSystemPropertyMetaBaseSchema","PageCustomPropertyMetaSchema","PageInfoItemSchema","any","PageInfoJournalItemSchema","PageInfoTagsItemSchema","WorkspaceFavoriteItemSchema","WorkspaceAffinePropertiesSchemaSchema","PageInfoCustomPropertyItemSchema","WorkspacePagePropertiesSchema","CollectionsQuickSearchSession","query$","items$","Fuse","includeMatches","includeScore","ignoreLocation","threshold","nomalizedRange","titleMatches","indices","CommandsQuickSearchSession","contextService","Always","InEdgeless","InPaper","InPaperOrEdgeless","Never","fuse","normalizedRange","subTitleMatches","keyWord","docDisplayMetaService","isIndexerLoading$","isQueryLoading$","out","getDocDisplayMeta","truncate","timestamp","setQuery","recentDocsService","docRecords","getRecentDocs","QuickSearch","state$","sessions","options$","loadingProgress$","mean","sources","DocDisplayMetaService","propertiesAdapter","originalTitle","RECENT_PAGES_KEY","EMPTY_ARRAY","RecentDocsService","addRecentDoc","recentPages","getRecentDocIds","HighlightText","part","ending","CMDK","newGroups","inputLabel","newLoading","loadingProgress","onQueryChange","onSubmit","opening","setOpening","selectedValue","dispatch","firstItem","prevGroups","prevSelectedValue","prevFirstItem","newFirstItem","selectedExists","handleValueChange","handleSelectChange","Command","shouldFilter","data-opening","CMDKGroup","i18n","Group","overflowAnchor","isI18nString","data-is-danger","CMDKKeyBinding","isMacOS","fragments","fragment","QuickSearchModal","QuickSearchContainer","onToggleQuickSearch","existingGroup","handleChangeQuery","handleSubmit","configureQuickSearchModule","CMDKQuickSearchService","recent","recentDocs","searchResultsDocs","WorkspaceQuota","fetchWorkspaceQuota","WorkspaceQuotaService","WorkspaceQuotaStore","workspaceQuotaQuery","configureQuotaModule","Share","isShared$","sharedMode$","getShareInfoByDocId","enableShare","enableSharePage","changeShare","disableShare","disableSharePage","ShareService","ShareDocsList","getWorkspacesShareDocs","ShareStore","getWorkspacePublicPageByIdQuery","publishPageMutation","revokePublicPageMutation","ShareDocsStore","getWorkspacePublicPagesQuery","publicPages","configureShareDocsModule","tagColorMap","tagOption$","watchTagInfo","tagInfo","createDate$","updateDate$","updateDate","updateTagInfo","pageRecord","TagList","watchTagIds","createNewTag","filterFn","trimmedQuery","trimmedValue","tagColorIds","randomIndex","selectedTags","TagStore","configureTagModule","ThemeEditorService","customTheme$","removeEmpty","modified$","isEmptyObj","setCustomTheme","updateCustomTheme","useCustomTheme","themeEditor","CustomThemeModifier","documentElement","ThemeEmpty","colorCellColor","colorCellRow","colorCellValue","ThemeTreeNode","setActive","isCustomized","isLeaf","data-checked","data-customized","PaletteIcon","variableNameToParts","partsToVariableName","isColor","SimpleColorPicker","ColorCell","data-override","data-custom","ul","StringCell","VariableList","customTheme","li","textDecoration","variableName","Renderer","sortTree","compare","walk","getTree","allKeys","rootNodesSet","nodeMap","ancestors","affineThemes","v1","lightCssVariables","darkCssVariables","v2","lightCssVariablesV2","darkCssVariablesV2","ThemeEditor","setVersion","activeNode","setActiveNode","customizedNodeIds","setCustomizedNodeIds","onToggleVersion","configureThemeEditorModule","SidebarTab","createNavigableHistory","initialEntries","initialIndex","freeze","createKey","parsePath","Action","Pop","createEvents","blockers","getNextLocation","allowTx","applyTx","nextAction","nextLocation","go","nextIndex","createHref","createPath","Push","Replace","blocker","substr","cond","lowerBound","upperBound","View","ViewScope","sidebarTabs$","_activeSidebarTabId$","activeSidebarTab$","activeTabId","tabs","tab","entries$","size$","icon$","defaultLocation","setSize","addSidebarTab","removeSidebarTab","setTitle","setIcon","Workbench","newTabHandler","activeViewIndex$","activeViewIndex","basename$","views$","activeIndex","sidebarOpen$","updateBasename","createView","newViews","closeSidebar","toggleSidebar","replaceHistory","viewAt","newIndex","openCollections","openTrash","openTags","positionIndex","closeOthers","moveView","fromView","toView","resize","nextView","totalViewSize","percentOfTotal","newSize","newNextSize","useIsActiveView","ViewService","createIsland","targetLiveData$","Target","ViewIslandRegistryContext","ViewIslandSetContext","ViewIsland","setter","island","ViewIslandTarget","ViewIslandRegistryProvider","setContextValue","ViewBody","ViewBodyTarget","viewId","ViewHeader","ViewHeaderTarget","ViewSidebarTab","tabId","unmountOnInactive","ViewSidebarTabIconTarget","ViewSidebarTabBodyTarget","Container","data-sidebar-floating","ToggleButton","onToggle","RightSidebarIcon","SidebarHeaderSwitcher","tabItems","handleActiveTabChange","viewService","sidebarTabs","handleToggleOpen","sidebar","SplitViewMenuIndicator","setPressed","onOpenMenu","SplitViewIndicator","setOpenMenuManually","menuRootOptions","menuContentOptions","data-is-dragging","SplitViewPanel","setSlots","indicatorPressed","setIndicatorPressed","dndIsDragging","dragStyle","data-is-active","data-is-last","SplitViewMenu","viewIndex","handleMoveLeft","handleMoveRight","handleCloseOthers","CloseItem","ExpandCloseIcon","MoveLeftItem","MoveToLeftDuotoneIcon","FullScreenItem","SoloViewIcon","MoveRightItem","MoveToRightDuotoneIcon","onResizeEnd","prevPos","SplitView","renderer","onMove","resizingViewId","setResizingViewId","rootEl","rootRect","resizeHandleRenderer","dxy","fromIndex","toIndex","data-orientation","collisionDetection","closestCenter","strategy","horizontalListSortingStrategy","RouteContainer","route","viewPosition","useViewPosition","leftSidebarOpen","sidebarOpen","handleToggleSidebar","isFirst","warpedRoutes","viewRoutes","lazy","reactLazy","ViewRoot","viewRouter","createMemoryRouter","UNSAFE_LocationContext","UNSAFE_RouteContext","outlet","isDataRoute","RouterProvider","useAdapter","browserLocation","newLocation","newBrowserLocation","WorkbenchRoot","panelRenderer","WorkbenchView","WorkbenchSidebar","handleOnFocus","handleOpenChange","WorkbenchNewTabHandler","BrowserWorkbenchNewTabHandler","WorkbenchDefaultState","InMemoryWorkbenchDefaultState","configureBrowserWorkbenchModule","configureWorkbenchCommonModule","DesktopStateSynchronizer","startSync","onTabAction","onToggleRightSidebar","updateWorkbenchMeta","setPosition","calcPosition","viewList","ViewTitle","defaultPrevented","altKey","CloudBlobStorage","bufferToBlob","setBlobMutation","setBlob","deleteBlobMutation","listBlobsQuery","listBlobs","BroadcastChannelAwarenessConnection","handleAwarenessUpdate","changes","changedClients","encodeAwarenessUpdate","handleChannelMessage","applyAwarenessUpdate","clientID","uint8ArrayToBase64","dataUrl","base64ToUint8Array","base64","binaryString","CloudAwarenessConnection","awarenessBroadcast","wsId","awarenessUpdate","encodedUpdate","newClientAwarenessInitHandler","encodedAwarenessUpdate","windowBeforeUnloadHandler","removeAwarenessStates","handleConnect","handleReject","connected","predefinedStaticFiles","StaticBlobStorage","_TEST_SIMULATE_SYNC_LAG","CloudDocEngineServer","interruptCb","SEND_TIMEOUT","handleInterrupted","handleDisconnect","handleVersionRejected","clientHandShake","emitWithAck","missing","ErrorNames","DOC_NOT_FOUND","handleUpdate","CloudStaticDocStorage","CLOUD_WORKSPACES_CACHE_KEY","CloudWorkspaceFlavourProviderService","storageProvider","webSocketService","getWorkspacesQuery","deleteWorkspaceMutation","waitForLoaded","createWorkspaceMutation","getBlobStorage","docStorage","getWorkspaceProfile","cloudStorage","localData","cloudData","getIsOwner","bs","localBlob","cloudBlob","IndexedDBBlobStorage","mimeTypeDb","BroadcastChannelDocEventBus","senderChannel","IndexedDBDocStorage","KV","dbName","dbPromise","dbVersion","upgradeDB","getDb","rows","KVBehavior","LOCAL_WORKSPACE_LOCAL_STORAGE_KEY","LOCAL_WORKSPACE_CHANGED_BROADCAST_CHANNEL_KEY","LocalWorkspaceFlavourProvider","notifyChannel","allWorkspaceIDs","WorkspaceEngineStorageProvider","configureBrowserWorkspaceFlavours","configureIndexedDBWorkspaceEngineStorageProvider","_addLocalWorkspace","isSVG","isSvgBuffer","fastCheckIsNotSvg","ch","decoder","isSvg","NotFoundPattern","strokeOpacity","largeButtonEffect","notFoundPageContainer","NoPermissionOrNotFound","onSignOut","signInComponent","SignOutIcon","NotFoundPage","handleBackButtonClick","handleOpenSignOutModal","onConfirmSignOut","pingAppLayoutReady","SignIn","isLoggedIn","onSetEmailType","onSetAuthState","onSetAuthEmail","topLevelRoutes","setReady","Outlet","RootRouter","loader","createBrowserRouter","wrapCreateBrowserRouter","reactRouterCreateBrowserRouter","SENTRY_RELEASE","future","v7_normalizeFormMethod","performanceLogger","performanceRenderLogger","createEmotionCache","insertionPoint","emotionInsertionPoint","createCache","oa","getLargestOrder","lastItem","getSmallestOrder","generateKeyBetween","fromId","toId","fromItem","toItem","toNextItem","toOrder","toNextOrder","toItemPrev","toItemNext","toItemOrder","toItemPrevOrder","toItemNextOrder","insertBefore","beforeId","beforeItemIndex","beforeItem","beforeItemPrev","beforeOrder","beforePrevOrder","randomString","crypto","getRandomValues","chars","subkey","randomSize","aSubkey","bSubkey","ctrlKey","metaKey","HTMLDivElement","basicToast","decodeAndReduceImage","sizeInMB","unsharpAmount","unsharpRadius","unsharpThreshold","reducedBlob","sharedStorage","INTERNAL_SERVER_ERROR","stacktrace","BaseGraphQLError","formatRequestBody","keepNilVariables","filterEmptyValue","newVars","isNil","isObject","operationName","containsFile","transformToForm","FormData","gqlBody","files","buildMap","isFormData","definitionName","firstError","passwordLimitsFragment","credentialsRequirementFragment","changeEmailMutation","changePasswordMutation","createCustomerPortalMutation","getCurrentUserQuery","getInviteInfoQuery","getMemberCountByWorkspaceIdQuery","getMembersByWorkspaceIdQuery","getServerRuntimeConfigQuery","listHistoryQuery","getInvoicesCountQuery","invoicesQuery","recoverDocMutation","revokeMemberPermissionMutation","sendVerifyChangeEmailMutation","updateServerRuntimeConfigsMutation","verifyEmailMutation","inviteByEmailMutation","acceptInviteByInviteIdMutation","CopilotModels","CopilotPromptMessageRole","InvoiceStatus","Permission","RuntimeConfigType","ServerDeploymentType","SubscriptionStatus","LOCALES","flagEmoji","base","completeRate","ko","pt_BR","en","zh_Hans","fr","es","de","ru","ja","it","ca","da","en_US","es_CL","hi","sv_SE","es_AR","ur","ar","createI18nWrapper","getI18nFn","getI18nT","i18nStr","changeLanguage","lng","useTranslation","getI18n","timeUnitCode","second","minute","hour","defaultRelativeOption","yesterdayAndTomorrow","relativeOption","absoluteOption","noYear","noDate","formatter","Intl","RelativeTimeFormat","numeric","processor","diffSecond","trunc","diffMinute","diffHour","diffDay","DateTimeFormat","inSameMonth","diffWeek","diffMonth","diffYear","STORAGE_KEY","resources","translation","standardizeLocale","locale","createI18n","i18next","initReactI18next","fallbackLng","interpolation","escapeValue","setUpLanguage","localStorageLanguage","ProviderComposer","contexts","reduceRight","kids","themes","DesktopThemeSync","lastThemeRef","onceRef","handleThemeChange","ThemeProvider","NextThemeProvider","enableSystem","AffineContext","DocsStore","configureGlobalStorageModule","isLoadings","WorkspaceProfile","watchProfileCache","setProfile","setProfileCache","syncWithWorkspace","WorkspaceLocalStateImpl","wrapped","WorkspaceLocalCacheImpl","WorkspaceDestroyService","WorkspaceFactoryService","WorkspaceListService","WorkspaceProfileService","WorkspaceRepositoryService","customProvider","isSharedMode","instantiate","fixWorkspaceVersion","doFix","WorkspaceTransformService","newMetadata","newSubdoc","WORKSPACE_PROFILE_CACHE_KEY","WorkspaceProfileCacheStore","updateIdentity","onAccountLoggedOut","onUserQuotaChanged","TelemetryService","prevQuota","registerMiddlewares","$email","$name","$avatar","humanReadable","_event","parameters","extractGlobalContext","LocalStorageMemento","removeItem","LocalStorageGlobalCache","LocalStorageGlobalState","Telemetry","performanceI18nLogger","DebugProvider","v7_startTransition","loadLanguage","languageLoadingPromise","configureCommonModules","configureWorkspaceModule","configureDocModule","configureWorkspaceDBModule","configureGlobalContextModule","configureLifecycleModule","configureTelemetryModule","configureFindInPageModule","configureLocalStorageStateStorageImpls","frameworkProvider","App","CacheProvider","fallbackElement","performanceMainLogger","windowName","dsn","integrations","reactRouterV6BrowserTracingIntegration","useNavigationType","createRoutesFromChildren","matchRoutes","setTags","mountApp","createRoot","StrictMode","Segmenter","configurable","writable","didTimeout","timeRemaining","cancelIdleCallback"],"sourceRoot":""}