{"version":3,"file":"js/chunk.5670.d558d694.js","mappings":"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","sources":["webpack://@affine/web/../core/src/pages/open-app.css.ts","webpack://@affine/web/../core/src/pages/open-app.tsx"],"sourcesContent":["import \"../core/src/pages/open-app.css.ts.vanilla.css!=!../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/pages/open-app.css.ts.vanilla.css\\\",\\\"source\\\":\\\"LnY5MzI3dDAgewogIGhlaWdodDogMTAwdmg7CiAgd2lkdGg6IDEwMHZ3OwogIGRpc3BsYXk6IGZsZXg7CiAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBmb250LXNpemU6IHZhcigtLWFmZmluZS1mb250LWJhc2UpOwogIHBvc2l0aW9uOiByZWxhdGl2ZTsKfQoudjkzMjd0MSB7CiAgY29sb3I6IGluaGVyaXQ7Cn0KLnY5MzI3dDIgewogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICB0b3A6IDA7CiAgbGVmdDogMDsKICByaWdodDogMDsKICBkaXNwbGF5OiBmbGV4OwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOwogIHBhZGRpbmc6IDE2cHggMTIwcHg7Cn0KLnY5MzI3dDMgewogIGRpc3BsYXk6IGZsZXg7CiAgY29sdW1uLWdhcDogNHB4Owp9Ci52OTMyN3Q0IHsKICBjb2xvcjogdmFyKC0tYWZmaW5lLXRleHQtcHJpbWFyeS1jb2xvcik7CiAgZm9udC1zaXplOiB2YXIoLS1hZmZpbmUtZm9udC1zbSk7CiAgZm9udC13ZWlnaHQ6IDUwMDsKICB0ZXh0LWRlY29yYXRpb246IG5vbmU7CiAgcGFkZGluZzogNHB4IDE4cHg7Cn0KLnY5MzI3dDUgewogIGNvbG9yOiB2YXIoLS1hZmZpbmUtbGluay1jb2xvcik7CiAgZm9udC13ZWlnaHQ6IDUwMDsKICB0ZXh0LWRlY29yYXRpb246IG5vbmU7CiAgZm9udC1zaXplOiB2YXIoLS1hZmZpbmUtZm9udC1zbSk7Cn0KLnY5MzI3dDYgewogIGRpc3BsYXk6IGZsZXg7CiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICBhbGlnbi1pdGVtczogY2VudGVyOwogIG1hcmdpbi10b3A6IDQwcHg7Cn0KLnY5MzI3dDcgewogIG1hcmdpbi10b3A6IDIwcHg7CiAgbWFyZ2luLWJvdHRvbTogMTJweDsKfQ==\\\"}!../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var affineLogo = 'v9327t1';\nexport var centerContent = 'v9327t6';\nexport var prompt = 'v9327t7';\nexport var root = 'v9327t0';\nexport var topNav = 'v9327t2';\nexport var topNavLink = 'v9327t4';\nexport var topNavLinks = 'v9327t3';\nexport var tryAgainLink = 'v9327t5';","import { Button } from '@affine/component/ui/button';\nimport type { GetCurrentUserQuery } from '@affine/graphql';\nimport { fetcher, getCurrentUserQuery } from '@affine/graphql';\nimport { Trans, useI18n } from '@affine/i18n';\nimport { Logo1Icon } from '@blocksuite/icons/rc';\nimport { useCallback, useMemo } from 'react';\nimport type { LoaderFunction } from 'react-router-dom';\nimport { useLoaderData, useSearchParams } from 'react-router-dom';\nimport { z } from 'zod';\n\nimport * as styles from './open-app.css';\n\nlet lastOpened = '';\n\nconst appSchemas = z.enum([\n  'affine',\n  'affine-canary',\n  'affine-beta',\n  'affine-internal',\n  'affine-dev',\n]);\n\nconst appChannelSchema = z.enum(['stable', 'canary', 'beta', 'internal']);\n\ntype Schema = z.infer<typeof appSchemas>;\ntype Channel = z.infer<typeof appChannelSchema>;\n\nconst schemaToChanel = {\n  affine: 'stable',\n  'affine-canary': 'canary',\n  'affine-beta': 'beta',\n  'affine-internal': 'internal',\n  'affine-dev': 'canary', // dev does not have a dedicated app. use canary as the placeholder.\n} as Record<Schema, Channel>;\n\nexport const appIconMap = {\n  stable: '/imgs/app-icon-stable.ico',\n  canary: '/imgs/app-icon-canary.ico',\n  beta: '/imgs/app-icon-beta.ico',\n  internal: '/imgs/app-icon-internal.ico',\n} satisfies Record<Channel, string>;\n\nexport const appNames = {\n  stable: 'AFFiNE',\n  canary: 'AFFiNE Canary',\n  beta: 'AFFiNE Beta',\n  internal: 'AFFiNE Internal',\n} satisfies Record<Channel, string>;\n\ninterface OpenAppProps {\n  urlToOpen?: string | null;\n  channel: Channel;\n}\n\ninterface LoaderData {\n  action: 'url' | 'signin-redirect';\n  currentUser?: GetCurrentUserQuery['currentUser'];\n}\n\nconst OpenAppImpl = ({ urlToOpen, channel }: OpenAppProps) => {\n  const t = useI18n();\n  const openDownloadLink = useCallback(() => {\n    const url = `https://affine.pro/download?channel=${channel}`;\n    open(url, '_blank');\n  }, [channel]);\n  const appIcon = appIconMap[channel];\n  const appName = appNames[channel];\n  const [params] = useSearchParams();\n  const autoOpen = useMemo(() => params.get('open') !== 'false', [params]);\n\n  if (urlToOpen && lastOpened !== urlToOpen && autoOpen) {\n    lastOpened = urlToOpen;\n    location.href = urlToOpen;\n  }\n\n  if (!urlToOpen) {\n    return null;\n  }\n\n  return (\n    <div className={styles.root}>\n      <div className={styles.topNav}>\n        <a href=\"/\" rel=\"noreferrer\" className={styles.affineLogo}>\n          <Logo1Icon width={24} height={24} />\n        </a>\n\n        <div className={styles.topNavLinks}>\n          <a\n            href=\"https://affine.pro\"\n            target=\"_blank\"\n            rel=\"noreferrer\"\n            className={styles.topNavLink}\n          >\n            Official Website\n          </a>\n          <a\n            href=\"https://community.affine.pro/home\"\n            target=\"_blank\"\n            rel=\"noreferrer\"\n            className={styles.topNavLink}\n          >\n            AFFiNE Community\n          </a>\n          <a\n            href=\"https://affine.pro/blog\"\n            target=\"_blank\"\n            rel=\"noreferrer\"\n            className={styles.topNavLink}\n          >\n            Blog\n          </a>\n          <a\n            href=\"https://affine.pro/about-us\"\n            target=\"_blank\"\n            rel=\"noreferrer\"\n            className={styles.topNavLink}\n          >\n            Contact us\n          </a>\n        </div>\n\n        <Button onClick={openDownloadLink}>\n          {t['com.affine.auth.open.affine.download-app']()}\n        </Button>\n      </div>\n\n      <div className={styles.centerContent}>\n        <img src={appIcon} alt={appName} width={120} height={120} />\n\n        <div className={styles.prompt}>\n          <Trans i18nKey=\"com.affine.auth.open.affine.prompt\">\n            Open {appName} app now\n          </Trans>\n        </div>\n\n        <a\n          className={styles.tryAgainLink}\n          href={urlToOpen}\n          target=\"_blank\"\n          rel=\"noreferrer\"\n        >\n          {t['com.affine.auth.open.affine.try-again']()}\n        </a>\n      </div>\n    </div>\n  );\n};\n\nconst OpenUrl = () => {\n  const [params] = useSearchParams();\n  const urlToOpen = useMemo(() => params.get('url'), [params]);\n  const channel = useMemo(() => {\n    const urlObj = new URL(urlToOpen || '');\n    const maybeSchema = appSchemas.safeParse(urlObj.protocol.replace(':', ''));\n    return schemaToChanel[maybeSchema.success ? maybeSchema.data : 'affine'];\n  }, [urlToOpen]);\n\n  return <OpenAppImpl urlToOpen={urlToOpen} channel={channel} />;\n};\n\nconst OpenOAuthJwt = () => {\n  const { currentUser } = useLoaderData() as LoaderData;\n  const [params] = useSearchParams();\n  const schema = useMemo(() => {\n    const maybeSchema = appSchemas.safeParse(params.get('schema'));\n    return maybeSchema.success ? maybeSchema.data : 'affine';\n  }, [params]);\n  const next = useMemo(() => params.get('next'), [params]);\n  const channel = schemaToChanel[schema as Schema];\n\n  if (!currentUser || !currentUser?.token?.sessionToken) {\n    return null;\n  }\n\n  const urlToOpen = `${schema}://signin-redirect?token=${\n    currentUser.token.sessionToken\n  }&next=${next || ''}`;\n\n  return <OpenAppImpl urlToOpen={urlToOpen} channel={channel} />;\n};\n\nexport const Component = () => {\n  const { action } = useLoaderData() as LoaderData;\n\n  if (action === 'url') {\n    return <OpenUrl />;\n  } else if (action === 'signin-redirect') {\n    return <OpenOAuthJwt />;\n  }\n  return null;\n};\n\nexport const loader: LoaderFunction = async args => {\n  const action = args.params.action || '';\n  const res = await fetcher({\n    query: getCurrentUserQuery,\n  }).catch(console.error);\n\n  return {\n    action,\n    currentUser: res?.currentUser || null,\n  };\n};\n"],"names":["topNavLink","lastOpened","appSchemas","z","enum","schemaToChanel","affine","appIconMap","stable","canary","beta","internal","appNames","OpenAppImpl","urlToOpen","channel","t","useI18n","openDownloadLink","useCallback","open","appIcon","appName","params","useSearchParams","autoOpen","useMemo","get","location","href","div","className","a","rel","Logo1Icon","width","height","target","styles","Button","onClick","img","src","alt","Trans","i18nKey","OpenUrl","urlObj","URL","maybeSchema","safeParse","protocol","replace","success","data","OpenOAuthJwt","currentUser","useLoaderData","schema","next","token","sessionToken","Component","action","loader","args","res","fetcher","query","getCurrentUserQuery","catch","console","error"],"sourceRoot":""}