"use strict";(globalThis.webpackChunk_affine_web=globalThis.webpackChunk_affine_web||[]).push([[9007],{99029:(e,n,t)=>{t.d(n,{k:()=>u,J:()=>f});var a=t(36870),i=t(4588),s=t(24312),l=t(37064),o=t(86326),r="t5nkbg2",c="t5nkbg0";let m=({to:e,okText:n,cancelText:t,onCancel:s,onConfirm:o})=>(0,a.jsxs)("div",{className:"t5nkbg1",children:[(0,a.jsx)(i.$n,{className:(0,l.A)(r,"t5nkbg4"),size:"default",onClick:s,variant:"plain",children:t}),(0,a.jsx)("a",{href:e,target:"_blank",rel:"noreferrer",children:(0,a.jsx)(i.$n,{onClick:o,className:(0,l.A)(r,"t5nkbg3"),variant:"plain",children:n})})]}),d=environment.isDesktop,f=()=>{let e=(0,s.s9)(),n=(0,o.useRef)(null);return(0,o.useCallback)(t=>{n.current&&i.me.dismiss(n.current);let s=(0,i.me)({title:(0,a.jsx)("span",{className:c,children:e["com.affine.payment.upgrade-success-notify.title"]()}),message:e["com.affine.payment.upgrade-success-notify.content"](),alignMessage:"title",icon:null,footer:(0,a.jsx)(m,{to:t,okText:d?e["com.affine.payment.upgrade-success-notify.ok-client"]():e["com.affine.payment.upgrade-success-notify.ok-web"](),cancelText:e["com.affine.payment.upgrade-success-notify.later"](),onCancel:()=>i.me.dismiss(s),onConfirm:()=>i.me.dismiss(s)})},{duration:864e5});n.current=s},[e])},u=()=>{let e=(0,s.s9)(),n=(0,o.useRef)(null);return(0,o.useCallback)(t=>{n.current&&i.me.dismiss(n.current);let s=(0,i.me)({title:(0,a.jsx)("span",{className:c,children:e["com.affine.payment.downgraded-notify.title"]()}),message:e["com.affine.payment.downgraded-notify.content"](),alignMessage:"title",icon:null,footer:(0,a.jsx)(m,{to:t,okText:d?e["com.affine.payment.downgraded-notify.ok-client"]():e["com.affine.payment.downgraded-notify.ok-web"](),cancelText:e["com.affine.payment.downgraded-notify.later"](),onCancel:()=>i.me.dismiss(s),onConfirm:()=>i.me.dismiss(s)})},{duration:864e5});n.current=s},[e])}},29007:(e,n,t)=>{t.d(n,{Pc:()=>u,e6:()=>p,ed:()=>f,f2:()=>k,tp:()=>y});var a=t(99029),i=t(94002),s=t(53216),l=t(30397),o=t(86326),r=t(4194);let c=(0,l.Ak)(),m="subscription-succeed-info",d=(e,n)=>{let t=(Array.isArray(n.plan)?n.plan:[n.plan]).map(e=>e===s.R$.AI?"ai":"cloud").join("-"),a=n.recurring===s.zS.Monthly?"monthly":n.recurring===s.zS.Lifetime?"lifeTime":"annually";return`https://6dxre9ihosp.typeform.com/to/${e}#email=${n.email??""}&name=${n.name??"Unknown"}&user_id=${n.id}&product_id=${t}&product_price=${a}`},f=e=>d("mUMGGQS8",e),u=e=>d("RvD9AoRg",e),p=(e,n,t)=>{if(null===e)throw Error("Account is required");let a=n===s.R$.AI?"/ai-upgrade-success":"/upgrade-success",i=e?.info?.name??"";i.includes("::")&&(i=i.replaceAll("::",c));let l=[n,t,e.id,e.email,e.info?.name??""].join("::");return`${a}?info=${encodeURIComponent(l)}`},g=e=>{let[n,t,a,i,s]=decodeURIComponent(e).split("::");return{plan:n,recurring:t,account:{id:a,email:i,info:{name:s.replaceAll(c,"::")}}}},k=()=>{let[e]=(0,r.ok)();(0,o.useEffect)(()=>{let n=e.get("info");n&&(localStorage.setItem(m,n),e.delete("info"))},[e])},y=()=>{let e=(0,a.J)(),n=(0,o.useCallback)(()=>{let n=localStorage.getItem(m);if(n)try{let{plan:t,recurring:a,account:s}=g(n),l=f({id:s.id,email:s.email,name:s.info?.name??"",plan:t,recurring:a});e(l),localStorage.removeItem(m),i.u4.$.settingsPanel.plans.subscribe({plan:t,recurring:a})}catch(e){console.error("Failed to parse subscription callback link",e)}},[e]);(0,o.useEffect)(()=>(n(),window.addEventListener("focus",n),()=>{window.removeEventListener("focus",n)}),[n])}}}]);
//# sourceMappingURL=chunk.9007.4ea2ffa2.js.map