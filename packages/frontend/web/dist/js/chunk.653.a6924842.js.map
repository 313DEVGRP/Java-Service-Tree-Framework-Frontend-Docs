{"version":3,"file":"js/chunk.653.a6924842.js","mappings":"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","sources":["webpack://@affine/web/../core/src/hooks/use-block-suite-workspace-page-title.ts","webpack://@affine/web/../core/src/atoms/page-history.ts","webpack://@affine/web/../core/src/components/affine/page-history-modal/data.ts","webpack://@affine/web/../core/src/components/affine/page-history-modal/empty-history-shape.tsx","webpack://@affine/web/../core/src/components/affine/page-history-modal/styles.css.ts","webpack://@affine/web/../core/src/components/affine/page-history-modal/history-modal.tsx","webpack://@affine/web/../core/src/components/pure/trash-page-footer/styles.css.ts","webpack://@affine/web/../core/src/components/pure/trash-page-footer/index.tsx","webpack://@affine/web/../component/src/components/affine-banner/browser-warning.tsx","webpack://@affine/web/../component/src/components/affine-banner/index.css.ts","webpack://@affine/web/../component/src/components/affine-banner/local-demo-tips.tsx","webpack://@affine/web/../core/src/components/top-tip.tsx","webpack://@affine/web/../core/src/hooks/affine/use-export-page.ts","webpack://@affine/web/../core/src/components/blocksuite/block-suite-header/favorite/index.tsx","webpack://@affine/web/../core/src/components/blocksuite/block-suite-header/info/index.tsx","webpack://@affine/web/../core/src/components/blocksuite/block-suite-header/journal/date-picker.tsx","webpack://@affine/web/../core/src/components/blocksuite/block-suite-header/journal/today-button.tsx","webpack://@affine/web/../core/src/components/affine/share-page-modal/share-menu/index.css.ts","webpack://@affine/web/../core/src/hooks/affine/use-share-url.ts","webpack://@affine/web/../core/src/components/affine/share-page-modal/share-menu/share-export.tsx","webpack://@affine/web/../core/src/components/affine/share-page-modal/share-menu/share-page.tsx","webpack://@affine/web/../core/src/components/affine/share-page-modal/share-menu/share-menu.tsx","webpack://@affine/web/../core/src/pages/workspace/detail-page/use-header-responsive.ts","webpack://@affine/web/../core/src/components/pure/header-drop-down-button/index.tsx","webpack://@affine/web/../core/src/components/pure/header-drop-down-button/styles.css.ts","webpack://@affine/web/../core/src/components/blocksuite/block-suite-header/menu/index.tsx","webpack://@affine/web/../core/src/components/blocksuite/block-suite-header/present/detail-header-present-button.tsx","webpack://@affine/web/../core/src/components/affine/share-page-modal/index.tsx","webpack://@affine/web/../core/src/pages/workspace/detail-page/detail-page-header.css.ts","webpack://@affine/web/../core/src/pages/workspace/detail-page/detail-page-header.tsx","webpack://@affine/web/../core/src/hooks/affine/use-register-copy-link-commands.tsx","webpack://@affine/web/../core/src/pages/workspace/detail-page/tabs/frame.tsx","webpack://@affine/web/../core/src/pages/workspace/detail-page/tabs/frame.css.ts","webpack://@affine/web/../core/src/pages/workspace/detail-page/tabs/journal.css.ts","webpack://@affine/web/../core/src/pages/workspace/detail-page/tabs/journal.tsx","webpack://@affine/web/../core/src/pages/workspace/detail-page/tabs/outline.tsx","webpack://@affine/web/../core/src/pages/workspace/detail-page/tabs/outline.css.ts","webpack://@affine/web/../core/src/pages/workspace/detail-page/detail-page.tsx","webpack://@affine/web/../core/src/hooks/affine/use-register-blocksuite-editor-commands.tsx","webpack://@affine/web/../core/src/pages/workspace/detail-page/detail-page.css.ts"],"sourcesContent":["import { assertExists } from '@blocksuite/global/utils';\nimport type { DocCollection } from '@blocksuite/store';\nimport type { Atom } from 'jotai';\nimport { atom, useAtomValue } from 'jotai';\nimport { useCallback } from 'react';\n\nimport { useJournalHelper, useJournalInfoHelper } from './use-journal';\n\nconst weakMap = new WeakMap<DocCollection, Map<string, Atom<string>>>();\n\nfunction getAtom(w: DocCollection, pageId: string): Atom<string> {\n  if (!weakMap.has(w)) {\n    weakMap.set(w, new Map());\n  }\n  const map = weakMap.get(w);\n  assertExists(map);\n  if (!map.has(pageId)) {\n    const baseAtom = atom<string>(w.getDoc(pageId)?.meta?.title || 'Untitled');\n    baseAtom.onMount = set => {\n      const disposable = w.meta.docMetaUpdated.on(() => {\n        const page = w.getDoc(pageId);\n        set(page?.meta?.title || 'Untitled');\n      });\n      return () => {\n        disposable.dispose();\n      };\n    };\n    map.set(pageId, baseAtom);\n    return baseAtom;\n  } else {\n    return map.get(pageId) as Atom<string>;\n  }\n}\n\nexport function useDocCollectionPageTitle(\n  docCollection: DocCollection,\n  pageId: string\n) {\n  const titleAtom = getAtom(docCollection, pageId);\n  assertExists(titleAtom);\n  const title = useAtomValue(titleAtom);\n  const { localizedJournalDate } = useJournalInfoHelper(docCollection, pageId);\n  return localizedJournalDate || title;\n}\n\n// This hook is NOT reactive to the page title change\nexport function useGetDocCollectionPageTitle(docCollection: DocCollection) {\n  const { getLocalizedJournalDateString } = useJournalHelper(docCollection);\n  return useCallback(\n    (pageId: string) => {\n      return (\n        getLocalizedJournalDateString(pageId) ||\n        docCollection.getDoc(pageId)?.meta?.title\n      );\n    },\n    [docCollection, getLocalizedJournalDateString]\n  );\n}\n","import { atom } from 'jotai';\n\n// make page history controllable by atom to make it easier to use in CMDK\nexport const pageHistoryModalAtom = atom({\n  open: false,\n  pageId: '',\n});\n","import { useDocMetaHelper } from '@affine/core/hooks/use-block-suite-page-meta';\nimport { useDocCollectionPage } from '@affine/core/hooks/use-block-suite-workspace-page';\nimport { DebugLogger } from '@affine/debug';\nimport type { ListHistoryQuery } from '@affine/graphql';\nimport { listHistoryQuery, recoverDocMutation } from '@affine/graphql';\nimport { i18nTime } from '@affine/i18n';\nimport { assertEquals } from '@blocksuite/global/utils';\nimport { DocCollection } from '@blocksuite/store';\nimport { globalBlockSuiteSchema } from '@toeverything/infra';\nimport { useEffect, useMemo } from 'react';\nimport useSWRImmutable from 'swr/immutable';\nimport {\n  applyUpdate,\n  Doc as YDoc,\n  encodeStateAsUpdate,\n  encodeStateVector,\n  UndoManager,\n} from 'yjs';\n\nimport {\n  useMutateQueryResource,\n  useMutation,\n} from '../../../hooks/use-mutation';\nimport { useQueryInfinite } from '../../../hooks/use-query';\nimport { CloudBlobStorage } from '../../../modules/workspace-engine/impls/engine/blob-cloud';\n\nconst logger = new DebugLogger('page-history');\n\ntype DocHistory = ListHistoryQuery['workspace']['histories'][number];\n\nexport const useDocSnapshotList = (workspaceId: string, pageDocId: string) => {\n  const pageSize = 10;\n  const { data, loadingMore, loadMore } = useQueryInfinite({\n    query: listHistoryQuery,\n    getVariables: (_, previousPageData) => {\n      // use the timestamp of the last history as the cursor\n      const before = previousPageData?.workspace.histories.at(-1)?.timestamp;\n      const vars = {\n        pageDocId: pageDocId,\n        workspaceId: workspaceId,\n        before: before,\n        take: pageSize,\n      };\n\n      return vars;\n    },\n  });\n\n  const shouldLoadMore = useMemo(() => {\n    if (!data) {\n      return false;\n    }\n    const lastPage = data.at(-1);\n    if (!lastPage) {\n      return false;\n    }\n    return lastPage.workspace.histories.length === pageSize;\n  }, [data]);\n\n  const histories = useMemo(() => {\n    if (!data) {\n      return [];\n    }\n    return data.flatMap(page => page.workspace.histories);\n  }, [data]);\n\n  return [histories, shouldLoadMore ? loadMore : false, !!loadingMore] as const;\n};\n\nconst snapshotFetcher = async (\n  [workspaceId, pageDocId, ts]: [\n    workspaceId: string,\n    pageDocId: string,\n    ts: string,\n  ] // timestamp is the key to the history/snapshot\n) => {\n  if (!ts) {\n    return null;\n  }\n  const res = await fetch(\n    `/api/workspaces/${workspaceId}/docs/${pageDocId}/histories/${ts}`\n  );\n\n  if (!res.ok) {\n    throw new Error('Failed to fetch snapshot');\n  }\n\n  const snapshot = await res.arrayBuffer();\n  if (!snapshot) {\n    throw new Error('Invalid snapshot');\n  }\n  return snapshot;\n};\n\n// attach the Page shown in the modal to a temporary workspace\n// so that we do not need to worry about providers etc\n// TODO(@Peng): fix references to the page (the referenced page will shown as deleted)\n// if we simply clone the current workspace, it maybe time consuming right?\nconst docCollectionMap = new Map<string, DocCollection>();\n\n// assume the workspace is a cloud workspace since the history feature is only enabled for cloud workspace\nconst getOrCreateShellWorkspace = (workspaceId: string) => {\n  let docCollection = docCollectionMap.get(workspaceId);\n  if (!docCollection) {\n    const blobStorage = new CloudBlobStorage(workspaceId);\n    docCollection = new DocCollection({\n      id: workspaceId,\n      blobSources: {\n        main: blobStorage,\n      },\n      schema: globalBlockSuiteSchema,\n      disableBacklinkIndex: true,\n      disableSearchIndex: true,\n    });\n    docCollectionMap.set(workspaceId, docCollection);\n    docCollection.doc.emit('sync', [true, docCollection.doc]);\n  }\n  return docCollection;\n};\n\n// workspace id + page id + timestamp -> snapshot (update binary)\nexport const usePageHistory = (\n  workspaceId: string,\n  pageDocId: string,\n  ts?: string\n) => {\n  // snapshot should be immutable. so we use swr immutable to disable revalidation\n  const { data } = useSWRImmutable<ArrayBuffer | null>(\n    [workspaceId, pageDocId, ts],\n    {\n      fetcher: snapshotFetcher,\n      suspense: false,\n    }\n  );\n  return data ?? undefined;\n};\n\n// workspace id + page id + timestamp + snapshot -> Page (to be used for rendering in blocksuite editor)\nexport const useSnapshotPage = (\n  docCollection: DocCollection,\n  pageDocId: string,\n  ts?: string\n) => {\n  const snapshot = usePageHistory(docCollection.id, pageDocId, ts);\n  const page = useMemo(() => {\n    if (!ts) {\n      return;\n    }\n    const pageId = pageDocId + '-' + ts;\n    const historyShellWorkspace = getOrCreateShellWorkspace(docCollection.id);\n    let page = historyShellWorkspace.getDoc(pageId);\n    if (!page && snapshot) {\n      page = historyShellWorkspace.createDoc({\n        id: pageId,\n      });\n      page.awarenessStore.setReadonly(page.blockCollection, true);\n      const spaceDoc = page.spaceDoc;\n      page.load(() => {\n        applyUpdate(spaceDoc, new Uint8Array(snapshot));\n        historyShellWorkspace.schema.upgradeDoc(0, {}, spaceDoc);\n      }); // must load before applyUpdate\n    }\n    return page ?? undefined;\n  }, [pageDocId, snapshot, ts, docCollection]);\n\n  useEffect(() => {\n    const historyShellWorkspace = getOrCreateShellWorkspace(docCollection.id);\n    // apply the rootdoc's update to the current workspace\n    // this makes sure the page reference links are not deleted ones in the preview\n    const update = encodeStateAsUpdate(docCollection.doc);\n    applyUpdate(historyShellWorkspace.doc, update);\n  }, [docCollection]);\n\n  return page;\n};\n\nexport const historyListGroupByDay = (histories: DocHistory[]) => {\n  const map = new Map<string, DocHistory[]>();\n  for (const history of histories) {\n    const day = i18nTime(history.timestamp, {\n      relative: {\n        max: [1, 'week'],\n        accuracy: 'day',\n        weekday: true,\n      },\n      absolute: {\n        accuracy: 'day',\n        noYear: true,\n      },\n    });\n    const list = map.get(day) ?? [];\n    list.push(history);\n    map.set(day, list);\n  }\n  return [...map.entries()];\n};\n\nexport function revertUpdate(\n  doc: YDoc,\n  snapshotUpdate: Uint8Array,\n  getMetadata: (key: string) => 'Text' | 'Map' | 'Array'\n) {\n  const snapshotDoc = new YDoc();\n  applyUpdate(snapshotDoc, snapshotUpdate);\n\n  const currentStateVector = encodeStateVector(doc);\n  const snapshotStateVector = encodeStateVector(snapshotDoc);\n\n  const changesSinceSnapshotUpdate = encodeStateAsUpdate(\n    doc,\n    snapshotStateVector\n  );\n  const undoManager = new UndoManager(\n    [...snapshotDoc.share.keys()].map(key => {\n      const type = getMetadata(key);\n      if (type === 'Text') {\n        return snapshotDoc.getText(key);\n      } else if (type === 'Map') {\n        return snapshotDoc.getMap(key);\n      } else if (type === 'Array') {\n        return snapshotDoc.getArray(key);\n      }\n      throw new Error('Unknown type');\n    })\n  );\n  applyUpdate(snapshotDoc, changesSinceSnapshotUpdate);\n  undoManager.undo();\n  const revertChangesSinceSnapshotUpdate = encodeStateAsUpdate(\n    snapshotDoc,\n    currentStateVector\n  );\n  applyUpdate(doc, revertChangesSinceSnapshotUpdate);\n}\n\nexport const useRestorePage = (\n  docCollection: DocCollection,\n  pageId: string\n) => {\n  const page = useDocCollectionPage(docCollection, pageId);\n  const mutateQueryResource = useMutateQueryResource();\n  const { trigger: recover, isMutating } = useMutation({\n    mutation: recoverDocMutation,\n  });\n  const { getDocMeta, setDocTitle } = useDocMetaHelper(docCollection);\n\n  const onRestore = useMemo(() => {\n    return async (version: string, update: Uint8Array) => {\n      if (!page) {\n        return;\n      }\n      const pageDocId = page.spaceDoc.guid;\n      revertUpdate(page.spaceDoc, update, key => {\n        assertEquals(key, 'blocks'); // only expect this value is 'blocks'\n        return 'Map';\n      });\n\n      // should also update the page title, since it may be changed in the history\n      const title = page.meta?.title ?? '';\n\n      if (getDocMeta(pageId)?.title !== title) {\n        setDocTitle(pageId, title);\n      }\n\n      await recover({\n        docId: pageDocId,\n        timestamp: version,\n        workspaceId: docCollection.id,\n      });\n\n      await mutateQueryResource(listHistoryQuery, vars => {\n        return (\n          vars.pageDocId === pageDocId && vars.workspaceId === docCollection.id\n        );\n      });\n\n      logger.info('Page restored', pageDocId, version);\n    };\n  }, [\n    getDocMeta,\n    mutateQueryResource,\n    page,\n    pageId,\n    recover,\n    setDocTitle,\n    docCollection.id,\n  ]);\n\n  return {\n    onRestore,\n    isMutating,\n  };\n};\n","export const EmptyHistoryShape = () => (\n  <svg\n    width=\"200\"\n    height=\"174\"\n    viewBox=\"0 0 200 174\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <rect\n      x=\"51.724\"\n      y=\"38.4615\"\n      width=\"96.5517\"\n      height=\"96.5517\"\n      stroke=\"var(--affine-text-disable-color)\"\n    />\n    <path\n      d=\"M51.8339 86.7374L99.9999 38.5714L148.166 86.7374L99.9999 134.903L51.8339 86.7374Z\"\n      stroke=\"var(--affine-text-disable-color)\"\n    />\n    <path\n      d=\"M99.6052 38.1966C107.662 33.4757 117.043 30.7695 127.055 30.7695C157.087 30.7695 181.432 55.1148 181.432 85.1462C181.432 107.547 167.887 126.783 148.541 135.113\"\n      stroke=\"var(--affine-text-disable-color)\"\n    />\n    <path\n      d=\"M148.375 86.4722C153.096 94.5291 155.802 103.91 155.802 113.922C155.802 143.954 131.457 168.299 101.426 168.299C79.0254 168.299 59.7886 154.754 51.4587 135.408\"\n      stroke=\"var(--affine-text-disable-color)\"\n    />\n    <path\n      d=\"M100.394 135.113C92.3373 139.834 82.9568 142.54 72.9441 142.54C42.9127 142.54 18.5675 118.195 18.5675 88.1634C18.5675 65.763 32.1124 46.5261 51.4587 38.1963\"\n      stroke=\"var(--affine-text-disable-color)\"\n    />\n    <path\n      d=\"M51.4585 87.1318C46.7377 79.0749 44.0315 69.6943 44.0315 59.6817C44.0315 29.6503 68.3767 5.30503 98.4081 5.30503C120.809 5.30503 140.045 18.8499 148.375 38.1963\"\n      stroke=\"var(--affine-text-disable-color)\"\n    />\n    <path\n      d=\"M51.4587 38.1963L148.541 135.279\"\n      stroke=\"var(--affine-text-disable-color)\"\n    />\n    <path\n      d=\"M148.541 38.1963L51.4587 135.279\"\n      stroke=\"var(--affine-text-disable-color)\"\n    />\n    <path\n      d=\"M99.9998 38.1963V135.279\"\n      stroke=\"var(--affine-text-disable-color)\"\n    />\n    <path\n      d=\"M148.541 86.7378L51.4588 86.7378\"\n      stroke=\"var(--affine-text-disable-color)\"\n    />\n    <ellipse\n      cx=\"148.275\"\n      cy=\"38.4617\"\n      rx=\"3.97878\"\n      ry=\"3.97878\"\n      fill=\"var(--affine-text-primary-color)\"\n    />\n    <ellipse\n      cx=\"148.275\"\n      cy=\"135.013\"\n      rx=\"3.97878\"\n      ry=\"3.97878\"\n      fill=\"var(--affine-text-primary-color)\"\n    />\n    <ellipse\n      cx=\"148.275\"\n      cy=\"86.7376\"\n      rx=\"3.97878\"\n      ry=\"3.97878\"\n      fill=\"var(--affine-text-primary-color)\"\n    />\n    <ellipse\n      cx=\"51.7241\"\n      cy=\"38.4617\"\n      rx=\"3.97878\"\n      ry=\"3.97878\"\n      fill=\"var(--affine-text-primary-color)\"\n    />\n    <ellipse\n      cx=\"51.7241\"\n      cy=\"135.013\"\n      rx=\"3.97878\"\n      ry=\"3.97878\"\n      fill=\"var(--affine-text-primary-color)\"\n    />\n    <ellipse\n      cx=\"51.7241\"\n      cy=\"86.7376\"\n      rx=\"3.97878\"\n      ry=\"3.97878\"\n      fill=\"var(--affine-text-primary-color)\"\n    />\n    <ellipse\n      cx=\"100\"\n      cy=\"38.4617\"\n      rx=\"3.97878\"\n      ry=\"3.97878\"\n      transform=\"rotate(-90 100 38.4617)\"\n      fill=\"var(--affine-text-primary-color)\"\n    />\n    <ellipse\n      cx=\"100\"\n      cy=\"86.2073\"\n      rx=\"3.97878\"\n      ry=\"3.97878\"\n      transform=\"rotate(-90 100 86.2073)\"\n      fill=\"var(--affine-text-primary-color)\"\n    />\n    <ellipse\n      cx=\"100\"\n      cy=\"135.013\"\n      rx=\"3.97878\"\n      ry=\"3.97878\"\n      transform=\"rotate(-90 100 135.013)\"\n      fill=\"var(--affine-text-primary-color)\"\n    />\n  </svg>\n);\n","import \"../core/src/components/affine/page-history-modal/styles.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/affine/page-history-modal/styles.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#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\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var collapsedIcon = '_9fbys5t';\nexport var collapsedIconContainer = '_9fbys5u';\nexport var editor = '_9fbys5c';\nexport var emptyHistoryPrompt = '_9fbys5q';\nexport var emptyHistoryPromptDescription = '_9fbys5s';\nexport var emptyHistoryPromptTitle = '_9fbys5r';\nexport var historyFooter = '_9fbys5o';\nexport var historyItem = '_9fbys5l _9fbys5d';\nexport var historyItemGap = '_9fbys5m _9fbys5d';\nexport var historyItemGroup = '_9fbys5j';\nexport var historyItemGroupTitle = '_9fbys5k';\nexport var historyItemLoadMore = '_9fbys5n _9fbys5l _9fbys5d';\nexport var historyList = '_9fbys5f';\nexport var historyListHeader = '_9fbys5i';\nexport var historyListScrollable = '_9fbys5g';\nexport var historyListScrollableInner = '_9fbys5h';\nexport var loadingContainer = '_9fbys5e';\nexport var modalContent = '_9fbys55';\nexport var planPrompt = '_9fbys5w';\nexport var planPromptTitle = '_9fbys5x';\nexport var planPromptUpdateButton = '_9fbys5y';\nexport var planPromptWrapper = '_9fbys5v';\nexport var previewContainer = '_9fbys57';\nexport var previewContent = '_9fbys58';\nexport var previewHeader = '_9fbys59';\nexport var previewHeaderTimestamp = '_9fbys5b';\nexport var previewHeaderTitle = '_9fbys5a';\nexport var previewWrapper = '_9fbys56';\nexport var root = '_9fbys54';\nexport var rowWrapper = '_9fbys5d';\nexport var spacer = '_9fbys5p';","import { Loading, Scrollable } from '@affine/component';\nimport { EditorLoading } from '@affine/component/page-detail-skeleton';\nimport { Button, IconButton } from '@affine/component/ui/button';\nimport { Modal, useConfirmModal } from '@affine/component/ui/modal';\nimport { openSettingModalAtom } from '@affine/core/atoms';\nimport { useDocCollectionPageTitle } from '@affine/core/hooks/use-block-suite-workspace-page-title';\nimport { track } from '@affine/core/mixpanel';\nimport { WorkspacePermissionService } from '@affine/core/modules/permissions';\nimport { WorkspaceQuotaService } from '@affine/core/modules/quota';\nimport { i18nTime, Trans, useI18n } from '@affine/i18n';\nimport { CloseIcon, ToggleCollapseIcon } from '@blocksuite/icons/rc';\nimport type { Doc as BlockSuiteDoc, DocCollection } from '@blocksuite/store';\nimport * as Collapsible from '@radix-ui/react-collapsible';\nimport type { DialogContentProps } from '@radix-ui/react-dialog';\nimport {\n  type DocMode,\n  DocService,\n  useLiveData,\n  useService,\n  WorkspaceService,\n} from '@toeverything/infra';\nimport { atom, useAtom, useSetAtom } from 'jotai';\nimport type { PropsWithChildren } from 'react';\nimport {\n  Fragment,\n  Suspense,\n  useCallback,\n  useEffect,\n  useLayoutEffect,\n  useMemo,\n  useState,\n} from 'react';\nimport { encodeStateAsUpdate } from 'yjs';\n\nimport { pageHistoryModalAtom } from '../../../atoms/page-history';\nimport { BlockSuiteEditor } from '../../blocksuite/block-suite-editor';\nimport { PureEditorModeSwitch } from '../../blocksuite/block-suite-mode-switch';\nimport { AffineErrorBoundary } from '../affine-error-boundary';\nimport {\n  historyListGroupByDay,\n  useDocSnapshotList,\n  useRestorePage,\n  useSnapshotPage,\n} from './data';\nimport { EmptyHistoryShape } from './empty-history-shape';\nimport * as styles from './styles.css';\n\nexport interface PageHistoryModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  docCollection: DocCollection;\n  pageId: string;\n}\n\nconst contentOptions: DialogContentProps = {\n  ['data-testid' as string]: 'page-history-modal',\n  onPointerDownOutside: e => {\n    e.preventDefault();\n  },\n  style: {\n    padding: 0,\n    maxWidth: 944,\n    backgroundColor: 'var(--affine-background-primary-color)',\n    overflow: 'hidden',\n  },\n};\n\nconst ModalContainer = ({\n  onOpenChange,\n  open,\n  children,\n}: PropsWithChildren<{\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}>) => {\n  return (\n    <Modal\n      open={open}\n      onOpenChange={onOpenChange}\n      width=\"calc(100% - 64px)\"\n      height=\"80%\"\n      withoutCloseButton\n      contentOptions={contentOptions}\n    >\n      {children}\n    </Modal>\n  );\n};\n\ninterface HistoryEditorPreviewProps {\n  ts?: string;\n  historyList: HistoryList;\n  snapshotPage?: BlockSuiteDoc;\n  mode: DocMode;\n  onModeChange: (mode: DocMode) => void;\n  title: string;\n}\n\nconst HistoryEditorPreview = ({\n  ts,\n  historyList,\n  snapshotPage,\n  onModeChange,\n  mode,\n  title,\n}: HistoryEditorPreviewProps) => {\n  const onModeChangeWithTrack = useCallback(\n    (mode: DocMode) => {\n      track.$.docHistory.$.switchPageMode({ mode });\n      onModeChange(mode);\n    },\n    [onModeChange]\n  );\n\n  const content = useMemo(() => {\n    return (\n      <div className={styles.previewContent}>\n        <div className={styles.previewHeader}>\n          <PureEditorModeSwitch mode={mode} setMode={onModeChangeWithTrack} />\n          <div className={styles.previewHeaderTitle}>{title}</div>\n          <div className={styles.previewHeaderTimestamp}>\n            {ts\n              ? i18nTime(ts, {\n                  absolute: { accuracy: 'minute', noDate: true },\n                })\n              : null}\n          </div>\n        </div>\n\n        {snapshotPage ? (\n          <AffineErrorBoundary>\n            <Scrollable.Root>\n              <Scrollable.Viewport className=\"affine-page-viewport\">\n                <BlockSuiteEditor\n                  className={styles.editor}\n                  mode={mode}\n                  page={snapshotPage}\n                />\n              </Scrollable.Viewport>\n              <Scrollable.Scrollbar />\n            </Scrollable.Root>\n          </AffineErrorBoundary>\n        ) : (\n          <div className={styles.loadingContainer}>\n            <Loading size={24} />\n          </div>\n        )}\n      </div>\n    );\n  }, [mode, onModeChangeWithTrack, snapshotPage, title, ts]);\n\n  return (\n    <div className={styles.previewWrapper}>\n      {historyList.map((_item, i) => {\n        const historyIndex = historyList.findIndex(h => h.timestamp === ts);\n        const distance = i - historyIndex;\n        const flag =\n          distance > 20\n            ? '> 20'\n            : distance < -20\n              ? '< -20'\n              : distance.toString();\n        return (\n          <div data-distance={flag} key={i} className={styles.previewContainer}>\n            {historyIndex === i ? content : null}\n          </div>\n        );\n      })}\n    </div>\n  );\n};\nconst planPromptClosedAtom = atom(false);\n\nconst PlanPrompt = () => {\n  const workspaceQuotaService = useService(WorkspaceQuotaService);\n  useEffect(() => {\n    workspaceQuotaService.quota.revalidate();\n  }, [workspaceQuotaService]);\n  const workspaceQuota = useLiveData(workspaceQuotaService.quota.quota$);\n  const isProWorkspace = useMemo(() => {\n    return workspaceQuota\n      ? workspaceQuota.humanReadable.name.toLowerCase() !== 'free'\n      : null;\n  }, [workspaceQuota]);\n  const permissionService = useService(WorkspacePermissionService);\n  const isOwner = useLiveData(permissionService.permission.isOwner$);\n  useEffect(() => {\n    // revalidate permission\n    permissionService.permission.revalidate();\n  }, [permissionService]);\n\n  const setSettingModalAtom = useSetAtom(openSettingModalAtom);\n  const [planPromptClosed, setPlanPromptClosed] = useAtom(planPromptClosedAtom);\n\n  const closeFreePlanPrompt = useCallback(() => {\n    setPlanPromptClosed(true);\n  }, [setPlanPromptClosed]);\n\n  const onClickUpgrade = useCallback(() => {\n    setSettingModalAtom({\n      open: true,\n      activeTab: 'plans',\n      scrollAnchor: 'cloudPricingPlan',\n    });\n    track.$.docHistory.$.viewPlans();\n  }, [setSettingModalAtom]);\n\n  const t = useI18n();\n\n  const planTitle = useMemo(() => {\n    return (\n      <div className={styles.planPromptTitle}>\n        {\n          isProWorkspace !== null\n            ? !isProWorkspace\n              ? t[\n                  'com.affine.history.confirm-restore-modal.plan-prompt.limited-title'\n                ]()\n              : t[\n                  'com.affine.history.confirm-restore-modal.plan-prompt.title'\n                ]()\n            : '' /* TODO(@catsjuice): loading UI */\n        }\n\n        <IconButton onClick={closeFreePlanPrompt}>\n          <CloseIcon />\n        </IconButton>\n      </div>\n    );\n  }, [closeFreePlanPrompt, isProWorkspace, t]);\n\n  const planDescription = useMemo(() => {\n    if (!isProWorkspace) {\n      return (\n        <>\n          <Trans i18nKey=\"com.affine.history.confirm-restore-modal.free-plan-prompt.description\">\n            With the workspace creator&apos;s Free account, every member can\n            access up to <b>7 days</b> of version history.\n          </Trans>\n          {isOwner ? (\n            <span\n              className={styles.planPromptUpdateButton}\n              onClick={onClickUpgrade}\n            >\n              {t[\n                'com.affine.history.confirm-restore-modal.pro-plan-prompt.upgrade'\n              ]()}\n            </span>\n          ) : null}\n        </>\n      );\n    } else {\n      return (\n        <Trans i18nKey=\"com.affine.history.confirm-restore-modal.pro-plan-prompt.description\">\n          With the workspace creator&apos;s Pro account, every member enjoys the\n          privilege of accessing up to <b>30 days</b> of version history.\n        </Trans>\n      );\n    }\n  }, [isOwner, isProWorkspace, onClickUpgrade, t]);\n\n  return !planPromptClosed ? (\n    <div className={styles.planPromptWrapper}>\n      <div className={styles.planPrompt}>\n        {planTitle}\n        {planDescription}\n      </div>\n    </div>\n  ) : null;\n};\n\ntype HistoryList = ReturnType<typeof useDocSnapshotList>[0];\n\nconst PageHistoryList = ({\n  historyList,\n  onLoadMore,\n  loadingMore,\n  activeVersion,\n  onVersionChange,\n}: {\n  activeVersion?: string;\n  onVersionChange: (version: string) => void;\n  historyList: HistoryList;\n  onLoadMore: (() => void) | false;\n  loadingMore: boolean;\n}) => {\n  const t = useI18n();\n  const historyListByDay = useMemo(() => {\n    return historyListGroupByDay(historyList);\n  }, [historyList]);\n\n  const [collapsedMap, setCollapsedMap] = useState<Record<number, boolean>>({});\n\n  useLayoutEffect(() => {\n    if (historyList.length > 0 && !activeVersion) {\n      onVersionChange(historyList[0].timestamp);\n    }\n  }, [activeVersion, historyList, onVersionChange]);\n\n  return (\n    <div className={styles.historyList}>\n      <div className={styles.historyListHeader}>\n        {t['com.affine.history.version-history']()}\n      </div>\n      <Scrollable.Root className={styles.historyListScrollable}>\n        <Scrollable.Viewport className={styles.historyListScrollableInner}>\n          <PlanPrompt />\n          {historyListByDay.map(([day, list], i) => {\n            const collapsed = collapsedMap[i];\n            return (\n              <Collapsible.Root\n                open={!collapsed}\n                key={day}\n                className={styles.historyItemGroup}\n              >\n                <Collapsible.Trigger\n                  role=\"button\"\n                  onClick={() =>\n                    setCollapsedMap(prev => ({ ...prev, [i]: !collapsed }))\n                  }\n                  className={styles.historyItemGroupTitle}\n                >\n                  <div\n                    data-testid=\"page-list-group-header-collapsed-button\"\n                    className={styles.collapsedIconContainer}\n                  >\n                    <ToggleCollapseIcon\n                      className={styles.collapsedIcon}\n                      data-collapsed={!!collapsed}\n                    />\n                  </div>\n                  {day}\n                </Collapsible.Trigger>\n                <Collapsible.Content>\n                  {list.map((history, idx) => {\n                    return (\n                      <Fragment key={history.timestamp}>\n                        <div\n                          className={styles.historyItem}\n                          data-testid=\"version-history-item\"\n                          onClick={e => {\n                            e.stopPropagation();\n                            onVersionChange(history.timestamp);\n                          }}\n                          data-active={activeVersion === history.timestamp}\n                        >\n                          <button>\n                            {i18nTime(history.timestamp, {\n                              absolute: { noDate: true, accuracy: 'minute' },\n                            })}\n                          </button>\n                        </div>\n                        {idx > list.length - 1 ? (\n                          <div className={styles.historyItemGap} />\n                        ) : null}\n                      </Fragment>\n                    );\n                  })}\n                </Collapsible.Content>\n              </Collapsible.Root>\n            );\n          })}\n          {onLoadMore ? (\n            <Button\n              variant=\"plain\"\n              loading={loadingMore}\n              disabled={loadingMore}\n              className={styles.historyItemLoadMore}\n              onClick={onLoadMore}\n            >\n              {t['com.affine.history.confirm-restore-modal.load-more']()}\n            </Button>\n          ) : null}\n        </Scrollable.Viewport>\n        <Scrollable.Scrollbar />\n      </Scrollable.Root>\n    </div>\n  );\n};\n\nconst EmptyHistoryPrompt = () => {\n  const t = useI18n();\n\n  return (\n    <div\n      className={styles.emptyHistoryPrompt}\n      data-testid=\"empty-history-prompt\"\n    >\n      <EmptyHistoryShape />\n      <div className={styles.emptyHistoryPromptTitle}>\n        {t['com.affine.history.empty-prompt.title']()}\n      </div>\n      <div className={styles.emptyHistoryPromptDescription}>\n        {t['com.affine.history.empty-prompt.description']()}\n      </div>\n    </div>\n  );\n};\n\nconst PageHistoryManager = ({\n  docCollection,\n  pageId,\n  onClose,\n}: {\n  docCollection: DocCollection;\n  pageId: string;\n  onClose: () => void;\n}) => {\n  const workspaceId = docCollection.id;\n  const [activeVersion, setActiveVersion] = useState<string>();\n\n  const pageDocId = useMemo(() => {\n    return docCollection.getDoc(pageId)?.spaceDoc.guid ?? pageId;\n  }, [pageId, docCollection]);\n  const { openConfirmModal } = useConfirmModal();\n\n  const snapshotPage = useSnapshotPage(docCollection, pageDocId, activeVersion);\n\n  const t = useI18n();\n\n  const { onRestore, isMutating } = useRestorePage(docCollection, pageId);\n\n  const handleRestore = useMemo(\n    () => async () => {\n      if (!activeVersion || !snapshotPage) {\n        return;\n      }\n      const snapshot = encodeStateAsUpdate(snapshotPage.spaceDoc);\n      await onRestore(activeVersion, new Uint8Array(snapshot));\n      // close the modal after restore\n      onClose();\n    },\n    [activeVersion, onClose, onRestore, snapshotPage]\n  );\n\n  const doc = useService(DocService).doc;\n  const [mode, setMode] = useState<DocMode>(doc.mode$.value);\n\n  const title = useDocCollectionPageTitle(docCollection, pageId);\n\n  const onConfirmRestore = useCallback(() => {\n    openConfirmModal({\n      title: t['com.affine.history.restore-current-version'](),\n      description: t['com.affine.history.confirm-restore-modal.hint'](),\n      cancelText: t['Cancel'](),\n      contentOptions: {\n        ['data-testid' as string]: 'confirm-restore-history-modal',\n        style: { padding: '20px 26px' },\n      },\n      confirmText: t['com.affine.history.confirm-restore-modal.restore'](),\n      confirmButtonOptions: {\n        variant: 'primary',\n        ['data-testid' as string]: 'confirm-restore-history-button',\n      },\n      onConfirm: handleRestore,\n    });\n  }, [handleRestore, openConfirmModal, t]);\n\n  const [historyList, loadMore, loadingMore] = useDocSnapshotList(\n    workspaceId,\n    pageDocId\n  );\n\n  return (\n    <div className={styles.root}>\n      <div className={styles.modalContent} data-empty={!activeVersion}>\n        <HistoryEditorPreview\n          ts={activeVersion}\n          historyList={historyList}\n          snapshotPage={snapshotPage}\n          mode={mode}\n          onModeChange={setMode}\n          title={title}\n        />\n\n        <PageHistoryList\n          historyList={historyList}\n          onLoadMore={loadMore}\n          loadingMore={loadingMore}\n          activeVersion={activeVersion}\n          onVersionChange={setActiveVersion}\n        />\n      </div>\n\n      {!activeVersion ? (\n        <div className={styles.modalContent}>\n          <EmptyHistoryPrompt />\n        </div>\n      ) : null}\n\n      <div className={styles.historyFooter}>\n        <Button onClick={onClose}>\n          {t['com.affine.history.back-to-page']()}\n        </Button>\n        <div className={styles.spacer} />\n        <Button\n          variant=\"primary\"\n          onClick={onConfirmRestore}\n          disabled={isMutating || !activeVersion}\n        >\n          {t['com.affine.history.restore-current-version']()}\n        </Button>\n      </div>\n    </div>\n  );\n};\n\nexport const PageHistoryModal = ({\n  onOpenChange,\n  open,\n  pageId,\n  docCollection: workspace,\n}: PageHistoryModalProps) => {\n  const onClose = useCallback(() => {\n    onOpenChange(false);\n  }, [onOpenChange]);\n\n  return (\n    <ModalContainer onOpenChange={onOpenChange} open={open}>\n      <Suspense fallback={<EditorLoading />}>\n        <PageHistoryManager\n          onClose={onClose}\n          pageId={pageId}\n          docCollection={workspace}\n        />\n      </Suspense>\n    </ModalContainer>\n  );\n};\n\nexport const GlobalPageHistoryModal = () => {\n  const [{ open, pageId }, setState] = useAtom(pageHistoryModalAtom);\n  const workspace = useService(WorkspaceService).workspace;\n  const handleOpenChange = useCallback(\n    (open: boolean) => {\n      track.$.docHistory.$[open ? 'open' : 'close']();\n      setState(prev => ({\n        ...prev,\n        open,\n      }));\n    },\n    [setState]\n  );\n\n  return (\n    <PageHistoryModal\n      open={open}\n      onOpenChange={handleOpenChange}\n      pageId={pageId}\n      docCollection={workspace.docCollection}\n    />\n  );\n};\n","import \"../core/src/components/pure/trash-page-footer/styles.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/pure/trash-page-footer/styles.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8ycjBocGswIHsKICBkaXNwbGF5OiBmbGV4OwogIGdhcDogMTZweDsKICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKfQouXzJyMGhwazEgewogIHBvc2l0aW9uOiByZWxhdGl2ZTsKICB6LWluZGV4OiAyOwogIHBhZGRpbmc6IDE0cHggMjBweDsKICBkaXNwbGF5OiBmbGV4OwogIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsKICBhbGlnbi1pdGVtczogY2VudGVyOwogIGZsZXgtc2hyaW5rOiAwOwogIGJvdHRvbTogMDsKICBnYXA6IDE2cHg7CiAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tYWZmaW5lLWJhY2tncm91bmQtcHJpbWFyeS1jb2xvcik7CiAgYm9yZGVyLXRvcDogMXB4IHNvbGlkIHZhcigtLWFmZmluZS1ib3JkZXItY29sb3IpOwp9Ci5fMnIwaHBrMiB7CiAgZm9udC1zaXplOiAxNXB4OwogIGZvbnQtd2VpZ2h0OiA1MDA7CiAgbGluZS1oZWlnaHQ6IDI0cHg7CiAgY29sb3I6IHZhcigtLWFmZmluZS10ZXh0LXNlY29uZGFyeS1jb2xvcik7CiAgd2hpdGUtc3BhY2U6IG5vd3JhcDsKICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsKICBvdmVyZmxvdzogaGlkZGVuOwp9Ci5fMnIwaHBrMyB7CiAgcGFkZGluZzogOHB4IDE4cHg7CiAgaGVpZ2h0OiAzNnB4Owp9Ci5fMnIwaHBrNCB7CiAgd2lkdGg6IDIwcHg7CiAgaGVpZ2h0OiAyMHB4Owp9\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var buttonContainer = '_2r0hpk3';\nexport var deleteHintContainer = '_2r0hpk1';\nexport var deleteHintText = '_2r0hpk2';\nexport var group = '_2r0hpk0';\nexport var icon = '_2r0hpk4';","import { Button } from '@affine/component/ui/button';\nimport { ConfirmModal } from '@affine/component/ui/modal';\nimport { useI18n } from '@affine/i18n';\nimport { DeleteIcon, ResetIcon } from '@blocksuite/icons/rc';\nimport { DocService, useService, WorkspaceService } from '@toeverything/infra';\nimport { useCallback, useState } from 'react';\n\nimport { useAppSettingHelper } from '../../../hooks/affine/use-app-setting-helper';\nimport { useBlockSuiteMetaHelper } from '../../../hooks/affine/use-block-suite-meta-helper';\nimport { useNavigateHelper } from '../../../hooks/use-navigate-helper';\nimport { WorkspaceSubPath } from '../../../shared';\nimport { toast } from '../../../utils';\nimport * as styles from './styles.css';\n\nexport const TrashPageFooter = () => {\n  const workspace = useService(WorkspaceService).workspace;\n  const docCollection = workspace.docCollection;\n  const doc = useService(DocService).doc;\n  const t = useI18n();\n  const { appSettings } = useAppSettingHelper();\n  const { jumpToSubPath } = useNavigateHelper();\n  const { restoreFromTrash } = useBlockSuiteMetaHelper(docCollection);\n  const [open, setOpen] = useState(false);\n  const hintText = t['com.affine.cmdk.affine.editor.trash-footer-hint']();\n\n  const onRestore = useCallback(() => {\n    restoreFromTrash(doc.id);\n    toast(\n      t['com.affine.toastMessage.restored']({\n        title: doc.meta$.value.title || 'Untitled',\n      })\n    );\n  }, [doc.id, doc.meta$.value.title, restoreFromTrash, t]);\n\n  const onConfirmDelete = useCallback(() => {\n    jumpToSubPath(workspace.id, WorkspaceSubPath.ALL);\n    docCollection.removeDoc(doc.id);\n    toast(t['com.affine.toastMessage.permanentlyDeleted']());\n  }, [jumpToSubPath, workspace.id, docCollection, doc.id, t]);\n\n  const onDelete = useCallback(() => {\n    setOpen(true);\n  }, []);\n\n  return (\n    <div\n      className={styles.deleteHintContainer}\n      data-has-background={!appSettings.clientBorder}\n    >\n      <div className={styles.deleteHintText}>{hintText}</div>\n      <div className={styles.group}>\n        <Button\n          tooltip={t['com.affine.trashOperation.restoreIt']()}\n          data-testid=\"page-restore-button\"\n          variant=\"primary\"\n          onClick={onRestore}\n          className={styles.buttonContainer}\n          prefix={<ResetIcon />}\n          prefixClassName={styles.icon}\n        />\n        <Button\n          tooltip={t['com.affine.trashOperation.deletePermanently']()}\n          variant=\"error\"\n          onClick={onDelete}\n          className={styles.buttonContainer}\n          prefix={<DeleteIcon />}\n          prefixClassName={styles.icon}\n        />\n      </div>\n      <ConfirmModal\n        title={t['com.affine.trashOperation.delete.title']()}\n        cancelText={t['com.affine.confirmModal.button.cancel']()}\n        description={t['com.affine.trashOperation.delete.description']()}\n        confirmText={t['com.affine.trashOperation.delete']()}\n        confirmButtonOptions={{\n          variant: 'error',\n        }}\n        open={open}\n        onConfirm={onConfirmDelete}\n        onOpenChange={setOpen}\n      />\n    </div>\n  );\n};\n","import { CloseIcon } from '@blocksuite/icons/rc';\nimport type { ReactNode } from 'react';\n\nimport {\n  browserWarningStyle,\n  closeButtonStyle,\n  closeIconStyle,\n} from './index.css';\n\nexport const BrowserWarning = ({\n  show,\n  onClose,\n  message,\n}: {\n  show: boolean;\n  onClose: () => void;\n  message: ReactNode;\n}) => {\n  if (!show) {\n    return null;\n  }\n  return (\n    <div className={browserWarningStyle}>\n      {message}\n      <div className={closeButtonStyle} onClick={onClose}>\n        <CloseIcon className={closeIconStyle} />\n      </div>\n    </div>\n  );\n};\n\nexport default BrowserWarning;\n","import \"../component/src/components/affine-banner/index.css.ts.vanilla.css!=!../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../component/src/components/affine-banner/index.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACqWSwU7DMAyG730KX5DgENQOCihceBOUNW5n6JwoyWgH6rujZB3rCmJDXKrasR3/X/7r5/K+Di3m8JEBLFX12jizYS0q0xon4U25SyFUXROjmBx3yjFxsyu7eswAfmr4XtWRDisJRZ5fxNAqrYkbCQ+2h+LO9jFZGw7C0zvOpu3y6zRHk7et2kqoW0xNLxsfqN6KynBADhIq5IAuHqmWGhYUcO2naWs8BTIsQS29aTcBY/ZdEGvsJRSP2ZBdj3iKhGdc/mbcc4XUrMIh/okAVYankDbOxxpraL/GaSXxQCDrP2txu/12XA9iFlMxRXksZh8fJjpsVaC3X+jc/NE86JxxJ6wzr5kZ5xyPpP9u1HWf5+fR9lZVKJYYOkT+DfneusVi4t3TpgJolJVfDfFeRYxOhK1FCcRt1BGlTRHfJsTngEpuaZzpxttS7FeO+HX2bGWa+Y3IUUP+L0YTpUP2tEZNCnzlEBkUa7hcq16MD1sucttfpY2ObTUu1Lk4K37j4GFSVo5lM4cM2fAJqnI52t0EAAA=\\\"}!../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var browserWarningStyle = '_57ftle0';\nexport var closeButtonStyle = '_57ftle1';\nexport var closeIconStyle = '_57ftle2';\nexport var tipsContainer = '_57ftle3';\nexport var tipsMessage = '_57ftle4';\nexport var tipsRightItem = '_57ftle5';","import { Button, IconButton } from '@affine/component/ui/button';\nimport { useI18n } from '@affine/i18n';\nimport { CloseIcon } from '@blocksuite/icons/rc';\nimport { cssVar } from '@toeverything/theme';\nimport { useCallback } from 'react';\n\nimport * as styles from './index.css';\n\ntype LocalDemoTipsProps = {\n  isLoggedIn: boolean;\n  onLogin: () => void;\n  onEnableCloud: () => void;\n  onClose: () => void;\n};\n\nexport const LocalDemoTips = ({\n  onClose,\n  isLoggedIn,\n  onLogin,\n  onEnableCloud,\n}: LocalDemoTipsProps) => {\n  const t = useI18n();\n  const buttonLabel = isLoggedIn\n    ? t['Enable AFFiNE Cloud']()\n    : t['Sign in and Enable']();\n\n  const handleClick = useCallback(() => {\n    if (isLoggedIn) {\n      return onEnableCloud();\n    }\n    return onLogin();\n  }, [isLoggedIn, onEnableCloud, onLogin]);\n\n  return (\n    <div className={styles.tipsContainer} data-testid=\"local-demo-tips\">\n      <div className={styles.tipsMessage}>\n        {t['com.affine.banner.local-warning']()}\n      </div>\n\n      <div className={styles.tipsRightItem}>\n        <Button style={{ background: cssVar('white') }} onClick={handleClick}>\n          {buttonLabel}\n        </Button>\n        <IconButton\n          onClick={onClose}\n          size=\"20\"\n          data-testid=\"local-demo-tips-close-button\"\n        >\n          <CloseIcon />\n        </IconButton>\n      </div>\n    </div>\n  );\n};\n\nexport default LocalDemoTips;\n","import { BrowserWarning, LocalDemoTips } from '@affine/component/affine-banner';\nimport { WorkspaceFlavour } from '@affine/env/workspace';\nimport { Trans, useI18n } from '@affine/i18n';\nimport { useLiveData, useService, type Workspace } from '@toeverything/infra';\nimport { useSetAtom } from 'jotai';\nimport { useCallback, useState } from 'react';\n\nimport { authAtom } from '../atoms';\nimport { useEnableCloud } from '../hooks/affine/use-enable-cloud';\nimport { AuthService } from '../modules/cloud';\n\nconst minimumChromeVersion = 106;\n\nconst shouldShowWarning = (() => {\n  if (environment.isDesktop) {\n    // even though desktop has compatibility issues,\n    //  we don't want to show the warning\n    return false;\n  }\n  if (!environment.isBrowser) {\n    // disable in SSR\n    return false;\n  }\n  if (environment.isMobile) {\n    return true;\n  }\n  if (environment.isChrome) {\n    return environment.chromeVersion < minimumChromeVersion;\n  }\n  return false;\n})();\n\nconst OSWarningMessage = () => {\n  const t = useI18n();\n  const notChrome = environment.isBrowser && !environment.isChrome;\n  const notGoodVersion =\n    environment.isBrowser &&\n    environment.isChrome &&\n    environment.chromeVersion < minimumChromeVersion;\n\n  // TODO(@L-Sun): remove this message when mobile version is able to edit.\n  if ('isMobile' in environment && environment.isMobile) {\n    return <span>{t['com.affine.top-tip.mobile']()}</span>;\n  }\n\n  if (notChrome) {\n    return (\n      <span>\n        <Trans i18nKey=\"recommendBrowser\">\n          We recommend the <strong>Chrome</strong> browser for an optimal\n          experience.\n        </Trans>\n      </span>\n    );\n  } else if (notGoodVersion) {\n    return <span>{t['upgradeBrowser']()}</span>;\n  }\n\n  return null;\n};\n\nexport const TopTip = ({\n  pageId,\n  workspace,\n}: {\n  pageId?: string;\n  workspace: Workspace;\n}) => {\n  const loginStatus = useLiveData(useService(AuthService).session.status$);\n  const isLoggedIn = loginStatus === 'authenticated';\n\n  const [showWarning, setShowWarning] = useState(shouldShowWarning);\n  const [showLocalDemoTips, setShowLocalDemoTips] = useState(true);\n  const confirmEnableCloud = useEnableCloud();\n\n  const setAuthModal = useSetAtom(authAtom);\n  const onLogin = useCallback(() => {\n    setAuthModal({ openModal: true, state: 'signIn' });\n  }, [setAuthModal]);\n\n  if (\n    showLocalDemoTips &&\n    !environment.isDesktop &&\n    workspace.flavour === WorkspaceFlavour.LOCAL\n  ) {\n    return (\n      <LocalDemoTips\n        isLoggedIn={isLoggedIn}\n        onLogin={onLogin}\n        onEnableCloud={() =>\n          confirmEnableCloud(workspace, { openPageId: pageId })\n        }\n        onClose={() => {\n          setShowLocalDemoTips(false);\n        }}\n      />\n    );\n  }\n\n  return (\n    <BrowserWarning\n      show={showWarning}\n      message={<OSWarningMessage />}\n      onClose={() => {\n        setShowWarning(false);\n      }}\n    />\n  );\n};\n","import { notify } from '@affine/component';\nimport {\n  pushGlobalLoadingEventAtom,\n  resolveGlobalLoadingEventAtom,\n} from '@affine/component/global-loading';\nimport { track } from '@affine/core/mixpanel';\nimport { apis } from '@affine/electron-api';\nimport { useI18n } from '@affine/i18n';\nimport type { PageRootService, RootBlockModel } from '@blocksuite/blocks';\nimport { HtmlTransformer, MarkdownTransformer } from '@blocksuite/blocks';\nimport type { Doc } from '@blocksuite/store';\nimport { useSetAtom } from 'jotai';\nimport { nanoid } from 'nanoid';\nimport { useCallback } from 'react';\n\ntype ExportType = 'pdf' | 'html' | 'png' | 'markdown';\n\ninterface ExportHandlerOptions {\n  page: Doc;\n  type: ExportType;\n}\n\nasync function exportHandler({ page, type }: ExportHandlerOptions) {\n  const editorRoot = document.querySelector('editor-host');\n  let pageService: PageRootService | null = null;\n  if (editorRoot) {\n    pageService = editorRoot.spec.getService<PageRootService>('affine:page');\n  }\n  track.$.sharePanel.$.export({\n    type,\n  });\n  switch (type) {\n    case 'html':\n      await HtmlTransformer.exportDoc(page);\n      break;\n    case 'markdown':\n      await MarkdownTransformer.exportDoc(page);\n      break;\n    case 'pdf':\n      if (environment.isDesktop && page.meta?.mode === 'page') {\n        await apis?.export.savePDFFileAs(\n          (page.root as RootBlockModel).title.toString()\n        );\n      } else {\n        if (!pageService) return;\n        await pageService.exportManager.exportPdf();\n      }\n      break;\n    case 'png': {\n      if (!pageService) return;\n      await pageService.exportManager.exportPng();\n      break;\n    }\n  }\n}\n\nexport const useExportPage = (page: Doc) => {\n  const pushGlobalLoadingEvent = useSetAtom(pushGlobalLoadingEventAtom);\n  const resolveGlobalLoadingEvent = useSetAtom(resolveGlobalLoadingEventAtom);\n  const t = useI18n();\n\n  const onClickHandler = useCallback(\n    async (type: ExportType) => {\n      const globalLoadingID = nanoid();\n      pushGlobalLoadingEvent({\n        key: globalLoadingID,\n      });\n      try {\n        await exportHandler({\n          page,\n          type,\n        });\n        notify.success({\n          title: t['com.affine.export.success.title'](),\n          message: t['com.affine.export.success.message'](),\n        });\n      } catch (err) {\n        console.error(err);\n        notify.error({\n          title: t['com.affine.export.error.title'](),\n          message: t['com.affine.export.error.message'](),\n        });\n      } finally {\n        resolveGlobalLoadingEvent(globalLoadingID);\n      }\n    },\n    [page, pushGlobalLoadingEvent, resolveGlobalLoadingEvent, t]\n  );\n\n  return onClickHandler;\n};\n","import { FavoriteTag } from '@affine/core/components/page-list';\nimport { track } from '@affine/core/mixpanel';\nimport { CompatibleFavoriteItemsAdapter } from '@affine/core/modules/properties';\nimport { toast } from '@affine/core/utils';\nimport { useI18n } from '@affine/i18n';\nimport { useLiveData, useService } from '@toeverything/infra';\nimport { useCallback } from 'react';\n\nexport interface FavoriteButtonProps {\n  pageId: string;\n}\n\nexport const useFavorite = (pageId: string) => {\n  const t = useI18n();\n  const favAdapter = useService(CompatibleFavoriteItemsAdapter);\n\n  const favorite = useLiveData(favAdapter.isFavorite$(pageId, 'doc'));\n\n  const toggleFavorite = useCallback(() => {\n    favAdapter.toggle(pageId, 'doc');\n    toast(\n      favorite\n        ? t['com.affine.toastMessage.removedFavorites']()\n        : t['com.affine.toastMessage.addedFavorites']()\n    );\n  }, [favorite, pageId, t, favAdapter]);\n\n  return { favorite, toggleFavorite };\n};\n\nexport const FavoriteButton = ({ pageId }: FavoriteButtonProps) => {\n  const { favorite, toggleFavorite } = useFavorite(pageId);\n\n  const handleFavorite = useCallback(() => {\n    track.$.header.actions.toggleFavorite();\n    toggleFavorite();\n  }, [toggleFavorite]);\n\n  return (\n    <FavoriteTag\n      data-testid=\"pin-button\"\n      active={!!favorite}\n      onClick={handleFavorite}\n    />\n  );\n};\n","import { IconButton } from '@affine/component';\nimport { openInfoModalAtom } from '@affine/core/atoms';\nimport { track } from '@affine/core/mixpanel';\nimport { useI18n } from '@affine/i18n';\nimport { InformationIcon } from '@blocksuite/icons/rc';\nimport { useSetAtom } from 'jotai';\nimport { useCallback } from 'react';\n\nexport const InfoButton = () => {\n  const setOpenInfoModal = useSetAtom(openInfoModalAtom);\n  const t = useI18n();\n\n  const onOpenInfoModal = useCallback(() => {\n    track.$.header.actions.openDocInfo();\n    setOpenInfoModal(true);\n  }, [setOpenInfoModal]);\n\n  return (\n    <IconButton\n      size=\"20\"\n      tooltip={t['com.affine.page-properties.page-info.view']()}\n      data-testid=\"header-info-button\"\n      onClick={onOpenInfoModal}\n    >\n      <InformationIcon />\n    </IconButton>\n  );\n};\n","import type { WeekDatePickerHandle } from '@affine/component';\nimport { WeekDatePicker } from '@affine/component';\nimport {\n  useJournalInfoHelper,\n  useJournalRouteHelper,\n} from '@affine/core/hooks/use-journal';\nimport type { DocCollection } from '@affine/core/shared';\nimport type { Doc } from '@blocksuite/store';\nimport dayjs from 'dayjs';\nimport { useEffect, useRef, useState } from 'react';\n\nexport interface JournalWeekDatePickerProps {\n  docCollection: DocCollection;\n  page: Doc;\n}\n\nconst weekStyle = { maxWidth: 800, width: '100%' };\nexport const JournalWeekDatePicker = ({\n  docCollection,\n  page,\n}: JournalWeekDatePickerProps) => {\n  const handleRef = useRef<WeekDatePickerHandle>(null);\n  const { journalDate } = useJournalInfoHelper(docCollection, page.id);\n  const { openJournal } = useJournalRouteHelper(docCollection);\n  const [date, setDate] = useState(\n    (journalDate ?? dayjs()).format('YYYY-MM-DD')\n  );\n\n  useEffect(() => {\n    if (!journalDate) return;\n    setDate(journalDate.format('YYYY-MM-DD'));\n    handleRef.current?.setCursor?.(journalDate);\n  }, [journalDate]);\n\n  return (\n    <WeekDatePicker\n      handleRef={handleRef}\n      style={weekStyle}\n      value={date}\n      onChange={openJournal}\n    />\n  );\n};\n","import { Button } from '@affine/component';\nimport { useJournalRouteHelper } from '@affine/core/hooks/use-journal';\nimport type { DocCollection } from '@affine/core/shared';\nimport { useI18n } from '@affine/i18n';\nimport { useCallback } from 'react';\n\nexport interface JournalTodayButtonProps {\n  docCollection: DocCollection;\n}\n\nexport const JournalTodayButton = ({\n  docCollection,\n}: JournalTodayButtonProps) => {\n  const t = useI18n();\n  const journalHelper = useJournalRouteHelper(docCollection);\n\n  const onToday = useCallback(() => {\n    journalHelper.openToday();\n  }, [journalHelper]);\n\n  return (\n    <Button\n      size=\"default\"\n      onClick={onToday}\n      style={{ height: 32, padding: '0px 8px' }}\n    >\n      {t['com.affine.today']()}\n    </Button>\n  );\n};\n","import \"../core/src/components/affine/share-page-modal/share-menu/index.css.ts.vanilla.css!=!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/affine/share-page-modal/share-menu/index.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACq1W246bMBB9z1dYK1XaPDiChGSzrtrvqFRVlYMH4sTYyExurfbfKxvYAAsJWfUNjX1mzpy5mNnv8IJ8nS4C8ndCiJBFrviFkUTB+euEEK5kqqlEyApGYtAI1pkTo5EW8g8wcuT2mVKeJFIDLe3Z9P3OCWS6RUZWQeBsyl3aVrb5PPcxci6E1CkjAYlKS8pzVn6/TWY1w9AzPEmBW0aiMCiv1s74AU3LWVh5R8t1kRibsfJTcYQfz9Thpy3/c+//HR814BKl0YxwpUgwWxQt2KKkZaygJ+t4byzwPXWGu0qdi+lHVarEYqOM7YAQzkgLiI0W3F6ov+I9+ANfK0YUJNiRddWRMvKcM25TqSmanJFw3bmy7O8HX5nXkqGzUSEtxKU8sVGHTLuT3aFAmTiCGkFjs3NaDeU9FMgttmKv+mNXpQ+D4Mvt8J5kN6GXsrymLqYFxVEeoXVp3R95bD5Xc0vbrvyvD83adRg+MXfLB+auwZB7hv8xWsP3pj/7T3VTpyV6Cx+Pi2fNqTdYkfMY6AbwBKDvlSnsStsVVoxsMM8OtGg5q5xnUtM68WXVGBk/17b5MugEBR/0gYXSxP4UHLkbUoRvT/EW4j2Ip1+3PeZWZgP+kkEkWGtsHyRtL2ancVnk8TO0MVaApZYLeShYjd7weJ9ac9CC9hFqHPftXFeGusnXVRnurJdt8wkLo9VAEje7YSDDa2S+KYw6IJR5I5qMET+WtuQatCjJ7qSHq+H3R8ZGNxQYp34j2K73iR3zRN5fM8HN5z7yr/3An8WOfHdjrgdbU0m97+tMBxTy6ODH9GH03iPqBBYftnLd5g2Iur+XK8Ee+n1oqRs5dd/+AYt8HtEZCgAA\\\"}!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var actionsStyle = '_1yta8g35';\nexport var buttonStyle = '_1yta8g34';\nexport var cloudSvgContainer = '_1yta8g3h';\nexport var columnContainerStyle = '_1yta8g3b';\nexport var containerStyle = '_1yta8g36';\nexport var descriptionStyle = '_1yta8g33';\nexport var disableSharePage = '_1yta8g3f';\nexport var headerStyle = '_1yta8g30';\nexport var indicatorContainerStyle = '_1yta8g37';\nexport var inputButtonRowStyle = '_1yta8g38';\nexport var localSharePage = '_1yta8g3g';\nexport var menuItemStyle = '_1yta8g32';\nexport var menuStyle = '_1yta8g31';\nexport var radioButton = '_1yta8g3e';\nexport var radioButtonGroup = '_1yta8g3d';\nexport var rowContainerStyle = '_1yta8g3c';\nexport var shareButton = '_1yta8g3k';\nexport var shareIconStyle = '_1yta8g3i';\nexport var shareLinkStyle = '_1yta8g3j';\nexport var shortcutStyle = '_1yta8g3l';\nexport var subTitleStyle = '_1yta8g3a';\nexport var titleContainerStyle = '_1yta8g39';","import { notify } from '@affine/component';\nimport { track } from '@affine/core/mixpanel';\nimport { getAffineCloudBaseUrl } from '@affine/core/modules/cloud/services/fetch';\nimport { useI18n } from '@affine/i18n';\nimport type { Disposable } from '@blocksuite/global/utils';\nimport { useCallback, useEffect, useMemo, useState } from 'react';\n\nimport { useActiveBlocksuiteEditor } from '../use-block-suite-editor';\n\ntype UrlType = 'share' | 'workspace';\n\ntype UseSharingUrl = {\n  workspaceId: string;\n  pageId: string;\n  urlType: UrlType;\n};\n\nconst generateUrl = ({\n  workspaceId,\n  pageId,\n  urlType,\n  blockId,\n}: UseSharingUrl & { blockId?: string }) => {\n  // to generate a private url like https://app.affine.app/workspace/123/456\n  // or https://app.affine.app/workspace/123/456#block-123\n\n  // to generate a public url like https://app.affine.app/share/123/456\n  const baseUrl = getAffineCloudBaseUrl();\n  if (!baseUrl) return null;\n\n  try {\n    return new URL(\n      `${baseUrl}/${urlType}/${workspaceId}/${pageId}${urlType === 'workspace' && blockId ? `#${blockId}` : ''}`\n    ).toString();\n  } catch (e) {\n    return null;\n  }\n};\n\nexport const useSharingUrl = ({\n  workspaceId,\n  pageId,\n  urlType,\n}: UseSharingUrl) => {\n  const t = useI18n();\n  const [blockId, setBlockId] = useState<string>('');\n  const [editor] = useActiveBlocksuiteEditor();\n  const sharingUrl = useMemo(\n    () =>\n      generateUrl({\n        workspaceId,\n        pageId,\n        urlType,\n        blockId: blockId.length > 0 ? blockId : undefined,\n      }),\n    [workspaceId, pageId, urlType, blockId]\n  );\n\n  const onClickCopyLink = useCallback(() => {\n    if (sharingUrl) {\n      navigator.clipboard\n        .writeText(sharingUrl)\n        .then(() => {\n          notify.success({\n            title: t['Copied link to clipboard'](),\n          });\n        })\n        .catch(err => {\n          console.error(err);\n        });\n      track.$.sharePanel.$.copyShareLink({\n        type: urlType === 'share' ? 'public' : 'private',\n      });\n    } else {\n      notify.error({\n        title: 'Network not available',\n      });\n    }\n  }, [sharingUrl, t, urlType]);\n\n  useEffect(() => {\n    let disposable: Disposable | null = null;\n    const selectManager = editor?.host?.selection;\n    if (urlType !== 'workspace' || !selectManager) {\n      return;\n    }\n\n    // if the block is already selected, set the blockId\n    const currentBlockSelection = selectManager.find('block');\n    if (currentBlockSelection) {\n      setBlockId(`#${currentBlockSelection.blockId}`);\n    }\n\n    disposable = selectManager.slots.changed.on(selections => {\n      setBlockId(prev => {\n        if (selections[0] && selections[0].type === 'block') {\n          return `#${selections[0].blockId}`;\n        } else if (prev.length > 0) {\n          return '';\n        } else {\n          return prev;\n        }\n      });\n    });\n    return () => {\n      disposable?.dispose();\n    };\n  }, [editor?.host?.selection, urlType]);\n  return {\n    sharingUrl,\n    onClickCopyLink,\n  };\n};\n","import { MenuIcon, MenuItem } from '@affine/component';\nimport { Divider } from '@affine/component/ui/divider';\nimport { ExportMenuItems } from '@affine/core/components/page-list';\nimport { useExportPage } from '@affine/core/hooks/affine/use-export-page';\nimport { useSharingUrl } from '@affine/core/hooks/affine/use-share-url';\nimport { WorkspaceFlavour } from '@affine/env/workspace';\nimport { useI18n } from '@affine/i18n';\nimport { CopyIcon } from '@blocksuite/icons/rc';\nimport { DocService, useLiveData, useService } from '@toeverything/infra';\n\nimport * as styles from './index.css';\nimport type { ShareMenuProps } from './share-menu';\n\nexport const ShareExport = ({\n  workspaceMetadata: workspace,\n  currentPage,\n}: ShareMenuProps) => {\n  const t = useI18n();\n  const doc = useService(DocService).doc;\n  const workspaceId = workspace.id;\n  const pageId = currentPage.id;\n  const { sharingUrl, onClickCopyLink } = useSharingUrl({\n    workspaceId,\n    pageId,\n    urlType: 'workspace',\n  });\n  const exportHandler = useExportPage(currentPage);\n  const currentMode = useLiveData(doc.mode$);\n  const isMac = environment.isBrowser && environment.isMacOs;\n\n  return (\n    <>\n      <div className={styles.titleContainerStyle}>\n        {t['com.affine.share-menu.ShareViaExport']()}\n      </div>\n      <div className={styles.descriptionStyle}>\n        {t['com.affine.share-menu.ShareViaExportDescription']()}\n      </div>\n      <div>\n        <ExportMenuItems\n          exportHandler={exportHandler}\n          className={styles.menuItemStyle}\n          pageMode={currentMode}\n        />\n      </div>\n      {workspace.flavour !== WorkspaceFlavour.LOCAL ? (\n        <div className={styles.columnContainerStyle}>\n          <Divider size=\"thinner\" />\n          <div className={styles.titleContainerStyle}>\n            {t['com.affine.share-menu.share-privately']()}\n          </div>\n          <div className={styles.descriptionStyle}>\n            {t['com.affine.share-menu.share-privately.description']()}\n          </div>\n          <div>\n            <MenuItem\n              className={styles.shareLinkStyle}\n              onSelect={onClickCopyLink}\n              block\n              disabled={!sharingUrl}\n              preFix={\n                <MenuIcon>\n                  <CopyIcon fontSize={16} />\n                </MenuIcon>\n              }\n              endFix={\n                <div className={styles.shortcutStyle}>\n                  {isMac ? ' +  + C' : 'Ctrl + Shift + C'}\n                </div>\n              }\n            >\n              {t['com.affine.share-menu.copy-private-link']()}\n            </MenuItem>\n          </div>\n        </div>\n      ) : null}\n    </>\n  );\n};\n","import { Input, notify, RadioGroup, Skeleton, Switch } from '@affine/component';\nimport { PublicLinkDisableModal } from '@affine/component/disable-public-link';\nimport { Button } from '@affine/component/ui/button';\nimport { Menu, MenuItem, MenuTrigger } from '@affine/component/ui/menu';\nimport { useSharingUrl } from '@affine/core/hooks/affine/use-share-url';\nimport { useAsyncCallback } from '@affine/core/hooks/affine-async-hooks';\nimport { track } from '@affine/core/mixpanel';\nimport { ServerConfigService } from '@affine/core/modules/cloud';\nimport { ShareService } from '@affine/core/modules/share-doc';\nimport { WorkspaceFlavour } from '@affine/env/workspace';\nimport { PublicPageMode } from '@affine/graphql';\nimport { useI18n } from '@affine/i18n';\nimport {\n  ArrowRightSmallIcon,\n  SingleSelectSelectSolidIcon,\n} from '@blocksuite/icons/rc';\nimport {\n  type DocMode,\n  DocService,\n  useLiveData,\n  useService,\n} from '@toeverything/infra';\nimport { cssVar } from '@toeverything/theme';\nimport { Suspense, useEffect, useMemo, useState } from 'react';\nimport { ErrorBoundary } from 'react-error-boundary';\n\nimport { CloudSvg } from '../cloud-svg';\nimport * as styles from './index.css';\nimport type { ShareMenuProps } from './share-menu';\n\nexport const LocalSharePage = (props: ShareMenuProps) => {\n  const t = useI18n();\n\n  return (\n    <div className={styles.localSharePage}>\n      <div className={styles.columnContainerStyle} style={{ gap: '12px' }}>\n        <div className={styles.descriptionStyle} style={{ maxWidth: '230px' }}>\n          {t['com.affine.share-menu.EnableCloudDescription']()}\n        </div>\n        <div>\n          <Button\n            onClick={props.onEnableAffineCloud}\n            variant=\"primary\"\n            data-testid=\"share-menu-enable-affine-cloud-button\"\n          >\n            {t['Enable AFFiNE Cloud']()}\n          </Button>\n        </div>\n      </div>\n      <div className={styles.cloudSvgContainer}>\n        <CloudSvg />\n      </div>\n    </div>\n  );\n};\n\nexport const AffineSharePage = (props: ShareMenuProps) => {\n  const {\n    workspaceMetadata: { id: workspaceId },\n  } = props;\n  const doc = useService(DocService).doc;\n  const shareService = useService(ShareService);\n  const serverConfig = useService(ServerConfigService).serverConfig;\n  useEffect(() => {\n    shareService.share.revalidate();\n  }, [shareService]);\n  const isSharedPage = useLiveData(shareService.share.isShared$);\n  const sharedMode = useLiveData(shareService.share.sharedMode$);\n  const baseUrl = useLiveData(serverConfig.config$.map(c => c?.baseUrl));\n  const isLoading =\n    isSharedPage === null || sharedMode === null || baseUrl === null;\n  const [showDisable, setShowDisable] = useState(false);\n\n  const currentDocMode = useLiveData(doc.mode$);\n\n  const mode = useMemo(() => {\n    if (isSharedPage && sharedMode) {\n      // if it's a shared page, use the share mode\n      return sharedMode.toLowerCase() as DocMode;\n    }\n    // default to  page mode\n    return currentDocMode;\n  }, [currentDocMode, isSharedPage, sharedMode]);\n\n  const { sharingUrl, onClickCopyLink } = useSharingUrl({\n    workspaceId,\n    pageId: doc.id,\n    urlType: 'share',\n  });\n\n  const t = useI18n();\n\n  const modeOptions = useMemo(\n    () => [\n      { value: 'page', label: t['com.affine.pageMode.page']() },\n      {\n        value: 'edgeless',\n        label: t['com.affine.pageMode.edgeless'](),\n      },\n    ],\n    [t]\n  );\n\n  const onClickCreateLink = useAsyncCallback(async () => {\n    try {\n      await shareService.share.enableShare(\n        mode === 'edgeless' ? PublicPageMode.Edgeless : PublicPageMode.Page\n      );\n      track.$.sharePanel.$.createShareLink({\n        mode,\n      });\n      notify.success({\n        title:\n          t[\n            'com.affine.share-menu.create-public-link.notification.success.title'\n          ](),\n        message:\n          t[\n            'com.affine.share-menu.create-public-link.notification.success.message'\n          ](),\n        style: 'normal',\n        icon: <SingleSelectSelectSolidIcon color={cssVar('primaryColor')} />,\n      });\n      if (sharingUrl) {\n        navigator.clipboard.writeText(sharingUrl).catch(err => {\n          console.error(err);\n        });\n      }\n    } catch (err) {\n      notify.error({\n        title:\n          t[\n            'com.affine.share-menu.confirm-modify-mode.notification.fail.title'\n          ](),\n        message:\n          t[\n            'com.affine.share-menu.confirm-modify-mode.notification.fail.message'\n          ](),\n      });\n      console.error(err);\n    }\n  }, [mode, shareService.share, sharingUrl, t]);\n\n  const onDisablePublic = useAsyncCallback(async () => {\n    try {\n      await shareService.share.disableShare();\n      notify.error({\n        title:\n          t[\n            'com.affine.share-menu.disable-publish-link.notification.success.title'\n          ](),\n        message:\n          t[\n            'com.affine.share-menu.disable-publish-link.notification.success.message'\n          ](),\n      });\n    } catch (err) {\n      notify.error({\n        title:\n          t[\n            'com.affine.share-menu.disable-publish-link.notification.fail.title'\n          ](),\n        message:\n          t[\n            'com.affine.share-menu.disable-publish-link.notification.fail.message'\n          ](),\n      });\n      console.log(err);\n    }\n    setShowDisable(false);\n  }, [shareService, t]);\n\n  const onShareModeChange = useAsyncCallback(\n    async (value: DocMode) => {\n      try {\n        if (isSharedPage) {\n          await shareService.share.changeShare(\n            value === 'edgeless' ? PublicPageMode.Edgeless : PublicPageMode.Page\n          );\n          notify.success({\n            title:\n              t[\n                'com.affine.share-menu.confirm-modify-mode.notification.success.title'\n              ](),\n            message: t[\n              'com.affine.share-menu.confirm-modify-mode.notification.success.message'\n            ]({\n              preMode: value === 'edgeless' ? t['Page']() : t['Edgeless'](),\n              currentMode: value === 'edgeless' ? t['Edgeless']() : t['Page'](),\n            }),\n            style: 'normal',\n            icon: (\n              <SingleSelectSelectSolidIcon color={cssVar('primaryColor')} />\n            ),\n          });\n        }\n      } catch (err) {\n        notify.error({\n          title:\n            t[\n              'com.affine.share-menu.confirm-modify-mode.notification.fail.title'\n            ](),\n          message:\n            t[\n              'com.affine.share-menu.confirm-modify-mode.notification.fail.message'\n            ](),\n        });\n        console.error(err);\n      }\n    },\n    [isSharedPage, shareService.share, t]\n  );\n\n  if (isLoading) {\n    // TODO(@eyhn): loading and error UI\n    return (\n      <>\n        <Skeleton height={100} />\n        <Skeleton height={40} />\n      </>\n    );\n  }\n\n  return (\n    <>\n      <div className={styles.titleContainerStyle}>\n        {t['com.affine.share-menu.publish-to-web']()}\n      </div>\n      <div className={styles.columnContainerStyle}>\n        <div className={styles.descriptionStyle}>\n          {t['com.affine.share-menu.publish-to-web.description']()}\n        </div>\n      </div>\n      <div className={styles.rowContainerStyle}>\n        <Input\n          inputStyle={{\n            color: 'var(--affine-text-secondary-color)',\n            fontSize: 'var(--affine-font-xs)',\n            lineHeight: '20px',\n          }}\n          value={(isSharedPage && sharingUrl) || `${baseUrl}/...`}\n          readOnly\n        />\n        {isSharedPage ? (\n          <Button\n            onClick={onClickCopyLink}\n            data-testid=\"share-menu-copy-link-button\"\n            style={{ padding: '4px 12px', whiteSpace: 'nowrap' }}\n            disabled={!sharingUrl}\n          >\n            {t.Copy()}\n          </Button>\n        ) : (\n          <Button\n            onClick={onClickCreateLink}\n            variant=\"primary\"\n            data-testid=\"share-menu-create-link-button\"\n            style={{ padding: '4px 12px', whiteSpace: 'nowrap' }}\n          >\n            {t.Create()}\n          </Button>\n        )}\n      </div>\n      <div className={styles.rowContainerStyle}>\n        <div className={styles.subTitleStyle}>\n          {t['com.affine.share-menu.ShareMode']()}\n        </div>\n        <div>\n          <RadioGroup\n            className={styles.radioButtonGroup}\n            value={mode}\n            onChange={onShareModeChange}\n            items={modeOptions}\n          />\n        </div>\n      </div>\n      {isSharedPage ? (\n        <>\n          {runtimeConfig.enableEnhanceShareMode && (\n            <>\n              <div className={styles.rowContainerStyle}>\n                <div className={styles.subTitleStyle}>Link expires</div>\n                <div>\n                  <Menu items={<MenuItem>Never</MenuItem>}>\n                    <MenuTrigger>Never</MenuTrigger>\n                  </Menu>\n                </div>\n              </div>\n              <div className={styles.rowContainerStyle}>\n                <div className={styles.subTitleStyle}>\n                  {'Show \"Created with AFFiNE\"'}\n                </div>\n                <div>\n                  <Switch />\n                </div>\n              </div>\n              <div className={styles.rowContainerStyle}>\n                <div className={styles.subTitleStyle}>\n                  Search engine indexing\n                </div>\n                <div>\n                  <Switch />\n                </div>\n              </div>\n            </>\n          )}\n          <MenuItem\n            endFix={<ArrowRightSmallIcon />}\n            block\n            type=\"danger\"\n            className={styles.menuItemStyle}\n            onSelect={e => {\n              e.preventDefault();\n              setShowDisable(true);\n            }}\n          >\n            <div className={styles.disableSharePage}>\n              {t['Disable Public Link']()}\n            </div>\n          </MenuItem>\n          <PublicLinkDisableModal\n            open={showDisable}\n            onConfirm={onDisablePublic}\n            onOpenChange={setShowDisable}\n          />\n        </>\n      ) : null}\n    </>\n  );\n};\n\nexport const SharePage = (props: ShareMenuProps) => {\n  if (props.workspaceMetadata.flavour === WorkspaceFlavour.LOCAL) {\n    return <LocalSharePage {...props} />;\n  } else if (\n    props.workspaceMetadata.flavour === WorkspaceFlavour.AFFINE_CLOUD\n  ) {\n    return (\n      // TODO(@eyhn): refactor this part\n      <ErrorBoundary fallback={null}>\n        <Suspense>\n          <AffineSharePage {...props} />\n        </Suspense>\n      </ErrorBoundary>\n    );\n  }\n  throw new Error('Unreachable');\n};\n","import { Button } from '@affine/component/ui/button';\nimport { Divider } from '@affine/component/ui/divider';\nimport { Menu } from '@affine/component/ui/menu';\nimport { ShareService } from '@affine/core/modules/share-doc';\nimport { WorkspaceFlavour } from '@affine/env/workspace';\nimport { useI18n } from '@affine/i18n';\nimport { WebIcon } from '@blocksuite/icons/rc';\nimport type { Doc } from '@blocksuite/store';\nimport {\n  useLiveData,\n  useService,\n  type WorkspaceMetadata,\n} from '@toeverything/infra';\nimport { forwardRef, type PropsWithChildren, type Ref, useEffect } from 'react';\n\nimport * as styles from './index.css';\nimport { ShareExport } from './share-export';\nimport { SharePage } from './share-page';\n\nexport interface ShareMenuProps extends PropsWithChildren {\n  workspaceMetadata: WorkspaceMetadata;\n  currentPage: Doc;\n  onEnableAffineCloud: () => void;\n  onOpenShareModal?: (open: boolean) => void;\n}\n\nexport const ShareMenuContent = (props: ShareMenuProps) => {\n  const t = useI18n();\n  return (\n    <div className={styles.containerStyle}>\n      <div className={styles.headerStyle}>\n        <div className={styles.shareIconStyle}>\n          <WebIcon />\n        </div>\n        {t['com.affine.share-menu.SharePage']()}\n      </div>\n      <SharePage {...props} />\n      <div className={styles.columnContainerStyle}>\n        <Divider size=\"thinner\" />\n      </div>\n      <ShareExport {...props} />\n    </div>\n  );\n};\n\nconst DefaultShareButton = forwardRef(function DefaultShareButton(\n  _,\n  ref: Ref<HTMLButtonElement>\n) {\n  const t = useI18n();\n  const shareService = useService(ShareService);\n  const shared = useLiveData(shareService.share.isShared$);\n\n  useEffect(() => {\n    shareService.share.revalidate();\n  }, [shareService]);\n\n  return (\n    <Button ref={ref} className={styles.shareButton} variant=\"primary\">\n      {shared\n        ? t['com.affine.share-menu.sharedButton']()\n        : t['com.affine.share-menu.shareButton']()}\n    </Button>\n  );\n});\n\nconst LocalShareMenu = (props: ShareMenuProps) => {\n  return (\n    <Menu\n      items={<ShareMenuContent {...props} />}\n      contentOptions={{\n        className: styles.menuStyle,\n        ['data-testid' as string]: 'local-share-menu',\n      }}\n      rootOptions={{\n        modal: false,\n        onOpenChange: props.onOpenShareModal,\n      }}\n    >\n      <div data-testid=\"local-share-menu-button\">\n        {props.children || <DefaultShareButton />}\n      </div>\n    </Menu>\n  );\n};\n\nconst CloudShareMenu = (props: ShareMenuProps) => {\n  return (\n    <Menu\n      items={<ShareMenuContent {...props} />}\n      contentOptions={{\n        className: styles.menuStyle,\n        ['data-testid' as string]: 'cloud-share-menu',\n      }}\n      rootOptions={{\n        modal: false,\n        onOpenChange: props.onOpenShareModal,\n      }}\n    >\n      <div data-testid=\"cloud-share-menu-button\">\n        {props.children || <DefaultShareButton />}\n      </div>\n    </Menu>\n  );\n};\n\nexport const ShareMenu = (props: ShareMenuProps) => {\n  const { workspaceMetadata } = props;\n\n  if (workspaceMetadata.flavour === WorkspaceFlavour.LOCAL) {\n    return <LocalShareMenu {...props} />;\n  }\n  return <CloudShareMenu {...props} />;\n};\n","import { WorkbenchService } from '@affine/core/modules/workbench';\nimport { useViewPosition } from '@affine/core/modules/workbench/view/use-view-position';\nimport { DocService, useLiveData, useService } from '@toeverything/infra';\n\nexport const useDetailPageHeaderResponsive = (availableWidth: number) => {\n  const mode = useLiveData(useService(DocService).doc.mode$);\n\n  const workbench = useService(WorkbenchService).workbench;\n  const viewPosition = useViewPosition();\n  const workbenchViewsCount = useLiveData(\n    workbench.views$.map(views => views.length)\n  );\n  const rightSidebarOpen = useLiveData(workbench.sidebarOpen$);\n\n  // share button should be hidden once split-view is enabled\n  const hideShare = availableWidth < 500 || workbenchViewsCount > 1;\n  const hidePresent = availableWidth < 400 || mode !== 'edgeless';\n  const hideCollect = availableWidth < 300;\n  const hideToday = availableWidth < 300;\n\n  const showDivider =\n    viewPosition.isLast &&\n    !rightSidebarOpen &&\n    !(hidePresent && hideShare) &&\n    !environment.isDesktop;\n\n  return {\n    hideShare,\n    hidePresent,\n    hideCollect,\n    hideToday,\n    showDivider,\n  };\n};\n","import type { IconButtonProps } from '@affine/component/ui/button';\nimport { IconButton } from '@affine/component/ui/button';\nimport { MoreHorizontalIcon } from '@blocksuite/icons/rc';\nimport { forwardRef } from 'react';\n\nimport { headerMenuTrigger } from './styles.css';\n\nexport const HeaderDropDownButton = forwardRef<\n  HTMLButtonElement,\n  Omit<IconButtonProps, 'children'>\n>((props, ref) => {\n  return (\n    <IconButton\n      ref={ref}\n      {...props}\n      data-testid=\"header-dropDownButton\"\n      className={headerMenuTrigger}\n    >\n      <MoreHorizontalIcon />\n    </IconButton>\n  );\n});\n\nHeaderDropDownButton.displayName = 'HeaderDropDownButton';\n","import \"../core/src/components/pure/header-drop-down-button/styles.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/components/pure/header-drop-down-button/styles.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xNHV5NmExMFtkYXRhLXN0YXRlPW9wZW5dIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1hZmZpbmUtaG92ZXItY29sb3IpOwp9\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var headerMenuTrigger = '_14uy6a10';","import { toast } from '@affine/component';\nimport {\n  Menu,\n  MenuIcon,\n  MenuItem,\n  MenuSeparator,\n  MenuSub,\n} from '@affine/component/ui/menu';\nimport {\n  openHistoryTipsModalAtom,\n  openInfoModalAtom,\n} from '@affine/core/atoms';\nimport { PageHistoryModal } from '@affine/core/components/affine/page-history-modal';\nimport { ShareMenuContent } from '@affine/core/components/affine/share-page-modal/share-menu';\nimport { Export, MoveToTrash } from '@affine/core/components/page-list';\nimport { useBlockSuiteMetaHelper } from '@affine/core/hooks/affine/use-block-suite-meta-helper';\nimport { useEnableCloud } from '@affine/core/hooks/affine/use-enable-cloud';\nimport { useExportPage } from '@affine/core/hooks/affine/use-export-page';\nimport { useTrashModalHelper } from '@affine/core/hooks/affine/use-trash-modal-helper';\nimport { useAsyncCallback } from '@affine/core/hooks/affine-async-hooks';\nimport { track } from '@affine/core/mixpanel';\nimport { WorkbenchService } from '@affine/core/modules/workbench';\nimport { ViewService } from '@affine/core/modules/workbench/services/view';\nimport { useDetailPageHeaderResponsive } from '@affine/core/pages/workspace/detail-page/use-header-responsive';\nimport { WorkspaceFlavour } from '@affine/env/workspace';\nimport { useI18n } from '@affine/i18n';\nimport {\n  DuplicateIcon,\n  EdgelessIcon,\n  EditIcon,\n  FavoritedIcon,\n  FavoriteIcon,\n  FrameIcon,\n  HistoryIcon,\n  ImportIcon,\n  InformationIcon,\n  OpenInNewIcon,\n  PageIcon,\n  ShareIcon,\n  SplitViewIcon,\n  TocIcon,\n} from '@blocksuite/icons/rc';\nimport type { Doc } from '@blocksuite/store';\nimport {\n  DocService,\n  useLiveData,\n  useService,\n  WorkspaceService,\n} from '@toeverything/infra';\nimport { useSetAtom } from 'jotai';\nimport { useCallback, useState } from 'react';\n\nimport { HeaderDropDownButton } from '../../../pure/header-drop-down-button';\nimport { usePageHelper } from '../../block-suite-page-list/utils';\nimport { useFavorite } from '../favorite';\n\ntype PageMenuProps = {\n  rename?: () => void;\n  page: Doc;\n  isJournal?: boolean;\n  containerWidth: number;\n};\n// fixme: refactor this file\nexport const PageHeaderMenuButton = ({\n  rename,\n  page,\n  isJournal,\n  containerWidth,\n}: PageMenuProps) => {\n  const pageId = page?.id;\n  const t = useI18n();\n  const { hideShare } = useDetailPageHeaderResponsive(containerWidth);\n  const confirmEnableCloud = useEnableCloud();\n\n  const workspace = useService(WorkspaceService).workspace;\n  const docCollection = workspace.docCollection;\n\n  const doc = useService(DocService).doc;\n  const isInTrash = useLiveData(doc.meta$.map(m => m.trash));\n  const currentMode = useLiveData(doc.mode$);\n\n  const workbench = useService(WorkbenchService).workbench;\n\n  const { favorite, toggleFavorite } = useFavorite(pageId);\n\n  const { duplicate } = useBlockSuiteMetaHelper(docCollection);\n  const { importFile } = usePageHelper(docCollection);\n  const { setTrashModal } = useTrashModalHelper(docCollection);\n\n  const view = useService(ViewService).view;\n\n  const openSidePanel = useCallback(\n    (id: string) => {\n      workbench.openSidebar();\n      view.activeSidebarTab(id);\n    },\n    [workbench, view]\n  );\n\n  const openAllFrames = useCallback(() => {\n    openSidePanel('frame');\n  }, [openSidePanel]);\n\n  const openOutlinePanel = useCallback(() => {\n    openSidePanel('outline');\n  }, [openSidePanel]);\n\n  const [historyModalOpen, setHistoryModalOpen] = useState(false);\n  const setOpenHistoryTipsModal = useSetAtom(openHistoryTipsModalAtom);\n\n  const openHistoryModal = useCallback(() => {\n    track.$.header.history.open();\n    if (workspace.flavour === WorkspaceFlavour.AFFINE_CLOUD) {\n      return setHistoryModalOpen(true);\n    }\n    return setOpenHistoryTipsModal(true);\n  }, [setOpenHistoryTipsModal, workspace.flavour]);\n\n  const setOpenInfoModal = useSetAtom(openInfoModalAtom);\n  const openInfoModal = useCallback(() => {\n    track.$.header.pageInfo.open();\n    setOpenInfoModal(true);\n  }, [setOpenInfoModal]);\n\n  const handleOpenInNewTab = useCallback(() => {\n    workbench.openDoc(pageId, {\n      at: 'new-tab',\n    });\n  }, [pageId, workbench]);\n\n  const handleOpenInSplitView = useCallback(() => {\n    workbench.openDoc(pageId, {\n      at: 'tail',\n    });\n  }, [pageId, workbench]);\n\n  const handleOpenTrashModal = useCallback(() => {\n    track.$.header.docOptions.deleteDoc();\n    setTrashModal({\n      open: true,\n      pageIds: [pageId],\n      pageTitles: [doc.meta$.value.title ?? ''],\n    });\n  }, [doc.meta$.value.title, pageId, setTrashModal]);\n\n  const handleRename = useCallback(() => {\n    rename?.();\n    track.$.header.docOptions.renameDoc();\n  }, [rename]);\n\n  const handleSwitchMode = useCallback(() => {\n    doc.toggleMode();\n    track.$.header.docOptions.switchPageMode({\n      mode: currentMode === 'page' ? 'edgeless' : 'page',\n    });\n    toast(\n      currentMode === 'page'\n        ? t['com.affine.toastMessage.edgelessMode']()\n        : t['com.affine.toastMessage.pageMode']()\n    );\n  }, [currentMode, doc, t]);\n  const menuItemStyle = {\n    padding: '4px 12px',\n    transition: 'all 0.3s',\n  };\n\n  const handleMenuOpenChange = useCallback((open: boolean) => {\n    if (open) {\n      track.$.header.docOptions.open();\n    }\n  }, []);\n\n  const exportHandler = useExportPage(doc.blockSuiteDoc);\n\n  const handleDuplicate = useCallback(() => {\n    duplicate(pageId);\n    track.$.header.docOptions.createDoc({\n      control: 'duplicate',\n    });\n  }, [duplicate, pageId]);\n\n  const onImportFile = useAsyncCallback(async () => {\n    const options = await importFile();\n    track.$.header.docOptions.import();\n    if (options.isWorkspaceFile) {\n      track.$.header.actions.createWorkspace({\n        control: 'import',\n      });\n    } else {\n      track.$.header.actions.createDoc({\n        control: 'import',\n      });\n    }\n  }, [importFile]);\n\n  const handleShareMenuOpenChange = useCallback((open: boolean) => {\n    if (open) {\n      track.$.sharePanel.$.open();\n    }\n  }, []);\n\n  const handleToggleFavorite = useCallback(() => {\n    track.$.header.docOptions.toggleFavorite();\n    toggleFavorite();\n  }, [toggleFavorite]);\n\n  const showResponsiveMenu = hideShare;\n  const ResponsiveMenuItems = (\n    <>\n      {hideShare ? (\n        <MenuSub\n          subContentOptions={{\n            sideOffset: 12,\n            alignOffset: -8,\n          }}\n          items={\n            <div style={{ padding: 4 }}>\n              <ShareMenuContent\n                workspaceMetadata={workspace.meta}\n                currentPage={page}\n                onEnableAffineCloud={() =>\n                  confirmEnableCloud(workspace, {\n                    openPageId: page.id,\n                  })\n                }\n              />\n            </div>\n          }\n          triggerOptions={{\n            preFix: (\n              <MenuIcon>\n                <ShareIcon />\n              </MenuIcon>\n            ),\n          }}\n          subOptions={{\n            onOpenChange: handleShareMenuOpenChange,\n          }}\n        >\n          {t['com.affine.share-menu.shareButton']()}\n        </MenuSub>\n      ) : null}\n      <MenuSeparator />\n    </>\n  );\n\n  const EditMenu = (\n    <>\n      {showResponsiveMenu ? ResponsiveMenuItems : null}\n      {!isJournal && (\n        <MenuItem\n          preFix={\n            <MenuIcon>\n              <EditIcon />\n            </MenuIcon>\n          }\n          data-testid=\"editor-option-menu-rename\"\n          onSelect={handleRename}\n          style={menuItemStyle}\n        >\n          {t['Rename']()}\n        </MenuItem>\n      )}\n      <MenuItem\n        preFix={\n          <MenuIcon>\n            {currentMode === 'page' ? <EdgelessIcon /> : <PageIcon />}\n          </MenuIcon>\n        }\n        data-testid=\"editor-option-menu-edgeless\"\n        onSelect={handleSwitchMode}\n        style={menuItemStyle}\n      >\n        {t['Convert to ']()}\n        {currentMode === 'page'\n          ? t['com.affine.pageMode.edgeless']()\n          : t['com.affine.pageMode.page']()}\n      </MenuItem>\n      <MenuItem\n        data-testid=\"editor-option-menu-favorite\"\n        onSelect={handleToggleFavorite}\n        style={menuItemStyle}\n        preFix={\n          <MenuIcon>\n            {favorite ? (\n              <FavoritedIcon style={{ color: 'var(--affine-primary-color)' }} />\n            ) : (\n              <FavoriteIcon />\n            )}\n          </MenuIcon>\n        }\n      >\n        {favorite\n          ? t['com.affine.favoritePageOperation.remove']()\n          : t['com.affine.favoritePageOperation.add']()}\n      </MenuItem>\n      <MenuSeparator />\n      <MenuItem\n        preFix={\n          <MenuIcon>\n            <OpenInNewIcon />\n          </MenuIcon>\n        }\n        data-testid=\"editor-option-menu-open-in-new-tab\"\n        onSelect={handleOpenInNewTab}\n        style={menuItemStyle}\n      >\n        {t['com.affine.workbench.tab.page-menu-open']()}\n      </MenuItem>\n\n      {environment.isDesktop && (\n        <MenuItem\n          preFix={\n            <MenuIcon>\n              <SplitViewIcon />\n            </MenuIcon>\n          }\n          data-testid=\"editor-option-menu-open-in-split-new\"\n          onSelect={handleOpenInSplitView}\n          style={menuItemStyle}\n        >\n          {t['com.affine.workbench.split-view.page-menu-open']()}\n        </MenuItem>\n      )}\n\n      <MenuSeparator />\n\n      {runtimeConfig.enableInfoModal && (\n        <MenuItem\n          preFix={\n            <MenuIcon>\n              <InformationIcon />\n            </MenuIcon>\n          }\n          data-testid=\"editor-option-menu-info\"\n          onSelect={openInfoModal}\n          style={menuItemStyle}\n        >\n          {t['com.affine.page-properties.page-info.view']()}\n        </MenuItem>\n      )}\n      {currentMode === 'page' ? (\n        <MenuItem\n          preFix={\n            <MenuIcon>\n              <TocIcon />\n            </MenuIcon>\n          }\n          data-testid=\"editor-option-toc\"\n          onSelect={openOutlinePanel}\n          style={menuItemStyle}\n        >\n          {t['com.affine.header.option.view-toc']()}\n        </MenuItem>\n      ) : (\n        <MenuItem\n          preFix={\n            <MenuIcon>\n              <FrameIcon />\n            </MenuIcon>\n          }\n          data-testid=\"editor-option-frame\"\n          onSelect={openAllFrames}\n          style={menuItemStyle}\n        >\n          {t['com.affine.header.option.view-frame']()}\n        </MenuItem>\n      )}\n      <MenuItem\n        preFix={\n          <MenuIcon>\n            <HistoryIcon />\n          </MenuIcon>\n        }\n        data-testid=\"editor-option-menu-history\"\n        onSelect={openHistoryModal}\n        style={menuItemStyle}\n      >\n        {t['com.affine.history.view-history-version']()}\n      </MenuItem>\n      <MenuSeparator />\n      {!isJournal && (\n        <MenuItem\n          preFix={\n            <MenuIcon>\n              <DuplicateIcon />\n            </MenuIcon>\n          }\n          data-testid=\"editor-option-menu-duplicate\"\n          onSelect={handleDuplicate}\n          style={menuItemStyle}\n        >\n          {t['com.affine.header.option.duplicate']()}\n        </MenuItem>\n      )}\n      <MenuItem\n        preFix={\n          <MenuIcon>\n            <ImportIcon />\n          </MenuIcon>\n        }\n        data-testid=\"editor-option-menu-import\"\n        onSelect={onImportFile}\n        style={menuItemStyle}\n      >\n        {t['Import']()}\n      </MenuItem>\n      <Export exportHandler={exportHandler} pageMode={currentMode} />\n      <MenuSeparator />\n      <MoveToTrash\n        data-testid=\"editor-option-menu-delete\"\n        onSelect={handleOpenTrashModal}\n      />\n    </>\n  );\n  if (isInTrash) {\n    return null;\n  }\n  return (\n    <>\n      <Menu\n        items={EditMenu}\n        contentOptions={{\n          align: 'center',\n        }}\n        rootOptions={{\n          onOpenChange: handleMenuOpenChange,\n        }}\n      >\n        <HeaderDropDownButton />\n      </Menu>\n      {workspace.flavour === WorkspaceFlavour.AFFINE_CLOUD ? (\n        <PageHistoryModal\n          docCollection={workspace.docCollection}\n          open={historyModalOpen}\n          pageId={pageId}\n          onOpenChange={setHistoryModalOpen}\n        />\n      ) : null}\n    </>\n  );\n};\n","import { IconButton } from '@affine/component';\nimport { PresentationIcon } from '@blocksuite/icons/rc';\n\nimport { usePresent } from './use-present';\n\nexport const DetailPageHeaderPresentButton = () => {\n  const { isPresent, handlePresent } = usePresent();\n\n  return (\n    <IconButton\n      style={{ flexShrink: 0 }}\n      size=\"24\"\n      onClick={() => handlePresent(!isPresent)}\n    >\n      <PresentationIcon />\n    </IconButton>\n  );\n};\n","import { useEnableCloud } from '@affine/core/hooks/affine/use-enable-cloud';\nimport { track } from '@affine/core/mixpanel';\nimport type { Doc } from '@blocksuite/store';\nimport { type Workspace } from '@toeverything/infra';\nimport { useCallback } from 'react';\n\nimport { ShareMenu } from './share-menu';\n\ntype SharePageModalProps = {\n  workspace: Workspace;\n  page: Doc;\n};\n\nexport const SharePageButton = ({ workspace, page }: SharePageModalProps) => {\n  const confirmEnableCloud = useEnableCloud();\n  const handleOpenShareModal = useCallback((open: boolean) => {\n    if (open) {\n      track.$.sharePanel.$.open();\n    }\n  }, []);\n\n  return (\n    <ShareMenu\n      workspaceMetadata={workspace.meta}\n      currentPage={page}\n      onEnableAffineCloud={() =>\n        confirmEnableCloud(workspace, {\n          openPageId: page.id,\n        })\n      }\n      onOpenShareModal={handleOpenShareModal}\n    />\n  );\n};\n","import \"../core/src/pages/workspace/detail-page/detail-page-header.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/pages/workspace/detail-page/detail-page-header.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xOThndnoxMCB7CiAgZGlzcGxheTogZmxleDsKICBoZWlnaHQ6IDEwMCU7CiAgd2lkdGg6IDEwMCU7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBnYXA6IDEycHg7Cn0KLl8xOThndnoxMSB7CiAgZmxleC1ncm93OiAxOwogIG1pbi13aWR0aDogMTJweDsKfQouXzE5OGd2ejEyIHsKICBtaW4td2lkdGg6IDEwMHB4OwogIGZsZXgtZ3JvdzogMTsKICBkaXNwbGF5OiBmbGV4OwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7Cn0KLl8xOThndnoxMyB7CiAgZGlzcGxheTogZmxleDsKICBhbGlnbi1pdGVtczogY2VudGVyOwogIGdhcDogMTBweDsKfQ==\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var header = '_198gvz10';\nexport var iconButtonContainer = '_198gvz13';\nexport var journalWeekPicker = '_198gvz12';\nexport var spacer = '_198gvz11';","import {\n  Divider,\n  type InlineEditHandle,\n  observeResize,\n} from '@affine/component';\nimport { openInfoModalAtom } from '@affine/core/atoms';\nimport { InfoModal } from '@affine/core/components/affine/page-properties';\nimport { FavoriteButton } from '@affine/core/components/blocksuite/block-suite-header/favorite';\nimport { InfoButton } from '@affine/core/components/blocksuite/block-suite-header/info';\nimport { JournalWeekDatePicker } from '@affine/core/components/blocksuite/block-suite-header/journal/date-picker';\nimport { JournalTodayButton } from '@affine/core/components/blocksuite/block-suite-header/journal/today-button';\nimport { PageHeaderMenuButton } from '@affine/core/components/blocksuite/block-suite-header/menu';\nimport { DetailPageHeaderPresentButton } from '@affine/core/components/blocksuite/block-suite-header/present/detail-header-present-button';\nimport { EditorModeSwitch } from '@affine/core/components/blocksuite/block-suite-mode-switch';\nimport { useRegisterCopyLinkCommands } from '@affine/core/hooks/affine/use-register-copy-link-commands';\nimport { useDocCollectionPageTitle } from '@affine/core/hooks/use-block-suite-workspace-page-title';\nimport { useJournalInfoHelper } from '@affine/core/hooks/use-journal';\nimport { track } from '@affine/core/mixpanel';\nimport { ViewIcon, ViewTitle } from '@affine/core/modules/workbench';\nimport type { Doc } from '@blocksuite/store';\nimport {\n  DocService,\n  useLiveData,\n  useService,\n  type Workspace,\n} from '@toeverything/infra';\nimport { useAtom, useAtomValue } from 'jotai';\nimport { forwardRef, useCallback, useEffect, useRef, useState } from 'react';\n\nimport { SharePageButton } from '../../../components/affine/share-page-modal';\nimport { appSidebarFloatingAtom } from '../../../components/app-sidebar';\nimport { BlocksuiteHeaderTitle } from '../../../components/blocksuite/block-suite-header/title/index';\nimport { HeaderDivider } from '../../../components/pure/header';\nimport * as styles from './detail-page-header.css';\nimport { useDetailPageHeaderResponsive } from './use-header-responsive';\n\nconst Header = forwardRef<\n  HTMLDivElement,\n  {\n    children: React.ReactNode;\n    className?: string;\n    style?: React.CSSProperties;\n  }\n>(({ children, style, className }, ref) => {\n  const appSidebarFloating = useAtomValue(appSidebarFloatingAtom);\n  return (\n    <div\n      data-testid=\"header\"\n      style={style}\n      className={className}\n      ref={ref}\n      data-sidebar-floating={appSidebarFloating}\n    >\n      {children}\n    </div>\n  );\n});\n\nHeader.displayName = 'forwardRef(Header)';\n\ninterface PageHeaderProps {\n  page: Doc;\n  workspace: Workspace;\n}\nexport function JournalPageHeader({ page, workspace }: PageHeaderProps) {\n  const containerRef = useRef<HTMLDivElement | null>(null);\n  const [containerWidth, setContainerWidth] = useState(0);\n\n  useEffect(() => {\n    const container = containerRef.current;\n    if (!container) return;\n    return observeResize(container, entry => {\n      setContainerWidth(entry.contentRect.width);\n    });\n  }, []);\n\n  const { hideShare, hideToday } =\n    useDetailPageHeaderResponsive(containerWidth);\n  const title = useDocCollectionPageTitle(workspace.docCollection, page?.id);\n  return (\n    <Header className={styles.header} ref={containerRef}>\n      <ViewTitle title={title} />\n      <ViewIcon icon=\"journal\" />\n      <EditorModeSwitch pageId={page?.id} />\n      <div className={styles.journalWeekPicker}>\n        <JournalWeekDatePicker\n          docCollection={workspace.docCollection}\n          page={page}\n        />\n      </div>\n      {hideToday ? null : (\n        <JournalTodayButton docCollection={workspace.docCollection} />\n      )}\n      <HeaderDivider />\n      <PageHeaderMenuButton\n        isJournal\n        page={page}\n        containerWidth={containerWidth}\n      />\n      {page && !hideShare ? (\n        <SharePageButton workspace={workspace} page={page} />\n      ) : null}\n    </Header>\n  );\n}\n\nexport function NormalPageHeader({ page, workspace }: PageHeaderProps) {\n  const titleInputHandleRef = useRef<InlineEditHandle>(null);\n  const containerRef = useRef<HTMLDivElement | null>(null);\n  const [containerWidth, setContainerWidth] = useState(0);\n\n  useEffect(() => {\n    const container = containerRef.current;\n    if (!container) return;\n    return observeResize(container, entry => {\n      setContainerWidth(entry.contentRect.width);\n    });\n  }, []);\n\n  const { hideCollect, hideShare, hidePresent, showDivider } =\n    useDetailPageHeaderResponsive(containerWidth);\n\n  const onRename = useCallback(() => {\n    setTimeout(() => titleInputHandleRef.current?.triggerEdit());\n  }, []);\n\n  const title = useDocCollectionPageTitle(workspace.docCollection, page?.id);\n  const doc = useService(DocService).doc;\n  const currentMode = useLiveData(doc.mode$);\n  const onEditSave = useCallback(() => {\n    track.$.header.actions.renameDoc();\n  }, []);\n\n  return (\n    <Header className={styles.header} ref={containerRef}>\n      <ViewTitle title={title} />\n      <ViewIcon icon={currentMode ?? 'page'} />\n      <EditorModeSwitch pageId={page?.id} />\n      <BlocksuiteHeaderTitle\n        inputHandleRef={titleInputHandleRef}\n        pageId={page?.id}\n        docCollection={workspace.docCollection}\n        onEditSave={onEditSave}\n      />\n      <div className={styles.iconButtonContainer}>\n        {hideCollect ? null : (\n          <>\n            <FavoriteButton pageId={page?.id} />\n            {runtimeConfig.enableInfoModal ? <InfoButton /> : null}\n          </>\n        )}\n        <PageHeaderMenuButton\n          rename={onRename}\n          page={page}\n          containerWidth={containerWidth}\n        />\n      </div>\n\n      <div className={styles.spacer} />\n\n      {!hidePresent ? <DetailPageHeaderPresentButton /> : null}\n\n      {page && !hideShare ? (\n        <SharePageButton workspace={workspace} page={page} />\n      ) : null}\n\n      {showDivider ? (\n        <Divider orientation=\"vertical\" style={{ height: 20, marginLeft: 4 }} />\n      ) : null}\n    </Header>\n  );\n}\n\nexport function DetailPageHeader(props: PageHeaderProps) {\n  const { page, workspace } = props;\n  const { isJournal } = useJournalInfoHelper(page.collection, page.id);\n  const isInTrash = page.meta?.trash;\n  const [openInfoModal, setOpenInfoModal] = useAtom(openInfoModalAtom);\n\n  useRegisterCopyLinkCommands({\n    workspaceMeta: workspace.meta,\n    docId: page.id,\n  });\n\n  return (\n    <>\n      {isJournal && !isInTrash ? (\n        <JournalPageHeader {...props} />\n      ) : (\n        <NormalPageHeader {...props} />\n      )}\n      <InfoModal\n        open={openInfoModal}\n        onOpenChange={setOpenInfoModal}\n        docId={page.id}\n      />\n    </>\n  );\n}\n","import {\n  PreconditionStrategy,\n  registerAffineCommand,\n} from '@affine/core/commands';\nimport { useSharingUrl } from '@affine/core/hooks/affine/use-share-url';\nimport { track } from '@affine/core/mixpanel';\nimport { useIsActiveView } from '@affine/core/modules/workbench';\nimport { WorkspaceFlavour } from '@affine/env/workspace';\nimport { type WorkspaceMetadata } from '@toeverything/infra';\nimport { useEffect } from 'react';\n\nexport function useRegisterCopyLinkCommands({\n  workspaceMeta,\n  docId,\n}: {\n  workspaceMeta: WorkspaceMetadata;\n  docId: string;\n}) {\n  const isActiveView = useIsActiveView();\n  const workspaceId = workspaceMeta.id;\n  const isCloud = workspaceMeta.flavour === WorkspaceFlavour.AFFINE_CLOUD;\n  const { onClickCopyLink } = useSharingUrl({\n    workspaceId,\n    pageId: docId,\n    urlType: 'workspace',\n  });\n\n  useEffect(() => {\n    const unsubs: Array<() => void> = [];\n\n    unsubs.push(\n      registerAffineCommand({\n        id: `affine:share-private-link:${docId}`,\n        category: 'affine:general',\n        preconditionStrategy: PreconditionStrategy.Never,\n        keyBinding: {\n          binding: '$mod+Shift+c',\n        },\n        label: '',\n        icon: null,\n        run() {\n          track.$.cmdk.general.copyShareLink({ type: 'private' });\n\n          isActiveView && isCloud && onClickCopyLink();\n        },\n      })\n    );\n    return () => {\n      unsubs.forEach(unsub => unsub());\n    };\n  }, [docId, isActiveView, isCloud, onClickCopyLink]);\n}\n","import { assertExists } from '@blocksuite/global/utils';\nimport type { AffineEditorContainer } from '@blocksuite/presets';\nimport { FramePanel } from '@blocksuite/presets';\nimport { useCallback, useRef } from 'react';\n\nimport * as styles from './frame.css';\n\n// A wrapper for FramePanel\nexport const EditorFramePanel = ({\n  editor,\n}: {\n  editor: AffineEditorContainer | null;\n}) => {\n  const framePanelRef = useRef<FramePanel | null>(null);\n\n  const onRefChange = useCallback((container: HTMLDivElement | null) => {\n    if (container) {\n      assertExists(framePanelRef.current, 'frame panel should be initialized');\n      container.append(framePanelRef.current);\n    }\n  }, []);\n\n  if (!editor) {\n    return;\n  }\n\n  if (!framePanelRef.current) {\n    framePanelRef.current = new FramePanel();\n  }\n\n  if (editor !== framePanelRef.current?.editor) {\n    (framePanelRef.current as FramePanel).editor = editor;\n    (framePanelRef.current as FramePanel).fitPadding = [20, 20, 20, 20];\n  }\n\n  return <div className={styles.root} ref={onRefChange} />;\n};\n","import \"../core/src/pages/workspace/detail-page/tabs/frame.css.ts.vanilla.css!=!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/pages/workspace/detail-page/tabs/frame.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xbnJhc2hqMCB7CiAgZGlzcGxheTogZmxleDsKICBoZWlnaHQ6IDEwMCU7CiAgd2lkdGg6IDEwMCU7Cn0=\\\"}!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var root = '_1nrashj0';","import \"../core/src/pages/workspace/detail-page/tabs/journal.css.ts.vanilla.css!=!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/pages/workspace/detail-page/tabs/journal.css.ts.vanilla.css\\\",\\\"source\\\":\\\"#H4sIAAAAAAAACq1X4W7jKBD+36dAkU5KT0vObpNu19W+x0mr/UFgHLOLwYJx4txp3/0EdmzTkDbprSIlDgwz3wzzfeBVK498/SUj/94R0hgnURpdEAuKodzDyx0hvLXO2II0RmoE+3L36241rCoqswcb1m4Z/7mzptWCcqO8/Z7ZJaWsLKUGGgz7mfvIQ7GF0lgIPrjRCBoLsli8RHDY1hnVYoAjtQMsSOafTcO4xOPwb2usAEstE7J1BZG6Aiuxn+moq5gwh4Jk4fPYdDHAxsqa2eMIkZzypbAHja4g2miIobMSh+xvRn4L1uw3YC0Nbx3dSye3CqKiTzVcPby1ZEr2HGH+HsLRbd43GhNC6l1B8qemm80+hNmDFFgVJM+yP3xuFchdhdN/IV2j2LEgpYLOD/hfKqQF3tecG9XW2s8wJXeaSoTaFcShBeRV6Js92FJ5/JUUAvQMwmOAcIqZjf531pvnNwLYsaYgz1GO6xDgzEcElUPPNEJ+tA5l6Qs5NJhrGAe6BTwAhBBjLbOhmsmomyith+fecKj0mOWQYGk00sNgu8mycczJf6Ag+bpfPUZeNx05eawkAg0gfRceLGsS7T4Yf7gI01RKaxA6pA640SJmCVqmR2IqRVaPbl6ib8xKRh0o4Aji6wJtC4vv16jbbBrBoozDXsR4kSVPH2jCYS85U3zZh/J1pNy0Gu/Jn4E+Z1UIz6WxNVnlG0eAORhN/PBgoRjC38uZa8b96UClFtCdnJO/SCouze/nqX2eUzx4vLT2/pz8o5fnWEaem25s/lvZuY548uUaBapZR0cqPWQ3x729zVU4Q08hB/7NKbnph26jg58IWOahZnryOZsFOunB2uvBWC+Wqte1vH6lCq9lJTuNTHo27cVjFu0b+zh5L1xNtvPMTps8bkF2ud6SG33ujs/dvRbc8/No2J1pApSSjZPuDZF9R7YjkP14fZs+xS2joESf4IXKR3mnQlxUPxGTuz/Xpq+ZJcRn6c5KEfrFSi/EdeN1i/a8c/5S2wDDJWvR0FIq9YnUUtesW+a+0T+RvLS96FhzoJM2kIG5NHGslhezu8i6uIHfJ8F0tl6zl9dRb8S/u0bu0of3b+6sc41Jv49M0L8JhoxKR9EIdowYHzl76p0lz23LTqJwf+5aG6S8tRY00tporKIYSX+K8Z80zxLOPnStiOClCZ5kVmuBBpFIAJGO/jCt1Ux9XZRMOVh8vwlhuBA0zFfl/2zxAL/vrSK8QTijpLhSI6p5465jcV4nibUZmvntkqderVLvcluDaOpByb0SjgHSdye6CbevX/8B0GwAv3APAAA=\\\"}!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var calendar = 'uiyc491';\nexport var dailyCount = 'uiyc493';\nexport var dailyCountContainer = 'uiyc496';\nexport var dailyCountContent = 'uiyc498';\nexport var dailyCountEmpty = 'uiyc499';\nexport var dailyCountHeader = 'uiyc494';\nexport var dailyCountItem = 'uiyc497';\nexport var dailyCountNav = 'uiyc495 uiyc490';\nexport var journalConflictBlock = 'uiyc49d';\nexport var journalConflictMoreTrigger = 'uiyc49f uiyc490';\nexport var journalConflictWrapper = 'uiyc49e';\nexport var journalDateCell = 'uiyc49g uiyc490';\nexport var journalDateCellDot = 'uiyc49h';\nexport var journalPanel = 'uiyc492';\nexport var pageItem = 'uiyc49a uiyc490';\nexport var pageItemIcon = 'uiyc49b';\nexport var pageItemLabel = 'uiyc49c';","import type { DateCell } from '@affine/component';\nimport { DatePicker, IconButton, Menu, Scrollable } from '@affine/component';\nimport { MoveToTrash } from '@affine/core/components/page-list';\nimport { useTrashModalHelper } from '@affine/core/hooks/affine/use-trash-modal-helper';\nimport { useDocCollectionPageTitle } from '@affine/core/hooks/use-block-suite-workspace-page-title';\nimport {\n  useJournalHelper,\n  useJournalInfoHelper,\n  useJournalRouteHelper,\n} from '@affine/core/hooks/use-journal';\nimport { WorkbenchLink } from '@affine/core/modules/workbench';\nimport { useI18n } from '@affine/i18n';\nimport {\n  EdgelessIcon,\n  MoreHorizontalIcon,\n  PageIcon,\n  TodayIcon,\n} from '@blocksuite/icons/rc';\nimport type { DocRecord } from '@toeverything/infra';\nimport {\n  DocService,\n  DocsService,\n  useLiveData,\n  useService,\n  WorkspaceService,\n} from '@toeverything/infra';\nimport { assignInlineVars } from '@vanilla-extract/dynamic';\nimport clsx from 'clsx';\nimport dayjs from 'dayjs';\nimport type { HTMLAttributes, PropsWithChildren, ReactNode } from 'react';\nimport { useCallback, useEffect, useMemo, useRef, useState } from 'react';\n\nimport * as styles from './journal.css';\n\n/**\n * @internal\n */\nconst CountDisplay = ({\n  count,\n  max = 99,\n  ...attrs\n}: { count: number; max?: number } & HTMLAttributes<HTMLSpanElement>) => {\n  return <span {...attrs}>{count > max ? `${max}+` : count}</span>;\n};\ninterface PageItemProps\n  extends Omit<HTMLAttributes<HTMLAnchorElement>, 'onClick'> {\n  docRecord: DocRecord;\n  right?: ReactNode;\n}\nconst PageItem = ({ docRecord, right, className, ...attrs }: PageItemProps) => {\n  const mode = useLiveData(docRecord.mode$);\n  const workspace = useService(WorkspaceService).workspace;\n  const title = useDocCollectionPageTitle(\n    workspace.docCollection,\n    docRecord.id\n  );\n  const { isJournal } = useJournalInfoHelper(\n    workspace.docCollection,\n    docRecord.id\n  );\n\n  const Icon = isJournal\n    ? TodayIcon\n    : mode === 'edgeless'\n      ? EdgelessIcon\n      : PageIcon;\n  return (\n    <WorkbenchLink\n      aria-label={title}\n      to={`/${docRecord.id}`}\n      className={clsx(className, styles.pageItem)}\n      {...attrs}\n    >\n      <div className={styles.pageItemIcon}>\n        <Icon width={20} height={20} />\n      </div>\n      <span className={styles.pageItemLabel}>{title}</span>\n      {right}\n    </WorkbenchLink>\n  );\n};\n\ntype NavItemName = 'createdToday' | 'updatedToday';\ninterface NavItem {\n  name: NavItemName;\n  label: string;\n  count: number;\n}\ninterface JournalBlockProps {\n  date: dayjs.Dayjs;\n}\n\nexport const EditorJournalPanel = () => {\n  const t = useI18n();\n  const doc = useService(DocService).doc;\n  const workspace = useService(WorkspaceService).workspace;\n  const { journalDate, isJournal } = useJournalInfoHelper(\n    workspace.docCollection,\n    doc.id\n  );\n  const { openJournal } = useJournalRouteHelper(workspace.docCollection);\n  const [date, setDate] = useState(dayjs().format('YYYY-MM-DD'));\n\n  useEffect(() => {\n    journalDate && setDate(journalDate.format('YYYY-MM-DD'));\n  }, [journalDate]);\n\n  const onDateSelect = useCallback(\n    (date: string) => {\n      if (journalDate && dayjs(date).isSame(dayjs(journalDate))) return;\n      openJournal(date);\n    },\n    [journalDate, openJournal]\n  );\n\n  const customDayRenderer = useCallback(\n    (cell: DateCell) => {\n      // TODO(@catsjuice): add a dot to indicate journal\n      // has performance issue for now, better to calculate it in advance\n      // const hasJournal = !!getJournalsByDate(cell.date.format('YYYY-MM-DD'))?.length;\n      const hasJournal = false;\n      return (\n        <button\n          className={styles.journalDateCell}\n          data-is-date-cell\n          tabIndex={cell.focused ? 0 : -1}\n          data-is-today={cell.isToday}\n          data-not-current-month={cell.notCurrentMonth}\n          data-selected={cell.selected}\n          data-is-journal={isJournal}\n          data-has-journal={hasJournal}\n        >\n          {cell.label}\n          {hasJournal && !cell.selected ? (\n            <div className={styles.journalDateCellDot} />\n          ) : null}\n        </button>\n      );\n    },\n    [isJournal]\n  );\n\n  return (\n    <div className={styles.journalPanel} data-is-journal={isJournal}>\n      <div className={styles.calendar}>\n        <DatePicker\n          weekDays={t['com.affine.calendar-date-picker.week-days']()}\n          monthNames={t['com.affine.calendar-date-picker.month-names']()}\n          todayLabel={t['com.affine.calendar-date-picker.today']()}\n          customDayRenderer={customDayRenderer}\n          value={date}\n          onChange={onDateSelect}\n        />\n      </div>\n      <JournalConflictBlock date={dayjs(date)} />\n      <JournalDailyCountBlock date={dayjs(date)} />\n    </div>\n  );\n};\n\nconst sortPagesByDate = (\n  docs: DocRecord[],\n  field: 'updatedDate' | 'createDate',\n  order: 'asc' | 'desc' = 'desc'\n) => {\n  return [...docs].sort((a, b) => {\n    return (\n      (order === 'asc' ? 1 : -1) *\n      dayjs(b.meta$.value[field]).diff(dayjs(a.meta$.value[field]))\n    );\n  });\n};\n\nconst DailyCountEmptyFallback = ({ name }: { name: NavItemName }) => {\n  const t = useI18n();\n\n  return (\n    <div className={styles.dailyCountEmpty}>\n      {name === 'createdToday'\n        ? t['com.affine.journal.daily-count-created-empty-tips']()\n        : t['com.affine.journal.daily-count-updated-empty-tips']()}\n    </div>\n  );\n};\nconst JournalDailyCountBlock = ({ date }: JournalBlockProps) => {\n  const nodeRef = useRef<HTMLDivElement>(null);\n  const t = useI18n();\n  const [activeItem, setActiveItem] = useState<NavItemName>('createdToday');\n  const docRecords = useLiveData(useService(DocsService).list.docs$);\n\n  const getTodaysPages = useCallback(\n    (field: 'createDate' | 'updatedDate') => {\n      return sortPagesByDate(\n        docRecords.filter(docRecord => {\n          const meta = docRecord.meta$.value;\n          if (meta.trash) return false;\n          return meta[field] && dayjs(meta[field]).isSame(date, 'day');\n        }),\n        field\n      );\n    },\n    [date, docRecords]\n  );\n\n  const createdToday = useMemo(\n    () => getTodaysPages('createDate'),\n    [getTodaysPages]\n  );\n  const updatedToday = useMemo(\n    () => getTodaysPages('updatedDate'),\n    [getTodaysPages]\n  );\n\n  const headerItems = useMemo<NavItem[]>(\n    () => [\n      {\n        name: 'createdToday',\n        label: t['com.affine.journal.created-today'](),\n        count: createdToday.length,\n      },\n      {\n        name: 'updatedToday',\n        label: t['com.affine.journal.updated-today'](),\n        count: updatedToday.length,\n      },\n    ],\n    [createdToday.length, t, updatedToday.length]\n  );\n\n  const activeIndex = headerItems.findIndex(({ name }) => name === activeItem);\n\n  const vars = assignInlineVars({\n    '--active-index': String(activeIndex),\n    '--item-count': String(headerItems.length),\n  });\n\n  return (\n    <div className={styles.dailyCount} style={vars}>\n      <header className={styles.dailyCountHeader}>\n        {headerItems.map(({ label, count, name }, index) => {\n          return (\n            <button\n              onClick={() => setActiveItem(name)}\n              aria-selected={activeItem === name}\n              className={styles.dailyCountNav}\n              key={index}\n            >\n              {label}\n              &nbsp;\n              <CountDisplay count={count} />\n            </button>\n          );\n        })}\n      </header>\n\n      <main className={styles.dailyCountContainer} data-active={activeItem}>\n        {headerItems.map(({ name }) => {\n          const renderList =\n            name === 'createdToday' ? createdToday : updatedToday;\n          if (renderList.length === 0)\n            return (\n              <div key={name} className={styles.dailyCountItem}>\n                <DailyCountEmptyFallback name={name} />\n              </div>\n            );\n          return (\n            <Scrollable.Root key={name} className={styles.dailyCountItem}>\n              <Scrollable.Scrollbar />\n              <Scrollable.Viewport>\n                <div className={styles.dailyCountContent} ref={nodeRef}>\n                  {renderList.map((pageRecord, index) => (\n                    <PageItem\n                      tabIndex={name === activeItem ? 0 : -1}\n                      key={index}\n                      docRecord={pageRecord}\n                    />\n                  ))}\n                </div>\n              </Scrollable.Viewport>\n            </Scrollable.Root>\n          );\n        })}\n      </main>\n    </div>\n  );\n};\n\nconst MAX_CONFLICT_COUNT = 5;\ninterface ConflictListProps\n  extends PropsWithChildren,\n    HTMLAttributes<HTMLDivElement> {\n  docRecords: DocRecord[];\n}\nconst ConflictList = ({\n  docRecords,\n  children,\n  className,\n  ...attrs\n}: ConflictListProps) => {\n  const workspace = useService(WorkspaceService).workspace;\n  const currentDoc = useService(DocService).doc;\n  const { setTrashModal } = useTrashModalHelper(workspace.docCollection);\n\n  const handleOpenTrashModal = useCallback(\n    (docRecord: DocRecord) => {\n      setTrashModal({\n        open: true,\n        pageIds: [docRecord.id],\n        pageTitles: [docRecord.title$.value],\n      });\n    },\n    [setTrashModal]\n  );\n\n  return (\n    <div className={clsx(styles.journalConflictWrapper, className)} {...attrs}>\n      {docRecords.map(docRecord => {\n        const isCurrent = docRecord.id === currentDoc.id;\n        return (\n          <PageItem\n            aria-selected={isCurrent}\n            docRecord={docRecord}\n            key={docRecord.id}\n            right={\n              <Menu\n                items={\n                  <MoveToTrash\n                    onSelect={() => handleOpenTrashModal(docRecord)}\n                  />\n                }\n              >\n                <IconButton>\n                  <MoreHorizontalIcon />\n                </IconButton>\n              </Menu>\n            }\n          />\n        );\n      })}\n      {children}\n    </div>\n  );\n};\nconst JournalConflictBlock = ({ date }: JournalBlockProps) => {\n  const t = useI18n();\n  const workspace = useService(WorkspaceService).workspace;\n  const docRecordList = useService(DocsService).list;\n  const journalHelper = useJournalHelper(workspace.docCollection);\n  const docs = journalHelper.getJournalsByDate(date.format('YYYY-MM-DD'));\n  const docRecords = useLiveData(\n    docRecordList.docs$.map(records =>\n      records.filter(v => {\n        return docs.some(doc => doc.id === v.id);\n      })\n    )\n  );\n\n  if (docs.length <= 1) return null;\n\n  return (\n    <ConflictList\n      className={styles.journalConflictBlock}\n      docRecords={docRecords.slice(0, MAX_CONFLICT_COUNT)}\n    >\n      {docs.length > MAX_CONFLICT_COUNT ? (\n        <Menu\n          items={\n            <ConflictList docRecords={docRecords.slice(MAX_CONFLICT_COUNT)} />\n          }\n        >\n          <div className={styles.journalConflictMoreTrigger}>\n            {t['com.affine.journal.conflict-show-more']({\n              count: (docRecords.length - MAX_CONFLICT_COUNT).toFixed(0),\n            })}\n          </div>\n        </Menu>\n      ) : null}\n    </ConflictList>\n  );\n};\n","import type { AffineEditorContainer } from '@blocksuite/presets';\nimport { OutlinePanel } from '@blocksuite/presets';\nimport { useCallback, useRef } from 'react';\n\nimport * as styles from './outline.css';\n\n// A wrapper for TOCNotesPanel\nexport const EditorOutlinePanel = ({\n  editor,\n}: {\n  editor: AffineEditorContainer | null;\n}) => {\n  const outlinePanelRef = useRef<OutlinePanel | null>(null);\n\n  const onRefChange = useCallback((container: HTMLDivElement | null) => {\n    if (container) {\n      if (outlinePanelRef.current === null) {\n        console.error('outline panel should be initialized');\n        return;\n      }\n      container.append(outlinePanelRef.current);\n    }\n  }, []);\n\n  if (!editor) {\n    return;\n  }\n\n  if (!outlinePanelRef.current) {\n    outlinePanelRef.current = new OutlinePanel();\n  }\n\n  if (editor !== outlinePanelRef.current?.editor) {\n    (outlinePanelRef.current as OutlinePanel).editor = editor;\n    (outlinePanelRef.current as OutlinePanel).fitPadding = [20, 20, 20, 20];\n  }\n\n  return <div className={styles.root} ref={onRefChange} />;\n};\n","import \"../core/src/pages/workspace/detail-page/tabs/outline.css.ts.vanilla.css!=!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/pages/workspace/detail-page/tabs/outline.css.ts.vanilla.css\\\",\\\"source\\\":\\\"Ll8xamU3bHAyMCB7CiAgZGlzcGxheTogZmxleDsKICBoZWlnaHQ6IDEwMCU7CiAgd2lkdGg6IDEwMCU7Cn0=\\\"}!../../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var root = '_1je7lp20';","import { Scrollable, useHasScrollTop } from '@affine/component';\nimport { PageDetailSkeleton } from '@affine/component/page-detail-skeleton';\n//import type { ChatPanel } from '@affine/core/blocksuite/presets/ai'; 24-10-02 \nimport { AIProvider } from '@affine/core/blocksuite/presets/ai';\n// import { PageAIOnboarding } from '@affine/core/components/affine/ai-onboarding'; 24-10-02 \nimport { EditorOutlineViewer } from '@affine/core/components/blocksuite/outline-viewer';\nimport { useAppSettingHelper } from '@affine/core/hooks/affine/use-app-setting-helper';\nimport { useDocMetaHelper } from '@affine/core/hooks/use-block-suite-page-meta';\nimport { RecentDocsService } from '@affine/core/modules/quicksearch';\nimport { ViewService } from '@affine/core/modules/workbench/services/view';\nimport type { PageRootService } from '@blocksuite/blocks';\nimport {\n  BookmarkBlockService,\n  customImageProxyMiddleware,\n  EmbedGithubBlockService,\n  EmbedLoomBlockService,\n  EmbedYoutubeBlockService,\n  ImageBlockService,\n} from '@blocksuite/blocks';\nimport { DisposableGroup } from '@blocksuite/global/utils';\nimport { FrameIcon, TocIcon, TodayIcon } from '@blocksuite/icons/rc';\nimport { type AffineEditorContainer } from '@blocksuite/presets';\nimport type { Doc as BlockSuiteDoc } from '@blocksuite/store';\nimport type { Doc } from '@toeverything/infra';\nimport {\n  DocService,\n  DocsService,\n  FrameworkScope,\n  globalBlockSuiteSchema,\n  GlobalContextService,\n  useLiveData,\n  useService,\n  WorkspaceService,\n} from '@toeverything/infra';\nimport clsx from 'clsx';\nimport type { ReactElement } from 'react';\nimport {\n  memo,\n  useCallback,\n  useEffect,\n  useLayoutEffect,\n  useRef,\n  useState,\n} from 'react';\nimport { useParams } from 'react-router-dom';\nimport type { Map as YMap } from 'yjs';\n\nimport { AffineErrorBoundary } from '../../../components/affine/affine-error-boundary';\nimport { GlobalPageHistoryModal } from '../../../components/affine/page-history-modal';\nimport { PageDetailEditor } from '../../../components/page-detail-editor';\nimport { TrashPageFooter } from '../../../components/pure/trash-page-footer';\nimport { TopTip } from '../../../components/top-tip';\nimport { useRegisterBlocksuiteEditorCommands } from '../../../hooks/affine/use-register-blocksuite-editor-commands';\nimport { useActiveBlocksuiteEditor } from '../../../hooks/use-block-suite-editor';\nimport { usePageDocumentTitle } from '../../../hooks/use-global-state';\nimport { useNavigateHelper } from '../../../hooks/use-navigate-helper';\nimport {\n  useIsActiveView,\n  ViewBody,\n  ViewHeader,\n  ViewSidebarTab,\n  WorkbenchService,\n} from '../../../modules/workbench';\nimport { performanceRenderLogger } from '../../../shared';\nimport { PageNotFound } from '../../404';\nimport * as styles from './detail-page.css';\nimport { DetailPageHeader } from './detail-page-header';\n//import { EditorChatPanel } from './tabs/chat'; 24-10-02 \nimport { EditorFramePanel } from './tabs/frame';\nimport { EditorJournalPanel } from './tabs/journal';\nimport { EditorOutlinePanel } from './tabs/outline';\n\nconst DetailPageImpl = memo(function DetailPageImpl() {\n  const workbench = useService(WorkbenchService).workbench;\n  const view = useService(ViewService).view;\n  const activeSidebarTab = useLiveData(view.activeSidebarTab$);\n\n  const doc = useService(DocService).doc;\n  const isInTrash = useLiveData(doc.meta$.map(meta => meta.trash));\n  const { openPage, jumpToPageBlock, jumpToTag } = useNavigateHelper();\n  const [editor, setEditor] = useState<AffineEditorContainer | null>(null);\n  const workspace = useService(WorkspaceService).workspace;\n  const globalContext = useService(GlobalContextService).globalContext;\n  const docCollection = workspace.docCollection;\n  const mode = useLiveData(doc.mode$);\n  const isSideBarOpen = useLiveData(workbench.sidebarOpen$);\n  const { appSettings } = useAppSettingHelper();\n  //const chatPanelRef = useRef<ChatPanel | null>(null);\n  const { setDocReadonly } = useDocMetaHelper(workspace.docCollection);\n\n  const isActiveView = useIsActiveView();\n  // TODO(@eyhn): remove jotai here\n  const [_, setActiveBlockSuiteEditor] = useActiveBlocksuiteEditor();\n\n  useEffect(() => {\n    if (isActiveView) {\n      setActiveBlockSuiteEditor(editor);\n    }\n  }, [editor, isActiveView, setActiveBlockSuiteEditor]);\n\n  useEffect(() => {\n    const disposable = AIProvider.slots.requestOpenWithChat.on(() => {\n      workbench.openSidebar();\n      view.activeSidebarTab('journal');\n    });\n    return () => disposable.dispose();\n  }, [activeSidebarTab, view, workbench]);\n\n  useEffect(() => {\n    if (isActiveView) {\n      globalContext.docId.set(doc.id);\n      globalContext.isDoc.set(true);\n\n      return () => {\n        globalContext.docId.set(null);\n        globalContext.isDoc.set(false);\n      };\n    }\n    return;\n  }, [doc, globalContext, isActiveView]);\n\n  useEffect(() => {\n    if (isActiveView) {\n      globalContext.docMode.set(mode);\n\n      return () => {\n        globalContext.docMode.set(null);\n      };\n    }\n    return;\n  }, [doc, globalContext, isActiveView, mode]);\n\n  useEffect(() => {\n    if ('isMobile' in environment && environment.isMobile) {\n      setDocReadonly(doc.id, true);\n    }\n  }, [doc.id, setDocReadonly]);\n\n  useEffect(() => {\n    if (isActiveView) {\n      globalContext.isTrashDoc.set(!!isInTrash);\n\n      return () => {\n        globalContext.isTrashDoc.set(null);\n      };\n    }\n    return;\n  }, [globalContext, isActiveView, isInTrash]);\n\n  useRegisterBlocksuiteEditorCommands();\n  const title = useLiveData(doc.title$);\n  usePageDocumentTitle(title);\n\n  const onLoad = useCallback(\n    (bsPage: BlockSuiteDoc, editor: AffineEditorContainer) => {\n      try {\n        // todo(joooye34): improve the following migration code\n        const surfaceBlock = bsPage.getBlockByFlavour('affine:surface')[0];\n        // hotfix for old page\n        if (\n          surfaceBlock &&\n          (surfaceBlock.yBlock.get('prop:elements') as YMap<any>).get(\n            'type'\n          ) !== '$blocksuite:internal:native$'\n        ) {\n          globalBlockSuiteSchema.upgradeDoc(\n            0,\n            {\n              'affine:surface': 3,\n            },\n            bsPage.spaceDoc\n          );\n        }\n      } catch {}\n\n      // blocksuite editor host\n      const editorHost = editor.host;\n\n      // provide image proxy endpoint to blocksuite\n      editorHost?.std.clipboard.use(\n        customImageProxyMiddleware(runtimeConfig.imageProxyUrl)\n      );\n      ImageBlockService.setImageProxyURL(runtimeConfig.imageProxyUrl);\n\n      // provide link preview endpoint to blocksuite\n      BookmarkBlockService.setLinkPreviewEndpoint(runtimeConfig.linkPreviewUrl);\n      EmbedGithubBlockService.setLinkPreviewEndpoint(\n        runtimeConfig.linkPreviewUrl\n      );\n      EmbedYoutubeBlockService.setLinkPreviewEndpoint(\n        runtimeConfig.linkPreviewUrl\n      );\n      EmbedLoomBlockService.setLinkPreviewEndpoint(\n        runtimeConfig.linkPreviewUrl\n      );\n\n      // provide page mode and updated date to blocksuite\n      const pageService =\n        editorHost?.std.spec.getService<PageRootService>('affine:page');\n      const disposable = new DisposableGroup();\n      if (pageService) {\n        disposable.add(\n          pageService.slots.docLinkClicked.on(({ docId, blockId }) => {\n            return blockId\n              ? jumpToPageBlock(docCollection.id, docId, blockId)\n              : openPage(docCollection.id, docId);\n          })\n        );\n        disposable.add(\n          pageService.slots.tagClicked.on(({ tagId }) => {\n            jumpToTag(workspace.id, tagId);\n          })\n        );\n      }\n\n      setEditor(editor);\n\n      return () => {\n        disposable.dispose();\n      };\n    },\n    [jumpToPageBlock, docCollection.id, openPage, jumpToTag, workspace.id]\n  );\n\n  const [refCallback, hasScrollTop] = useHasScrollTop();\n  const dynamicTopBorder = environment.isDesktop;\n\n  const openOutlinePanel = useCallback(() => {\n    workbench.openSidebar();\n    view.activeSidebarTab('outline');\n  }, [workbench, view]);\n\n  return (\n    <>\n      <ViewHeader>\n        <DetailPageHeader page={doc.blockSuiteDoc} workspace={workspace} />\n      </ViewHeader>\n      <ViewBody>\n        <div\n          className={styles.mainContainer}\n          data-dynamic-top-border={dynamicTopBorder}\n          data-has-scroll-top={hasScrollTop}\n        >\n          {/* Add a key to force rerender when page changed, to avoid error boundary persisting. */}\n          <AffineErrorBoundary key={doc.id}>\n            <TopTip pageId={doc.id} workspace={workspace} />\n            <Scrollable.Root>\n              <Scrollable.Viewport\n                ref={refCallback}\n                className={clsx(\n                  'affine-page-viewport',\n                  styles.affineDocViewport,\n                  styles.editorContainer\n                )}\n              >\n                <PageDetailEditor\n                  pageId={doc.id}\n                  onLoad={onLoad}\n                  docCollection={docCollection}\n                />\n              </Scrollable.Viewport>\n              <Scrollable.Scrollbar\n                className={clsx({\n                  [styles.scrollbar]: !appSettings.clientBorder,\n                })}\n              />\n            </Scrollable.Root>\n            <EditorOutlineViewer\n              editor={editor}\n              show={mode === 'page' && !isSideBarOpen}\n              openOutlinePanel={openOutlinePanel}\n            />\n          </AffineErrorBoundary>\n          {isInTrash ? <TrashPageFooter /> : null}\n        </div>\n      </ViewBody>\n\n      {/* <ViewSidebarTab tabId=\"chat\" icon={<AiIcon />} unmountOnInactive={false}>\n        <EditorChatPanel editor={editor} ref={chatPanelRef} />\n      </ViewSidebarTab> 24-10-02 */}\n\n      <ViewSidebarTab tabId=\"journal\" icon={<TodayIcon />}>\n        <EditorJournalPanel />\n      </ViewSidebarTab>\n\n      <ViewSidebarTab tabId=\"outline\" icon={<TocIcon />}>\n        <EditorOutlinePanel editor={editor} />\n      </ViewSidebarTab>\n\n      <ViewSidebarTab tabId=\"frame\" icon={<FrameIcon />}>\n        <EditorFramePanel editor={editor} />\n      </ViewSidebarTab>\n\n      <GlobalPageHistoryModal />\n      {/* <PageAIOnboarding /> 24-10-02 */}\n    </>\n  );\n});\n\nexport const DetailPage = ({ pageId }: { pageId: string }): ReactElement => {\n  const currentWorkspace = useService(WorkspaceService).workspace;\n  const docsService = useService(DocsService);\n  const docRecordList = docsService.list;\n  const docListReady = useLiveData(docRecordList.isReady$);\n  const docRecord = useLiveData(docRecordList.doc$(pageId));\n\n  const [doc, setDoc] = useState<Doc | null>(null);\n\n  useLayoutEffect(() => {\n    if (!docRecord) {\n      return;\n    }\n    const { doc: opened, release } = docsService.open(pageId);\n    setDoc(opened);\n    return () => {\n      release();\n    };\n  }, [docRecord, docsService, pageId]);\n\n  // set sync engine priority target\n  useEffect(() => {\n    currentWorkspace.engine.doc.setPriority(pageId, 10);\n    return () => {\n      currentWorkspace.engine.doc.setPriority(pageId, 5);\n    };\n  }, [currentWorkspace, pageId]);\n\n  const isInTrash = useLiveData(doc?.meta$.map(meta => meta.trash));\n\n  useEffect(() => {\n    if (doc && isInTrash) {\n      currentWorkspace.docCollection.awarenessStore.setReadonly(\n        doc.blockSuiteDoc.blockCollection,\n        true\n      );\n    }\n  }, [currentWorkspace.docCollection.awarenessStore, doc, isInTrash]);\n\n  // if sync engine has been synced and the page is null, show 404 page.\n  if (docListReady && !doc) {\n    return <PageNotFound noPermission />;\n  }\n\n  if (!doc) {\n    return <PageDetailSkeleton key=\"current-page-is-null\" />;\n  }\n\n  return (\n    <FrameworkScope scope={doc.scope}>\n      <DetailPageImpl />\n    </FrameworkScope>\n  );\n};\n\nexport const Component = () => {\n  performanceRenderLogger.debug('DetailPage');\n\n  const params = useParams();\n  const recentPages = useService(RecentDocsService);\n\n  useEffect(() => {\n    if (params.pageId) {\n      const pageId = params.pageId;\n      localStorage.setItem('last_page_id', pageId);\n\n      recentPages.addRecentDoc(pageId);\n    }\n  }, [params, recentPages]);\n\n  const pageId = params.pageId;\n\n  return pageId ? <DetailPage pageId={pageId} /> : null;\n};\n","import { toast } from '@affine/component';\nimport { openInfoModalAtom } from '@affine/core/atoms';\nimport {\n  PreconditionStrategy,\n  registerAffineCommand,\n} from '@affine/core/commands';\nimport { track } from '@affine/core/mixpanel';\nimport { CompatibleFavoriteItemsAdapter } from '@affine/core/modules/properties';\nimport { WorkspaceFlavour } from '@affine/env/workspace';\nimport { useI18n } from '@affine/i18n';\nimport { EdgelessIcon, HistoryIcon, PageIcon } from '@blocksuite/icons/rc';\nimport {\n  DocService,\n  useLiveData,\n  useService,\n  WorkspaceService,\n} from '@toeverything/infra';\nimport { useSetAtom } from 'jotai';\nimport { useCallback, useEffect } from 'react';\n\nimport { pageHistoryModalAtom } from '../../atoms/page-history';\nimport { useBlockSuiteMetaHelper } from './use-block-suite-meta-helper';\nimport { useExportPage } from './use-export-page';\nimport { useTrashModalHelper } from './use-trash-modal-helper';\n\nexport function useRegisterBlocksuiteEditorCommands() {\n  const doc = useService(DocService).doc;\n  const docId = doc.id;\n  const mode = useLiveData(doc.mode$);\n  const t = useI18n();\n  const workspace = useService(WorkspaceService).workspace;\n  const docCollection = workspace.docCollection;\n\n  const favAdapter = useService(CompatibleFavoriteItemsAdapter);\n  const favorite = useLiveData(favAdapter.isFavorite$(docId, 'doc'));\n  const trash = useLiveData(doc.trash$);\n\n  const setPageHistoryModalState = useSetAtom(pageHistoryModalAtom);\n  const setInfoModalState = useSetAtom(openInfoModalAtom);\n\n  const openHistoryModal = useCallback(() => {\n    setPageHistoryModalState(() => ({\n      pageId: docId,\n      open: true,\n    }));\n  }, [docId, setPageHistoryModalState]);\n\n  const openInfoModal = useCallback(() => {\n    setInfoModalState(true);\n  }, [setInfoModalState]);\n\n  const { duplicate } = useBlockSuiteMetaHelper(docCollection);\n  const exportHandler = useExportPage(doc.blockSuiteDoc);\n  const { setTrashModal } = useTrashModalHelper(docCollection);\n  const onClickDelete = useCallback(\n    (title: string) => {\n      setTrashModal({\n        open: true,\n        pageIds: [docId],\n        pageTitles: [title],\n      });\n    },\n    [docId, setTrashModal]\n  );\n\n  const isCloudWorkspace = workspace.flavour === WorkspaceFlavour.AFFINE_CLOUD;\n\n  useEffect(() => {\n    const unsubs: Array<() => void> = [];\n    const preconditionStrategy = () =>\n      PreconditionStrategy.InPaperOrEdgeless && !trash;\n\n    // TODO(@Peng): add back when edgeless presentation is ready\n\n    // this is pretty hack and easy to break. need a better way to communicate with blocksuite editor\n    // unsubs.push(\n    //   registerAffineCommand({\n    //     id: 'editor:edgeless-presentation-start',\n    //     preconditionStrategy: () => PreconditionStrategy.InEdgeless && !trash,\n    //     category: 'editor:edgeless',\n    //     icon: <EdgelessIcon />,\n    //     label: t['com.affine.cmdk.affine.editor.edgeless.presentation-start'](),\n    //     run() {\n    //       document\n    //         .querySelector<HTMLElement>('edgeless-toolbar')\n    //         ?.shadowRoot?.querySelector<HTMLElement>(\n    //           '.edgeless-toolbar-left-part > edgeless-tool-icon-button:last-child'\n    //         )\n    //         ?.click();\n    //     },\n    //   })\n    // );\n\n    unsubs.push(\n      registerAffineCommand({\n        id: `editor:${mode}-view-info`,\n        preconditionStrategy: () =>\n          PreconditionStrategy.InPaperOrEdgeless &&\n          !trash &&\n          runtimeConfig.enableInfoModal,\n        category: `editor:${mode}`,\n        icon: mode === 'page' ? <PageIcon /> : <EdgelessIcon />,\n        label: t['com.affine.page-properties.page-info.view'](),\n        run() {\n          track.$.cmdk.docInfo.open();\n\n          openInfoModal();\n        },\n      })\n    );\n\n    unsubs.push(\n      registerAffineCommand({\n        id: `editor:${mode}-${favorite ? 'remove-from' : 'add-to'}-favourites`,\n        preconditionStrategy,\n        category: `editor:${mode}`,\n        icon: mode === 'page' ? <PageIcon /> : <EdgelessIcon />,\n        label: favorite\n          ? t['com.affine.favoritePageOperation.remove']()\n          : t['com.affine.favoritePageOperation.add'](),\n        run() {\n          favAdapter.toggle(docId, 'doc');\n          track.$.cmdk.editor.toggleFavorite();\n\n          toast(\n            favorite\n              ? t['com.affine.cmdk.affine.editor.remove-from-favourites']()\n              : t['com.affine.cmdk.affine.editor.add-to-favourites']()\n          );\n        },\n      })\n    );\n\n    unsubs.push(\n      registerAffineCommand({\n        id: `editor:${mode}-convert-to-${\n          mode === 'page' ? 'edgeless' : 'page'\n        }`,\n        preconditionStrategy,\n        category: `editor:${mode}`,\n        icon: mode === 'page' ? <PageIcon /> : <EdgelessIcon />,\n        label: `${t['Convert to ']()}${\n          mode === 'page'\n            ? t['com.affine.pageMode.edgeless']()\n            : t['com.affine.pageMode.page']()\n        }`,\n        run() {\n          track.$.cmdk.editor.switchPageMode({\n            mode: mode === 'page' ? 'edgeless' : 'page',\n          });\n\n          doc.toggleMode();\n          toast(\n            mode === 'page'\n              ? t['com.affine.toastMessage.edgelessMode']()\n              : t['com.affine.toastMessage.pageMode']()\n          );\n        },\n      })\n    );\n\n    // TODO(@Peng): should not show duplicate for journal\n    unsubs.push(\n      registerAffineCommand({\n        id: `editor:${mode}-duplicate`,\n        preconditionStrategy,\n        category: `editor:${mode}`,\n        icon: mode === 'page' ? <PageIcon /> : <EdgelessIcon />,\n        label: t['com.affine.header.option.duplicate'](),\n        run() {\n          duplicate(docId);\n          track.$.cmdk.editor.createDoc({\n            control: 'duplicate',\n          });\n        },\n      })\n    );\n\n    unsubs.push(\n      registerAffineCommand({\n        id: `editor:${mode}-export-to-pdf`,\n        preconditionStrategy: () => mode === 'page' && !trash,\n        category: `editor:${mode}`,\n        icon: mode === 'page' ? <PageIcon /> : <EdgelessIcon />,\n        label: t['Export to PDF'](),\n        async run() {\n          track.$.cmdk.editor.export({\n            type: 'pdf',\n          });\n\n          await exportHandler('pdf');\n        },\n      })\n    );\n\n    unsubs.push(\n      registerAffineCommand({\n        id: `editor:${mode}-export-to-html`,\n        preconditionStrategy,\n        category: `editor:${mode}`,\n        icon: mode === 'page' ? <PageIcon /> : <EdgelessIcon />,\n        label: t['Export to HTML'](),\n        async run() {\n          track.$.cmdk.editor.export({\n            type: 'html',\n          });\n\n          await exportHandler('html');\n        },\n      })\n    );\n\n    unsubs.push(\n      registerAffineCommand({\n        id: `editor:${mode}-export-to-png`,\n        preconditionStrategy: () => mode === 'page' && !trash,\n        category: `editor:${mode}`,\n        icon: mode === 'page' ? <PageIcon /> : <EdgelessIcon />,\n        label: t['Export to PNG'](),\n        async run() {\n          track.$.cmdk.editor.export({\n            type: 'png',\n          });\n\n          await exportHandler('png');\n        },\n      })\n    );\n\n    unsubs.push(\n      registerAffineCommand({\n        id: `editor:${mode}-export-to-markdown`,\n        preconditionStrategy,\n        category: `editor:${mode}`,\n        icon: mode === 'page' ? <PageIcon /> : <EdgelessIcon />,\n        label: t['Export to Markdown'](),\n        async run() {\n          track.$.cmdk.editor.export({\n            type: 'markdown',\n          });\n\n          await exportHandler('markdown');\n        },\n      })\n    );\n\n    unsubs.push(\n      registerAffineCommand({\n        id: `editor:${mode}-move-to-trash`,\n        preconditionStrategy,\n        category: `editor:${mode}`,\n        icon: mode === 'page' ? <PageIcon /> : <EdgelessIcon />,\n        label: t['com.affine.moveToTrash.title'](),\n        run() {\n          track.$.cmdk.editor.deleteDoc();\n\n          onClickDelete(doc.title$.value);\n        },\n      })\n    );\n\n    unsubs.push(\n      registerAffineCommand({\n        id: `editor:${mode}-restore-from-trash`,\n        preconditionStrategy: () =>\n          PreconditionStrategy.InPaperOrEdgeless && trash,\n        category: `editor:${mode}`,\n        icon: mode === 'page' ? <PageIcon /> : <EdgelessIcon />,\n        label: t['com.affine.cmdk.affine.editor.restore-from-trash'](),\n        run() {\n          track.$.cmdk.editor.restoreDoc();\n\n          doc.restoreFromTrash();\n        },\n      })\n    );\n\n    if (isCloudWorkspace) {\n      unsubs.push(\n        registerAffineCommand({\n          id: `editor:${mode}-page-history`,\n          category: `editor:${mode}`,\n          icon: <HistoryIcon />,\n          label: t['com.affine.cmdk.affine.editor.reveal-page-history-modal'](),\n          run() {\n            track.$.cmdk.docHistory.open();\n\n            openHistoryModal();\n          },\n        })\n      );\n    }\n\n    unsubs.push(\n      registerAffineCommand({\n        id: 'alert-ctrl-s',\n        category: 'affine:general',\n        preconditionStrategy: PreconditionStrategy.Never,\n        keyBinding: {\n          binding: '$mod+s',\n        },\n        label: '',\n        icon: null,\n        run() {\n          toast(t['Save']());\n        },\n      })\n    );\n\n    return () => {\n      unsubs.forEach(unsub => unsub());\n    };\n  }, [\n    favorite,\n    mode,\n    onClickDelete,\n    exportHandler,\n    t,\n    trash,\n    isCloudWorkspace,\n    openHistoryModal,\n    duplicate,\n    favAdapter,\n    docId,\n    doc,\n    openInfoModal,\n  ]);\n}\n","import \"../core/src/pages/workspace/detail-page/detail-page.css.ts.vanilla.css!=!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/virtualFileLoader/dist/vanilla-extract-webpack-plugin-virtualFileLoader.cjs.js?{\\\"fileName\\\":\\\"../core/src/pages/workspace/detail-page/detail-page.css.ts.vanilla.css\\\",\\\"source\\\":\\\"LmlnaTl3NTAgewogIGNvbnRhaW5lci10eXBlOiBpbmxpbmUtc2l6ZTsKICBkaXNwbGF5OiBmbGV4OwogIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgZmxleDogMTsKICBvdmVyZmxvdzogaGlkZGVuOwogIGJvcmRlci10b3A6IDAuNXB4IHNvbGlkIHRyYW5zcGFyZW50OwogIHRyYW5zaXRpb246IGJvcmRlci1jb2xvciAwLjJzOwp9Ci5pZ2k5dzUwW2RhdGEtZHluYW1pYy10b3AtYm9yZGVyPSJmYWxzZSJdIHsKICBib3JkZXItY29sb3I6IHZhcigtLWFmZmluZS1ib3JkZXItY29sb3IpOwp9Ci5pZ2k5dzUwW2RhdGEtaGFzLXNjcm9sbC10b3A9InRydWUiXSB7CiAgYm9yZGVyLWNvbG9yOiB2YXIoLS1hZmZpbmUtYm9yZGVyLWNvbG9yKTsKfQouaWdpOXc1MSB7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIGRpc3BsYXk6IGZsZXg7CiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICBmbGV4OiAxOwogIHotaW5kZXg6IDA7Cn0KLmlnaTl3NTIgewogIGRpc3BsYXk6IGZsZXg7CiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICBjb250YWluZXItbmFtZTogdmlld3BvcnQ7CiAgY29udGFpbmVyLXR5cGU6IGlubGluZS1zaXplOwogIGJhY2tncm91bmQ6IHZhcigtLWFmZmluZS1iYWNrZ3JvdW5kLXByaW1hcnktY29sb3IpOwp9Ci5pZ2k5dzUzIHsKICBtYXJnaW4tcmlnaHQ6IDRweDsKfQpAbWVkaWEgcHJpbnQgewogIC5pZ2k5dzUyIHsKICAgIGRpc3BsYXk6IG5vbmU7CiAgICB6LWluZGV4OiAtMTsKICB9Cn0=\\\"}!../../../../../../../node_modules/@vanilla-extract/webpack-plugin/extracted.js\"\nexport var affineDocViewport = 'igi9w52';\nexport var editorContainer = 'igi9w51';\nexport var mainContainer = 'igi9w50';\nexport var scrollbar = 'igi9w53';"],"names":["weakMap","WeakMap","useDocCollectionPageTitle","docCollection","pageId","titleAtom","getAtom","w","has","set","Map","map","get","assertExists","baseAtom","atom","getDoc","meta","title","onMount","disposable","docMetaUpdated","on","page","dispose","useAtomValue","localizedJournalDate","useJournalInfoHelper","pageHistoryModalAtom","open","logger","DebugLogger","useDocSnapshotList","workspaceId","pageDocId","data","loadingMore","loadMore","useQueryInfinite","query","listHistoryQuery","getVariables","_","previousPageData","before","workspace","histories","at","timestamp","take","shouldLoadMore","useMemo","lastPage","length","flatMap","snapshotFetcher","ts","res","fetch","ok","snapshot","arrayBuffer","docCollectionMap","getOrCreateShellWorkspace","blobStorage","CloudBlobStorage","DocCollection","id","blobSources","main","schema","globalBlockSuiteSchema","disableBacklinkIndex","disableSearchIndex","doc","emit","usePageHistory","useSWRImmutable","fetcher","suspense","undefined","useSnapshotPage","historyShellWorkspace","createDoc","awarenessStore","setReadonly","blockCollection","spaceDoc","load","applyUpdate","Uint8Array","upgradeDoc","useEffect","update","encodeStateAsUpdate","historyListGroupByDay","history","day","i18nTime","relative","max","accuracy","weekday","absolute","noYear","list","push","entries","useRestorePage","useDocCollectionPage","mutateQueryResource","useMutateQueryResource","trigger","recover","isMutating","useMutation","mutation","recoverDocMutation","getDocMeta","setDocTitle","useDocMetaHelper","onRestore","version","guid","revertUpdate","snapshotUpdate","getMetadata","snapshotDoc","YDoc","currentStateVector","encodeStateVector","snapshotStateVector","changesSinceSnapshotUpdate","undoManager","UndoManager","share","keys","key","type","getText","getMap","getArray","undo","revertChangesSinceSnapshotUpdate","assertEquals","docId","vars","info","EmptyHistoryShape","svg","width","height","viewBox","fill","xmlns","rect","x","y","stroke","path","d","ellipse","cx","cy","rx","ry","transform","modalContent","contentOptions","onPointerDownOutside","e","preventDefault","style","padding","maxWidth","backgroundColor","overflow","ModalContainer","onOpenChange","children","Modal","withoutCloseButton","HistoryEditorPreview","historyList","snapshotPage","onModeChange","mode","onModeChangeWithTrack","useCallback","track","$","docHistory","switchPageMode","content","div","className","PureEditorModeSwitch","setMode","noDate","AffineErrorBoundary","Scrollable","Root","Viewport","BlockSuiteEditor","Scrollbar","Loading","size","_item","i","historyIndex","findIndex","h","distance","flag","toString","data-distance","planPromptClosedAtom","PlanPrompt","workspaceQuotaService","useService","WorkspaceQuotaService","quota","revalidate","workspaceQuota","useLiveData","quota$","isProWorkspace","humanReadable","name","toLowerCase","permissionService","WorkspacePermissionService","isOwner","permission","isOwner$","setSettingModalAtom","useSetAtom","openSettingModalAtom","planPromptClosed","setPlanPromptClosed","useAtom","closeFreePlanPrompt","onClickUpgrade","activeTab","scrollAnchor","viewPlans","t","useI18n","planTitle","IconButton","onClick","CloseIcon","planDescription","Trans","i18nKey","b","span","PageHistoryList","onLoadMore","activeVersion","onVersionChange","historyListByDay","collapsedMap","setCollapsedMap","useState","useLayoutEffect","collapsed","Collapsible","role","prev","data-testid","ToggleCollapseIcon","data-collapsed","idx","Fragment","stopPropagation","data-active","button","Button","variant","loading","disabled","EmptyHistoryPrompt","PageHistoryManager","onClose","setActiveVersion","openConfirmModal","useConfirmModal","handleRestore","DocService","mode$","value","onConfirmRestore","description","cancelText","confirmText","confirmButtonOptions","onConfirm","styles","data-empty","PageHistoryModal","Suspense","fallback","EditorLoading","GlobalPageHistoryModal","setState","WorkspaceService","handleOpenChange","buttonContainer","icon","TrashPageFooter","appSettings","useAppSettingHelper","jumpToSubPath","useNavigateHelper","restoreFromTrash","useBlockSuiteMetaHelper","setOpen","hintText","toast","meta$","onConfirmDelete","WorkspaceSubPath","ALL","removeDoc","onDelete","data-has-background","clientBorder","tooltip","prefix","ResetIcon","prefixClassName","DeleteIcon","ConfirmModal","BrowserWarning","show","message","LocalDemoTips","isLoggedIn","onLogin","onEnableCloud","buttonLabel","handleClick","background","cssVar","shouldShowWarning","environment","isDesktop","isBrowser","isMobile","isChrome","chromeVersion","OSWarningMessage","notChrome","notGoodVersion","strong","TopTip","loginStatus","AuthService","session","status$","showWarning","setShowWarning","showLocalDemoTips","setShowLocalDemoTips","confirmEnableCloud","useEnableCloud","setAuthModal","authAtom","openModal","state","flavour","WorkspaceFlavour","LOCAL","openPageId","exportHandler","editorRoot","document","querySelector","pageService","spec","getService","sharePanel","export","HtmlTransformer","exportDoc","MarkdownTransformer","apis","savePDFFileAs","root","exportManager","exportPdf","exportPng","useExportPage","pushGlobalLoadingEvent","pushGlobalLoadingEventAtom","resolveGlobalLoadingEvent","resolveGlobalLoadingEventAtom","globalLoadingID","nanoid","notify","success","err","console","error","useFavorite","favAdapter","CompatibleFavoriteItemsAdapter","favorite","isFavorite$","toggleFavorite","toggle","FavoriteButton","handleFavorite","header","actions","FavoriteTag","active","InfoButton","setOpenInfoModal","openInfoModalAtom","onOpenInfoModal","openDocInfo","InformationIcon","weekStyle","JournalWeekDatePicker","handleRef","useRef","journalDate","openJournal","useJournalRouteHelper","date","setDate","dayjs","format","current","setCursor","WeekDatePicker","onChange","JournalTodayButton","journalHelper","onToday","openToday","columnContainerStyle","descriptionStyle","menuItemStyle","menuStyle","rowContainerStyle","titleContainerStyle","generateUrl","urlType","blockId","baseUrl","getAffineCloudBaseUrl","URL","useSharingUrl","setBlockId","editor","useActiveBlocksuiteEditor","sharingUrl","onClickCopyLink","navigator","clipboard","writeText","then","catch","copyShareLink","selectManager","host","selection","currentBlockSelection","find","slots","changed","selections","ShareExport","workspaceMetadata","currentPage","currentMode","isMac","isMacOs","ExportMenuItems","pageMode","Divider","MenuItem","onSelect","block","preFix","MenuIcon","CopyIcon","fontSize","endFix","LocalSharePage","gap","props","onEnableAffineCloud","CloudSvg","AffineSharePage","shareService","ShareService","serverConfig","ServerConfigService","isSharedPage","isShared$","sharedMode","sharedMode$","config$","c","isLoading","showDisable","setShowDisable","currentDocMode","modeOptions","label","onClickCreateLink","useAsyncCallback","enableShare","PublicPageMode","Edgeless","Page","createShareLink","SingleSelectSelectSolidIcon","color","onDisablePublic","disableShare","log","onShareModeChange","changeShare","preMode","Skeleton","Input","inputStyle","lineHeight","readOnly","whiteSpace","Copy","Create","RadioGroup","items","runtimeConfig","ArrowRightSmallIcon","PublicLinkDisableModal","SharePage","AFFINE_CLOUD","ErrorBoundary","ShareMenuContent","WebIcon","DefaultShareButton","forwardRef","ref","shared","LocalShareMenu","Menu","rootOptions","modal","onOpenShareModal","CloudShareMenu","ShareMenu","useDetailPageHeaderResponsive","workbench","WorkbenchService","viewPosition","useViewPosition","workbenchViewsCount","views$","views","rightSidebarOpen","sidebarOpen$","hideShare","availableWidth","hidePresent","showDivider","isLast","hideCollect","hideToday","HeaderDropDownButton","MoreHorizontalIcon","displayName","PageHeaderMenuButton","rename","isJournal","containerWidth","isInTrash","m","trash","duplicate","importFile","usePageHelper","setTrashModal","useTrashModalHelper","view","ViewService","openSidePanel","openSidebar","activeSidebarTab","openAllFrames","openOutlinePanel","historyModalOpen","setHistoryModalOpen","setOpenHistoryTipsModal","openHistoryTipsModalAtom","openHistoryModal","openInfoModal","pageInfo","handleOpenInNewTab","openDoc","handleOpenInSplitView","handleOpenTrashModal","docOptions","deleteDoc","pageIds","pageTitles","handleRename","renameDoc","handleSwitchMode","toggleMode","transition","handleMenuOpenChange","blockSuiteDoc","handleDuplicate","control","onImportFile","options","import","isWorkspaceFile","createWorkspace","handleShareMenuOpenChange","handleToggleFavorite","ResponsiveMenuItems","MenuSub","subContentOptions","sideOffset","alignOffset","triggerOptions","ShareIcon","subOptions","MenuSeparator","EditMenu","showResponsiveMenu","EditIcon","EdgelessIcon","PageIcon","FavoritedIcon","FavoriteIcon","OpenInNewIcon","SplitViewIcon","TocIcon","FrameIcon","HistoryIcon","DuplicateIcon","ImportIcon","Export","MoveToTrash","align","DetailPageHeaderPresentButton","isPresent","handlePresent","usePresent","flexShrink","PresentationIcon","SharePageButton","handleOpenShareModal","Header","appSidebarFloating","appSidebarFloatingAtom","data-sidebar-floating","JournalPageHeader","containerRef","setContainerWidth","container","observeResize","entry","contentRect","ViewTitle","ViewIcon","EditorModeSwitch","HeaderDivider","NormalPageHeader","titleInputHandleRef","onRename","setTimeout","triggerEdit","onEditSave","BlocksuiteHeaderTitle","inputHandleRef","orientation","marginLeft","DetailPageHeader","collection","useRegisterCopyLinkCommands","workspaceMeta","isActiveView","useIsActiveView","isCloud","unsubs","registerAffineCommand","category","preconditionStrategy","PreconditionStrategy","Never","keyBinding","binding","run","cmdk","general","forEach","unsub","InfoModal","EditorFramePanel","framePanelRef","onRefChange","append","FramePanel","fitPadding","dailyCountItem","CountDisplay","count","attrs","PageItem","docRecord","right","Icon","TodayIcon","WorkbenchLink","aria-label","to","clsx","EditorJournalPanel","onDateSelect","isSame","customDayRenderer","data-is-date-cell","tabIndex","cell","focused","data-is-today","isToday","data-not-current-month","notCurrentMonth","data-selected","selected","data-is-journal","data-has-journal","DatePicker","weekDays","monthNames","todayLabel","JournalConflictBlock","JournalDailyCountBlock","sortPagesByDate","docs","field","order","sort","a","diff","DailyCountEmptyFallback","nodeRef","activeItem","setActiveItem","docRecords","DocsService","docs$","getTodaysPages","filter","createdToday","updatedToday","headerItems","activeIndex","assignInlineVars","String","index","aria-selected","renderList","pageRecord","ConflictList","currentDoc","title$","isCurrent","docRecordList","useJournalHelper","getJournalsByDate","records","v","some","slice","toFixed","EditorOutlinePanel","outlinePanelRef","OutlinePanel","DetailPageImpl","memo","activeSidebarTab$","openPage","jumpToPageBlock","jumpToTag","setEditor","globalContext","GlobalContextService","isSideBarOpen","setDocReadonly","setActiveBlockSuiteEditor","AIProvider","requestOpenWithChat","isDoc","docMode","isTrashDoc","useRegisterBlocksuiteEditorCommands","trash$","setPageHistoryModalState","setInfoModalState","onClickDelete","isCloudWorkspace","InPaperOrEdgeless","docInfo","restoreDoc","usePageDocumentTitle","onLoad","bsPage","surfaceBlock","getBlockByFlavour","yBlock","editorHost","std","use","customImageProxyMiddleware","ImageBlockService","setImageProxyURL","BookmarkBlockService","setLinkPreviewEndpoint","EmbedGithubBlockService","EmbedYoutubeBlockService","EmbedLoomBlockService","DisposableGroup","add","docLinkClicked","tagClicked","tagId","refCallback","hasScrollTop","useHasScrollTop","dynamicTopBorder","ViewHeader","ViewBody","data-dynamic-top-border","data-has-scroll-top","PageDetailEditor","EditorOutlineViewer","ViewSidebarTab","tabId","DetailPage","currentWorkspace","docsService","docListReady","isReady$","doc$","setDoc","opened","release","engine","setPriority","PageNotFound","noPermission","FrameworkScope","scope","PageDetailSkeleton","Component","performanceRenderLogger","debug","params","useParams","recentPages","RecentDocsService","localStorage","setItem","addRecentDoc"],"sourceRoot":""}